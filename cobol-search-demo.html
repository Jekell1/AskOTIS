<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COBOL Code Search - Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .search-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: end;
        }
        
        .form-group {
            flex: 1;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        button {
            background: #2a5298;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
        }
        
        button:hover { background: #1e3c72; }
        
        .examples {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .example-btn {
            background: #fff;
            color: #2a5298;
            border: 1px solid #2a5298;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .results {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .result-item {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        
        .file-path {
            color: #2a5298;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .line-info {
            color: #666;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .code {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            border-left: 4px solid #2a5298;
        }
        
        .symbols {
            margin-top: 10px;
        }
        
        .symbol-tag {
            background: #2a5298;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-right: 8px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç COBOL Code Search Interface</h1>
        <p>Search through 1,307,985+ indexed COBOL code lines</p>
    </div>
    
    <div class="search-container">
        <div class="examples">
            <h3>üí° Quick Examples</h3>
            <button class="example-btn" onclick="setExample('count')">Document Count</button>
            <button class="example-btn" onclick="setExample('programs')">Find Programs</button>
            <button class="example-btn" onclick="setExample('variables')">Find Variables</button>
            <button class="example-btn" onclick="setExample('customer')">Search CUSTOMER</button>
            <button class="example-btn" onclick="setExample('calls')">CALL Statements</button>
        </div>
        
        <form onsubmit="performSearch(event)">
            <div class="form-row">
                <div class="form-group">
                    <label>Search Query</label>
                    <input type="text" id="search" placeholder="e.g., CUSTOMER, *, PROGRAM-ID" required>
                </div>
                <div class="form-group">
                    <label>Filter</label>
                    <select id="filter">
                        <option value="">All types</option>
                        <option value="symbol_kind eq 'program'">Programs</option>
                        <option value="symbol_kind eq 'variable'">Variables</option>
                        <option value="symbol_kind eq 'procedure'">Procedures</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 0.5;">
                    <label>Max Results</label>
                    <input type="number" id="top" value="20" min="1" max="100">
                </div>
                <div class="form-group" style="flex: 0;">
                    <button type="submit">üîç Search</button>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Fields to Return</label>
                    <input type="text" id="select" value="repo_path,line,code,symbol_name,symbol_kind">
                </div>
                <div class="form-group" style="flex: 0.3;">
                    <label>Include Count</label>
                    <select id="count">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
            </div>
        </form>
    </div>
    
    <div id="results" style="display: none;"></div>

    <script>
        const API_BASE_URL = 'http://localhost:5000/api';
        
        function setExample(type) {
            const examples = {
                count: { search: '*', filter: '', top: 0, count: true, select: '' },
                programs: { search: '*', filter: "symbol_kind eq 'program'", top: 10, count: false, select: 'repo_path,line,code,symbol_name' },
                variables: { search: 'CUSTOMER', filter: "symbol_kind eq 'variable'", top: 15, count: false, select: 'repo_path,line,code,symbol_name,symbol_kind' },
                customer: { search: 'CUSTOMER', filter: '', top: 20, count: false, select: 'repo_path,line,code,symbol_name,symbol_kind' },
                calls: { search: 'CALL', filter: '', top: 15, count: false, select: 'repo_path,line,code,calls' }
            };
            
            const example = examples[type];
            document.getElementById('search').value = example.search;
            document.getElementById('filter').value = example.filter;
            document.getElementById('top').value = example.top;
            document.getElementById('count').value = example.count.toString();
            document.getElementById('select').value = example.select;
        }
        
        async function performSearch(event) {
            event.preventDefault();
            
            const requestBody = {
                search: document.getElementById('search').value
            };
            
            const filter = document.getElementById('filter').value;
            const select = document.getElementById('select').value;
            const top = parseInt(document.getElementById('top').value);
            const count = document.getElementById('count').value === 'true';
            
            if (filter) requestBody.filter = filter;
            if (select) requestBody.select = select;
            if (top > 0) requestBody.top = top;
            if (count) requestBody.count = count;
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }
                
                const data = await response.json();
                displayResults(data);
                
            } catch (error) {
                displayError(error.message);
            }
        }
        
        function showLoading() {
            const results = document.getElementById('results');
            results.style.display = 'block';
            results.innerHTML = '<div class="loading">üîç Searching COBOL code...</div>';
        }
        
        function displayResults(data) {
            const results = document.getElementById('results');
            const items = data.value || [];
            const totalCount = data['@odata.count'];
            
            let html = `
                <div class="results">
                    <h3>Search Results ${totalCount !== undefined ? `(Total: ${totalCount.toLocaleString()})` : ''}</h3>
                    <p>Showing ${items.length} results</p>
            `;
            
            if (items.length === 0) {
                html += '<p>No results found. Try a different search term.</p>';
            } else {
                items.forEach(item => {
                    html += `
                        <div class="result-item">
                            <div class="file-path">${item.repo_path || 'Unknown file'}</div>
                            ${item.line ? `<div class="line-info">Line ${item.line}</div>` : ''}
                            ${item.code ? `<div class="code">${escapeHtml(item.code)}</div>` : ''}
                            <div class="symbols">
                                ${item.symbol_name ? `<span class="symbol-tag">${item.symbol_name}</span>` : ''}
                                ${item.symbol_kind ? `<span class="symbol-tag">${item.symbol_kind}</span>` : ''}
                                ${item.calls && item.calls.length ? `<span class="symbol-tag">Calls: ${item.calls.join(', ')}</span>` : ''}
                            </div>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            results.innerHTML = html;
        }
        
        function displayError(message) {
            document.getElementById('results').innerHTML = `
                <div class="error">
                    <h4>Error</h4>
                    <p>${escapeHtml(message)}</p>
                </div>
            `;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Set default example
        setExample('count');
    </script>
</body>
</html>
