       IDENTIFICATION DIVISION.
       PROGRAM-ID.      LNQUOT.
       DATE-WRITTEN.    032587.
      *************************************************************************
      *
      *  DESCRIPTION:   DIRECT LOAN QUOTES
      *                 CALLED FROM CL/WIMENU, CL/SIMENU (SPANISH F10)
      *                             SP/GNQUOT, WI/LNPBRN, WI/LNRNEW
      *
      *  ---------------------------------------------------------
      *  |                    N  O  T  E:                        |
      *  |                                                       |
      *  |       THIS PROGRAM USES A48 PAYMENT SCHEDULE LOGIC    |
      *  ---------------------------------------------------------
      *
      * REV:
      *  051388 JPN MOVED COP-SIM-RATE TO PD-SMPRATE.
      *  082288 BAW ADDED 2 OTHER INSURANCES
      *  093088 BAH VERIFICATION ON INSURED
      *  103188 BAH ALLOW 0 PROCEEDS ON 'SC'
      *  111088 JTG ADDED CLEAR OF PD-STATE-WORKER
      *  010989 SLC ADDED ANTICIPATED CALC.
      *  020189 BAH ADDED PD-PROMDATE2
      *  031089 SLC ADDED PD-PRIOR-UNEARNED.
      *  031389 BAH CHANGED CIP-PRBAL IN VERIFICATION OF PROCEEDS
      *             TO BE PRIOR-LNAMT
      *  032389 JTG REMOVED CLEAR OF LN-EXTDAYS LN-GRACEDAYS
      *             ADDED SET OF LN-ORIG-1STPYDATE
      *  081889 JTG ADDED LOGIC FOR PD-PRPAID-AHEAD (GA)
      *                             PD-RESTRICT-ADJ
      *  090189 BAH CHANGED PASS-PRLNNO TO 8
      *  120889 JTG CORRECTED BUG CLEAR STATECIP-STATE-W
      *  011990 JTG ADDED UPDATE STOP IF INS-COVERAGE ERROR
      *  020790 JTG ADDED LOGIC FOR "IA" ADDON INSURANCE FEATURE
      *  021290 SLC ADDED LOGIC FOR ADDPROG FEATURE FOR COLLATERAL.
      *  051890 JTG ADDED LOGIC FOR PD-RESTRICT-ADJ (GA)
      *  102990 BAH ADDED AUTO PRLNNO DISPLAY FOR PB, RN, AND SC
      *  050692 JTG MODIFIED FOR LPSPED(INS AGE / BENEFIT TEST)
      *  083193 BAH EXT CHRGS WERE GOING TO SLOT 2 INSTEAD OF BEING
      *             ADDED INTO INTEREST SLOT 1
      *  111593 BAH ORIG-1STPAY NOT GETTING SET IN ALL CASES
      *  031894 JTG CHGED BACK SO IF INSURANCE CODES 'NNN' IS CHANGED
      *             CALCZL WILL RECALCULATE, WITH 0 TO CIP-NO-TIMES-CALLED
      *  061494 JTG CORRECTED DISPLAY OF TOTAL REPAY ON QUOTE RECALL
      *  020895 BAH CHANGE TO COSMO SCFRMLA 16, CALL CASC16
      *  021695 JTG ADDED LOGIC TO ALLOW INSURANCE COVERAGE OVERRIDES
      *             TO REMAIN AFTER QUOTE ARE RECALLED
      *  031395 JTG ADDED SET OF COP-SMP-RATE RE: SP-INS-ADJ-PRIN-HALFINT
      *  032195 JTG STOPPED SAVE IF CALCULATION ERRORS
      *  062195 JTG EXPANDED FOR 10 INSURANCES
      *  062995 JTG ADDED LOGIC FOR O3 INSURANCE AND CALC OF O1
      *  081195 MJD ADDED LOGIC FOR GP-THE-ONLY-SF-SRCD
      *  093095 JTG ADDED LOGIC FOR GP-DEFAULT-O3-INS-COMPANY
      *  011796 JTG CHANGED SO O2 & O3 INS. DON'T COMPUTE DEFAULT EXPIRATION
      *             DATE UNLESS INITIAL INPUT
      *  MJD 042496 CHANGED TO ACCEPT 8 DIGIT ACCOUNT NUMBER FROM BWLNSC.
      *             ADDED MORELN WINDOW LOGIC. ADDED SCREEN DISPLAY OS SEQNO IF
      *             OTHER THAN 1.
      *  JTG 052996 FIXED BUG THAT LEFT PD-PRBAL WITH A VALUE, WHEN SWITCHING
      *             FROM "PB" OR "RN" OR "SC" TO --> "NB"
      *  BAH 062896 ADDED INSEXP(5) AND INSEXP(6) TO MAKE-DATES-CURRENT
      *             SO WHEN YOU RECALL A QUOTE, IT UPDATES THOSE DATES.PL#96
      *  JTG 111296 CORRECTED DISPLAY BUG RE: MISSING FIELD 305
      *  JTG 111296 CHANGED LN-INSTBL (LEVEL'S 9 & 10) TO FILLER
      *  JTG 112196 CHANGED TO USE HASHING ON SAVE QUOTES
      *  BAH 011697 ADDED APR-SEQ AND OVER-SEQ FOR SEPARATE PASSWORDS, #142
      *  BLV 032497 F7 ON PAYOFF INQUIRIES; READ PD BEFORE DELETING IT
      *  MJD 060397 ADDED SCSCAN-TRANS-DATE.
      *  JTG 072297 ADDED LOGIC FOR CAN LOAN FILE
      *  JTG 082197 CHANGED TO USE 'LPZLCL' TO CLEAR-CALC-AREA-ZL
      *  GLF 090997 REPLACED 'IO' ON GP-FILE WITH GET 'GPENV'
      *  GLF 091897 REPLACED ANY PROMPT THAT DISPLAYS WORD 'GIFTNET' W/'WCBC'
      *  JTG 121597 ADDED TEST FOR CIP-NO-OF-TIMES-CALLED < 800, TO ALLOW RESET
      *             OF CEP FIELDS, WDT # 148, CASTLE #163 RE: RATE OVERRIDE
      *  BAH 123097 ADDED SCFRMLA 29, SAME AS FRMLA 5 BUT WITH 4'S RESTRICTIONS
      *             MULLEN, PR# 589
      *  JTG 011598 CHANGED TO EXIT BORROWER-QUOTED ROUTINE WITH IO-FG = N9,
      *             IF DUPLICATE GIFTNET ENTERED
      *  BAH 012698 IF INSURED IS "S", TEST SECOND MAKER'S AGE EDITS, PR#641
      *  JTG 020498 SET CIP-CAN-LOAN-NO, RE: LOGIC TO FORCE ONE CALENDAR MONTH
      *             SEE CALCZL.C
      *  BLV 020598 CHANGED CANNED LOAN OPTION FROM F5 TO F2
      *  JTG 032498 STOPPED SINGLE PAYS LOANS, MUST USE BLQUOT.C
      *  BAH 040698 GP-DEFAULT-O3-INS-COMPANY 0 WAS NOT ALLOWING ANY INS CO.
      *  JTG 040698 CORRECTED BUG RE: NOT RECALCULATING AFTER DETERMINING
      *             RESTRICTION FOR GA,SC
      *  JTG 042298 PUT EDIT ON FEE CODES WHEN CAN LOAN IS SELECTED, WORLD
      *  BAH 042998 MOVE BW-ORIGIN TO PD-ORIGIN, FEDERATED PR# 646
      *   CS 042998 ADDED "RB" AND "RO" RENEWAL CODES
      *  JTG 061798 CHANGED TEST ON SRCD AGAINST PRIOR LOAN PD-PO-TRCD
      *             AND PUT BACK STOP SO 'SC' IS ONLY VALID SF RENEWAL
      *  KEC 072098 ADDED CHECK FOR NEW FLAG ON 'SPR' CAN-LOAN FLAG
      *              ( SP-CAN-LOANS-FG ).  FOR WORLD          PR#: 00187
      *  BLV 072898 FIX FEE CODE EDIT; MOVE EXT-CONAME-USER-LOC TO PD-OWNBR BEFORE EDIT
      *  JTG 081898 ALLOWED 'PB' ON BANKRUPT ACCOUNTS IF GP-I-AM-WORLD <JGW
      *             ALSO ALLOWED RECALL OF LOANS WITH PRIOR-LOAN-NOT-VALID <JGV
      *  KEC 090498 ADDED 'MOVE LC-LOANTYPE TO PD-LOANTYPE';
      *              FOR REGENCY REVOLVING.
      *  JTG 092598 CHANGED CALL FROM LONPZL TO CALCZL
      *  JTG 101398 ADDED SET OF LCSCAN-REVOLVING = 'N' AND STOPPED ENTRY
      *             OF REVOLVING CLASSES, REGENCY REVOL
      *  JTG 101298 SET PDSCAN-REVOLVING = 'N', REGENCY REVOL
      *  JTG 110598 CORRECTED DISPLAY-APP-BW-LISTWAS MISSING '.' END OF LIST
      *             ALLOWED RECALL WITH ERROR-IN-PRIOR-LOAN WILL BE CAUGHT IN
      *             ATTEMPT TO UPDATE
      *  JTG 122198 REPLACED SP-SCFRMLA = 1 OR 8 OR 28 TESTS
      *             WITH 88 SP-SCFRMLA-POINTS
      *  JTG 990113 ADDED SP-EDT-TYPE 'P' POINTS,                   REGENCY #012
      *  JTG 990304 CHANGED PROMPT FOR NO CAN LOANS TO '          :"
      *  GLF 990312 ADD WI/TFCCDS FOR TFC ENTRY OF LPO, REP CODE, PROCESS CODE
      *  KEC 990413 ADDED CHECK OF 'SPR' FOR SELECTING A CAN LOAN.
      *  JTG 990413 ADDED CHECK OF 'SPR' FOR SELECTING A NON CAN LOAN.
      *  GLF 990607 PROVIDE FOR F6 SCAN OF INSURANCE COMPANY NUMBER
      *  BAH 990609 "OK" CLASS 5 IS NEW LARGE LOAN CLASS, AND HAS INSURANCE
      *             AND FEES THAT THEY ARE CHANGING, AND ALSO DOES NOT
      *             FOLLOW THE SMALL LOAN "OK" "MO" ABNORMAL INTCHG CALCULATION
      *             SO IT NEEDS TO RECALCULATE, WORLD...
      *  MJD 990806 ADDED GP-INCL-OTH-IN-EARNED FLAG. IF "Y" THEN INCLUDE
      *             EARNINGS BUCKET 6 (OTHER) IN ACCUMULATED TOTALS
      *             OTHERWISE EXCLUDE BUCKET 6.
      *  BAH 991012 COMMENTED OUT SPR EDIT ON PROCEEDS AMOUNT LOW IN
      *             SP-EDT-TABLE-LOOKUP PROCEEDS-VALIDATION FOR KEVIN, YOU
      *             GET STOPPED ON PROCEEDS AND DONT EVEN GET TO ENTER THE
      *             FEES OR INSURANCES TO MEET THE MINIMUM
      * MJD 991109 FORCE INPUT OR EXP DATE ON O3 BY DAFAULTING TO 00/00/00
      *            INSTEAD OF MATURITY DATE
      *            IF A SAVERD LOAN IS RECALLED, DO NOT RESET EXP DATE
      *            ON O3 INS (REGACC PR #985)
      * BAH 991111 PASSWORD COVERAGE FIELD FOR CALCULATED INSURANCES,
      *            CL,AH,O1  REGACC PR# 984
      * JTG 000113 ADDED SP-INSREJECT-FG OPTION 'C', WHICH WILL CAUSE WRITING
      *            NO. OF MONTHS INSURANCE NOT IN VIOLATION, WISCONSIN #1032
      * MJD 000207 ADDED GP-OT-INS-TERM (TFC PR#48) IF 'Y' THEN ALLOW
      *            ALLOW TERM ENTRY FOR O2O3O4O5 INSURANCE.
      *  MJD 000224 ADDED PASSWORD CHECK FOR REGMGT. IF THEY ENTER
      *             A PD-OVRDRATE-FG NOT = TO A THEN CALL VERIFY-PASSWORD.
      *             (REGMGM PR# 1006)
      *  BAH 000225 PASSWD GETTING TO 25(CL) OR 26(AH), REGMGM PR# 1085
      *  MJD 000228 ADDED GP-ADV-TO-1ST-NO-CORR = "A" . IF DATE OF THE LOAN
      *             IS ON THE 26 THRU 31 THEN ADVANCE THE FIRST PAYMENT
      *             DUE DATE TO THE FIRST OF THE SECOND MONTH FOLLOWING THE
      *             DATE OF THE LOAN. (REGMGM PR#1099)
      *  BLV 000313 STAFFED OFF ENTER-HI-CREDIT, NEVER PERFORMED
      *  JTG 000315 CORRECTED BUG WITH SRCD EX. FB AND PRIOR ACCOUNT NO. ENTRY
      *             WISC #71249 J006
      *  KEC 000509 {PR#01148} PARADATA FINANCIAL [LORI MCBEE]
      *             ADDED LOGIC TO HAVE RESCISSION IN A QUOTE.
      *  MJD 000518 ADDED SCFRMLA 39 - IN THIS PROGRAM IT FOLLOES THE SAME
      *             LOGIC AS 33 (SUPPORT PR#1181)
      *  JTG 000518 {PR#01148} PARADATA FINANCIAL [LORI MCBEE]
      *             TEMP CORRECTION OF LOGIC TO HAVE RESCISSION IN A QUOTE.
      *  KEC 000530 {PR#00048} TFC [JUDY BRANIFF];
      *             ADDED THE FOLLOWING 'IF' CONDITION FOR ENTERING THE
      *             INSURANCE TERM (GP-OT-INS-TERM = "Y"):
      *                   IF ( VDUNUM0 > 360 )
      *                      GO TO ENTER-IC-TERM.
      *  JTG 000607 ADDED LOGIC FOR TESTING CALCZ3.C BY SETTING ENV
      *             VARIABLE "CALL_TESTZL" WHICH MAKE THE CALL TO
      *             "LP/TESTZL" INSTEAD OF "LP/CALCZL"
      *  MJD 000616 CHANGED OVER-SEQ TO TEST PASSWORD ON CL,AH,PP,01,MAINT FEE,
      *             1ST PY EXT, EXT LC INFO. THIS WILL MAKE IT CONSISTENT WITH
      *             XONPC0.
      *  MG  000629 ADDED LOGIC FOR TENNESSEE RATE TYPE 'M' FLAT MONTHLY
      *             CHARGE, PR#1225
      *  BLV 000711 ADDED ENTRY OF LN-EMP-ID FOR WORLD CLASS BUYING CLUB
      *             PROMOTION
      *  BLV 000726 FORCE NON-ZERO ENTRY OF EMP-ID FOR WORLD CLASS BUYING CLUB
      *  JTG 000915 REMOVED HARD CODING FOR "OK" AND "MO" WHICH STOPPED
      *             RECALCULATION OF CANS, THEY WILL CHANGE THEIR SPR'S
      *             TO USE TENNESSEE RATE TYPE 'M' FLAT MONTHLY CHARGE
      *             WORLD PR#239
      *  BAH 010518 ADDED SCFRMLA 42 (SUNBELT) LIKE 18 BUT 360 YEAR, PR# 1484
      *  BAH 010607 ADDED SP-SCFRMLA = 43 FOR FCF "NC", PR# 1506
      *  BLV 010608 REMOVED LOGIC FROM 9/15/00 CHANGE ABOVE.  AFTER SOFTWARE
      *             UPDATED AT WORLD, MISSOURI CANS RECALCED AFTER SSNO WAS
      *             ENTERED & CHANGED PROCEEDS BY A FEW CENTS (SPRS HAD NOT
      *             BEEN CHANGED TO USE FLAT RATE).  JIM R. SAYS HE DECIDED
      *             WE DIDN'T REALLY WANT THE 9/15 CHANGE.
      *  JTG 010820 REMOVED ALL HARD CODED LOGIC FOR "MO"          WORLD PR#J020
      *  BAH 011228 ADDED SP-SCFRMLA 45, HCRED "NC"  PR#1695
      *  JTG 010831 TESTED COP-RETURN-CODE = 'V' FOR DISPLAY OF ERROR IN CALC
      *                                                         LENDMARK PR#J021
      *  JTG 020228 ADDED "CT" COUNTY TAX CODE KENTUCKY AND PERCENTS
      *             ADDED "CY" CITY   TAX CODE KENTUCKY AND PERCENTS  WORLD #288
      *  BAH 020418 ADDED NCSCHG-SCFRMLA TO PASS SP-SCFRMLA FOR 45, SFS #1785
      *
      * KEC 020624 {PR#01823} REGIONAL ACCEPTANCE <A15> [KEVIN MULLEN]
      *            ADDED LOGIC FOR USING 'CD-GC-FEE-MAXAMT'
      *
      * KEC 020806 {DR#00009} PARADATA <A15> [KEN]
      *            ADDED LN-RESCISSION AND LN-RESCISSION-DATE.
      * BAH 020806 ADDED SP-MFFRMLA = 4, PR# 1867 REGWAN
      * BLV 020820 IF GP-ENTER-LPO-FG = "Y", OPEN TFC WINDOW FOR ENTRY OF
      *            LPO, SOAUTO PR# 1885
      * JTG 030123 CHANGED TO GET SYSTEM DATE FROM FM/WI/LNQUOT SCREEN
      *            TO ALLOW 'SYSDATE_YYMMDD' ENVIRONMENT VARIABLE TO WORK
      * JTG 030430 CREATED FORMULA 12 LIKE 2 BUT SPREADS EXTENSION CHARGE
      *            OVER PAYMENTS  88  SP-PYEXFRMLA-SAME2-SPREAD VALUE 12.
      *                                                          CITIZENS #2006
      *  BAH 030619 ADDED CIP-PRIOR-SUB-CLASS FOR SCFRMLA 46, LENDMARK PR# 2101
      *             AND PASS-PRIOR-SUB-CLASS (PAYOFX)
      *  JTG 030806 CORRECTED TEST FOR PROCEEDS < 0 WHEN MEMO INSURANCE
      *             PREMIUMS ARE ENTERED THEY WERE PART OF THE TEST
      *             AND THEY SHOULD NOT BE CONSIDERED            LENDMARK #J032
      *  JTG 030917 CHANGED FOR REGENCY TO PASSWORD PROTEST RENEWALS OF LOAN
      *             CLASS 16 & 17 INTO ANY CLASS BUT CLASS 17
      *             ADDED PASSX-CURRENT-PD-CLASS TO HOLD PD-CLASS OF
      *             LOAN BEING MADE                                REGENCY #2135
      *  JTG 031001 CREATED 01  SCHG-WORKERS-2 FOR PASS FOR SCFRMLA 13
      *                                                       LENDMARK #2149
      *  JTG 031015 CHANGED FOR REGENCY TO PASSWORD PROTEST RENEWALS OF LOAN
      *             CLASS 16 & 17 INTO ANY CLASS BUT CLASS (17 , 50-79)
      *             ADDED PASSX-CURRENT-PD-CLASS TO HOLD PD-CLASS OF
      *             LOAN BEING MADE  (2135)                        REGENCY #2172
      *  BAH 031023 ADDED GP-DEFAULT-O3-INSOURS, LENDMARK PR# 2180
      *  JTG 040213 STOPPED DISPLAY OF NON MONTHLY CAN LOANS IN CLSCAN
      *             WINDOW                                            WORLD J043
      *  BAH 040304 ADDED SP-DEFAULT-O2-INS-COMP FOR LENDMARK PR# 2258
      *  BAH 040430 CLASS RENEWAL PASSWORDS BECAUSE OF TICO CONVERSION,
      *             SHARING THE RENEWAL-SEQ PASSWORD OPTION, REGWAN PR# 2286
      *  BLV 040617 CHANGED 3 INSTANCES OF MOVING PD-REC OR PD-RECORD TO
      *             AND BACK FROM WK-SAVE-RECORD WHICH IS SHORTER THAN EITHER;
      *             PD-REC = 2289, PD-RECORD = 2241, WK-SAVE-RECORD = 2185.
      *             THIS WAS CHOPPING OF THE LAST 2 GIFTNET DATES. CHANGED
      *             TO USE WORKER: HOLD-PD-RECORD WITH A SIZE OF 2289 BYTES.
      *             THIS PROGRAM DOESN'T DO THE SAVE/RESTORE LOGIC TO THE
      *             WORK FILE SO THIS SHOULD BE OKAY.
      *  BAH 041108 ADDED INSCO-SEQ TO PASSWORD CHANGING INSURANCE COMPANIES
      *             ON INSURANCES 1 THRU 4, REGWAN PR# 2418
      *  JTG 041206 PASSWORD PROTECTED FIELDS 25, 26, 27, 28
      *             CL, AH, PP, O1 FIELDS IN XONPC0, ZONPC0, LNQUOT AND BLQUOT
      *                                                              WORLD #J051
      *  JTG 041209 N O T E:  N O  PASSWORD TEST ON ABOVE
      *                       IF CHANGING 'PP' AND PD-ORGST = "GA"
      *                              AND GP-FORCE-INPUT-PP-COVERAGE = 'Y'
      *                                                              WORLD #J051
      *  BAH 050222 WHEN ENTERRING SUB CLASS, YOU DONT KNOW THE LOANDATE YET TO
      *             CHECK IF SPR IS EXPIRED, SO IT WAS JUST GRABBING THE FIRST
      *             LAWCODE FOUND TO DISPLAY THE DESCRIPTION, WHICH ISNT
      *             CORRECT IF THEY EXPIRE AND BUILD A NEW ONE WITH A DIFFERENT
      *             DESCRIPTION, VERY CONFUSING...AT LEAST SKIP EXPIRED SPR.
      *             RIVERSIDE PL# 467
      *   CS 050330 ADDED CHECK ON SP-INSURANCE-WRITTEN, IF THIS FLAG IS SET TO
      *             "N", ACCESS IS DENIED TO ALL INSURANCES INCLUDING O2 & O3.
      *             COULD NOT USE 'NNN' AS BASIS FOR FREEING UP FEE CODES AS
      *             WORLD HAS THE BR-FORCE.. SET TO 'Y', USES 'NNN' BUT WRITES
      *             O2 & O3.  ALSO THIS STOPS OPERATOR(LENDMARK) FROM ACCIDENTLY      *             WRITING INSURANCE (CALCULATING A SALES TAX) THEY SHOULDN'T.
      *             IT ALSO WORKS IN CONJUCTION WITH BR-FORCE-VALID-CITY-COUNTY
      *             IN DETERMINING IF FEE CODES 16 -18 ARE FREE OR LOCKED.
      *             IF BR-FORCE-VALID-CITY-COUNTY IS "Y" & SP-INSURANCE-WRITTEN
      *             IS "N" ALL 10 FEE CODES ARE FREE.  IF BR-FORCE... 'Y' &
      *             SP-INSURANCE-WRITTEN "Y", FEE CODES 16 -18 ARE LOCKED
      *                                                  LENDMARK PR#2479
      *             BR-FOCE-VALID-CITY-COUNTY = BR-FORCE
      *             SP-INSURANCE-WRITTEN      = INSURANCE
      *             NO INSURANCE MEANS 'N' TO CL/AH/PP/O1,O2,O3
      *
      *    BR-FORCE | INSURANCE |
      *      'Y'    |    'Y'    | FEES 16 -18 LOCKED
      *      'Y'    |    'N'    | ALL FEES UNLOCKED, NO INSURANCE ENTRY ALLOWED
      *      'N'    |    'N'    | ALL FEES UNLOCKED, NO INSURANCE ENTRY ALLOWED
      *      'N'    |" " OR "Y" | ALL FEES UNLOCKED
      *  050427 CS  IF INSURANCE PREMIUM IS ZERO, ZERO THE OTHER FIELDS, INSEFF
      *             INSEXP,INSCO,INSCOVR,INSOURS [PR#479 NSA]
      *  BAH 050513 IF GP-I-AM-WDT, ONLY CLASS 7 CAN RENEW INTO CLASS 7 AND
      *             CLASS 7 CAN NOT RENEW INTO ANYTHING ELSE, PR# 2528 FINMGM
      * BAH 050719 ADDED SET OF BWCREA-ERRCD TO "S" FOR SPANISH SCREENS,
      *            WORLD PR# 414
      * JTG 050819 CHANGED SAVE LOAN, ETC TO USE PD-ANTICERN(4) FOR DISPLAY
      *            OF MAINTENANCE FEES INSTEAD OF THE STORED TRUNCTATED
      *            PD-MAINTFEE * PD-ORGTERM WHICH DOSEN'T EQUAL THE COMPUTED
      *            'VAT' VALUE ADDED TAX IN PD-ANTICERN(4)           WORLD #0408
      * BAH 051128 UNDO CHANGE FROM 050222 PL# 467, WOULD NOT LET YOU BOOK A
      *            LOAN WITH AN EXPIRED SPR, AND YOU SHOULD BE ABLE TO.
      *            INSTEAD OF SKIPPING EXPIRED SPR IN READ-NEXT, JUST REDISPLAY
      *            THE SUBCLASS DESCRIPTION AFTER ENTERING THE LOANDATE.
      * MJD 061221 ADDED TEST OF PRIOR LOANS SCFRMLA IF 48. REGENCY PR#2880
      * JTG 070326 WORLD SPR'S ARE FLAGGED WITH GP-ADV-TO-1ST-NO-CORR = "Y"
      *            WHICH WILL ADVANCE TO THE NEXT MONTH IF THE DEFAULT
      *            PAYMENT DUE DATE FALLS ON A NON EXISTING DAY
      *            THIS CHANGE OVERRIDES THIS OPTION FOR LOANS BOOKED WHEN
      *            GP-I-AM-WORLD AND PD-ORGST = "TN" AND PD-CLASS = 01 AND
      *            PD-ORGTERM = 12                                   WORLD 0532
      * BAH 070613 GIVE WARNING MESSAGE TO CHECK ORIGINATION FEE CODES IF
      *            THEY CHANGE THE INSURED CODES, REGMGM "NC" CANNED LOANS
      *            ONLY, REGMGM PR# 2989
      * BAH 070730 ADDED SCFRMLA 49 FOR REGMGM PR# 3017
      * MJD 070927 ADDED TEST FOR MAXIMUM EDIT ON POINTS AND FEES
      *            FOR TN MORTGAGE LOANS.  (DETAILS OF CHANGE DOCUMENTED BELOW)
      *                                                       REGENCY  PR#3043
      * BAH 071016 ADDED TEST OF SP-RENEWABLE-DAYS = 9999 FOR REGMGM PR# 3082
      *            DO NOT ALLOW "PB" OR "RN" IF SP-RENEWABLE-DAYS = 9999
      *  CS 080520 ADDED CHECK-SP-EFFECTIVE TO VIA-QUOTE-SCAN. WHEN QUOTE WAS
      *            SAVED UNDER PRIOR LAW CODE & RECALLED AT A LATER DATE WHEN
      *            A NEW LAWCODE WAS IN EFFECT & SAVED, THE DATE ON QUOTE WAS
      *            SAVED BUT NOT LAWCODE. WHEN THAT SAVED WUOTE WAS RECALLED
      *            IN S/F/INPUT & NOT CHANGE TO LOAN DATE WAS ENTERED, LOAN
      *            GOT UPDATED WITH WRONG LAWCODE & LAWS PR#627 REGMGM
      * BAH 090317 ADDED PASSWORD OPT 18 FOR INTEREST START DATE NOT EQUAL
      *            TO LOAN DATE, REGMGM PR# 3335
      * MJD 090422 ADDED LOGIC TO ALLOW ZERO PROCEEDS LOANS    REGMGM #3341
      *  CS 090427 ALLOW OVERRIDE OF PP/01 ON CANNED LOAN PR#495 WORLD
      *            MOVED CIP-CALCULATION-INPUT TO COP-CALCULATION-OUTPUT
      *  CS 090511 FIXED PASSWORD TEST ON CL/AH/PP/01 GP-I-AM-WORLD WAS
      *            PROMPTING FOR PASSWORD BUT NOT TESTING THE STATUS
      * BAH 090904 ALLOW SP-INSMAXCHGABL-OVRIDE TO WORK WITH O1, FINMGM PR# 3447
      * MJD 100715 FIXED TO CORRECTLY ALLOW MAINTFEE'S OVER 99.99 FOR MEXICO.
      *            WORLD #692
      * BAH 110106 ADDED SCFRMLA 50 FOR WORLD "IL" PR# 731
      * BAH 110127 RENAMED CASCHG-ORGST TO CASCHG-SCFRMLA, REGMGM PR# 3721
      * BAH 110216 CHANGE TO SCFRMLA 50 FOR 3/21/11, WORLD PR# 731
      * BAH 110321 SCFRMLA 50 FOR NEW LOANS, EXIT WITH 100.00 IN
      *            CIP-RESTRICT-ADJ SO CALCZL WILL BE CORRECT, WORLD 731
      * BAH 110523 PASSWORD PROTECT ADDON SOURCE CODES, ET, LP, NP, RT, ST
      *            AND RB, REGMGM PR# 3792
      * BAH 110601 ADDED SP-SCFRMLA 52 AND 53 FOR MULLEN PR# 3799
      * BAH 111109 CHANGE SCFRMLA 47 TO BE MORE LIKE 49, CALL CASC16 TO CHECK
      *            ONLY 1 WITHIN 12 MONTH PERIOD, BAY PR# 3898
      * MJD 111212 ADDED LOGIC FOR SP-ADV-TO-1ST-NO-CORR
      *            IF SET THIS WILL OVERIDE THE GP FLAG.             71226 #3879
      * BAH 111229 ADDED PP-PREM-SEQ TO PASSWORD CHANGING PP PREM REGWAN PR#3935
      * BAH 130130 A30 CONVERSION
      * BAH 130208 RENAMED RENEWAL-SEQ TO RENEWAL-SEQ TO SHARE WITH OTHERS
      *            ADDED A RENEWAL-SEQ CASE FOR REGMGM, PR# 4209
      *  CS 130221 REPLACED CALL ERRMSG USING WITH PERFORM CALL-ERRMSG.
      *  CS 130319 REMOVED MISC LIBGB/ERRMSG, ITS IN DECLARATIVES
      * BAH 130314 PR# 4209 SHOULD ONLY BE FOR "TN", REGMGM PR# 4209A
      * MJD 130603 ADDED LOGIC FOR SP-SCFRMLA = 54.  FUNCTIONS THE SAME AS 12
      *            BUT INCLUDES AN EXTRA 4% ADDED IN AT THE END BASED
      *            ON TOTAL NOTE                                     WORLD #0874
      * BAH 130814 ADDED SCFRMLA = 55, CROSS BETWEEN 23 AND 32, WORLD PR# 918
      * BAH 131213 ADDED SP-SCFRMLA 56, LIKE 6 WITH RESTRICTIONS, WORLD PR# 953
      *            ALSO ADDED NCSCHG-ORGST AND NCSCHG-CLASS
      * BAH 150225 NEW PASSWORD OPTION 22 (INSTERM-SEQ) TO CHANGE DEFAULT
      *            INSURANCE TERM OR EXPIRATION, REGENCY PR# 4714
      * BAH 150508 ADDED SCFRMLA 57, COMBO OF 23 AND 46, NSA PR# 4747
      *  CS 150814 IF GP-I-AM-EXCEL, TEST THE FEECODE AMOUNT AGAINST CD-
      *            GC-BRANCH-COMM-AMOUNT  EXCEL PR#4821
      *  CS 150921 ADDED TEST FOR 202020/020202 CD-GC-BRANCH-COMM
      * BAH 151104 ADDED SP-RENEWAL-EDIT "D" AND "E" FOR REGMGM PR#4885
      *
      * KEC 2016.0310 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED CD-GROUP, CD-SECURED & CD-TRW TO BE
      *         CD-CO-GROUP, CD-CO-SECURED & CD-CO-TRW.
      *
      * KEC 2016.0318 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED CD-FEE???? TO CD-GC-????.
      *
      * KEC 2016.0328 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED CDSCAN-WINDOW-BUF TO HAVE MATCHING CD1-KEY
      *         LAYOUTS (FOR EACH CODE TYPE; CD-TYPE).
      *         CDSCAN-CD1-KEY IS THE NEW (PRIMARY) WITH REDEFINES OF
      *         CDSCAN-??-KEY (NEW).
      * BAH 160425 FOUND BUG WHILE DUAL LOAN TESTING, WAS MOVING 0 TO
      *            IO-FG IN VERIFY-PROCEEDS FROM PR#4885 WHICH CAUSED
      *            THE VERIFY-REQ-FLDS TO NOT STOP YOU, ONLY DISPLAY
      *            THE ERROR MESSAGE. SUPPORT/REGMGM PR#5060
      * BAH 160509 ADDED SP-SCFRMLA 58, WORLD PR#1154
      *  CS 160805 CHANGED SCSCAN-KEY TO SCSCAN-SP1-KEY
      *  CS 170217 CHANGED W-ACCOUNT FROM9(6) TO 9(8), REMOVED SEQUENCE
      *            THE RENEWAL ACCOUNT NUMBER WAS BEING TRUNCATED
      *
      * KEC 2017.0227 {PR#00000} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED PROCEEDS-LOW, PROCEEDS-HIGH, POINTS-LOW,
      *          POINTS-HIGH TO MATCH SIZE OF SP-EDT-AMT 9(7)V99.
      * BAH 170419 ACTIVATE 8 DIGIT DATES, PD0006
      * BAH 171127 TEST BR-ADD-INS-FEECODE FOR AD&D INSURANCE IN "GA"
      *            WHEN ENTERING THIS FEECODE, A WINDOW COMES UP FOR THEM
      *            TO ENTER THE COVERAGE, WHICH IS STORED IN AD-D-INS-COVR
      *            DO NOT ALLOW > 50000, WORLD PR#1287
      * BAH 171228 OPERATIONS WANTS ALL BRANCHES TO HAVE ABILITY TO ADJUST PP
      *            INSURANCE WHEN BUILDING A LOAN, NOT JUST "GA", WORLD #1292
      * BAH 181011 ADDED TXSCHG-CLASS FOR SCFRMLA 58, WAS NOT TESTING
      *            CLASS, #1341
      * BAH 190128 SPLIT CDFILE
      * BAH 2019.0529 ADDED SP-SCFRMLA 59 KY HB225 WORLD PR#1374
      * BAH 20190625 REMOVED LC-REVOLVING, PT#0153
      * BAH 20190716 SAVE QUOTE, PULL UP AGAIN, SAVE AGAIN, WOULD NOT BE
      *              IN QUOTE SCAN ANYMORE! NEEDED TO SAVE PD2-BWNAME IN
      *              SAVE-BW-NAME FROM A FLDVAL IN A15. QA0049
      * BAH 20190716 INSURANCE EXPIRATION DATE WAS USING VDU-DATE-YYYYMMDD
      *              BUT IT WASNT USING THE SCREENIO DATE FORMAT, CONVERT
      *              THE DATE AND DO IT LIKE XONPC0 IS DOING! QA0052
      * BAH 20190924 ALLOW "MS" TO ADJUST OTHER 1 INSURANCE AND NOT
      *              REQUIRE A PASSWORD (OPT 12), PR#1390
      * BAH 20201207 CHANGE VIA-QUOTE-SCAN, DONT MOVE IN THE PDSCAN-NAME,
      *              YOU HIT END OF FILE WHEN ONLY 1 QUOTE IN THE PDFILE.
      *              MOVE SPACES TO PD2-BWNAME AND ADD A CHECK OF THE
      *              PD2-BWNAME MATCHES THE PDSCAN-BWNAME OR GO GET NEXT.
      * BAH 20210713 PASSWORD FIELD 29, OTHER 2 INSURANCE #1504
      * BAH 20221205 DONT ALLOW "TM" TO BE ENTERED AS A VALID FEECODE, THIS
      *              IS UNITED MOTOR CLUB SALES TAX #1582
      * BAH 20230314 FIXED CHECK ON ALL SP-EDT-NOEDITS CINDY FOUND
      * BAH 20230623 OF THE 4 AUTO COLLATERAL CODES THAT WORLD USES, ONLY "AU"
      *              AND "WA" ARE ALLOWED IN "IL". EXCEPT CLASS 8 CAN HAVE ANY.
      *              CLASS 5, SUB 10 MUST HAVE "AU" OR "WA" ONLY #1614
      * BAH 2024.0401 REMOVED CASCHG-YEARTYPE, CASCHG-ERRCD
      * BAH 2024.0415 REMOVED CDBSCN-GC-FEE-GIFTNET-ISO
      * BAH 2024.0416 REMOVED LNQUOT-GIFTNET-FG
      * BAH 20241010 ADDED SP-SCFRMLA 63 "WI" #1682 S35Q-141
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. 3B.
       OBJECT-COMPUTER. 3B.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
       COPY "LIBLP/LPFSWK.CPY".
       I-O-CONTROL.
       DATA DIVISION.
       FILE SECTION.

       COPY "LIBLP/LPFDWK.CPY".

       WORKING-STORAGE SECTION.
       77  SCCS-IDENTIFIER PIC X(37) VALUE
           "@(#)WI/LNQUOT S35 04/08/25-15:20:06 >".
      *       F I L E   I F N          *
      **********************************
       COPY "LIBGB/GB01BR.CPY".
       COPY "LIBGB/GB01BR_SQL.CPY".
       COPY "LIBGB/GBWSBR.CPY".
       COPY "LIBGB/GB01GB.CPY".
       COPY "LIBGB/GB01GB_SQL.CPY".
       COPY "LIBGB/GBWSGB.CPY".
       COPY "LIBLP/LP01DL.CPY".
       COPY "LIBLP/LP01DL_SQL.CPY".
       COPY "LIBLP/LPWSDL.CPY".
       COPY "LIBLP/LP01CL.CPY".
       COPY "LIBLP/LP01CL_SQL.CPY".
       COPY "LIBLP/LPWSCL.CPY".
       COPY "LIBLP/LP01LC.CPY".
       COPY "LIBLP/LP01LC_SQL.CPY".
       COPY "LIBLP/LPWSLC.CPY".
       COPY "LIBLP/LP01SP.CPY".
       COPY "LIBLP/LP01SPA.CPY".
       COPY "LIBLP/LP01SPB.CPY".
       COPY "LIBLP/LP01SPC.CPY".
       COPY "LIBLP/LP01SP_SQL.CPY".
       COPY "LIBLP/LPWSSP.CPY".
       COPY "LIBLP/LP01BW.CPY".
       COPY "LIBLP/LP01BW_SQL.CPY".
       COPY "LIBLP/LPWSBW.CPY".
       COPY "LIBLP/LP01CD.CPY".
       COPY "LIBLP/LP01CD_SQL.CPY".
       COPY "LIBLP/LPWSCD.CPY".
       COPY "LIBLP/LP01CDB.CPY".
       COPY "LIBLP/LP01CDB_SQL.CPY".
       COPY "LIBLP/LPWSCDB.CPY".
       COPY "LIBLP/LP01IC.CPY".
       COPY "LIBLP/LP01IC_SQL.CPY".
       COPY "LIBLP/LPWSIC.CPY".
       COPY "LIBLP/LP01PD.CPY".
       COPY "LIBLP/LP01PD_SQL.CPY".
       COPY "LIBLP/LPWSPD.CPY".
       COPY "LIBGL/GL01GI.CPY".
       COPY "LIBGL/GL01GI_SQL.CPY".
       COPY "LIBGL/GLWSGI.CPY".
       01  WK-IFN          PIC X(2) VALUE "WK".

       01  WK-KEY          PIC 99.

       01  ONE             PIC S9.
       01  ELE             PIC 9(6) COMP.
       01  CL-ELE          PIC 99 VALUE 25.
       01  AH-ELE          PIC 99 VALUE 26.
       01  PP-ELE          PIC 99 VALUE 27.
       01  O1-ELE          PIC 99 VALUE 28.
       01  O2-ELE          PIC 99 VALUE 29.
       01  O3-ELE          PIC 99 VALUE 30.
       01  FEECODE-TABLE   VALUE " ".
           03  FEECODE     OCCURS 4 TIMES
                           PIC XX.
       01  CDCODE-FEE-FG   PIC 9.
       01  TEST-COLLCD     PIC XX.
           88  AUTO-COLLCD VALUE "AU" "AC" "AL" "RP" "HP" "AW"
                                      "MU" "MV" "AP" "WA" "WB".
       01  ACTION.
           03  CHKEY       PIC X(4).
           03  CHNO        PIC 9(2).
       01  ANTIC           PIC S9(6)V99 COMP.
       01  IO-TYPE         PIC X(3).
       01  NEW-FLAG        PIC 9.
       01  FIRST-TIME      PIC 9     VALUE 0.
       01  FIRST-ELE       PIC 99    VALUE 0.
       01  ALLOW-NON-CANS     PIC X         VALUE "N".
       01  OVERRIDES-OK       PIC X         VALUE "N".
       01  APR-OK             PIC X         VALUE "N".
       01  HOLD-PRIOR-PO-TRCD PIC XX        VALUE " ".

       01  HOLD-VDUSTATUS                       PIC X(02)  VALUE "00".
       01  LNQUOT-WINDOW-HANDLE  PIC X(10).

       01  ROAD-SUB             PIC 99.
       01  ROAD-GARD-ERRCD      PIC 9.
       01  ROAD-GARD            PIC S9(7)V99 COMP-3 VALUE 0.
       01  ROAD-GARD-TAX        PIC S9(7)V99 COMP-3 VALUE 0.

       01  WS-TN-ERRCD      PIC 9.
       01  WS-TN-LOOPCOUNT  PIC 99.
       01  WS-TN-FEEWORKER  PIC S9(5)V99.
       01  WS-TN-FINAMT     PIC S9(9)V99.
       01  WS-TN-MAXAMT     PIC S9(9)V99.
       01  WS-TN-POINTSFEES PIC S9(9)V99.

       01 LOAN-CALCULATOR-CALLED-FG    PIC X       VALUE " ".

      *    ----------------------------------------------------
      *    SINCE QUOTERS DON'T HAVE BORROWERS THESE WORKERS WILL
      *    BE PASSED TO CALCZL/CALCZ3, '   ' == NO CODE
      *    ----------------------------------------------------
       01  STATE                      PIC X(2)   VALUE " ".
       01  CITY-TAX-CD                PIC X(3)   VALUE " ".
       01  COUNTY                     PIC X(3)   VALUE " ".
      *    ----------------------------------------------------

       01  CAN-LOAN-NO        PIC XX    VALUE " ".
       01  SAVE-SSNO          PIC 9(10) COMP.
       01  SAVE-MAINTFEE      PIC 9(6)V99 COMP.
       01  GA-SCHG-PATH.
           03  FILLER         PIC X(7)     VALUE "CL/GASC".
           03  GA-SCHG-NO     PIC 99.
       01  SC-SCHG-PATH.
           03  FILLER         PIC X(7)     VALUE "CL/SCSC".
           03  SC-SCHG-NO     PIC 99.
       01  MSEL-LIST              PIC X(5) VALUE "MSEL.".
       01  INITIAL-CAN-ENTRY-FG   PIC X.
       01  HOLD-PD-RECORD         PIC X(PD-SIZE) VALUE SPACES.
       01  ADV-TO-1ST-NO-CORR     PIC X       VALUE " ".

       01  WSEL-LIST       PIC X(5)    VALUE "WSEL.".
       01  SUB             PIC 9(6) COMP.
       01  OVER-20         PIC 99.
       01  I-LEVEL         PIC 9(6) COMP.

       01  INSPECT-W       PIC X(86).
       01  INSPECT-X      REDEFINES INSPECT-W.
           03  INSPECT-Z   OCCURS 86
                           PIC X.

       01  ADD-ON          PIC X(25).
       01  SAVE-BW-NAME    PIC X(33) VALUE SPACES.
       01  DEFAULT-APR-FG  PIC X.
       01  F3-COLLATERAL   PIC X        VALUE " ".
           88  F3-YES                   VALUE "Y".
       01  BORR-CHG-FG     PIC X        VALUE " ".
       01  QUOTE-ID-FG     PIC X        VALUE " ".
           88  QUOTE-ONLY               VALUE "Q".
           88  QUOTE-CHANGED-TO-LOAN    VALUE "L".
       01  PRIOR-LOAN-STAT PIC X.
           88  ERROR-IN-PRIOR-LOAN      VALUE "E".
       01  LEGEND-01-NO-CAN.
           03  FILLER      PIC X(30)  VALUE
           "F1, F7-EXIT, F4-QUOTE SCAN:".
       01  LEGEND-01-CAN-ONLY.
           03  FILLER      PIC X(31)  VALUE
           "F7-EXIT, F2-CANNED LNS, F4-QUOT".
           03  FILLER      PIC X(33)  VALUE
           "ES, ENTER 2 CHAR CANNED LOAN NO:".
       01  LEGEND-02.
           03  FILLER      PIC X(36)  VALUE
           "F7-EXIT, F1-NEW, F2-CANNED LOAN SCAN".
           03  FILLER      PIC X(31)  VALUE
           ", ENTER 2 CHAR CANNED LOAN NO:".
       01  LEGEND-03.
           03  FILLER      PIC X(31)  VALUE
           "F7, F1, F4-QUOTE SCAN, F2-CANNE".
           03  FILLER      PIC X(34)  VALUE
           "D LNS, ENTER 2 CHAR CANNED LOAN#:".
       01  LEGEND                     PIC X(70).

       01  WS-MESSAGES.
           03  MESSAGE-INVALID-SPR-CAN-LOAN.
               05  FILLER PIC X(25) VALUE "INVALID: STATE PARA. DOES".
               05  FILLER PIC X(25) VALUE " NOT ALLOW CAN LOANS!    ".

           03  MESSAGE-INVALID-SPR-CL.
               05  FILLER PIC X(25) VALUE "INVALID SUB CLASS NUMBER:".
               05  FILLER PIC X(25) VALUE " FOR CAN LOANS ONLY!     ".

           03  MESSAGE-INVALID-SPR-NON-CL.
               05  FILLER PIC X(25) VALUE "INVALID SUB CLASS NUMBER:".
               05  FILLER PIC X(25) VALUE " FOR NON CAN LOANS ONLY! ".

       01  ALP-BW.
           03  ALP-BW123   PIC X(3).
           03  ALP-HYPHEN1 PIC X.
           03  ALP-BW45    PIC X(2).
           03  ALP-HYPHEN2 PIC X.
           03  ALP-BW6789  PIC X(4).
       01  NUM-BW          PIC 9(9).
       01  NUM-BWX        REDEFINES NUM-BW.
           03  NUM-BW123   PIC X(3).
           03  NUM-BW45    PIC X(2).
           03  NUM-BW6789  PIC X(4).

       01  W-LNNO          PIC 9(8).

      *=================================================================
      *
      *    R E S C I S S I O N - W O R K E R S
      *
      *=================================================================
       01  RESCISSION-BUF                  PIC X(15) VALUE SPACES.
       01  RESCISSION-FLAG                 PIC X(01) VALUE SPACES.
       01  RESCISSION-INTDATE              PIC 9(08) VALUE ZEROES.
       01  RESCISSION-LIST                 PIC X(05) VALUE "R1:R.".
       01  RESCISSION-MESSAGE              PIC X(15)
                                               VALUE " * RESCISSION *".

       01  RESCISSION-POCD                 PIC X(02) VALUE SPACES.
           88  RESCISSION-POCD-INRESCISSION          VALUE "*I".

       01  RESCISSION-SECURED-COLLCD       PIC X(01) VALUE SPACES.
           88  RESCISSION-SECURED-COLLCD-YES         VALUE "R".

       01  RESCISSION-STATUS               PIC X(01) VALUE SPACES.
           88  RESCISSION-STATUS-BAD                 VALUE "X".
           88  RESCISSION-STATUS-GOOD                VALUE SPACES.

      ********************************
      *   S C R E E N   B U F F E R  *
      ********************************
       01  DISPLAY-BUF1        VALUE " ".
           03  D-LCNO          PIC Z9.
           03  D-LC-DESC       PIC X(16).
           03  D-010-040       OCCURS 4.
               05  D-010       PIC X(11).
               05  D-011       PIC X(33).
               05  D-012       PIC X(1).
           03  D-LOANAMT       PIC Z(6)9.99  BLANK ZERO.
           03  D-ANTIC         PIC Z(6)9.99  BLANK ZERO.
           03  D-050           PIC XX.
           03  D-051           PIC 9(4)      BLANK ZERO.
           03  D-052           PIC Z9.
           03  D-053           PIC X(13).
           03  D-060           PIC 99/99/99  BLANK ZERO.
           03  D-061           PIC 99/99/99  BLANK ZERO.
           03  D-062           PIC 99/99/99  BLANK ZERO.
           03  D-070           PIC 99/99/99  BLANK ZERO.
           03  D-071           PIC ZZZ.
           03  D-080           PIC X(3).
           03  D-081           PIC X(15).
           03  D-090           PIC X(2).
           03  D-091           PIC X(15).
           03  D-100           PIC X(2).
           03  D-101           PIC X(15).
           03  D-110           PIC 9(6)      BLANK ZERO.
           03  D-111           PIC Z(5)9.99  BLANK ZERO.
           03  D-120           PIC Z(5)9.99  BLANK ZERO.
           03  D-121           PIC X.
           03  D-130           PIC X(3).
           03  D-131           PIC Z9.99     BLANK ZERO.
           03  D-132           PIC X.
           03  D-FEES-140-180.
               05  D-140-180       OCCURS 5.
                   07  D-1FEECD    PIC XX.
                   07  D-1FEEAMT   PIC Z(3)9.99  BLANK ZERO.
                   07  D-2FEECD    PIC XX.
                   07  D-2FEEAMT   PIC Z(3)9.99  BLANK ZERO.
           03  D-190           PIC 9(4).99   BLANK ZERO.
           03  D-191           PIC X(15).

       01  DISPLAY-BUF2       REDEFINES DISPLAY-BUF1.
           03  D-200           PIC X(20).
           03  D-201           PIC X(20).
           03  D-202           PIC X(20).
           03  D-210           PIC ZZ9.999   BLANK ZERO.
           03  D-211           PIC X.
           03  D-220           PIC ZZ9.999   BLANK ZERO.
           03  D-230           PIC ZZ9.999   BLANK ZERO.
           03  D-240           PIC ZZ9.999   BLANK ZERO.
           03  D-250-280       OCCURS 4.
               05  D-1COMP     PIC 99        BLANK ZERO.
               05  D-1OUR      PIC X.
               05  D-1TERM     PIC ZZ9       BLANK ZERO.
               05  D-1COVR     PIC Z(5)9.99  BLANK ZERO.
               05  D-1PREM     PIC Z(3)9.99  BLANK ZERO.
               05  D-INS-FG    PIC X.
           03  D-290-300       OCCURS 2.
               05  D-2COMP     PIC 99        BLANK ZERO.
               05  D-2OUR      PIC X.
               05  D-2EXP      PIC 9(6)      BLANK ZERO.
               05  D-2TERM  REDEFINES D-2EXP
                               PIC Z(6)      BLANK ZERO.
               05  D-2COVR     PIC Z(5)9.99  BLANK ZERO.
               05  D-2PREM     PIC Z(3)9.99  BLANK ZERO.
           03  D-310           PIC Z(5)9.99  BLANK ZERO.
           03  D-311           PIC X.
           03  D-320           PIC Z(5)9.99  BLANK ZERO.
           03  D-321           PIC X.
           03  D-330           PIC Z(5)9.99  BLANK ZERO.
           03  D-331           PIC X.
           03  D-340           PIC Z(6)9.99  BLANK ZERO.
           03  D-350           PIC Z(6)9.99  BLANK ZERO.
           03  D-360           PIC Z(6)9.99  BLANK ZERO.
           03  D-370           PIC Z(5)9.99  BLANK ZERO.
           03  D-380           PIC Z(5)9.99  BLANK ZERO.
           03  D-381           PIC X.
           03  FILLER          PIC X(217).

       01  DEF-BUF            REDEFINES DISPLAY-BUF1.
           03  DEF-ORGST       PIC XX.
           03  DEF-ORGBR       PIC 9(4).
           03  DEF-LOANDATE    PIC 99/99/99.
           03  FILLER          PIC X(462).

       01  DF2-BUF            REDEFINES DISPLAY-BUF1.
           03  DF2-PROCEEDS          PIC Z(5)9.99  BLANK ZERO.
           03  DF2-PROCEEDS-FG       PIC X.
           03  DF2-POINTS            PIC Z9.99     BLANK ZERO.
           03  DF2-POINTS-FG         PIC X.
           03  DF2-OVRDRATE          PIC ZZ9.999   BLANK ZERO.
           03  DF2-OVRDRATE-FG       PIC X.
           03  DF2-EFFRATE           PIC ZZ9.999   BLANK ZERO.
           03  DF2-APRATE            PIC ZZ9.999   BLANK ZERO.
           03  DF2-ENDORATE          PIC ZZ9.999   BLANK ZERO.
           03  DF2-LNAMT             PIC Z(6)9.99  BLANK ZERO.
           03  DF2-ANTICIPATED       PIC Z(6)9.99  BLANK ZERO.
           03  DF2-INS-INFO          OCCURS 4.
               05  DF2-INSCOMP       PIC 99        BLANK ZERO.
               05  DF2-INSOURS       PIC X.
               05  DF2-INSTERM       PIC ZZ9       BLANK ZERO.
               05  DF2-INSCOVR       PIC Z(5)9.99  BLANK ZERO.
               05  DF2-INSPREM       PIC Z(3)9.99  BLANK ZERO.
               05  DF2-INS-FG        PIC X.
           03  DF2-SERCHG            PIC Z(5)9.99  BLANK ZERO.
           03  DF2-SERCHG-FG         PIC X.
           03  DF2-MAINTFEE          PIC Z(5)9.99  BLANK ZERO.
           03  DF2-MAINTFEE-FG       PIC X.
           03  DF2-EXTCHG            PIC Z(5)9.99  BLANK ZERO.
           03  DF2-EXTCHG-FG         PIC X.
           03  DF2-INTCHG            PIC Z(6)9.99  BLANK ZERO.
           03  DF2-APR-FINAMT        PIC Z(6)9.99  BLANK ZERO.
           03  DF2-TREPAY            PIC Z(6)9.99  BLANK ZERO.
           03  DF2-1STPYAMT          PIC Z(5)9.99  BLANK ZERO.
           03  DF2-REGPYAMT          PIC Z(5)9.99  BLANK ZERO.
           03  DF2-REGPYAMT-FG       PIC X.
           03  DF2-RETURN-CODE       PIC X.
           03  DF2-LOOP-COUNT        PIC Z(3).

       01  DEF-LIST            PIC X(12) VALUE
           "050 051 060.".

       01  D-FEES-140-180-LIST.
           03  FILLER          PIC X(56)  VALUE
           "140 141 142 143 150 151 152 153 160 161 162 163 170 ".
           03  FILLER          PIC X(28)  VALUE
           "171 172 173 180 181 182 183.".
       01  DISPLAY-LIST1.
           03  FILLER          PIC X(53)  VALUE
           "LNKEY LCDESC 010 011 012 020 021 022 030 031 032 040 ".
           03  FILLER          PIC X(54)  VALUE
           "041 042 LOANAMT ANTIC 050 051 052 053 060 061 062 070 ".
           03  FILLER          PIC X(12)  VALUE
           "071 080 081 ".
           03  FILLER          PIC X(56)  VALUE
           "090 091 100 101 110 111 120 121 130 131 132 140 141 142 ".
           03  FILLER          PIC X(56)  VALUE
           "143 150 151 152 153 160 161 162 163 170 171 172 173 180 ".
           03  FILLER          PIC X(20)  VALUE
           "181 182 183 190 191.".
       01  DISPLAY-LIST2.
           03  FILLER          PIC X(52)  VALUE
           "200 201 202 210 211 220 230 240 250 251 252 253 254 ".
           03  FILLER          PIC X(56)  VALUE
           "255 260 261 262 263 264 265 270 271 272 273 274 275 280 ".
           03  FILLER          PIC X(56)  VALUE
           "281 282 283 284 285 290 291 292 293 294 300 301 302 303 ".
           03  FILLER          PIC X(52)  VALUE
           "304 310 311 320 321 330 331 340 350 360 370 380 381.".

       01  DF2-LIST.
           03  FILLER          PIC X(50)  VALUE
           "120 121 131 132 210 211 220 230 240 LOANAMT ANTIC ".
           03  FILLER          PIC X(8)   VALUE
           "250 251 ".
           03  FILLER          PIC X(56)  VALUE
           "252 253 254 255 260 261 262 263 264 265 270 271 272 273 ".
           03  FILLER          PIC X(56)  VALUE
           "274 275 280 281 282 283 284 285 310 311 320 321 330 331 ".
           03  FILLER          PIC X(32)  VALUE
           "340 350 360 370 380 381 390 400.".

       01  PROMPT-FG      PIC X      VALUE " ".
       01  PROMPT-BUF.
           03  FILLER     PIC X(12)  VALUE "LOAN AMOUNT:".
           03  FILLER     PIC X(12)  VALUE "ANTIC. EARN:".
           03  FILLER     PIC X(31)  VALUE
               "CO O EX/TRM  COVERAGE PREMIUM  ".
           03  FILLER     PIC X(27)  VALUE
               "---OUTPUT------------------".
           03  FILLER     PIC X(16)  VALUE "20 COLLATERAL ID".
           03  FILLER     PIC X(6)   VALUE "25 CL:".
           03  FILLER     PIC X(6)   VALUE "26 AH:".
           03  FILLER     PIC X(6)   VALUE "27 PP:".
           03  FILLER     PIC X(6)   VALUE "28 O1:".
           03  FILLER     PIC X(6)   VALUE "29 O2:".
           03  FILLER     PIC X(6)   VALUE "30 O3:".
           03  FILLER     PIC X(15)  VALUE "31 SERVICE CHG:".
           03  FILLER     PIC X(15)  VALUE "32 MAINT FEES :".
           03  FILLER     PIC X(15)  VALUE "33 1ST PY EXT :".
           03  FILLER     PIC X(15)  VALUE "   INT CHARGE :".
           03  FILLER     PIC X(15)  VALUE "   AMT FINANCD:".
           03  FILLER     PIC X(15)  VALUE "   TOT REPYBLE:".
           03  FILLER     PIC X(15)  VALUE "   ODD 1ST PMT:".
           03  FILLER     PIC X(15)  VALUE "38 REG PAYMENT:".
           03  FILLER     PIC X(17)  VALUE "-----RATES-----  ".
           03  FILLER     PIC X(7)   VALUE "21 OVR:".
           03  FILLER     PIC X(7)   VALUE "22 EFF:".
           03  FILLER     PIC X(7)   VALUE "23 APR:".
           03  FILLER     PIC X(7)   VALUE "24 END:".

       01  PROMPT-LIST.
           03  FILLER          PIC X(49)  VALUE
             "PLOANAMT:S PANTIC:S INSPROMPT:S OUTPROMPT P200:S ".
           03  FILLER          PIC X(7)   VALUE
             "P250:S ".
           03  FILLER          PIC X(49)  VALUE
             "P260:S P270:S P280:S P290:S P300:S P310:S P320:S ".
           03  FILLER          PIC X(42)  VALUE
             "P330:S P340:S P350:S P360:S P370:S P380:S ".
           03  FILLER          PIC X(37)  VALUE
             "PRATES:S P210:S P220:S P230:S P240:S.".

      ********************************
      *   E L E M E N T   S P E C S  *
      ********************************
       01  MAX             PIC 99   VALUE 38.
       01  SPEC-TABLE.
      * 1  PD-SSNO(1)
           03  FILLER      PIC X(8) VALUE "E  A110 ".
      * 2  PD-SSNO(2)
           03  FILLER      PIC X(8) VALUE "E  A110 ".
      * 3  PD-SSNO(3)
           03  FILLER      PIC X(8) VALUE "E  A110 ".
      * 4  PD-SSNO(4)
           03  FILLER      PIC X(8) VALUE "E  A110 ".
      * 5  PD-ORGST
           03  FILLER      PIC X(8) VALUE "E  A020 ".
      * 6  PD-LOANDATE
           03  FILLER      PIC X(8) VALUE "ERNM060 ".
      * 7  PD-1STPYDATE
           03  FILLER      PIC X(8) VALUE "ERNM060 ".
      * 8  PD-PURCD
           03  FILLER      PIC X(8) VALUE "E  A030 ".
      * 9  PD-COLLCD
           03  FILLER      PIC X(8) VALUE "E  A030 ".
      * 10 PD-SRCD
           03  FILLER      PIC X(8) VALUE "E  A030 ".
      * 11 PD-PRLNNO
           03  FILLER      PIC X(8) VALUE "ENNN060 ".
      * 12 PD-PROCEEDS
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 13 PD-INSURED
           03  FILLER      PIC X(8) VALUE "E  A030 ".
      * 14  PD-FEECODE(1), (2)
           03  FILLER      PIC X(8) VALUE "E  A020 ".
      * 15  PD-FEECODE(3), (4)
           03  FILLER      PIC X(8) VALUE "E  A020 ".
      * 16 PD-FEECODE(5), (6)
           03  FILLER      PIC X(8) VALUE "E  A020 ".
      * 17 PD-FEECODE(7), (8)
           03  FILLER      PIC X(8) VALUE "E  A020 ".
      * 18 PD-FEECODE(9), (10)
           03  FILLER      PIC X(8) VALUE "E  A020 ".
      * 19 PD-DLNO
           03  FILLER      PIC X(8) VALUE "ENNN042 ".
      * 20 PD-COLLID
           03  FILLER      PIC X(8) VALUE "E  A200 ".
      * 21 PD-OVRDRATE
           03  FILLER      PIC X(8) VALUE "ENNN033 ".
      * 22 PD-EFFRATE
           03  FILLER      PIC X(8) VALUE "ENNN033 ".
      * 23 PD-APRATE
           03  FILLER      PIC X(8) VALUE "ENNN033 ".
      * 24 PD-ENDORATE
           03  FILLER      PIC X(8) VALUE "ENNN033 ".
      * 25 PD-INSCOMP(1)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 26 PD-INSCOMP(2)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 27 PD-INSCOMP(3)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 28 PD-INSCOMP(4)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 29 PD-INSCOMP(5)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 30 PD-INSCOMP(6)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 31 PD-SERCHG
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 32 PD-MAINTFEE
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 33 PD-EXTCHG
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 34 PD-INTCHG
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 35 PD-FINAMT
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 36 PD-LNAMT
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 37 PD-1STPYAMT
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 38 PD-REGPYAMT
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
       01  SPEC-TABLE2    REDEFINES SPEC-TABLE.
           03  SPEC-REC    OCCURS 38 TIMES.
               05  SPEC    PIC X(7).
               05  CHFG    PIC X.

       01  DATE-STAT       PIC X.
       01  PRIOR-LNAMT     PIC S9(7)V99 COMP.
       01  COUNTER         PIC 99.
       01  COMPARE-TO-HOLDERS.
           03  PROCEEDS-HLDR         PIC S9(9)V99 COMP.
           03  AMT-HOLDER            PIC S9(9)V99 COMP.
           03  MAINTFEE-HLDR         PIC S9(6)V99 COMP.
           03  TOTAL-GL-HLDR         PIC S9(5)V99 COMP.
           03  TOTAL-GL-FINCHG-HLDR  PIC S9(5)V99 COMP.
           03  INSPREM-HLDR          PIC S9(4)V99 COMP.
           03  INSTERM-HLDR          PIC 9(3)     COMP.
           03  INSOURS-HLDR          PIC X.
           03  CALC-FG-HLDR          PIC X.
           03  INSCODES-HLDR         PIC X.
           03  INSCOMP-HLDR          PIC 99       COMP.

       01  HOLD-AMT-EXCEEDED    PIC Z(9).99.
       01  HOLD-TERM-EXCEEDED  REDEFINES HOLD-AMT-EXCEEDED
                                PIC Z(11)9.
       01  HOLD-RATE-EXCEEDED  REDEFINES HOLD-AMT-EXCEEDED
                                PIC Z(4).9999.
       01  AMT-EXCEEDED-LIT    REDEFINES HOLD-AMT-EXCEEDED
                                PIC X(12).

       01  TYPE-OF-AMT-EXCEEDED PIC X(15).

       01  HOLD-DATE-YYYYMMDD   PIC 9(8).
       01  SAVE-QUOTE-SSN       PIC 9(10)  COMP.
       01  SCREEN-LINES.
           03  SCREEN-LINE1     PIC X(20).
           03  SCREEN-LINE2     PIC X(20).
           03  SCREEN-LINE3     PIC X(20).
       01  MSG-LINES           REDEFINES SCREEN-LINES.
           03  MSG-LINE1        PIC X(30).
           03  MSG-LINE2        PIC X(30).
       01  SAVE-PD2-KEY.
           03  SAVE-PD2-KEY-ID  PIC X.
           03  SAVE-PD2-KEY-BR  PIC 9(4).
           03  SAVE-PD2-KEY-NAM PIC X(33).

       01  PASSX-CURRENT-PD-CLASS      PIC 9(3).

       01  HOLD-BWNAME      PIC X(33).
       01  TERM-LOW             PIC 9(3)    COMP.
       01  TERM-HIGH            PIC 9(3)    COMP.
       01  PROCEEDS-LOW         PIC 9(7)V99 COMP.
       01  PROCEEDS-HIGH        PIC 9(7)V99 COMP.
       01  POINTS-LOW           PIC 9(7)V99 COMP.
       01  POINTS-HIGH          PIC 9(7)V99 COMP.
       01  ERRCD                PIC X.
       01  LOAN-QUOTE-FG        PIC X.

       01  TRANS-DATE-YYYYMMDD    PIC 9(8).

       01  LNQUOT-LINES              PIC 99   VALUE 26.
       01  LNQUOT-COLUMNS            PIC 99   VALUE 82.
       01  LNQUOT-BEGIN-Y            PIC 99   VALUE 1.
       01  LNQUOT-BEGIN-X            PIC 99   VALUE 1.

       COPY "LIBCL/CASCHGW.CPY".
       COPY "LIBCL/NCSCHGW.CPY".
       COPY "LIBCL/GASCHGW.CPY".
       COPY "LIBCL/SCSCHGW.CPY".
       COPY "LIBCL/TXSCHGW.CPY".
       COPY "LIBCL/WISCHGW.CPY".
       COPY "LIBCL/MFEE04W.CPY".
       COPY "LIBLP/PAYOFXW.CPY".
       COPY "LIBGB/SYSTEMW.CPY".
       COPY "LIBGB/CONNECTW_SQL.CPY".
       COPY "LIBGB/FILEWK.CPY".
       COPY "LIBGB/MESSWK.CPY".
       COPY "LIBGB/HASHW.CPY".
       COPY "LIBGB/GPENVW.CPY".
       COPY "LIBGB/DATERW.CPY".
       COPY "LIBGB/TIMEWK.CPY".
       COPY "LIBLP/LPANTIW.CPY".
       COPY "LIBLP/LPWKCIPL.CPY".
       COPY "LIBLP/LPWKCEPL.CPY".
       COPY "LIBLP/LPWKCOPL.CPY".
       COPY "LIBLP/LPAMTSW.CPY".
       COPY "LIBLP/LPSPEDW.CPY".
       COPY "LIBLP/LPAPRZW.CPY".
       COPY "LIBLP/LPUPERW.CPY".
       COPY "LIBLP/LPBAGEW.CPY".
       COPY "LIBLP/RESCINDW.CPY".
       COPY "LIBGB/ACCESSW.CPY".
       COPY "LIBWI/SCHG33W.CPY".
       COPY "LIBWI/DLSCANW.CPY".
       COPY "LIBWI/BWLNSCW.CPY".
       COPY "LIBWI/ICSCANW.CPY".
       COPY "LIBWI/LCSCANW.CPY".
       COPY "LIBWI/PDSCANW.CPY".
       COPY "LIBWI/SCSCANW.CPY".
       COPY "LIBWI/CLSCANW.CPY".
       COPY "LIBWI/BWSCANW.CPY".
       COPY "LIBWI/CDSCANW.CPY".
       COPY "LIBWI/CDBSCNW.CPY".
       01  WINDOW-WORKERS.
           03  WINDOW-LPO          PIC X(4).
           03  WINDOW-REP          PIC X(8).
           03  WINDOW-PROCESS      PIC X(1).
       COPY "LIBWI/W12EQ2W.CPY".

       COPY "LIBWI/PFSWINDOWSW.CPY".

       COPY "LIBGB/PASSWDW.CPY".
       78  CAN-SEQ              VALUE 00.
       78  1STPY30-SEQ          VALUE 01.
       78  APPROVAL-SEQ         VALUE 02.
       78  APR-SEQ              VALUE 03.
       78  OVER-SEQ             VALUE 04.
       78  INSCO-SEQ            VALUE 06.
       78  INSCOVR-SEQ          VALUE 07.
      *  PASSWORD SPECIFIC CLASS RENEWALS FOR REGENCY
       78  C-OR-E-SEQ           VALUE 8.
       78  CL-OR-AH-SEQ         VALUE 9.
       78  CL-AH-PP-O1-SEQ      VALUE 12.
       78  RENEWAL-SEQ          VALUE 17.
       78  LOAN-INT-DATE        VALUE 18.
       78  ALLOW-ZERO-PROC-SEQ  VALUE 19.
       78  SRCD-SEQ             VALUE 20.
       78  PP-PREM-SEQ          VALUE 21.
       78  INSTERM-SEQ          VALUE 22.
      * SKIPPED SEVERAL TO MATCH XONPC0
       78  O2-SEQ               VALUE 27.

       COPY "LIBLP/INSELIGW.CPY".
       COPY "LIBGB/GETENVW.CPY".
       COPY "LIBGB/CONAME_EXT.CPY".
       COPY "LIBGB/SCREENW.CPY".
       COPY "LIBWI/LNQUOT_DEF.CPY".
       COPY "LIBWI/ADDINS_DEF.CPY".
       COPY "LIBWI/LNQUOT_WKS.CPY".
       COPY "LIBWI/ADDINS_WKS.CPY".
       COPY "LIBGB/HELPLINK.CPY".

       COPY "LIBGB/GETFMW.CPY".
       COPY "LIBWI/LNQUOTW.CPY".

       SCREEN SECTION.
       COPY "LIBWI/LNQUOT_SCN.CPY".
       COPY "LIBWI/ADDINS_SCN.CPY".

       PROCEDURE DIVISION
           USING FORM-PATHNAME LNQUOT-BUF EXIT-PATHNAME.
       DECLARATIVES.
       DECLARE-ERROR SECTION.
           USE AFTER ERROR PROCEDURE ON
               WK-FILE.
       COPY "LIBGB/DECLARE.CPY".
           PERFORM CLOSE-SP1-FILE.
           PERFORM CLOSE-PD2-FILE.
           PERFORM CLOSE-PD1-FILE.
           PERFORM CLOSE-LC1-FILE.
           PERFORM CLOSE-IC1-FILE.
           PERFORM CLOSE-DL1-FILE.
           PERFORM CLOSE-CL1-FILE.
           PERFORM CLOSE-CDB1-FILE.
           PERFORM CLOSE-CD1-FILE.
           PERFORM CLOSE-BW1-FILE.
           PERFORM CLOSE-GI1-FILE.
           PERFORM CLOSE-GB-FILE.
           PERFORM CLOSE-BR-FILE.
           CLOSE
               WK-FILE.
       COPY "LIBGB/DECLAR2.CPY".

      ***********************************
       MAIN-PROGRAM SECTION.
      ***********************************

           PERFORM SQL-CONNECT.

      D    STOP MESS.
           MOVE FORM-PATHNAME TO FORM-PATH.
           MOVE "LNQUOT" TO VDU-FORM-NAME.

           MOVE "WI/LNQUOT" TO WINDOW-FORM-NAM.

           MOVE " " TO VDU-WIMENU-SELECTION.

           DISPLAY FLOATING GRAPHICAL WINDOW
               AT  SCREEN LINE LNQUOT-BEGIN-X * VDU-WIN-L-OFFSET
               AT  SCREEN COL  LNQUOT-BEGIN-Y * VDU-WIN-C-OFFSET
               CELL SIZE IS LABEL FONT
           COLOR IS VDU-WCOLOR-TCLP,CONTROL VALUE IS VDU-WCTRL-TCLP
               SIZE    LNQUOT-COLUMNS + VDU-WIN-W-MOD
               LINES   LNQUOT-LINES + VDU-WIN-H-MOD
               BLANK SCREEN
               HANDLE IS LNQUOT-WINDOW-HANDLE.

           MOVE EXT-CONAME-USER-LOC TO BR-NO.
           PERFORM OPEN-BR-FILE.
           PERFORM READ-BR-FILE.
           PERFORM CLOSE-BR-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           PERFORM GET-GPENV.

           MOVE EXT-CONAME-SYSDATE TO ALP-DATE.
           PERFORM CONVERT-ALPDATE-TO-YYYYMMDD.
           MOVE DATE-YYYYMMDD TO TRANS-DATE-YYYYMMDD.

           MOVE " " TO ERRCD.

           MOVE "Q" TO LOAN-QUOTE-FG.

       MAIN-MODULE.
           MOVE " " TO CAN-LOAN-NO.

           PERFORM FORM-RESET.

      * CLEAR REQUIRED RE: (GA) SP-SCFRMLA = 12 OR 13 OR 54
      *                    (SC) SP-SCFRMLA = 18
           MOVE 0 TO SPDUAL-LIAB.
           MOVE " " TO HOLD-BWNAME.
           MOVE " " TO LOAN-CALCULATOR-CALLED-FG.

           IF FIRST-TIME = 0
              MOVE 1 TO FIRST-TIME
           ELSE
              MOVE " " TO MESS PROMPT-FG
              PERFORM CALL-TMMSG.

           IF LNQUOT-MAINT-FG = "R" OR "P"
              PERFORM RENEWAL-CALCULATOR
              IF IO-TYPE = "END"
                 GO TO END-ROUTINE
              ELSE
                 GO TO ENTER-LOAN.

           PERFORM ENTER-KEYS.
           IF IO-TYPE = "CLR"
              GO TO MAIN-MODULE.
           IF IO-TYPE = "END"
              GO TO END-ROUTINE.
       ENTER-LOAN.
           PERFORM ENTRY-MODULE.
           IF IO-TYPE = "END"
              GO TO END-ROUTINE.
           GO TO MAIN-MODULE.

      *************************************
       ENTER-KEYS SECTION.
      *************************************
       ENTER-KEYS-NO.
           MOVE 0 TO NEW-FLAG ELE.
           MOVE SPACES TO IO-TYPE.
           PERFORM NEW-RECORD-SETUP.

           IF BR-CAN-LOANS-FG = "Y" OR "O"
              GO TO RECALL-LOAN.

       ENTER-LC-CODE.
           PERFORM LOAN-CLASS-PROMPT.

           MOVE " " TO CAN-LOAN-NO.
           MOVE " " TO PD2-BWNAME.

           MOVE "F7, F1-RECALL, F6-CLASS SCAN, ENTER LOAN CLASS:"
                                                        TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "EN N020LNKEY." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM ALARM
              GO TO RECALL-LOAN.
           IF VDUSTATUS = "1<"
              PERFORM CLASS-SCAN
              IF IO-FG NOT = 0
                 GO TO ENTER-LC-CODE.
           IF VDUSTATUS = "1>"
              GO TO END-ROUTINE.
           IF VDUSTATUS NOT = "00"
              GO TO ENTER-LC-CODE.
           IF VDUNUM0 = 0
                  OR VDUNUM0 > 99
              GO TO ENTER-LC-CODE.

           MOVE VDUNUM0 TO LC-CODE.
           PERFORM GET-LC.
           IF IO-FG = 9
              PERFORM NOT-FOUND
              GO TO ENTER-LC-CODE.
           MOVE "S  A000LCDESC." TO VDU.
           MOVE LC-DESC TO VDUBUF.
           PERFORM SCREENIO.

           IF ( LC-SALEFIN = "Y"   )
              PERFORM NOT-DIRECT
              GO TO ENTER-LC-CODE.

           MOVE EXT-CONAME-USER-LOC TO GI-BRANCH.
           MOVE LC-CODE TO GI-CLASS.
           PERFORM OPEN-GI1-FILE.
           PERFORM READ-GI1-FILE.
           PERFORM CLOSE-GI1-FILE.
           IF IO-FG = 9
              MOVE "G/L INTERFACE RECORD NOT FOUND" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-LC-CODE.

           IF LC-GIFTNET = "Y"
              MOVE "CAN'T BE A WCBC CLASS" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-LC-CODE.

           MOVE LC-CODE TO PD-CLASS
                           PD-SPRCLASS.
           MOVE LC-SMALLOAN TO PD-SMALLOAN.
           MOVE LC-SALEFIN TO PD-SALEFIN.
           MOVE LC-SERVACCT TO PD-SERVACCT.
           MOVE LC-LOANTYPE TO PD-LOANTYPE.
           MOVE LC-GIFTNET TO PD-GIFTNET.
           MOVE 1 TO PD-STMT-COUNTER.
           GO TO EXIT-ENTER-KEYS.

      **********************
      *   RECALL ENTRY
      **********************
       RECALL-LOAN.
       RECALL-GET-KEY.
           IF BR-CAN-LOANS-FG = "O"
              MOVE LEGEND-01-CAN-ONLY TO LEGEND
           ELSE
           IF BR-CAN-LOANS-FG = "N"
              MOVE LEGEND-01-NO-CAN TO LEGEND
           ELSE
              MOVE LEGEND-03 TO LEGEND.
           PERFORM SEND-LEGEND.

           MOVE "S  A110KEYTYPE:S." TO VDU.
           IF BR-CAN-LOANS-FG = "N"
              MOVE "          :" TO VDUBUF
           ELSE
              MOVE "CAN LOAN #:" TO VDUBUF.
           PERFORM SCREENIO.

           PERFORM NEW-RECORD-SETUP.
           MOVE " " TO CAN-LOAN-NO.
           MOVE " " TO PD2-BWNAME.
           MOVE "E  A020LNKEY." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              IF BR-CAN-LOANS-FG = "Y"
                 IF ALLOW-NON-CANS NOT = "Y"
                    MOVE CAN-SEQ TO PASSWDW-SEQ
                    MOVE "TO ALLOW 'NON' CAN LOANS.....:"
                                            TO PASSWDW-PROMPT2
                    PERFORM VERIFY-PASSWORD
                    IF PASSWDW-STAT NOT = "OK"
                       GO TO RECALL-GET-KEY
                    ELSE
                       MOVE "Y" TO ALLOW-NON-CANS.
           IF VDUSTATUS = "10"
              IF BR-CAN-LOANS-FG NOT = "O"
                 PERFORM ALARM
                 MOVE "ENT" TO IO-TYPE
                 GO TO ENTER-LC-CODE.
           IF VDUSTATUS = "18"
              MOVE "Q" TO PDSCAN-ID
              PERFORM QUOTE-SCAN
              IF IO-FG NOT = 0
                 GO TO RECALL-GET-KEY
              ELSE
                 GO TO VIA-QUOTE-SCAN.
           IF VDUSTATUS = "12"
              IF BR-CAN-LOANS-FG NOT = "N"
                 PERFORM CAN-LOAN-SCAN
                 IF IO-FG NOT = 0
                    GO TO RECALL-GET-KEY
                 ELSE
                    MOVE CLSCAN-CAN-NO TO CAN-LOAN-NO
                    GO TO VIA-CAN-LOAN-SCAN.
           IF VDUSTATUS = "1>"
              GO TO END-ROUTINE.
           IF ( VDUSTATUS NOT = "00"  ) OR
              ( BR-CAN-LOANS-FG = "N" )
              GO TO RECALL-LOAN.

           MOVE VDUBUF TO CAN-LOAN-NO.
           GO TO VIA-CAN-LOAN-SCAN.

      **********************************
      *    VIA QUOTE SCAN
      **********************************
       VIA-QUOTE-SCAN.
           PERFORM NEW-RECORD-SETUP.
           MOVE " " TO PRIOR-LOAN-STAT
                       PASS-STAT-FG.

           PERFORM OPEN-PD1-FILE.

           MOVE "Q"                 TO PD2-ID     SAVE-PD2-KEY-ID.
           MOVE EXT-CONAME-USER-LOC TO PD2-BRANCH SAVE-PD2-KEY-BR.

      * IF YOU MOVE THE NAME IN, YOU WILL NOT EVER GET THE LAST RECORD FOR
      * SOME REASON, ON AZURE. IF "TOMMY TESTER" IS ONLY QUOTE, YOU CAN 
      * SELECT IT IN SCAN WINDOW, BUT THEN GET RECORD NOT FOUND. NOW ADD 
      * ANOTHER QUOTE "BETH", YOU CAN PULL UP BETH, BUT NOT TOMMY. YOU GET
      * IO-FG = 9. IF WE MOVE SPACES AND START, YOU WILL GET IT! BIZARRE
      * PROBLEM. SO I ADDED CHECKING THAT THE NAME MATCHES WHAT YOU SELECT.

      *    MOVE PDSCAN-BWNAME       TO PD2-BWNAME.

           MOVE SPACES              TO PD2-BWNAME.

           PERFORM START-PD2-FILE.
       VIA-QUOTE-SCAN-NEXT.
           PERFORM READ-PD2-FILE-NEXT.
           IF (IO-FG = 9) OR (PD2-ID NOT = "Q") OR
                             (PD2-BRANCH NOT = EXT-CONAME-USER-LOC) 
              PERFORM NOT-FOUND
              PERFORM CLOSE-PD1-FILE
              GO TO RECALL-LOAN.

           IF (PD2-BWNAME NOT = PDSCAN-BWNAME)
              GO TO VIA-QUOTE-SCAN-NEXT.

           IF PD-PRLNNO NOT = 0
              PERFORM CLOSE-PD1-FILE.

           MOVE PD-LOANDATE TO HOLD-DATE-YYYYMMDD.
           PERFORM DISPLAY-FIELDS.

      *WHEN QUOTE MADE UNDER PRIOR LAW CODE, RECALLED, SAVED & RECALLED
      *INTO S/F INPUT, WITH NO CHANGE TO LN-DATE FIELD, LOAN GOT UPDATED
      *WITH THE WRONG LAW CODE REGMGM PR#627.
      *CHECK-SP-EFFECTIVE GET THE LAW CODE IN EFFECT & GETS PAST TO THE
      *CALCULATOR IF HOLD-DATE-YYYYMMDD NOT = TRANSACTION DATE AND RECALCULATES
      *THE QUOTE
           PERFORM GET-SP.
           PERFORM CHECK-SP-EFFECTIVE.
           IF SP-LAWCODE NOT = PD-LAWCODE
              MOVE "NEW LAW RECORD EXISTS FOR LOAN DATE!" TO MESS
              PERFORM SEND-MESS
              MOVE "RETRIEVING NEW LAW RECORD, RECALCULATING..!"
                                                          TO MESS
              PERFORM SEND-MESS.

      *  CITIZENS TEST
           MOVE CIP-CALCULATION-INPUT-AREA
                             TO COP-CALCULATION-OUTPUT-AREA.
      *  CITIZENS TEST

      * THIS WAS COMMENTED OUT WAY BACK IN 1999 IN XONPC0 SAYING IT WAS
      * UNNECESSARY. SO I AM COMMENTING OUT TODAY HERE; BAH 10/19/2020
      *    IF PD-PRLNNO NOT = 0
      *       MOVE PD-SSNO(1) TO SAVE-SSNO
      *       PERFORM SET-SCRATCH-KEY
      *       MOVE "Q" TO PD-ID
      *       PERFORM OPEN-PD1-FILE
      *       PERFORM READ-PD1-FILE
      *       IF IO-FG NOT = 9
      *          PERFORM START-PD2-FILE-GREATER.

           MOVE "S  A330011." TO VDU.
           MOVE PD2-BWNAME TO VDUBUF.
           PERFORM SCREENIO.

           MOVE "S  A010012." TO VDU.
           MOVE PD-MAKERCD(1) TO VDUBUF.
           PERFORM SCREENIO.

           MOVE PD-SOC-SEC TO SAVE-QUOTE-SSN.
           PERFORM LOAN-CLASS-PROMPT.
           IF ( LC-SALEFIN = "Y"   )
              PERFORM NOT-DIRECT
              MOVE "CLR" TO IO-TYPE
              GO TO EXIT-ENTER-KEYS.

           IF PRIOR-LOAN-NOT-VALID
              PERFORM SEND-PRIOR-MESS.

           IF ERROR-IN-PRIOR-LOAN
              PERFORM PRIOR-LOAN-ERROR-MSG.
           MOVE 2 TO NEW-FLAG.
           MOVE "SN N020LNKEY." TO VDU.
           MOVE PD-CLASS TO VDUNUM0.
           PERFORM SCREENIO.
      *CS  PERFORM GET-SP.

           IF HOLD-DATE-YYYYMMDD NOT = TRANS-DATE-YYYYMMDD
                     OR SP-LAWCODE NOT = PD-LAWCODE
                      OR NOT PD-ONE-MTH-NO-DAY-EXT
                       OR PD-PRLNNO NOT = 0
              PERFORM TEST-FOR-GEORGIA-SCHG
              PERFORM TEST-FOR-SC-SCHG
              PERFORM TEST-FOR-WI-SCHG
              PERFORM TEST-FOR-MFEE
      *  CITIZENS TEST
              MOVE 800 TO CIP-NO-OF-TIMES-CALLED
      *       MOVE 0 TO CIP-NO-OF-TIMES-CALLED
              PERFORM CALL-LOAN-CALCULATIONS.
           IF ERROR-IN-PRIOR-LOAN
              PERFORM PRIOR-LOAN-ERROR-MSG.

       EXIT-VIA-QUOTE-SCAN.
           MOVE SP-LAWCODE TO PD-LAWCODE.
           PERFORM CLOSE-PD1-FILE.
           GO TO EXIT-ENTER-KEYS.

      **********************************
      *    VIA CAN-LOAN SCAN
      **********************************
       VIA-CAN-LOAN-SCAN.
           PERFORM OPEN-CL1-FILE.
           PERFORM SET-CLFILE-INDEX-BY.
           MOVE CAN-LOAN-NO TO CL-CAN-NO.
           PERFORM READ-CL1-FILE.
           PERFORM CLOSE-CL1-FILE.
           IF IO-FG = 9
              PERFORM NOT-FOUND
              GO TO RECALL-LOAN.

           PERFORM NEW-RECORD-SETUP.
           MOVE CL-PD-REC TO PD-REC.

      * CHECK 'CL' FOR ANY 'SPR' CHANGES

           PERFORM GET-SP.
           IF ( IO-BAD )
              MOVE "STATE PARA. DELETED!" TO MESS
              PERFORM SEND-MESS
              GO TO RECALL-LOAN.

           IF ( SP-CAN-LOANS-NO )
              MOVE MESSAGE-INVALID-SPR-CAN-LOAN TO MESS
              PERFORM SEND-MESS
              GO TO RECALL-LOAN.

      * VERIFY THAT ALL THE FEECODES WITHIN THE CAN LOAN
      * EXIST FOR THE POSTING BRANCH
      
           MOVE 0 TO IO-FG.
           MOVE EXT-CONAME-USER-LOC TO PD-OWNBR.
           PERFORM VARYING SUB FROM 1 BY 1
                   UNTIL (SUB > 10 OR IO-FG = 9)
              IF PD-FEECODE(SUB) NOT = " "
                 MOVE PD-FEECODE(SUB) TO CDB-CODE
                 PERFORM GET-CODE
              END-IF
           END-PERFORM.
           IF IO-FG = 9
              PERFORM MISSING-FEECODE
              GO TO RECALL-LOAN.
      *----------------------------------------------------

           MOVE EXT-CONAME-USER-LOC TO PD2-BRANCH PD-BRANCH
                            PD-POSTING-BR PD-OWNBR
                            PD-ORGBR.

           MOVE "Q"                 TO PD2-ID SAVE-PD2-KEY-ID.
           MOVE EXT-CONAME-USER-LOC TO PD2-BRANCH SAVE-PD2-KEY-BR.
           MOVE SPACES              TO PD2-BWNAME.

           MOVE " " TO PRIOR-LOAN-STAT
                       PASS-STAT-FG.

           MOVE PD-PROCEEDS TO PD-CAN-LOAN-MAX.
           MOVE PD-LOANDATE TO HOLD-DATE-YYYYMMDD.

           PERFORM DISPLAY-FIELDS.


           MOVE "S  A330011." TO VDU.
           MOVE CL-DESC TO VDUBUF.
           PERFORM SCREENIO.

           PERFORM LOAN-CLASS-PROMPT.
           IF ( LC-SALEFIN = "Y"   )
              PERFORM NOT-DIRECT
              MOVE "CLR" TO IO-TYPE
              GO TO EXIT-ENTER-KEYS.

           IF PRIOR-LOAN-NOT-VALID
              PERFORM SEND-PRIOR-MESS.

           IF ERROR-IN-PRIOR-LOAN
              PERFORM PRIOR-LOAN-ERROR-MSG.

           MOVE 2 TO NEW-FLAG.
           MOVE "SN N020LNKEY." TO VDU.
           MOVE PD-CLASS TO VDUNUM0.
           PERFORM SCREENIO.

      *PR#495 WORLD
           MOVE CIP-CALCULATION-INPUT-AREA TO
                                   COP-CALCULATION-OUTPUT-AREA.
           PERFORM GET-SP.

           PERFORM VALID-INS-TYPES-ELIG.

           IF HOLD-DATE-YYYYMMDD NOT = TRANS-DATE-YYYYMMDD
                     OR SP-LAWCODE NOT = PD-LAWCODE
                      OR NOT PD-ONE-MTH-NO-DAY-EXT
              PERFORM TEST-FOR-GEORGIA-SCHG
              PERFORM TEST-FOR-SC-SCHG
              PERFORM TEST-FOR-WI-SCHG
              PERFORM TEST-FOR-MFEE
      *  CITIZENS TEST
              MOVE 800 TO CIP-NO-OF-TIMES-CALLED
              PERFORM CALL-LOAN-CALCULATIONS.
           IF ERROR-IN-PRIOR-LOAN
              PERFORM PRIOR-LOAN-ERROR-MSG.

           IF (GP-ENTER-LPO-FG = "Y")
              MOVE PD-LPO TO WINDOW-LPO
              MOVE PD-REP-CD TO WINDOW-REP
              MOVE PD-PROCESS-CD TO WINDOW-PROCESS
              MOVE "WI/TFCCDS" TO FORM-NAM
              CALL FORM-PROGX USING FORM-PATH WINDOW-WORKERS
              CANCEL FORM-PROGX
              MOVE WINDOW-LPO TO PD-LPO
              MOVE WINDOW-REP TO PD-REP-CD
              MOVE WINDOW-PROCESS TO PD-PROCESS-CD.

       EXIT-VIA-CAN-LOAN-SCAN.
           GO TO EXIT-ENTER-KEYS.

       EXIT-ENTER-KEYS.
           EXIT.

      ************************************************
       RENEWAL-CALCULATOR SECTION.
      ************************************************
           MOVE " " TO IO-TYPE.
           PERFORM NEW-RECORD-SETUP.

      * LOOK FOR SCRATCH SAVED F3 COLLATERAL RECORD
      *    MOVE "C" TO PC-ID.
      *    MOVE BRANCH TO PC-BRANCH.
      *    MOVE VDUNUM0  TO PC-SOC-SEC.
      *    PERFORM OPEN-PC1-FILE.
      *    PERFORM READ-PC1-FILE.
      *    PERFORM CLOSE-PC1-FILE.
      *    IF IO-FG = 0
      *       MOVE "Y" TO F3-COLLATERAL
      *       PERFORM RECALL-COLLATERAL.

           MOVE LNQUOT-PD1-KEY TO PD1-KEY.
           PERFORM GET-PD1.
           IF IO-FG = 9
              MOVE "TEMPORARY RECORD FOR RENEWAL (NOT FOUND)"
                                                    TO MESS
              PERFORM SEND-MESS
              MOVE "END" TO IO-TYPE
              GO TO RENEWAL-CALCULATOR-EXIT.

           MOVE PD-LOANDATE TO TRANS-DATE-YYYYMMDD.
           MOVE PD-CAN-LOAN-NO TO CAN-LOAN-NO.

           PERFORM DISPLAY-FIELDS.
      *  CITIZENS TEST
           MOVE CIP-CALCULATION-INPUT-AREA
                             TO COP-CALCULATION-OUTPUT-AREA.
           MOVE SPACES TO INSPECT-X.
           PERFORM LOAN-CLASS-PROMPT.
           IF ( LC-SALEFIN = "Y"   )
              PERFORM NOT-DIRECT
              MOVE "CLR" TO IO-TYPE
              GO TO RENEWAL-CALCULATOR-EXIT.

           IF PRIOR-LOAN-NOT-VALID
              PERFORM SEND-PRIOR-MESS.

           IF ERROR-IN-PRIOR-LOAN
              MOVE 0 TO IO-FG
              PERFORM PRIOR-LOAN-ERROR-MSG.

           MOVE 2 TO NEW-FLAG.
           MOVE "SN N020LNKEY." TO VDU.
           MOVE PD-CLASS TO VDUNUM0.
           PERFORM SCREENIO.
           PERFORM GET-SP.
           PERFORM TEST-FOR-GEORGIA-SCHG.
           PERFORM TEST-FOR-SC-SCHG.
           PERFORM TEST-FOR-WI-SCHG.
           PERFORM TEST-FOR-MFEE

      *  CITIZENS TEST
           MOVE 800 TO CIP-NO-OF-TIMES-CALLED.
      *    MOVE 0 TO CIP-NO-OF-TIMES-CALLED.
           PERFORM CALL-LOAN-CALCULATIONS.
           MOVE PD-CAN-LOAN-NO TO CAN-LOAN-NO.

       RENEWAL-CALCULATOR-EXIT.
           EXIT.

      ************************************************
      *   ENTRY-MODULE
      *   NEW-FLAG = 0 - MODIFY EXISTING RECORD
      *              1 - INITIAL NEW RECORD ENTRY
      *              2 - MODIFY NEW RECORD
      ************************************************
       ENTRY-MODULE SECTION.

           MOVE "N" TO CHFG(2) CHFG(3) CHFG(4).
           MOVE "S  A000MSEL." TO VDU.
           PERFORM SCREENIO.
           MOVE SPACES TO IO-TYPE.
           MOVE 1 TO ONE.
           MOVE FIRST-ELE TO ELE.
           MOVE 0 TO FIRST-ELE.
           IF CAN-LOAN-NO NOT = " "
              PERFORM FORCE-CAN-LOAN-NUMBERS.
           IF CAN-LOAN-NO NOT = " "
              MOVE "Y" TO INITIAL-CAN-ENTRY-FG
           ELSE
              MOVE " " TO INITIAL-CAN-ENTRY-FG.
       CREATE-ROUTINE.
           IF NEW-FLAG NOT = 1
              GO TO MODIFY-ROUTINE.
           ADD ONE TO ELE.
           IF ELE < 1
              MOVE 1 TO ELE ONE.
           IF ELE NOT > MAX
              GO TO ENTER-ELE.
           MOVE 2 TO NEW-FLAG.
           PERFORM SETUP-CALC-AREA.
           PERFORM TEST-FOR-GEORGIA-SCHG.
           PERFORM TEST-FOR-SC-SCHG.
           PERFORM TEST-FOR-WI-SCHG.
           PERFORM TEST-FOR-MFEE.
           PERFORM CALL-LOAN-CALCULATIONS.
       MODIFY-ROUTINE.
           IF INITIAL-CAN-ENTRY-FG = "Y"
              MOVE " " TO INITIAL-CAN-ENTRY-FG
              MOVE ZEROS TO CHKEY
              MOVE 1 TO ELE
              GO TO CAN-INITIAL-START.
           MOVE " " TO STAT.
           PERFORM UNPROTECT-FIELDS.

           IF LNQUOT-MAINT-FG = "R" OR "P"
              MOVE "F1-CLEAR, F7-EXIT, FIELD #:" TO LEGEND
           ELSE
              IF QUOTE-ONLY
                 IF SP-PYEXFRMLA-SAME2-SPREAD
                    MOVE
                   "F1, F4-MEMO, F5-SPREAD, FIELD #, DELETE, S-SAVE:"
                                                           TO LEGEND
                 ELSE
                    MOVE "F1-CLEAR, F4-MEMO, FIELD #, DELETE, S-SAVE:"
                                                           TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "R RA060SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              MOVE "CLR" TO IO-TYPE
              GO TO END-ENTRY-MODULE.
           IF NOT (LNQUOT-MAINT-FG = "R" OR "P")
              IF VDUSTATUS = "18"
                 PERFORM MEMO-ENTRY
                 GO TO MODIFY-ROUTINE.

      * F5 - 1STPYEXT FORMULA 12 SPREAD WINDOW
      
           IF NOT (LNQUOT-MAINT-FG = "R" OR "P")
              IF ( VDUSTATUS = "1:"          ) AND
                 ( PD-GIFTNET NOT = "Y"      ) AND
                 ( SP-PYEXFRMLA-SAME2-SPREAD )
                   PERFORM W12EQ2-WINDOW
                   GO TO MODIFY-ROUTINE.

           IF LNQUOT-MAINT-FG = "R" OR "P"
              IF VDUSTATUS = "1>"
                 PERFORM OPEN-PD1-FILE
                 PERFORM READ-PD1-FILE
                 IF IO-FG = 0
                    PERFORM DELETE-PD1-FILE
                 END-IF
                 MOVE "END" TO IO-TYPE
                 GO TO END-ENTRY-MODULE.
           IF VDUSTATUS NOT = "00"
              GO TO MODIFY-ROUTINE.
           MOVE VDUBUF TO ACTION.

              IF NOT ( ACTION = "     S" OR "DELETE" )
                 GO TO BYPASS-UPDATE.

           IF ACTION = "     S"
              PERFORM TN-MTG-VALIDATION
              IF WS-TN-ERRCD = 9
                 GO TO MODIFY-ROUTINE
              ELSE
                 PERFORM KY-ROAD-GARD-VALIDATION
                 IF ROAD-GARD-ERRCD = 9
                    GO TO MODIFY-ROUTINE.

           IF NOT (LNQUOT-MAINT-FG = "R" OR "P")
              IF ACTION = "DELETE"
                 PERFORM DELETE-SCRATCH
                 MOVE "CLR" TO IO-TYPE
                 GO TO END-ENTRY-MODULE.

           IF PRIOR-LOAN-NOT-VALID
              PERFORM SEND-PRIOR-MESS
              GO TO MODIFY-ROUTINE.

           IF NOT (LNQUOT-MAINT-FG = "R" OR "P")
              IF ACTION = "     S"
                 IF (NOT COP-CALCULATION-OK)
                          AND (LOAN-CALCULATOR-CALLED-FG = "Y")
                    PERFORM ERROR-IN-CALCULATIONS-MSG
                    GO TO MODIFY-ROUTINE
                 ELSE
                    PERFORM VERIFY-WRITE
                    IF IO-FG NOT = 0
                       GO TO MODIFY-ROUTINE
                    END-IF
                    PERFORM WRITE-SCRATCH
                    MOVE "CLR" TO IO-TYPE
                    GO TO END-ENTRY-MODULE.
       BYPASS-UPDATE.
           INSPECT ACTION REPLACING ALL " " BY "0".

           IF CHNO NOT NUMERIC
              GO TO MODIFY-ROUTINE.

           IF CHNO = 0
              GO TO MODIFY-ROUTINE.

           IF CHNO > MAX
              GO TO MODIFY-ROUTINE.

           MOVE CHNO TO ELE.
      *<1225J>
           IF ELE = 21
              IF SP-CAL-FLAT-MONTHLY(1)
                 MOVE "FLATMONTHLY_OVR" TO GETENV-BUF
                 PERFORM GETENV-CALL
                 IF STAT NOT = "00"
                    MOVE
                    "RATE OVERRIDES NOT ALLOWED WITH FLAT MONTHLY"
                                                           TO MESS
                 PERFORM SEND-MESS
                 GO TO MODIFY-ROUTINE.
      *<1225J>

       CAN-INITIAL-START.
           IF ELE NOT = 18
              MOVE "Y" TO DEFAULT-APR-FG.

           IF CAN-LOAN-NO NOT = " "
              IF LNQUOT-MAINT-FG = "R" OR "P"
                 GO TO MODIFY-ROUTINE
              ELSE
                 IF NOT (ELE = 1 OR 2 OR 3 OR 4 OR 8 OR 9
                            OR 10 OR 11 OR 13 OR 14 OR 15
                            OR 16 OR 17 OR 18 OR 20 OR 27
                            OR 28 OR 29 OR 30)
                    GO TO MODIFY-ROUTINE
                 ELSE
                    NEXT SENTENCE
           ELSE
      *    ----------------------------------------------------------
      *    PASSWORD ON CL,AH,PP,01,MAINT FEE, 1ST PY EXT, EXT LC INFO
      *    ----------------------------------------------------------
            IF ELE = 25 OR 26 OR 27 OR 28 OR 32 OR 33 OR 39
              IF OVERRIDES-OK = "N"
                 MOVE OVER-SEQ TO PASSWDW-SEQ
                 MOVE "TO ALLOW OVERRIDES........:"
                                      TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "N" TO OVERRIDES-OK
                    GO TO MODIFY-ROUTINE
                 ELSE
                    MOVE "Y" TO OVERRIDES-OK.
      *    ----------------------------------------------------------------
      *    PASSWORD ON CL, AH, PP, 01         WORLD #J051
      *
      *    N O T E:  NO  PASSWORD TEST
      *              IF CHANGING 'PP' AND GP-FORCE-INPUT-PP-COVERAGE = 'Y'
      *    ----------------------------------------------------------------
      *    IF NOT ( ELE = 27 AND
      *             PD-ORGST = "GA" AND
      *             GP-FORCE-INPUT-PP-COVERAGE = "Y"
      *           )

      * WORLD PR#1292 OPERATIONS WANTS ALL BRANCHES TO HAVE THE ABILITY
      *               TO ADJUST PP INSURANCE WHEN BUILDING A LOAN
           IF NOT ( ELE = 27 AND GP-FORCE-INPUT-PP-COVERAGE = "Y" )
      * "TN" USES O1 FOR AUTO, NEED TO OVERRIDE THE COVERAGE PR# 434
      * "OK" USES O1 FOR AUTO, NEED TO OVERRIDE THE COVERAGE PR# 1007
      * "MS" NEEDS ABILITY TO ADJUST ASI PREMIUMS PR#1390
             IF NOT
              (ELE = 28 AND (PD-ORGST = "TN" OR "OK" OR "MS"))
                IF ELE = 25 OR 26 OR 27 OR 28
                   MOVE CL-AH-PP-O1-SEQ TO PASSWDW-SEQ
                   MOVE "TO ALLOW INS. OVERRIDES ..:" TO PASSWDW-PROMPT2
                   PERFORM VERIFY-PASSWORD
                   IF PASSWDW-STAT NOT = "OK"
                      GO TO MODIFY-ROUTINE.

           IF ELE = 25 OR 26
              IF CHFG(ELE) NOT = "N"
                 MOVE CL-OR-AH-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE CL OR A&H........:"
                                      TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO MODIFY-ROUTINE.

      * PASSWORD OTHER 2 O2 INSURANCE
           IF ELE = 29
              IF CHFG(ELE) NOT = "N"
                 MOVE O2-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE OTHER 2 INSURANCE:" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO MODIFY-ROUTINE.

      * OVERRIDE CALCULATED APR RATE
           IF ELE = 21
              IF APR-OK = "N"
                 MOVE APR-SEQ TO PASSWDW-SEQ
                 MOVE "TO OVERRIDE RATES.........:" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "N" TO APR-OK
                    GO TO MODIFY-ROUTINE
                 ELSE
                    MOVE "Y" TO APR-OK.

       ENTER-ELE.
           IF ELE = 1
              IF LNQUOT-MAINT-FG = "R" OR "P"
                 GO TO CREATE-ROUTINE
              ELSE
                 IF LOAN-QUOTE-FG = "Q"
                    MOVE 0 TO VDUNUM0
                    GO TO F-01.
           IF ELE = 5
              IF NEW-FLAG NOT = 1
                 GO TO MODIFY-ROUTINE
              ELSE
                 IF CHFG(5) = "N"
                    GO TO F-052.
           IF ELE = 6 OR 7
              IF QUOTE-ONLY
                 IF ELE = 6
                    IF CHFG(6) = "N"
                       MOVE "S  8000060." TO VDU
                       MOVE TRANS-DATE-YYYYMMDD TO PD-LOANDATE
                                                   VDU-DATE-YYYYMMDD
                       PERFORM SCREENIO
                       MOVE " " TO CHFG(6)
                       PERFORM DEFAULT-INT-PMT-DATES
                       IF IO-FG = 9
                          MOVE 0 TO IO-FG
                          GO TO ENTER-ELE
                       ELSE
                          IF AMT-HOLDER = 0
                             GO TO CONT1-F-06
                          ELSE
                             GO TO CREATE-ROUTINE
                    ELSE
                       NEXT SENTENCE
                 ELSE
                    IF QUOTE-ONLY
                       IF ELE = 7
                          IF CHFG(7) = "N"
                             MOVE " " TO CHFG(7)
                             GO TO CONT-F-07.
           IF QUOTE-ONLY
              IF ELE = 8
                 IF CHFG(8) = "N"
                    MOVE " " TO CHFG(8)
                    GO TO CREATE-ROUTINE.
           IF QUOTE-ONLY
              IF ELE = 9
                 IF CHFG(9) = "N"
                    MOVE " " TO CHFG(9)
                    GO TO CREATE-ROUTINE.
           IF ELE = 5
              MOVE "ENTER THE STATE OF ORIGINATION:" TO LEGEND
              PERFORM SEND-LEGEND.
           IF ELE = 6
              MOVE "ENTER THE DATE OF THE LOAN:" TO LEGEND
              PERFORM SEND-LEGEND.
           IF ELE = 7
              MOVE "ENTER FIRST PAYMENT DUE DATE:" TO LEGEND
              PERFORM SEND-LEGEND.
           IF ELE = 8
              MOVE "F6-PURPOSE SCAN, ENTER PURPOSE CODE:" TO LEGEND
              PERFORM SEND-LEGEND.
           IF ELE = 9
              MOVE
              "F6-COLLATERAL SCAN, ENTER COLLATERAL CODE:" TO LEGEND
              PERFORM SEND-LEGEND.
           IF ELE = 10
              IF LNQUOT-MAINT-FG = "R" OR "P"
                 GO TO CREATE-ROUTINE
              ELSE
              MOVE " " TO CHFG(8) CHFG(9)
              MOVE "F6-SOURCE SCAN, ENTER SOURCE CODE:" TO LEGEND
              PERFORM SEND-LEGEND.
           IF ELE = 11
              IF LNQUOT-MAINT-FG = "R" OR "P"
                 GO TO CREATE-ROUTINE
              ELSE
                 IF PD-SRCD = "SC" OR "PB" OR "RN"
                                 OR "RB" OR "RO"
                    MOVE " " TO CHFG(11)
                    MOVE "F6-SCAN, ENTER LOAN NO. BEING RENEWED:"
                                                   TO LEGEND
                    PERFORM SEND-LEGEND.
           IF ELE = 12
              IF LNQUOT-MAINT-FG = "R"
                 GO TO CREATE-ROUTINE
              ELSE
                 MOVE " " TO CHFG(11)
                 IF (PD-SRCD = "RN")
                     AND (NEW-FLAG = 1)
                    MOVE "N" TO CHFG(12)
                 ELSE
                    IF CAN-LOAN-NO NOT = " "
                       MOVE "N" TO CHFG(12)
                    ELSE
                       MOVE " " TO CHFG(12)
                       MOVE "F1, ENTER LOAN PROCEEDS:" TO LEGEND
                       PERFORM SEND-LEGEND.
           IF ELE = 13
              IF (GP-ENTER-LPO-FG = "Y")
                 MOVE "F3-LPO, ENTER INSURANCE CODES (EX. MGG):"
                                                         TO LEGEND
                 PERFORM SEND-LEGEND
              ELSE
                 MOVE "ENTER INSURANCE CODES (EX. MGG):" TO LEGEND
                 PERFORM SEND-LEGEND.
           IF ELE = 13
              IF (GP-ENTER-LPO-FG = "Y")
                 IF VDUSTATUS = "16"
                    MOVE PD-LPO TO WINDOW-LPO
                    MOVE PD-REP-CD TO WINDOW-REP
                    MOVE PD-PROCESS-CD TO WINDOW-PROCESS
                    MOVE "WI/TFCCDS" TO FORM-NAM
                    CALL FORM-PROGX USING FORM-PATH WINDOW-WORKERS
                    CANCEL FORM-PROGX
                    MOVE WINDOW-LPO TO PD-LPO
                    MOVE WINDOW-REP TO PD-REP-CD
                    MOVE WINDOW-PROCESS TO PD-PROCESS-CD.
           IF ELE > 13 AND ELE < 19
              IF CHFG(14) NOT = "N"
                 MOVE "F1, F6-FEE CODE SCAN, ENTER CODE, <ENTER>=NONE:"
                                                            TO LEGEND
                 PERFORM SEND-LEGEND.
           IF ELE > 13 AND ELE < 19
              IF NOT QUOTE-ONLY
                 MOVE " " TO CHFG(14) CHFG(15) CHFG(16)
                   CHFG(17) CHFG(18).
           IF ELE = 19
              IF CHFG(19) = "N"
                 PERFORM RESET-LEGEND
              ELSE
                 MOVE "F1, F6-DEALER SCAN, ENTER DEALER NO:" TO LEGEND
                 PERFORM SEND-LEGEND.
           IF NEW-FLAG = 1
              IF ELE > 24 AND ELE < 31
                 GO TO CREATE-ROUTINE.

           IF ELE = 29
              IF SP-DEFAULT-O2-INS-COMP NUMERIC  AND
                    SP-DEFAULT-O2-INS-COMP NOT = 0
                 MOVE "SN N020290." TO VDU
                 MOVE SP-DEFAULT-O2-INS-COMP TO VDUNUM0
                 PERFORM SCREENIO.
           IF ELE = 30
              IF GP-DEFAULT-O3-INS-COMPANY NOT = 0
                 MOVE "SN N020300." TO VDU
                 MOVE GP-DEFAULT-O3-INS-COMPANY TO VDUNUM0
                 PERFORM SCREENIO.

           IF ELE = 25  OR 26 OR 27 OR 28 OR 29 OR 30
              MOVE VDUSTATUS TO HOLD-VDUSTATUS
              MOVE "F6-SCAN, ENTER INSURANCE COMPANY" TO LEGEND
              PERFORM SEND-LEGEND
              IF HOLD-VDUSTATUS = "1<"
                 PERFORM INSCOMP-SCAN
                 MOVE "SNNN020  0." TO VDU
                 MOVE ELE TO VDUROW
                 MOVE ICSCAN-CODE TO VDUNUM0
                 PERFORM SCREENIO
                 MOVE ICSCAN-CODE TO VDUNUM0
                 IF IO-FG = 9
                    GO TO ENTER-ELE.

           IF ELE = 31
              IF SP-SCFRMLA = 0
                 GO TO CREATE-ROUTINE
              ELSE
                 IF SP-SCFRMLA = 33 OR 39
                    MOVE "F1, F3-CHANGE POINTS/ORIG.FEE CHARGES:"
                                                          TO LEGEND
                 ELSE
                    MOVE "F1, ENTER SERVICE CHARGE:" TO LEGEND.
           IF ELE = 32
              IF SP-MFFRMLA = 0
                 GO TO CREATE-ROUTINE.
           IF ELE = 33
              IF SP-PYEXFRMLA = 0
                 GO TO CREATE-ROUTINE.
           IF ELE = 38
              IF LNQUOT-MAINT-FG = "R"
                 GO TO CREATE-ROUTINE.

      * WHEN BRANCH IS FLAGED FOR INS. SALES TAX, ONLY 4 FEE CODES ARE AVAILABLE
      
           IF BR-FORCE-VALID-CITY-COUNTY = "Y"
              IF SP-INSURANCE-WRITTEN NOT = "N"
                IF ELE = 16 OR 17 OR 18
                 GO TO CREATE-ROUTINE.

           IF CHKEY NOT = ZEROS
              IF CHFG (ELE) = " "
                 IF NEW-FLAG NOT = 1
                    GO TO MODIFY-ROUTINE.

           IF CHFG(ELE) = "N"
              IF NEW-FLAG = 1
                 GO TO CREATE-ROUTINE
              ELSE
                 GO TO MODIFY-ROUTINE.

           MOVE SPEC(ELE) TO VDU.
           MOVE ELE TO VDUROW.
           MOVE 0 TO VDUCOL.
           MOVE "." TO VDUDECIMAL.
           PERFORM SCREENIO.

       TEST-F1.
           IF VDUSTATUS = "10"
              MOVE "CLR" TO IO-TYPE
              GO TO END-ENTRY-MODULE.
       TEST-F7.
           IF VDUSTATUS NOT = "1>"
              GO TO TEST-F3.
           MOVE "END" TO IO-TYPE.
           GO TO END-ROUTINE.
       TEST-F3.
           IF VDUSTATUS NOT = "16"
              GO TO TEST-UP.
           IF ELE = 31
              IF SP-SCFRMLA = 33 OR 39
                 MOVE SP-SCMIN            TO SCHG33-SP-SCMIN
                 MOVE SP-SCMAX            TO SCHG33-SP-SCMAX
                 SUBTRACT PD-STATE-WORKER FROM PD-SERCHG
                                          GIVING SCHG33-CUR-POINTS
                 MOVE PD-STATE-WORKER TO SCHG33-CUR-ORIGFEE
                 MOVE "WI/SCHG33" TO FORM-NAM
                 CALL FORM-PROGX USING FORM-PATH SCHG33-WORKERS
                 CANCEL FORM-PROGX
                 ADD SCHG33-CHGTO-POINTS
                     SCHG33-CHGTO-ORIGFEE  GIVING PD-SERCHG
                 MOVE SCHG33-CHGTO-ORIGFEE TO PD-STATE-WORKER

                 MOVE "S  A010311." TO VDU
                 MOVE "I" TO VDUBUF PD-SERCHG-FG
                 PERFORM SCREENIO

                 MOVE PD-SERCHG       TO CIP-SERVICE-CHG
                 MOVE PD-STATE-WORKER TO CIP-STATE-WORKER
                 MOVE PD-SERCHG-FG    TO CIP-SERVICE-CHG-SW
                 PERFORM CALL-LOAN-CALCULATIONS
                 GO TO CREATE-ROUTINE.

       TEST-UP.
           IF VDUSTATUS NOT = "1U"
              GO TO TEST-DN.
           IF ELE = 6
              MOVE " " TO CHFG(5).
           IF ELE = 7
              MOVE " " TO DATE-STAT.

           IF ELE = 11
              MOVE 10 TO ELE
              GO TO ENTER-ELE.

           IF ELE = 20
              MOVE " " TO CHFG(19).
           IF NEW-FLAG = 1
              MOVE -1 TO ONE
              GO TO CREATE-ROUTINE.
       TEST-DN.
           IF VDUSTATUS NOT = "1D"
              GO TO TEST-F6.
           MOVE 1 TO ONE.
           GO TO GOTO-FIELD.
       TEST-F6.
           IF VDUSTATUS NOT = "1<"
              GO TO TEST-00.
           IF ELE < 5
              PERFORM BORROWER-SCAN
              IF IO-FG = 0
                 GO TO GOTO-FIELD
              ELSE
                 GO TO ENTER-ELE.
           IF (ELE = 8 OR 9 OR 10)
                        OR (ELE > 13 AND ELE < 19)
               MOVE 0 TO CDCODE-FEE-FG
               PERFORM CODE-SCAN
               IF IO-FG = 0
                  GO TO GOTO-FIELD
               ELSE
                  GO TO ENTER-ELE.
           IF ELE = 11
              PERFORM BWLN-SCAN
              IF IO-FG = 0
                 GO TO GOTO-FIELD
              ELSE
                GO TO ENTER-ELE.
           IF ELE = 19
              PERFORM DEALER-SCAN
              IF IO-FG = 0
                 GO TO GOTO-FIELD
              ELSE
                 GO TO ENTER-ELE.
       TEST-00.
           IF VDUSTATUS NOT = "00"
              GO TO ENTER-ELE.
       GOTO-FIELD.
           MOVE 1 TO ONE.
           IF ELE > 20
              GO TO GOTO-FIELD-20.
           GO TO F-01 F-02 F-03 F-04 F-05 F-06 F-07 F-08 F-09 F-10
                 F-11 F-12 F-13 F-14 F-15 F-16 F-17 F-18 F-19 F-20
                 DEPENDING ON ELE.
       GOTO-FIELD-20.
           SUBTRACT 20 FROM ELE GIVING OVER-20.
           GO TO F-21 F-22 F-23 F-24 F-25 F-26 F-27 F-28 F-29 F-30
                 F-31 F-32 F-33 F-34 F-35 F-36 F-37 F-38
                 DEPENDING ON OVER-20.
           GO TO END-ENTRY-MODULE.

      *************************************
      *    S E T   E L E M E N T S        *
      *************************************
       F-01.
           PERFORM BORROWER-ENTRY.
           IF IO-FG = 9
              IF IO-TYPE = "CLR"
                 GO TO END-ENTRY-MODULE
              ELSE
                 GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-02.
           PERFORM BORROWER-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-03.
           PERFORM BORROWER-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-04.
           PERFORM BORROWER-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           PERFORM BW-CHECK-ENDORSER.
           GO TO CREATE-ROUTINE.

      *-----------------------------------------------------------------
       F-05.
           MOVE VDUBUF TO PD-ORGST
                          PD-OWNST.

      *-----------------------------------------------------------------
       F-052.
           MOVE SPACES                              TO CHFG(5).
           MOVE "^-BACK, F6-SCAN, ENTER SUB CLASS:" TO LEGEND.
           PERFORM SEND-LEGEND.

      * RESET THE FIELD, A30 WILL FORCE LEADING ZERO INPUT IF FIELD ALREADY
      * FILLED IN
           MOVE "EN N020052." TO VDU.
           PERFORM SCREENIO.

           IF ( UP-KEY ) GO TO ENTER-ELE.

           IF ( F6-KEY ) PERFORM SUBCLASS-SCAN
                         IF ( IO-FG NOT = ZEROES )
                            GO TO F-052.

           IF NOT ( DOWN-KEY OR ENTER-KEY ) GO TO F-052.

           MOVE PD-ORGST    TO SP-ORGST.
           MOVE PD-SPRCLASS TO SP-SPRCLASS.
           MOVE VDUNUM0     TO PD-SUBCLASS SP-SUBCLASS.
           MOVE ZEROES      TO SP-LAWCODE.
           PERFORM OPEN-SP1-FILE.
           PERFORM START-SP1-FILE.
       F-052-NEXT-SP.
           PERFORM READ-SP1-FILE-NEXT.

           IF NOT (SP-ORGST = PD-ORGST
                     AND SP-SPRCLASS = PD-SPRCLASS
                       AND SP-SUBCLASS = PD-SUBCLASS)
              MOVE 9 TO IO-FG.

           IF ( IO-FG NOT = ZEROES )
              PERFORM SP-INVALID
              GO TO F-052.

      * CHECK 'SPR' CAN LOANS FLAG!
      
           IF (( SP-CAN-LOANS-ONLY ) AND ( CAN-LOAN-NO     = SPACES ))
              MOVE MESSAGE-INVALID-SPR-CL TO MESS
              PERFORM SEND-MESS
              GO TO F-052.

           IF (( SP-CAN-LOANS-NO   ) AND ( CAN-LOAN-NO NOT = SPACES ))
              MOVE MESSAGE-INVALID-SPR-NON-CL TO MESS
              PERFORM SEND-MESS
              GO TO F-052.

           MOVE "S  A015053." TO VDU.
           MOVE SP-DESC       TO VDUBUF.
           PERFORM SCREENIO.

           PERFORM RESCISSION-ROUTINE.

           IF ( RESCISSION-STATUS-BAD )
              GO TO F-052.

           GO TO CREATE-ROUTINE.

      *-----------------------------------------------------------------
       F-06.
           MOVE VDU-DATE-YYYYMMDD TO PD-LOANDATE.
           IF VDUNUM0 = 0
              GO TO ENTER-ELE.

           PERFORM CHECK-SP-EFFDATE.
           IF IO-FG = 9
              PERFORM SP-INVALID
              GO TO ENTER-ELE
           ELSE
              MOVE "S  A015053." TO VDU
              MOVE SP-DESC       TO VDUBUF
              PERFORM SCREENIO.
           MOVE SP-LAWCODE TO PD-LAWCODE.

           PERFORM RESCISSION-ROUTINE.
           IF ( RESCISSION-STATUS-BAD )
              GO TO ENTER-ELE.

           IF PD-INTDATE = 0
              MOVE "S  8000061." TO VDU
              MOVE PD-LOANDATE TO PD-INTDATE VDU-DATE-YYYYMMDD
              PERFORM SCREENIO.
           IF PD-1STPYDATE NOT = 0
               PERFORM SPTEST-EXTDATE-VALID
               IF LIMIT-ERROR = "Y"
                 GO TO ENTER-ELE
              ELSE
                 GO TO CONT1-F-06.

           MOVE PD-INTDATE TO NDTE-DATE
                              SYS-DATE.
           MOVE 1 TO NDTE-HOLD.
           PERFORM INCREMENT-MONTHS.

      * WORLD OPTION TO ADVANCE TO 1ST OF NEXT MONTH
      * IF NO CORRESPONDING DAY IN NEW MONTH:
           PERFORM SET-ADV-TO-1ST-NO-CORR.
           IF ADV-TO-1ST-NO-CORR = "Y"
              IF NOT ( PD-ORGST   = "TN" AND
                       PD-CLASS   = 01   AND
                       PD-ORGTERM = 12)
                 IF PD-UNITPER-CD = "M" AND PD-UNITPER-FREQ = 1
                    IF S-DD > NDTE-DD
                       MOVE 1 TO NDTE-DD
                                 NDTE-HOLD
                       PERFORM INCREMENT-MONTHS
                       MOVE NDTE-DATE TO NUM-DATE.

      * IF DATE OF THE LOAN IS ON THE 26 THRU 31 THEN ADVANCE THE
      *   FIRST PAYMENT DUE DATE TO THE FIRST OF THE SECOND MONTH
      *   FOLLOWING THE DATE OF THE LOAN. (REGMGM PR#1099)
           IF ADV-TO-1ST-NO-CORR = "A"
              IF PD-UNITPER-CD = "M" AND PD-UNITPER-FREQ = 1
                 IF S-DD > 25
                    MOVE 1 TO NDTE-DD
                              NDTE-HOLD
                    PERFORM INCREMENT-MONTHS
                    MOVE NDTE-DATE TO NUM-DATE.

           MOVE "S  8000070." TO VDU.
           MOVE NDTE-DATE TO VDU-DATE-YYYYMMDD PD-1STPYDATE
                                               PD-ORIG-1STPYDATE.
           PERFORM SCREENIO.

           PERFORM SPTEST-EXTDATE-VALID.
           IF LIMIT-ERROR = "Y"
              GO TO ENTER-ELE.
           IF DATE-STAT = "N"
              IF NEW-FLAG NOT = 1
      * CITIZENS TEST
                 MOVE 800 TO CIP-NO-OF-TIMES-CALLED
      * A90?     MOVE 0 TO CIP-NO-OF-TIMES-CALLED
                 MOVE PD-LOANDATE  TO CIP-LN-DT
                 MOVE PD-INTDATE   TO CIP-IN-DT
                 MOVE PD-1STPYDATE TO CIP-PMT-DT
                 PERFORM CALL-LOAN-CALCULATIONS.
           IF DATE-STAT = "N"
              GO TO CREATE-ROUTINE.

      *-----------------------------------------------------------------
       CONT1-F-06.

           IF ( NEW-FLAG NOT = 1     ) AND
              ( PD-POCD-INRESCISSION )
              GO TO CREATE-ROUTINE.

           MOVE "ENTER THE INTEREST DATE OF THE LOAN:" TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ERNM060061." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT1-F-06.
           IF VDUNUM0 = 0
              GO TO CONT1-F-06.
           MOVE VDU-DATE-YYYYMMDD TO PD-INTDATE.

           IF PD-INTDATE < PD-LOANDATE
              MOVE "MUST NOT BE PRIOR TO LOAN DATE" TO MESS
              PERFORM SEND-MESS
              GO TO CONT1-F-06
           ELSE
              IF PD-INTDATE > PD-LOANDATE
                 MOVE LOAN-INT-DATE TO PASSWDW-SEQ
                 MOVE "FOR LNDATE NOT = INTDATE" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO CONT1-F-06.

            PERFORM SPTEST-EXTDATE-VALID.
            IF LIMIT-ERROR = "Y"
              GO TO CONT1-F-06.
           IF NEW-FLAG NOT = 1
      * CITIZENS TEST
              MOVE 800 TO CIP-NO-OF-TIMES-CALLED
      * A90?  MOVE 0 TO CIP-NO-OF-TIMES-CALLED
              MOVE PD-LOANDATE TO CIP-LN-DT
              MOVE PD-INTDATE  TO CIP-IN-DT
              PERFORM CALL-LOAN-CALCULATIONS.
           GO TO CREATE-ROUTINE.
       F-07.
           MOVE VDU-DATE-YYYYMMDD TO PD-ORIG-1STPYDATE
                                     PD-1STPYDATE.
           IF VDUNUM0 = 0
              GO TO ENTER-ELE.

           PERFORM SPTEST-EXTDATE-VALID.
           IF LIMIT-ERROR = "Y"
              GO TO ENTER-ELE.

           IF PD-ORIG-1STPYDATE NOT > PD-INTDATE
              MOVE "FIRST PAY MUST BE AFTER THE INTEREST DATE" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-ELE.

       CONT-F-07.
           MOVE "ENTER THE TERM OF THE LOAN:" TO LEGEND.
           PERFORM SEND-LEGEND.
      *    MOVE "ENNN030071." TO VDU.
           MOVE "EN N030071." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT-F-07.
           IF VDUNUM0 = 0
              GO TO CONT-F-07.
           IF VDUNUM0 = 1
              MOVE
              "TO ENTER SINGLE PAY LOANS USE BALLOON QUOTER SCREEN!!!!"
                                                               TO MESS
              PERFORM SEND-MESS
              GO TO CONT-F-07.
           MOVE VDUNUM0 TO PD-ORGTERM PD-ANTICTERM PD-SUM-ORGTERM.
           PERFORM SP-EDT-TABLE-LOOKUP.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO CONT-F-07.
           IF NEW-FLAG NOT = 1
      * CITIZENS TEST
              MOVE 800 TO CIP-NO-OF-TIMES-CALLED
      * A90?  MOVE 0 TO CIP-NO-OF-TIMES-CALLED
              MOVE PD-1STPYDATE TO CIP-PMT-DT
              MOVE PD-ORGTERM   TO CIP-TERM
              PERFORM CALL-LOAN-CALCULATIONS.
           GO TO CREATE-ROUTINE.
       F-08.
           MOVE "PU"   TO CD-TYPE.
           MOVE VDUBUF TO CD-CODE PD-PURCD.
           PERFORM SEND-CD-DESC.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.

      *-----------------------------------------------------------------
       F-09.

           MOVE "CO"   TO CD-TYPE.
           MOVE VDUBUF TO CD-CODE PD-COLLCD.
           PERFORM SEND-CD-DESC.
           IF ( IO-BAD )
              GO TO ENTER-ELE.

           MOVE CD-CO-SECURED TO SPTEST-CD-SECURED.
           PERFORM RESCISSION-ROUTINE.
           IF ( RESCISSION-STATUS-BAD )
              GO TO ENTER-ELE.

      * OF THE 4 AUTO COLLATERAL CODES THAT WORLD USES, ONLY "AU" AND "WA"
      * ARE ALLOWED IN THE STATE OF "IL". EXCEPT CLASS 8 WHICH CAN HAVE ANY.
      * CLASS 5, SUBCLASS 10 MUST HAVE "AU" OR "WA" ONLY!
           MOVE PD-COLLCD TO TEST-COLLCD.
           IF PD-ORGST = "IL"
              IF (PD-CLASS = 5 AND PD-SUBCLASS = 10)
                  IF PD-COLLCD NOT = "AU" AND NOT = "WA"
                     MOVE "MUST HAVE TITLE SECURED COLLATERAL" TO MESS
                     PERFORM SEND-MESS
                     GO TO ENTER-ELE.
           IF PD-ORGST = "IL"
              IF NOT (PD-CLASS = 5 AND PD-SUBCLASS = 10)
                 IF PD-CLASS NOT = 8
                    IF AUTO-COLLCD
                     MOVE "TITLE SECURED COLLATERAL NOT ALLOWED" TO MESS
                     PERFORM SEND-MESS
                     GO TO ENTER-ELE.

           GO TO CREATE-ROUTINE.

       F-10.
           MOVE "SR"   TO CD-TYPE.
           MOVE VDUBUF TO CD-CODE PD-SRCD.
           PERFORM SEND-CD-DESC.
           IF IO-FG = 9
              GO TO ENTER-ELE.

           IF NOT (PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO")
              IF SP-SCFRMLA = 63
                 MOVE 0 TO WISCHG-PRIOR-SERCHG
                           CIP-RESTRICT-SERCHG.

           IF GP-THE-ONLY-SF-SRCD NOT = " "
              IF PD-SRCD = GP-THE-ONLY-SF-SRCD
                 MOVE "INVALID FOR DIRECT LOANS" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.

           IF SP-RENEWABLE-DAYS = 9999
              IF PD-SRCD = "PB" OR "RN"
                 MOVE "INVALID FOR THIS CLASS" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.

           IF PD-SRCD = "ET" OR "LP" OR "NP" OR "RT" OR "ST" OR "RB"
              MOVE SRCD-SEQ TO PASSWDW-SEQ
              MOVE "TO USE THIS SRCD" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "INVALID SOURCE CODE" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.

           IF CIP-SOURCE-CD = "RN" OR  "SC" OR "PB" OR " "
                                 OR "RB" OR "RO"
              IF NOT (PD-SRCD = "RN" OR "SC" OR "PB"
                                   OR "RB" OR "RO")
                 PERFORM BLANK-PRIOR-LOAN.
           MOVE PD-SRCD TO CIP-SOURCE-CD.
           IF NEW-FLAG NOT = 1
              PERFORM VERIFY-PROCEEDS
              MOVE 0 TO IO-FG
              IF PD-SRCD = "RN" OR "SC" OR "PB"
                                OR "RB" OR "RO"
                 ADD 1 TO ELE
                 GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-11.
           MOVE VDUNUM0 TO W-LNNO.
           IF NOT (PD-SRCD = "RN" OR "PB" OR "SC"
                                OR "RB" OR "RO")
              IF VDUNUM0 = 0
                 MOVE "S  A060110." TO VDU
                 PERFORM SCREENIO
                 MOVE "S  A090111." TO VDU
                 PERFORM SCREENIO
                 MOVE 0 TO PD-PRLNNO   PD-PRBAL
                           PD-PRINTDUE PD-PRFINCHGRB
                           PD-PRINSRB  PD-PRPAID-AHEAD
                 GO TO CREATE-ROUTINE
              ELSE
                 MOVE W-LNNO TO PD-PRLNNO
                 GO TO CREATE-ROUTINE
           ELSE
              IF VDUNUM0 = 0
                 MOVE "PRIOR LOAN NO. REQUIRED FOR LOAN RENEWALS"
                       TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.

           MOVE W-LNNO TO PD-PRLNNO.
           PERFORM PROCESS-PRIOR-LOAN.

           IF PRIOR-LOAN-NOT-VALID
              MOVE 0 TO IO-FG
              PERFORM SEND-PRIOR-MESS
              GO TO ENTER-ELE.

           IF ERROR-IN-PRIOR-LOAN
              MOVE 0 TO IO-FG
              PERFORM PRIOR-LOAN-ERROR-MSG
              GO TO ENTER-ELE.

           MOVE "SNNN062111." TO VDU.
           MOVE PRIOR-LNAMT TO VDUNUM2.
           PERFORM SCREENIO.

           GO TO CREATE-ROUTINE.

       F-12.
      *    MOVE PD-PROCEEDS TO AMT-HOLDER.
      * NEEDS ITS OWN HOLDER BECAUSE ITS RECALC'D IN
      *   SP-EDT-TABLE-LOOKUP
           MOVE PD-PROCEEDS TO PROCEEDS-HLDR.
           MOVE VDUNUM2 TO PD-PROCEEDS.
           IF NOT (PD-SRCD = "RN" OR "RB" OR "SC" OR "RO")
              IF PD-PROCEEDS = 0
                 IF SP-ALLOW-ZERO-PROC = "Y" AND NOT (PD-SRCD = "PB")
                    MOVE ALLOW-ZERO-PROC-SEQ TO PASSWDW-SEQ
                    MOVE "TO APR" TO PASSWDW-PROMPT2
                    PERFORM VERIFY-PASSWORD
                    IF PASSWDW-STAT NOT = "OK"
                       GO TO ENTER-ELE
                    END-IF
                 ELSE
                    GO TO ENTER-ELE.
           PERFORM SP-EDT-TABLE-LOOKUP.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.

      * DO NOT PUT THE MOVE 0 TO IO-FG IN THE VERIFY-PROCEEDS ROUTINE,
      * THAT ROUTINE CAN NOT 0 OUT IO-FG, USED OTHER PLACES.
           MOVE 0 TO IO-FG.
           PERFORM VERIFY-PROCEEDS.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.

           IF PD-PROCEEDS = PROCEEDS-HLDR
                      OR NEW-FLAG = 1
              MOVE "I" TO PD-PROCEEDS-FG
              GO TO CREATE-ROUTINE.
       CONT-F-12.
           MOVE "S  A010121." TO VDU.
           MOVE "I" TO VDUBUF PD-PROCEEDS-FG.
           PERFORM SCREENIO.

           MOVE "E  A010121." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT-F-12.
           MOVE VDUBUF TO PD-PROCEEDS-FG.
           IF NOT (PD-PROCEEDS-FG = "I" OR "C")
              PERFORM ICE-OR-A-MSG
              GO TO CONT-F-12.
           IF NEW-FLAG NOT = 1
      *  CITIZENS TEST
              MOVE 800 TO CIP-NO-OF-TIMES-CALLED
      *       MOVE 0 TO CIP-NO-OF-TIMES-CALLED
              MOVE PD-PROCEEDS TO CIP-PROCEEDS
              MOVE PD-PROCEEDS-FG TO CIP-PROCEEDS-SW
              PERFORM CALL-LOAN-CALCULATIONS.
           GO TO CREATE-ROUTINE.
       F-13.
           IF (GP-ENTER-LPO-FG = "Y")
              IF NEW-FLAG = 1
                 MOVE PD-LPO TO WINDOW-LPO
                 MOVE PD-REP-CD TO WINDOW-REP
                 MOVE PD-PROCESS-CD TO WINDOW-PROCESS
                 MOVE "WI/TFCCDS" TO FORM-NAM
                 CALL FORM-PROGX USING FORM-PATH WINDOW-WORKERS
                 CANCEL FORM-PROGX
                 MOVE WINDOW-LPO TO PD-LPO
                 MOVE WINDOW-REP TO PD-REP-CD
                 MOVE WINDOW-PROCESS TO PD-PROCESS-CD.
           MOVE PD-INSCODES TO INSCODES-HLDR.
           MOVE " " TO CHFG(25) CHFG(26) CHFG(27)
                       CHFG(28) CHFG(29) CHFG(30).
           MOVE VDUBUF TO PD-INSCODES.

           IF SP-INSURANCE-WRITTEN = "N"
               IF PD-INSURED NOT = "N"
                  IF PD-INSTYPES NOT = "N"
                      MOVE "INSURANCE NOT ALLOWED PER SPR"
                                                TO MESS
                      PERFORM SEND-MESS
                      GO TO ENTER-ELE.

           IF NOT (PD-INSURED = "M" OR "J" OR "N" OR "S")
              MOVE "ENTER 'N','M','S',OR 'J'" TO MESS
              PERFORM SEND-MESS
              MOVE INSCODES-HLDR TO PD-INSCODES
              GO TO ENTER-ELE.
           IF NOT PD-INSTYPES-VALID
              MOVE INSCODES-HLDR TO PD-INSCODES
              GO TO ENTER-ELE.
           IF NOT PD-INSELIGIBLE-VALID
              MOVE INSCODES-HLDR TO PD-INSCODES
              GO TO ENTER-ELE.
      * ADDED TO PREVENT ENTRY OF MNN, ETC.
           IF PD-INSTYPES = "N"
              IF PD-INSURED NOT = "N"
                 MOVE INSCODES-HLDR TO PD-INSCODES
                 GO TO ENTER-ELE.
           PERFORM VALID-INS-TYPES-ELIG.
           IF IO-FG = 9
              MOVE INSCODES-HLDR TO PD-INSCODES
              GO TO ENTER-ELE.

           IF CHFG(25) = "N"
              MOVE 0 TO PD-INSCOMP(1) PD-INSTRM(1) PD-INSCOVR(1)
                        PD-INSPREM(1)
              MOVE SPACES TO PD-INSOURS(1)
              MOVE "250 251 252 253 254 255." TO MESS
              PERFORM RESET-MESS.
           IF CHFG(26) = "N"
              MOVE 0 TO PD-INSCOMP(2) PD-INSTRM(2) PD-INSCOVR(2)
                        PD-INSPREM(2)
              MOVE SPACES TO PD-INSOURS(2)
              MOVE "260 261 262 263 264 265." TO MESS
              PERFORM RESET-MESS.
           IF CHFG(27) = "N"
              MOVE 0 TO PD-INSCOMP(3) PD-INSTRM(3) PD-INSCOVR(3)
                        PD-INSPREM(3)
              MOVE SPACES TO PD-INSOURS(3)
              MOVE "270 271 272 273 274 275." TO MESS
              PERFORM RESET-MESS.
           IF CHFG(28) = "N"
              MOVE 0 TO PD-INSCOMP(4) PD-INSTRM(4) PD-INSCOVR(4)
                        PD-INSPREM(4)
              MOVE SPACES TO PD-INSOURS(4)
              MOVE "280 281 282 283 284 285." TO MESS
              PERFORM RESET-MESS.
           IF CHFG(29) = "N"
              MOVE 0 TO PD-INSCOMP(5) PD-INSTRM(5) PD-INSCOVR(5)
                        PD-INSPREM(5) PD-INSEXP-DATE(5)
              MOVE SPACES TO PD-INSOURS(5)
              MOVE "290 291 292 293 294." TO MESS
              PERFORM RESET-MESS.
           IF CHFG(30) = "N"
              MOVE 0 TO PD-INSCOMP(6) PD-INSTRM(6) PD-INSCOVR(6)
                        PD-INSPREM(6) PD-INSEXP-DATE(6)
              MOVE SPACES TO PD-INSOURS(5)
              MOVE "300 301 302 303 304." TO MESS
              PERFORM RESET-MESS.

           IF NOT SP-SCFRMLA-POINTS
              IF NEW-FLAG = 1
                 MOVE "I" TO PD-POINTS-FG
                 GO TO CREATE-ROUTINE
              ELSE
                 GO TO CONT2-F-13.
       CONT1-F-13.
           MOVE "ENTER NO OF POINTS (99.99):" TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNN022131." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT1-F-13.
           MOVE VDUNUM2 TO PD-POINTS.
           PERFORM SP-EDT-TABLE-LOOKUP.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO CONT1-F-13.
           IF PD-POINTS = 0
              MOVE "S  A050131." TO VDU
              PERFORM SCREENIO
              IF NEW-FLAG = 1
                 MOVE "I" TO PD-POINTS-FG
                 GO TO CREATE-ROUTINE.
       CONT2-F-13.
           MOVE "S  A010132." TO VDU.
           MOVE "I" TO VDUBUF PD-POINTS-FG.
           PERFORM SCREENIO.

           MOVE "E  A010132." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "1U"
              IF SP-SCFRMLA-POINTS
                 GO TO CONT1-F-13.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT2-F-13.
           MOVE VDUBUF TO PD-POINTS-FG.
           IF NOT (PD-POINTS-FG = "I" OR "C")
              PERFORM ICE-OR-A-MSG
              GO TO CONT2-F-13.
           IF NEW-FLAG NOT = 1
              IF PD-INSCODES NOT = INSCODES-HLDR
                 MOVE 0 TO CIP-NO-OF-TIMES-CALLED
              ELSE
                 MOVE 800 TO CIP-NO-OF-TIMES-CALLED
              END-IF
              MOVE PD-INSURED TO CIP-INS-WHO
              MOVE PD-INSTYPES TO CIP-INS-TYPE
              MOVE PD-INSELIGIBLE TO CIP-INS-ELIG
              MOVE PD-POINTS TO CIP-POINTS
              MOVE PD-POINTS-FG TO CIP-POINTS-SW
              PERFORM CALL-LOAN-CALCULATIONS.
           GO TO CREATE-ROUTINE.
       F-14.
           MOVE 1 TO I-LEVEL.
           PERFORM FEE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           IF PD-FEECODE(1) = SPACES
              GO TO CREATE-ROUTINE.
       F-142.
           MOVE "F6-FEE SCAN, ENTER FEE CODE, <ENTER> = NONE:"
                                                        TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "E  A020142." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF VDUSTATUS = "1<"
              MOVE 1 TO CDCODE-FEE-FG
              PERFORM CODE-SCAN
              MOVE "00" TO VDUSTATUS
              IF IO-FG NOT = 0
                 GO TO F-142.
           IF VDUSTATUS NOT = "00"
              GO TO F-142.
           MOVE 2 TO I-LEVEL.
           PERFORM FEE-ENTRY.
           IF IO-FG = 9
              GO TO F-142.
           GO TO CREATE-ROUTINE.
       F-15.
           MOVE 3 TO I-LEVEL.
           PERFORM FEE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           IF PD-FEECODE(3) = SPACES
              GO TO CREATE-ROUTINE.
       F-152.
           MOVE "F6-FEE SCAN, ENTER FEE CODE, <ENTER> = NONE:"
                                                        TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "E  A020152." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF VDUSTATUS = "1<"
              MOVE 1 TO CDCODE-FEE-FG
              PERFORM CODE-SCAN
              MOVE "00" TO VDUSTATUS
              IF IO-FG NOT = 0
                 GO TO F-152.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-152.
           MOVE 4 TO I-LEVEL.
           PERFORM FEE-ENTRY.
           IF IO-FG = 9
              GO TO F-152.
           GO TO CREATE-ROUTINE.
       F-16.
           MOVE 5 TO I-LEVEL.
           PERFORM FEE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           IF PD-FEECODE(5) = SPACES
              GO TO CREATE-ROUTINE.
       F-162.
           MOVE "F6-FEE SCAN, ENTER FEE CODE, <ENTER> = NONE:"
                                                        TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "E  A020162." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF VDUSTATUS = "1<"
              MOVE 1 TO CDCODE-FEE-FG
              PERFORM CODE-SCAN
              MOVE "00" TO VDUSTATUS
              IF IO-FG NOT = 0
                 GO TO F-162.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-162.
           MOVE 6 TO I-LEVEL.
           PERFORM FEE-ENTRY.
           IF IO-FG = 9
              GO TO F-162.
           GO TO CREATE-ROUTINE.
       F-17.
           MOVE 7 TO I-LEVEL.
           PERFORM FEE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           IF PD-FEECODE(7) = SPACES
              GO TO CREATE-ROUTINE.
       F-172.
           MOVE "F6-FEE SCAN, ENTER FEE CODE, <ENTER> = NONE:"
                                                        TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "E  A020172." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF VDUSTATUS = "1<"
              MOVE 1 TO CDCODE-FEE-FG
              PERFORM CODE-SCAN
              MOVE "00" TO VDUSTATUS
              IF IO-FG NOT = 0
                 GO TO F-172.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-172.
           MOVE 8 TO I-LEVEL.
           PERFORM FEE-ENTRY.
           IF IO-FG = 9
              GO TO F-172.
           GO TO CREATE-ROUTINE.
       F-18.
           MOVE 9 TO I-LEVEL.
           PERFORM FEE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           IF PD-FEECODE(9) = SPACES
              GO TO CREATE-ROUTINE.
       F-182.
           MOVE "F6-FEE SCAN, ENTER FEE CODE, <ENTER> = NONE:"
                                                        TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "E  A020182." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF VDUSTATUS = "1<"
              MOVE 1 TO CDCODE-FEE-FG
              PERFORM CODE-SCAN
              MOVE "00" TO VDUSTATUS
              IF IO-FG NOT = 0
                 GO TO F-182.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-182.
           MOVE 10 TO I-LEVEL.
           PERFORM FEE-ENTRY.
           IF IO-FG = 9
              GO TO F-182.
           GO TO CREATE-ROUTINE.
       F-19.
           MOVE VDUNUM2 TO PD-DLNO DL-DLNO.
           PERFORM GET-DL1.
           MOVE "S  A150191." TO VDU.
           MOVE DL-SHORT TO VDUBUF.
           PERFORM SCREENIO.
           IF IO-FG = 9
              GO TO ENTER-ELE.

           IF DL-TERMDATE NOT = 0
              IF DL-TERMDATE NOT > PD-LOANDATE
                 MOVE "DEALER HAS BEEN TERMINATED" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.

           MOVE "SIGN:" TO INSPECT-W.
           MOVE DL-SIGN1 TO ADD-ON.
           PERFORM ADD-IT2.
           MOVE DL-SIGN2 TO ADD-ON.
           PERFORM ADD-IT2.
           MOVE DL-SIGN3 TO ADD-ON.
           PERFORM ADD-IT.
           MOVE INSPECT-W TO MESS.
           PERFORM CALL-TMMSG.
           GO TO CREATE-ROUTINE.
       F-20.
           MOVE VDUBUF TO PD-COLLID.
           IF PD-COLLID = " "
              MOVE SPACES TO WK-HHGS-1
      *       PERFORM SAVE-TRAILER-REC
              MOVE "200 201 202." TO MESS
              PERFORM RESET-MESS
              GO TO CREATE-ROUTINE.
           IF F3-YES
              GO TO CREATE-ROUTINE.
       CONT1-F-20.
           MOVE "E  A200201." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT1-F-20.
           MOVE VDUBUF TO SCREEN-LINE1 WK-HHGS-1.
           IF SCREEN-LINE1 = " "
              MOVE "201 202." TO MESS
              PERFORM RESET-MESS
      *       PERFORM SAVE-TRAILER-REC
              GO TO CREATE-ROUTINE.
       CONT2-F-20.
           MOVE "E  A200202." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO CONT1-F-20.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT2-F-20.
           MOVE VDUBUF TO SCREEN-LINE2.
           IF SCREEN-LINE2 = " "
              MOVE "202." TO MESS
              PERFORM RESET-MESS
      *       PERFORM SAVE-TRAILER-REC
              GO TO F-20-EXIT.
           STRING SCREEN-LINE1,SCREEN-LINE2
                  DELIMITED BY "   " INTO WK-HHGS-1.
       F-20-EXIT.
      *    PERFORM SAVE-TRAILER-REC.
           MOVE MSG-LINE1 TO PD-MSG1.
           MOVE MSG-LINE2 TO PD-MSG2.
           GO TO CREATE-ROUTINE.
       F-21.
           MOVE VDUNUM3 TO PD-OVRDRATE.
       CONT-F-21.
           MOVE "E  A010211." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT-F-21.
           MOVE VDUBUF TO PD-OVRDRATE-FG.

           IF SP-CAL-FLAT-MONTHLY(1)
              IF PD-OVRDRATE-FG = "E"
                 MOVE "EFFECTIVE RATE OVERRIDE NOT ALLOWED" TO MESS
                 PERFORM SEND-MESS
                 GO TO CONT-F-21.
           IF NOT (PD-OVRDRATE-FG = "C" OR "E" OR "A")
              PERFORM ICE-OR-A-MSG
              GO TO CONT-F-21.

           PERFORM VALIDATE-FIELDS-AGAINST-MAX.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.

           IF NEW-FLAG NOT = 1
              MOVE PD-OVRDRATE TO CIP-OVR-RATE
              MOVE PD-OVRDRATE-FG TO CIP-OVR-RATE-SW
              MOVE 800 TO CIP-NO-OF-TIMES-CALLED
              PERFORM CALL-LOAN-CALCULATIONS.
           GO TO CREATE-ROUTINE.
       F-22.
           MOVE VDUNUM3 TO PD-EFFRATE.
           GO TO CREATE-ROUTINE.
       F-23.
           MOVE VDUNUM3 TO PD-APRATE.
           GO TO CREATE-ROUTINE.
       F-24.
           MOVE VDUNUM3 TO PD-ENDORATE.
           GO TO CREATE-ROUTINE.
       F-25.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-26.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-27.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-28.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-29.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-30.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-31.
           MOVE PD-SERCHG TO AMT-HOLDER.
           MOVE VDUNUM2 TO PD-SERCHG PD-SUM-SERCHG.
           PERFORM VALIDATE-FIELDS-AGAINST-MAX.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.
           IF PD-SERCHG = AMT-HOLDER
              GO TO CREATE-ROUTINE.
       CONT-F-31.
           MOVE "S  A010311." TO VDU.
           MOVE "I" TO VDUBUF PD-SERCHG-FG.
           PERFORM SCREENIO.

           MOVE "E  A010311." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT-F-31.
           MOVE VDUBUF TO PD-SERCHG-FG.
           IF NOT (PD-SERCHG-FG = "I" OR "C")
              PERFORM ICE-OR-A-MSG
              GO TO CONT-F-31.
           IF NEW-FLAG NOT = 1
      *       --> NOTE: SCFRMLA 33 AND 39 HAVE 2 COMPONENTS, MUST USE F3
      *                 TO INDICATE DISTRIBUTION, RE: WI/SCHG33.C
              IF (PD-SERCHG-FG = "I") AND
                 (SP-SCFRMLA = 33 OR 39   )
                 MOVE "MUST USE F3 DISTRIBUTION WINDOW" TO MESS
                 PERFORM SEND-MESS
                 MOVE "SNNN062310." TO VDU
                 MOVE AMT-HOLDER    TO PD-SERCHG
                                       VDUNUM2
                 PERFORM SCREENIO
                 GO TO ENTER-ELE
              ELSE
                 MOVE PD-SERCHG TO CIP-SERVICE-CHG
                 MOVE PD-SERCHG-FG TO CIP-SERVICE-CHG-SW
                 PERFORM CALL-LOAN-CALCULATIONS.
           GO TO CREATE-ROUTINE.
       F-32.
           MOVE VDUNUM2 TO SAVE-MAINTFEE.
           DIVIDE VDUNUM2 BY PD-ORGTERM GIVING PD-MAINTFEE ROUNDED.
           COMPUTE PD-SUM-MAINTFEE = PD-MAINTFEE * PD-ORGTERM.
           PERFORM VALIDATE-FIELDS-AGAINST-MAX.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.
           IF VDUNUM2 = MAINTFEE-HLDR
              GO TO CREATE-ROUTINE.
       CONT-F-32.
           MOVE "S  A010321." TO VDU.
           MOVE "I" TO VDUBUF PD-MAINTFEE-FG.
           PERFORM SCREENIO.

           MOVE "E  A010321." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT-F-32.
           MOVE VDUBUF TO PD-MAINTFEE-FG.
           IF NOT (PD-MAINTFEE-FG = "I" OR "C")
              PERFORM ICE-OR-A-MSG
              GO TO CONT-F-32.
           IF NEW-FLAG NOT = 1
              IF SP-MFFRMLA-05
                 MOVE SAVE-MAINTFEE TO CIP-MAINT-FEES
              ELSE
              MULTIPLY PD-MAINTFEE BY PD-ORGTERM GIVING
                 CIP-MAINT-FEES ROUNDED.
              MOVE PD-MAINTFEE-FG TO CIP-MAINT-FEES-SW
              PERFORM CALL-LOAN-CALCULATIONS.
           GO TO CREATE-ROUTINE.
       F-33.
           MOVE PD-EXTCHG TO AMT-HOLDER.
           MOVE VDUNUM2 TO PD-EXTCHG PD-EXTCHG.
           PERFORM VALIDATE-FIELDS-AGAINST-MAX.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-ELE.
           IF PD-EXTCHG = AMT-HOLDER
              GO TO CREATE-ROUTINE.
       CONT-F-33.
           MOVE "S  A010331." TO VDU.
           MOVE "I" TO VDUBUF PD-EXTCHG-FG.
           PERFORM SCREENIO.

           MOVE "E  A010331." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT-F-33.
           MOVE VDUBUF TO PD-EXTCHG-FG.
           IF NOT (PD-EXTCHG-FG = "I" OR "C")
              PERFORM ICE-OR-A-MSG
              GO TO CONT-F-33.
           IF NEW-FLAG NOT = 1
              MOVE PD-EXTCHG TO CIP-1ST-PY-EXT
              MOVE PD-EXTCHG-FG TO CIP-1ST-PY-EXT-SW
              PERFORM CALL-LOAN-CALCULATIONS.
           GO TO CREATE-ROUTINE.
       F-34.
           GO TO CREATE-ROUTINE.
       F-35.
           GO TO CREATE-ROUTINE.
       F-36.
           GO TO CREATE-ROUTINE.
       F-37.
           GO TO CREATE-ROUTINE.
       F-38.
           MOVE PD-REGPYAMT TO AMT-HOLDER.
           MOVE VDUNUM2 TO PD-REGPYAMT PD-SUM-REGPYAMT.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           IF VDUNUM2 = 0
              GO TO ENTER-ELE.
           IF PD-REGPYAMT = AMT-HOLDER
              GO TO CREATE-ROUTINE.
       CONT-F-38.
           MOVE "S  A010381." TO VDU.
           MOVE "I" TO VDUBUF PD-REGPYAMT-FG.
           PERFORM SCREENIO.

           MOVE "E  A010381." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT-F-38.
           MOVE VDUBUF TO PD-REGPYAMT-FG.
           IF NOT (PD-REGPYAMT-FG = "I" OR "C")
              PERFORM ICE-OR-A-MSG
              GO TO CONT-F-38.

           IF NEW-FLAG NOT = 1
      *  CITIZENS TEST
              MOVE 800 TO CIP-NO-OF-TIMES-CALLED
              MOVE PD-REGPYAMT TO CIP-REG-PAYMENT
              MOVE PD-REGPYAMT-FG TO CIP-REG-PAYMENT-SW
              PERFORM CALL-LOAN-CALCULATIONS.

           GO TO CREATE-ROUTINE.
       END-ENTRY-MODULE.
           EXIT.

      ***********************************
       BORROWER-ENTRY SECTION.
      ***********************************
      * SET BORR-CHG-FG FOR GEORGIA SERVICE CHARGE CALC:
           IF NEW-FLAG NOT = 1
              MOVE "Y" TO BORR-CHG-FG.

           MOVE 0 TO IO-FG.
           MOVE " " TO IO-TYPE.
           MOVE VDUBUF TO ALP-BW.
           MOVE ALP-BW123 TO NUM-BW123.
           MOVE ALP-BW45 TO NUM-BW45.
           MOVE ALP-BW6789 TO NUM-BW6789.
           IF NUM-BW NOT NUMERIC
              MOVE 0 TO NUM-BW.
           MOVE NUM-BW TO BW-SSNO.

           IF ELE = 1
              IF LOAN-QUOTE-FG = "Q"
                 IF NUM-BW NOT = 0
                    MOVE 9 TO IO-FG
                    GO TO EXIT-ENTER-BORROWER
                 ELSE
                    PERFORM BORROWER-QUOTED
                    IF IO-FG NOT = 9
                       MOVE "Q" TO QUOTE-ID-FG PD2-ID
                       MOVE EXT-CONAME-USER-LOC TO PD2-BRANCH
                       GO TO EXIT-ENTER-BORROWER
                    ELSE
                       MOVE "CLR" TO IO-TYPE
                       GO TO EXIT-ENTER-BORROWER.

           MOVE 0 TO BW-SSNO.
           MOVE " " TO INSPECT-W.
       NEXT-BW-CLEAR.
           MOVE 0 TO PD-SSNO(ELE).
           MOVE " " TO PD-MAKERCD(ELE).
           PERFORM SEND-BW-NO-NAME.
           PERFORM SEND-BW-MAKERCD.
           IF ELE < 4
              ADD 1 TO ELE
              GO TO NEXT-BW-CLEAR.
           PERFORM BW-CHECK-ENDORSER.
           MOVE 0 TO IO-FG.
           GO TO EXIT-ENTER-BORROWER.
       GET-BORROWER.
           PERFORM BW-TABLE-CHECK.
           IF IO-FG = 9
              GO TO EXIT-ENTER-BORROWER.
           PERFORM OPEN-BW1-FILE.
           PERFORM GET-BW1.
           PERFORM CLOSE-BW1-FILE.
           PERFORM SEND-BW-NAME.
           IF IO-FG = 9
              GO TO EXIT-ENTER-BORROWER.
           MOVE " " TO CHFG(2) CHFG(3) CHFG(4) CHFG(6) CHFG(7).
           IF ELE = 1 AND QUOTE-ONLY
              MOVE "L" TO QUOTE-ID-FG.
           IF ELE = 1
              MOVE "M" TO PD-MAKERCD(1)
              PERFORM SEND-BW-MAKERCD
              MOVE BW-CONFIDENTIAL TO PD-CONFIDENTCD
              MOVE BW-ORIGIN TO PD-ORIGIN
              GO TO EXIT-ENTER-BORROWER.
       ENTER-MAKER-CODE.
           MOVE "E  A010  2." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              MOVE 9 TO IO-FG
              GO TO EXIT-ENTER-BORROWER.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-MAKER-CODE.
           IF NOT (VDUBUF = "J" OR "E")
              MOVE "(M-MAKER),J-JOINT,E-ENDORSER" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-MAKER-CODE.
           MOVE VDUBUF TO PD-MAKERCD(ELE).

       EXIT-ENTER-BORROWER.
           EXIT.

      ***********************************
       BW-TABLE-CHECK SECTION.
      ***********************************
           IF ELE NOT = 1
              SUBTRACT 1 FROM ELE GIVING I-LEVEL
              IF PD-SSNO(I-LEVEL) = 0
                 MOVE 9 TO IO-FG
                 MOVE "ENTER SERIALLY" TO MESS
                 PERFORM SEND-MESS
                 GO TO EXIT-BW-TABLE-CHECK.
           MOVE 4 TO I-LEVEL.
       NEXT-BW-LEVEL-CHECK.
           IF PD-SSNO(I-LEVEL) = PD-SSNO(ELE) AND I-LEVEL NOT = ELE
              MOVE 9 TO IO-FG
              MOVE "NO DUPLICATES" TO MESS
              PERFORM SEND-MESS
              GO TO EXIT-BW-TABLE-CHECK.
           SUBTRACT 1 FROM I-LEVEL.
           IF I-LEVEL > 0
              GO TO NEXT-BW-LEVEL-CHECK.
       EXIT-BW-TABLE-CHECK.
           EXIT.

      ***********************************
       BW-CHECK-ENDORSER SECTION.
      ***********************************
           MOVE 0 TO I-LEVEL.
       NEXT-ENDORSER-CHECK.
           ADD 1 TO I-LEVEL.
           IF PD-MAKERCD(I-LEVEL) = "E"
              MOVE " " TO CHFG(20)
              GO TO EXIT-CHECK-ENDORSER.
           IF I-LEVEL < 4
              GO TO NEXT-ENDORSER-CHECK.
       EXIT-CHECK-ENDORSER.
           EXIT.

      ***********************************
       SUBCLASS-SCAN SECTION.
      ***********************************
           MOVE SPACES              TO SCSCAN-SP1-KEY.
           MOVE PD-ORGST            TO SCSCAN-ORGST.
           MOVE PD-CLASS            TO SCSCAN-SPRCLASS.
           MOVE 0                   TO SCSCAN-SUBCLASS
                                       SCSCAN-LAWCODE.
           MOVE "Y"                 TO SCSCAN-LAST-LAW.
           MOVE TRANS-DATE-YYYYMMDD TO SCSCAN-TRANS-DATE.
           MOVE "WI/SCSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH SCSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF SCSCAN-STATUS NOT = "00" OR SCSCAN-SP1-KEY = " "
              MOVE 9 TO IO-FG
              GO TO EXIT-SUBCLASS-SCAN
           ELSE
              MOVE 0 TO IO-FG.
           MOVE "SNNN020052." TO VDU.
           MOVE SCSCAN-SP-SUBCLASS TO VDUNUM0.
           PERFORM SCREENIO.
           MOVE SCSCAN-SP-SUBCLASS TO VDUNUM0.

       EXIT-SUBCLASS-SCAN.
           EXIT.

      ***********************************
       BORROWER-SCAN SECTION.
      ***********************************
           MOVE 0   TO BWSCAN-NO.
           MOVE "S" TO BWSCAN-SCAN-TYPE.
           MOVE "WI/BWSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH BWSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF BWSCAN-STATUS NOT = "00" OR BWSCAN-NO = 0
               MOVE 9 TO IO-FG
               GO TO EXIT-BORROWER-SCAN.
           MOVE BWSCAN-NO TO BW-SSNO.
           PERFORM NUMBW-TO-ALPBW.
           MOVE "S  A110  0." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE ALP-BW TO VDUBUF.
           PERFORM SCREENIO.
           MOVE ALP-BW TO VDUBUF.
           MOVE 0 TO IO-FG.

       EXIT-BORROWER-SCAN.
           EXIT.


      ***********************************
       BWLN-SCAN SECTION.
      ***********************************
           MOVE TRANS-DATE-YYYYMMDD TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-ALPDATE.
           MOVE ALP-DATE TO BWLNSC-SYSDATE.
           MOVE 0        TO BWLNSC-ACCTNO.
           MOVE "WI/BWLNSC " TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH BWLNSC-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF BWLNSC-STATUS NOT = "00" OR BWLNSC-ACCTNO = 0
              MOVE 9 TO IO-FG
              GO TO EXIT-BWLN-SCAN.

           MOVE "SNNN060110." TO VDU.
           MOVE BWLNSC-ACCTNO TO VDUNUM0.
           PERFORM SCREENIO.

           MOVE BWLNSC-ACCTNO TO VDUNUM0.
           MOVE 0 TO IO-FG.
       EXIT-BWLN-SCAN.
           EXIT.

      ******************************************************************
       FEECODE-SCAN SECTION.
      ******************************************************************
           MOVE "GC"                TO CDBSCN-TYPE.
           MOVE EXT-CONAME-USER-LOC TO CDBSCN-BRANCH.
           MOVE SPACES              TO CDBSCN-CODE.

           MOVE "WI/CDBSCN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CDBSCN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF ( CDBSCN-STATUS NOT = "00") OR (CDBSCN-CODE = SPACES) 
              MOVE 9 TO IO-FG
              GO TO EXIT-FEECODE-SCAN.

           IF CDCODE-FEE-FG = 0
              MOVE "S  A030  0." TO VDU
              MOVE ELE TO VDUROW
              MOVE CDBSCN-CODE TO VDUBUF
              PERFORM SCREENIO
           ELSE
              MOVE "S  A020  2." TO VDU
              MOVE ELE TO VDUROW
              MOVE CDBSCN-CODE TO VDUBUF
              PERFORM SCREENIO.

           MOVE CDBSCN-CODE TO VDUBUF.

       EXIT-FEECODE-SCAN.
           EXIT.

      ***********************************
       CODE-SCAN SECTION.
      ***********************************

           MOVE SPACES TO CDSCAN-CODE.

           IF ( ELE = 8 )
              MOVE "PU"   TO CDSCAN-TYPE
           ELSE
           IF ( ELE = 9 )
              MOVE "CO"   TO CDSCAN-TYPE
           ELSE
           IF ( ELE = 10 )
              MOVE "SR"   TO CDSCAN-TYPE
           ELSE
              PERFORM FEECODE-SCAN
              GO TO EXIT-CODE-SCAN.

           MOVE "WI/CDSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CDSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF ( CDSCAN-STATUS NOT = "00" ) OR
              (( CDSCAN-TYPE = "PU") AND (CDSCAN-CODE = SPACES )) OR
              (( CDSCAN-TYPE = "CO") AND (CDSCAN-CODE = SPACES )) OR
              (( CDSCAN-TYPE = "SR") AND (CDSCAN-CODE = SPACES )) 
               MOVE 9 TO IO-FG
               GO TO EXIT-CODE-SCAN.

           MOVE "S  A030  0." TO VDU
           MOVE ELE TO VDUROW
           MOVE CDSCAN-CODE TO VDUBUF
           PERFORM SCREENIO.

           MOVE CDSCAN-CODE TO VDUBUF.
           MOVE 0 TO IO-FG.

       EXIT-CODE-SCAN.
           EXIT.

      ***************************************************
       QUOTE-SCAN SECTION.
      ***************************************************
           MOVE EXT-CONAME-USER-LOC TO PDSCAN-BRANCH.
           MOVE SPACES              TO PDSCAN-VERIFY.
           MOVE "N"                 TO PDSCAN-SALEFIN.
           MOVE SPACES              TO PDSCAN-BWNAME.
           MOVE "WI/PDSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PDSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF PDSCAN-STATUS NOT = "00" OR PDSCAN-BWNAME = SPACES
              MOVE 9 TO IO-FG
           ELSE
              MOVE 0 TO IO-FG.

       EXIT-QUOTE-SCAN.
           EXIT.

      ***************************************************
       CAN-LOAN-SCAN SECTION.
      ***************************************************
           PERFORM SET-CLFILE-INDEX-BY.

           MOVE " " TO CLSCAN-NON-MONTHLY.
           MOVE 1   TO CLSCAN-SCAN-TYPE.
           MOVE "WI/CLSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CLSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF CLSCAN-STATUS NOT = "00" OR CLSCAN-CAN-NO = " "
               MOVE 9 TO IO-FG
            ELSE
               MOVE 0 TO IO-FG.

       EXIT-CAN-LOAN-SCAN.
           EXIT.


      **************************************
       CLASS-SCAN SECTION.
      **************************************
           MOVE 0      TO LCSCAN-KEY.
           MOVE SPACES TO LCSCAN-VERIFY.
           MOVE "N"    TO LCSCAN-SALEFIN.
           MOVE "WI/LCSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH LCSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF LCSCAN-STATUS NOT = "00" OR LCSCAN-KEY = 0
              MOVE 9 TO IO-FG
              GO TO EXIT-CLASS-SCAN.

           MOVE "SN N020LNKEY." TO VDU.
           MOVE LCSCAN-KEY TO VDUNUM0.
           PERFORM SCREENIO.
           MOVE LCSCAN-KEY TO VDUNUM0.
           MOVE 0 TO IO-FG.

       EXIT-CLASS-SCAN.
           EXIT.

      **************************************
       DEALER-SCAN SECTION.
      **************************************
           MOVE 0 TO DLSCAN-NUM.
           MOVE "WI/DLSCAN " TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH DLSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF DLSCAN-STATUS NOT = "00" OR DLSCAN-NUM = " "
               MOVE 9 TO IO-FG
               GO TO EXIT-DEALER-SCAN.
           MOVE "SN N042190." TO VDU.
           MOVE DLSCAN-DLNO TO VDUNUM2.
           PERFORM SCREENIO.
           MOVE DLSCAN-DLNO TO VDUNUM2.
           MOVE 0 TO IO-FG.

       EXIT-DEALER-SCAN.
           EXIT.

      **************************************
       INSCOMP-SCAN SECTION.
      **************************************
           MOVE 0 TO ICSCAN-KEY.
           MOVE "WI/ICSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH ICSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF ICSCAN-STATUS NOT = "00" OR ICSCAN-KEY = ZEROES
              MOVE 9 TO IO-FG.

       EXIT-INSCOMP-SCAN.
           EXIT.

      ***********************************************************************
      *    SETUP W12EQ2 WINDOW FOR DISPLAY
      *          FORMULA 12 LIKE 2 BUT SPREADS 1STPAY EXTENSION CHARGE
      *          OVER PAYMENTS
      *                                                        CITIZENS #2006
      ***********************************************************************
       W12EQ2-WINDOW SECTION.
           MOVE PD-OVRDRATE         TO W12EQ2-OVRDRATE.
           MOVE PD-OVRDRATE-FG      TO W12EQ2-OVRDRATE-FG.
           MOVE PD-EFFRATE          TO W12EQ2-EFFRATE.
           MOVE PD-EXTCHG           TO W12EQ2-EXTCHG.

           MOVE PD-ORGTERM          TO W12EQ2-ORGTERM.
           MOVE PD-1STPYAMT         TO W12EQ2-1STPYAMT.
           MOVE PD-REGPYAMT         TO W12EQ2-REGPYAMT.
           MOVE PD-LASTPYAMT        TO W12EQ2-LASTPYAMT.
           PERFORM GET-W12EQ2-NEW-PAYMENTS.

           MOVE PD-APR-FINAMT       TO APR-FINANCED.
           MOVE PD-INTDATE          TO APR-INTDATE.
           MOVE PD-1STPYDATE        TO APR-1STPYDATE.
           MOVE PD-ORGTERM          TO APR-ORGTERM.
           MOVE W12EQ2-1STPYAMT     TO APR-1STPYAMT.
           MOVE W12EQ2-REGPYAMT     TO APR-REGPYAMT.
           MOVE W12EQ2-LASTPYAMT    TO APR-LASTPYAMT.
           MOVE PD-UNITPER-CD       TO APR-UNITPER-CD.
           MOVE PD-UNITPER-FREQ     TO APR-UNITPER-FREQ.
           MOVE SP-DISFRMLA         TO APR-DISFRMLA.
           PERFORM APR-REGZ.
           MOVE APR-APR             TO W12EQ2-APRATE.
           MOVE "WI/W12EQ2"  TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH
                                W12EQ2-BUF.
           CANCEL FORM-PROGX.

       W12EQ2-WINDOW-EXIT.
           EXIT.

      ***************************************************
       VERIFY-PASSWORD SECTION.
      ***************************************************
           MOVE " " TO PASSWDW-STAT.
           MOVE "XONPC0" TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           MOVE "CL/PASSWD" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.

      ***********************************
       VERIFY-WRITE SECTION.
      ***********************************
           MOVE 0 TO IO-FG.

           IF ( SP-CAN-LOANS-ONLY ) AND ( CAN-LOAN-NO = " " )
              MOVE " THIS SPR IS FOR CAN LOANS ONLY, SAVE NOT ALLOWED!"
                                                           TO MESS
              PERFORM SEND-MESS
              MOVE 9 TO IO-FG.

      ****************************
       BORROWER-QUOTED SECTION.
      ****************************
           MOVE "F1-CLEAR, ENTER LOAN QUOTE ID:" TO LEGEND.
           PERFORM SEND-LEGEND.

           MOVE "E  A330011." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              MOVE 9 TO IO-FG
              GO TO EXIT-BORROWER-QUOTED.
           MOVE VDUBUF TO PD2-BWNAME SAVE-BW-NAME.
           IF VDUSTATUS NOT = "00"
                     OR VDUBUF = SPACES
                      OR (CAN-LOAN-NO NOT = " "
                                 AND CL-DESC = PD2-BWNAME)
               GO TO BORROWER-QUOTED.

           MOVE "M" TO PD-MAKERCD(1).
           IF NEW-FLAG = 1
              MOVE "N" TO CHFG(14) CHFG(15) CHFG(16)
                          CHFG(17) CHFG(18).
           IF NEW-FLAG = 1
                   OR PD2-BWNAME NOT = HOLD-BWNAME
              NEXT SENTENCE
           ELSE
              MOVE SAVE-QUOTE-SSN TO PD-SOC-SEC
                                     PD-SSNO(1)
              GO TO BORROWER-QUOTED-CONT.

      * BUILD-QUOTE-SSN:
       BORROWER-QUOTED-BUILD-SSN.
           MOVE PD2-BWNAME TO HASH-BUF.
           MOVE 33 TO HASH-SIZE.
           PERFORM HASH-ROUTINE.
           MOVE HASH-TOTAL TO PD-SSNO(1).

      * TEST FOR DUPLICATES:
           MOVE PD-RECORD TO HOLD-PD-RECORD.
           MOVE "Q" TO PD-ID.
           MOVE EXT-CONAME-USER-LOC TO PD-BRANCH.
           MOVE PD-SSNO(1) TO PD-SOC-SEC.
           PERFORM OPEN-PD1-FILE.
           PERFORM READ-PD1-FILE.
           PERFORM CLOSE-PD1-FILE.
           MOVE HOLD-PD-RECORD TO PD-RECORD.
           IF IO-FG = 0
              MOVE "A QUOTE ALREADY EXISTS UNDER THIS ID!" TO MESS
              PERFORM SEND-MESS
              GO TO BORROWER-QUOTED.

       BORROWER-QUOTED-CONT.
           MOVE 0 TO IO-FG.
           MOVE "M" TO PD-MAKERCD(1).
           PERFORM SEND-BW-MAKERCD.

           MOVE "N" TO CHFG(2) CHFG(3) CHFG(4) CHFG(6) CHFG(7).

       EXIT-BORROWER-QUOTED.
           EXIT.

      ***********************************
       INSURANCE-ENTRY SECTION.
      ***********************************
           MOVE 0 TO IO-FG.
           SUBTRACT 24 FROM ELE GIVING I-LEVEL.
           MOVE PD-INSCOMP(I-LEVEL) TO INSCOMP-HLDR.
           MOVE VDUNUM0 TO PD-INSCOMP(I-LEVEL) IC-CODE.
           IF IC-CODE = 0
              IF I-LEVEL > 4
                 GO TO ENTER-IC-OURS
              ELSE
                 MOVE 9 TO IO-FG
                 GO TO EXIT-ENTER-INSURANCE.

      * TEST PASSWD TO CHANGE DEFAULT INSURANCE COMPANY ON CL,AH,PP,O1
           IF I-LEVEL < 5
              IF IC-CODE NOT = INSCOMP-HLDR
                 MOVE INSCO-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE INS. COMPANY....:" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE INSCOMP-HLDR TO PD-INSCOMP(I-LEVEL)
                    MOVE "SNNN020  0." TO VDU
                    MOVE ELE TO VDUROW
                    MOVE INSCOMP-HLDR TO VDUNUM0
                    PERFORM SCREENIO
                    MOVE 9 TO IO-FG
                    GO TO EXIT-ENTER-INSURANCE.

           PERFORM OPEN-IC1-FILE.
           PERFORM READ-IC1-FILE.
           PERFORM CLOSE-IC1-FILE.
           IF IO-FG = 9
              MOVE "INVALID COMPANY" TO MESS
              PERFORM SEND-MESS
              MOVE INSCOMP-HLDR TO PD-INSCOMP(I-LEVEL)
              MOVE "SNNN020  0." TO VDU
              MOVE ELE TO VDUROW
              MOVE INSCOMP-HLDR TO VDUNUM0
              PERFORM SCREENIO
              GO TO EXIT-ENTER-INSURANCE.
           IF I-LEVEL > 4
              IF PD-INSEXP-DATE(I-LEVEL) = 0
                 IF GP-OT-INS-TERM = "Y"
                    MOVE "I" TO PD-INS-FG(I-LEVEL)
                    MOVE "SNNN060  2." TO VDU
                    MOVE ELE TO VDUROW
                    MOVE PD-ORGTERM TO VDUNUM0 PD-INSEXP-DATE(I-LEVEL)
                    PERFORM SCREENIO
                 ELSE
                    MOVE PD-INTDATE TO NDTE-DATE
                    MOVE PD-ORGTERM TO NDTE-HOLD
                    PERFORM INCREMENT-MONTHS
                    MOVE "SNNN060  2." TO VDU
                    MOVE ELE TO VDUROW
                    MOVE NDTE-DATE TO PD-INSEXP-DATE(I-LEVEL)
                                      DATE-YYYYMMDD
                    PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
                    MOVE DATE-MMDDYY TO VDUNUM0 
                    PERFORM SCREENIO.
       ENTER-IC-OURS.
           IF IC-CODE = 0
              MOVE " " TO PD-INSOURS(I-LEVEL)
              GO TO SEND-IC-OURS.
           IF ELE = 30
              IF GP-DEFAULT-O3-INSOURS NOT = " "
                 MOVE "S  A010301." TO VDU
                 MOVE GP-DEFAULT-O3-INSOURS TO VDUBUF
                 PERFORM SCREENIO.
           MOVE "SPACE = Y" TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "R  A010  1." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              MOVE 9 TO IO-FG
              GO TO EXIT-ENTER-INSURANCE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-IC-OURS.
           IF VDUBUF = " "
              MOVE "Y" TO VDUBUF.
           IF NOT (VDUBUF = "Y" OR "M")
              MOVE "Y-YES, M-MEMO" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-IC-OURS.
           IF GP-DEFAULT-O3-INSOURS NOT = " "
              IF ELE = 30
                 IF GP-DEFAULT-O3-INSOURS NOT = VDUBUF
                    MOVE " " TO MESS
                    STRING "INSURANCE OURS MUST BE '"
                               GP-DEFAULT-O3-INSOURS
                                "', PLEASE CHANGE!"
                           DELIMITED BY SIZE INTO MESS
                    PERFORM SEND-MESS
                    GO TO ENTER-IC-OURS.
           MOVE PD-INSOURS(I-LEVEL) TO INSOURS-HLDR.
           MOVE VDUBUF TO PD-INSOURS(I-LEVEL).
       SEND-IC-OURS.
           MOVE "S  A010  1." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INSOURS(I-LEVEL) TO VDUBUF.
           PERFORM SCREENIO.

           PERFORM RESET-LEGEND.
           IF IC-CODE NOT = 0
              IF SP-DEFAULT-O2-INS-COMP NUMERIC AND
                   SP-DEFAULT-O2-INS-COMP NOT = 0
                 IF ELE = 29
                   IF PD-INSOURS(I-LEVEL) = "Y"
                    IF IC-CODE NOT = SP-DEFAULT-O2-INS-COMP
                       MOVE " " TO MESS
                       STRING "INSURANCE COMPANY MUST BE "
                               SP-DEFAULT-O2-INS-COMP
                                ", PLEASE CHANGE!"
                           DELIMITED BY SIZE INTO MESS
                       PERFORM SEND-MESS
                       MOVE 9 TO IO-FG
                       GO TO EXIT-ENTER-INSURANCE.
           IF IC-CODE NOT = 0 AND GP-DEFAULT-O3-INS-COMPANY NOT = 0
              IF ELE = 30
                 IF PD-INSOURS(I-LEVEL) = "Y"
                    IF IC-CODE NOT = GP-DEFAULT-O3-INS-COMPANY
                       MOVE " " TO MESS
                       STRING "INSURANCE COMPANY BUT BE "
                               GP-DEFAULT-O3-INS-COMPANYX
                                ", PLEASE CHANGE!"
                           DELIMITED BY SIZE INTO MESS
                       PERFORM SEND-MESS
                       MOVE 9 TO IO-FG
                       GO TO EXIT-ENTER-INSURANCE.
       ENTER-IC-TERM.
           IF I-LEVEL > 4 AND GP-OT-INS-TERM NOT = "Y"
              GO TO ENTER-IC-EXP.
           IF IC-CODE = 0
              MOVE 0 TO PD-INSTRM(I-LEVEL)
              GO TO SEND-IC-TERM.
           IF I-LEVEL > 4 AND GP-OT-INS-TERM = "Y"
              MOVE "RNNN060  2." TO VDU
           ELSE
              MOVE "RNNN030  2." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-IC-OURS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-IC-TERM.
           IF ( VDUNUM0 > 360 )
              GO TO ENTER-IC-TERM.

           IF VDUNUM0 NOT = PD-INSTRM(I-LEVEL)
              MOVE INSTERM-SEQ TO PASSWDW-SEQ
              MOVE "TO CHANGE INS TERM...:" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 IF I-LEVEL > 4 AND GP-OT-INS-TERM = "Y"
                    MOVE "SN N060  2." TO VDU
                 ELSE
                    MOVE "SN N030  2." TO VDU
                 END-IF
                 MOVE ELE TO VDUROW
                 MOVE PD-INSTRM(I-LEVEL) TO VDUNUM0
                 PERFORM SCREENIO
                 MOVE 9 TO IO-FG
                 GO TO ENTER-IC-TERM.

           MOVE PD-INSTRM(I-LEVEL) TO INSTERM-HLDR.
           MOVE VDUNUM0 TO PD-INSTRM(I-LEVEL).
       SEND-IC-TERM.
           IF I-LEVEL > 4 AND GP-OT-INS-TERM = "Y"
              MOVE "SN N060  2." TO VDU
           ELSE
              MOVE "SN N030  2." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INSTRM(I-LEVEL) TO VDUNUM0.
           PERFORM SCREENIO.
           GO TO ENTER-IC-COVR.
       ENTER-IC-EXP.
           IF IC-CODE = 0
              MOVE 0 TO PD-INSEXP-DATE(I-LEVEL)
              GO TO SEND-IC-EXP.

           MOVE "RNNN060  2." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-IC-OURS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-IC-EXP.
           IF VDUNUM0 = 0
              GO TO ENTER-IC-EXP.

      * NOT ENTERED AS SCREENIO DATE
           MOVE VDUNUM0 TO DATE-MMDDYY.
           PERFORM CONVERT-MMDDYY-TO-YYYYMMDD.
           IF DATE-YYYYMMDD NOT = PD-INSEXP-DATE(I-LEVEL)
              MOVE INSTERM-SEQ TO PASSWDW-SEQ
              MOVE "TO CHANGE INS EXPIRATION:" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "SNNN060  2." TO VDU
                 MOVE ELE TO VDUROW
                 MOVE PD-INSEXP-DATE(I-LEVEL) TO DATE-YYYYMMDD
                 PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
                 MOVE DATE-MMDDYY TO VDUNUM0
                 PERFORM SCREENIO
                 MOVE 9 TO IO-FG
                 GO TO ENTER-IC-EXP.

           MOVE DATE-YYYYMMDD TO PD-INSEXP-DATE(I-LEVEL) NUM-DATE.
           PERFORM TSTDAT.
           IF NUM-DATE = 0
              MOVE "INVALID DATE" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-IC-EXP.
       SEND-IC-EXP.
           MOVE "SNNN060  2." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INSEXP-DATE(I-LEVEL) TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO VDUNUM0.
           PERFORM SCREENIO.
       ENTER-IC-COVR.
           IF IC-CODE = 0
              MOVE 0 TO PD-INSCOVR(I-LEVEL)
              GO TO SEND-IC-COVR.
           MOVE "RNNN062  3." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-IC-TERM.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-IC-COVR.

      * REGACC PR# 984
      * TEST PASSWD TO CHANGE CALCULATED COVERAGE ON CL,AH,O1
           IF I-LEVEL = 1 OR 2 OR 4
              IF VDUNUM2 NOT = PD-INSCOVR(I-LEVEL)
                 MOVE INSCOVR-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE INS. COVERAGE...:" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "SN N062  3." TO VDU
                    MOVE ELE TO VDUROW
                    MOVE PD-INSCOVR(I-LEVEL) TO VDUNUM2
                    PERFORM SCREENIO
                    MOVE 9 TO IO-FG
                    GO TO ENTER-IC-COVR.

           MOVE VDUNUM2 TO PD-INSCOVR(I-LEVEL).
       SEND-IC-COVR.
           MOVE "SN N062  3." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INSCOVR(I-LEVEL) TO VDUNUM2.
           PERFORM SCREENIO.
       ENTER-IC-PREM.
           IF IC-CODE = 0
              MOVE 0 TO PD-INSPREM(I-LEVEL)
              GO TO SEND-IC-PREM.
           MOVE "RNNN042  4." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-IC-COVR.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-IC-PREM.
      * REGWAN PR# 3935
      * TEST PASSWD TO CHANGE CALCULATED PREMIUM ON PP
           IF I-LEVEL = 3
              IF VDUNUM2 NOT = PD-INSPREM(I-LEVEL)
                 MOVE PP-PREM-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE INS. PREMIUM...:" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "SN N042  4." TO VDU
                    MOVE ELE TO VDUROW
                    MOVE PD-INSPREM(I-LEVEL) TO VDUNUM2
                    PERFORM SCREENIO
                    MOVE 9 TO IO-FG
                    GO TO ENTER-IC-PREM.

           MOVE PD-INSPREM(I-LEVEL) TO INSPREM-HLDR.
           MOVE VDUNUM2 TO PD-INSPREM(I-LEVEL).
       SEND-IC-PREM.
           MOVE "SN N042  4." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INSPREM(I-LEVEL) TO VDUNUM2.
           PERFORM SCREENIO.
           IF I-LEVEL > 4
              IF GP-OT-INS-TERM NOT = "Y"
                 MOVE "I" TO PD-INS-FG(I-LEVEL)
                 MOVE PD-INTDATE              TO NUM-DATE
                 MOVE PD-INSEXP-DATE(I-LEVEL) TO SYS-DATE
                 PERFORM TIM360
                 MOVE ELAPSED-MONTHS TO PD-INSTRM(I-LEVEL)
              END-IF
              GO TO CALC-ON-INS-ENTRY.
       SEND-IC-CALC-FG.
           MOVE "S  A010  5." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INS-FG(I-LEVEL) TO CALC-FG-HLDR.
           IF PD-INSCOMP(I-LEVEL) NOT = INSCOMP-HLDR OR
              PD-INSOURS(I-LEVEL) NOT = INSOURS-HLDR OR
              PD-INSTRM(I-LEVEL) NOT = INSTERM-HLDR OR
              PD-INSCOVR(I-LEVEL) NOT = AMT-HOLDER   OR
              PD-INSPREM(I-LEVEL) NOT = INSPREM-HLDR
              MOVE "I" TO VDUBUF PD-INS-FG(I-LEVEL)
           ELSE
              MOVE CALC-FG-HLDR TO VDUBUF PD-INS-FG(I-LEVEL).
           PERFORM SCREENIO.
       ENTER-IC-CALC-FG.
           MOVE "E  A010  5." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-IC-PREM.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-IC-CALC-FG.
           MOVE VDUBUF TO PD-INS-FG(I-LEVEL).
           IF NOT (PD-INS-FG(I-LEVEL) = "I" OR "C")
              PERFORM ICE-OR-A-MSG
              GO TO ENTER-IC-CALC-FG.

       CALC-ON-INS-ENTRY.
           PERFORM VALIDATE-FIELDS-AGAINST-MAX.
           IF IO-FG = 9
                   OR NEW-FLAG = 1
              GO TO EXIT-ENTER-INSURANCE.

      *IF PREMIUM IS ZERO, SET THE OTHER FIELDS TO ZERO
           IF PD-INSPREM(I-LEVEL) = ZEROS
              MOVE 0 TO PD-INSCOMP(I-LEVEL)
                        PD-INSEFF-DATE(I-LEVEL)
                        PD-INSEXP-DATE(I-LEVEL)
                        PD-INSCOVR(I-LEVEL)
                        PD-INSCOMM(I-LEVEL)
              MOVE SPACES TO PD-INSOURS(I-LEVEL).
           MOVE PD-INSCOMP(I-LEVEL) TO CIP-INS-CO(I-LEVEL).
           MOVE PD-INSOURS(I-LEVEL) TO CIP-INS-USE-SW(I-LEVEL).
           MOVE PD-INSTRM(I-LEVEL) TO CIP-INS-TERM(I-LEVEL).
           MOVE PD-INSCOVR(I-LEVEL) TO CIP-INS-COVERAGE(I-LEVEL).
           MOVE PD-INSPREM(I-LEVEL) TO CIP-INS-PREMIUM(I-LEVEL).
           MOVE PD-INS-FG(I-LEVEL) TO CIP-INS-SW(I-LEVEL).
           MOVE PD-INSFINCHG(I-LEVEL) TO CIP-INSFINCHG-SW(I-LEVEL).
           MOVE PD-INS-TERM-SW(I-LEVEL) TO CIP-INS-TERM-SW(I-LEVEL).
           MOVE PD-COVERAGE-SW(I-LEVEL) TO CIP-COVERAGE-SW(I-LEVEL).
           MOVE PD-PREMIUM-SW(I-LEVEL) TO CIP-PREMIUM-SW(I-LEVEL).
           IF I-LEVEL > 4
              MOVE 0 TO CIP-NO-OF-TIMES-CALLED.
           PERFORM CALL-LOAN-CALCULATIONS.

       EXIT-ENTER-INSURANCE.
           EXIT.

      ***********************************
       FEE-ENTRY SECTION.
      ***********************************

           MOVE VDUBUF TO CDB-CODE PD-FEECODE(I-LEVEL).

      * WHEN A BRANCH IS FLAGED FOR INS. SALES TAX VIA
      * BR-FORCE-VALID-CITY-COUNTY = "Y", DONT ALLOW ENTRY OF INS.
      * SALES TAX CODES! THEY HAVE TO ENTER "TM" MANUALLY IN KENTUCKY

           IF CDB-CODE = "TM"
              IF NOT (BR-FORCE-VALID-CITY-COUNTY = "Y" AND
                                                PD-ORGST = "KY")
                MOVE "UMC SALES TAX CODE NOT ALLOWED" TO MESS
                PERFORM SEND-MESS
                MOVE 9 TO IO-FG
                GO TO EXIT-FEE-ENTRY.

           IF CDB-CODE NOT = " "
              IF BR-FORCE-VALID-CITY-COUNTY = "Y"
                 IF CDB-CODE = "TC" OR "TA" OR "TP"
                            OR "T1" OR "T2" OR "T3"
                    MOVE "INSURANCE SALES TAX CODES ARE NOT ALLOWED"
                                                            TO MESS
                    PERFORM SEND-MESS
                    MOVE 9 TO IO-FG
                    GO TO EXIT-FEE-ENTRY
                 END-IF
              END-IF

              PERFORM GET-CODE
              MOVE CDB-DESC TO LEGEND
              PERFORM SEND-LEGEND
              IF IO-FG = 9
                 GO TO EXIT-FEE-ENTRY
              ELSE
                 MOVE CDB-GC-GLFEEFINCHG TO PD-FEEFINCHG(I-LEVEL)
      * TEST IF AD&D INSURANCE CODE
                 IF CDB-CODE = BR-ADD-INS-FEECODE
                    PERFORM DO-ADD-PREMIUM-WINDOW
                    GO TO ENTER-FEEAMT
                 ELSE
                 IF PD-GIFTNET NOT = "Y"
                    GO TO ENTER-FEEAMT
                 ELSE
      * IF GIFTNET, DISPLAY ITEM PRICE
                 IF I-LEVEL = 2 OR 4 OR 6 OR 8 OR 10
                    MOVE "SNNN042  3." TO VDU
                    MOVE ELE TO VDUROW
                    MOVE CDB-GC-FEE-PRICE TO VDUNUM2
                                             PD-FEEAMT(I-LEVEL)
                    PERFORM SCREENIO
                    GO TO CALC-ON-FEE-ENTRY
                 ELSE
                    MOVE "SNNN042  1." TO VDU
                    MOVE ELE TO VDUROW
                    MOVE CDB-GC-FEE-PRICE TO VDUNUM2
                                         PD-FEEAMT(I-LEVEL)
                    PERFORM SCREENIO
                    GO TO CALC-ON-FEE-ENTRY.

           IF I-LEVEL = 2 OR 4 OR 6 OR 8 OR 10
              GO TO GL-CLEAR-2.
       NEXT-GL-CLEAR.
           MOVE "S  A000  0." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE SPACES TO PD-FEECODE(I-LEVEL) VDUBUF.
           PERFORM SCREENIO.
           MOVE "S  A070  1." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE 0 TO PD-FEEAMT(I-LEVEL).
           PERFORM SCREENIO.
           MOVE " " TO PD-FEEFINCHG(I-LEVEL).
           ADD 1 TO I-LEVEL.
       GL-CLEAR-2.
           MOVE "S  A020  2." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE SPACES TO PD-FEECODE(I-LEVEL) VDUBUF.
           PERFORM SCREENIO.
           MOVE "S  A070  3." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE 0 TO PD-FEEAMT(I-LEVEL).
           PERFORM SCREENIO.
           MOVE " " TO PD-FEEFINCHG(I-LEVEL).
           IF I-LEVEL < 10
              ADD 1 TO I-LEVEL ELE
              GO TO NEXT-GL-CLEAR.
           MOVE 0 TO IO-FG.
           GO TO CALC-ON-FEE-ENTRY.
       ENTER-FEEAMT.
           IF I-LEVEL > 2
              SUBTRACT 1 FROM I-LEVEL GIVING SUB
              IF PD-FEECODE(SUB) = SPACES
                 MOVE 9 TO IO-FG
                 GO TO EXIT-FEE-ENTRY.
           IF I-LEVEL = 2 OR 4 OR 6 OR 8 OR 10
              MOVE "ENNN042  3." TO VDU
           ELSE
              MOVE "ENNN042  1." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              MOVE 9 TO IO-FG
              GO TO EXIT-FEE-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-FEEAMT.
           IF VDUNUM2 = 0
              GO TO ENTER-FEEAMT.
           MOVE VDUNUM2 TO PD-FEEAMT(I-LEVEL).

       CALC-ON-FEE-ENTRY.

           IF ( PD-FEEAMT(I-LEVEL) > CDB-GC-FEE-MAXAMT )
              MOVE "INVALID: AMOUNT IS GREATER THAN THE LIMIT" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-FEEAMT.

           MOVE 0 TO COUNTER
                     TOTAL-GL-HLDR
                     TOTAL-GL-FINCHG-HLDR.
           PERFORM COMPUTE-GL-FEEAMT.
           PERFORM SP-EDT-TABLE-LOOKUP.
           IF IO-FG = 9
              MOVE 0 TO IO-FG
              GO TO ENTER-FEEAMT.
           IF NEW-FLAG NOT = 1
              IF NOT (I-LEVEL = 1 OR 3 OR 5 OR 7 OR 9)
                 MOVE TOTAL-GL-HLDR TO CIP-GL-AMOUNT-TOTAL
                 MOVE TOTAL-GL-FINCHG-HLDR TO CIP-GL-AMOUNT-TOTAL-FINCHG
                 IF CAN-LOAN-NO NOT = " "
                    MOVE 0 TO CIP-NO-OF-TIMES-CALLED
                    PERFORM CALL-LOAN-CALCULATIONS
                 ELSE
      * CITIZENS TEST
                    MOVE 800 TO CIP-NO-OF-TIMES-CALLED
                    PERFORM CALL-LOAN-CALCULATIONS.

       EXIT-FEE-ENTRY.
           EXIT.

      ***************************************
       DO-ADD-PREMIUM-WINDOW SECTION.
      ***************************************
           MOVE 7 TO WINDOW-LINES.
           MOVE 37 TO WINDOW-COLUMNS.
           MOVE 5 TO WINDOW-BEGIN-Y.
           MOVE 2 TO WINDOW-BEGIN-X.
           MOVE "ADDINS" TO VDU-FORM-NAME.
           MOVE "WI/ADDINS" TO WINDOW-FORM-NAM.

           PERFORM OPEN-WINDOW.
           DISPLAY ADDINS-SCREEN.

           MOVE ADDINS-FORM-FIELDS TO WR-BUF.
           MOVE ADDINS-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.

       DO-ADD-ENTER.
           MOVE "F7-EXIT, ENTER AMOUNT" TO MESS.
           PERFORM SEND-WSEL-LEGEND.

           MOVE "ENNN060COVR." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1>"
              IF PD-AD-D-INS-COVR NOT = 0 AND
                  PD-AD-D-INS-COVR NOT > 50000
                 GO TO EXIT-ADD-PREMIUM-WINDOW
              ELSE
                 GO TO DO-ADD-ENTER.
           IF VDUSTATUS NOT = "00" GO TO DO-ADD-ENTER.
           MOVE VDUNUM0 TO PD-AD-D-INS-COVR.
           IF PD-AD-D-INS-COVR = 0 OR PD-AD-D-INS-COVR > 50000
              GO TO DO-ADD-ENTER.

       EXIT-ADD-PREMIUM-WINDOW.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY ADDINS-SCREEN.
           PERFORM CLOSE-WINDOW.
           MOVE "LNQUOT" TO VDU-FORM-NAME.

      ***********************************
       CHECK-SP-EFFDATE SECTION.
      ***********************************
           MOVE PD-ORGST TO SP-ORGST.
           MOVE PD-SPRCLASS TO SP-SPRCLASS.
           MOVE PD-SUBCLASS TO SP-SUBCLASS.
           MOVE 0 TO SP-LAWCODE.

           PERFORM OPEN-SP1-FILE.
           PERFORM START-SP1-FILE.
       CHECK-SP-EFFDATE-NEXT.
           PERFORM READ-SP1-FILE-NEXT.
           IF IO-FG = 9
              GO TO EXIT-SP-1STPY.
           IF SP-ORGST NOT = PD-ORGST
              OR SP-SPRCLASS NOT = PD-SPRCLASS
                 OR SP-SUBCLASS NOT = PD-SUBCLASS
              MOVE 9 TO IO-FG
              GO TO EXIT-SP-1STPY.

           IF SP-EFFDATE > PD-LOANDATE
              GO TO CHECK-SP-EFFDATE-NEXT
           ELSE
              IF SP-EXPDATE = 0
                 GO TO EXIT-SP-1STPY.

           IF SP-EXPDATE NOT > PD-LOANDATE
              GO TO CHECK-SP-EFFDATE-NEXT.

       EXIT-SP-1STPY.
           PERFORM CLOSE-SP1-FILE.


      ********************************************
       CHECK-SP-EFFECTIVE SECTION.
      ********************************************
           PERFORM OPEN-SP1-FILE.

           MOVE PD-ORGST TO SP-ORGST.
           MOVE PD-SPRCLASS TO SP-SPRCLASS.
           MOVE PD-SUBCLASS TO SP-SUBCLASS.
           MOVE 0 TO SP-LAWCODE.
           PERFORM START-SP1-FILE.
       CHECK-SP-EFFECTIVE-NEXT.
           PERFORM READ-SP1-FILE-NEXT.
           IF IO-FG = 9
              GO TO CHECK-SP-EFFECTIVE-EXIT.
           IF NOT (SP-ORGST = PD-ORGST
                       AND SP-SPRCLASS = PD-SPRCLASS
                          AND SP-SUBCLASS = PD-SUBCLASS)
              MOVE 9 TO IO-FG
              GO TO CHECK-SP-EFFECTIVE-EXIT.

           IF SP-EFFDATE > PD-LOANDATE
              GO TO CHECK-SP-EFFECTIVE-NEXT
           ELSE
              IF SP-EXPDATE NOT = 0
                 IF SP-EXPDATE NOT > PD-LOANDATE
                    GO TO CHECK-SP-EFFECTIVE-NEXT.

       CHECK-SP-EFFECTIVE-EXIT.
           PERFORM CLOSE-SP1-FILE.

      *********************************
       MEMO-ENTRY SECTION.
      *********************************
           PERFORM SEND-MEMO.
       ENTER-MEMO.
           MOVE "E  A300M2." TO VDU.
           PERFORM SCREENIO.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-MEMO.
           MOVE VDUBUF TO PD-MESSAGE.
           IF PD-MESSAGE = " "
              MOVE "M1 M2." TO MESS
              PERFORM RESET-MESS.

      *********************************
       NEW-RECORD-SETUP SECTION.
      *********************************
           MOVE 1 TO NEW-FLAG.
           PERFORM CLEAR-PD-FILE.
           MOVE " " TO SCREEN-LINES
                        PD2-KEY
                         SAVE-PD2-KEY
                          PRIOR-LOAN-STAT
                           PASS-STAT-FG.

           MOVE TRANS-DATE-YYYYMMDD TO PD-LOANDATE DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO DEF-LOANDATE.
           MOVE BR-STATE TO DEF-ORGST PD-ORGST PD-OWNST.
           MOVE EXT-CONAME-USER-LOC TO DEF-ORGBR PD-ORGBR PD-OWNBR.
           MOVE 999.99 TO PD-SERVPER.
           MOVE 999.999 TO PD-ENDORATE PD-OVRDRATE.
           MOVE "C" TO PD-OVRDRATE-FG
                       PD-INS-FG(1) PD-INS-FG(2)
                       PD-INS-FG(3) PD-INS-FG(4)
                       PD-SERCHG-FG PD-MAINTFEE-FG
                       PD-EXTCHG-FG PD-REGPYAMT-FG.
           MOVE 0 TO TOTAL-GL-HLDR
                     TOTAL-GL-FINCHG-HLDR
                     TERM-LOW
                     TERM-HIGH
                     PROCEEDS-LOW
                     PROCEEDS-HIGH
                     POINTS-LOW
                     POINTS-HIGH.

           MOVE "Q" TO QUOTE-ID-FG.
           MOVE DEF-BUF TO WR-BUF.
           MOVE DEF-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.

           MOVE "N" TO STAT.
           MOVE "Y" TO DEFAULT-APR-FG.
           PERFORM PROTECT-FIELDS.
           MOVE "N" TO CHFG(8) CHFG(9).
           MOVE 9999.99 TO PD-DLNO.
           MOVE 0 TO ELE PRIOR-LNAMT PD-CAN-LOAN-MAX.
           PERFORM CLEAR-CALC-AREA-ZL.
      *    PERFORM CREATE-TRAILER.

      *****************************
       DISPLAY-FIELDS SECTION.
      *****************************
           MOVE " " TO DISPLAY-BUF1.
           PERFORM GET-SP.
           MOVE PD-LNAMT TO D-LOANAMT.
           MOVE PD2-BWNAME TO HOLD-BWNAME SAVE-BW-NAME.
           MOVE PD-CLASS TO LC-CODE D-LCNO.
           PERFORM GET-LC.
           MOVE LC-DESC TO D-LC-DESC.

           ADD PD-ANTICERN(1) PD-ANTICERN(2) PD-ANTICERN(3)
               PD-ANTICERN(4) PD-ANTICERN(5) GIVING ANTIC.
           IF NOT GP-INCL-OTH-IN-EARNED-N
              ADD PD-ANTICERN(6) TO ANTIC.
           MOVE ANTIC TO D-ANTIC.

           PERFORM DISPLAY-BW.

           PERFORM OPEN-BW1-FILE.
           MOVE 1 TO ELE.
       DISP-NEXT-BW.
           MOVE PD-SSNO(ELE) TO BW-SSNO.
           PERFORM NUMBW-TO-ALPBW.
           MOVE " " TO BW-LNAME BW-FNAME.
           IF ELE < 4
              ADD 1 TO ELE
              GO TO DISP-NEXT-BW.
           PERFORM CLOSE-BW1-FILE.

           MOVE PD-ORGST    TO D-050.
           MOVE PD-ORGBR    TO D-051.
           MOVE PD-SUBCLASS TO D-052.
           MOVE SP-DESC     TO D-053.
           MOVE PD-LOANDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-060.
           MOVE PD-INTDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-061.
           MOVE PD-FILEDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-062.
           MOVE PD-1STPYDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-070.
           IF QUOTE-ONLY
              IF PD-GIFTNET NOT = "Y"
                    OR (PD-GIFTNET = "Y" AND CAN-LOAN-NO NOT = " ")
                 PERFORM MAKE-DATES-CURRENT.
           MOVE PD-ORGTERM TO D-071.

           MOVE "PU" TO CD1-KEY.
           MOVE PD-PURCD TO D-080 CD-CODE.
           PERFORM GET-CD.
           MOVE CD-DESC TO D-081.

           MOVE "CO"      TO CD-TYPE.
           MOVE PD-COLLCD TO CD-CODE  D-090.
           PERFORM GET-CD.
           MOVE CD-DESC   TO D-091.
           MOVE CD-CO-SECURED TO SPTEST-CD-SECURED.

           MOVE "SR"    TO CD-TYPE.
           MOVE PD-SRCD TO CD-CODE D-100.
           PERFORM GET-CD.
           MOVE CD-DESC TO D-101.

           MOVE PD-PRLNNO TO D-110.
           IF PD-PRLNNO NOT  = 0
              PERFORM PROCESS-PRIOR-LOAN
              IF ERROR-IN-PRIOR-LOAN
                 MOVE 9999999.99 TO D-111
              ELSE
                 MOVE PRIOR-LNAMT TO D-111.

           MOVE PD-PROCEEDS TO D-120.
           MOVE PD-PROCEEDS-FG TO D-121.

           MOVE PD-INSCODES TO D-130.

           MOVE PD-POINTS TO D-131.
           MOVE PD-POINTS-FG TO D-132.

           PERFORM SETUP-FEES-FOR-DISP.

           MOVE PD-DLNO TO D-190 DL-DLNO.
           PERFORM GET-DL1.
           MOVE DL-SHORT TO D-191.

           PERFORM DISPLAY-PROMPTS.

           MOVE DISPLAY-BUF1 TO WR-BUF.
           MOVE DISPLAY-LIST1 TO WR-LIST.
           PERFORM CALL-WRFORM.

           MOVE 0 TO COUNTER
                     TOTAL-GL-HLDR
                     TOTAL-GL-FINCHG-HLDR.
           PERFORM COMPUTE-GL-FEEAMT.
           MOVE 800 TO CIP-NO-OF-TIMES-CALLED.
           PERFORM SETUP-CALC-AREA.

       DISP-INTERMEDIATE-FIELDS.
           MOVE " " TO DISPLAY-BUF2.
           MOVE PD-COLLID TO D-200.

           PERFORM MOVE-MSG.

           MOVE PD-OVRDRATE TO D-210 CIP-OVR-RATE.
           MOVE PD-OVRDRATE-FG TO D-211 CIP-OVR-RATE-SW.
           MOVE PD-EFFRATE TO D-220 CIP-EFF-RATE CEP-EFF-RATE.
           MOVE PD-SMPRATE TO CIP-SIM-RATE.
           MOVE PD-APRATE TO D-230 CIP-APR-RATE CEP-APR-RATE.
           MOVE PD-ENDORATE TO D-240.

           PERFORM VARYING ELE FROM 1 BY 1 UNTIL ELE > 4
              MOVE PD-INSCOMP(ELE)     TO D-1COMP(ELE)
                                          CIP-INS-CO(ELE)
              MOVE PD-INSPREM(ELE)     TO D-1PREM(ELE)
                                          CIP-INS-PREMIUM(ELE)
                                          CEP-INS-PREMIUM(ELE)
              MOVE PD-INSTRM(ELE)      TO D-1TERM(ELE)
                                          CIP-INS-TERM(ELE)
                                          CEP-INS-TERM(ELE)
              MOVE PD-INSCOVR(ELE)     TO D-1COVR(ELE)
                                          CIP-INS-COVERAGE(ELE)
                                          CEP-INS-COVERAGE(ELE)
              MOVE PD-INSOURS(ELE)     TO D-1OUR(ELE)
                                          CIP-INS-USE-SW(ELE)
              MOVE PD-INS-FG(ELE)      TO D-INS-FG(ELE)
                                          CIP-INS-SW(ELE)
              MOVE PD-INSFINCHG(ELE)   TO CIP-INSFINCHG-SW(ELE)
              MOVE PD-INS-TERM-SW(ELE) TO CIP-INS-TERM-SW(ELE)
              MOVE PD-COVERAGE-SW(ELE) TO CIP-COVERAGE-SW(ELE)
              MOVE PD-PREMIUM-SW(ELE)  TO CIP-PREMIUM-SW(ELE)
           END-PERFORM.

           MOVE 1 TO SUB.
           MOVE 5 TO ELE.
       DISP-NEXT-2IC.
           MOVE PD-INSCOMP(ELE)     TO D-2COMP(SUB)
                                       CIP-INS-CO(ELE).
           MOVE PD-INSPREM(ELE)     TO D-2PREM(SUB)
                                       CIP-INS-PREMIUM(ELE)
                                       CEP-INS-PREMIUM(ELE).
           MOVE PD-INSTRM(ELE)      TO CIP-INS-TERM(ELE)
                                       CEP-INS-TERM(ELE).
           IF GP-OT-INS-TERM = "Y"
              MOVE PD-INSTRM(ELE)      TO D-2TERM(SUB)
           ELSE
              MOVE PD-INSEXP-DATE(ELE) TO DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY      TO D-2EXP(SUB).
           MOVE PD-INSCOVR(ELE)     TO D-2COVR(SUB)
                                       CIP-INS-COVERAGE(ELE)
                                       CEP-INS-COVERAGE(ELE).
           MOVE PD-INSOURS(ELE)     TO D-2OUR(SUB)
                                       CIP-INS-USE-SW(ELE).
           MOVE PD-INS-FG(ELE)      TO CIP-INS-SW(ELE).
           MOVE PD-INSFINCHG(ELE)   TO CIP-INSFINCHG-SW(ELE).

           MOVE PD-INS-TERM-SW(ELE) TO CIP-INS-TERM-SW(ELE).
           MOVE PD-COVERAGE-SW(ELE) TO CIP-COVERAGE-SW(ELE).
           MOVE PD-PREMIUM-SW(ELE)  TO CIP-PREMIUM-SW(ELE).
           IF ELE < 6
              ADD 1 TO ELE SUB
              GO TO DISP-NEXT-2IC.

           MOVE 1 TO ELE.

       DISP-OUTPUT-FIELDS.
           MOVE PD-SERCHG TO D-310 CIP-SERVICE-CHG CEP-SERVICE-CHG.
           MOVE PD-STATE-WORKER TO CIP-STATE-WORKER.
           MOVE PD-SERCHG-FG TO D-311 CIP-SERVICE-CHG-SW.
           IF PD-ORGST = "MX"
              MOVE PD-ANTICERN(4) TO D-320
                                     MAINTFEE-HLDR
                                     CIP-MAINT-FEES
                                     CEP-MAINT-FEES
           ELSE
              MULTIPLY PD-MAINTFEE BY PD-ORGTERM
                   GIVING D-320 ROUNDED
                          MAINTFEE-HLDR ROUNDED
                          CIP-MAINT-FEES ROUNDED
                          CEP-MAINT-FEES ROUNDED.
           MOVE PD-MAINTFEE-FG TO D-321 CIP-MAINT-FEES-SW.
           MOVE PD-EXTCHG TO D-330 CIP-1ST-PY-EXT CEP-1ST-PY-EXT.
           MOVE PD-EXTCHG-FG TO D-331 CIP-1ST-PY-EXT-SW.
           MOVE PD-INTCHG TO D-340 CIP-INT-CHARGE.
           MOVE PD-APR-FINAMT TO D-350
                                 CIP-APR-FINANCD.
           MOVE PD-FINAMT TO CIP-AMT-FINANCD.
           MOVE PD-LNAMT TO CIP-LOAN-AMOUNT.
           IF PD-LOANTYPE = "P"
              MOVE PD-LNAMT TO D-360
           ELSE
              PERFORM LOAN-CALCULATIONS
              MOVE TOTAL-REPAY TO D-360.
           ADD PD-ANTICERN(1) PD-ANTICERN(2) PD-ANTICERN(3)
               PD-ANTICERN(4) PD-ANTICERN(5)
               GIVING CIP-ANTIC-EARNS.
           IF NOT GP-INCL-OTH-IN-EARNED-N
               ADD PD-ANTICERN(6) TO CIP-ANTIC-EARNS.
           MOVE PD-1STPYAMT TO D-370 CIP-ODD-1ST-PMT.
           MOVE PD-REGPYAMT TO D-380 CIP-REG-PAYMENT.
           MOVE PD-REGPYAMT-FG TO D-381 CIP-REG-PAYMENT-SW.

           IF PD-LOANTYPE = "I"
              MOVE PD-SERCHG TO PD-ANTICERN(3)
              MOVE 0 TO PD-ANTICERN(1)
                        PD-ANTICERN(2)
                        PD-ANTICERN(4)
                        PD-ANTICERN(5)
                        PD-ANTICERN(6)
           ELSE
              ADD PD-INTCHG PD-EXTCHG GIVING PD-ANTICERN(1)
              MOVE PD-SERCHG TO PD-ANTICERN(3)
              COMPUTE PD-ANTICERN(4) = PD-ORGTERM * PD-MAINTFEE
              MOVE 0 TO PD-ANTICERN(5)
                        PD-ANTICERN(6).

            MOVE PD-ANTICERN(1) TO WK-ANTICERN(1).
            MOVE PD-ANTICERN(2) TO WK-ANTICERN(2).
            MOVE PD-ANTICERN(3) TO WK-ANTICERN(3).
            MOVE PD-ANTICERN(4) TO WK-ANTICERN(4).
            MOVE PD-ANTICERN(5) TO WK-ANTICERN(5).
            MOVE PD-ANTICERN(6) TO WK-ANTICERN(6).
            PERFORM ADJUST-ANTICERN.
            MOVE WK-ANTICERN(1) TO PD-ANTICERN(1).
            MOVE WK-ANTICERN(2) TO PD-ANTICERN(2).
            MOVE WK-ANTICERN(3) TO PD-ANTICERN(3).
            MOVE WK-ANTICERN(4) TO PD-ANTICERN(4).
            MOVE WK-ANTICERN(5) TO PD-ANTICERN(5).
            MOVE WK-ANTICERN(6) TO PD-ANTICERN(6).

           MOVE DISPLAY-BUF2 TO WR-BUF.
           MOVE DISPLAY-LIST2 TO WR-LIST.
           PERFORM CALL-WRFORM.

           IF PD-MESSAGE NOT = " "
              PERFORM SEND-MEMO
              PERFORM ALARM.

       DISPLAY-FIELDS-RESCISSION.

           IF ( PD-POCD-INRESCISSION )
              MOVE RESCISSION-MESSAGE TO RESCISSION-BUF
              PERFORM SEND-RESCISSION.

       DISPLAY-FIELDS-EXIT.
           EXIT.

      *****************************************
       DISPLAY-BW SECTION.
      *****************************************
           PERFORM OPEN-BW1-FILE.
           MOVE 1 TO ELE.
       DISPLAY-BW-NEXT.
           MOVE PD-SSNO(ELE) TO BW-SSNO.
           PERFORM NUMBW-TO-ALPBW.
           MOVE " " TO BW-LNAME BW-FNAME.
           IF BW-SSNO NOT = 0
              IF (NOT QUOTE-ONLY)
                      OR (LNQUOT-MAINT-FG = "R" OR "P")
              PERFORM GET-BW1
              MOVE ALP-BW TO D-010(ELE)
              MOVE INSPECT-W TO D-011(ELE)
              MOVE PD-MAKERCD(ELE) TO D-012(ELE).
           IF ELE < 4
              ADD 1 TO ELE
              GO TO DISPLAY-BW-NEXT.
           PERFORM CLOSE-BW1-FILE.


      *****************************************
       SETUP-FEES-FOR-DISP SECTION.
      *****************************************
           MOVE 1 TO ELE.
           MOVE 1 TO SUB.
       SETUP-FEES-FOR-DISP-NEXT.
           MOVE PD-FEECODE(SUB) TO D-1FEECD(ELE).
           MOVE PD-FEEAMT(SUB) TO D-1FEEAMT(ELE).
           ADD 1 TO SUB.
           MOVE PD-FEECODE(SUB) TO D-2FEECD(ELE).
           MOVE PD-FEEAMT(SUB) TO D-2FEEAMT(ELE).
           IF SUB < 10
              ADD 1 TO ELE SUB
              GO TO SETUP-FEES-FOR-DISP-NEXT.

      ***********************************
       WRITE-SCRATCH SECTION.
      ***********************************
           MOVE "LOAN TEMP SAVE IN PROGRESS.........." TO LEGEND.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-PD1-FILE.
           MOVE PD-RECORD TO HOLD-PD-RECORD.
           MOVE PD-SSNO(1) TO SAVE-SSNO.
           PERFORM SET-SCRATCH-KEY.
           IF QUOTE-ONLY
              MOVE "Q" TO PD-ID
              MOVE PD2-KEY TO SAVE-PD2-KEY.
           PERFORM READ-PD1-FILE.

           MOVE HOLD-PD-RECORD TO PD-RECORD.
           IF QUOTE-ONLY
              MOVE "Q" TO PD-ID
              MOVE SAVE-PD2-KEY TO PD2-KEY.
           MOVE PD-ID TO PD2-ID.
           MOVE PD-BRANCH TO PD2-BRANCH.

           MOVE SAVE-BW-NAME TO PD2-BWNAME.
           IF IO-FG = 9
              GO TO CREATE-NEW-SCRATCH.

           PERFORM REWRITE-PD1-FILE.

           GO TO EXIT-WRITE-SCRATCH.
       CREATE-NEW-SCRATCH.
           PERFORM SET-SCRATCH-KEY.
           IF QUOTE-ONLY
              MOVE "Q" TO PD-ID.
           PERFORM WRITE-PD1-FILE.
           IF IO-FG = 9
              MOVE "RECORD EXISTS FOR RECALL # !"
                TO MESS
              PERFORM SEND-MESS
              MOVE "PLEASE REENTER RECALL # AND RE-INPUT"
                TO MESS
              PERFORM SEND-MESS.
       EXIT-WRITE-SCRATCH.
           PERFORM CLOSE-PD1-FILE.

      ***********************************
       DELETE-SCRATCH SECTION.
      ***********************************
           MOVE "LOAN TEMP DELETE IN PROGRESS........" TO LEGEND.
           PERFORM SEND-LEGEND.
           PERFORM OPEN-PD1-FILE.
           MOVE PD-SSNO(1) TO SAVE-SSNO.
           PERFORM SET-SCRATCH-KEY.
           IF QUOTE-ONLY
                  OR QUOTE-CHANGED-TO-LOAN
              MOVE "Q" TO PD-ID.
           PERFORM READ-PD1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PD1-FILE.
           PERFORM CLOSE-PD1-FILE.

      ****************************************
       DEFAULT-INT-PMT-DATES SECTION.
      ****************************************
           PERFORM CHECK-SP-EFFDATE.
           IF IO-FG = 9
              PERFORM SP-INVALID
              GO TO EXIT-DEFAULT-INT-PMT-DATES.

           MOVE SP-LAWCODE TO PD-LAWCODE.
           IF PD-INTDATE = 0
              MOVE "S  8000061." TO VDU
              MOVE PD-LOANDATE TO VDU-DATE-YYYYMMDD PD-INTDATE
              PERFORM SCREENIO.
           IF PD-1STPYDATE NOT = 0
              MOVE 0 TO AMT-HOLDER
              GO TO EXIT-DEFAULT-INT-PMT-DATES.
           MOVE 1 TO AMT-HOLDER.
           MOVE PD-INTDATE TO NDTE-DATE.
           MOVE 1          TO NDTE-HOLD.
           PERFORM INCREMENT-MONTHS.
           MOVE "S  8000070." TO VDU.
           MOVE NDTE-DATE TO VDU-DATE-YYYYMMDD PD-1STPYDATE
                                               PD-ORIG-1STPYDATE.
           PERFORM SCREENIO.

       EXIT-DEFAULT-INT-PMT-DATES.
           EXIT.

      *************************************
       PROCESS-PRIOR-LOAN SECTION.
      *************************************
           MOVE " " TO PASS-STAT-FG.

           IF ( PD-PRLNNO = 0 ) OR
              ( NOT ( PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO" ))
              GO TO EXIT-PROCESS-PRIOR-LOAN.

           MOVE PD-PRLNNO TO W-LNNO PASS-PRLNNO.

      * WILL USE INTEREST START DATE FOR RECISION (CITIZENS):
           MOVE PD-INTDATE TO PASS-TRANS-DATE.

      * NEED THIS FLAG TO TEST IF READ ON PD1 IS SUCCESSFUL, THEY
      * MANUALLY PAID OUT THE PRIOR LOAN, NOT ALLOWED, BUT THEN
      * YOU LOSE THE PD-POCD TO TEST IF ENTERING A RESCISSION LOAN...

           IF ( PD-POCD-INRESCISSION )
              MOVE PD-INTDATE TO PASS-TRANS-DATE
              MOVE "Y"        TO RESCISSION-FLAG
           ELSE
              MOVE SPACES     TO RESCISSION-FLAG.

           MOVE PD-SRCD  TO PASS-CURRENT-PD-SRCD.
           MOVE PD-CLASS TO PASSX-CURRENT-PD-CLASS.
           MOVE PD-REC TO HOLD-PD-RECORD.
           MOVE "R" TO PD-ID.
           MOVE EXT-CONAME-USER-LOC TO PD-BRANCH.
           MOVE PD-PRLNNO TO PD-SOC-SEC.
           PERFORM GET-PD1.

      * IF MAKING A RESCISSION LOAN, AND YOU FIND THE 'PD' FOR A
      * MANUAL PAYOFF, DON'T ALLOW IT!
           IF ( IO-BAD )
              IF ( NOT PD-POCD-INRESCISSION )
                 GO TO PROCESS-PRIOR-PAYOFF
              ELSE
                 GO TO PROCESS-PRIOR-PAYOFF
           ELSE
           IF ( RESCISSION-FLAG = "Y" )
              MOVE "Z" TO PASS-STAT-FG
              GO TO END-PROCESS-PRIOR-LOAN.


           IF PD-PLDATE NOT = 0 OR PD-CURBAL = 0
              MOVE "Z" TO PASS-STAT-FG
              GO TO END-PROCESS-PRIOR-LOAN.

           IF PASS-CURRENT-PD-SRCD = "SC"
              IF PD-SALEFIN NOT = "Y" OR
                 PD-SERVACCT NOT = "N"
                 MOVE "S" TO PASS-STAT-FG
                 GO TO END-PROCESS-PRIOR-LOAN.

           IF PASS-CURRENT-PD-SRCD NOT = "SC"
              IF PD-SALEFIN = "Y"
                 MOVE "N" TO PASS-STAT-FG
                 GO TO END-PROCESS-PRIOR-LOAN.
           MOVE PD-SSNO(1) TO SAVE-SSNO.

      * INSURE THAT TRCD OF RENEWED LOAN MATCHS THE SOURCE CODE
      * OF THIS LOAN BEING BOOKED NOW
           MOVE PD-PO-TRCD TO HOLD-PRIOR-PO-TRCD.
           IF PD-PO-TRCD NOT = PASS-CURRENT-PD-SRCD
              MOVE "J" TO PASS-STAT-FG
              GO TO END-PROCESS-PRIOR-LOAN.

           COMPUTE PRIOR-LNAMT ROUNDED =
                (PD-PRBAL + PD-PRINTDUE)
                                 - (PD-PRFINCHGRB + PD-PRINSRB).

           MOVE PD-ORGST TO CIP-PRIOR-LOAN-STATE.
           MOVE PD-CLASS TO CIP-PRIOR-LOAN-CLASS.
           MOVE PD-SUBCLASS TO CIP-PRIOR-SUB-CLASS.
           MOVE PD-PRBAL TO CIP-PRBAL.
           MOVE PD-PRINTDUE TO CIP-PRINTDUE.

           MOVE PD-PRFINCHGRB   TO CIP-PRFINCHGRB.
           MOVE PD-PRINSRB      TO CIP-PRINSRB.
           MOVE PD-LOANDATE     TO CIP-PRIOR-LOAN-DATE.
           MOVE PD-PRPAID-AHEAD TO CIP-PRPAID-AHEAD.

           GO TO END-PROCESS-PRIOR-LOAN.

       PROCESS-PRIOR-PAYOFF.
           MOVE 0 TO IO-FG.

           MOVE "LP/PAYOFX" TO FORM-NAM.
           MOVE "CALCULATING - PLEASE WAIT" TO LEGEND.
           PERFORM SEND-LEGEND.
           CALL FORM-PROGX USING FORM-PATH PASS-PAYOFF-FLDS.
           CANCEL FORM-PROGX.

           PERFORM TEST-FOR-GEORGIA-SCHG.
           PERFORM TEST-FOR-SC-SCHG.
           PERFORM TEST-FOR-WI-SCHG.
           PERFORM TEST-FOR-MFEE.
           PERFORM RESET-LEGEND.

           IF ERROR-IN-PAYOFF
              MOVE 9 TO IO-FG
              GO TO END-PROCESS-PRIOR-LOAN.

           COMPUTE PRIOR-LNAMT ROUNDED =
               (PASS-PRBAL + PASS-PRINTDUE)
                        - (PASS-PRFINCHGRB + PASS-PRINSRB).

           MOVE PASS-PRIOR-LOAN-STATE TO CIP-PRIOR-LOAN-STATE.
           MOVE PASS-PRIOR-LOAN-CLASS TO CIP-PRIOR-LOAN-CLASS.
           MOVE PASS-PRIOR-SUB-CLASS TO CIP-PRIOR-SUB-CLASS.
           MOVE PASS-PRBAL TO CIP-PRBAL.
           MOVE PASS-PRINTDUE TO CIP-PRINTDUE.

           MOVE PASS-PRFINCHGRB      TO CIP-PRFINCHGRB.
           MOVE PASS-PRINSRB         TO CIP-PRINSRB.
           MOVE PASS-PRIOR-LOAN-DATE TO CIP-PRIOR-LOAN-DATE.
           IF PASS-CDEL-ARREARAGE > 0
              MOVE PASS-CDEL-ARREARAGE TO CIP-PRPAID-AHEAD
           ELSE
              MOVE 0 TO CIP-PRPAID-AHEAD.

       END-PROCESS-PRIOR-LOAN.
           MOVE HOLD-PD-RECORD TO PD-REC.
           IF IO-FG = 9
              MOVE "E" TO PRIOR-LOAN-STAT
              GO TO EXIT-PROCESS-PRIOR-LOAN.
           MOVE CIP-PRBAL TO PD-PRBAL.
           MOVE CIP-PRINTDUE TO PD-PRINTDUE.
           MOVE CIP-PRFINCHGRB TO PD-PRFINCHGRB.
           MOVE CIP-PRINSRB TO PD-PRINSRB.
           MOVE CIP-PRPAID-AHEAD TO PD-PRPAID-AHEAD.
           IF NOT PRIOR-LOAN-NOT-VALID
              IF CAN-LOAN-NO NOT = " "
                 IF PRIOR-LNAMT > PD-CAN-LOAN-MAX
                    MOVE "PRIOR LOAN AMOUNT EXCEEDS CANNED LOAN MAX"
                                                          TO MESS
                    PERFORM SEND-MESS
                    MOVE 9 TO IO-FG
                    GO TO END-PROCESS-PRIOR-LOAN
                 ELSE
                    MOVE "SNNN062120." TO VDU
                    SUBTRACT PRIOR-LNAMT FROM PD-CAN-LOAN-MAX
                         GIVING VDUNUM2 PD-PROCEEDS CIP-PROCEEDS
                    PERFORM SCREENIO
                 END-IF
              END-IF
              IF (NEW-FLAG NOT = 1)
      * CITIZENS TEST
                 MOVE 800 TO CIP-NO-OF-TIMES-CALLED
                 PERFORM CALL-LOAN-CALCULATIONS.

           MOVE " " TO PRIOR-LOAN-STAT.
           GO TO EXIT-PROCESS-PRIOR-LOAN.

       PRIOR-LOAN-ERROR-MSG.
           IF ERROR-IN-PAYOFF
              MOVE "PRIOR LOAN INVALID" TO MESS
              PERFORM SEND-MESS
           ELSE
              MOVE "INITIATE RENEWAL IN TRANSACTION POSTING" TO MESS
              PERFORM SEND-MESS.

       EXIT-PROCESS-PRIOR-LOAN.
           EXIT.

      *************************
       VALIDATION SECTION.
      *************************
           IF ELE = 21
              IF PD-OVRDRATE-FG = "E"
                      AND PD-OVRDRATE > CEP-EFF-RATE
                 MOVE "EFF. RATE" TO TYPE-OF-AMT-EXCEEDED
                 MOVE CEP-EFF-RATE TO HOLD-RATE-EXCEEDED
                 GO TO VALIDATE-EXCEEDS-MAX.
           IF ELE = 21
              IF PD-OVRDRATE-FG = "A"
                      AND PD-OVRDRATE > CEP-APR-RATE
                 MOVE "APR RATE" TO TYPE-OF-AMT-EXCEEDED
                 MOVE CEP-APR-RATE TO HOLD-RATE-EXCEEDED
                 GO TO VALIDATE-EXCEEDS-MAX.
           IF ELE = 25 OR 26 OR 27 OR 28
              SUBTRACT 24 FROM ELE GIVING I-LEVEL
              IF PD-INS-FG(I-LEVEL) NOT = "C"
                 IF PD-INSTRM(I-LEVEL) > CEP-INS-TERM(I-LEVEL)
                    MOVE "INS. TERM" TO TYPE-OF-AMT-EXCEEDED
                    MOVE CEP-INS-TERM(I-LEVEL) TO HOLD-TERM-EXCEEDED
                    GO TO VALIDATE-EXCEEDS-MAX
                 ELSE
                 IF PD-INSPREM(I-LEVEL) > CEP-INS-PREMIUM(I-LEVEL)
                    MOVE "INS. PREMIUM" TO TYPE-OF-AMT-EXCEEDED
                    MOVE CEP-INS-PREMIUM(I-LEVEL) TO HOLD-AMT-EXCEEDED
                    GO TO VALIDATE-EXCEEDS-MAX
                 ELSE
      * PERSONAL PROPERTY MUST CHECK SP-INSMAXCHGABL FOR 888888
                 IF ELE NOT = 27 AND NOT = 28
                    IF PD-INSCOVR(I-LEVEL) > CEP-INS-COVERAGE(I-LEVEL)
                       MOVE "INS. COVERAGE" TO TYPE-OF-AMT-EXCEEDED
                       MOVE CEP-INS-COVERAGE(I-LEVEL)
                                           TO HOLD-AMT-EXCEEDED
                       GO TO VALIDATE-EXCEEDS-MAX
                    ELSE
                       NEXT SENTENCE
                 ELSE
                    PERFORM VALIDATE-TEST-PP
      * PERSONAL PROPERTY OF 888888, SKIP MAX TEST
                    IF NOT SP-INSMAXCHGABL-OVRIDE(ILEV)
                      IF PD-INSCOVR(I-LEVEL) > CEP-INS-COVERAGE(I-LEVEL)
                          MOVE "INS. COVERAGE" TO TYPE-OF-AMT-EXCEEDED
                          MOVE CEP-INS-COVERAGE(I-LEVEL)
                                              TO HOLD-AMT-EXCEEDED
                          GO TO VALIDATE-EXCEEDS-MAX.

           IF ELE = 31
              IF PD-SERCHG > CEP-SERVICE-CHG
                 MOVE "SERVICE CHG" TO TYPE-OF-AMT-EXCEEDED
                 MOVE CEP-SERVICE-CHG TO HOLD-AMT-EXCEEDED
                 GO TO VALIDATE-EXCEEDS-MAX.
           IF ELE = 32
              IF SP-MFFRMLA-05
                 MOVE SAVE-MAINTFEE TO AMT-HOLDER
              ELSE
                 MULTIPLY PD-MAINTFEE BY PD-ORGTERM
                                  GIVING AMT-HOLDER ROUNDED
              END-IF
              IF AMT-HOLDER > CEP-MAINT-FEES
                 MOVE "MAINT. FEE" TO TYPE-OF-AMT-EXCEEDED
                 MOVE CEP-MAINT-FEES TO HOLD-AMT-EXCEEDED
                 GO TO VALIDATE-EXCEEDS-MAX.
           IF ELE = 33
              IF PD-EXTCHG > CEP-1ST-PY-EXT
                 MOVE "EXT. CHG" TO TYPE-OF-AMT-EXCEEDED
                 MOVE CEP-1ST-PY-EXT TO HOLD-AMT-EXCEEDED
                 GO TO VALIDATE-EXCEEDS-MAX.

           GO TO EXIT-VALIDATION.

       VALIDATE-TEST-PP.
           IF PD-INSTYPES-PP
              SET ILEV TO 6
           ELSE
              SET ILEV TO 7.
           IF ELE = 28
              SET ILEV TO 8.

       VALIDATE-EXCEEDS-MAX.
           UNSTRING AMT-EXCEEDED-LIT DELIMITED BY ALL " "
              INTO MESS AMT-EXCEEDED-LIT.
           STRING TYPE-OF-AMT-EXCEEDED DELIMITED BY "  "
              " EXCEEDS CURRENT MAXIMUM OF ",
              AMT-EXCEEDED-LIT DELIMITED BY SIZE INTO MESS.
           PERFORM SEND-MESS.
           MOVE " " TO MESS AMT-EXCEEDED-LIT.
           MOVE 9 TO IO-FG.

       EXIT-VALIDATION.
           EXIT.

      *****************************
       SP-EDT-TABLE-LOOKUP SECTION.
      *****************************
           SET ETBL TO 1.
           MOVE 0 TO COUNTER.
           IF ELE = 12 OR
              (ELE > 13 AND ELE < 19)
              MOVE 999 TO TERM-LOW
              MOVE 999999.99 TO PROCEEDS-LOW
              MOVE 0 TO TERM-HIGH PROCEEDS-HIGH
              COMPUTE AMT-HOLDER ROUNDED =
                   PRIOR-LNAMT + PD-PROCEEDS + TOTAL-GL-HLDR
              GO TO PROCEEDS-VALIDATION.
           IF ELE = 13
              MOVE 999999.99 TO POINTS-LOW
              GO TO POINTS-VALIDATION.

           IF PD-ORGTERM < 1
           IF PD-ORGTERM < 1
              GO TO OUT-OF-RANGE-MSG.

       TERM-VALIDATION.
           ADD 1 TO COUNTER.

           IF COUNTER > SP-EDT-NOEDITS(ETBL)
              GO TO TERM-TABLE2.

           IF SP-EDT-TYPE(ETBL,COUNTER) = "T"
              IF SP-EDT-HL(ETBL,COUNTER) = "L"
                 IF SP-EDT-TERM(ETBL,COUNTER) < TERM-LOW
                    MOVE SP-EDT-TERM(ETBL,COUNTER) TO TERM-LOW
                 ELSE
                    NEXT SENTENCE
              ELSE
                 IF SP-EDT-TERM(ETBL,COUNTER) > TERM-HIGH
                    MOVE SP-EDT-TERM(ETBL,COUNTER) TO TERM-HIGH.

           IF COUNTER NOT > SP-EDT-NOEDITS(ETBL)
              GO TO TERM-VALIDATION.

       TERM-TABLE2.
           IF (SP-EDT-NOEDITS(ETBL) NOT < 6) AND (ETBL NOT = 2)
              MOVE 0 TO COUNTER
              SET ETBL TO 2
              GO TO TERM-VALIDATION.
           IF ((PD-ORGTERM < TERM-LOW) AND (TERM-LOW NOT = 999))
                  OR
              ((PD-ORGTERM > TERM-HIGH) AND (TERM-HIGH NOT = 0))
              GO TO OUT-OF-RANGE-MSG.

           GO TO EXIT-SP-EDT-TABLE-LOOKUP.

       POINTS-VALIDATION.
           ADD 1 TO COUNTER.

           IF COUNTER > SP-EDT-NOEDITS(ETBL)
              GO TO POINTS-TABLE2.

           IF SP-EDT-TYPE(ETBL COUNTER) = "P"
              IF SP-EDT-HL(ETBL COUNTER) = "L"
                 IF SP-EDT-AMT(ETBL COUNTER) < POINTS-LOW
                    MOVE SP-EDT-AMT(ETBL COUNTER) TO POINTS-LOW
                 END-IF
              ELSE
              IF SP-EDT-HL(ETBL COUNTER) = "H"
                 IF SP-EDT-AMT(ETBL COUNTER) > POINTS-HIGH
                    MOVE SP-EDT-AMT(ETBL COUNTER) TO POINTS-HIGH.

           IF COUNTER NOT > SP-EDT-NOEDITS(ETBL)
              GO TO POINTS-VALIDATION.

       POINTS-TABLE2.
           IF SP-EDT-NOEDITS(ETBL) NOT < 6 AND ETBL NOT = 2
              MOVE 0 TO COUNTER
              SET ETBL TO 2
              GO TO POINTS-VALIDATION.

           IF ((PD-POINTS < POINTS-LOW) AND
                                      (POINTS-LOW NOT = 999999.99))
                   OR
              ((PD-POINTS > POINTS-HIGH) AND (POINTS-HIGH NOT = 0))
              GO TO POINTS-OUT-OF-RANGE-MSG.

           MOVE 0 TO COUNTER.
           GO TO EXIT-SP-EDT-TABLE-LOOKUP.

       POINTS-OUT-OF-RANGE-MSG.
           MOVE "THE NO. OF POINTS IS OUT OF SP RANGE" TO MESS.
           PERFORM SEND-MESS.
           MOVE 9 TO IO-FG.
           GO TO EXIT-SP-EDT-TABLE-LOOKUP.

       PROCEEDS-VALIDATION.
           ADD 1 TO COUNTER.

           IF COUNTER > SP-EDT-NOEDITS(ETBL)
              GO TO PROCEEDS-TABLE2.

      *    IF SP-EDT-TYPE(ETBL,COUNTER) = "A"
      *       IF SP-EDT-HL(ETBL,COUNTER) = "L"
      *          IF SP-EDT-AMTYPE(ETBL,COUNTER) = "P"
      *             IF SP-EDT-AMT(ETBL,COUNTER) < PROCEEDS-LOW
      *                MOVE SP-EDT-AMT(ETBL,COUNTER) TO PROCEEDS-LOW.
           IF SP-EDT-TYPE(ETBL,COUNTER) = "A"
              IF SP-EDT-HL(ETBL,COUNTER) = "H"
      *          IF SP-EDT-AMTYPE(ETBL,COUNTER) = "P"
                    IF SP-EDT-AMT(ETBL,COUNTER) > PROCEEDS-HIGH
                       MOVE SP-EDT-AMT(ETBL,COUNTER) TO PROCEEDS-HIGH.

           IF COUNTER NOT > SP-EDT-NOEDITS(ETBL)
              GO TO PROCEEDS-VALIDATION.

       PROCEEDS-TABLE2.
           IF SP-EDT-NOEDITS(ETBL) NOT < 6 AND ETBL NOT = 2
              MOVE 0 TO COUNTER
              SET ETBL TO 2
              GO TO PROCEEDS-VALIDATION.
      *    IF ((AMT-HOLDER < PROCEEDS-LOW)
      *                 AND (PROCEEDS-LOW NOT = 999999.99)) OR
           IF ((AMT-HOLDER > PROCEEDS-HIGH)
                            AND (PROCEEDS-HIGH NOT = 0))
              GO TO PROCEEDS-OUT-OF-RANGE-MSG.

           MOVE 0 TO AMT-HOLDER COUNTER.
           GO TO EXIT-SP-EDT-TABLE-LOOKUP.

       PROCEEDS-OUT-OF-RANGE-MSG.
           MOVE "PRIOR LOAN BAL + PROCEEDS + G/L FEES OUT OF SP RANGE"
                                                               TO MESS.
           PERFORM SEND-MESS.
           MOVE 9 TO IO-FG.
           GO TO EXIT-SP-EDT-TABLE-LOOKUP.

       OUT-OF-RANGE-MSG.
           MOVE "VALUE OUT OF RANGE SET IN SP RECORD" TO MESS.
           PERFORM SEND-MESS.
           MOVE 9 TO IO-FG.

       EXIT-SP-EDT-TABLE-LOOKUP.
           EXIT.

      *****************************************
       MAKE-DATES-CURRENT SECTION.
      *****************************************
           IF PD-LOANDATE NOT = PD-INTDATE
              MOVE PD-LOANDATE TO DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY TO D-060
              MOVE PD-INTDATE TO DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY TO D-061
              MOVE PD-1STPYDATE TO DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY TO D-070
              GO TO MAKE-DATES-CURRENT-EXIT.

      * SET NEW INTEREST DATE:
           MOVE PD-LOANDATE TO NUM-DATE.
           MOVE PD-INTDATE TO SYS-DATE.
           PERFORM TIM.
           MOVE ELAPSED-DAYS        TO NDTE-HOLD.
           MOVE TRANS-DATE-YYYYMMDD TO NDTE-DATE.
           PERFORM INCREMENT-DAYS.
           MOVE NDTE-DATE TO PD-INTDATE DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-061.

      * SET NEW LOAN DATE:
           MOVE TRANS-DATE-YYYYMMDD TO PD-LOANDATE DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-060.

      * SET NEW 1ST PAY DATE:
           MOVE PD-INTDATE TO NDTE-DATE
                              SYS-DATE.
           MOVE 1 TO NDTE-HOLD.
           MOVE PD-UNITPER-CD TO DATER-UNITPER-CD.
           MOVE PD-UNITPER-FREQ TO DATER-UNITPER-FREQ.
           PERFORM INCREMENT-UNITPER.
           MOVE NDTE-DATE TO NUM-DATE.

      * WORLD OPTION TO ADVANCE TO 1ST OF NEXT MONTH
      * IF NO CORRESPONDING DAY IN NEW MONTH:
           PERFORM SET-ADV-TO-1ST-NO-CORR.
           IF ADV-TO-1ST-NO-CORR = "Y"
              IF NOT ( PD-ORGST   = "TN" AND
                       PD-CLASS   = 01   AND
                       PD-ORGTERM = 12)
                 IF PD-UNITPER-CD = "M" AND PD-UNITPER-FREQ = 1
                    IF S-DD > NDTE-DD
                       MOVE 1 TO NDTE-DD
                                 NDTE-HOLD
                       PERFORM INCREMENT-MONTHS
                       MOVE NDTE-DATE TO NUM-DATE.

      * IF DATE OF THE LOAN IS ON THE 26 THRU 31 THEN ADVANCE THE
      *   FIRST PAYMENT DUE DATE TO THE FIRST OF THE SECOND MONTH
      *   FOLLOWING THE DATE OF THE LOAN. (REGMGM PR#1099)
           IF ADV-TO-1ST-NO-CORR = "A"
              IF PD-UNITPER-CD = "M" AND PD-UNITPER-FREQ = 1
                 IF S-DD > 25
                    MOVE 1 TO NDTE-DD
                              NDTE-HOLD
                    PERFORM INCREMENT-MONTHS
                    MOVE NDTE-DATE TO NUM-DATE.


      * TEST FOR ORIGINAL SAVED QUOTE HAVING AN EXTENDED FIRST PAY
           IF NUM-DATE > PD-1STPYDATE
              MOVE NUM-DATE TO PD-1STPYDATE
                               PD-ORIG-1STPYDATE.
           MOVE PD-1STPYDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-070.

      * SET INSURANCE EXPIRATION DATES, IF NECESSARY
      * 06/28/96 BAH
           MOVE 5 TO SUB.
       MAKE-NEXT-INS-CURRENT.
           IF PD-INSEXP-DATE(SUB) NOT = 0 AND PD-INSPREM(SUB) NOT = 0
              MOVE PD-INTDATE TO NDTE-DATE
              MOVE PD-ORGTERM TO NDTE-HOLD
              MOVE PD-UNITPER-CD TO DATER-UNITPER-CD
              MOVE PD-UNITPER-FREQ TO DATER-UNITPER-FREQ
              PERFORM INCREMENT-UNITPER
              MOVE "SNNN060  2." TO VDU
              COMPUTE VDUROW = SUB + 24
              MOVE NDTE-DATE TO PD-INSEXP-DATE(SUB) DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY TO VDUNUM0
              PERFORM SCREENIO.
           IF SUB < 6
              ADD 1 TO SUB
              GO TO MAKE-NEXT-INS-CURRENT.

       MAKE-DATES-CURRENT-EXIT.
           EXIT.


      **********************************************
       TEST-FOR-GEORGIA-SCHG SECTION.
      **********************************************
           IF QUOTE-ONLY AND PD-SSNO(1) = 0
              GO TO EXIT-TEST-FOR-GEORGIA.

      * WORLD 1154
           IF SP-SCFRMLA = 58
              GO TO TEST-FOR-TEXAS-SCHG.

           IF (SP-SCFRMLA = 4 OR 16 OR 29 OR 47 OR 49 OR 52 OR 53 OR 59)
              GO TO TEST-FOR-CALIF-SCHG.

           IF (SP-SCFRMLA = 23 OR 43 OR 45 OR 48 OR 50 OR 55
                                OR 56 OR 57)
              GO TO TEST-FOR-NC-SCHG.

           IF NOT (SP-SCFRMLA = 12 OR 13 OR 54)
              GO TO EXIT-TEST-FOR-GEORGIA.

            MOVE " " TO SCHG-UPDATE-FG.
            MOVE 0 TO SCHG-NEW-ACCTNO.
            MOVE PD-SSNO(1) TO SCHG-LN-SSNO(1).
            MOVE PD-SSNO(2) TO SCHG-LN-SSNO(2).
            MOVE PD-SSNO(3) TO SCHG-LN-SSNO(3).
            MOVE PD-SSNO(4) TO SCHG-LN-SSNO(4).
            MOVE TRANS-DATE-YYYYMMDD TO SCHG-TRANS-DATE.
            IF PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
               MOVE PD-PRLNNO TO SCHG-PRIOR-ACCTNO
            ELSE
               MOVE 0 TO SCHG-PRIOR-ACCTNO.
            MOVE PD-ORGST TO SCHG-ORGST.
            MOVE PD-CLASS TO SCHG-LN-CLASS.
            MOVE SP-SCFRMLA TO GA-SCHG-NO.
            MOVE GA-SCHG-PATH TO FORM-NAM.
           IF GA-SCHG-NO = 13
              CALL FORM-PROGX USING FORM-PATH SCHG-WORKERS
                                             SCHG-WORKERS-2
           ELSE
               CALL FORM-PROGX USING FORM-PATH SCHG-WORKERS.
            CANCEL FORM-PROGX.
            MOVE SCHG-RESTRICT-ADJ  TO CIP-RESTRICT-ADJ
                                       PD-RESTRICT-ADJ.
            MOVE SCHG-DUAL-LOAN-ADJ TO CIP-DUAL-LOAN-ADJ
                                       PD-DUAL-LOAN-ADJ.
            MOVE SCHG-DUAL-LIAB TO SPDUAL-LIAB.

            GO TO EXIT-TEST-FOR-GEORGIA.

      ***************************************************************
      * WORLD, TX CLASS 5 (58)
      ***************************************************************
       TEST-FOR-TEXAS-SCHG.
           IF NOT (SP-SCFRMLA = 58)
              GO TO EXIT-TEST-FOR-GEORGIA.

            MOVE SP-SCFRMLA   TO TXSCHG-SCFRMLA.
            IF PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
               MOVE PD-PRLNNO TO TXSCHG-PRIOR-ACCTNO
            ELSE
               MOVE 0         TO TXSCHG-PRIOR-ACCTNO.
            MOVE PD-LOANDATE  TO TXSCHG-LOANDATE.
            MOVE PD-SSNO(1)   TO TXSCHG-SSNO.
            MOVE PD-ORGST     TO TXSCHG-ORGST.
            MOVE PD-CLASS     TO TXSCHG-CLASS.
            MOVE " "          TO TXSCHG-RESTRICTED.

            MOVE "CL/TXSCHG" TO FORM-NAM.
            CALL FORM-PROGX USING FORM-PATH TXSCHG-WORKERS.
            CANCEL FORM-PROGX.

      *  USE CIP-RESTRICT-ADJ TO FLAG CALCZL THAT YOU CANT TAKE
      *  ANOTHER SERVICE CHARGE IF ANYTHING IN HERE
            IF TXSCHG-RESTRICTED = "Y"
      *  RESTRICTED FLAG = "Y" MEANS THAT YOU CANT TAKE ANOTHER CHARGE
                MOVE 50.00  TO CIP-RESTRICT-ADJ
            ELSE
                MOVE 0      TO CIP-RESTRICT-ADJ.

            GO TO EXIT-TEST-FOR-GEORGIA.

      ***************************************************************
      * COSMO, CA 2-8-95 (4)
      * MULLEN, CA 12-11-95 (16)
      * MULLEN, CA 12-30-97 (29)
      * BAYC, MD   11-09-11 (47) ADDED 12 MONTH CHECK
      * REGMGM, TX 07-30-07 (49)
      * MULLEN, CA 06-02-11 (52,53)
      * WORLD,  KY 05-29-19 (59)
      ***************************************************************
       TEST-FOR-CALIF-SCHG.
           IF NOT (SP-SCFRMLA = 4 OR 16 OR 29 OR 47 OR 49 OR 52 OR 53 OR
                                                             59)
              GO TO EXIT-TEST-FOR-GEORGIA.

            MOVE SP-SCFRMLA   TO CASCHG-SCFRMLA.
            IF PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
               MOVE PD-PRLNNO TO CASCHG-PRIOR-ACCTNO
            ELSE
               MOVE 0         TO CASCHG-PRIOR-ACCTNO.
            MOVE PD-LOANDATE  TO CASCHG-LOANDATE.
            MOVE " "          TO CASCHG-RESTRICTED.

            MOVE "CL/CASC16" TO FORM-NAM.
            CALL FORM-PROGX USING FORM-PATH CASCHG-WORKERS.
            CANCEL FORM-PROGX.

      *  USE CIP-RESTRICT-ADJ TO FLAG CALCZL THAT YOU CANT TAKE
      *  ANOTHER SERVICE CHARGE IF ANYTHING IN HERE
            IF CASCHG-RESTRICTED = "Y"
      *  RESTRICTED FLAG = "Y" MEANS THAT YOU CANT TAKE ANOTHER CHARGE
                MOVE 50.00  TO CIP-RESTRICT-ADJ
            ELSE
                MOVE 0 TO CIP-RESTRICT-ADJ.

            GO TO EXIT-TEST-FOR-GEORGIA.

       TEST-FOR-NC-SCHG.
           IF NOT (SP-SCFRMLA = 23 OR 43 OR 45 OR 48 OR 50
                                    OR 55 OR 56 OR 57)
              GO TO EXIT-TEST-FOR-GEORGIA.

           MOVE 0 TO NCSCHG-LN-ACCTNO.

           IF SP-SCFRMLA = 48
              IF PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
                 MOVE PD-PRLNNO TO NCSCHG-LN-ACCTNO.

           IF SP-SCFRMLA = 50
              IF PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
                 MOVE PD-PRLNNO TO NCSCHG-LN-ACCTNO
              ELSE
      * IF SCFRMLA 50 AND NOT A RENEWAL, THEN NO RESTRICTION TEST
      *   IS EVEN NECESSARY, SO SKIP IT, SCHG WILL BE $100
                 MOVE 100.00 TO CIP-RESTRICT-ADJ
                 GO TO EXIT-TEST-FOR-GEORGIA.

           MOVE PD-SSNO(1)          TO NCSCHG-LN-SSNO.
           MOVE PD-SSNO(2)          TO NCSCHG-LN-SSNO-2.
           MOVE PD-SSNO(3)          TO NCSCHG-LN-SSNO-3.
           MOVE PD-SSNO(4)          TO NCSCHG-LN-SSNO-4.
           MOVE PD-ORGST            TO NCSCHG-ORGST.
           MOVE PD-CLASS            TO NCSCHG-CLASS.
           MOVE TRANS-DATE-YYYYMMDD TO NCSCHG-TRANS-DATE.
           MOVE " "                 TO NCSCHG-RESTRICTED.
           MOVE 0                   TO NCSCHG-NO-SERCHG.
           MOVE SP-SCFRMLA          TO NCSCHG-SCFRMLA.

           MOVE "CL/NCSC23" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH NCSCHG-WORKERS.
           CANCEL FORM-PROGX.

      * USE CIP-RESTRICT-ADJ TO FLAG CALCZL THAT YOU CANT TAKE
      * ANOTHER SERVICE CHARGE IF ANYTHING IN THERE
           IF NCSCHG-RESTRICTED = "Y"
      * RESTRICTED FLAG = "Y" MEANS THAT YOU CANT TAKE ANOTHER CHARGE
              MOVE 50.00  TO CIP-RESTRICT-ADJ
           ELSE
              MOVE 0 TO CIP-RESTRICT-ADJ.

      * NCSCHG-RESTRICTED "1" = CHARGE $100
      * NCSCHG-RESTRICTED "2" = CHARGE $50
      * NCSCHG-RESTRICTED "3" = CHARGE $25
           IF SP-SCFRMLA = 50
              MOVE 100.00 TO CIP-RESTRICT-ADJ
              IF NCSCHG-RESTRICTED = "3"
                 MOVE 25.00 TO CIP-RESTRICT-ADJ
              ELSE
              IF NCSCHG-RESTRICTED = "2"
                 MOVE 50.00 TO CIP-RESTRICT-ADJ.

       EXIT-TEST-FOR-GEORGIA.
           EXIT.

      *******************************************
      * TEST FOR TENNESSEE MAINTFEE RESTRICTIONS
      * CAN NOT CHARGE A MAINTFEE IF AN OPEN LOAN
      * EXIST WITH A MAINTFEE ALREADY
      *******************************************
       TEST-FOR-MFEE SECTION.
           IF (QUOTE-ONLY)
                  OR (NOT (SP-MFFRMLA = 4))
              MOVE 0 TO CIP-MFEE-RESTRICT
              GO TO TEST-MFEE-EXIT.

           MOVE PD-SSNO(1) TO MFEE04-LN-SSNO(1).
           MOVE PD-SSNO(2) TO MFEE04-LN-SSNO(2).
           MOVE PD-SSNO(3) TO MFEE04-LN-SSNO(3).
           MOVE PD-SSNO(4) TO MFEE04-LN-SSNO(4).
           MOVE TRANS-DATE-YYYYMMDD TO MFEE04-TRANS-DATE.

           IF PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
              MOVE PD-PRLNNO TO MFEE04-PRIOR-ACCTNO
           ELSE
              MOVE 0 TO MFEE04-PRIOR-ACCTNO.

           MOVE SP-MFFRMLA TO MFEE04-MFFRMLA.
           MOVE "Y" TO MFEE04-CHARGE-MFEE.

           MOVE "CL/MFEE04" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH MFEE04-WORKERS.
           CANCEL FORM-PROGX.

           IF MFEE04-CHARGE-MFEE = "Y"
              MOVE 0 TO CIP-MFEE-RESTRICT
           ELSE
              MOVE 50.00 TO CIP-MFEE-RESTRICT.

       TEST-MFEE-EXIT.
           EXIT.
      *********************************************
      *    TEST FOR WISCONSIN SERVICE CHARGE
      *********************************************
       TEST-FOR-WI-SCHG SECTION.
      *    IF (QUOTE-ONLY) OR SP-SCFRMLA NOT = 63
           IF SP-SCFRMLA NOT = 63
              GO TO TEST-FOR-WI-EXIT.

           MOVE 0 TO WISCHG-PRIOR-SERCHG
                     CIP-RESTRICT-SERCHG.

           IF NOT (PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO")
              GO TO TEST-FOR-WI-EXIT.

           MOVE PD-SSNO(1) TO WISCHG-LN-SSNO(1).
           MOVE PD-SSNO(2) TO WISCHG-LN-SSNO(2).
           MOVE PD-SSNO(3) TO WISCHG-LN-SSNO(3).
           MOVE PD-SSNO(4) TO WISCHG-LN-SSNO(4).
           MOVE PD-LOANDATE TO WISCHG-TRANS-DATE.
           MOVE PD-PRLNNO  TO WISCHG-PRIOR-ACCTNO.
           MOVE PD-ORGST   TO WISCHG-ORGST.
           MOVE SP-SCFRMLA TO WISCHG-SCFRMLA.

           MOVE "CL/WISCHG" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH WISCHG-WORKERS.
           CANCEL FORM-PATH.

      * COMES OUT WITH PRIOR SERCHG IF RESTRICTED AND IT MUST
      * BE SUBTRACTED FROM NEW SERCHG
           MOVE WISCHG-PRIOR-SERCHG TO CIP-RESTRICT-SERCHG.

       TEST-FOR-WI-EXIT.
           EXIT.

      *********************************************
       TEST-FOR-SC-SCHG SECTION.
      *********************************************
           IF (QUOTE-ONLY)
                  OR (NOT (SP-SCFRMLA = 18 OR 42))
              GO TO TEST-FOR-SC-SCHG-EXIT.

           MOVE " "        TO SCSCHG-UPDATE-FG.
           MOVE 0          TO SCSCHG-NEW-ACCTNO.
           MOVE PD-SSNO(1) TO SCSCHG-LN-SSNO(1).
           MOVE PD-SSNO(2) TO SCSCHG-LN-SSNO(2).
           MOVE PD-SSNO(3) TO SCSCHG-LN-SSNO(3).
           MOVE PD-SSNO(4) TO SCSCHG-LN-SSNO(4).
           MOVE TRANS-DATE-YYYYMMDD TO SCSCHG-TRANS-DATE.
           IF PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
              MOVE PD-PRLNNO TO SCSCHG-PRIOR-ACCTNO
           ELSE
              MOVE 0         TO SCSCHG-PRIOR-ACCTNO.
           MOVE PD-ORGST     TO SCSCHG-ORGST.
           MOVE SP-SCFRMLA   TO SC-SCHG-NO SCSCHG-SCFRMLA.
           IF SP-SCFRMLA = 42
              MOVE 18 TO SC-SCHG-NO.
           MOVE SC-SCHG-PATH TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH SCSCHG-WORKERS.
           CANCEL FORM-PROGX.
           MOVE SCSCHG-PRIOR-CASHADV TO CIP-PRIOR-CASHADV.
           MOVE SCSCHG-RESTRICT-SERCHG TO CIP-RESTRICT-SERCHG.
           MOVE SCSCHG-RESTRICT-HIGH-CASHADV
                                 TO CIP-RESTRICT-HIGH-CASHADV.
           MOVE 0 TO SPDUAL-LIAB.

       TEST-FOR-SC-SCHG-EXIT.
           EXIT.

      *****************************************
       CALL-LOAN-CALCULATIONS SECTION.
      *****************************************
           MOVE "Y" TO LOAN-CALCULATOR-CALLED-FG.
           MOVE "CALCULATING - PLEASE WAIT" TO LEGEND.
           PERFORM SEND-LEGEND.

      *------------------------------------------------------------------
      * "OK" CLASS 5 IS NEW LARGE LOAN CLASS, AND HAS INSURANCE AND FEES
      * THAT THEY ARE CHANGING, AND ALSO DOES NOT FOLLOW THE SMALL LOAN
      * "OK" ABNORMAL INTCHG CALCULATION...JTG, BAH 6/9/99
      * REMOVED TEST FOR "MO"                              WORLD PR#J020
      *------------------------------------------------------------------
           IF PD-SPRCLASS NOT = 5
              IF PD-ORGST = "OK"
      * ADDED FOLLOWING CAN-LOAN-NO IF 10/03/98
                 IF CAN-LOAN-NO NOT = "  "
                    MOVE "A" TO COP-RETURN-CODE
                    MOVE 0 TO IO-FG
                    GO TO CALL-LOAN-CALCULATIONS-EXIT.
      *------------------------------------------------------------------

           MOVE CAN-LOAN-NO TO CIP-CAN-LOAN-NO.

      * SETUP VERIFY-REJECT-TERMS RE: SP-INSREJECT-FG = "C":
           PERFORM ESTABLISH-REJECT-TERMS.

      *----------------------------------------------------------
      *    ENVIRONMENT VARIABLE 'CALL_TESTZL' IS USED TO CALL
      *    ANOTHER VERSION OF CALCZL,
      *    NOTE:
      *         HELPFULL WHEN TRYING TO RUN CALCZL.C IN DEBUG
      *         FROM TWO TERMINALS AT THE SAME TIME.
      *         THE DEBUGGER DOSN'T ACT CORRECTLY WITH TWO
      *         SESSIONS RUN TOGETHER
      *         OR
      *         WHEN MAKING LARGE CHANGES TO CALCZL.C
      *
      *    MOVE "CALL_TESTZL" TO GETENV-BUF.
      *    PERFORM GETENV-CALL.
      *    IF STAT = "00"
      *       MOVE "LP/TESTZL" TO FORM-NAM
      *    ELSE
      *----------------------------------------------------------
           MOVE "LP/CALCZL" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH
                                CIP-CALCULATION-INPUT-AREA
                                CEP-CALCULATION-EDIT-AREA
                                COP-CALCULATION-OUTPUT-AREA
                                SP-REC
                                BR-REC STATE CITY-TAX-CD COUNTY.
           CANCEL FORM-PROGX.

           MOVE COP-PROCEEDS TO PD-PROCEEDS DF2-PROCEEDS.
           IF PD-CAN-LOAN-MAX NOT = 0
              IF PRIOR-LNAMT = 0
                 MOVE PD-PROCEEDS TO PD-CAN-LOAN-MAX.
           MOVE COP-PROCEEDS-SW TO PD-PROCEEDS-FG DF2-PROCEEDS-FG.
           MOVE COP-POINTS TO PD-POINTS DF2-POINTS.
           MOVE COP-POINTS-SW TO PD-POINTS-FG DF2-POINTS-FG.

           MOVE COP-OVR-RATE TO PD-OVRDRATE DF2-OVRDRATE.
           MOVE COP-OVR-RATE-SW TO PD-OVRDRATE-FG DF2-OVRDRATE-FG.
           MOVE COP-EFF-RATE TO PD-EFFRATE DF2-EFFRATE.
           MOVE COP-SIM-RATE TO PD-SMPRATE.
           MOVE COP-APR-RATE TO PD-APRATE DF2-APRATE.
           MOVE PD-ENDORATE TO DF2-ENDORATE.
           MOVE COP-TOT-REPYBLE TO DF2-TREPAY.
           PERFORM MOVE-INSURANCE-TO-PDREC VARYING COUNTER
              FROM 1 BY 1 UNTIL COUNTER > 4.

           MOVE COP-SERVICE-CHG TO PD-SERCHG DF2-SERCHG
                                              PD-SUM-SERCHG.
           MOVE COP-STATE-WORKER TO PD-STATE-WORKER.
           MOVE COP-SERVICE-CHG-SW TO PD-SERCHG-FG DF2-SERCHG-FG.
           MOVE COP-MAINT-FEES TO DF2-MAINTFEE MAINTFEE-HLDR
                                  PD-SUM-MAINTFEE.
           DIVIDE COP-MAINT-FEES BY COP-TERM GIVING
                                               PD-MAINTFEE ROUNDED.
           MOVE COP-MAINT-FEES-SW TO PD-MAINTFEE-FG DF2-MAINTFEE-FG.
           MOVE COP-1ST-PY-EXT TO PD-EXTCHG DF2-EXTCHG
                                         PD-SUM-EXTCHG.

           MOVE COP-1ST-PY-EXT-SW TO PD-EXTCHG-FG DF2-EXTCHG-FG.
           MOVE COP-INT-CHARGE TO PD-INTCHG DF2-INTCHG
                                            PD-SUM-INTCHG.
           MOVE COP-APR-FINANCD TO PD-APR-FINAMT DF2-APR-FINAMT.
           MOVE COP-AMT-FINANCD TO PD-FINAMT.
           MOVE COP-LOAN-AMOUNT TO PD-LNAMT PD-PURBAL
                                   PD-ORIGPURAMT DF2-LNAMT
                                   PD-SUM-LNAMT
                                   PD-SUM-ORIGPURAMT.
           MOVE COP-ANTIC-EARNS TO DF2-ANTICIPATED.
           IF PD-LOANTYPE = "I"
              MOVE PD-SERCHG TO PD-ANTICERN(3)
              MOVE 0 TO PD-ANTICERN(1)
                        PD-ANTICERN(2)
                        PD-ANTICERN(4)
           ELSE
              ADD COP-INT-CHARGE COP-1ST-PY-EXT GIVING PD-ANTICERN(1)
              MOVE COP-SERVICE-CHG TO PD-ANTICERN(3)
              MOVE COP-MAINT-FEES TO PD-ANTICERN(4).
           MOVE 0 TO PD-ANTICERN(5) PD-ANTICERN(6).

            MOVE PD-ANTICERN(1) TO WK-ANTICERN(1).
            MOVE PD-ANTICERN(2) TO WK-ANTICERN(2).
            MOVE PD-ANTICERN(3) TO WK-ANTICERN(3).
            MOVE PD-ANTICERN(4) TO WK-ANTICERN(4).
            MOVE PD-ANTICERN(5) TO WK-ANTICERN(5).
            MOVE PD-ANTICERN(6) TO WK-ANTICERN(6).
            PERFORM ADJUST-ANTICERN.
            MOVE WK-ANTICERN(1) TO PD-ANTICERN(1).
            MOVE WK-ANTICERN(2) TO PD-ANTICERN(2).
            MOVE WK-ANTICERN(3) TO PD-ANTICERN(3).
            MOVE WK-ANTICERN(4) TO PD-ANTICERN(4).
            MOVE WK-ANTICERN(5) TO PD-ANTICERN(5).
            MOVE WK-ANTICERN(6) TO PD-ANTICERN(6).

           MOVE COP-ODD-1ST-PMT TO PD-1STPYAMT DF2-1STPYAMT.
           MOVE COP-REG-PAYMENT TO PD-REGPYAMT DF2-REGPYAMT
                                       PD-SUM-REGPYAMT.
           MOVE COP-REG-PAYMENT-SW TO PD-REGPYAMT-FG DF2-REGPYAMT-FG.
           MOVE COP-FINCHG TO PD-FINCHG PD-SUM-FINCHG.
           MOVE COP-RETURN-CODE TO DF2-RETURN-CODE.
           MOVE COP-LOOP-COUNT TO DF2-LOOP-COUNT.

           IF COP-1ST-PMT-MTHS = 1
                    AND COP-1ST-PMT-DAYS = 0
              MOVE "Y" TO PD-ONE-MTH-NO-DAY-EXT-SW
           ELSE
              MOVE " " TO PD-ONE-MTH-NO-DAY-EXT-SW.

           PERFORM DISPLAY-PROMPTS.
           MOVE DF2-BUF TO WR-BUF.
           MOVE DF2-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.

           PERFORM RESET-LEGEND.
           MOVE COP-CALCULATION-OUTPUT-AREA
                        TO CIP-CALCULATION-INPUT-AREA.
           PERFORM CALC-NO-OF-PAYMENTS.
           IF COP-AMT-FINANCD > COP-LOAN-AMOUNT
              MOVE "X" TO COP-RETURN-CODE.
      
      * TEST FOR PROCEEDS < 0
       
           COMPUTE VDUNUM2 = COP-TOTAL-NOTE
                             - COP-NEW-LOAN-PROCEEDS
                             - COP-SERVICE-CHG.
           IF NOT COP-INS-USE-IS-MEMO(1)
              SUBTRACT COP-INS-PREMIUM(1) FROM VDUNUM2.
           IF NOT COP-INS-USE-IS-MEMO(2)
              SUBTRACT COP-INS-PREMIUM(2) FROM VDUNUM2.
           IF NOT COP-INS-USE-IS-MEMO(3)
              SUBTRACT COP-INS-PREMIUM(3) FROM VDUNUM2.
           IF NOT COP-INS-USE-IS-MEMO(4)
              SUBTRACT COP-INS-PREMIUM(4) FROM VDUNUM2.
           IF NOT COP-INS-USE-IS-MEMO(5)
              SUBTRACT COP-INS-PREMIUM(5) FROM VDUNUM2.
           IF NOT COP-INS-USE-IS-MEMO(6)
              SUBTRACT COP-INS-PREMIUM(6) FROM VDUNUM2.
           IF NOT COP-INS-USE-IS-MEMO(7)
              SUBTRACT COP-INS-PREMIUM(7) FROM VDUNUM2.
           IF NOT COP-INS-USE-IS-MEMO(8)
              SUBTRACT COP-INS-PREMIUM(8) FROM VDUNUM2.
           IF VDUNUM2 < 0
              MOVE "X" TO COP-RETURN-CODE.
      

           IF COP-CALCULATION-OK
              PERFORM VERIFY-AGAINST-SPEDT
           ELSE
              PERFORM ERROR-IN-CALCULATIONS-MSG.
           MOVE 0 TO IO-FG.

       CALL-LOAN-CALCULATIONS-EXIT.
           EXIT.

      ******************************************************************
      *    IN : PD-COLLCD
      *         PD-INTDATE
      *         PD-LOANDATE
      *         CURRENT SPR RECORD
      *    OUT: RESCISSION-STATUS
      ******************************************************************
       RESCISSION-ROUTINE SECTION.

           MOVE SPACES      TO RESCISSION-BUF.
           MOVE SPACES      TO RESCISSION-FLAG.
           MOVE PD-LOANDATE TO RESCISSION-INTDATE.
           MOVE SPACES      TO RESCISSION-POCD.
           MOVE SPACES      TO RESCISSION-SECURED-COLLCD.
           MOVE SPACES      TO RESCISSION-STATUS.

           MOVE "CO"      TO CD-TYPE.
           MOVE PD-COLLCD TO CD-CODE.
           PERFORM OPEN-CD1-FILE.
           PERFORM READ-CD1-FILE.
           PERFORM CLOSE-CD1-FILE.
           IF ( IO-BAD )
              MOVE SPACES TO CD-CO-SECURED.

           MOVE CD-CO-SECURED TO RESCISSION-SECURED-COLLCD.

      * VERIFY FOR RESCISSION  
           IF ( RESCISSION-INTDATE = ZEROES )
              GO TO RESCISSION-ROUTINE-EXIT.

           IF ( NOT RESCISSION-SECURED-COLLCD-YES ) OR
              ( NOT SP-RESCIND-BUS-DAYS-VALID     ) OR
              (     SP-RESCIND-BUS-DAYS = "0"     )
              GO TO RESCISSION-ROUTINE-SKIP.

      * QUOTE IS FOR RESCISSION 

           PERFORM OPEN-GB-FILE.
           MOVE PD-OWNBR TO GB-BRNO.
           MOVE 1        TO GB-NO.
           PERFORM READ-GB-FILE.
           PERFORM CLOSE-GB-FILE.

           MOVE PD-LOANDATE TO RESCIND-LOANDATE.
           PERFORM RESCIND-CALCULATION.

           MOVE RESCISSION-MESSAGE TO RESCISSION-BUF.
           MOVE "*I"               TO RESCISSION-POCD.
           MOVE RESCIND-OUTDATE     TO RESCISSION-INTDATE.

       RESCISSION-ROUTINE-SKIP.

           MOVE RESCISSION-POCD    TO PD-POCD.
           MOVE RESCISSION-INTDATE TO PD-INTDATE.

           IF ( PD-POCD-INRESCISSION )
              MOVE "Y"             TO PD-RESCISSION
              MOVE PD-INTDATE      TO PD-RESCISSION-DATE
           ELSE
              MOVE "N"             TO PD-RESCISSION
              MOVE ZEROES          TO PD-RESCISSION-DATE.

           MOVE "S  8000061." TO VDU.
           MOVE PD-INTDATE    TO VDU-DATE-YYYYMMDD.
           PERFORM SCREENIO.

      * SEND PRIOR LOAN AMOUNT 
           PERFORM PROCESS-PRIOR-LOAN.

           MOVE "SNNN062111." TO VDU.
           MOVE PRIOR-LNAMT   TO VDUNUM2.
           PERFORM SCREENIO.

           PERFORM RESCISSION-SET-1STPYDATE.
           PERFORM SEND-RESCISSION.

       RESCISSION-ROUTINE-EXIT.
           EXIT.

      *************************************************
       RESCISSION-SET-1STPYDATE SECTION.
      *************************************************

           MOVE PD-INTDATE      TO NDTE-DATE   SYS-DATE.
           MOVE 1               TO NDTE-HOLD.
           MOVE PD-UNITPER-CD   TO DATER-UNITPER-CD.
           MOVE PD-UNITPER-FREQ TO DATER-UNITPER-FREQ.
           PERFORM INCREMENT-MONTHS.

      * WORLD OPTION TO ADVANCE TO 1ST OF NEXT MONTH
      * IF NO CORRESPONDING DAY IN NEW MONTH:

           PERFORM SET-ADV-TO-1ST-NO-CORR.
           IF ADV-TO-1ST-NO-CORR = "Y"
              IF NOT ( PD-ORGST   = "TN" AND
                       PD-CLASS   = 01   AND
                       PD-ORGTERM = 12)
              IF PD-UNITPER-CD = "M" AND PD-UNITPER-FREQ = 1
                 IF S-DD > NDTE-DD
                    MOVE 1 TO NDTE-DD
                              NDTE-HOLD
                    PERFORM INCREMENT-MONTHS
                    MOVE NDTE-DATE TO NUM-DATE.

      * IF DATE OF THE LOAN IS ON THE 26 THRU 31 THEN ADVANCE THE
      * FIRST PAYMENT DUE DATE TO THE FIRST OF THE SECOND MONTH
      * FOLLOWING THE DATE OF THE LOAN. (REGMGM PR#1099)

           IF ( ADV-TO-1ST-NO-CORR = "A" ) AND
              ( PD-UNITPER-CD         = "M" ) AND
              ( PD-UNITPER-FREQ       = 1   ) AND
              ( S-DD > 25                   )
              MOVE 1         TO NDTE-DD NDTE-HOLD
              PERFORM INCREMENT-MONTHS
              MOVE NDTE-DATE TO NUM-DATE.

      * SEND 1STPYDATE 

           MOVE "S  8000070." TO VDU.
           MOVE NDTE-DATE     TO VDU-DATE-YYYYMMDD
                                 PD-1STPYDATE
                                 PD-ORIG-1STPYDATE.
           PERFORM SCREENIO.

           PERFORM SPTEST-EXTDATE-VALID.
           IF ( LIMIT-ERROR = "Y" )
              MOVE "X" TO RESCISSION-STATUS
              GO TO RESCISSION-SET-1STPY-EXIT.

      * CITIZENS TEST 
           IF ( NEW-FLAG NOT = 1 )
              MOVE 800          TO CIP-NO-OF-TIMES-CALLED
              MOVE PD-LOANDATE  TO CIP-LN-DT
              MOVE PD-INTDATE   TO CIP-IN-DT
              MOVE PD-1STPYDATE TO CIP-PMT-DT
              PERFORM CALL-LOAN-CALCULATIONS.

       RESCISSION-SET-1STPY-EXIT.
           EXIT.

      *******************************************************************
      * TEST FOR MAXIMUM EDIT ON POINTS AND FEES FOR TN MORTGAGE LOANS.
      *                                                    PR#3043
      *
      *  DEFINITIONS:
      *       AMOUNT FINANCED: TOTAL PAYMENTS
      *                               - MAINT FEE
      *                               - INT
      *                               - 1ST PAY EXT
      *       POINTS AND FEES:  POINTS AS CALCULATED
      *                               + FEE CODE 78 (LOAN PROCESSING)
      *                               + FEE CODE 79 (PROP INSURANCE)
      *                               + FEE CODE 88 (DOC PREP)
      *
      *  MAXIMUM FEE BASED ON THIS CHART:
      *               AMOUNT FINANCED            MAX POINTS/FEES
      *             -----------------------  ------------------------
      *             <=30,000.00               8% OF AMOUNT FINANCED
      *             30,000.01 TO 48,000.00    $2,400.00
      *             >= 48,000.01              5% OF AMOUNT FINANCED
      *******************************************************************
       TN-MTG-VALIDATION SECTION.
      *******************************************************************
           IF SP-SCMAX NOT = 999999.96
              GO TO TN-MTG-VALIDATION-EXIT.

           MOVE 0 TO WS-TN-ERRCD WS-TN-MAXAMT.
           PERFORM TN-FIND-FEECODES.
           COMPUTE WS-TN-FINAMT = TOTAL-REPAY - PD-MAINTFEE
                                              - PD-INTCHG - PD-EXTCHG.
           COMPUTE WS-TN-POINTSFEES = PD-SERCHG + WS-TN-FEEWORKER.

           IF WS-TN-FINAMT <= 30000.00
              MULTIPLY WS-TN-FINAMT BY 0.08
                                GIVING WS-TN-MAXAMT ROUNDED
              IF WS-TN-POINTSFEES > WS-TN-MAXAMT
                 GO TO TN-POINTS-OUT-OF-RANGE-MSG
              END-IF
           ELSE
              IF WS-TN-FINAMT > 30000.00 AND WS-TN-FINAMT <= 48000.00
                 IF WS-TN-POINTSFEES > 2400.00
                    GO TO TN-POINTS-OUT-OF-RANGE-MSG
                 END-IF
              ELSE
                 MULTIPLY WS-TN-FINAMT BY 0.05
                                GIVING WS-TN-MAXAMT ROUNDED
                 IF WS-TN-POINTSFEES > WS-TN-MAXAMT
                    GO TO TN-POINTS-OUT-OF-RANGE-MSG.

           GO TO TN-MTG-VALIDATION-EXIT.

       TN-POINTS-OUT-OF-RANGE-MSG.
           MOVE "POINTS PLUS FEES EXCEEDS THE AMOUNT ALLOWED" TO MESS.
           PERFORM SEND-MESS.
           MOVE 9 TO WS-TN-ERRCD.

       TN-MTG-VALIDATION-EXIT.
           EXIT.

      ********************************************
       KY-ROAD-GARD-VALIDATION SECTION.
      ********************************************
           MOVE 0 TO ROAD-GARD-ERRCD.

           IF NOT (BR-FORCE-VALID-CITY-COUNTY = "Y" AND PD-ORGST = "KY")
              GO TO EXIT-KY-ROAD-GARD-VALIDATION.

           MOVE 0 TO ROAD-GARD ROAD-GARD-TAX.
           PERFORM VARYING ROAD-SUB FROM 1 BY 1 UNTIL ROAD-SUB > 10
               IF PD-FEECODE(ROAD-SUB) = "TM"
                  ADD PD-FEEAMT(ROAD-SUB) TO ROAD-GARD-TAX
               ELSE
               IF PD-FEECODE(ROAD-SUB) = BR-ROAD-G-SGL-FEECODE OR
                   PD-FEECODE(ROAD-SUB) = BR-ROAD-G-FAM-FEECODE
                  ADD PD-FEEAMT(ROAD-SUB) TO ROAD-GARD
               END-IF
           END-PERFORM.

      * VALIDATE THAT PREIUM EXIST IF THEY ENTERED TAX AMOUNT
           IF ROAD-GARD = 0
              IF ROAD-GARD-TAX NOT = 0
                 MOVE "MUST ENTER UMC PREMIUM FEECODE" TO MESS
                 PERFORM SEND-MESS
                 MOVE 9 TO ROAD-GARD-ERRCD
                 GO TO EXIT-KY-ROAD-GARD-VALIDATION.

      * VALIDATE THAT KY UNITED MOTOR CLUB HAS SALES TAX FEECODE ENTERED!
      * AND THAT IT IS 6% OF PREMIUM
           IF ROAD-GARD NOT = 0
              IF ROAD-GARD-TAX = 0
                 MOVE "MUST ENTER UMC SALES TAX 'TM' FEECODE" TO MESS
                 PERFORM SEND-MESS
                 MOVE 9 TO ROAD-GARD-ERRCD
              ELSE
                 IF (ROAD-GARD * .06) NOT = ROAD-GARD-TAX
                    MOVE "UMC TAX MUST BE 6%" TO MESS
                    PERFORM SEND-MESS
                    MOVE 9 TO ROAD-GARD-ERRCD.

       EXIT-KY-ROAD-GARD-VALIDATION.
           EXIT.


      *******************************************************************
      * TN MORTGAGE LOANS.   SUM AMOUNTS FOR FEES, 78, 79, 88
      *    THEY NEED TO BE INCLUDED IN CALCULATING THE TOTAL
      *    POINTS & FEES                                    PR#3043
      *******************************************************************
       TN-FIND-FEECODES SECTION.
      *******************************************************************
           MOVE 0 TO WS-TN-FEEWORKER.
           MOVE 1 TO WS-TN-LOOPCOUNT.
       TN-LOOP-NEXT.
           IF PD-FEECODE(WS-TN-LOOPCOUNT)  = '78' OR '79' OR '88'
              ADD PD-FEEAMT(WS-TN-LOOPCOUNT) TO WS-TN-FEEWORKER.
           ADD 1 TO WS-TN-LOOPCOUNT.
           IF WS-TN-LOOPCOUNT < 10
              GO TO TN-LOOP-NEXT.
       TN-FIND-FEECODES-EXIT.
           EXIT.

      ******************************************************************
      *
      *    C O P Y - L I B R A R Y - S E C T I O N S
      *
      ******************************************************************
       COPY "LIBGB/DATER.CPY".
       COPY "LIBLP/INSELIG.CPY".
       COPY "LIBLP/LPANTI.CPY".
       COPY "LIBGB/GPENV.CPY".
       COPY "LIBGB/HASH.CPY".
       COPY "LIBLP/LPDAMTS.CPY".
       COPY "LIBLP/LPSPEDP.CPY".
       COPY "LIBLP/LPBAGE.CPY".
       COPY "LIBLP/LPAPRZ.CPY".
       COPY "LIBLP/LPUPER.CPY".
       COPY "LIBLP/LPPDCL.CPY".
       COPY "LIBWI/PFSWINDOWS.CPY".
       COPY "LIBGB/SCREEN.CPY".
       COPY "LIBLP/LPZLCL.CPY".
       COPY "LIBLP/RESCIND.CPY".
       COPY "LIBWI/W12EQ2PMT.CPY".

      *********************************************
       FORM-RESET SECTION.
      *********************************************
           MOVE EXT-CONAME-SYSDATE TO LNQUOT-SYSDATE.
           DISPLAY SPACES UPON LNQUOT-WINDOW-HANDLE
                          LINE 1 COL 1 ERASE SCREEN.
           DISPLAY LNQUOT-SCREEN UPON LNQUOT-WINDOW-HANDLE.
           MOVE LNQUOT-FORM-FIELDS TO WR-BUF.
           MOVE LNQUOT-FORM-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.

           IF LNQUOT-MAINT-FG = "R"
              MOVE "S  A210TITLE:FR." TO VDU
              MOVE " RENEWAL NET BALANCE " TO VDUBUF
           ELSE
           IF LNQUOT-MAINT-FG = "P"
              MOVE "S  A210TITLE:FR." TO VDU
              MOVE "  RENEWAL FOR CASH   " TO VDUBUF
           ELSE
              MOVE "S  A210TITLE:FR." TO VDU
              MOVE "     LOAN QUOTER     " TO VDUBUF.
           PERFORM SCREENIO.
       FORM-RESET-EXIT.
           EXIT.

      *********************************************
       SETUP-LINK-INFO SECTION.
      *********************************************
           MOVE LNQUOT-HELP--FILE TO HELP-LINK-FILE.
           MOVE LNQUOT-HELP--DIR TO HELP-LINK-DIR.

      *********************************************
       VDU-CONVERT-FIELD SECTION.
      *********************************************
           MOVE "00" TO STAT.
           MOVE VDU-FIELD-TO-CONVERT TO VDU-ALP-FIELD.
           EVALUATE TRUE
              COPY "LIBWI/LNQUOT_EVA.CPY".
              COPY "LIBWI/ADDINS_EVA.CPY".
              WHEN OTHER       MOVE   "2A" TO STAT
           END-EVALUATE.

      *********************************
       MISC-PARAGRAPHS SECTION.
      *********************************
       COPY "LIBGB/SYSTEM.CPY".
       COPY "LIBGB/ACCESS.CPY".
       COPY "LIBGB/GETENV.CPY".
      *----------------------------------------------------
       SET-CLFILE-INDEX-BY.
           MOVE BR-CAN-GROUP-ID TO CL-GROUP-ID  CLSCAN-GROUP-ID.
      *----------------------------------------------------------------
      *    IF MAKING CHANGES, CALCULATE PROCEEDS AND NOT PYAMT
      * REV:
      *  JTG 022797 SKIPPED THIS WHEN STATE IS 'NM', SINCE CAN LOANS
      *             FOR THIS STATE, WHEN RECALCULATED CAUSE ROUNDING
      *             ON THE PROCEEDS & PAYMENT
      *  JTG 031297 SKIPPED THIS WHEN STATE IS 'TX'
      *-----------------------------------------------------------------
       FORCE-CAN-LOAN-NUMBERS.
           IF NOT (SP-ORGST = "NM" OR "TX")
              MOVE "S  A010121." TO VDU
              MOVE "C" TO VDUBUF PD-PROCEEDS-FG
                          CIP-PROCEEDS-SW
              PERFORM SCREENIO
              MOVE "S  A010381." TO VDU
              MOVE "I" TO VDUBUF PD-REGPYAMT-FG
                          CIP-REG-PAYMENT-SW
              PERFORM SCREENIO.

       DISPLAY-PROMPTS.
           IF PROMPT-FG = " "
              MOVE "Y" TO PROMPT-FG
              MOVE PROMPT-BUF TO WR-BUF
              MOVE PROMPT-LIST TO WR-LIST
              PERFORM CALL-WRFORM.

       SEND-BW-MAKERCD.
           MOVE "S  A010  2." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-MAKERCD(ELE) TO VDUBUF.
           PERFORM SCREENIO.
       GET-CODE.
           MOVE "GC"     TO CDB-TYPE.
           MOVE PD-OWNBR TO CDB-BRANCH.
      *--> SET BEFORE       CDB-GC-FEECODE.
           PERFORM OPEN-CDB1-FILE.
           PERFORM READ-CDB1-FILE.
           PERFORM CLOSE-CDB1-FILE.
           IF IO-FG = 9
              MOVE " * NOT ON FILE * " TO CDB-DESC.
           IF PD-GIFTNET = "Y"
              IF CDB-GC-FEE-GIFTNET = "Y"
                 NEXT SENTENCE
              ELSE
                 MOVE 9 TO IO-FG
           ELSE
              IF CDB-GC-FEE-GIFTNET = "Y"
                 MOVE 9 TO IO-FG.
       GET-LC.
           PERFORM OPEN-LC1-FILE.
           PERFORM READ-LC1-FILE.
           PERFORM CLOSE-LC1-FILE.
           IF IO-FG = 9
              MOVE "INVALID" TO LC-DESC.
       GET-CD.
           PERFORM OPEN-CD1-FILE.
           PERFORM READ-CD1-FILE.
           PERFORM CLOSE-CD1-FILE.
           IF IO-FG = 9
              MOVE " INVALID CODE" TO CD-DESC.
       GET-DL1.
           PERFORM OPEN-DL1-FILE.
           PERFORM READ-DL1-FILE.
           PERFORM CLOSE-DL1-FILE.
           IF IO-FG = 9
              MOVE " INVALID DEALER" TO DL-SHORT.
       GET-BW1.
           PERFORM READ-BW1-FILE.
           IF IO-FG = 9
              MOVE " " TO BW-FNAME
              MOVE "NOT FOUND" TO BW-LNAME.
           PERFORM APPEND-BW-NAMES.
       GET-PD1.
           PERFORM OPEN-PD1-FILE.
           PERFORM READ-PD1-FILE.
           PERFORM CLOSE-PD1-FILE.
       GET-SP.
           MOVE PD-ORGST TO SP-ORGST.
           MOVE PD-SPRCLASS TO SP-SPRCLASS.
           MOVE PD-SUBCLASS TO SP-SUBCLASS.
           MOVE PD-LAWCODE TO SP-LAWCODE.
           PERFORM OPEN-SP1-FILE.
           PERFORM READ-SP1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           PERFORM CLOSE-SP1-FILE.

       MATURITY-DATE-CALCULATION.
           MOVE PD-1STPYDATE TO NDTE-DATE.
           COMPUTE NDTE-HOLD = PD-ORGTERM - 1.
           PERFORM INCREMENT-MONTHS.
       UPDATE-OVR-RATE.
           IF PD-LOANTYPE = "P"
                    OR COP-OVR-RATE-SW = "C"
              MOVE 999.999 TO PD-OVRDRATE
           ELSE
              IF COP-OVR-RATE-SW = "E"
                 MOVE COP-OVR-RATE TO PD-OVRDRATE
              ELSE
                 MOVE COP-EFF-RATE TO PD-OVRDRATE.

       MOVE-MSG.
           MOVE PD-MSG1 TO MSG-LINE1.
           MOVE PD-MSG2 TO MSG-LINE2.
           MOVE SCREEN-LINE1 TO D-201.
           MOVE SCREEN-LINE2 TO D-202.

       VALIDATE-FIELDS-AGAINST-MAX.
           IF NEW-FLAG NOT = 1
              PERFORM VALIDATION.

       VERIFY-REQD-FLDS.
           IF ACTION = "     U"
              IF PD-LOANDATE NOT = TRANS-DATE-YYYYMMDD
                 MOVE 9 TO IO-FG
                 MOVE "LOAN DATE MUST EQUAL TRANSACTION DATE" TO MESS
                 PERFORM SEND-MESS.
           IF PD-PURCD = " "
              MOVE 9 TO IO-FG
              MOVE "PURPOSE CODE REQUIRED BEFORE SAVE/UPDATE" TO MESS
              PERFORM SEND-MESS.
           IF PD-COLLCD = " "
              MOVE 9 TO IO-FG
            MOVE "COLLATERAL CODE REQUIRED BEFORE SAVE/UPDATE" TO MESS
              PERFORM SEND-MESS.

           PERFORM VERIFY-PROCEEDS.

       VERIFY-PROCEEDS.
           IF PD-SRCD = "RN"
              IF PD-PROCEEDS NOT = 0
                 MOVE "PROCEEDS MUST BE ZERO FOR RENEWALS" TO MESS
                 PERFORM SEND-MESS
                 MOVE 9 TO IO-FG.
           IF PD-SRCD = "PB" OR "SC"
              IF PD-PROCEEDS < 0
                 MOVE "PROCEEDS < ZERO - INVALID" TO MESS
                 PERFORM SEND-MESS
                 MOVE 9 TO IO-FG.
      * REGMGM 4885
      * "D" PROCEEDS OF NEW LOAN HAS TO BE AT LEAST X% OF THE PAYOFF AMT
      *     PROCEEDS OF NEW LOAN HAVE TO BE > THAN SP-AMT-PROCEEDS-REQ
           IF (PD-SRCD = "PB" OR "SC") AND (SP-RENEWAL-EDIT = "D")
              IF PD-PROCEEDS < (PRIOR-LNAMT * (SP-NET-BAL-REQ/100))
                 MOVE "PROCEEDS NOT > THAN PERCENT REQUIRED" TO MESS
                 PERFORM SEND-MESS
                 MOVE 9 TO IO-FG
              ELSE
                 IF PD-PROCEEDS < SP-AMT-PROCEEDS-REQ
                    MOVE "PROCEEDS NOT > THAN MINIMUM" TO MESS
                    PERFORM SEND-MESS
                    MOVE 9 TO IO-FG.

      * REGMGM 4885
      * "E" PROCEEDS OF NEW LOAN HAS TO BE AT LEAST X% OF THE PAYOFF AMT
      *     PROCEEDS OF NEW LOAN HAVE TO BE < THAN SP-AMT-PROCEEDS-REQ
           IF (PD-SRCD = "PB" OR "SC") AND (SP-RENEWAL-EDIT = "E")
              IF PD-PROCEEDS > (PRIOR-LNAMT * (SP-NET-BAL-REQ/100))
                 MOVE "PROCEEDS ARE NOT < THAN PERCENT REQUIRED" TO MESS
                 PERFORM SEND-MESS
                 MOVE 9 TO IO-FG
              ELSE
                 IF PD-PROCEEDS > SP-AMT-PROCEEDS-REQ
                    MOVE "PROCEEDS ARE > THAN MAXIMUM" TO MESS
                    PERFORM SEND-MESS
                    MOVE 9 TO IO-FG.


       COMPUTE-GL-FEEAMT.
           ADD 1 TO COUNTER.
           IF COUNTER NOT > 10
              ADD PD-FEEAMT(COUNTER) TO TOTAL-GL-HLDR
              IF PD-FEEFINCHG(COUNTER) = "Y"
                 ADD PD-FEEAMT(COUNTER) TO TOTAL-GL-FINCHG-HLDR
              END-IF
              GO TO COMPUTE-GL-FEEAMT.
           MOVE 0 TO COUNTER.


       BLANK-PRIOR-LOAN.
           MOVE 0 TO CIP-PRIOR-LOAN-CLASS CIP-PRBAL CIP-PRINTDUE
                     CIP-PRFINCHGRB CIP-PRINSRB CIP-PRPAID-AHEAD
                     CIP-PRIOR-LOAN-DATE PRIOR-LNAMT CIP-PRIOR-SUB-CLASS.
           MOVE 0 TO PD-PRLNNO PD-PRBAL PD-PRINTDUE PD-PRFINCHGRB
                     PD-PRINSRB PD-PRPAID-AHEAD.
           MOVE " " TO CIP-PRIOR-LOAN-STATE.
           MOVE PD-SRCD TO CIP-SOURCE-CD.

           MOVE "SNNN060110." TO VDU.
           MOVE PD-PRLNNO TO VDUNUM0.
           PERFORM SCREENIO.

           MOVE "SNNN062111." TO VDU.
           MOVE PRIOR-LNAMT TO VDUNUM2.
           PERFORM SCREENIO.

           IF NEW-FLAG NOT = 1
      * CITIZENS TEST
              MOVE 800 TO CIP-NO-OF-TIMES-CALLED
      * A90   MOVE 0 TO CIP-NO-OF-TIMES-CALLED
              PERFORM CALL-LOAN-CALCULATIONS.

       SETUP-CALC-AREA.
           MOVE "C" TO CIP-OVR-RATE-SW
                       CIP-INS-SW(1) CIP-INS-SW(2)
                       CIP-INS-SW(3) CIP-INS-SW(4)
                       CIP-SERVICE-CHG-SW CIP-MAINT-FEES-SW
                       CIP-1ST-PY-EXT-SW CIP-REG-PAYMENT-SW.
           MOVE "I" TO CIP-INS-SW(5) CIP-INS-SW(6).

           MOVE PD-LOANTYPE TO CIP-LOANTYPE.
           MOVE PD-SMALLOAN TO CIP-SMALLOAN.
           MOVE PD-SALEFIN TO CIP-SALEFIN.
           MOVE PD-SERVACCT TO CIP-SERVACCT.

           MOVE PD-LOANDATE  TO CIP-LN-DT.
           MOVE PD-INTDATE   TO CIP-IN-DT.
           MOVE PD-FILEDATE  TO CIP-FL-DT.
           MOVE PD-1STPYDATE TO CIP-PMT-DT.
           MOVE PD-ORGTERM   TO CIP-TERM.

           MOVE PD-PURCD TO CIP-PURPOSE-CD.
           MOVE PD-COLLCD TO CIP-COLLTRL-CD.
           MOVE PD-SRCD TO CIP-SOURCE-CD.
           MOVE PD-PROCEEDS TO CIP-PROCEEDS.
           MOVE PD-PROCEEDS-FG TO CIP-PROCEEDS-SW.

           MOVE PD-INSURED TO CIP-INS-WHO.
           MOVE PD-INSTYPES TO CIP-INS-TYPE.
           MOVE PD-INSELIGIBLE TO CIP-INS-ELIG.
           MOVE PD-POINTS TO CIP-POINTS.
           MOVE PD-POINTS-FG TO CIP-POINTS-SW.
           MOVE TOTAL-GL-HLDR TO CIP-GL-AMOUNT-TOTAL.
           MOVE TOTAL-GL-FINCHG-HLDR TO CIP-GL-AMOUNT-TOTAL-FINCHG.

       MOVE-INSURANCE-TO-PDREC.
           MOVE COP-INS-CO(COUNTER)       TO PD-INSCOMP(COUNTER)
                                             DF2-INSCOMP(COUNTER).
           MOVE COP-INS-USE-SW(COUNTER)   TO PD-INSOURS(COUNTER)
                                             DF2-INSOURS(COUNTER).
           MOVE COP-INS-TERM(COUNTER)     TO PD-INSTRM(COUNTER)
                                             DF2-INSTERM(COUNTER).
           MOVE COP-INS-COVERAGE(COUNTER) TO PD-INSCOVR(COUNTER)
                                             DF2-INSCOVR(COUNTER).
           MOVE COP-INS-PREMIUM(COUNTER)  TO PD-INSPREM(COUNTER)
                                             DF2-INSPREM(COUNTER).
           MOVE COP-INS-SW(COUNTER)       TO PD-INS-FG(COUNTER)
                                             DF2-INS-FG(COUNTER).
           MOVE COP-INSFINCHG-SW(COUNTER) TO PD-INSFINCHG(COUNTER).
           MOVE COP-INS-TERM-SW(COUNTER) TO PD-INS-TERM-SW(COUNTER).
           MOVE COP-COVERAGE-SW(COUNTER) TO PD-COVERAGE-SW(COUNTER).
           MOVE COP-PREMIUM-SW(COUNTER) TO PD-PREMIUM-SW(COUNTER).

       ICE-OR-A-MSG.
           IF ELE = 21
      *<1225J>
              IF SP-CAL-FLAT-MONTHLY(1)
                 MOVE "MUST BE 'C' OR 'A'" TO MESS
              ELSE
                 MOVE "MUST BE 'C', 'E', OR 'A'" TO MESS
              END-IF
      *<1225J>
           ELSE
              MOVE "MUST BE 'I' OR 'C'" TO MESS.
           PERFORM SEND-MESS.

       CALC-NO-OF-PAYMENTS.
           IF PD-1STPYAMT = 0
              MOVE 0 TO PD-NOODDPY
              MOVE PD-ORGTERM TO PD-NOREGPY
           ELSE
              MOVE 1 TO PD-NOODDPY
              SUBTRACT 1 FROM PD-ORGTERM GIVING PD-NOREGPY.

       ERROR-IN-CALCULATIONS-MSG.
           IF COP-RETURN-CODE = "V"
              MOVE "ERROR IN CALCULATIONS - AMOUNT EXCEEDS MAX"
                                                        TO MESS
           ELSE
              MOVE "ERROR IN CALCULATIONS - INACCURATE RESULTS"
                                                        TO MESS.
           PERFORM SEND-MESS.

       SEND-CD-DESC.
           PERFORM GET-CD.
           MOVE "S  A000  1." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE CD-DESC TO VDUBUF.
           PERFORM SCREENIO.
       APPEND-BW-NAMES.
           MOVE BW-LNAME TO INSPECT-W.
           MOVE BW-FNAME TO ADD-ON.
           INSPECT INSPECT-W REPLACING FIRST "   " BY ", +".
           INSPECT INSPECT-W REPLACING FIRST
              "+                        " BY ADD-ON.
       ADD-IT.
           INSPECT INSPECT-W REPLACING FIRST "  " BY " +".
           INSPECT INSPECT-W REPLACING FIRST
              "+                        " BY ADD-ON.
       ADD-IT2.
           PERFORM ADD-IT.
           MOVE "/" TO ADD-ON.
           PERFORM ADD-IT.

       NUMBW-TO-ALPBW.
           MOVE " " TO ALP-BW.
           IF BW-SSNO NOT = 0
              MOVE BW-SSNO TO NUM-BW
              MOVE NUM-BW123 TO ALP-BW123
              MOVE NUM-BW45 TO ALP-BW45
              MOVE NUM-BW6789 TO ALP-BW6789
              MOVE "-" TO ALP-HYPHEN1 ALP-HYPHEN2.

       SEND-BW-NO-NAME.
           PERFORM NUMBW-TO-ALPBW.
           MOVE "S  A110  0." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE ALP-BW TO VDUBUF.
           PERFORM SCREENIO.
           PERFORM SEND-BW-NAME.

       SEND-BW-NAME.
           MOVE "S  A330  1." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE INSPECT-W TO VDUBUF.
           PERFORM SCREENIO.
           IF ELE = 1
              MOVE INSPECT-W TO PD2-BWNAME SAVE-BW-NAME.
       SEND-MEMO.
           MOVE "S  A060M1." TO VDU.
           MOVE "MEMO: " TO VDUBUF.
           PERFORM SCREENIO.
           MOVE "S  A300M2." TO VDU.
           MOVE PD-MESSAGE TO VDUBUF.
           PERFORM SCREENIO.
       NOT-FOUND.
           MOVE "RECORD NOT FOUND" TO MESS.
           PERFORM SEND-MESS.
       MISSING-FEECODE.
           STRING "YOUR BRANCH IS MISSING A FEE "
                  "CODES NEEDED FOR THIS CAN LOAN!      "
                  DELIMITED BY SIZE INTO MESS.
           PERFORM SEND-MESS.
           MOVE " PLEASE INFORM HOME OFFICE!!" TO MESS
           PERFORM SEND-MESS.
       SP-INVALID.
           MOVE "ENTRY INCONSISTENT WITH STATE PARAMETERS" TO MESS.
           PERFORM SEND-MESS.
       NOT-DIRECT.
           MOVE "INVALID FOR DIRECT LOAN ENTRY" TO MESS.
           PERFORM SEND-MESS.
       SEND-LEGEND.
           MOVE LEGEND TO WR-BUF.
           MOVE MSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       SEND-WSEL-LEGEND.
           MOVE MESS      TO WR-BUF.
           MOVE WSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       RESET-LEGEND.
           MOVE " " TO LEGEND.
           PERFORM SEND-LEGEND.
       LOAN-CLASS-PROMPT.
           MOVE "S  A110KEYTYPE:S." TO VDU.
           MOVE "LOAN CLASS:" TO VDUBUF.
           PERFORM SCREENIO.
       SET-SCRATCH-KEY.
           MOVE SAVE-SSNO TO PD-SOC-SEC.
           MOVE EXT-CONAME-USER-LOC TO PD-BRANCH PD2-BRANCH.
           MOVE "L" TO PD-ID.
      *-----------------------------------------------------------------
       VERIFY-AGAINST-SPEDT.
           MOVE PD-EFFRATE TO VERIFY-TERMCEIL-EFF.
           MOVE PD-APRATE TO VERIFY-TERMCEIL-APR.
           MOVE "Y" TO VERIFY-TERMCEIL-EFF-FG.
           MOVE TRANS-DATE-YYYYMMDD TO VERIFY-TODAY-DATE.

           PERFORM SET-BW1-FOR-SPEDT.

           MOVE BW-BDATE   TO VERIFY-AGE.
           MOVE BW-REFDATE TO VERIFY-REFDATE.
           MOVE " "        TO VERIFY-REJECT-TERM-FG.
           PERFORM VERIFY-TERMCEIL.

           IF COP-OTINS-COV-ERR
              MOVE "INSURANCE COVERAGE ERROR" TO MESS
              PERFORM SEND-MESS
              MOVE "N" TO VALID-LOAN.

      *-----------------------------------------------------------------
       SET-BW1-FOR-SPEDT.
           IF PD-SSNO(1) = 0
              MOVE 0 TO BW-BDATE
                        BW-REFDATE
                        BW-CREDIT-SCORE
           ELSE
      * IF SECONDARY (SPOUSE) INSURANCE, TEST SECOND MAKER'S AGE EDITS...
              IF PD-INSURED = "S"
                 IF PD-SSNO(2) NOT = BW-SSNO
                    MOVE PD-SSNO(2) TO BW-SSNO
                    PERFORM OPEN-BW1-FILE
                    PERFORM READ-BW1-FILE
                    PERFORM CLOSE-BW1-FILE
                    IF IO-FG = 9
                       MOVE 0 TO BW-BDATE BW-REFDATE
                    END-IF
                 END-IF
              ELSE
                 IF PD-SSNO(1) NOT = BW-SSNO
                    MOVE PD-SSNO(1) TO BW-SSNO
                    PERFORM OPEN-BW1-FILE
                    PERFORM READ-BW1-FILE
                    PERFORM CLOSE-BW1-FILE
                    IF IO-FG = 9
                       MOVE 0 TO BW-BDATE BW-REFDATE.
      *-----------------------------------------------------------------
       ESTABLISH-REJECT-TERMS.
           MOVE "Y"        TO VERIFY-TERMCEIL-EFF-FG.
           PERFORM MATURITY-DATE-CALCULATION.
           MOVE NDTE-DATE  TO VERIFY-TODAY-DATE.
           PERFORM SET-BW1-FOR-SPEDT.

           MOVE BW-BDATE   TO VERIFY-AGE.
           MOVE BW-REFDATE TO VERIFY-REFDATE.
           MOVE "Y"        TO VERIFY-REJECT-TERM-FG.

           PERFORM VERIFY-TERMCEIL.

           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 4
              MOVE VERIFY-REJECT-TERM(SUB) TO CIP-INS-REJECT-TERM(SUB)
           END-PERFORM.

      *-----------------------------------------------------------------
       PROTECT-FIELDS.
           MOVE STAT TO CHFG(5) CHFG(19) CHFG(20) CHFG(21) CHFG(22)
              CHFG(23) CHFG(24) CHFG(31) CHFG(32) CHFG(33) CHFG(34)
              CHFG(35) CHFG(36) CHFG(37) CHFG(38).
           MOVE STAT TO DATE-STAT.

       UNPROTECT-FIELDS.
           MOVE STAT TO CHFG(11) CHFG(14) CHFG(15) CHFG(16) CHFG(17)
                        CHFG(18) CHFG(19) CHFG(20) CHFG(21) CHFG(24)
                        CHFG(31) CHFG(32) CHFG(33) CHFG(38).
           IF CAN-LOAN-NO NOT = " "
              MOVE "N" TO CHFG(38).
           MOVE STAT TO DATE-STAT.

       SEND-PRIOR-MESS.
           IF PASS-STAT-FG = "Z"
              MOVE "PRIOR LOAN PAID OFF OR BALANCE EXPENSED" TO MESS
           ELSE
           IF PASS-STAT-FG = "S"
              MOVE "PRIOR LOAN NOT SALES FINANCE" TO MESS
           ELSE
           IF PASS-STAT-FG = "J"
              STRING "PRIOR LOAN PAID OFF USING TRANSACTION CODE '"
                     HOLD-PRIOR-PO-TRCD
                     "' - NOT ALLOWED"
                 DELIMITED BY SIZE INTO MESS
           ELSE
              MOVE "PRIOR LOAN IS SALES FINANCE - NOT ALLOWED" TO MESS.
           PERFORM SEND-MESS.

      *---------------------------------------------------{ RESCISSION }
       SEND-RESCISSION.

           IF ( RESCISSION-BUF = SPACES )
              MOVE "R1.  " TO RESCISSION-LIST
           ELSE
              MOVE "R1:R." TO RESCISSION-LIST.

           MOVE RESCISSION-BUF TO WR-BUF.
           MOVE RESCISSION-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.

      *-----------------------------------------------------------------
      * SET ADV-TO-1ST-NO-CORR. IF THE SP FLAG IS SET, ALLOW IT TO
      * OVERRIDE THE GP FOR SPECIFIC CLASSES.
      *-----------------------------------------------------------------
       SET-ADV-TO-1ST-NO-CORR.
           IF NOT (SP-ADV-TO-1ST-NO-CORR = "N" OR " ")
              MOVE SP-ADV-TO-1ST-NO-CORR TO ADV-TO-1ST-NO-CORR
           ELSE
              MOVE GP-ADV-TO-1ST-NO-CORR TO ADV-TO-1ST-NO-CORR.

      *********************************
       IO-ROUTINE SECTION.
      *********************************
       COPY "LIBGB/CONNECT_SQL.CPY".
       COPY "LIBLP/LPSPGS_SQL.CPY".
       COPY "LIBLP/LPPDGS_SQL.CPY".
       COPY "LIBLP/LPLCGS_SQL.CPY".
       COPY "LIBLP/LPICGS_SQL.CPY".
       COPY "LIBLP/LPDLGS_SQL.CPY".
       COPY "LIBLP/LPCLGS_SQL.CPY".
       COPY "LIBLP/LPCDBGS_SQL.CPY".
       COPY "LIBLP/LPCDGS_SQL.CPY".
       COPY "LIBLP/LPBWGS_SQL.CPY".
       COPY "LIBGL/GLGIGS_SQL.CPY".
       COPY "LIBGB/GBGBGS_SQL.CPY".
       COPY "LIBGB/GBBRGS_SQL.CPY".
       COPY "LIBGB/GBBRRN.CPY".
       COPY "LIBGB/GBGBIN.CPY".
       COPY "LIBLP/LPDL1RN.CPY".
       COPY "LIBLP/LPCL1RN.CPY".
       COPY "LIBLP/LPLC1RN.CPY".
       COPY "LIBLP/LPPD1IN.CPY".
       COPY "LIBLP/LPPD2IN.CPY".
       COPY "LIBLP/LPSP1RN.CPY".
       COPY "LIBLP/LPBW1RN.CPY".
       COPY "LIBLP/LPCD1RN.CPY".
       COPY "LIBLP/LPCDB1RN.CPY".
       COPY "LIBLP/LPIC1RN.CPY".
       COPY "LIBGL/GLGI1RN.CPY".

       COPY "LIBGB/FERRORS.CPY".
           MOVE "E" TO ERRCD.

      *********************************
       END-ROUTINE SECTION.
      *********************************
           PERFORM CLOSE-FILES.
       EXIT-PROG.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY LNQUOT-SCREEN.
           DESTROY LNQUOT-WINDOW-HANDLE.
       STOP-RUN.
           EXIT PROGRAM.
