       IDENTIFICATION DIVISION.
       PROGRAM-ID.      LONPB0.
       DATE-WRITTEN.    012484.
      ******************************************************************
      *                 (LP)
      *  DESCRIPTION:   SALES FINANCE LOAN
      *                 NEW LOAN ENTRY
      * REV:
      *  051295 SLC ADDED INSURANCE CHECK. MUST HAVE A&H AND LIFE IF
      *             BRANCH OPTION IS ON.
      *  060195 BAH CHANGED LT-COLL-AMT1 TO LT-MILEAGE
      *                     LT-COLL-AMT2 TO LT-VALUE
      *                     LT-COLL-AMT3 TO LT-SELLPR
      *                     LT-COLL-AMT4 TO LT-MISC-AMT
      *  061995 JTG ADDED OPTION FOR BR-SFDLO3-WINDOW-FG, MERCURY
      *  070595 JTG ADDED LOGIC FOR BR-CALC-INS-ADJ, MERCURY
      *  081095 MJD ADDED LOGIC FOR GP-THE-ONLY-SF-SRCD
      *  081495 BAH ADDED TEST ON GP-ALLOW-BATCH-CHECKS
      *             FOR DEALER CHECKS
      *  082295 JTG ADDED ABILITY TO WRITE AH ONLY, EVEN IF BR-AH-AND-CL
      *             IS SET TO 'Y', IF AH INS IS NOT OURS
      *  082395 JTG TRUNCATED APR-APR TO 2 DECIMALS ROUNDED, TO MATCH
      *             SFQUOT.C CALCULATION
      *  092995 JTG CORRECT BUG RE: PD-O3INS-DLPROC.
      *             WHEN WINDOW ENTERED TO INPUT WARRENTY AND
      *             PD-O3INS-DLPROC WAS ENTERED AND THEN CANCELLED
      *             RE: INPUT OF ZERO INS. COMPANY (PD-O3INS-DLPROC WAS
      *                 NOT GETTING CLEARED
      *  092995 JTG ADDED LOGIC FOR GP-DEFAULT-O3-INS-COMPANY
      *  101295 JTG SUPRESSED DELETE OPTION FOR QUOTES
      *  010996 MJD ADDED LOGIC TO PREVENT ENTRY OF "MN_" INS CODE.
      *  011696 JTG CHANGED COPY 'INSTST' TO 'INSELIG' + SET OF
      *             INSELIG-DISPLAY-FG
      *  011796 BLL CHECK IF AMT FINANCED > GI APPROVAL LIMIT - IF SO,
      *             CAN'T UPDATE, GIVE MSG TO SAVE LN & GET APPROVAL
      *  012596 BAH DONT ALLOW ANY PARTICIPATION ON "IB" LOANS !!
      *             (RSVENT) #E094
      *  012596 BAH DONT ALLOW A FIRST PAY DATE < 30 DAYS FROM
      *             LOANDATE #E097
      *  021996 MJD ADDED LOGIC TO OPEN INSURANCE WINDOW IF
      *             BR-SFDLO3-WINDOW-FG IS A "B". (OPEN WINDOW IF
      *             INSURANCE IS OURS OR NOT.)  RE. RELIANCE.
      *  MJD 022996 ADDED TEST OF BA FILES. IF APPLICATION EXISTS
      *             THEN AUTOMATICALLY BRING UP BORROWER WINDOW.
      *             IF COLLATERAL EXISTS THEN BRING UP COLLATERAL
      *             WINDOW.
      *  KEC 031296 ADDED LOAN APPROVAL WINDOW.
      *  JTG 032296 ADDED 'IF' TO STOP LOANS WITH ZERO FINANCE CHARGES,
      *             ODD FIRST OR LAST PAYMENTS AND DISCLOSURE FORMULA 'B'
      *             FROM RETURNING 000.0XX APRS
      *  MJD 032896 ADDED NEW WORKER FOR PURFLDPD: LIBLP/PURFLDW. ALL PD
      *             FIELDS THAT ARE CHANGED WITHIN COMPUTE-PURCHASE-FIELDS.
      *  JTG 032896 ADDED SET OF PURFLD (-FG) FIELDS
      *  MJD 040896 ADDED LC-AFP-CLASS AND DL-AFP-DEALER.
      *  MJD 041996 ADDED GP-DLR-DISP-TYPE.
      *  BLL 050396 FIX APPROVAL LIMIT WINDOW TO ROUND UP TO NEXT DOLLAR
      *  JTG 050896 ADDED LOGIC FOR "LR" LOAN RE-SCHEDULE TRANSACTION
      *  JTG 050996 STOPPED ENTRY OF FIELD 39 WHEN NEW-FLAG = 1 AND
      *             RESERVE WINDOW WAS ENTERED AT FIELD 38
      *  JTG 061896 ADDED MA-RECORD LOGIC TO CHECK FOR LOAN APPLICATION
      *  JTG 062896 WHEN MA-REC EXISTS, FORCED DEALER NO EQUAL
      *  MJD 071996 ADDED LOGIC TO PRINT LN-1STPYDATE AS MM/DDWYY
      *             FOR WEEKLY UNIT PERIODS.
      *  JTG 082196 INSURE DEALER PROCEEDS WILL NOT GO NEGATIVE AFTER
      *             CALCULATION OF DEALER INSURANCE ADJUSTMENTS
      *  JTG 082896 REVISED TO ALLOW RETURN BACK TO SELECT PAY CODE,
      *             FROM CHECK FREE TYPING WINDOW
      *  KEC 012397 REVISED ACCESSING MA-FILE: NEW FORMAT FOR MA-FILE.
      *  KEC 021897 REVISED ACCESSING BA-FILE: NEW FORMAT FOR BA-FILE.
      *  BLV 022597 CHECK IF BW-CREDIT-SCORE < SP-MIN-CREDIT-SCORE; IF
      *             SO, CAN'T UPDATE, GIVE MSG TO SAVE LN & GET APPROVAL
      *  BLV 030697 ADD ALTERNATE APPROVAL WINDOW FOR CREDIT SCORE; PUT
      *             APPROVAL STUFF IN COPY MEMBERS: LNAPPROVALW, LNAPPROVAL
      *  BAH 031197 ADDED LOGIC FOR DL-RECOURSE-FRMLA = 'A', FAIRCO
      *  BLV 032097 MOVE BW-CRSCORE TO PD-CRSCORE SO IT WILL UPDATE TO
      *             LN-CRSCORE; ONLY ASK FOR PASSWORD ONCE IN APPROVAL WINDOW
      *  KEC 040897 REVISED TO PROPERLY ACCESS NEW APPLICATION MODULE.
      *  BLV 041097 ADD APPROVAL PASSWD SEQ 2 FOR SECRETARYS WITH GROUP
      *             LOGINS; AUTHORIZED TO RUN REPORTS BUT NOT APPROVE LOANS
      *  JTG 042497 CHANGED TO DISPLAY UNIT PERIOD INFO IN ALL CASES
      *             EX. PD-INTDATE CHANGE, PD-1STPYDATE CHANGE,
      *                 PD-ORGTERM CHANGE, PD-UNITPER-CD CHANGE
      *  MJD 060397 ADDED SCSCAN-TRANS-DATE.
      *  JTG 062097 CHANGED TO NOT RESET INS. INFO ON QUOT OR LOAN RECALL
      *  JTG 062797 CHANGED TO RECOMPUTE PURCHASE FIELDS WHEN DEALER NO. CHANGES
      *  JTG 070197 CHANGED LOAN & QUOTE RECALL TO INCLUDE SERVICE ACCOUNTS
      *  BLV 072497 DON'T ALLOW PRINCIPAL 1 IF GP-DLRVPRIN-1-FG NOT "Y"
      *  JTG 073197 ADDED LOGIC FOR TOTAL-FEEFINCHG AND TOTAL-INSFINCHG
      *  JTG 080197 STOPPED INSURANCE ADJUSTMENTS ON SERVICE ACCOUNTS
      *  JTG 081497 ADDED SET OF LN-GIFTNET WORLD A90
      *  JTG 082097 ADDED 'LIBLP/LPZ3CL' FOR 'LIBLP/LPDLADJ'
      *  KEC 090397 ***CONVERSION-A90-TO-A10***
      *                ADDED SP-DUAL-IN-BRANCH AND SP-DUAL-IN-STATE
      *                ALONG WITH ADDITIONAL ROUTINES IN ORDER TO USE
      *                THE NEW FIELDS.
      *  JTG 090497 CHANGED COPY 'LIBWI/FEEET1W' TO 'LIBWI/FEEENTW'
      *                          'LIBWI/FEEENT1' TO 'LIBWI/FEEENT'
      *                          'LIBWI/FEEENTPD1' TO 'LIBWI/FEEENTPD'
      *  GLF 090897 REPLACED 'IO' ON GP-FILE WITH GET 'GPENV'
      *   CS 031198 ADDED TEST OF LC-APP-REQ-FOR-LOAN, MERCURY DID NOT WANT
      *             TO ENTER APPS FOR ALL CLASSES
      *  KEC 031298 PREVENTED USE OF 'F5-CREATE BORROWER' ON ELE = 1
      *              WITH A LOAN APPLICATION.
      *  KEC 031698 REVISED THE LOAN APPROVAL CHECKS/WINDOW SO TO
      *              INCORPORATE 'GR-LN-APPROVAL-LIMIT'.
      *  BAH 040698 GP-DEFAULT-O3-INS-COMPANY 0 WAS NOT ALLOWING ANY INS CO.
      *  BAH 040798 ADDED SP-INS-ADJ-PRIN-3PMTS FOR 'NC' FROM A48
      *   CS 041798 UPDATE THE PD RECORD WITH BW-ORIGIN
      *   CS 042898 ADDED "RB" AND "RO" RENEWAL CODES NOT VALID IN SF/INPUT
      *  BLV 061098 FIXED MOVE OF BW-CRSCORE BECAUSE IT WAS PICKING UP
      *             CO-MAKER'S CREDIT SCORE IN PD & LNFILE
      *  BAH 063098 ADDED APR-SEQ 3 TO PASSWORD APR OVERRIDE, MERCURY #194
      *  KEC 072198 IN 'DISPLAY-FIELDS' MOVED THE STATMENT
      *              'PERFORM SET-APP-STATUS-FLAG.' BEFORE THE STATEMENT
      *              'IF QUOTE-ID-FG = "Q"' INSTEAD OF AFTER.  THIS
      *              WAS A PROBLEM THAT MERCURY FOUND.
      *  MJD 072398 FIXED BUG. WAS NOT TESTING TO IF APPS WERE REQUIRED BEFORE
      *             TESTING DEALER NUMBER ON RENEWALS.
      *  JTG 081898 ALLOWED 'PB' ON BANKRUPT ACCOUNTS IF GP-I-AM-WORLD <JGW
      *  BAH 101298 COMMENTED OUT TEST FOR PURDATE BEING IN THIS ACCOUNTING
      *             PERIOD, NATIONS FUNDING DOES "SAVE" LOANS DATED AHEAD, #768
      *  JTG 101398 ADDED SET OF PD-REVOLVING FROM LC-REVOLVING, REGENCY REVOL
      *  JTG 101398 ADDED SET OF LCSCAN-REVOLVING = 'N' AND STOPPED ENTRY
      *             OF REVOLVING ACCOUNTS, REGENCY REVOL
      *  JTG 102098 ADDED DL-PARVPAID-FRMLA-IB & DL-PARVPAID-CODE-IB "C"
      *             INSTANT AUTO #744
      *  CS  102398 ALLOWED DEALER NUMBER OF CHOICE ON RENEWALS(RB,RO,PB,  )
      *             PREVIOUSLY FORCED DEALER NO OF RENEWED ACCOUNT
      *  JTG 102898 CLEARED PRIOR-LOAN-STAT IN DISPLAY-FIELDS ROUTINE, WAS
      *             CAUSING RECALLS WITH NO PRIOR LOAN TO ERROR OUT
      *  JTG 110598 CORRECTED DISPLAY-APP-BW-LISTWAS MISSING '.' END OF LIST
      *             ALLOWED RECALL WITH ERROR-IN-PRIOR-LOAN WILL BE CAUGHT IN
      *             ATTEMPT TO UPDATE
      *  JTG 121698 DISPLAYED 'R' VIA UNITPER-MASK LOGIC FOR REVOLVING ACCOUNT
      *  GLF 030899 ADDED A WINDOW FOR TFC, TO ENTER LPO, REP CODE, AND PROCESS
      *             CODE
      *  JTG 990310 ALLOWED PARTICIPATION HELD ON IB ACCOUNTS, AUTOMOTIVE CREDIT
      *  JTG 990318 CHANGED TO PASS PDSCAN 'N' FOR REVOLVING
      *  JTG 990317 ADDED SP-DLDISC-RVPRIN1-PCNT,                       TFC #008
      *                   SP-LNCOST-FRMLA-VALID VALUE "D"
      *  BAH 990330 ADD "MU" AND "MV" TO AUTO-COLLCD TEST , TFC
      *  BAH 990331 TFC DOES NOT WANT INS TERM CALCULATED IN SEND-PURCHASE
      *  GLF 990607 PROVIDE FOR F6 SCAN OF INSURANCE COMPANY NUMBER
      *             (REGIONAL ACCEPTANCE PR# 866)
      *  MJD 990707 DEFAULT LPO CODE TO DL-LPO WHEN TFCCDS, TFC PR# 31
      *  BAH 990716 ADDED NEW PASSWORD OPTION 4 (INSCO-SEQ) TO CHANGE DEFAULT
      *            INSURANCE COMPANY ON CL,AH,PP,O1, REGENCY PR# 56
      *  MJD 990722 FIXED AFP-DEALER/CLASS TEST TO COUNT " " AS "N".
      *  MJD 990726 ADDED PASSWORD ON PARTIC HELD ON IB ACCOUNTS.
      *  MJD 990803 ADDED GP-INCL-OTH-IN-EARNED FLAG. IF "Y" THEN INCLUDE
      *             EARNINGS BUCKET 6 (OTHER) IN ACCUMULATED TOTALS
      *             OTHERWISE EXCLUDE BUCKET 6.
      *  GLF 990803 ADDED GP-VALID-BDATE. IF "Y" AND THERE IS NOT A VALID
      *             BIRTH DATE FOR SSNO BEING ENTERED, DO NOT ALLOW ENTRY
      *             OF THE SSNO, REGENCY #57
      *  MJD 990817 ADDED TEST OF PURFLD-STAT AFTER PERFORMING
      *             COMPUTE-PURCHASE-FIELDS
      *  BAH 990823 INS TERMS WERE RECALCING AFTER RESERVE WINDOW, TFC DOES
      *              NOT WANT, PL# 235
      * MJD 991109 FORCE INPUT OR EXP DATE ON O3 BY DAFAULTING TO 00/00/00
      *            INSTEAD OF MATURITY DATE (REGACC PR #985)
      * BAH 991111 PASSWORD COVERAGE FIELD FOR CALCULATED INSURANCES,
      *            CL,AH,O1  REGACC PR# 984
      * JTG 991215 ADDED SP-DLDISC-RVPRIN1-AF-PCNT, TFC #058
      * KEC 991221 {PR#00000} ADDED CHECK TO NOT ALLOW OUTSIDE VENDOR
      *            LOAN APPLICATION TO BE USE IN THE F5-KEY SCAN.
      * JTG 000104 CHANGED SP-DLDISC-RVPRIN1-AF-PCNT, TFC #058
      *            TO ACCEPT THE AMOUNT INPUTED IN RVPRIN1 WHEN IT IS LESS
      *            THAN TO COMPUTED AMOUNT
      * KEC 000128 {PR#00000} ADDED NEW ROUTINE FOR VERIFYING THE
      *            LOAN APPLICATION BEFORE UPDATING THE LOAN;
      *            LIBLP/VERIFYAPP(W)
      * MJD 000207 ADDED GP-OT-INS-TERM (TFC PR#48) IF 'Y' THEN ALLOW
      *            ALLOW TERM ENTRY FOR O2O3O4O5 INSURANCE.
      * BAH 000313 TEST SP-DLDISC-RVPRIN1-PCNT AND SP-DLDISC-RVPRIN1-AF-PCNT
      *            NOT = 202.02, KEVIN
      * BLV 000314 ADD ENTRY OF WCBC-CREDITLIM IF LC-CALC-HI-CREDIT = W,
      *            WORLD PR# 225
      * JTG 000315 CORRECTED BUG WITH SRCD EX. FB AND PRIOR ACCOUNT NO. ENTRY
      *            WISC #71249 J006
      * BAH 000503 ADDED PERFORM LOAN-CALCULATIONS AT THE TOP OF
      *            B90-DISPLAY-FIELDS, LNAPPROVAL USES LPDAMTS FIELDS AND
      *            WAS CAUSING JUNK IN THE APPROVAL WINDOW FINANCED AMOUNT.
      * KEC 000530 {PR#00048} TFC [JUDY BRANIFF];
      *            ADDED THE FOLLOWING 'IF' CONDITION FOR ENTERING THE
      *            INSURANCE TERM (GP-OT-INS-TERM = "Y"):
      *                  IF ( VDUNUM0 > 360 )
      *                     GO TO ENTER-IC-TERM.
      * MJD 000619 ADDED ENTRY OF CONTRACT RATE AND TEST OF VARIANCE
      *            (VH/VL) IN SPR (REGACC PR#1220)
      *
      * JTG 000817 CORRECTED RECALL OF SAVED LOANS & QUOTES THAT ARE RENEWALS
      *                                                          MERCURY J010
      *            ADDED VIA-LOAN-SCAN-FG   PIC X    VALUE " "
      *                  VIA-QUOTE-SCAN-FG  PIC X    VALUE " "
      * BLV 000823 ABOVE CHANGE DISPLAYED GARBAGE OVER SSNO'S & NAMES; REMOVED
      *            REDEFINITIONS OF DISPLAY-BUF1, SO THE VIA-SCAN GUYS CAN GET
      *            CALCULATED AMTS INTO X-BUF WITHOUT MESSING UP DISPLAY-BUF1
      * BLV 000823 IN DISPLAY-FIELDS, MOVED THE PERFORM OF PROCESS-PRIOR-LN
      *            TO EARLIER IN THE SECTION, SO IF RENEWAL AMTS HAVE CHANGED
      *            PD-SUM-LNAMT, PD-PROCEEDS & ANTICIPATED WILL BE CORRECTED
      *            BEFORE DISPLAY-BUF1 IS UPDATED
      *  MJD 000912 ADDED LOGIC TO ASK LOCK BOX QUESTION  (MFC PR#227)
      *  BLV 001018 TEST IF SP-DLDISC-RVPRIN1-AF-PCNT = 202.02 OR
      *             SP-DLDISC-RVPRIN1-PCNT = 202.02, FORCE 0 TO THEM &
      *             REMOVE SPECIFIC CHECKS WITHIN IF STATEMENTS; THERE
      *             WERE CASES THAT 202.02 WOULD FORCE 0 IN ENTRY
      *   CS 010118 ADDED READ OF DLFILE IN SEND-PURCHASE-FIELDS.  WHEN RENEWAL
      *             WAS RECALLED USING F3, TERM WAS COMPARED AGAINST DLMAXPURTRM      *             WHICH WAS 202 BECAUSE WE DIDNT HAVE THE DEALER RECORD
      *             CAUSING INVALID ANTICIPATED TERMS & INVALID ORIGINAL &
      *             PURCHASE BALANCE.
      *  JTG 010507 ALLOWED ENTRY OF 'TRADEIN' RE:SALE PRICE-DP-TI PAACO PR#1467
      *  BLV 010802 ADD PASSWORD IF NON-BATCH DISBURSEMENT SELECTED MERC PR# 253
      *  JTG 010912 NEW SP-CAL-TBFRMLA (5) SP-FORCE-ENTRY-OVRDRATE CENTRIX #1592
      *  JTG 011001 DON'T ALLOW A FIRST PAY DAY OF 31 WHEN SEMI MONTHLY PAPER
      *                                                            FFG PR#333
      *  JTG 020104 ADDED RENEWAL VERIFY OF PAYOFF AMOUNT          WORLD PR#286
      *  BLV 020109 IF USING ACH FOR DIRECT DEPOSIT OF DEALER CKS, ONLY ALLOW
      *             BATCH CK IF DEALER IS DIRECT DEPOSIT & DON'T ALLOW BATCH
      *             IF DEALER IS NOT, REGACC PR# 1691
      *  BAH 020422 PASSWORD GETTING UP TO ALL INSURANCES, RECALLING LOANS
      *             BUILT FROM CSMI, DONT WANT INSURANCES CHANGED !
      *             REGACC PR# 1778
      *  JTG 020624 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *  BAH 020712 SIGNED LN-TRADEIN, REGACC PR# 1808
      *  BLV 020820 IF GP-ENTER-LPO-FG = "Y", OPEN TFC WINDOW FOR ENTRY OF
      *             LPO, SOAUTO PR# 1885
      *  JTG 020916 ADDED LN-DLCOMM-03-CMSI LN-DLCOMM-PP-CMSI  REGACC #1846
      *  CS  020924 CHANGED CHECK ON OUTSIDE VENDOR (KEC 991221) TO ALLOW AN
      *             F5-KEY SCAN IF THE PD DOES NOT EXIST [LENDMARK # 1847]
      *  CS  021002 DON'T ALLOW A FIRST PAY DAY OF 14 OR 15 IF SEMI-MONTHLY
      *             PER JTG, CAUSED LATE CHARGE PROBLEMS AT FFG
      *  JTG 030218 MOVED 'PERFORM VERIFY-LOAN-RN-PAYOFF' TEST, SO NO OTHER
      *             OPERATOR INPUT WILL OCCUR BEFORE DOING UPDATE OF LOAN
      *                                                             WORLD PR#286
      *  BAH 030516 PASSWORD MODIFYING ANY FIELD FROM A F3 RECALL LOAN
      *             REGACC PR# 28
      *  JTG 030616 ADDED LOGIC FOR IB SALES FINANCE AMORTIZATED PARTICIPATION
      *             RESERVE PAID EXPENSE, DIFFERENCE BETWEEN A BUY RATE
      *             AND THE CONTRACT RATE                WISCONSIN FINANCE #2049
      *  BAH 030619 ADDED CIP-PRIOR-SUB-CLASS FOR SCFRMLA 46, LENDMARK PR# 2101
      *             AND PASS-PRIOR-SUB-CLASS (PAYOFX)
      *  BAH 031001 ADDED SP-INSCHGABLE '2' & '1',SP-INS-AMTFIN-2PMTS &
      *             SP-INS-AMTFIN-1PMTS FOR SIGNAL (WISC) PR# 2157
      *  BAH 031023 ADDED GP-DEFAULT-O3-INSOURS, LENDMARK PR# 2180
      *  JTG 031104 CREATED LOGIC FOR TEST ON SP-CAL-TBFRMLA (5)
      *             SP-FORCE-ENTRY-OVRDRATE CENTRIX #1592
      *             THE LOGIC THAT WAS ADDED UNDER TEST HAD TWO IF'S
      *             OF WHICH THE FIRST 'IF VDUNUM3 = 999.999 SHOULD
      *             HAVE BEEN FOLLOWED WITH AN 'END-IF'
      *  BAH 040304 ADDED SP-DEFAULT-O2-INS-COMP FOR LENDMARK PR# 2258
      *  BAH 040520 VERIFY-LOAN-RN-PAYOFF WAS COMING BACK WITH AN INVALID
      *             (MISSING) PD ON AN "SC" APP AND RETURNING TO MODIFY-ROUTINE
      *             WITHOUT TELLING THE USER ANYTHING....
      *  BAH 040920 PASSWORD ALLOWING ZERO TO BE ENTERED AS CREDIT LIMIT,
      *             OPTION SEQ = 15, LENDMARK PR# 2382
      *  BAH 041206 PASSWORD TO ENTER A CASHDATE, OPTION SEQ = 16,
      *             FINMGM PR#2429
      *  BLF 050117 IF REGACC, DISPLAY DEALER NAME & FAX # IN WINDOW & REQUIRE
      *             ACCEPT BEFORE CONTINUING, REGACC PR# 96
      *  BAH 050222 WHEN ENTERRING SUB CLASS, YOU DONT KNOW THE LOANDATE YET TO
      *             CHECK IF SPR IS EXPIRED, SO IT WAS JUST GRABBING THE FIRST
      *             LAWCODE FOUND TO DISPLAY THE DESCRIPTION, WHICH ISNT
      *             CORRECT IF THEY EXPIRE AND BUILD A NEW ONE WITH A DIFFERENT
      *             DESCRIPTION, VERY CONFUSING...AT LEAST SKIP EXPIRED SPR.
      *             RIVERSIDE PL# 467
      *   CS 050425 IF INSURANCE PREMIUM = ZERO, ZERO THE INSCOMP,INSCOMM,
      *             EFFDATE,EXPDATE, AND OUR FLAG.  WE WERE COMPUTING A
      *             COMMISSION ON A ZERO PREMIUM [PR#479 NSA]
      *
      * KEC 050524 {PR#02516} PREMIER ADVISORY <A15> [JUDY]
      *            ADDED PRIOR TO 'PERFORM VERIFY-LOAN-APPROVAL':
      *
      *    IF ( MA-EXISTS-YES )
      *       MOVE LNAPPROVAL---CREATION-APP  TO LNAPPROVAL-CREATION
      *    ELSE
      *       MOVE LNAPPROVAL---CREATION-LONP TO LNAPPROVAL-CREATION.
      *
      * JTG 050819 DID  N O T  CHANGE LOGIC FOR SF INPUT
      *            CHANGED SAVE LOAN, ETC TO USE PD-ANTICERN(4) FOR DISPLAY
      *            OF MAINTENANCE FEES INSTEAD OF THE STORED TRUNCTATED
      *            PD-MAINTFEE * PD-ORGTERM WHICH DOSEN'T EQUAL THE COMPUTED
      *            'VAT' VALUE ADDED TAX IN PD-ANTICERN(4)           WORLD #0408
      * BAH 051128 UNDO CHANGE FROM 050222 PL# 467, WOULD NOT LET YOU BOOK A
      *            LOAN WITH AN EXPIRED SPR, AND YOU SHOULD BE ABLE TO.
      *            INSTEAD OF SKIPPING EXPIRED SPR IN READ-NEXT, JUST REDISPLAY
      *            THE SUBCLASS DESCRIPTION AFTER ENTERING THE LOANDATE.
      *  CS 060601 ADDED GP-I-AM-SECURITY TEST ON CLASS/DEALER COMBINATIONS.
      *                                              SECURITY PR# 2503
      *  KEC 060721 PR#00127 REGIONAL ACCEPT. ADDED LOGIC FOR "AUTOPC".
      *  BAH 061212 READ-PD1-FILE AGAIN RIGHT BEFORE UPDATE IN CASE
      *             SOMEONE ELSE UPDATED SAME SAVED LOAN, REGACC PL# 562
      *  BAH 070104 IF GP-ALLOW-MANUAL-CHECKS = "N", FORCE SYSTEM CHECKS
      *             WORLD PR# 513
      *  BAH 070125 UNDID REGACC PL# 562 FROM ABOVE, IF THEY MADE CHANGES
      *             TO THE SCRATCH PAD THEN UPDATED, IT GOT THE ORIGINAL
      *             FIGURES BACK IN AND NOT THEIR CHANGES !!
      *  BAH 070626 FIXED ELE = 33(FEES) FOR PASSWORD MODIFYING ANY FIELD FROM
      *             A F3 RECALL LOAN ORIG REQUEST PR # 28, REGACC PR# 176
      *             YOU WERE STILL ABLE TO CHANGE FEES FOR SOME REASON !
      *  BAH 071211 PARTICIPATION HELD CODING FOR REGACC PR# 185
      *             BR-USE-PARTIC-FLAT-TABLE = "Y"
      *   CS 070326 MADE ANOTHER ATTEMPT TO STOP SAVED LOANS FROM BEING
      *             UPDATE TWICE(ORIG PL#562)  REGIONAL PL#623
      *   CS 081105 ADDED TEST ON GP-INCL-OTH-IN-EARNED = 'R'. IF 'R' EXCLUDES
      *             ANTIC(6) AND ANTIC(4)
      *   CS 090205 ADDED CHECK OF DL-USE-PARTIC-FLAT-TABLE. IF BR-USE-PARTIC
      *             FLAT-TABLE IS 'Y', THEN CHECK THE DEALER FLAG PR#237 REGACC
      *   CS 090728 ADDED TO TEST ON GP-I-AM-SECURITY SO THAT CLASS/DEALER
      *             COMBINATIONS MATCH PLAN 4 PR#3402
      *  BAH 090821 ADDED SP-INSCHGABLE "E" FOR REGMGM PR# 3437
      *  BAH 091015 PASS SFDLO3-ORGST TO CL/SFDLO3 FOR REGMGM PR# 3475
      *   CS 110407 ADD SP-LNCOST-FRMLA '4' WHICH DOES THE FLAT RATE AMOUNT PLUS
      *             TAKES PARTIC PAID AMOUNT AND UPDATES LN-ANTICERN(3)
      *             ALLOWING FOR AMORTIZATION OF RESERV EXP. REGMGM PR#3765
      * BAH 110523 PASSWORD PROTECT ADDON SOURCE CODES, ET, LP, NP, RT, ST
      *            AND RB, REGMGM PR# 3792
      * BLM 111208 DON'T ALLOW DIRECT LOAN DEALER 9999.99, REGMGM PL# 764
      * BAH 111229 ADDED PP-PREM-SEQ TO PASSWORD CHANGING PP PREM REGWAN PR#3935
      * BAH 121002 ADDED LC-SALES-FORCED-ENTRY REDEFINES LC-STOP-ON-DLNO
      *            FOR GP-I-AM-SECURITY SECURITY AUTO PR# 4116
      * BAH 130718 DISPLAY DL-SIGN1 AND DL-SIGN2 FOR SECURITY AUTO, PR# 4340
      * BAH 130923 ALLOW GP-I-AM-WDT TO USE LT-SEQ 5 FOR A 3RD HHGS PR#4095
      * KEC 140211 {PR#00967} WORLD <A15> [JIM ROSENAUER]
      *            ADDED LOGIC FOR WORLD TO DO LOAN APPS.
      *            ADDED LIBLP/WRLDAPP(W)
      *            ADDED LOANAPP-* FIELDS
      *            MODIFIED EXISTING FIELDS FOR WORLD'S NEEDS.
      * BAH 140213 PASSWORD DEALER STATE NOT MATCHING ORIG STATE, REGWAN PR#4470
      * MJD 140429 REPLACED YIELD WITH WS-YIELD, RESERVE WORD
      * BAH 140814 ADDED TEST FOR LPSMNU IN HELP
      * BAH 141009 PASSWORD LOANDATE 90 DAYS OR OLDER, EXCEL PR# 4630
      *  CS 141110 INCREASED WINDOW-LINES FROM 7 TO 10, WINDOW DID NOT DISPLAY
      *            CORRECTLY (PRMIUM). 
      *  CS 141111 AT END OF BORROWER-CREATE SECTION, FORCED BWCREA-NO TO 
      *            VDUNUM0 WHICH IS MOVED TO NUM-BW AND THEN TO PD-SSNO,
      *            BW-SSNO. WHEN YOU F5-BORROWER-CREATE AND COME BACK TO
      *            LONPB0, DIDNT HAVE THE RIGHT VALUE FOR VDUNUM0
      * BLM 151217 ALLOW ACH DEALER TO SELECT OTHER TYPES OF CHECKS,
      *            MUST HAVE FORCED PASSWORD TO DO THIS, LP/LONPB0/
      *            SEQ 21, KSTREET PR# 4865
      *  BAH 160118 SPLIT OUT LTFILE, PD0003
      * KEC 2016.0315 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED CD-FEE???? TO CD-GC-????.
      * KEC 2016.0324 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED CDSCAN-WINDOW-BUF TO HAVE MATCHING CD1-KEY
      *         LAYOUTS (FOR EACH CODE TYPE; CD-TYPE).
      *         CDSCAN-CD1-KEY IS THE NEW (PRIMARY) WITH REDEFINES OF
      *         CDSCAN-??-KEY (NEW).
      * KEC 2016.0329 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED ELSCAN WORKERS TO MATCH CD1-KEY FOR EL LAYOUT.
      * KEC 2016.0516 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED USE OF APPNO TO APP-NUMBER FOR MA1-KEY USAGE.
      * KEC 2016.0620 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         REMOVED USE OF THE MX-FILE [LIBLA/LAFDMX].
      *         REMOVED USE OF OLD STATUS ROUTINES [LIBLA/MASTATUS(W)].
      *         ADDED USE OF NEW MA-STATUS-INFO FIELDS; AS WELL AS
      *         ADDED USE OF NEW ROUTINES [LIBLA/LAFRMA & LAWSMA].
      *  CS 160726 ADD PASSWD SEQ 22, HONOR WANTS TO BE PROMPTED FOR
      *            PASSWD ONLY WHEN 30 DAYS HAS NOT ELAPSED FROM
      *            LOAN DATE, EX :LNDATE 7/11, 8/10 SHOULD BE 
      *            ALLOWED WITHOUT ENTERING A PASSWORD #5139
      * KEC 2016.0818 REMOVED USE OF THE BA-FILE [LIBLA/LAFDMX].
      *               REVISED LA-REC LAYOUT.
      * MJD 160824 ADDED LC-CALC-HI-CREDIT = "L"              61000/1180
      * BLM 160824 ADDED UPDATE OF SAVE-PRPDUE-DAYS & SAVE-PRLNAMT WHICH ARE NOW
      *            USED IN LNAPPROVAL FOR WORLD, WORLD PR# 1182
      * BLM 161223 REMOVE CHKSEC, SECURITY CHECK IS DONE IN LONP
      * BLM 170309 FIX PD-LOANDATE, PD-PURDATE, PD-CASHDATE, PD-INTDATE,
      *            PD-1STPYDATE, PD-ORIG-1STPYDATE TO BE YYYYMMDD, PD0006
      * BAH 170522 ADDED CALL TO WI/BSCORE FOR REGMGM ONLY TO ENTER THE
      *            BW-CREDIT-SCORE IF BW-REFDATE NOT = TODAY PR#5295
      * BAH 170612 ACTIVATE 8 DIGIT DATES, PD0006
      * BAH 180817 PD2-BWNAME WAS NOT GETTING SET, A15 USED A FLDVAL.
      *            SET IT IN SEND-BW-NAME LIKE XONPC0 DOES
      * KEC 180823 LOAN APP MODULE REMOVAL FROM A30 [LARM30]
      * BAH 190111 GLOBAL PDFILE
      * BAH 190122 SPLIT CDFILE
      * BAH 20190625 REMOVED LC-REVOLVING, LCSCAN-REVOLVING PT#0153
      * BAH 20190702 REMOVED PF-FILE PARTIC FLAT HELD PT0051
      * BAH 20190702 REMOVED BR-USE-PARTIC-FLAT-TABLE PT0051
      * BAH 20200617 CHANGED PC-LT-RECORD TO PC-LTC-RECORD, ADDED LPPCCL
      * BAH 20200615 MOVED OPEN-IC1-FILE, OPEN-SP1-FILE, OPEN-CD1-FILE,
      *              OPEN-BW1-FILE TO TOP OF PROGRAM #TST001
      * BAH 20201207 CHANGE VIA-QUOTE-SCAN, DONT MOVE IN THE PDSCAN-NAME,
      *              YOU HIT END OF FILE WHEN ONLY 1 QUOTE IN THE PDFILE.
      *              MOVE SPACES TO PD2-BWNAME AND ADD A CHECK OF THE
      *              PD2-BWNAME MATCHES THE PDSCAN-BWNAME OR GO GET NEXT.
      * BAH 2021.0518 MOVE 0 TO PRIOR-LNAMT IN NEW RECORD ROUTINE, WAS
      *               DISPLAYING BOGUS PROCEEDS + PRIOR IN APPROVAL WINDOW
      *               #1497A
      * BAH 2022.0314 REMOVED EXT-SPANISH-FORMS AND ALL MX FORMS
      * BAH 2023.0314 FIXED CHECK ON SP-EDT-NOEDITS CINDY FOUND
      * BAH 2024.0315 REMOVED BISCAN-LIASMLN AND BISCAN-PRLOANS
      * BAH 2025.0407 CLEAR 3RD LEVEL OF AUTO COLLATERAL, WK-AUTO-3 S35Q-194
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. 3B.
       OBJECT-COMPUTER. 3B.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
       COPY "LIBLP/LPFSWK.CPY".
       I-O-CONTROL.
       DATA DIVISION.
       FILE SECTION.

       COPY "LIBLP/LPFDWK.CPY".

       WORKING-STORAGE SECTION.
       77  SCCS-IDENTIFIER PIC X(41) VALUE
           "@(#)LP/LONPB0.CBL S35 02/20/24-13:20:24 >".
      **********************************
      *       F I L E   P A T H S      *
      **********************************
       COPY "LIBGB/GB01BR.CPY".
       COPY "LIBGB/GB01BR_SQL.CPY".
       COPY "LIBGB/GBWSBR.CPY".
       COPY "LIBGB/GB01GR.CPY".
       COPY "LIBGB/GB01GR_SQL.CPY".
       COPY "LIBGB/GBWSGR.CPY".
       COPY "LIBLP/LP01DL.CPY".
       COPY "LIBLP/LP01DL_SQL.CPY".
       COPY "LIBLP/LPWSDL.CPY".
       COPY "LIBLP/LP01LC.CPY".
       COPY "LIBLP/LP01LC_SQL.CPY".
       COPY "LIBLP/LPWSLC.CPY".
       COPY "LIBLP/LP01SP.CPY".
       COPY "LIBLP/LP01SPA.CPY".
       COPY "LIBLP/LP01SPB.CPY".
       COPY "LIBLP/LP01SPC.CPY".
       COPY "LIBLP/LP01SP_SQL.CPY".
       COPY "LIBLP/LPWSSP.CPY".
       COPY "LIBLP/LP01BW.CPY".
       COPY "LIBLP/LP01BW_SQL.CPY".
       COPY "LIBLP/LPWSBW.CPY".
       COPY "LIBLP/LP01CD.CPY".
       COPY "LIBLP/LP01CD_SQL.CPY".
       COPY "LIBLP/LPWSCD.CPY".
       COPY "LIBLP/LP01CDB.CPY".
       COPY "LIBLP/LP01CDB_SQL.CPY".
       COPY "LIBLP/LPWSCDB.CPY".
       COPY "LIBLP/LP01IC.CPY".
       COPY "LIBLP/LP01IC_SQL.CPY".
       COPY "LIBLP/LPWSIC.CPY".
       COPY "LIBLP/LP01PD.CPY".
       COPY "LIBLP/LP01PD_SQL.CPY".
       COPY "LIBLP/LPWSPD.CPY".
       COPY "LIBLP/LP01PC.CPY".
       COPY "LIBLP/LP01PC_SQL.CPY".
       COPY "LIBLP/LPWSPC.CPY".
       COPY "LIBLP/LP01LTC.CPY".
       COPY "LIBLP/LP01LTC_SQL.CPY".
       COPY "LIBLP/LPWSLTC.CPY".
       COPY "LIBLP/LP01CK.CPY".
       COPY "LIBLP/LP01CK_SQL.CPY".
       COPY "LIBLP/LPWSCK.CPY".
       COPY "LIBGL/GL01GI.CPY".
       COPY "LIBGL/GL01GI_SQL.CPY".
       COPY "LIBGL/GLWSGI.CPY".

       01  WK-IFN          PIC X(2)   VALUE "WK".
       01  WK-KEY          PIC 99.
       01  CASE-BUF        PIC X(4).

       01  LOAN-RN-PAYOFF-PROBLEM      PIC X.
       01  SAVE-PD-REC     PIC X(PD-SIZE).
       01  LN-ACCTNO       PIC 9(8)    COMP.
       01  MSEL-LIST       PIC X(5)    VALUE "MSEL.".
       01  WSEL-LIST       PIC X(5)    VALUE "WSEL.".
       01  IX1             PIC 99.
       01  IX2             PIC 99.
       01  ONE             PIC S9.
       01  ELE             PIC 9(6) COMP.
       01  CDCODE-FEE-FG            PIC 9.
       01  MULTIPLE-CK-FG           PIC X.
       01  PASS-DLPAID-FG           PIC X.
       01  CK-FREE-TYPE-BUF.
           03  CK-FREE-RTNCD        PIC X      VALUE " ".
           03  CK-FREE-TYPE1        PIC X(70)  VALUE SPACES.
           03  CK-FREE-TYPE2        PIC X(70)  VALUE SPACES.

      * USED TO CALL CL/SFVERI
       01  ERRORS-EXIST             PIC X.

       01  ACTION.
           03  CHKEY       PIC X(4).
           03  CHNO        PIC 9(2).
       01  IO-TYPE         PIC X(3).
       01  NEW-FLAG        PIC 9.
       01  FIRST-TIME      PIC 9    VALUE 0.
       01  FIRST-ELE       PIC 99   VALUE 0.
       01  SAVE-SSNO       PIC 9(10) COMP.
       01  NON-MEMO-CHGS   PIC 9(6)V99   COMP.
       01  NOT-OUR-CHGS    PIC 9(6)V99   COMP.
       01  OUR-CHGS        PIC 9(6)V99   COMP.
       01  RESCISSION-FLAG PIC X    VALUE " ".
       01  APR-OK          PIC X    VALUE "N".
       01  FORCE-ENTERED-PRIN1     PIC X    VALUE "N".
       01  FORCE-ENTERED-PRIN2     PIC X    VALUE "N".
       01  FORCE-ENTERED-DISC      PIC X    VALUE "N".

       01  HOLD-VDUSTATUS                       PIC X(02)  VALUE "00".

      *-----------------------------------------------------------------
       01  VIA-LOAN-SCAN-FG   PIC X    VALUE " ".
       01  VIA-QUOTE-SCAN-FG  PIC X    VALUE " ".

      *-----------------------------------------------------------------
       01  MESSAGEX.
           03  MESSAGE-CANNOT-CHANGE-SSNO.
               05  FILLER                       PIC X(43)  VALUE
                   "CANNOT CHANGE THIS NUMBER --- 'F1' TO CLEAR".
           03  MESSAGE-MUST-CREATE-BW-1.
               05  FILLER                       PIC X(38)  VALUE
                   "MUST CREATE BORROWER BEFORE CONTINUING".

      *----------------------------------------------------------------
      * REPLACED SEVERAL OCCURANCES OF IO-FG WITH BW-ERROR-YN.
      * IO-FG WAS USED AS AN ERROR FLAG UNRELATED TO I/O. ADDING LA-FILE
      * READ CHANGED IO-FG WHICH AFFECTED FLOW OF PROGRAM.
      *----------------------------------------------------------------
       01  BW-ERROR-YN                   PIC X       VALUE "N".
           88  BW-ERROR-NO                           VALUE "N".
           88  BW-ERROR-YES                          VALUE "Y".
       01  W-VDUSTATUS        PIC XX.
       01  HOLD-PRIOR-PO-TRCD PIC XX    VALUE " ".
       01  QUOTE-ID-FG        PIC X     VALUE " ".
           88  QUOTE-ONLY               VALUE "Q".
           88  QUOTE-CHANGED-TO-LOAN    VALUE "L".
       78  CL-ELE             VALUE 27.
       78  AH-ELE             VALUE 28.
       78  PP-ELE             VALUE 29.
       78  O1-ELE             VALUE 30.
       78  O2-ELE             VALUE 31.
       78  O3-ELE             VALUE 32.

       01  FEECODE-TABLE      VALUE " ".
           03  FEECODE        OCCURS 4 TIMES
                              PIC XX.

       01  SAVED-PRIOR-COLLCD PIC X(2).
       01  SAVED-PRIOR-COLLID PIC X(20).

       01  SAVE-BR-AH-AND-CL  PIC X.
       01  TEST-COLLCD          PIC XX.
           88  AUTO-COLLCD VALUE "AU" "AC" "AL" "RP" "HP" "AW"
                                 "MU" "MV".
       01  PRIOR-LOAN-STAT      PIC X.
           88  ERROR-IN-PRIOR-LOAN                  VALUE "E".
       01  HOLD-CIP-SRCD        PIC XX              VALUE " ".
       01  FIND-LOANS-FG        PIC X               VALUE " ".
       01  QUOTE-SOC-SEC        PIC 9(9).
       01  WS-YIELD             PIC 999V999.
       01  INS-COMM             PIC S9(7)V99        COMP.

       01  RVNO                PIC 9.
       01  COUNTER             PIC 9(6)      COMP.
       01  PASSED-EDITS-FLAG   PIC X(01).
       01  RATE-LOW            PIC S9999V999.
       01  RATE-HIGH           PIC S9999V999.
       01  DISP-RATE           PIC ZZ9.999.
       01  SUB                 PIC 9(6)      COMP.
       01  SUB2                PIC 9(6)      COMP.
       01  SP-SUB              PIC 9(6)      COMP.
       01  PD-SUB              PIC 9(6)      COMP.
       01  WORK-RATE           PIC 99V9(4)   COMP.
       01  OVER-20             PIC 99.
       01  I-LEVEL             PIC 9(6)      COMP.
       01  INSPECT-W           PIC X(86).
       01  INSPECT-X           REDEFINES INSPECT-W.
           03  INSPECT-Z       PIC X OCCURS 86 TIMES.
       01  ADD-ON              PIC X(25).
       01  CALCULATE-APR-FG    PIC X         VALUE "Y".
       01  AMT-HOLDER          PIC 9(6)V99   COMP.
       01  PREM-CHANGE         PIC X         VALUE " ".
       01  PREM-AMOUNT         PIC 9(4)V99   COMP VALUE 0.
       01  TEST-PROCEEDS       PIC S9(7)V99  VALUE 0.

       01  HOLD-BW-NAME        PIC X(24)     VALUE SPACES.
       01  HOLD-WORKER         PIC S9(8)V99.
       01  TEST-PAY-FG         PIC X.
       01  HOLD-TOTAL-REPAY    PIC S9(7)V99  COMP.
       01  PRIOR-DLNOX.
           03  PRIOR-DLNO        PIC 9(4)V99.
       01  PRIOR-LNAMT           PIC S9(7)V99 COMP.
       01  PRIOR-BNKRPTDATE      PIC 9(8)     COMP.

      ************************************************************
      * NOTE:
      *      THIS FIELD 'HOLD-INS' MAPS THE LAYOUT OF PD-INSTBL
      ************************************************************
       01  HOLD-INS.
           03  HOLD-INSTBL            OCCURS 4.
               05  HOLD-INSCOMP       PIC 99.
               05  HOLD-INSOURS       PIC X.
               05  HOLD-INSEFF-DATE   PIC 9(8)      COMP-3.
               05  HOLD-INSTRM       REDEFINES HOLD-INSEFF-DATE
                                      PIC 9(8)      COMP-3.
               05  HOLD-INSEXP-DATE   PIC 9(8)      COMP-3.
               05  HOLD-INSPREM       PIC 9(5)V99   COMP-3.
               05  HOLD-INSCOVR       PIC 9(7)V99   COMP-3.
               05  HOLD-INSCOMM       PIC 9(5)V99   COMP-3.
               05  HOLD-INSANTICERN   PIC S9(7)V99  COMP-3.
               05  HOLD-INSANTICADJ   PIC S9(7)V99  COMP-3.
               05  HOLD-INSUFERN      PIC S9(7)V99  COMP-3.
               05  HOLD-INSACCERN     PIC S9(7)V99  COMP-3.
               05  HOLD-INSEARN-ORDER PIC 99.
               05  HOLD-INSFINCHG     PIC X.

      ******************************************************************

       01  REGPY-WK         PIC S9(7)V99    COMP.
       01  ODDPY-WK         PIC S9(7)V99    COMP.
       01  REGPY-TEMP-WK    PIC S9(7)V99    COMP.
       01  F3-COLLATERAL    PIC X        VALUE " ".
           88  F3-YES                    VALUE "Y".

       01  CHECK-PAYCODE.
           03  FILLER      PIC X(5).
           03  CK-CODE     PIC X.
       01  LEGEND-01.
           03  FILLER                   PIC X(44) VALUE
               "F7, F3-LOANS, F4-QUOTES, F5-APPS, F6-CLASS, ".
           03  FILLER                   PIC X(16) VALUE
               "ENTER LOAN CLASS".

       01  LEGEND-01-A.
           03  FILLER                   PIC X(26) VALUE
               "F7-MENU, ENTER SUB CLASS :".

       01  CK-LEGEND-NO-M.
           03  FILLER                   PIC X(28) VALUE
               "^-BACK,DEALER CK: S-SYSTEM, ".
           03  FILLER                   PIC X(32) VALUE
               "B-BATCH, F3-MULTIPLE CK:".
       01  CK-LEGEND.
           03  FILLER                   PIC X(27) VALUE
               "^-BACK,DEALER CK: S-SYSTEM,".
           03  FILLER                   PIC X(33) VALUE
               "M-MANUAL,B-BATCH,F3-MULTIPLE CK:".
       01  CK-LEGEND-2.
           03  FILLER                   PIC X(28) VALUE
               "^-BACK, DEALER CK: S-SYSTEM,".
           03  FILLER                   PIC X(32) VALUE
               " M-MANUAL, F3-MULTIPLE CK:".
       01  CK-LEGEND-2-NO-M.
           03  FILLER                   PIC X(28) VALUE
               "^-BACK, DEALER CK: S-SYSTEM,".
           03  FILLER                   PIC X(32) VALUE
               " F3-MULTIPLE CK:".

       01  LEGEND-UPDATE-1.
           03  FILLER                   PIC X(52) VALUE
           "F1-CLEAR, F4-MEMO, DELETE, S-SAVE, U-UPDATE, FIELD#:".
       01  LEGEND-UPDATE-1-BUY.
           03  FILLER                   PIC X(54) VALUE
           "F1, F4-MEMO, F5-BUY, DELETE, S-SAVE, U-UPDATE, FIELD#:".
       01  LEGEND-UPDATE-2.
           03  FILLER                   PIC X(38) VALUE
           "F1-CLEAR, F3-APPRVL, F4-MEMO, DELETE, ".
           03  FILLER                   PIC X(23) VALUE
           "S-SAVE, U-UPDATE, FLD#:".
       01  LEGEND-UPDATE-2-BUY.
           03  FILLER                   PIC X(40) VALUE
           "F1, F3-APPRVL, F4-MEMO, F5-BUY, DELETE, ".
           03  FILLER                   PIC X(20) VALUE
           "S-SAVE, U-UPD, FLD#:".

      *-----------------------------------------------------------------
      *    U S E R I D
      *-----------------------------------------------------------------
       01  USERID-GROUP-NAME.
           03  USER-GROUP           PIC X(3).
           03  FILLER               PIC X(2).

      ******************************************************************
       COPY "LIBWI/FEEENTW.CPY".
       COPY "LIBWI/RSVENTW.CPY".
       COPY "LIBCL/SFDLO3W.CPY".
       COPY "LIBWI/LNSCN2W.CPY".
       COPY "LIBWI/LNSCANW.CPY".
       COPY "LIBWI/ELSCANW.CPY".
       COPY "LIBWI/ICSCANW.CPY".
       COPY "LIBWI/LCSCANW.CPY".
       COPY "LIBWI/PDSCANW.CPY".
       COPY "LIBWI/SCSCANW.CPY".
       COPY "LIBWI/BWCREAW.CPY".
       COPY "LIBWI/BWSCANW.CPY".
       COPY "LIBWI/CDSCANW.CPY".
       COPY "LIBWI/CDBSCNW.CPY".
       01  WINDOW-WORKERS.
           03  WINDOW-LPO          PIC X(4).
           03  WINDOW-REP          PIC X(8).
           03  WINDOW-PROCESS      PIC X(1).

       COPY "LIBWI/PFSWINDOWSW.CPY".

       01  LC-INFO-LIST      PIC X(10)   VALUE "40P:S 400.".
       01  LC-INFO-BUF       PIC X(14).

       01  DLR-TYP-LIST      PIC X(6)   VALUE "39P:P.".
       01  DLR-TYP-BUF       PIC X(4).

       01  ALP-BW.
           03  ALP-BW123   PIC X(3).
           03  ALP-HYPHEN1 PIC X.
           03  ALP-BW45    PIC X(2).
           03  ALP-HYPHEN2 PIC X.
           03  ALP-BW6789  PIC X(4).
       01  NUM-BW          PIC 9(9).
       01  NUM-BWX REDEFINES NUM-BW.
           03  NUM-BW123   PIC X(3).
           03  NUM-BW45    PIC X(2).
           03  NUM-BW6789  PIC X(4).
       01  W-LNNO          PIC 9(8).

       01  SRCD-WORKER              PIC S9(7)V99 COMP.
       01  SAVE-PRLNAMT             PIC 9(6)V99 VALUE 0.
       01  SAVE-PRPDUE-DAYS         PIC S9(5) VALUE 0.
      ********************************
      *   S C R E E N   B U F F E R  *
      ********************************
       01  DISPLAY-BUF1        VALUE " ".
           03  D-LCNO          PIC Z(8)9.
           03  D-LC-DESC       PIC X(16).
           03  D-010-040       OCCURS 4.
               05  D-010       PIC X(11).
               05  D-011       PIC X(24).
               05  D-012       PIC X(1).
           03  D-PPRIN         PIC X(12).
           03  D-ANTIC-DLCK    PIC X(12).
           03  D-LNAMT         PIC ZZZ,ZZ9.99.
           03  D-ANTIC         PIC ZZZ,ZZ9.99-.
           03  D-PROCEEDS      PIC $$$,$$9.99-.
           03  D-050           PIC XX.
           03  D-051           PIC 9(4)      BLANK ZERO.
           03  D-052           PIC Z9.
           03  D-053           PIC X(15).
           03  D-060           PIC 99/99/99  BLANK ZERO.
           03  D-070           PIC X(3).
           03  D-071           PIC X(20).
           03  D-080           PIC X(2).
           03  D-081           PIC X(20).
           03  D-090           PIC X(20).
           03  D-091           PIC X(30).
           03  D-100           PIC X(2).
           03  D-101           PIC X(20).
           03  D-110           PIC 9(6)      BLANK ZERO.
           03  FILLER          PIC X(3).
           03  D-111           PIC Z(5)9.99  BLANK ZERO.
           03  D-112           PIC X(4).

       01  DISPLAY-BUF2        VALUE " ".
           03  D-400           PIC ZZ.
           03  D-120           PIC 9(4).99   BLANK ZERO.
           03  D-121           PIC X(16).
           03  D-130           PIC X.
           03  D-131           PIC X(9).
           03  D-132           PIC Z(5)9.99  BLANK ZERO.
           03  D-140           PIC X.
           03  D-141           PIC ZZ9.
           03  D-150           PIC ZZZ.
           03  D-160           PIC 99/99/99  BLANK ZERO.
           03  D-170           PIC X(8).
           03  D-180           PIC 99/99/99  BLANK ZERO.
           03  D-190           PIC Z99.999   BLANK ZERO.
           03  D-200           PIC Z99.999   BLANK ZERO.
           03  FILLER          PIC X.
           03  D-210           PIC Z99.999   BLANK ZERO.
           03  D-YLD           PIC Z99.999   BLANK ZERO.
           03  D-220           PIC Z(5)9.99  BLANK ZERO.
           03  D-230           PIC Z(5)9.99  BLANK ZERO.
           03  D-231           PIC Z(5)9.99- BLANK ZERO.
           03  D-240           PIC Z(5)9.99  BLANK ZERO.
           03  D-241           PIC ZZ9.99    BLANK ZERO.
           03  D-250           PIC Z(5)9.99  BLANK ZERO.
           03  D-251           PIC Z(3)9.99  BLANK ZERO.
           03  D-260           PIC XXX.
           03  D-270-300       OCCURS 4.
               05  D-1COMP      PIC 99        BLANK ZERO.
               05  D-1IOURS     PIC X.
               05  D-1TERM      PIC Z(3).
               05  D-1COVR      PIC Z(5)9.99  BLANK ZERO.
               05  D-1PREM      PIC Z(3)9.99  BLANK ZERO.
           03  D-310-320       OCCURS 2.
               05  D-2COMP      PIC 99        BLANK ZERO.
               05  D-2IOURS     PIC X.
               05  D-2EXP       PIC 9(6)      BLANK ZERO.
               05  D-2TERM REDEFINES D-2EXP
                                PIC Z(6)      BLANK ZERO.
               05  D-2COVR      PIC Z(5)9.99  BLANK ZERO.
               05  D-2PREM      PIC Z(3)9.99  BLANK ZERO.
           03  D-330-3405      OCCURS 2.
               05  D-1FEECD     PIC XX.
               05  D-1FEEAMT    PIC Z(3)9.99  BLANK ZERO.
               05  D-1FOURS     PIC X.
               05  D-2FEECD     PIC XX.
               05  D-2FEEAMT    PIC Z(3)9.99  BLANK ZERO.
               05  D-2FOURS     PIC X.
           03  D-350           PIC Z(5)9.99  BLANK ZERO.
           03  D-351           PIC Z(5)9.99  BLANK ZERO.
           03  D-360           PIC Z(5)9.99  BLANK ZERO.
           03  D-370           PIC 99/99/99  BLANK ZERO.
           03  D-380           PIC Z(5)9.99  BLANK ZERO.
           03  D-381           PIC Z(5)9.99  BLANK ZERO.
           03  D-390           PIC Z(5)9.99  BLANK ZERO.
           03  D-391           PIC Z(5)9.99  BLANK ZERO.

       01  X-BUF               VALUE " ".
           03  X-PPRIN         PIC X(12).
           03  X-ANTIC-DLCK    PIC X(12).
           03  X-PRIN          PIC ZZZ,ZZ9.99.
           03  X-ANTIC         PIC ZZZ,ZZ9.99-.
           03  X-DLCK          PIC $$$,$$9.99-.
           03  X-350           PIC ZZZZZ9.99.
           03  X-351           PIC ZZZZZ9.99.
           03  X-360           PIC ZZZZZ9.99.
           03  X-370           PIC 99/99/99  BLANK ZERO.
           03  X-380           PIC Z(5)9.99  BLANK ZERO.
           03  X-381           PIC Z(5)9.99  BLANK ZERO.
           03  X-390           PIC Z(5)9.99  BLANK ZERO.
           03  X-391           PIC Z(5)9.99  BLANK ZERO.
       01  DEF-BUF              VALUE " ".
           03  DEF-ORGST        PIC XX.
           03  DEF-ORGBR        PIC 9(4).
           03  DEF-PURCD        PIC XXX.
           03  DEF-SRCD         PIC XX.
           03  DEF-UNITPER-CD   PIC X.
           03  DEF-UNITPER-FREQ PIC ZZ9.

       01  DEF-LIST             PIC X(24) VALUE
           "050 051 070 100 140 141.".

       01  FEE-LIST.
           03  FILLER           PIC X(24)  VALUE
           "330 331 332 333 334 335 ".
           03  FILLER           PIC X(29)  VALUE
           "340 3401 3402 3403 3404 3405.".

       01  X-LIST.
           03  FILLER          PIC X(44) VALUE
           "PPRIN:S PDLCK:S PRIN ANTIC DLCK 350 351 360 ".
           03  FILLER          PIC X(20) VALUE
           "370 380 381 390 391.".

       01  DISPLAY-LIST1.
           03  FILLER          PIC X(53)  VALUE
           "LNKEY LCDESC 010 011 012 020 021 022 030 031 032 040 ".
           03  FILLER          PIC X(44)  VALUE
           "041 042 PPRIN:S PDLCK:S PRIN ANTIC DLCK 050 ".
           03  FILLER          PIC X(52)  VALUE
           "051 052 053 060 070 071 080 081 090 091 100 101 110 ".
           03  FILLER          PIC X(13)  VALUE
           "110P 111 112.".
       01  DISPLAY-LIST2.
           03  FILLER          PIC X(4)   VALUE
           "400 ".
           03  FILLER          PIC X(52)  VALUE
           "120 121 130 131 132 140 141 150 160 170 180 190 200 ".
           03  FILLER          PIC X(12)   VALUE
           "201 210 YLD ".
           03  FILLER          PIC X(56)  VALUE
           "220 230 231 240 241 250 251 260 270 271 272 273 274 280 ".
           03  FILLER          PIC X(52)  VALUE
           "281 282 283 284 290 291 292 293 294 300 301 302 303 ".
           03  FILLER          PIC X(52)  VALUE
           "304 310 311 312 313 314 320 321 322 323 324 330 331 ".
           03  FILLER          PIC X(45)  VALUE
           "332 333 334 335 340 3401 3402 3403 3404 3405 ".
           03  FILLER          PIC X(32)  VALUE
           "350 351 360 370 380 381 390 391.".

      ********************************
      *   E L E M E N T   S P E C S  *
      ********************************
       01  MAX             PIC 99  VALUE 40.
       01  SPEC-TABLE.
      * 1  PD-SSNO(1)
           03  FILLER      PIC X(8) VALUE "ERNX110 ".
      * 2  PD-SSNO(2)
           03  FILLER      PIC X(8) VALUE "ERNX110 ".
      * 3  PD-SSNO(3)
           03  FILLER      PIC X(8) VALUE "ERNX110 ".
      * 4  PD-SSNO(4)
           03  FILLER      PIC X(8) VALUE "ERNX110 ".
      * 5  PD-ORGST
           03  FILLER      PIC X(8) VALUE "E  A020 ".
      * 6  PD-LOANDATE
           03  FILLER      PIC X(8) VALUE "ERNM060 ".
      * 7  PD-PURCD
           03  FILLER      PIC X(8) VALUE "E  A030 ".
      * 8  PD-COLLCD
           03  FILLER      PIC X(8) VALUE "E  A020 ".
      * 9  PD-COLLID
           03  FILLER      PIC X(8) VALUE "E  A200 ".
      * 10 PD-SRCD
           03  FILLER      PIC X(8) VALUE "E  A020 ".
      * 11 PD-PRLNNO
           03  FILLER      PIC X(8) VALUE "ENNN060 ".
      * 12 PD-DLNO
           03  FILLER      PIC X(8) VALUE "ENNN042 ".
      * 13 PD-RECOURSE
           03  FILLER      PIC X(8) VALUE "E  A010 ".
      * 14 PD-UNITPER-CD
           03  FILLER      PIC X(8) VALUE "E  A010 ".
      * 15 PD-ORGTERM
           03  FILLER      PIC X(8) VALUE "ENNN030 ".
      * 16 PD-CASHDATE
           03  FILLER      PIC X(8) VALUE "ERNM060 ".
      * 17 PD-INTDATE
           03  FILLER      PIC X(8) VALUE "ERNM060 ".
      * 18 PD-1STPYDATE
           03  FILLER      PIC X(8) VALUE "ERNM060 ".
      * 19 PD-CONRATE
           03  FILLER      PIC X(8) VALUE "ENNN033 ".
      * 20 PD-APRATE
           03  FILLER      PIC X(8) VALUE "ENNN033 ".
      * 21 PD-OVRDRATE
           03  FILLER      PIC X(8) VALUE "ENNN033 ".
      * 22 PD-SELLPR
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 23 PD-DOWNPY
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 24 PD-SERCHG
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 25 PD-INTCHG
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 26 PD-INSURED
           03  FILLER      PIC X(8) VALUE "E  A030 ".
      * 27 PD-INSCOMP(1)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 28 PD-INSCOMP(2)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 29 PD-INSCOMP(3)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 30 PD-INSCOMP(4)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 31 PD-INSCOMP(5)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 32 PD-INSCOMP(6)
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
      * 33 PD-FEECODE(1), (2)
           03  FILLER      PIC X(8) VALUE "E  A020 ".
      * 34 PD-FEECODE(3), (4)
      *    PD-FEECODE(5), (6)
           03  FILLER      PIC X(8) VALUE "E  A020N".
      * 35 PD-1STPYAMT & REGPYAMT
           03  FILLER      PIC X(8) VALUE "ENNN062N".
      * 36 PD-LASTPYAMT
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 37 PD-PURDATE
           03  FILLER      PIC X(8) VALUE "ERNM060 ".
      * 38 PD-RVPRIN/RVCHGS
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 39 PD-PARTIC/DLDISC
           03  FILLER      PIC X(8) VALUE "ENNN062 ".
      * 40 PD-LC-CODE
           03  FILLER      PIC X(8) VALUE "ENNN020 ".
       01  SPEC-TABLE2     REDEFINES SPEC-TABLE.
           03  SPEC-REC    OCCURS 40 TIMES.
               05  SPEC    PIC X(7).
               05  CHFG    PIC X.

      ******************************************************************
      *
      *     C O P Y - L I B R A R Y - W O R K E R S
      *
      ******************************************************************
       COPY "LIBWI/AUTOPCW.CPY".
       COPY "LIBWI/LTCREAW.CPY".
       COPY "LIBCL/BISCANW.CPY".
       COPY "LIBWI/DLSCANW.CPY".
       COPY "LIBLP/LPWKPATH.CPY".
       COPY "LIBGB/CONNECTW_SQL.CPY".
       COPY "LIBGB/FILEWK.CPY".
       COPY "LIBGB/MESSWK.CPY".

       COPY "LIBGB/DATERW.CPY".
       COPY "LIBLP/PURFLDW.CPY".
       COPY "LIBLP/LPUPERW.CPY".
       COPY "LIBLP/UPERTSTW.CPY".
       COPY "LIBGB/TIMEWK.CPY".
       COPY "LIBGB/SYSTEMW.CPY".
       COPY "LIBLP/LPANTIW.CPY".
       COPY "LIBLP/LPAPRZW.CPY".
       COPY "LIBLP/LPMENUW.CPY".
       COPY "LIBLP/LPAMTSW.CPY".
       COPY "LIBCL/FINDLNW.CPY".
       COPY "LIBLP/CALCPVW.CPY".
       COPY "LIBLP/PAYOFXW.CPY".
       COPY "LIBLP/LPEDAYW.CPY".
       COPY "LIBLP/LPICOMMW.CPY".
       COPY "LIBLP/LPDLADJW.CPY".
       COPY "LIBGB/PHON400.CPY".
       COPY "LIBGB/GPENVW.CPY".
       COPY "LIBLP/LPMDTEW.CPY".
       COPY "LIBLP/LPWKCIP.CPY".
       COPY "LIBLP/LPWKCOP.CPY".
       COPY "LIBLP/LPWKCEP.CPY".
       COPY "LIBLP/INSELIGW.CPY".
       COPY "LIBGB/GRWORKW.CPY".
       COPY "LIBWI/LNAPPROVALW.CPY".
       COPY "LIBWI/BUYRTEW.CPY".
       COPY "LIBGB/PASSWDW.CPY".
       78  1STPY30-SEQ               VALUE 0.
       78  APPROVAL-SEQ              VALUE 1.
       78  APPROVAL-SEQ2             VALUE 2.
       78  APR-SEQ                   VALUE 3.
       78  INSCO-SEQ                 VALUE 4.
       78  DLRSV-SEQ                 VALUE 5.
       78  INSCOVR-SEQ               VALUE 6.
       78  NON-BATCH-SEQ             VALUE 7.
       78  NO-CL-SEQ                 VALUE 8.
       78  NO-AH-SEQ                 VALUE 9.
       78  NO-PP-SEQ                 VALUE 10.
       78  NO-O1-SEQ                 VALUE 11.
       78  NO-O2-SEQ                 VALUE 12.
       78  NO-O3-SEQ                 VALUE 13.
       78  F3-RECALL-SEQ             VALUE 14.
       78  0-CREDLIM-SEQ             VALUE 15.
       78  CASHDATE-SEQ              VALUE 16.
       78  SRCD-SEQ                  VALUE 17.
       78  PP-PREM-SEQ               VALUE 18.
       78  DEALER-STATE              VALUE 19.
       78  90-LOANDATE-SEQ           VALUE 20.
       78  ACH-NON-BATCH-SEQ         VALUE 21.
       78  HONOR-1STPAY-30-DAYS-SEQ   VALUE 22.

       COPY "LIBGB/SCREENW.CPY".
       COPY "LIBLP/LONPB_DEF.CPY".
       COPY "LIBLP/LPSMNU_DEF.CPY".
       COPY "LIBLP/LPLNMU_DEF.CPY".
       COPY "LIBLP/LPCAMU_DEF.CPY".
       COPY "LIBLP/LPVDMU_DEF.CPY".
       COPY "LIBWI/GLIMI2_DEF.CPY".
       COPY "LIBWI/GLIMI3_DEF.CPY".
       COPY "LIBWI/PRMIUM_DEF.CPY".
       COPY "LIBWI/RSVENT_DEF.CPY".
       COPY "LIBWI/FEEENT_DEF.CPY".
       COPY "LIBGB/GETENVW.CPY".
       COPY "LIBGB/CONAME_EXT.CPY".
       COPY "LIBLP/LONPB_WKS.CPY".
       COPY "LIBLP/LPSMNU_WKS.CPY".
       COPY "LIBLP/LPLNMU_WKS.CPY".
       COPY "LIBLP/LPCAMU_WKS.CPY".
       COPY "LIBLP/LPVDMU_WKS.CPY".
       COPY "LIBWI/GLIMI2_WKS.CPY".
       COPY "LIBWI/GLIMI3_WKS.CPY".
       COPY "LIBWI/PRMIUM_WKS.CPY".
       COPY "LIBWI/RSVENT_WKS.CPY".
       COPY "LIBWI/FEEENT_WKS.CPY".
       COPY "LIBGB/HELPLINK.CPY".

       COPY "LIBGB/GETFMW.CPY".
       COPY "LIBLP/LPLOANW.CPY".
       COPY "LIBLP/LPPFBUF.CPY".

       SCREEN SECTION.
       COPY "LIBLP/LONPB_SCN.CPY".
       COPY "LIBLP/LPSMNU_SCN.CPY".
       COPY "LIBLP/LPLNMU_SCN.CPY".
       COPY "LIBLP/LPCAMU_SCN.CPY".
       COPY "LIBLP/LPVDMU_SCN.CPY".
       COPY "LIBWI/GLIMI2_SCN.CPY".
       COPY "LIBWI/GLIMI3_SCN.CPY".
       COPY "LIBWI/PRMIUM_SCN.CPY".
       COPY "LIBWI/RSVENT_SCN.CPY".
       COPY "LIBWI/FEEENT_SCN.CPY".

      ******************************************************************
      *
      *     P R O C E D U R E - D I V I S I O N
      *
      ******************************************************************
       PROCEDURE DIVISION
           USING FORM-PATHNAME EXIT-PATHNAME PROG-BUF UPDATE-BUF.
       DECLARATIVES.
       DECLARE-ERROR SECTION.
           USE AFTER ERROR PROCEDURE ON
               WK-FILE.
       COPY "LIBGB/DECLARE.CPY".
           PERFORM CLOSE-SP1-FILE.
           PERFORM CLOSE-PD2-FILE.
           PERFORM CLOSE-PD1-FILE.
           PERFORM CLOSE-PC1-FILE.
           PERFORM CLOSE-LTC1-FILE.
           PERFORM CLOSE-LC1-FILE.
           PERFORM CLOSE-IC1-FILE.
           PERFORM CLOSE-DL1-FILE.
           PERFORM CLOSE-CK1-FILE.
           PERFORM CLOSE-CDB1-FILE.
           PERFORM CLOSE-CD1-FILE.
           PERFORM CLOSE-BW1-FILE.
           PERFORM CLOSE-GI1-FILE.
           PERFORM CLOSE-GR1-FILE.
           PERFORM CLOSE-BR-FILE.
           CLOSE WK-FILE.
       COPY "LIBGB/DECLAR2.CPY".

      ******************************************************************
      *
      *    M A I N - P R O G R A M
      *
      ******************************************************************
       MAIN-PROGRAM SECTION.

           PERFORM SQL-CONNECT.

      D    STOP MESS.
           MOVE FORM-PATHNAME TO FORM-PATH.
           MOVE "LONPB" TO VDU-FORM-NAME.

           PERFORM FORM-RESET.

           MOVE USER-PID TO TEMP-PID.
           MOVE " " TO ERRCD.

           MOVE BRANCH TO BR-NO.
           PERFORM OPEN-BR-FILE.
           PERFORM READ-BR-FILE.
           PERFORM CLOSE-BR-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           PERFORM GET-GPENV.

           PERFORM RESTORE-SCREEN.

           PERFORM CREATE-TRAILER.

           PERFORM OPEN-IC1-FILE.
           PERFORM OPEN-SP1-FILE.
           PERFORM OPEN-CD1-FILE.
           PERFORM OPEN-BW1-FILE.

           IF NEW-FLAG = 1
              PERFORM DISPLAY-FIELDS
              PERFORM TEST-GET-SP
              GO TO ENTER-LOAN.

       MAIN-MODULE.

           MOVE SPACES TO WS-APPROVAL-FG.

           PERFORM FORM-RESET.

           MOVE " " TO MESS
           PERFORM MSG-LINE.

           MOVE " " TO F3-COLLATERAL.

           IF BR-LC-CODE = "Y"
              MOVE " " TO CHFG(40)
              MOVE "40 LC CODE: __" TO LC-INFO-BUF
           ELSE
              MOVE "N" TO CHFG(40)
              MOVE " " TO LC-INFO-BUF.
      *    CALL XFER USING STAT LC-INFO-LIST LC-INFO-BUF.
           MOVE LC-INFO-LIST TO WR-LIST.
           MOVE LC-INFO-BUF  TO WR-BUF.
           PERFORM CALL-WRFORM.

           IF GP-DLR-DISP-TYPE = "C"
              MOVE "COMM" TO DLR-TYP-BUF
           ELSE
              MOVE "DISC" TO DLR-TYP-BUF.
      *    CALL XFER USING STAT DLR-TYP-LIST DLR-TYP-BUF.
           MOVE DLR-TYP-LIST TO WR-LIST.
           MOVE DLR-TYP-BUF  TO WR-BUF.
           PERFORM CALL-WRFORM.

           PERFORM ENTER-KEYS.

           IF IO-TYPE = "CLR"
              GO TO MAIN-MODULE.

           IF IO-TYPE = "END"
              GO TO END-ROUTINE.

      *-----------------------------------------------------------------
       ENTER-LOAN.

           PERFORM ENTRY-MODULE.

           IF IO-TYPE = "END"
              GO TO END-ROUTINE.

           GO TO MAIN-MODULE.

      ******************************************************************
       ENTER-KEYS SECTION.
      ******************************************************************
           MOVE 0 TO NEW-FLAG
                     ELE
                     QUOTE-SOC-SEC.

           MOVE " " TO IO-TYPE
                       FIND-LOANS-FG
                       QUOTE-ID-FG.

      *  THESE FLAGS ARE USED TO TELL D12-PROCESS-PRIOR-LN ROUTINE
      *  TO PERFORM SEND-PURCHASE-FIELDS.
      
      *    REASON:
      *            IF A SAVED RENEWAL LOAN WAS DONE EX. YESTERDAY,
      *               IT WAS CALCULATED USING YESTERDAYS PRIOR LOAN
      *               PAYOFF.
      *            IF THE PRIOR LOAN PAYOFF WAS REVERSED AND REPOSTED
      *               TODAY, THE PAYOFF COOULD BE DIFFERENT. WHEN THE
      *               SAVED RENEWAL LOAN IS RECALLED TODAY, THIS PROGRAM
      *               GETS THE NEW PAYOFF INFORMATION OUT OF THE NEW
      *               PD RECORD AND STORES IT IN THE PD-PR... FIELDS,
      *               HOWEVER THE RECALLED SAVE LOAN NUMBERS ARE BASED
      *               ON YESTERDAYS PD-PR... FIELDS.

           MOVE " " TO VIA-LOAN-SCAN-FG
                       VIA-QUOTE-SCAN-FG.

           PERFORM NEW-RECORD-SETUP.

           MOVE LEGEND-01 TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM LOAN-CLASS-PROMPT.

      *-----------------------------------------------------------------
       ENTER-LC-CODE.

           MOVE "EN N090LNKEY." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "1>"
              GO TO MENU-KEY.

           IF VDUSTATUS = "16"
              PERFORM LOAN-SCAN
              IF IO-FG NOT = 0
                 GO TO ENTER-LC-CODE
              ELSE
                 GO TO VIA-LOAN-SCAN.

           IF VDUSTATUS = "18"
              PERFORM QUOTE-SCAN
              IF IO-FG NOT = 0
                 GO TO ENTER-LC-CODE
              ELSE
                 GO TO VIA-QUOTE-SCAN.

           IF VDUSTATUS = "1<"
              PERFORM CLASS-SCAN
              IF IO-FG NOT = 0
                 GO TO ENTER-LC-CODE.

           IF VDUSTATUS NOT = "00"
              GO TO ENTER-LC-CODE.

           IF VDUNUM0 = 0
            OR VDUNUM0 > 99
              GO TO ENTER-LC-CODE.

           MOVE VDUNUM0 TO LC-CODE.
           PERFORM GET-LC.
           IF IO-FG = 9
              PERFORM NOT-FOUND
              GO TO ENTER-LC-CODE.

           MOVE "S  A000LCDESC." TO VDU.
           MOVE LC-DESC TO VDUBUF.
           PERFORM SCREENIO.

           IF ( LC-SALEFIN NOT = "Y" ) 
              PERFORM INVALID-FOR-SF
              GO TO ENTER-LC-CODE.

           MOVE BRANCH TO GI-BRANCH.
           MOVE LC-CODE TO GI-CLASS.
           PERFORM GET-GI.
           IF IO-FG = 9
              MOVE "G/L INTERFACE RECORD NOT FOUND" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-LC-CODE.

           MOVE LC-CODE     TO PD-CLASS
                               PD-SPRCLASS.
           MOVE LC-SMALLOAN TO PD-SMALLOAN.
           MOVE LC-SALEFIN  TO PD-SALEFIN.
           MOVE LC-SERVACCT TO PD-SERVACCT.
           MOVE LC-LOANTYPE TO PD-LOANTYPE.
           MOVE LC-GIFTNET TO PD-GIFTNET.
           MOVE 1 TO PD-STMT-COUNTER.
           GO TO EXIT-ENTER-KEYS.

      *=================================================================
      *   VIA RECALL #
      *=================================================================
      *RECALL-LOAN.
      *
      *    PERFORM NEW-RECORD-SETUP.
      *
      *    MOVE "F1-LOAN #, F7-MENU" TO MESS.
      *    PERFORM SEND-LEGEND.
      *    MOVE "S  A110KEYTYPE." TO VDU.
      *    MOVE "RECALL SS#:" TO VDUBUF.
      *    PERFORM SCREENIO.
      *    MOVE "EN N090LNKEY." TO VDU.
      *    PERFORM SCREENIO.
      *    IF VDUSTATUS = "10"
      *       GO TO ENTER-KEYS-NO.
      *    IF VDUSTATUS = "12"
      *       GO TO MENU-KEY.
      *    IF VDUSTATUS NOT = "00"
      *       GO TO RECALL-LOAN.
      *    IF VDUNUM0 = 0
      *       GO TO RECALL-LOAN.

       VIA-LOAN-SCAN.

           MOVE "Y" TO VIA-LOAN-SCAN-FG.

           MOVE "L" TO PD-ID.
           MOVE BRANCH TO PD-BRANCH.
           MOVE VDUNUM0 TO PD-SOC-SEC.
           PERFORM OPEN-PD1-FILE.
           PERFORM READ-PD1-FILE.
           PERFORM CLOSE-PD1-FILE.

           IF IO-FG = 9
              PERFORM NOT-FOUND
              MOVE "CLR" TO IO-TYPE
              GO TO EXIT-ENTER-KEYS.

           MOVE "C"     TO PC-ID.
           MOVE BRANCH  TO PC-BRANCH.
           MOVE VDUNUM0 TO PC-SOC-SEC.
           PERFORM OPEN-PC1-FILE.
           PERFORM READ-PC1-FILE.
           PERFORM CLOSE-PC1-FILE.
           IF IO-FG = 0
              MOVE "Y" TO F3-COLLATERAL
              PERFORM RECALL-COLLATERAL.

           PERFORM DISPLAY-FIELDS.
           PERFORM LOAN-CLASS-PROMPT.

           IF ( LC-SALEFIN NOT = "Y" ) 
              PERFORM INVALID-FOR-SF
              MOVE "CLR" TO IO-TYPE
              GO TO EXIT-ENTER-KEYS.

           IF PRIOR-LOAN-NOT-VALID
              PERFORM SEND-PRIOR-MESS.

           IF ERROR-IN-PRIOR-LOAN
              MOVE 0 TO IO-FG
              PERFORM PRIOR-LN-ERROR-MSG.

           MOVE 2 TO NEW-FLAG.
           MOVE "SN N090LNKEY." TO VDU.
           MOVE PD-CLASS TO VDUNUM0.
           PERFORM SCREENIO.
           PERFORM LOAN-CALCULATIONS.
           MOVE TOTAL-REPAY TO HOLD-TOTAL-REPAY.
           MOVE "X"         TO WS-APPROVAL-FG.
           GO TO EXIT-ENTER-KEYS.

       VIA-QUOTE-SCAN.
           MOVE "Y" TO VIA-QUOTE-SCAN-FG.

           PERFORM NEW-RECORD-SETUP.
           MOVE "Q" TO QUOTE-ID-FG.

           PERFORM OPEN-PD1-FILE.

           MOVE BRANCH TO PD2-BRANCH
                          QPD2-WBEG-BRANCH
                          QPD2-WEND-BRANCH.
           MOVE "Q"    TO PD2-ID
                          QPD2-WBEG-ID
                          QPD2-WEND-ID.

      * IF YOU MOVE THE NAME IN, YOU WILL NOT EVER GET THE LAST RECORD FOR
      * SOME REASON, ON AZURE. IF "TOMMY TESTER" IS ONLY QUOTE, YOU CAN
      * SELECT IT IN SCAN WINDOW, BUT THEN GET RECORD NOT FOUND. NOW ADD
      * ANOTHER QUOTE "BETH", YOU CAN PULL UP BETH, BUT NOT TOMMY. YOU GET
      * IO-FG = 9. IF WE MOVE SPACES AND START, YOU WILL GET IT! BIZARRE
      * PROBLEM. SO I ADDED CHECKING THAT THE NAME MATCHES WHAT YOU SELECT.

      *    MOVE PDSCAN-BWNAME TO PD2-BWNAME.

           MOVE SPACES        TO PD2-BWNAME
                                 QPD2-WBEG-BWNAME.
           MOVE ALL "Z"       TO QPD2-WEND-BWNAME.


           PERFORM START-PD2-FILE.
       VIA-QUOTE-SCAN-NEXT.
           PERFORM READ-PD2-FILE-NEXT.
           IF (IO-FG = 9) OR (PD2-ID NOT = "Q") OR
                             (PD2-BRANCH NOT = BRANCH)
              PERFORM NOT-FOUND
              MOVE "CLR" TO IO-TYPE
              GO TO EXIT-VIA-QUOTE-SCAN.

           IF (PD2-BWNAME NOT = PDSCAN-BWNAME)
              GO TO VIA-QUOTE-SCAN-NEXT.

           MOVE PD-SOC-SEC TO QUOTE-SOC-SEC.

           MOVE 2 TO NEW-FLAG.
           MOVE "SN N090LNKEY." TO VDU.
           MOVE PD-CLASS        TO VDUNUM0.
           PERFORM SCREENIO.

           PERFORM GET-SP.
           MOVE PD-DLNO TO DL-DLNO.
           PERFORM GET-DL1.

           PERFORM COMPUTE-PRINCIPLE.
           PERFORM COMPUTE-PAYMENTS.

      * SKIP RESET OF INSURANCE COVERAGE ON INITIAL QUOTE DISPLAY:
      *JTG PERFORM COMPUTE-INS-COVERAGE.

           PERFORM COMPUTE-ANTICTERM.
           PERFORM COMPUTE-PURBAL.
           PERFORM COMPUTE-FINANCE-CHARGE.
           PERFORM SETUP-PURCHASE-FIELDS.
           PERFORM COMPUTE-ANTICIPATED.
      *    IF BR-USE-PARTIC-FLAT-TABLE = "Y"
      *       MOVE PD-DLPARVHELD TO PD-ANTICERN(4).

           PERFORM COMPUTE-DEALER-CHECK.
      *    IF BR-USE-PARTIC-FLAT-TABLE = "Y"
      *      IF DL-USE-PARTIC-FLAT-TABLE = "Y"
      *       MOVE PD-DLPARVHELD TO PD-ANTICERN(4).

           MOVE TRANS-DATE TO PD-PURDATE.

           PERFORM DISPLAY-FIELDS.

           MOVE "S  A330011." TO VDU.
           MOVE PD2-BWNAME TO VDUBUF.
           PERFORM SCREENIO.

           MOVE "S  A010012." TO VDU.
           MOVE PD-MAKERCD(1) TO VDUBUF.
           PERFORM SCREENIO.

           PERFORM LOAN-CLASS-PROMPT.
           IF ( LC-SALEFIN NOT = "Y" ) 
              PERFORM INVALID-FOR-SF
              MOVE "CLR" TO IO-TYPE
              GO TO EXIT-ENTER-KEYS.

           IF PRIOR-LOAN-NOT-VALID
              PERFORM SEND-PRIOR-MESS.

           IF ERROR-IN-PRIOR-LOAN
              MOVE 0 TO IO-FG
              PERFORM PRIOR-LN-ERROR-MSG.


      *-----------------------------------------------------------------
       EXIT-VIA-QUOTE-SCAN.
           PERFORM CLOSE-PD1-FILE.
           GO TO EXIT-ENTER-KEYS.

       MENU-KEY.

           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY LONPB-SCREEN.
           PERFORM MENU-SELECTION.
           MOVE 0 TO ELE.
           PERFORM SAVE-SCREEN.

           IF MENU-FG = 99
              GO TO ENTER-KEYS.

           MOVE "END" TO IO-TYPE.

       EXIT-ENTER-KEYS.
           EXIT.

      ******************************************************************
       BORROWER-CREATE SECTION.
      ******************************************************************
           IF VDUNUM0 = 0 AND PD-SSNO(ELE) NOT = 0
              MOVE PD-SSNO(ELE) TO BWCREA-NO
           ELSE
              MOVE VDUNUM0 TO BWCREA-NO.

           MOVE PD-SSNO(1) TO BWCREA-SSNO(1).
           MOVE PD-SSNO(2) TO BWCREA-SSNO(2).
           MOVE PD-SSNO(3) TO BWCREA-SSNO(3).
           MOVE PD-SSNO(4) TO BWCREA-SSNO(4).
           MOVE BWCREA-NO TO BWCREA-SSNO(ELE).

           MOVE "N"                       TO BWCREA-ALLOW-CHG.
           MOVE TRANS-DATE                TO BWCREA-TRANS-DATE.
           MOVE BRANCH                    TO BWCREA-BRANCH.
           MOVE "WI/BWCREA" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH BWCREA-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF BWCREA-STATUS NOT = "00" OR BWCREA-NO = 0
              MOVE 9 TO IO-FG
              GO TO EXIT-BORROWER-CREATE.

           MOVE BWCREA-NO TO BW-SSNO.
           PERFORM NUMBW-TO-ALPBW.
           MOVE "S  A110  0." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE ALP-BW TO VDUBUF.
           PERFORM SCREENIO.

           MOVE BWCREA-NO TO VDUNUM0.
           MOVE 0 TO IO-FG.
       EXIT-BORROWER-CREATE.
           EXIT.

      ******************************************************************
       BORROWER-SCAN SECTION.
      ******************************************************************
           MOVE 0   TO BWSCAN-NO.
           MOVE "S" TO BWSCAN-SCAN-TYPE.
           MOVE "WI/BWSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH BWSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF BWSCAN-STATUS NOT = "00" OR BWSCAN-NO = 0
               MOVE 9 TO IO-FG
               GO TO EXIT-BORROWER-SCAN.
           MOVE BWSCAN-NO TO BW-SSNO.
           PERFORM NUMBW-TO-ALPBW.
           MOVE "S  A110  0." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE ALP-BW TO VDUBUF.
           PERFORM SCREENIO.
           MOVE 0 TO IO-FG.
           MOVE BWSCAN-NO TO VDUNUM0.

       EXIT-BORROWER-SCAN.
           EXIT.

      ******************************************************************
       D01-FIND-PRIOR-LOANS SECTION.
      ******************************************************************

      * FIND LOANS WITH SSNO(1)
           IF FIND-LOANS-FG = "N"
              GO TO D01-EXIT.

           MOVE PD-SSNO(1) TO FIND-SSNO.
           MOVE TRANS-DATE TO FIND-TRANS-DATE.
           MOVE PD-GIFTNET TO FIND-GIFTNET.
      * FIND ALL LOANS WITH THIS SSNO:
           MOVE "CL/FINDLN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH FINDLN-WORKERS.
           CANCEL FORM-PROGX.
           MOVE 1 TO SUB.

           MOVE "SN N060110." TO VDU.
           MOVE FOUND-NUMBER(SUB) TO VDUNUM0.
           PERFORM SCREENIO.

       D01-EXIT.
           EXIT.

      ******************************************************************
       BWLN-SCAN SECTION.
      ******************************************************************
           MOVE TRANS-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-ALPDATE.
           IF PD-SSNO(2) NOT = 0
              GO TO BWLN-SCAN-LNSCAN.

           MOVE PD-SSNO(1) TO LNSCN2-KEY.
           MOVE ALP-DATE   TO LNSCN2-SYSDATE.
           MOVE "WI/LNSCN2 " TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH LNSCN2-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.

           IF LNSCN2-STATUS NOT = "00" OR LNSCN2-ACCTNO = 0
              MOVE 9 TO IO-FG
              GO TO EXIT-BWLN-SCAN.

           MOVE "SN N060110." TO VDU.
           MOVE LNSCN2-ACCTNO TO VDUNUM0.
           PERFORM SCREENIO.
           MOVE 0 TO IO-FG.

           GO TO EXIT-BWLN-SCAN.

       BWLN-SCAN-LNSCAN.
           MOVE 0 TO LNSCAN-NO.
           MOVE PD-SSNO(1) TO LNSCAN-SSNO(1).
           MOVE PD-SSNO(2) TO LNSCAN-SSNO(2).
           MOVE PD-SSNO(3) TO LNSCAN-SSNO(3).
           MOVE PD-SSNO(4) TO LNSCAN-SSNO(4).
           MOVE ALP-DATE   TO LNSCAN-SYSDATE.
           MOVE "WI/LNSCAN " TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH LNSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF LNSCAN-STATUS NOT = "00" OR LNSCAN-NO = 0
              MOVE 9 TO IO-FG
              GO TO EXIT-BWLN-SCAN.

           MOVE "SN N060110." TO VDU.
           MOVE LNSCAN-NO TO VDUNUM0.
           PERFORM SCREENIO.
           MOVE LNSCAN-NO TO VDUNUM0.
           MOVE 0 TO IO-FG.

       EXIT-BWLN-SCAN.
           EXIT.

      ******************************************************************
       FEECODE-SCAN SECTION.
      ******************************************************************
           MOVE "GC"   TO CDBSCN-TYPE.
           MOVE BRANCH TO CDBSCN-BRANCH.
           MOVE SPACES TO CDBSCN-CODE.

           MOVE "WI/CDBSCN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CDBSCN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF ( CDBSCN-STATUS    NOT = "00"    ) OR
              ((CDBSCN-TYPE = "GC") AND (CDBSCN-CODE = SPACES ))
              MOVE 9 TO IO-FG
              GO TO EXIT-FEECODE-SCAN.

           IF CDCODE-FEE-FG = 2
              MOVE "S  A020  0." TO VDU
              MOVE FW-ELE TO VDUROW
              MOVE CDBSCN-CODE TO VDUBUF
              PERFORM SCREENIO.

           MOVE CDBSCN-CODE TO VDUBUF.
           MOVE 0 TO IO-FG.

       EXIT-FEECODE-SCAN.
           EXIT.

      ******************************************************
       CODE-SCAN SECTION.
      ******************************************************

           MOVE SPACES TO CDSCAN-CODE.
           IF ELE = 7
              MOVE "PU"   TO CDSCAN-TYPE
           ELSE
           IF ELE = 8
              MOVE "CO"   TO CDSCAN-TYPE
           ELSE
           IF ELE = 10
              MOVE "SR"   TO CDSCAN-TYPE
           ELSE
              PERFORM FEECODE-SCAN
              GO TO EXIT-CODE-SCAN.

           MOVE "WI/CDSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CDSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF ( CDSCAN-STATUS    NOT = "00"    ) OR
              ((CDSCAN-TYPE  = "PU") AND (CDSCAN-CODE  = SPACES )) OR
              ((CDSCAN-TYPE  = "CO") AND (CDSCAN-CODE  = SPACES )) OR
              ((CDSCAN-TYPE  = "SR") AND (CDSCAN-CODE  = SPACES ))
               MOVE 9 TO IO-FG
               GO TO EXIT-CODE-SCAN.

           MOVE "S  A030  0." TO VDU.
           MOVE ELE           TO VDUROW.
           MOVE CDSCAN-CODE   TO VDUBUF.
           PERFORM SCREENIO.

           MOVE CDSCAN-CODE TO VDUBUF.
           MOVE 0 TO IO-FG.

       EXIT-CODE-SCAN.
           EXIT.

      ******************************************************
       QUOTE-SCAN SECTION.
      ******************************************************
           MOVE "Q"    TO PDSCAN-ID.
           MOVE BRANCH TO PDSCAN-BRANCH.
           MOVE SPACES TO PDSCAN-VERIFY.
           MOVE "Y"    TO PDSCAN-SALEFIN.
           MOVE SPACES TO PDSCAN-BWNAME.

           MOVE "WI/PDSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PDSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF PDSCAN-STATUS NOT = "00" OR PDSCAN-BWNAME = SPACES
               MOVE 9 TO IO-FG
            ELSE
               MOVE 0 TO IO-FG.

       EXIT-QUOTE-SCAN.
           EXIT.

      ******************************************************
       LOAN-SCAN SECTION.
      ******************************************************
           MOVE "S"    TO PDSCAN-ID.
           MOVE BRANCH TO PDSCAN-BRANCH.
           MOVE " "    TO PDSCAN-VERIFY.
           MOVE "Y"    TO PDSCAN-SALEFIN.
           MOVE " "    TO PDSCAN-SERVACCT.
           MOVE 0      TO PDSCAN-NO.
           MOVE "WI/PDSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PDSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF PDSCAN-STATUS NOT = "00" OR PDSCAN-NO = 0
               MOVE 9 TO IO-FG
               GO TO EXIT-LOAN-SCAN.

           MOVE "SN N090LNKEY." TO VDU.
           MOVE PDSCAN-NO TO VDUNUM0.
           PERFORM SCREENIO.
           MOVE 0 TO IO-FG.

       EXIT-LOAN-SCAN.
           EXIT.

      ******************************************************
       CLASS-SCAN SECTION.
      ******************************************************
           MOVE 0      TO LCSCAN-KEY.
           MOVE SPACES TO LCSCAN-VERIFY.
           MOVE "Y" TO LCSCAN-SALEFIN.
           MOVE "WI/LCSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH LCSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF LCSCAN-STATUS NOT = "00" OR LCSCAN-KEY = 0
               MOVE 9 TO IO-FG
               GO TO EXIT-CLASS-SCAN.
           MOVE "SN N090LNKEY." TO VDU.
           MOVE LCSCAN-KEY TO VDUNUM0.
           PERFORM SCREENIO.
           MOVE LCSCAN-KEY TO VDUNUM0.
           MOVE 0 TO IO-FG.

       EXIT-CLASS-SCAN.
           EXIT.

      ******************************************************
       DEALER-SCAN SECTION.
      ******************************************************
           MOVE 0 TO DLSCAN-NUM.
           MOVE "WI/DLSCAN " TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH DLSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF DLSCAN-STATUS NOT = "00" OR DLSCAN-NUM = " "
               MOVE 9 TO IO-FG
               GO TO EXIT-DEALER-SCAN.
           MOVE "SN N042120." TO VDU.
           MOVE DLSCAN-DLNO TO VDUNUM2.
           PERFORM SCREENIO.
           MOVE DLSCAN-DLNO TO VDUNUM2.
           MOVE 0 TO IO-FG.

       EXIT-DEALER-SCAN.
           EXIT.

      ******************************************************************
      *
      *    E N T R Y - M O D U L E
      *
      *    NEW-FLAG = 0 - MODIFY EXISTING RECORD
      *               1 - INITIAL NEW RECORD ENTRY
      *               2 - MODIFY NEW RECORD
      *
      ******************************************************************
       ENTRY-MODULE SECTION.

       BEGIN-ENTRY-MODULE.

           MOVE "S  A000MSEL." TO VDU.
           PERFORM SCREENIO.
           MOVE " " TO IO-TYPE.
           MOVE 1 TO ONE.
           MOVE FIRST-ELE TO ELE.
           MOVE 0 TO FIRST-ELE.

      *-----------------------------------------------------------------
       CREATE-ROUTINE.

           IF NEW-FLAG NOT = 1
              GO TO MODIFY-ROUTINE.

      *  NORMALLY A PERFORM OF COPY MEMBER:  SETCTBL
      *  WOULD BE DONE TO DETERMINE WHICH TABLE WOULD
      *  BE VIEW, BUT SINCE THIS IS FOR SALES FINANCE
      *  PAPER TABLE 2 SHOULD BE EMPTY. REMEMBER TABLE 2
      *  WAS SETUP FOR USE ON GEORGIA GILA LOANS.
           IF SP-FORCE-ENTRY-OVRDRATE(1)
              MOVE " " TO CHFG(21)
           ELSE
              MOVE "N" TO CHFG(21).

           MOVE "N" TO CHFG(35) CHFG(36).

           IF PD-SERVACCT = "Y"
              MOVE "N" TO STAT
            ELSE
              MOVE " " TO STAT.

           MOVE STAT TO CHFG(38) CHFG(39).
      *    IF BR-USE-PARTIC-FLAT-TABLE = "Y"
      *       IF DL-USE-PARTIC-FLAT-TABLE = "Y"
      *         MOVE "N" TO CHFG(39).

           ADD ONE TO ELE.

           IF ELE < 1
              MOVE 1 TO ELE
                        ONE.

           IF ELE NOT > MAX
              IF PD-PURDATE NOT = 0
                 PERFORM SEND-PURCHASE-FIELDS
                 GO TO ENTER-ELE
              ELSE
                 GO TO ENTER-ELE.

           MOVE 2 TO NEW-FLAG.
           MOVE 0 TO ELE.
           PERFORM SEND-PURCHASE-FIELDS.

      *-----------------------------------------------------------------
       MODIFY-ROUTINE.
           MOVE " " TO CHFG(16) CHFG(18) CHFG(20)
                       CHFG(21) CHFG(35) CHFG(36).

           IF GP-USE-CONRATE = "Y"
              MOVE " " TO CHFG(19)
              MOVE "N" TO CHFG(20)
           ELSE
              MOVE "N" TO CHFG(19).

           MOVE "N" TO CHFG(33).

           IF PD-SERVACCT = "N"
              MOVE " " TO CHFG(38) CHFG(39)
           ELSE
              MOVE "N" TO CHFG(38) CHFG(39).

      *    IF BR-USE-PARTIC-FLAT-TABLE = "Y"
      *      IF DL-USE-PARTIC-FLAT-TABLE = "Y"
      *         MOVE "N" TO CHFG(39).

      * ANY FIELD 1-10 EXCEPT FIELD 5 - SKIP THE CALCULATIONS
           IF ELE < 11
              IF ELE = 5
                 NEXT SENTENCE
              ELSE
                 GO TO BYPASS-CALCULATIONS.

           IF ELE = 13 OR 18
              GO TO BYPASS-CALCULATIONS.

           IF ELE = 33 OR 40
              GO TO BYPASS-CALCULATIONS.

           PERFORM COMPUTE-PRINCIPLE.
           PERFORM COMPUTE-PAYMENTS.

           IF ELE = 15 OR 17 OR 22 OR 23 OR 24 OR 25 OR
                    PREM-CHANGE = "Y"
              PERFORM COMPUTE-INS-COVERAGE.

           IF ELE = 15 OR 17
              PERFORM COMPUTE-INS-TERM.

           PERFORM COMPUTE-ANTICTERM.
           PERFORM COMPUTE-PURBAL.
           PERFORM COMPUTE-FINANCE-CHARGE.

      *    IF NOT (ELE = 37 OR = 38 OR = 39)
      *       PERFORM SETUP-PURCHASE-FIELDS.

           PERFORM SETUP-PURCHASE-FIELDS.
           PERFORM COMPUTE-ANTICIPATED.
      *    IF BR-USE-PARTIC-FLAT-TABLE = "Y"
      *       MOVE PD-DLPARVHELD TO PD-ANTICERN(4).
           PERFORM COMPUTE-DEALER-CHECK.
      *    IF BR-USE-PARTIC-FLAT-TABLE = "Y"
      *       IF DL-USE-PARTIC-FLAT-TABLE = "Y"
      *          MOVE PD-DLPARVHELD TO PD-ANTICERN(4).
           PERFORM SEND-X-LIST.

      *-----------------------------------------------------------------
       BYPASS-CALCULATIONS.
      * PLEASE LEAVE THIS HERE, ON A SAVED LOAN RECALL, IT SKIPS ALL THE
      * OTHER CALCULATIONS AND COMES HERE, THIS MUST TAKE PLACE
      *    IF BR-USE-PARTIC-FLAT-TABLE = "Y"
      *       IF DL-USE-PARTIC-FLAT-TABLE = "Y"
      *         MOVE PD-DLPARVHELD TO PD-ANTICERN(4).
           PERFORM CALCULATE-APR.
           PERFORM CALC-YIELD.

           IF ( PD-ID NOT = "L" ) OR ( WS-APPROVAL-FG = SPACES )
              IF ( DL-PARVPAID-FRMLA    =  3  ) OR
                 ( DL-PARVPAID-FRMLA-IB = "3" )
                 MOVE LEGEND-UPDATE-1-BUY TO MESS
              ELSE
                 MOVE LEGEND-UPDATE-1     TO MESS
              END-IF
           ELSE
              IF ( DL-PARVPAID-FRMLA    =  3  ) OR
                 ( DL-PARVPAID-FRMLA-IB = "3" )
                 MOVE LEGEND-UPDATE-2-BUY TO MESS
              ELSE
                 MOVE LEGEND-UPDATE-2     TO MESS.

           PERFORM SEND-LEGEND.
           MOVE "R RA060SEL." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "10"
              MOVE "CLR" TO IO-TYPE
              GO TO END-ENTRY-MODULE.

      * FOR F3 - APPROVAL OF A LOAN
           IF ( VDUSTATUS = "16" )
              IF ( PD-ID = "L" ) AND ( WS-APPROVAL-FG NOT = SPACES )
                 PERFORM APPROVAL-LIMIT-WINDOW
                 MOVE "LONPB" TO VDU-FORM-NAME
                 IF ( WS-APPROVAL-FG = "S" )
                    MOVE "00"     TO VDUSTATUS
                    MOVE "     S" TO VDUBUF
                 ELSE
                 IF ( WS-APPROVAL-FG = "X" )
                    GO TO MODIFY-ROUTINE
                 ELSE
                    GO TO MODIFY-ROUTINE
              ELSE
                 GO TO MODIFY-ROUTINE.

           IF VDUSTATUS = "18"
              PERFORM MEMO-ENTRY
              GO TO MODIFY-ROUTINE.

      * FOR F5 - BUYRATE WINDOW
      
           IF ( VDUSTATUS = "1:" )
              IF ( DL-PARVPAID-FRMLA    =  3  ) OR
                 ( DL-PARVPAID-FRMLA-IB = "3" )
                 PERFORM BUYRATE-WINDOW
                 PERFORM SEND-PURCHASE-FIELDS
                 GO TO MODIFY-ROUTINE.

           IF VDUSTATUS NOT = "00"
              GO TO MODIFY-ROUTINE.

           MOVE VDUBUF TO ACTION.


           IF ACTION = "     S"
                      OR "     U"
              IF QUOTE-ID-FG = "Q"
                 IF PD-SSNO(1) = QUOTE-SOC-SEC
                    MOVE "YOU MUST ESTABLISH A BORROWER ON THE QUOTE"
                                                           TO MESS
                    PERFORM SEND-MESS
                    GO TO MODIFY-ROUTINE.

           IF ACTION = "DELETE"
              IF QUOTE-ID-FG = "Q"
                 IF PD-SSNO(1) = QUOTE-SOC-SEC
                    MOVE "USE THE SALES FINANCE QUOTER TO DELETE!"
                                                           TO MESS
                    PERFORM SEND-MESS
                    GO TO MODIFY-ROUTINE.

           IF ACTION = "DELETE"
              PERFORM DELETE-SCRATCH
              MOVE "CLR" TO IO-TYPE
              GO TO END-ENTRY-MODULE.

           IF NOT ( ACTION = "     U"  OR "     S" )
              GO TO BYPASS-UPDATE.

           IF PRIOR-LOAN-NOT-VALID
              PERFORM SEND-PRIOR-MESS
              GO TO MODIFY-ROUTINE.

      * SAVE LOAN.

           IF ( ACTION = "     S" )
              PERFORM CALL-SFVERI
              IF ( ERRORS-EXIST = "Y" )
                 GO TO BEGIN-ENTRY-MODULE
              ELSE
                 PERFORM WRITE-SCRATCH
                 IF ( QUOTE-ID-FG = "Q" )
                    PERFORM DELETE-QUOTE
                    MOVE "CLR" TO IO-TYPE
                    GO TO END-ENTRY-MODULE
                 ELSE
                    MOVE "CLR" TO IO-TYPE
                    GO TO END-ENTRY-MODULE.

           IF NOT ( ACTION = "     U" )
              GO TO BYPASS-UPDATE.

      *********************************************************

      * ONLY HERE IF YOU SAID "U" TO UPDATE

           PERFORM D13-SP-EDT-TABLE-LOOKUP.
           IF PASSED-EDITS-FLAG NOT = "Y"
              GO TO MODIFY-ROUTINE.

      * CHECK IF PRIMARY BORROWER MEETS MINIMUM CREDIT SCORE

           IF BR-CREDIT-SCORING-FG NOT = "Y"
              GO TO SKIP-SCORE-CHECK.

           MOVE PD-SSNO(1) TO BW-SSNO.
           PERFORM GET-BW1.
           IF BW-ERROR-YES
              MOVE 0 TO BW-CREDIT-SCORE.
           IF BW-CREDIT-SCORE < SP-MIN-CREDIT-SCORE
              IF BW-CREDIT-SCORE < PD-MIN-CRED-SCORE
                 IF ( PD-MIN-CRED-SCORE = 9999 )
                    MOVE MSG-SCORE-NEED-APPROVAL-04 TO MESS
                    PERFORM SEND-MESS
                    MOVE BW-CREDIT-SCORE TO MSG-BW-SCORE2
                    MOVE SP-MIN-CREDIT-SCORE TO MSG-SP-SCORE
                    MOVE MSG-SCORE-NEED-APPROVAL-05 TO MESS
                    PERFORM SEND-MESS
                    MOVE MSG-SCORE-NEED-APPROVAL-03 TO MESS
                    PERFORM SEND-MESS
                    GO TO MODIFY-ROUTINE
                 ELSE
                    MOVE MSG-SCORE-NEED-APPROVAL-01 TO MESS
                    PERFORM SEND-MESS
                    MOVE BW-CREDIT-SCORE TO MSG-BW-SCORE
                    MOVE PD-MIN-CRED-SCORE TO MSG-PD-SCORE
                    MOVE MSG-SCORE-NEED-APPROVAL-02 TO MESS
                    PERFORM SEND-MESS
                    MOVE MSG-SCORE-NEED-APPROVAL-03 TO MESS
                    PERFORM SEND-MESS
                    GO TO MODIFY-ROUTINE.


       SKIP-SCORE-CHECK.

           MOVE PD-DLNO TO DL-DLNO.
           PERFORM GET-DL1.
           IF DL-STATE NOT = PD-ORGST
              MOVE DEALER-STATE TO PASSWDW-SEQ
              MOVE "TO ALLOW DIFFERENT DLR STATE:" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "DEALER STATE MUST MATCH ORIG STATE" TO MESS
                 PERFORM SEND-MESS
                 GO TO MODIFY-ROUTINE.

            MOVE " " TO ERRORS-EXIST.

            PERFORM SAVE-SCREEN.

            MOVE "CL/SFVERI" TO FORM-NAM.
            MOVE "LONPB0" TO LPLOAN-CALLED-FROM.
            CALL FORM-PROGX USING FORM-PATH ERRORS-EXIST
                                           ACTION
                                           PROG-BUF.
            CANCEL FORM-PROGX.

            IF ERRORS-EXIST = "Y"
               GO TO BEGIN-ENTRY-MODULE.

      * STOPPED INSURANCE ADJUSTMENTS ON SERVICE ACCOUNTS: JTG 080197
            IF PD-SERVACCT NOT = "Y"
               IF BR-CALC-INS-ADJ = "Y"
                  PERFORM GET-LPDLADJ
                  IF IO-FG = "N"
                     GO TO MODIFY-ROUTINE.

           MOVE 0 TO SUB BISCAN-CALL-CODE
           PERFORM DUAL-CHECK 4 TIMES

           IF ( IO-TYPE = "RTN" )
              MOVE SPACES TO IO-TYPE
              GO TO MODIFY-ROUTINE.

           PERFORM TEST-ALLOT-LBOX.
           IF IO-TYPE = "RTN"
              MOVE " " TO IO-TYPE
              GO TO MODIFY-ROUTINE.

           PERFORM HI-CREDIT-ENTRY.

           IF IO-TYPE = "RTN"
              MOVE " " TO IO-TYPE
              GO TO MODIFY-ROUTINE.

           PERFORM ENTER-DEALER-CHECK-PAYCODE.

           IF IO-TYPE = "RTN"
              MOVE " " TO IO-TYPE
              IF BR-CALC-INS-ADJ = "Y"
                 MOVE 0 TO PD-INSPREM-DLADJ
                 SUBTRACT DLADJ-INSADJ-OURS FROM PD-PROCEEDS
                 PERFORM RESTORE-INPUTED-INS VARYING DLADJ FROM 1 BY 1
                        UNTIL DLADJ > 4
                 GO TO MODIFY-ROUTINE
              ELSE
                 GO TO MODIFY-ROUTINE.

      *  N O T E:   THIS TEST MUST BE DONE, SUCH THAT NO OTHER OPERATOR INPUT
      *             WILL OCCUR BEFORE DOING UPDATE OF THE LOAN (LONPB2.C)
      *
      *    WHEN RENEWAL, CHECK IF RENEWED AMOUNT HAS CHANGED EX. OPERATOR
      *    REVERSED PAYOFF AND POSTED MONEY AND RE-POSTED RENEWAL PAYOFF
      *    FROM ANOTHER SCREEN                    WORLD #286
      
           IF ACTION = "     U"
              IF NOT QUOTE-ONLY
                 IF PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
                    PERFORM VERIFY-LOAN-RN-PAYOFF
                    IF LOAN-RN-PAYOFF-PROBLEM = "Y"
      * 5/19/04 BAH
                       MOVE "SCRATCH PAD RENEWAL INVALID" TO MESS
                       PERFORM SEND-MESS
                       GO TO MODIFY-ROUTINE.

      *CS 03/26/08 ADDED MOVE PD-REC TO SAVE-PD-REC. PR#623
           IF ACTION = "     U"
              IF VIA-LOAN-SCAN-FG = "Y"
                 MOVE PD-REC TO SAVE-PD-REC
                 MOVE PD-SSNO(1) TO SAVE-SSNO
                 PERFORM SET-SCRATCH-KEY
                 PERFORM OPEN-PD1-FILE
                 PERFORM READ-PD1-FILE
                 PERFORM CLOSE-PD1-FILE
                 IF IO-FG = 9
                    MOVE "SAVED LOAN ALREADY UPDATED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "CLR" TO IO-TYPE
                    GO TO END-ENTRY-MODULE
                 ELSE
                    MOVE SAVE-PD-REC TO PD-REC.

           PERFORM SAVE-SCREEN.
           MOVE MENU-PROG-FORM(2) TO NEW-PROG-FORM.
           MOVE "2" TO NEW-PROG-SUB.
           MOVE "P" TO     ERRCD.
           MOVE "END" TO IO-TYPE.
           PERFORM DELETE-SCRATCH.

           IF QUOTE-ID-FG = "Q"
              PERFORM DELETE-QUOTE.

           GO TO END-ENTRY-MODULE.

      *-----------------------------------------------------------------
       BYPASS-UPDATE.

           INSPECT ACTION REPLACING ALL " " BY "0".

           IF CHNO NOT NUMERIC
              GO TO MODIFY-ROUTINE.

           IF CHNO = 0
              GO TO MODIFY-ROUTINE.

           IF CHNO > MAX
              GO TO MODIFY-ROUTINE.

           MOVE CHNO TO ELE.

           IF VIA-LOAN-SCAN-FG = "Y"
              IF CHFG(ELE) NOT = "N" OR ELE = 33
                 MOVE F3-RECALL-SEQ TO PASSWDW-SEQ
                 MOVE "TO MODIFY RECALLED LOAN :" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE 0 TO ELE
                    GO TO MODIFY-ROUTINE.

           IF ELE = 36
              GO TO MODIFY-ROUTINE.

      * OVERRIDE CALCULATED APR RATE
           IF ELE = 20
              IF APR-OK = "N"
                 MOVE APR-SEQ TO PASSWDW-SEQ
                 MOVE "TO OVERRIDE APR RATE.......:" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "N" TO APR-OK
                    GO TO MODIFY-ROUTINE
                 ELSE
                    MOVE "Y" TO APR-OK.

      * CASH DATE
           IF ELE = 18
              MOVE CASHDATE-SEQ TO PASSWDW-SEQ
              MOVE "TO ENTER A CASHDATE:" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO MODIFY-ROUTINE.

      * CREDIT LIFE
           IF ELE = 27
              IF CHFG(ELE) NOT = "N"
                 MOVE NO-CL-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE CREDIT LIFE :" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO MODIFY-ROUTINE.

      * A&H
           IF ELE = 28
              IF CHFG(ELE) NOT = "N"
                 MOVE NO-AH-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE A&H :" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO MODIFY-ROUTINE.

      * PROPERTY
           IF ELE = 29
              IF CHFG(ELE) NOT = "N"
                 MOVE NO-PP-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE PROPERTY :" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO MODIFY-ROUTINE.

      * OTHER 1
           IF ELE = 30
              IF CHFG(ELE) NOT = "N"
                 MOVE NO-O1-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE OTHER 1 :" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO MODIFY-ROUTINE.

      * OTHER 2
           IF ELE = 31
              IF CHFG(ELE) NOT = "N"
                 MOVE NO-O2-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE OTHER 2 :" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO MODIFY-ROUTINE.

      * OTHER 3
           IF ELE = 32
              IF CHFG(ELE) NOT = "N"
                 MOVE NO-O3-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE OTHER 3 :" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO MODIFY-ROUTINE.

      *-----------------------------------------------------------------
       ENTER-ELE.

           IF NEW-FLAG NOT = 1
              IF ELE = 2 OR 3 OR 4
                 IF PD-SSNO(1) = 0
                    MOVE "MUST ENTER PRIMARY MAKER FIRST!" TO MESS
                    PERFORM SEND-MESS
                    GO TO CREATE-ROUTINE.

           IF ELE = 5
              IF NEW-FLAG NOT = 1
                 GO TO MODIFY-ROUTINE
              ELSE
                 IF CHFG(5) = "N"
                    GO TO F-052.

           IF ELE = 7
              IF CHFG(7) = "N"
                 MOVE " " TO CHFG(7)
                 GO TO CREATE-ROUTINE.

           IF ELE = 10
              IF CHFG(10) = "N"
                 MOVE " " TO CHFG(10)
                 GO TO CREATE-ROUTINE.

           IF ELE = 14
              IF NEW-FLAG = 1
                 IF BR-UNITPER-FG NOT = "Y"
                    PERFORM SEND-1STPYDATE
                    GO TO CREATE-ROUTINE
                 ELSE
                    IF CHFG(14) = "N"
                       MOVE " " TO CHFG(14)
                       MOVE BR-DEFAULT-SF-UNITPER-CD TO VDUBUF
                       GO TO GOTO-FIELD
                    ELSE
                       NEXT SENTENCE
              ELSE
                 IF BR-UNITPER-FG NOT = "Y"
                         OR PD-ORGTERM = 1
                    GO TO CREATE-ROUTINE.

           IF ELE = 24
              IF SP-SCFRMLA = 0 AND SP-MFFRMLA = 0
                 GO TO CREATE-ROUTINE.

           MOVE
           "F1, ENTER NEW SSNO & PRESS F5-CREATE, F6-SCAN, ENTER SSNO#:"
                TO MESS.

           IF ( ELE < 5 )
              PERFORM SEND-LEGEND.

           IF ELE = 5
              MOVE "F1-CLEAR, ENTER ORIGINATING STATE/BRANCH:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 6
              MOVE "F1-CLEAR, ENTER LOAN DATE:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 7
              MOVE
              "F1-CLEAR, F6-PURPOSE SCAN, ENTER PURPOSE CODE:"
                                                          TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 8
              MOVE
              "F1-CLEAR, F6-COLLATERAL SCAN, ENTER COLLATERAL CODE:"
                                                            TO MESS
              PERFORM SEND-LEGEND.

      * IF EXPANDED COLLATERAL OPTION = "Y"
      *     AND ( AUTO-COLLID = "AU","AC","AL","RP","HP" OR "AW")
      *           OR LA-REC WITH COLLATERAL EXISTS)
      *  THEN OPEN COLLATERAL WINDOW.

           IF ELE = 09
              MOVE VDUSTATUS TO W-VDUSTATUS
              IF BR-TRAILER-REC = "Y"
                 MOVE PD-COLLCD TO TEST-COLLCD
                 IF AUTO-COLLCD
                    MOVE " " TO MESS
                    MOVE WK-HHGS-1 TO INSPECT-X
                    PERFORM COLLATERAL-CREATE
                    PERFORM RESTORE-TRAILER-REC
                 ELSE
                 MOVE
                 "F1-CLEAR, ENTER COLLATERAL ID, F3-EXPANDED COLLATERAL"
                    TO MESS
                    PERFORM SEND-LEGEND
                    MOVE W-VDUSTATUS TO VDUSTATUS
              ELSE
                 MOVE "F1-CLEAR, ENTER COLLATERAL ID:" TO MESS
                 PERFORM SEND-LEGEND
                 MOVE W-VDUSTATUS TO VDUSTATUS.

           IF ELE = 10
              MOVE
              "F1-CLEAR, F6-SOURCE SCAN, ENTER SOURCE CODE:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 11
              IF PD-PRLNNO NOT = 0
                 MOVE "N" TO FIND-LOANS-FG.

           IF ELE = 11
              IF (NOT (PD-SRCD = "PB" OR "RN" OR "RB" OR "RO"))
                            AND GP-STOP-ON-PRIOR-FG = "N"
                 GO TO CREATE-ROUTINE
              ELSE
                PERFORM D01-FIND-PRIOR-LOANS
                IF PD-SRCD = "PB" OR "RN" OR "RB" OR "RO"
                   MOVE " " TO CHFG(11)
                   MOVE
                   "F1, F5-PAYOFF, F6-SCAN, ENTER LOAN NO. RENEWED:"
                                                            TO MESS
                   PERFORM SEND-LEGEND
                ELSE
                   IF QUOTE-ONLY
                      MOVE "N" TO CHFG(11)
                   ELSE
                      MOVE
            "F1, F6-SCAN, ENTER A PRIOR LOAN NO. FOR REFERENCE ONLY:"
                                                            TO MESS
                      PERFORM SEND-LEGEND.

           IF ELE = 12
              MOVE " " TO CHFG(11)
              MOVE "F1-CLEAR, F6-DEALER SCAN, ENTER DEALER NO:"
                                                           TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 13
              IF PD-SERVACCT = "Y"
                 IF NEW-FLAG NOT = 1
                    GO TO MODIFY-ROUTINE
                 ELSE
                    GO TO CREATE-ROUTINE
              ELSE
                 MOVE "F1-CLEAR, ENTER RECOURSE CODE (F,P,N):" TO MESS
                 PERFORM SEND-LEGEND.

           IF ELE = 14
              MOVE "F1-CLEAR, ENTER PAYMENT PERIOD:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 15
              MOVE "F1-CLEAR, ENTER TERM OF LOAN:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 16
              MOVE "F1-CLEAR, ENTER INTEREST START DATE:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 17
              MOVE "F1-CLEAR, ENTER FIRST PAYMENT DATE:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 18
              MOVE "F1-CLEAR, ENTER SAME AS CASH DATE:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 20
              MOVE "F1-CLEAR, ENTER ANNUAL PERCENTAGE RATE:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 22
              MOVE " " TO CHFG(11)
      *JGW    IF (PD-SRCD = "RN" OR "RB" OR "RO") AND (NEW-FLAG = 1)
              IF (PD-SRCD = "RN")
                 MOVE "N" TO CHFG(22) CHFG(23)
              ELSE
                 MOVE " " TO CHFG(22) CHFG(23)
                 MOVE "F1-CLEAR, ENTER THE SELLING PRICE:" TO MESS
                 PERFORM SEND-LEGEND.

           IF ELE = 23
              MOVE "F1-CLEAR, ENTER THE DOWN PAYMENT:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 24
              MOVE
              "F1-CLEAR, ENTER THE SERVICE CHARGE (LOAN FEE):"
                                                          TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 25
              MOVE "F1-CLEAR, ENTER THE INTEREST CHARGE:" TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 26
              IF GP-ENTER-LPO-FG NOT = "Y"
                 MOVE "F1-CLEAR, ENTER INSURANCE CODES (EX. MCC):"
                       TO MESS
                 PERFORM SEND-LEGEND
              ELSE
                MOVE "F1-CLEAR,F3-LPO, ENTER INSURANCE CODES (EX. MCC):"
                       TO MESS
                 PERFORM SEND-LEGEND
                 IF (VDUSTATUS = "16")
      * FIRST TIME IN, DEFAULT TO DL-LPO, OTHERWISE, KEEP THE ONE THEY
      * MAY HAVE ENTERED...PR# 31
                    IF PD-LPO = SPACES
                       MOVE PD-DLNO TO DL-DLNO
                       PERFORM GET-DL1
                       MOVE DL-LPO TO WINDOW-LPO
                    ELSE
                       MOVE PD-LPO TO WINDOW-LPO
                    END-IF
                    MOVE PD-REP-CD TO WINDOW-REP
                    MOVE PD-PROCESS-CD TO WINDOW-PROCESS
                    MOVE "WI/TFCCDS" TO FORM-NAM
                    CALL FORM-PROGX USING FORM-PATH WINDOW-WORKERS
                    CANCEL FORM-PROGX
                    MOVE WINDOW-LPO TO PD-LPO
                    MOVE WINDOW-REP TO PD-REP-CD
                    MOVE WINDOW-PROCESS TO PD-PROCESS-CD.

           IF ELE = 27
              MOVE
              "F1-CLEAR,F6-SCAN, ENTER CREDIT LIFE INSURANCE COMPANY:"
                                                          TO MESS
              PERFORM SEND-LEGEND
              MOVE VDUSTATUS TO HOLD-VDUSTATUS
              IF HOLD-VDUSTATUS = "1<"
                 PERFORM INSCOMP-SCAN
                 MOVE "SNNN020270." TO VDU
                 MOVE ICSCAN-CODE TO VDUNUM0
                 PERFORM SCREENIO
                 MOVE ICSCAN-CODE TO VDUNUM0
                 IF IO-FG = 9
                    GO TO ENTER-ELE.

           IF ELE = 28
              MOVE VDUSTATUS TO HOLD-VDUSTATUS
              MOVE
              "F1-CLEAR,F6-SCAN, ENTER A&H INSURANCE COMPANY:"
                                                          TO MESS
              PERFORM SEND-LEGEND
              IF HOLD-VDUSTATUS = "1<"
                 PERFORM INSCOMP-SCAN
                 MOVE "SNNN020280." TO VDU
                 MOVE ICSCAN-CODE TO VDUNUM0
                 PERFORM SCREENIO
                 MOVE ICSCAN-CODE TO VDUNUM0
                 IF IO-FG = 9
                    GO TO ENTER-ELE.

           IF ELE = 29
              MOVE VDUSTATUS TO HOLD-VDUSTATUS
              MOVE
              "F1-CLEAR,F6-SCAN, ENTER PERSONAL PROP INSURANCE COMPANY:"
                                                          TO MESS
              PERFORM SEND-LEGEND
              IF HOLD-VDUSTATUS = "1<"
                 PERFORM INSCOMP-SCAN
                 MOVE "SNNN020290." TO VDU
                 MOVE ICSCAN-CODE TO VDUNUM0
                 PERFORM SCREENIO
                 MOVE ICSCAN-CODE TO VDUNUM0
                 IF IO-FG = 9
                    GO TO ENTER-ELE.

           IF ELE = 30
              MOVE VDUSTATUS TO HOLD-VDUSTATUS
              MOVE
              "F1-CLEAR,F6-SCAN, ENTER OTHER #1 INSURANCE COMPANY:"
                                                          TO MESS
              PERFORM SEND-LEGEND
              IF HOLD-VDUSTATUS = "1<"
                 PERFORM INSCOMP-SCAN
                 MOVE "SNNN020300." TO VDU
                 MOVE ICSCAN-CODE TO VDUNUM0
                 PERFORM SCREENIO
                 MOVE ICSCAN-CODE TO VDUNUM0
                 IF IO-FG = 9
                    GO TO ENTER-ELE.

           IF ELE = 31
              MOVE VDUSTATUS TO HOLD-VDUSTATUS
              MOVE
              "F1-CLEAR,F6-SCAN, ENTER OTHER #2 INSURANCE COMPANY:"
                                                          TO MESS
              PERFORM SEND-LEGEND
              IF HOLD-VDUSTATUS = "1<"
                 PERFORM INSCOMP-SCAN
                 MOVE "SNNN020310." TO VDU
                 MOVE ICSCAN-CODE TO VDUNUM0
                 PERFORM SCREENIO
                 MOVE ICSCAN-CODE TO VDUNUM0
                 IF IO-FG = 9
                    GO TO ENTER-ELE.

           IF ELE = 32
              MOVE VDUSTATUS TO HOLD-VDUSTATUS
              MOVE
              "F1-CLEAR,F6-SCAN, ENTER OTHER #3 INSURANCE COMPANY:"
                                                          TO MESS
              PERFORM SEND-LEGEND
              IF HOLD-VDUSTATUS = "1<"
                 PERFORM INSCOMP-SCAN
                 MOVE "SNNN020320." TO VDU
                 MOVE ICSCAN-CODE TO VDUNUM0
                 PERFORM SCREENIO
                 MOVE ICSCAN-CODE TO VDUNUM0
                 IF IO-FG = 9
                    GO TO ENTER-ELE.

           IF ELE = 33
              IF CHFG(33) = " "
                 MOVE "F1-CLEAR, F3-ENTER FEES, (RTN)-SKIP" TO MESS
                 PERFORM SEND-LEGEND
              ELSE
                 PERFORM DO-FEEENT-WINDOW
                 MOVE " " TO PD-REGPYAMT-FG
                 GO TO CREATE-ROUTINE.

           IF NEW-FLAG = 1
              IF ELE > 33 AND ELE < 35
                 GO TO CREATE-ROUTINE.

           IF ELE = 31
              IF SP-DEFAULT-O2-INS-COMP NUMERIC  AND
                  SP-DEFAULT-O2-INS-COMP NOT = 0
                 MOVE "SN N020310." TO VDU
                 MOVE SP-DEFAULT-O2-INS-COMP TO VDUNUM0
                 PERFORM SCREENIO.
           IF ELE = 32
              IF GP-DEFAULT-O3-INS-COMPANY NOT = 0
                 MOVE "SN N020320." TO VDU
                 MOVE GP-DEFAULT-O3-INS-COMPANY TO VDUNUM0
                 PERFORM SCREENIO.

           IF ELE = 35
              MOVE
              "F1-CLEAR, F3-CALC, ENTER AMOUNT OF FIRST PAYMENT:"
                                                          TO MESS
              PERFORM SEND-LEGEND.

           IF ELE = 36
              MOVE
              "F1-CLEAR, ENTER AMOUNT OF THE LAST PAYMENT:"
                                                          TO MESS
              PERFORM SEND-LEGEND.

      * CALL BUYRATE WINDOW
      
           IF NEW-FLAG = 1
              IF ELE = 37
                 IF ( DL-PARVPAID-FRMLA    =  3  ) OR
                    ( DL-PARVPAID-FRMLA-IB = "3" )
                    PERFORM BUYRATE-WINDOW.

           IF ELE = 37
              MOVE "F1, ENTER PURCHASE DATE:" TO MESS
              PERFORM SEND-LEGEND
              PERFORM GET-SP
              PERFORM SEND-PURCHASE-FIELDS.

           IF ELE = 38
              IF CHFG(38) = " "
                 IF PD-DLRVPRIN(2) = 0
                         AND PD-DLRVPRIN(3) = 0
                          AND PD-DLRVCHGS(2) = 0
                           AND PD-DLRVCHGS(3) = 0
                    MOVE
                 "F1, F3-RESERVE WINDOW, ENTER PRINCIPAL RESERVE #1:"
                                                            TO MESS
                    PERFORM SEND-LEGEND
                 ELSE
                    PERFORM DO-RSVENT-WINDOW
                    GO TO CREATE-ROUTINE.

           IF ELE = 39
              IF CHFG(39) = " "
                 IF PD-DLPARVPAID = 0
                    MOVE
                 "F1, F3-RESERVE WINDOW, ENTER PARTICIPATION HELD:"
                                                            TO MESS
                    PERFORM SEND-LEGEND
                 ELSE
                    IF NEW-FLAG = 1
                       MOVE 39 TO ELE
                       GO TO CREATE-ROUTINE
                    ELSE
                       PERFORM DO-RSVENT-WINDOW
                       GO TO CREATE-ROUTINE.

           IF CHKEY NOT = ZEROS
              IF CHFG (ELE) = " "
                 IF NEW-FLAG NOT = 1
                    GO TO MODIFY-ROUTINE.

           IF CHFG(ELE) = "N"
              IF NEW-FLAG = 1
                 GO TO CREATE-ROUTINE
               ELSE
                 GO TO MODIFY-ROUTINE.

      *-----------------------------------------------------------------
       ENTER-AT-ELEMENT.

           MOVE SPEC(ELE) TO VDU.
           MOVE ELE       TO VDUROW.
           MOVE 0         TO VDUCOL.
           MOVE "."       TO VDUDECIMAL.
           PERFORM SCREENIO.

      *-----------------------------------------------------------------
       TEST-F1.
           IF VDUSTATUS = "10"
              MOVE "CLR" TO IO-TYPE
              GO TO END-ENTRY-MODULE.

      *-----------------------------------------------------------------
       TEST-F3.
           IF VDUSTATUS NOT = "16"
              GO TO TEST-UP.

           IF ELE = 33
              IF CHFG(33) = " "
                 PERFORM DO-FEEENT-WINDOW
                 MOVE " " TO PD-REGPYAMT-FG
                 GO TO CREATE-ROUTINE.

           IF ELE = 35
              MOVE " " TO PD-REGPYAMT-FG
              GO TO CREATE-ROUTINE.

           IF ELE = 38
              IF CHFG(38) = " "
                 PERFORM DO-RSVENT-WINDOW
                 IF NEW-FLAG = 1
                    MOVE 39 TO ELE
                 END-IF
                 GO TO CREATE-ROUTINE.

           IF ELE = 39
              IF CHFG(39) = " "
                 PERFORM DO-RSVENT-WINDOW
                 GO TO CREATE-ROUTINE.

           IF ELE = 9 AND BR-TRAILER-REC = "Y"
              MOVE " " TO MESS
              MOVE WK-HHGS-1 TO INSPECT-X
              PERFORM COLLATERAL-CREATE
              PERFORM RESTORE-TRAILER-REC.

      *-----------------------------------------------------------------
       TEST-UP.

           IF VDUSTATUS NOT = "1U"
              GO TO TEST-DOWN.

           IF ELE = 11
              MOVE 10 TO ELE
              GO TO ENTER-ELE.

           IF ELE = 17
              MOVE " " TO CHFG(16).

           IF ELE = 20
              MOVE " " TO CHFG(18).

           IF ELE = 22
              MOVE " " TO CHFG(21).

           IF NEW-FLAG = 1
              MOVE -1 TO ONE
              GO TO CREATE-ROUTINE.

           IF ELE = 36
              MOVE 35 TO ELE
              GO TO ENTER-ELE.

      *-----------------------------------------------------------------
       TEST-DOWN.

           IF VDUSTATUS NOT = "1D"
              GO TO TEST-F4.

           MOVE 1 TO ONE.
           GO TO GOTO-FIELD.

      *-----------------------------------------------------------------
       TEST-F4.

           IF ( NOT F4-KEY ) GO TO TEST-F5.

           IF ( ELE = 09 )
              PERFORM AUTOPC-ROUTINE.

      *-----------------------------------------------------------------
       TEST-F5.

           IF ( NOT F5-KEY ) GO TO TEST-F6.

           IF ELE < 5
              PERFORM BORROWER-CREATE
              IF IO-FG = 0
                 GO TO GOTO-FIELD.

           IF ELE = 11
              MOVE VDUNUM0 TO W-LNNO
              MOVE "LP/RONPF" TO FORM-NAM
              CALL FORM-PROGX USING FORM-PATH W-LNNO "Y" PROG-BUF
              CANCEL FORM-PROGX.

           MOVE 1 TO ONE.
           GO TO GOTO-FIELD.

      *-----------------------------------------------------------------
       TEST-F6.

           IF ( NOT F6-KEY ) GO TO TEST-00.

           IF ELE < 5
              PERFORM BORROWER-SCAN
              IF IO-FG = 0
                 GO TO GOTO-FIELD
              ELSE
                 GO TO ENTER-ELE.

           IF ELE = 7 OR 8 OR 10
              MOVE 0 TO CDCODE-FEE-FG
              PERFORM CODE-SCAN
              IF IO-FG = 0
                 GO TO GOTO-FIELD
              ELSE
                 GO TO ENTER-ELE.

           IF ELE = 11
              PERFORM BWLN-SCAN
              IF IO-FG = 0
                 IF PD-PRLNNO NOT = 0
                    MOVE "N" TO FIND-LOANS-FG
                 END-IF
                 GO TO GOTO-FIELD
              ELSE
                 GO TO ENTER-ELE.

           IF ELE = 12
              PERFORM DEALER-SCAN
              IF IO-FG = 0
                 GO TO GOTO-FIELD
              ELSE
                 GO TO ENTER-ELE.

           IF ELE = 40
              PERFORM ELCODE-SCAN
              IF IO-FG = 0
                 GO TO GOTO-FIELD
              ELSE
                 GO TO ENTER-ELE.

      *-----------------------------------------------------------------
       TEST-00.

           IF VDUSTATUS NOT = "00"
              GO TO ENTER-ELE.

      *-----------------------------------------------------------------
       GOTO-FIELD.

           IF (ELE > 21 AND ELE < 35)
                             OR ELE = 15
              MOVE " " TO PD-REGPYAMT-FG.

           MOVE 1 TO ONE.

           IF ELE > 20
              GO TO GOTO-FIELD-20.

           GO TO F-01 F-02 F-03 F-04 F-05 F-06 F-07 F-08 F-09 F-10
                 F-11 F-12 F-13 F-14 F-15 F-16 F-17 F-18 F-19 F-20
                 DEPENDING ON ELE.

      *-----------------------------------------------------------------
       GOTO-FIELD-20.

           SUBTRACT 20 FROM ELE GIVING OVER-20.

           GO TO F-21 F-22 F-23 F-24 F-25 F-26 F-27 F-28 F-29 F-30
                 F-31 F-32 F-33 F-34 F-35 F-36 F-37 F-38 F-39 F-40
                 DEPENDING ON OVER-20.

           GO TO END-ENTRY-MODULE.

      *=================================================================
      *
      *    S E T - E L E M E N T S
      *
      *=================================================================
       F-01.
           PERFORM BORROWER-ENTRY.

           IF ( BW-ERROR-YES )
              GO TO ENTER-ELE.

           IF ( ( BW-LIASMLN     = ZEROES     ) AND
                ( BW-PRLOANS     = ZEROES     ) AND
                ( BW-REFDATE NOT = TRANS-DATE ) ) OR
              ( ( BW-LIASMLN     = ZEROES     ) AND
                ( BW-PRLOANS NOT = ZEROES     ) )
              MOVE BW-SSNO TO BISCAN-SSNO
              MOVE 1 TO BISCAN-CALL-CODE
              PERFORM CALL-SCAN.

           GO TO CREATE-ROUTINE.

      *-----------------------------------------------------------------
       F-02.
           PERFORM BORROWER-ENTRY.

           IF ( BW-ERROR-YES )
              GO TO ENTER-ELE.

           IF ( BW-SSNO NOT = ZEROES )
              MOVE BW-SSNO TO BISCAN-SSNO
              IF ( ( BW-LIASMLN     = ZEROES     ) AND
                   ( BW-PRLOANS     = ZEROES     ) AND
                   ( BW-REFDATE NOT = TRANS-DATE ) ) OR
                 ( ( BW-LIASMLN     = ZEROES     ) AND
                   ( BW-PRLOANS NOT = ZEROES     ) )
                 MOVE 1 TO BISCAN-CALL-CODE
                 PERFORM CALL-SCAN.

           GO TO CREATE-ROUTINE.

      *-----------------------------------------------------------------
       F-03.
           PERFORM BORROWER-ENTRY.

           IF ( BW-ERROR-YES )
              GO TO ENTER-ELE.

           IF ( BW-SSNO NOT = ZEROES )
              MOVE BW-SSNO TO BISCAN-SSNO
              IF ( ( BW-LIASMLN     = ZEROES     ) AND
                   ( BW-PRLOANS     = ZEROES     ) AND
                   ( BW-REFDATE NOT = TRANS-DATE ) ) OR
                 ( ( BW-LIASMLN     = ZEROES     ) AND
                   ( BW-PRLOANS NOT = ZEROES     ) )
                 MOVE 1 TO BISCAN-CALL-CODE
                 PERFORM CALL-SCAN.

           GO TO CREATE-ROUTINE.

      *-----------------------------------------------------------------
       F-04.
           PERFORM BORROWER-ENTRY.

           IF ( BW-ERROR-YES )
              GO TO ENTER-ELE.

           IF ( BW-SSNO NOT = ZEROES )
              MOVE BW-SSNO TO BISCAN-SSNO
              IF ( ( BW-LIASMLN     = ZEROES     ) AND
                   ( BW-PRLOANS     = ZEROES     ) AND
                   ( BW-REFDATE NOT = TRANS-DATE ) ) OR
                 ( ( BW-LIASMLN     = ZEROES     ) AND
                   ( BW-PRLOANS NOT = ZEROES     ) )
                 MOVE 1 TO BISCAN-CALL-CODE
                 PERFORM CALL-SCAN.

           PERFORM BW-CHECK-ENDORSER.
           GO TO CREATE-ROUTINE.

      *-----------------------------------------------------------------
       F-05.
           MOVE VDUBUF TO PD-ORGST
                          PD-OWNST.
       F-052.
           MOVE "^-BACK, F6-SCAN, ENTER SUB CLASS:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "EN N020052." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF VDUSTATUS = "1<"
              PERFORM SUBCLASS-SCAN
              IF IO-FG = 9
                 GO TO F-052.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-052.

           MOVE PD-ORGST    TO SP-ORGST
                               QSP1-WBEG-ORGST
                               QSP1-WEND-ORGST.
           MOVE PD-SPRCLASS TO SP-SPRCLASS
                               QSP1-WBEG-SPRCLASS
                               QSP1-WEND-SPRCLASS.
           MOVE VDUNUM0     TO PD-SUBCLASS SP-SUBCLASS
                               QSP1-WBEG-SUBCLASS
                               QSP1-WEND-SUBCLASS.
           MOVE 0           TO SP-LAWCODE
                               QSP1-WBEG-LAWCODE.
           MOVE ALL "9"     TO QSP1-WEND-LAWCODE.

           PERFORM START-SP1-FILE.
       F-052-NEXT-SP.
           PERFORM READ-SP1-FILE-NEXT.
           IF NOT (SP-ORGST = PD-ORGST AND
                     SP-SPRCLASS = PD-SPRCLASS AND
                       SP-SUBCLASS = PD-SUBCLASS)
              MOVE 9 TO IO-FG.

           IF IO-FG = 9
              PERFORM SP-INVALID
              GO TO F-052.

           MOVE "S  A015053." TO VDU.
           MOVE SP-DESC TO VDUBUF.
           PERFORM SCREENIO.
           GO TO CREATE-ROUTINE.
       F-06.
           MOVE VDU-DATE-YYYYMMDD TO PD-LOANDATE.
           IF VDUNUM0 = 0
              GO TO ENTER-ELE.

           PERFORM CHECK-EFFECTIVE-SPR.
           IF IO-FG = 9
              PERFORM SP-INVALID
              GO TO ENTER-ELE
           ELSE
              MOVE "S  A015053." TO VDU
              MOVE SP-DESC       TO VDUBUF
              PERFORM SCREENIO.

           MOVE SP-LAWCODE TO PD-LAWCODE.

           MOVE PD-LOANDATE TO NUM-DATE.
           MOVE TRANS-DATE TO SYS-DATE.
           PERFORM TIM.
           IF ELAPSED-DAYS > 90
              MOVE 90-LOANDATE-SEQ TO PASSWDW-SEQ
              MOVE "TO ALLOW LOANDATE 90+DAYS OLD" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO ENTER-ELE.

           IF NEW-FLAG = 1
              MOVE "S  8000160." TO VDU
              MOVE PD-LOANDATE TO PD-INTDATE
                                  VDU-DATE-YYYYMMDD
              PERFORM SCREENIO.

           GO TO CREATE-ROUTINE.
       F-07.
           MOVE "PU"   TO CD-TYPE.
           MOVE VDUBUF TO CD-CODE PD-PURCD.
           PERFORM SEND-CD-DESC.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-08.
           MOVE "CO"   TO CD-TYPE.
           MOVE VDUBUF TO CD-CODE PD-COLLCD.
           PERFORM SEND-CD-DESC.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-09.
           MOVE VDUBUF TO PD-COLLID.
           IF NEW-FLAG = 1
              IF PD-COLLID = " "
                 MOVE "S  A330091." TO VDU
                 PERFORM SCREENIO
                 GO TO CREATE-ROUTINE.
       CONT-F-09.
           MOVE "F1-CLEAR, ENTER COLLATERAL DESCRIPTION:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "E  A330091." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO CONT-F-09.
           MOVE VDUBUF TO PD-MSG1
                          WK-HHGS-1.
           PERFORM SAVE-TRAILER-REC.
           GO TO CREATE-ROUTINE.
       F-10.
           MOVE "SR"   TO CD-TYPE.
           MOVE VDUBUF TO CD-CODE PD-SRCD.
           PERFORM SEND-CD-DESC.
           IF IO-FG = 9
              GO TO ENTER-ELE.

           IF PD-SRCD = "SC"
              PERFORM INVALID-FOR-SF
              GO TO ENTER-ELE.

           IF NOT (PD-SRCD = "PB" OR "RN" OR "RB" OR "RO")
              IF GP-THE-ONLY-SF-SRCD NOT = " "
                 IF PD-SRCD NOT = GP-THE-ONLY-SF-SRCD
                    PERFORM INVALID-FOR-SF
                    GO TO ENTER-ELE.

           IF PD-SRCD = "ET" OR "LP" OR "NP" OR "RT" OR "ST" OR "RB"
              MOVE SRCD-SEQ TO PASSWDW-SEQ
              MOVE "TO USE THIS SRCD" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "INVALID SOURCE CODE" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.

           IF HOLD-CIP-SRCD = " " OR "PB" OR "RN" OR "RB" OR "RO"
              IF NOT (PD-SRCD = "PB" OR "RN" OR "RB" OR "RO" )
                 PERFORM BLANK-PRIOR-LOAN.
           MOVE PD-SRCD TO HOLD-CIP-SRCD.
           IF NEW-FLAG NOT = 1
              PERFORM VERIFY-PROCEEDS
              MOVE 0 TO IO-FG
              IF PD-SRCD = "PB" OR "RN" OR "RB" OR "RO"
                 ADD 1 TO ELE
                 MOVE " " TO PD-REGPYAMT-FG
                 GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-11.
           MOVE VDUNUM0 TO W-LNNO.
           IF NOT (PD-SRCD = "PB" OR "RN" OR "RB" OR "RO")
              IF VDUNUM0 = 0
                 MOVE 0 TO PD-PRLNNO   PD-PRBAL
                           PD-PRINTDUE PD-PRFINCHGRB
                           PD-PRINSRB  PD-PRPAID-AHEAD
                           PRIOR-BNKRPTDATE
                 GO TO CREATE-ROUTINE
              ELSE
                 GO TO CREATE-ROUTINE
           ELSE
              IF VDUNUM0 = 0
                 MOVE "PRIOR LOAN NO. REQUIRED FOR LOAN RENEWALS"
                                                           TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.

           MOVE W-LNNO TO PD-PRLNNO.

           PERFORM D12-PROCESS-PRIOR-LN.

           IF PRIOR-LOAN-NOT-VALID
              PERFORM SEND-PRIOR-MESS
              GO TO ENTER-ELE.

           IF ERROR-IN-PRIOR-LOAN
              MOVE 0 TO IO-FG
              PERFORM PRIOR-LN-ERROR-MSG
              GO TO ENTER-ELE.

           MOVE "SNNN062111." TO VDU.
           MOVE PRIOR-LNAMT TO VDUNUM2.
           PERFORM SCREENIO.

           IF (PD-SSNO(1) NOT = SAVE-SSNO) AND
              NOT QUOTE-ONLY
              MOVE "WARNING - MAKER OF LOANS ARE DIFFERENT" TO MESS
              PERFORM SEND-MESS.

           IF GP-RENEWAL-COLLATERAL = "Y"
              PERFORM GET-PRIOR-COLLATERAL.

           MOVE " " TO FIND-LOANS-FG.
           GO TO CREATE-ROUTINE.
       F-12.
           MOVE VDUNUM2 TO PD-DLNO
                           DL-DLNO.
           PERFORM GET-DL1.
           MOVE "S  A160121." TO VDU.
           MOVE DL-SHORT TO VDUBUF.
           PERFORM SCREENIO.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           IF DL-DLNO = 9999.99
              MOVE "DO NOT USE DIRECT LOAN DEALER" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-ELE.



           IF PD-LOANTYPE = "I"
              IF DL-MAXPURPER NOT = 100
                 MOVE "DEALER HAS INVALID PURCHASE PERCENT" TO MESS
                 PERFORM SEND-MESS
                 MOVE "FOR INTEREST BEARING LOAN CLASS." TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.
           IF DL-TERMDATE NOT = 0
              IF DL-TERMDATE NOT > PD-LOANDATE
                 MOVE "DEALER HAS BEEN TERMINATED" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.
           MOVE "SIGN:" TO INSPECT-W.
           MOVE DL-SIGN1 TO ADD-ON.
           PERFORM ADD-IT2.
           MOVE DL-SIGN2 TO ADD-ON.
           PERFORM ADD-IT2.
           MOVE DL-SIGN3 TO ADD-ON.
           PERFORM ADD-IT.
           MOVE INSPECT-W TO MESS.
           PERFORM MSG-LINE.
           IF BR-LC-CODE = "Y"
              MOVE "SNNN020400." TO VDU
              MOVE DL-LC-CODE TO VDUNUM0
                                 PD-LC-CODE
              PERFORM SCREENIO.
           IF (LC-AFP-CLASS-N AND DL-AFP-DEALER-Y) OR
              (LC-AFP-CLASS-Y AND DL-AFP-DEALER-N)
                 MOVE "AFP MISMATCH" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-13.
           MOVE VDUBUF TO PD-DLRECOURSE.
           MOVE "S  A090131." TO VDU.
           PERFORM GET-RECOURSE-DESC.
           PERFORM SCREENIO.
           IF VDUBUF = " INVALID"
              MOVE "F-FULL, P-PARTIAL, N-NONE" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-ELE.
           IF (DL-RECOURSE-FRMLA = "A"
                      AND PD-DLRECOURSE = "F")
              GO TO F-13X.
           IF PD-DLRECOURSE NOT = "P"
              MOVE 0 TO PD-DLPARTRCAMT
      *       MOVE "132." TO MESS
      *       PERFORM RESET-MESS
              MOVE SPACES TO VDUBUF
              MOVE "S  A090132." TO VDU
              PERFORM SCREENIO
              GO TO CREATE-ROUTINE.
       F-13X.
           MOVE "ENNN062132." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF VDUSTATUS NOT = "00"
                     AND NOT = "1D"
              GO TO F-13X.
           IF VDUNUM2 = 0
              GO TO F-13X.
           MOVE VDUNUM2 TO PD-DLPARTRCAMT.
           GO TO CREATE-ROUTINE.
       F-14.
           MOVE VDUBUF TO PD-UNITPER-CD
                          UPERTST-UNITPER-CD.
           PERFORM UPERTST-UNITPER-CODE.
           IF UPERTST-ERRCD NOT = " "
              GO TO ENTER-ELE.
           IF BR-UNITPER-Y-D-FG NOT = "Y"
              MOVE "SNNN030141." TO VDU
              MOVE 1 TO PD-UNITPER-FREQ
                        VDUNUM0
              PERFORM SCREENIO
              PERFORM SEND-1STPYDATE
              GO TO CREATE-ROUTINE.
       F-141.
           MOVE "ENNN030141." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-141.
           MOVE VDUNUM0 TO PD-UNITPER-FREQ
                           UPERTST-UNITPER-FREQ.
           MOVE PD-UNITPER-CD TO UPERTST-UNITPER-CD.
           PERFORM UPERTST-UNITPER-FREQUENCY.
           IF UPERTST-ERRCD NOT = " "
              GO TO F-141.

           PERFORM SEND-1STPYDATE.
           IF NOT (PD-UNITPER-CD = "M"
                          AND PD-UNITPER-FREQ = 1)
              PERFORM UPERTST-SET-MESS
              MOVE UPERTST-MESS TO MESS
              PERFORM SEND-MESS.
           IF NEW-FLAG NOT = 1
                   OR PD-ORGTERM = 1
              PERFORM SET-UNITPER-INFO.
           GO TO CREATE-ROUTINE.
       F-15.
           IF VDUNUM0 = 0
              GO TO ENTER-ELE.
           MOVE PD-ORGTERM TO HOLD-WORKER.
           MOVE VDUNUM0 TO PD-ORGTERM
                           PD-SUM-ORGTERM.
           IF HOLD-WORKER NOT = PD-ORGTERM
              PERFORM SET-UNITPER-INFO.
           GO TO CREATE-ROUTINE.
       F-16.
           IF VDUNUM0 = 0
              GO TO ENTER-ELE.
           MOVE PD-INTDATE TO HOLD-WORKER.
           MOVE VDU-DATE-YYYYMMDD TO PD-INTDATE.

           IF PD-INTDATE < PD-LOANDATE
              MOVE "MUST NOT BE PRIOR TO LOAN DATE" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-ELE.
           IF NEW-FLAG NOT = 1
              IF PD-1STPYDATE NOT > PD-INTDATE
                 MOVE "INTEREST DATE MUST BE PRIOR THE 1ST PAY DATE"
                                                           TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.
           IF HOLD-WORKER NOT = PD-INTDATE
              PERFORM SET-UNITPER-INFO.
           GO TO CREATE-ROUTINE.
       F-17.
           IF VDUNUM0 = 0
              GO TO ENTER-ELE.
           MOVE PD-1STPYDATE TO HOLD-WORKER.
           MOVE VDU-DATE-YYYYMMDD TO PD-ORIG-1STPYDATE
                                     PD-1STPYDATE.
           IF PD-1STPYDATE NOT > PD-INTDATE
              MOVE "FIRST PAY MUST BE AFTER THE INTEREST DATE"
                                                        TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-ELE.

      * DO NOT ALLOW A FIRST PAYMENT DATE < 30 DAYS FROM LOAN DATE
      * OR < THAN 1 UNIT PERIOD FROM INT DATE
           MOVE PD-INTDATE      TO NDTE-DATE.
           MOVE 1               TO NDTE-HOLD.
           MOVE PD-UNITPER-CD   TO DATER-UNITPER-CD.
           MOVE PD-UNITPER-FREQ TO DATER-UNITPER-FREQ.
           PERFORM INCREMENT-UNITPER.
           IF PD-1STPYDATE < NDTE-DATE
              MOVE 1STPY30-SEQ TO PASSWDW-SEQ
              MOVE "1ST PAY < 30 DAYS FROM LNDATE"
                                        TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO ENTER-ELE.

                 
      *WE CALCULATE A FIRST PMT DUE DATE BY TAKING LNDATE
      *THEN INCREMENT 1 PERIOD. THE CUSTOMER DOES NOT 
      *WANT TO ENTER A PASSWORD IF 1ST PAY IS 30 DAYS OUTPUT
      * EX: LNDATE 7/11, 1ST DUE 8/10 SHOULD NOT BE       
      *ASKED FOR PASSWORD
           IF PD-UNITPER-CD = "M"
              MOVE PD-LOANDATE TO NUM-DATE  
              MOVE PD-1STPYDATE TO SYS-DATE
              MOVE 365 TO ELAPSED-YRTYPE
              PERFORM TIMALL 
              IF ELAPSED-DAYS < 30
                 MOVE HONOR-1STPAY-30-DAYS-SEQ TO PASSWDW-SEQ 
                 MOVE "1ST PAY 30 DAYS FROM LNDATE"
                                          TO PASSWDW-PROMPT2 
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                     GO TO ENTER-ELE.              


      *  JTG 011001 DON'T ALLOW A FIRST PAY DAY OF 31 WHEN SEMI MONTHLY PAPER
      *                                                            FFG PR#333
      *  CS  021001 PER JOHN DON'T ALLOW A FIRST PAY DAY OF 14 OR 15 EITHER IF
      *      SEMI-MONTHLY.  FEB CAUSED THE CYCLE DATES FOR LATE CHARGES TO BE
      *      OUT OF SYNC. FOR EXAMPLE: WITH PAYDATE OF 15 LCPDTH GOES TO 2/28/YY      *      MARCH WENT TO 3/13/YY INSTEAD OF 3/15/YY [DISCOVERED AT FFG]

           IF PD-UNITPER-CD = "S"
              IF PD-1STPYDA = 14 OR 15 OR 31
                 PERFORM INVALID-DUE-DAY
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.

           IF HOLD-WORKER NOT = PD-1STPYDATE
              PERFORM SET-UNITPER-INFO.
           GO TO CREATE-ROUTINE.

       F-18.
           MOVE VDU-DATE-YYYYMMDD TO PD-CASHDATE.
           IF PD-CASHDATE NOT = 0
              IF PD-CASHDATE < PD-LOANDATE
                 MOVE "CAN'T BE PRIOR TO LOAN-DATE" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-19.
           MOVE VDUNUM3 TO PD-CONRATE.
           GO TO CREATE-ROUTINE.
       F-20.
           MOVE VDUNUM3 TO PD-APRATE.
           MOVE "S  A010201." TO VDU.
           MOVE "I" TO VDUBUF.
           PERFORM SCREENIO.
       F-201.
           MOVE "^-BACK, ENTER 'I' OR 'C':" TO MESS.
           PERFORM SEND-LEGEND.

           MOVE "E  A010201." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-201.
           IF NOT (VDUBUF = "I" OR "C")
              GO TO F-201.
           IF VDUBUF = "I"
              MOVE "N" TO CALCULATE-APR-FG.
           IF VDUBUF = "C"
              MOVE "Y" TO CALCULATE-APR-FG
              PERFORM CALCULATE-APR.

           GO TO CREATE-ROUTINE.
       F-21.
           MOVE VDUNUM3 TO PD-OVRDRATE.
           IF SP-FORCE-ENTRY-OVRDRATE(1)
              IF VDUNUM3 = 999.999
                 MOVE " AN OVERRIDE RATE MUST BE ENTERED" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE
              END-IF
              IF VDUNUM3 = 0
                 MOVE " THE OVERRIDE RATE CAN'T BE ZERO" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-22.
      *JGW IF VDUNUM2 = 0
      *JGW    GO TO ENTER-ELE.
           IF PD-SRCD = "RN"
              IF VDUNUM2 NOT = 0
                 GO TO ENTER-ELE.
           MOVE VDUNUM2 TO PD-SELLPR.
           GO TO CREATE-ROUTINE.
       F-23.
           IF PD-SRCD = "RN"
              IF VDUNUM2 NOT = 0
                 GO TO ENTER-ELE.
           IF VDUNUM2 > PD-SELLPR
              GO TO ENTER-ELE.
           MOVE VDUNUM2 TO PD-DOWNPY.
       F-231.
           IF GP-ALLOW-ENTRY-TRADEIN NOT = "Y"
              MOVE "SNNS062231." TO VDU
              MOVE 0 TO PD-TRADEIN
                        VDUNUM2
              PERFORM SCREENIO
              GO TO CREATE-ROUTINE.
           MOVE "^-BACK, ENTER AMOUNT OF TRADE IN:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "ENNS062231." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-231.
           MOVE VDUNUM2 TO PD-TRADEIN.
           GO TO CREATE-ROUTINE.
       F-24.
           MOVE VDUNUM2 TO PD-SERCHG
                           PD-SUM-SERCHG.
       F-241.
           IF SP-MFFRMLA = 0
              GO TO CREATE-ROUTINE.
      *    IF BR-USE-PARTIC-FLAT-TABLE = "Y"
      *      IF DL-USE-PARTIC-FLAT-TABLE = "Y"
      *       GO TO CREATE-ROUTINE.
           MOVE "^-BACK, ENTER MAINTENANCE FEE:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "ENNN032241." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF VDUSTATUS NOT = "00" AND NOT = "1D"
              GO TO F-241.
           DIVIDE VDUNUM2 BY PD-ORGTERM GIVING PD-MAINTFEE
             REMAINDER AMT-HOLDER.
           IF AMT-HOLDER NOT = 0
              MOVE "AMOUNT MUST BE EVENLY DIVISABLE BY TERM" TO MESS
              PERFORM SEND-MESS
              GO TO F-241.
           COMPUTE PD-SUM-MAINTFEE = PD-MAINTFEE * PD-ORGTERM.
           GO TO CREATE-ROUTINE.
       F-25.
           MOVE VDUNUM2 TO PD-INTCHG
                           PD-SUM-INTCHG.
       F-251.
           IF SP-PYEXFRMLA = 0
              GO TO CREATE-ROUTINE.
           MOVE
           "^-BACK, ENTER FIRST PAYMENT EXTENTION CHARGE:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "ENNN042251." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF VDUSTATUS NOT = "00" AND NOT = "1D"
              GO TO F-251.
           MOVE VDUNUM2 TO PD-EXTCHG
                           PD-SUM-EXTCHG.
           GO TO CREATE-ROUTINE.
       F-26.
           MOVE " " TO CHFG(27) CHFG(28) CHFG(29)
                       CHFG(30) CHFG(31) CHFG(32).
           MOVE VDUBUF TO PD-INSCODES.
           IF PD-INSURED NOT = "M"
              IF PD-INSURED NOT = "J"
                 IF PD-INSURED NOT = "N"
                    IF PD-INSURED NOT = "S"
                       MOVE "ENTER 'N','M','S',OR 'J'" TO MESS
                       PERFORM SEND-MESS
                       GO TO ENTER-ELE.
           IF NOT PD-INSTYPES-VALID
              GO TO ENTER-ELE.
           IF NOT PD-INSELIGIBLE-VALID
              GO TO ENTER-ELE.

      * ADDED TO PREVENT ENTRY OF MNN, ETC.
           IF PD-INSTYPES = "N"
              IF PD-INSURED NOT = "N"
                 GO TO ENTER-ELE.

           IF PD-INSURED = "N"
              MOVE 0 TO IO-FG
              PERFORM VERIFY-INSURANCE
                   VARYING SUB FROM 1 BY 1
                    UNTIL SUB > 4
              IF IO-FG = 9
                MOVE "INS CO/PREMIUM MUST BE 0 FOR INS CD 'N'" TO MESS
                PERFORM SEND-MESS
                GO TO ENTER-ELE.

           MOVE "Y" TO INSELIG-DISPLAY-FG.
           PERFORM TEST-VALIDITY-OF-INSURANCES.
           IF IO-FG = 9
              GO TO ENTER-ELE.

           IF CHFG(27) = "N"
              MOVE 0 TO PD-INSCOMP(1) PD-INSTRM(1) PD-INSCOVR(1)
                        PD-INSPREM(1) PD-INSCOMM(1)
              MOVE " " TO PD-INSOURS(1)
                          PD-INSFINCHG(1)
              MOVE SPACES TO VDUBUF
              MOVE "S  A020270." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A010271." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A030272." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A090273." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A070274." TO VDU
              PERFORM SCREENIO.
           IF CHFG(28) = "N"
              MOVE 0 TO PD-INSCOMP(2) PD-INSTRM(2) PD-INSCOVR(2)
                        PD-INSPREM(2) PD-INSCOMM(2)
              MOVE " " TO PD-INSOURS(2)
                          PD-INSFINCHG(2)
              MOVE SPACES TO VDUBUF
              MOVE "S  A020280." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A010281." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A030282." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A090283." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A070284." TO VDU
              PERFORM SCREENIO.
           IF CHFG(29) = "N"
              MOVE 0 TO PD-INSCOMP(3) PD-INSTRM(3) PD-INSCOVR(3)
                        PD-INSPREM(3) PD-INSCOMM(3)
              MOVE " " TO PD-INSOURS(3)
                          PD-INSFINCHG(3)
      *       MOVE "290 291 292 293 294." TO MESS
      *       PERFORM RESET-MESS.
              MOVE SPACES TO VDUBUF
              MOVE "S  A020290." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A010291." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A030292." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A090293." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A070294." TO VDU
              PERFORM SCREENIO.
           IF CHFG(30) = "N"
              MOVE 0 TO PD-INSCOMP(4) PD-INSTRM(4) PD-INSCOVR(4)
                        PD-INSPREM(4) PD-INSCOMM(4)
              MOVE " " TO PD-INSOURS(4)
                          PD-INSFINCHG(4)
      *       MOVE "300 301 302 303 304." TO MESS
      *       PERFORM RESET-MESS.
              MOVE SPACES TO VDUBUF
              MOVE "S  A020300." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A010301." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A030302." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A090303." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A070304." TO VDU
              PERFORM SCREENIO.
           IF CHFG(31) = "N"
              MOVE 0 TO PD-INSCOMP(5) PD-INSTRM(5) PD-INSCOVR(5)
                        PD-INSPREM(5) PD-INSCOMM(5)
              MOVE " " TO PD-INSOURS(5)
                          PD-INSFINCHG(5)
      *       MOVE "310 311 312 313 314." TO MESS
      *       PERFORM RESET-MESS.
              MOVE SPACES TO VDUBUF
              MOVE "S  A020310." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A010311." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A030312." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A090313." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A070314." TO VDU
              PERFORM SCREENIO.
           IF CHFG(32) = "N"
              MOVE 0 TO PD-INSCOMP(6) PD-INSTRM(6) PD-INSCOVR(6)
                        PD-INSPREM(6) PD-INSCOMM(6)
              MOVE " " TO PD-INSOURS(6)
                          PD-INSFINCHG(6)
      *       MOVE "320 321 322 323 324." TO MESS
      *       PERFORM RESET-MESS.
              MOVE SPACES TO VDUBUF
              MOVE "S  A020320." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A010321." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A030322." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A090323." TO VDU
              PERFORM SCREENIO
              MOVE SPACES TO VDUBUF
              MOVE "S  A070324." TO VDU
              PERFORM SCREENIO.
           IF (GP-ENTER-LPO-FG = "Y")
              IF NEW-FLAG = 1
                 IF PD-LPO = SPACES
                    MOVE PD-DLNO TO DL-DLNO
                    PERFORM GET-DL1
                    MOVE DL-LPO TO WINDOW-LPO
                 ELSE
                    MOVE PD-LPO TO WINDOW-LPO
                 END-IF
                 MOVE PD-REP-CD TO WINDOW-REP
                 MOVE PD-PROCESS-CD TO WINDOW-PROCESS
                 MOVE "WI/TFCCDS" TO FORM-NAM
                 CALL FORM-PROGX USING FORM-PATH WINDOW-WORKERS
                 CANCEL FORM-PROGX
                 MOVE WINDOW-LPO TO PD-LPO
                 MOVE WINDOW-REP TO PD-REP-CD
                 MOVE WINDOW-PROCESS TO PD-PROCESS-CD.
           GO TO CREATE-ROUTINE.
       F-27.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-28.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-29.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-30.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-31.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-32.
           PERFORM INSURANCE-ENTRY.
           IF IO-FG = 9
              GO TO ENTER-ELE.
           GO TO CREATE-ROUTINE.
       F-33.
           GO TO CREATE-ROUTINE.
       F-34.
           GO TO CREATE-ROUTINE.
       F-35.
           IF VDUNUM2 = 0
              GO TO CREATE-ROUTINE.
           MOVE VDUNUM2 TO PD-1STPYAMT.
       F-351.
           MOVE "^-BACK, ENTER THE REGULAR PAYMENT AMOUNT:"
                                                      TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "ENNN062351." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-351.
           MOVE VDUNUM2 TO PD-REGPYAMT.
           MOVE 36 TO ELE.
           MOVE "SNNN062360." TO VDU.
           COMPUTE PD-LASTPYAMT
                   VDUNUM2 =
                        HOLD-TOTAL-REPAY - PD-1STPYAMT
                                - (PD-NOREGPY * PD-REGPYAMT).
           IF VDUNUM2 < 0
              MOVE "THIS PAYMENT WILL CAUSE A NEGATIVE LAST PAYMENT!"
                                                    TO MESS
              PERFORM SEND-MESS
              GO TO F-351.
           PERFORM SCREENIO.
           GO TO ENTER-ELE.
       F-36.
           MOVE VDUNUM2 TO PD-LASTPYAMT.
           PERFORM TEST-PAY.
           IF TEST-PAY-FG NOT = " "
              MOVE HOLD-TOTAL-REPAY TO TOTAL-REPAY
              MOVE 35 TO ELE
              GO TO ENTER-ELE.
           MOVE "I" TO PD-REGPYAMT-FG.
           GO TO CREATE-ROUTINE.
       F-37.
           IF VDUNUM0 = 0
              MOVE "S  8080370." TO VDU
              MOVE TRANS-DATE TO PD-PURDATE
                                 VDU-DATE-YYYYMMDD
              PERFORM SCREENIO
           ELSE
              MOVE VDU-DATE-YYYYMMDD TO PD-PURDATE.

      * TEST PURCHASE DATE TO LOAN DATE:
           IF PD-PURDATE < PD-LOANDATE
              MOVE "PURCHASE DATE CAN'T BE PRIOR TO LOAN DATE"
                                                       TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-ELE.

           GO TO CREATE-ROUTINE.
       F-38.

           IF GP-DLRVPRIN-1-FG NOT = "Y"
              IF VDUNUM2 NOT = 0
                 MOVE "RESERVE PRINCIPAL 1 MUST BE 0" TO MESS
                 PERFORM SEND-MESS
              END-IF
              MOVE "SN N062380." TO VDU
              MOVE 0 TO VDUNUM2 PD-DLRVPRIN(1)
              PERFORM SCREENIO.

           MOVE PD-DLRVPRIN(1) TO AMT-HOLDER.
           IF (SP-DLDISC-RVPRIN1-PCNT NOT = 0    ) OR
              (SP-DLDISC-RVPRIN1-AF-PCNT NOT = 0 )
              IF (SP-DLDISC-RVPRIN1-PCNT NOT = 0 )
                 COMPUTE PD-DLDISC ROUNDED =
                      VDUNUM2 * SP-DLDISC-RVPRIN1-PCNT * 0.01
                 COMPUTE PD-DLRVPRIN(1) = VDUNUM2 - PD-DLDISC
              ELSE
                 PERFORM RSV-CALC-AMTFIN
                 IF (SP-DLDISC-RVPRIN1-AF-PCNT NOT = 0)
                    COMPUTE PD-DLRVPRIN(1) ROUNDED =
                         RSVENT-AMTFIN
                           * SP-DLDISC-RVPRIN1-AF-PCNT * 0.01
                    IF VDUNUM2 < PD-DLRVPRIN(1)
                       MOVE 0       TO PD-DLDISC
                       MOVE VDUNUM2 TO PD-DLRVPRIN(1)
                       MOVE
               " AMOUNT ENTERED IS LESS THAN COMPUTED RSV PRIN RE: SPR%"
                                                            TO MESS
                       PERFORM SEND-MESS
                    ELSE
                       COMPUTE PD-DLDISC = VDUNUM2 - PD-DLRVPRIN(1)
                    END-IF
                 END-IF
              END-IF
              MOVE "SNNN062380."  TO VDU
              MOVE PD-DLRVPRIN(1) TO VDUNUM2
              PERFORM SCREENIO
              MOVE "SNNN062391." TO VDU
              MOVE PD-DLDISC     TO VDUNUM2
              PERFORM SCREENIO
              MOVE "I"           TO PD-DLDISC-FG
           ELSE
              MOVE VDUNUM2       TO PD-DLRVPRIN(1).
           IF AMT-HOLDER NOT = PD-DLRVPRIN(1)
              MOVE "I" TO PD-DLRVPRIN-FG(1).
       F-381.
      * JTG.AC
           IF PD-LOANTYPE = "I"
              MOVE 0 TO PD-DLRVCHGS(1)
                        PD-DLRVCHGS(2)
                        PD-DLRVCHGS(3)
              GO TO CREATE-ROUTINE.
      * JTG.AC

           MOVE
            "^-BACK, F3-RSV WINDOW, ENTER RESERVE CHARGES #1:"
                                                        TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "ENNN062381." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "16"
              PERFORM DO-RSVENT-WINDOW
              GO TO CREATE-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-381.
           MOVE PD-DLRVCHGS(1) TO AMT-HOLDER.
           MOVE VDUNUM2 TO PD-DLRVCHGS(1).
           IF AMT-HOLDER NOT = PD-DLRVCHGS(1)
              MOVE "I" TO PD-DLRVCHGS-FG(1).

           GO TO CREATE-ROUTINE.
       F-39.
      * JTG.AC
           IF PD-LOANTYPE = "I" AND VDUNUM2 NOT = 0
              MOVE DLRSV-SEQ TO PASSWDW-SEQ
              MOVE "TO ALLOW PARTIC ON IB ACCT:" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "PARTIC. NOT ALLOWED ON 'IB' ACCOUNTS" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-ELE.
      * JTG.AC
           MOVE PD-DLPARVHELD TO AMT-HOLDER.
           MOVE VDUNUM2 TO PD-DLPARVHELD.
           IF AMT-HOLDER NOT = PD-DLPARVHELD
              MOVE "I" TO PD-DLPARVHELD-FG.
           IF ( SP-ERNFRMLA(5) = 0                ) OR
              ( SP-DLDISC-RVPRIN1-PCNT NOT = 0    ) OR
              ( SP-DLDISC-RVPRIN1-AF-PCNT NOT = 0 )
              GO TO CREATE-ROUTINE.
       F-391.
           MOVE "^-BACK, F3-RSV WINDOW, ENTER DEALER DISC:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "ENNN062391." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "16"
              PERFORM DO-RSVENT-WINDOW
              GO TO CREATE-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO ENTER-ELE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO F-391.
           MOVE PD-DLDISC TO AMT-HOLDER.
           MOVE VDUNUM2 TO PD-DLDISC.
           IF AMT-HOLDER NOT = PD-DLDISC
              MOVE "I" TO PD-DLDISC-FG.
           GO TO CREATE-ROUTINE.
       F-40.
           MOVE "EL"    TO CD-TYPE.
           MOVE VDUNUM0 TO CD-EL-CODE PD-LC-CODE.
           MOVE SPACES  TO CD-EL-FILLER.
           PERFORM GET-CD.
           IF IO-FG NOT = 0 AND PD-LC-CODE NOT = 0
              MOVE "INVALID CODE" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-ELE.
           IF PD-LC-CODE = 0
              MOVE "S  A020400." TO VDU
              PERFORM SCREENIO.
           GO TO CREATE-ROUTINE.
       END-ENTRY-MODULE.
           EXIT.

      *****************************************************************
      *    TEST VALIDITY OF INSURANCES
      *
      * IN: INSELIG-DISPLAY-FG      Y - DISPLAY & SET INSURANCE INFO
      *                             N - NO DISPLAY & SET
      *****************************************************************
        TEST-VALIDITY-OF-INSURANCES SECTION.
           MOVE BR-AH-AND-CL TO SAVE-BR-AH-AND-CL.
           MOVE "N" TO BR-AH-AND-CL.
           PERFORM VALID-INS-TYPES-ELIG.
           MOVE SAVE-BR-AH-AND-CL TO BR-AH-AND-CL.

      **********************************************************
       VERIFY-LOAN-RN-PAYOFF SECTION.
      **********************************************************

      * VERIFY LOAN RENEWAL AMOUNT HAS NOT CHANGED
           MOVE PD-REC TO SAVE-PD-REC.
           MOVE "Y" TO LOAN-RN-PAYOFF-PROBLEM.

           MOVE "R"       TO PD-ID.
           MOVE BRANCH    TO PD-BRANCH.
           MOVE PD-PRLNNO TO PD-SOC-SEC.
           PERFORM GET-PD1.
           IF IO-GOOD
              COMPUTE VDUNUM2 ROUNDED =
                (PD-PRBAL + PD-PRINTDUE)
                              - (PD-PRFINCHGRB + PD-PRINSRB)
              IF VDUNUM2 = PRIOR-LNAMT
                 MOVE "N" TO LOAN-RN-PAYOFF-PROBLEM
              ELSE
                 MOVE "RENEWAL PAYOFF HAS CHANGED" TO MESS
                 PERFORM SEND-MESS.

       VERIFY-LOAN-RN-PAYOFF-EXIT.
           MOVE SAVE-PD-REC TO PD-REC.


      **********************************************************
       SET-UNITPER-INFO SECTION.
      **********************************************************

           IF PD-ORGTERM > 1
              IF PD-UNITPER-CD = "D"
                 MOVE "M" TO PD-UNITPER-CD
                 MOVE 1 TO PD-UNITPER-FREQ
                 MOVE "NOTE: ------> SWITCHING BACK TO MONTHLY PAPER!!"
                                                           TO MESS
                 PERFORM SEND-MESS.

           MOVE PD-UNITPER-CD     TO UPER-UNITPER-CD.
           MOVE PD-UNITPER-FREQ   TO UPER-UNITPER-FREQ.
           MOVE PD-INTDATE        TO UPER-INTDATE.
           MOVE PD-ORIG-1STPYDATE TO UPER-1STPYDATE.
           MOVE PD-ORGTERM TO UPER-TERM.
           PERFORM UPER-CALCULATION.

           MOVE UPER-UNITPER-PER-YEAR TO PD-UNITPER-PER-YEAR.
           MOVE UPER-DAYS-IN-UNITPER TO PD-DAYS-IN-UNITPER.
           IF PD-ORGTERM = 1
              MOVE UPER-SINGLE-PAY-CD TO PD-UNITPER-CD
              MOVE UPER-SINGLE-PAY-FREQ TO PD-UNITPER-FREQ.

           MOVE "S  A010140." TO VDU.
           MOVE PD-UNITPER-CD TO VDUBUF.
           PERFORM SCREENIO.
           MOVE "SN N030141." TO VDU.
           MOVE PD-UNITPER-FREQ TO VDUNUM0.
           PERFORM SCREENIO.

           IF PD-ORGTERM = 1
              MOVE "DEFAULTS FOR SINGLE PAY LOANS SET!!" TO MESS
              PERFORM SEND-MESS.

       SET-UNITPER-INFO-EXIT.
           EXIT.

      **********************************************************
       AUTOPC-ROUTINE SECTION.
      **********************************************************

           MOVE "A"                        TO AUTOPC-PC-ID.
           MOVE BRANCH                     TO AUTOPC-PC-BRANCH.
           MOVE PD-SSNO(1)                 TO AUTOPC-PC-SOC-SEC.
           MOVE "WI/AUTOPC" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH AUTOPC-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.

       AUTOPC-ROUTINE-EXIT.
           EXIT.

      **********************************************************
       COLLATERAL-CREATE SECTION.
      **********************************************************

           MOVE TEMP-PATH TO LTCREA-PATH.
           MOVE "WI/LTCREA" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH LTCREA-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           MOVE "Y" TO F3-COLLATERAL.

       EXIT-COLLATERAL-CREATE.
           EXIT.

      ******************************************************************
       BORROWER-ENTRY SECTION.
      ******************************************************************

           MOVE "N"        TO BW-ERROR-YN.

           MOVE VDUNUM0 TO NUM-BW PD-SSNO(ELE) BW-SSNO.
           IF ( NUM-BW NOT = 0 )
              GO TO GET-BORROWER.

           IF ( ELE = 1 )
              MOVE "Y" TO BW-ERROR-YN
              GO TO EXIT-ENTER-BORROWER.

           MOVE 0      TO BW-SSNO.
           MOVE SPACES TO INSPECT-W.

           PERFORM VARYING ELE FROM 1 BY 1 UNTIL ELE > 4
              MOVE 0      TO PD-SSNO(ELE)
              MOVE SPACES TO PD-MAKERCD(ELE)
              PERFORM SEND-BW-NO-NAME
              PERFORM SEND-BW-MAKERCD
           END-PERFORM.

           PERFORM BW-CHECK-ENDORSER.

           MOVE "N" TO BW-ERROR-YN.
           GO TO EXIT-ENTER-BORROWER.

      *-----------------------------------------------------------------
       GET-BORROWER.

           PERFORM BW-TABLE-CHECK.
           IF ( BW-ERROR-YES )
              GO TO EXIT-ENTER-BORROWER.

           PERFORM GET-BW1.
           PERFORM SEND-BW-NAME.

           IF ( BW-ERROR-YES )
              GO TO EXIT-ENTER-BORROWER
           ELSE
              IF GP-VALID-BDATE = "Y"
                 MOVE BW-BDATE TO NUM-DATE
                 PERFORM TSTDAT
                 IF NUM-DATE = 0
                    MOVE "BORROWER HAS AN INVALID BIRTHDATE" TO MESS
                    PERFORM SEND-MESS
                    MOVE "Y" TO BW-ERROR-YN
                    GO TO EXIT-ENTER-BORROWER.

           IF ( ELE = 1 )
              MOVE "M" TO PD-MAKERCD(1)
              PERFORM SEND-BW-MAKERCD
              MOVE BW-CONFIDENTIAL TO PD-CONFIDENTCD
              MOVE BW-ORIGIN TO PD-ORIGIN
              MOVE BW-CREDIT-SCORE TO PD-CRSCORE
              GO TO EXIT-ENTER-BORROWER.

      *-----------------------------------------------------------------
       ENTER-MAKER-CODE.

           MOVE "E  A010  2." TO VDU.
           MOVE ELE           TO VDUROW.
           PERFORM SCREENIO.

           IF ( VDUSTATUS = "1U" )
              MOVE "Y" TO BW-ERROR-YN
              GO TO EXIT-ENTER-BORROWER.

           IF ( VDUSTATUS NOT = "00" )
              GO TO ENTER-MAKER-CODE.

           IF ( VDUBUF NOT = "J" )
              IF ( VDUBUF NOT = "E" )
                 MOVE "(M-MAKER), J-JOINT, E-ENDORSER" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-MAKER-CODE.

           MOVE VDUBUF TO PD-MAKERCD(ELE).
           GO TO EXIT-ENTER-BORROWER.

       EXIT-ENTER-BORROWER.
           EXIT.

      ******************************************************************
       BW-TABLE-CHECK SECTION.
      ******************************************************************
           IF ELE NOT = 1
              SUBTRACT 1 FROM ELE GIVING I-LEVEL
              IF PD-SSNO(I-LEVEL) = 0
                 MOVE "Y" TO BW-ERROR-YN
                 MOVE "ENTER SERIALLY" TO MESS
                 PERFORM SEND-MESS
                 GO TO EXIT-BW-TABLE-CHECK.
           MOVE 4 TO I-LEVEL.
       NEXT-BW-LEVEL-CHECK.
           IF PD-SSNO(I-LEVEL) = PD-SSNO(ELE) AND I-LEVEL NOT = ELE
              MOVE "Y" TO BW-ERROR-YN
              MOVE "NO DUPLICATES" TO MESS
              PERFORM SEND-MESS
              GO TO EXIT-BW-TABLE-CHECK.
           SUBTRACT 1 FROM I-LEVEL.
           IF I-LEVEL > 0
              GO TO NEXT-BW-LEVEL-CHECK.
       EXIT-BW-TABLE-CHECK.
           EXIT.

      ******************************************************************
       BW-CHECK-ENDORSER SECTION.
      ******************************************************************
           MOVE 0 TO I-LEVEL.
       NEXT-ENDORSER-CHECK.
           ADD 1 TO I-LEVEL.
           IF PD-MAKERCD(I-LEVEL) = "E"
              GO TO EXIT-CHECK-ENDORSER.
           IF I-LEVEL < 4
              GO TO NEXT-ENDORSER-CHECK.
       EXIT-CHECK-ENDORSER.
           EXIT.

      ******************************************************************
       SUBCLASS-SCAN SECTION.
      ******************************************************************
           MOVE SPACES      TO SCSCAN-SP1-KEY.
           MOVE PD-ORGST    TO SCSCAN-ORGST.
           MOVE PD-SPRCLASS TO SCSCAN-SPRCLASS.
           MOVE 0           TO SCSCAN-SUBCLASS
                               SCSCAN-LAWCODE.
           MOVE "Y"         TO SCSCAN-LAST-LAW.
           MOVE TRANS-DATE  TO SCSCAN-TRANS-DATE.

           MOVE "WI/SCSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH SCSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF SCSCAN-STATUS NOT = "00" OR SCSCAN-SP1-KEY = " "
              MOVE 9 TO IO-FG
              GO TO EXIT-SUBCLASS-SCAN
           ELSE
              MOVE 0 TO IO-FG.

           MOVE "SNNN020052." TO VDU.
           MOVE SCSCAN-SP-SUBCLASS TO VDUNUM0.
           PERFORM SCREENIO.
           MOVE SCSCAN-SP-SUBCLASS TO VDUNUM0.

       EXIT-SUBCLASS-SCAN.
           EXIT.

      ******************************************************************
       ELCODE-SCAN SECTION.
      ******************************************************************

           MOVE "EL"   TO ELSCAN-TYPE.
           MOVE ZEROES TO ELSCAN-CODE.

           MOVE "WI/ELSCAN " TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH ELSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.

           IF ( ELSCAN-STATUS NOT = "00" ) OR ( ELSCAN-CODE = 0 )
               MOVE 9 TO IO-FG
               GO TO EXIT-ELCODE-SCAN.

           MOVE "SNNN020400." TO VDU.
           MOVE ELSCAN-CODE   TO VDUNUM0.
           PERFORM SCREENIO.

           MOVE ZEROES        TO IO-FG.
           MOVE ELSCAN-CODE   TO VDUNUM0.

       EXIT-ELCODE-SCAN.
           EXIT.

      ******************************************************************
       INSCOMP-SCAN SECTION.
      ******************************************************************
           MOVE 0     TO ICSCAN-KEY.
           MOVE "WI/ICSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH ICSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF ICSCAN-STATUS NOT = "00" OR ICSCAN-KEY = ZEROES
              MOVE 9 TO IO-FG.

       EXIT-INSCOMP-SCAN.
           EXIT.

      ******************************************************************
       INSURANCE-ENTRY SECTION.
      ******************************************************************
           MOVE 0 TO IO-FG.
           SUBTRACT 26 FROM ELE GIVING I-LEVEL.
           IF VDUNUM0 = 0
              MOVE VDUNUM0 TO IC-CODE PD-INSCOMP(I-LEVEL)
              GO TO ENTER-IC-OURS.

      * TEST PASSWD TO CHANGE DEFAULT INSURANCE COMPANY ON CL,AH,PP,O1
           IF I-LEVEL < 5
              IF VDUNUM0 NOT = PD-INSCOMP(I-LEVEL)
                 MOVE INSCO-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE INS. COMPANY....:" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "SNNN020  0." TO VDU
                    MOVE ELE TO VDUROW
                    MOVE PD-INSCOMP(I-LEVEL) TO VDUNUM0
                    PERFORM SCREENIO
                    MOVE 9 TO IO-FG
                    GO TO EXIT-ENTER-INSURANCE.
           MOVE VDUNUM0 TO PD-INSCOMP(I-LEVEL) IC-CODE.
           PERFORM READ-IC1-FILE.
           IF IO-FG = 9
              MOVE "INVALID COMPANY" TO MESS
              PERFORM SEND-MESS
              GO TO EXIT-ENTER-INSURANCE.

           PERFORM COMPUTE-INS-TERM-I-LEVEL.
       ENTER-IC-OURS.
           IF IC-CODE = 0
              MOVE " " TO PD-INSOURS(I-LEVEL)
              GO TO SEND-IC-OURS.
           IF ELE = 32
              IF GP-DEFAULT-O3-INSOURS NOT = " "
                 MOVE "S  A010321." TO VDU
                 MOVE GP-DEFAULT-O3-INSOURS TO VDUBUF
                 PERFORM SCREENIO.
           MOVE
           "^-BACK, IS THE INSURANCE OURS? (Y-YES, N-NO, M-MEMO)"
                                                             TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "R  A010  1." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              MOVE 9 TO IO-FG
              GO TO EXIT-ENTER-INSURANCE.
           IF VDUSTATUS NOT = "00" AND VDUSTATUS NOT = "1D"
              GO TO ENTER-IC-OURS.
           IF VDUBUF = " "
              MOVE "Y" TO VDUBUF
              IF PD-SERVACCT = "Y"
                 MOVE "N" TO VDUBUF.
           IF VDUBUF NOT = "Y"
              IF VDUBUF NOT = "N"
                 IF VDUBUF NOT = "M"
                    MOVE "Y-YES, N-NO, M-MEMO" TO MESS
                    PERFORM SEND-MESS
                    GO TO ENTER-IC-OURS.
           IF GP-DEFAULT-O3-INSOURS NOT = " "
              IF ELE = 32
                 IF GP-DEFAULT-O3-INSOURS NOT = VDUBUF
                    MOVE " " TO MESS
                    STRING "INSURANCE OURS MUST BE '"
                               GP-DEFAULT-O3-INSOURS
                                "', PLEASE CHANGE!"
                           DELIMITED BY SIZE INTO MESS
                    PERFORM SEND-MESS
                    GO TO ENTER-IC-OURS.

           MOVE VDUBUF TO PD-INSOURS(I-LEVEL).
       SEND-IC-OURS.
           MOVE "S  A010  1." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INSOURS(I-LEVEL) TO VDUBUF.
           PERFORM SCREENIO.
           PERFORM RESET-LEGEND.
           IF IC-CODE = 0
              GO TO ENTER-IC-TERM.
           IF IC-CODE NOT = 0
              IF SP-DEFAULT-O2-INS-COMP NUMERIC AND
                   SP-DEFAULT-O2-INS-COMP NOT = 0
                 IF ELE = 31
                   IF PD-INSOURS(I-LEVEL) = "Y"
                    IF IC-CODE NOT = SP-DEFAULT-O2-INS-COMP
                       MOVE " " TO MESS
                       STRING "INSURANCE COMPANY MUST BE "
                               SP-DEFAULT-O2-INS-COMP
                                ", PLEASE CHANGE!"
                           DELIMITED BY SIZE INTO MESS
                       PERFORM SEND-MESS
                       MOVE 9 TO IO-FG
                       GO TO EXIT-ENTER-INSURANCE.
           IF GP-DEFAULT-O3-INS-COMPANY NOT = 0
              IF ELE = 32
                 IF PD-INSOURS(I-LEVEL) = "Y"
                    IF IC-CODE NOT = GP-DEFAULT-O3-INS-COMPANY
                       MOVE " " TO MESS
                       STRING "INSURANCE COMPANY MUST BE "
                               GP-DEFAULT-O3-INS-COMPANYX
                                ", PLEASE CHANGE!"
                           DELIMITED BY SIZE INTO MESS
                       PERFORM SEND-MESS
                       MOVE 9 TO IO-FG
                       GO TO EXIT-ENTER-INSURANCE.
           IF I-LEVEL > 4
              GO TO ENTER-IC-COVR
           ELSE
              GO TO ENTER-IC-PREM.

       ENTER-IC-TERM.
           IF I-LEVEL > 4 AND GP-OT-INS-TERM NOT = "Y"
              GO TO ENTER-IC-EXP.
           IF IC-CODE = 0
              MOVE 0 TO PD-INSTRM(I-LEVEL)
              GO TO SEND-IC-TERM.
           MOVE "^-BACK, ENTER THE INSURANCE TERM:" TO MESS.
           PERFORM SEND-LEGEND.
           IF I-LEVEL > 4 AND GP-OT-INS-TERM = "Y"
              MOVE "RNNN060  2." TO VDU
           ELSE
              MOVE "RNNN030  2." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-IC-OURS.
           IF VDUSTATUS NOT = "00" AND NOT = "1D"
              GO TO ENTER-IC-TERM.
           IF ( VDUNUM0 > 360 )
              GO TO ENTER-IC-TERM.
           MOVE VDUNUM0 TO PD-INSTRM(I-LEVEL).
       SEND-IC-TERM.
           IF I-LEVEL > 4 AND GP-OT-INS-TERM = "Y"
              MOVE "SN N060  2." TO VDU
           ELSE
              MOVE "SN N030  2." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INSTRM(I-LEVEL) TO VDUNUM0.
           PERFORM SCREENIO.
           GO TO ENTER-IC-COVR.
       ENTER-IC-EXP.
           IF IC-CODE = 0
              MOVE 0 TO PD-INSEXP-DATE(I-LEVEL)
              GO TO SEND-IC-EXP.
           MOVE
           "^-BACK, ENTER THE INSURANCE EXPIRATION DATE(MMDDYY):"
                                                             TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "RNNN060  2." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-IC-OURS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-IC-EXP.
           IF VDUNUM0 = 0
              GO TO ENTER-IC-EXP.

           MOVE VDUNUM0 TO DATE-MMDDYY.
           PERFORM CONVERT-MMDDYY-TO-YYYYMMDD.
           MOVE DATE-YYYYMMDD TO PD-INSEXP-DATE(I-LEVEL)
                                 NUM-DATE.
           PERFORM TSTDAT.
           IF NUM-DATE = 0
              MOVE "INVALID DATE" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-IC-EXP.
       SEND-IC-EXP.
           MOVE "SNNN060  2." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INSEXP-DATE(I-LEVEL) TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO VDUNUM0.
           PERFORM SCREENIO.
       ENTER-IC-COVR.
           IF IC-CODE = 0
              MOVE 0 TO PD-INSCOVR(I-LEVEL)
              GO TO SEND-IC-COVR.
           MOVE "^-BACK, ENTER THE INSURANCE COVERAGE:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "RNNN062  3." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-IC-TERM.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-IC-COVR.

      * REGACC PR# 984
      * TEST PASSWD TO CHANGE CALCULATED COVERAGE ON CL,AH,O1
           IF I-LEVEL = 1 OR 2 OR 4
              IF VDUNUM2 NOT = PD-INSCOVR(I-LEVEL)
                 MOVE INSCOVR-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE INS. COVERAGE...:" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "SN N062  3." TO VDU
                    MOVE ELE TO VDUROW
                    MOVE PD-INSCOVR(I-LEVEL) TO VDUNUM2
                    PERFORM SCREENIO
                    MOVE 9 TO IO-FG
                    GO TO ENTER-IC-COVR.

           MOVE VDUNUM2 TO PD-INSCOVR(I-LEVEL).
       SEND-IC-COVR.
           MOVE "SN N062  3." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INSCOVR(I-LEVEL) TO VDUNUM2.
           PERFORM SCREENIO.
       ENTER-IC-PREM.
           MOVE " " TO PREM-CHANGE.
           MOVE PD-INSPREM(I-LEVEL) TO PREM-AMOUNT.
           IF IC-CODE = 0
              MOVE 0 TO PD-INSPREM(I-LEVEL)
                        PD-INSCOMM(I-LEVEL)
              IF ELE = 32
                 MOVE 0 TO PD-O3INS-DLPROC
              END-IF
              GO TO SEND-IC-PREM.
           IF ELE = 32
              IF ((BR-SFDLO3-WINDOW-FG NOT =  "N")
                             AND (PD-INSOURS(I-LEVEL) = "Y"))
                             OR  (BR-SFDLO3-WINDOW-FG = "B")
                 MOVE PD-INSPREM(I-LEVEL) TO SFDLO3-PREM
                 MOVE PD-INSCOMM(I-LEVEL) TO SFDLO3-COMM
                 MOVE PD-O3INS-DLPROC TO SFDLO3-DLPROC
                 MOVE PD-ORGST TO SFDLO3-ORGST
                 MOVE "CL/SFDLO3" TO FORM-NAM
                 CALL FORM-PROGX USING FORM-PATH SFDLO3-WORKERS
                 CANCEL FORM-PROGX
                 MOVE SFDLO3-PREM TO PD-INSPREM(I-LEVEL)
                 MOVE SFDLO3-COMM TO PD-INSCOMM(I-LEVEL)
                 MOVE SFDLO3-DLPROC TO PD-O3INS-DLPROC
                 MOVE "SN N042  4." TO VDU
                 MOVE ELE TO VDUROW
                 MOVE PD-INSPREM(I-LEVEL) TO VDUNUM2
                 PERFORM SCREENIO
                 GO TO VERIFY-IC-PREM
              ELSE
                 MOVE 0 TO PD-INSCOMM(I-LEVEL)
                           PD-O3INS-DLPROC.

           MOVE "^-BACK, ENTER THE INSURANCE PREMIUM:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "RNNN042  4." TO VDU.
           MOVE ELE TO VDUROW.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-IC-COVR.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-IC-PREM.
      * REGWAN PR# 3935
      * TEST PASSWD TO CHANGE CALCULATED PREMIUM ON PP
           IF I-LEVEL = 3
              IF VDUNUM2 NOT = PD-INSPREM(I-LEVEL)
                 MOVE PP-PREM-SEQ TO PASSWDW-SEQ
                 MOVE "TO CHANGE INS. PREMIUM...:" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "SN N042  4." TO VDU
                    MOVE ELE TO VDUROW
                    MOVE PD-INSPREM(I-LEVEL) TO VDUNUM2
                    PERFORM SCREENIO
                    MOVE 9 TO IO-FG
                    GO TO ENTER-IC-PREM.

           MOVE VDUNUM2 TO PD-INSPREM(I-LEVEL).
       SEND-IC-PREM.
           MOVE "SN N042  4." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-INSPREM(I-LEVEL) TO VDUNUM2.
           PERFORM SCREENIO.
           IF PD-INSPREM(I-LEVEL) NOT = PREM-AMOUNT
              MOVE "Y" TO PREM-CHANGE.

           MOVE I-LEVEL TO ICOMM.
           MOVE PD-INSCOMP(I-LEVEL) TO ICOMM-INSCOMP.
           MOVE PD-INSPREM(I-LEVEL) TO ICOMM-INSPREM.
           MOVE PD-INSOURS(I-LEVEL) TO ICOMM-INSOURS.
           PERFORM ICOMM-CALCULATION.
           MOVE ICOMM-INSCOMM TO PD-INSCOMM(I-LEVEL).

       VERIFY-IC-PREM.
           IF PD-INSPREM(I-LEVEL) = ZEROS
              MOVE ZEROS TO PD-INSCOMP(I-LEVEL)
                            PD-INSEFF-DATE(I-LEVEL)
                            PD-INSEXP-DATE(I-LEVEL)
                            PD-INSCOVR(I-LEVEL)
                            PD-INSCOMM(I-LEVEL)
              MOVE SPACES TO PD-INSOURS(I-LEVEL).

       EXIT-ENTER-INSURANCE.
           EXIT.

      ******************************************************************
       CHECK-EFFECTIVE-SPR SECTION.
      ******************************************************************

           MOVE PD-ORGST    TO SP-ORGST
                               QSP1-WBEG-ORGST
                               QSP1-WEND-ORGST.
           MOVE PD-SPRCLASS TO SP-SPRCLASS
                               QSP1-WBEG-SPRCLASS
                               QSP1-WEND-SPRCLASS.
           MOVE PD-SUBCLASS TO SP-SUBCLASS
                               QSP1-WBEG-SUBCLASS
                               QSP1-WEND-SUBCLASS.
           MOVE 0           TO SP-LAWCODE
                               QSP1-WBEG-LAWCODE.
           MOVE ALL "9"     TO QSP1-WEND-LAWCODE.

           PERFORM START-SP1-FILE.
       CHECK-EFF-SPR-NEXT.
           PERFORM READ-SP1-FILE-NEXT.
           IF IO-FG = 9
              GO TO CHECK-EFF-SPR-EXIT.

           IF NOT (SP-ORGST = PD-ORGST AND
                     SP-SPRCLASS = PD-SPRCLASS AND
                       SP-SUBCLASS = PD-SUBCLASS)
              MOVE 9 TO IO-FG
              GO TO CHECK-EFF-SPR-EXIT.

           IF SP-EFFDATE > PD-LOANDATE
              GO TO CHECK-EFF-SPR-NEXT
           ELSE
              IF SP-EXPDATE = 0
                 GO TO CHECK-EFF-SPR-EXIT.

           IF SP-EXPDATE NOT > PD-LOANDATE
              GO TO CHECK-EFF-SPR-NEXT.

       CHECK-EFF-SPR-EXIT.
           EXIT.

      ******************************************************************
       TEST-GET-SP SECTION.
      ******************************************************************
           MOVE 1 TO FIRST-TIME.
           IF FIRST-ELE > 5
              PERFORM GET-SP.

      ******************************************************************
       SEND-PURCHASE-FIELDS SECTION.
      ******************************************************************
           IF PD-PURDATE = 0
              MOVE TRANS-DATE TO PD-PURDATE.

           MOVE PD-DLNO TO DL-DLNO.
           PERFORM GET-DL1.

           PERFORM COMPUTE-PRINCIPLE.
           PERFORM COMPUTE-PAYMENTS.
           PERFORM COMPUTE-INS-COVERAGE.
           PERFORM COMPUTE-INS-TERM.
           PERFORM COMPUTE-ANTICTERM.
           PERFORM COMPUTE-PURBAL.
           PERFORM COMPUTE-FINANCE-CHARGE.
           PERFORM SETUP-PURCHASE-FIELDS.
           PERFORM COMPUTE-ANTICIPATED.
           PERFORM COMPUTE-DEALER-CHECK.
           PERFORM CALC-YIELD.
           PERFORM SEND-X-LIST.
           PERFORM CALCULATE-APR.

       EXIT-SEND-PURCHASE-FIELDS.
           EXIT.

      ******************************************************************
       COMPUTE-INS-COVERAGE SECTION.
      ******************************************************************
           PERFORM LOAN-CALCULATIONS.

           IF PD-INSTYPES-LL
              IF PD-INSPREM(1) NOT = 0
                 MOVE "SN N062273." TO VDU
                 MOVE 3 TO SP-SUB
                 MOVE 1 TO PD-SUB
                 PERFORM SET-COVERAGE.
           IF PD-INSTYPES-DL
              IF PD-INSPREM(1) NOT = 0
                 MOVE "SN N062273." TO VDU
                 MOVE 1 TO SP-SUB
                 MOVE 1 TO PD-SUB
                 PERFORM SET-COVERAGE.
           IF PD-INSTYPES-AH
              IF PD-INSPREM(2) NOT = 0
                 MOVE "SN N062283." TO VDU
                 MOVE 5 TO SP-SUB
                 MOVE 2 TO PD-SUB
                 PERFORM SET-COVERAGE.
           IF PD-INSTYPES-PP OR PD-INSTYPES-PP2
              IF PD-INSPREM(3) NOT = 0
                 MOVE "SN N062293." TO VDU
                 MOVE 3 TO PD-SUB
                 IF PD-INSTYPES-PP
                    MOVE 6 TO SP-SUB
                    PERFORM SET-COVERAGE
                 ELSE
                    MOVE 7 TO SP-SUB
                    PERFORM SET-COVERAGE.
           IF PD-INSTYPES-O1
              IF PD-INSPREM(4) NOT = 0
                 MOVE "SN N062303." TO VDU
                 MOVE 8 TO SP-SUB
                 MOVE 4 TO PD-SUB
                 PERFORM SET-COVERAGE.
           GO TO COMPUTE-INS-COVERAGE-EXIT.

       SET-COVERAGE.
           IF PD-INSURED = "J"
              IF SP-SUB = 1 OR 3
                 ADD 1 TO SP-SUB.

           IF SP-INS-TOTAL-NOTE(SP-SUB)
              MOVE TOTAL-NOTE TO VDUNUM2 PD-INSCOVR(PD-SUB)
           ELSE
           IF SP-INS-PRINCIPAL(SP-SUB)
              MOVE DISCLOSED-FINAMT TO VDUNUM2 PD-INSCOVR(PD-SUB)
           ELSE
           IF SP-INS-CASH-ADVANCE(SP-SUB)
              MOVE CASH-ADVANCE TO VDUNUM2 PD-INSCOVR(PD-SUB)
           ELSE
           IF SP-INS-SP-CASH-ADVANCE(SP-SUB)
              MOVE SPCASH-ADVANCE TO VDUNUM2 PD-INSCOVR(PD-SUB)
           ELSE
           IF SP-INS-CASH-ADV-FEES(SP-SUB)
              COMPUTE PD-INSCOVR(PD-SUB) = CASH-ADVANCE - NONMEMO-FEES
              MOVE PD-INSCOVR(PD-SUB) TO VDUNUM2
           ELSE
           IF SP-INS-TOTAL-NOTE-EXT(SP-SUB)
              ADD TOTAL-NOTE PD-EXTCHG GIVING VDUNUM2
                                              PD-INSCOVR(PD-SUB)
           ELSE
           IF SP-INS-ALL(SP-SUB)
              MOVE TOTAL-REPAY TO VDUNUM2 PD-INSCOVR(PD-SUB)
           ELSE
           IF SP-INS-ADJ-PRINCIPAL(SP-SUB)
              MOVE ADJ-PRINCIPAL TO VDUNUM2 PD-INSCOVR(PD-SUB)
           ELSE
           IF SP-INS-BENEFIT-TERM(SP-SUB)
              COMPUTE PD-INSCOVR(PD-SUB) = TOTAL-NOTE / PD-ORGTERM
                                         * PD-INSTRM(PD-SUB)
              MOVE PD-INSCOVR(PD-SUB) TO VDUNUM2
           ELSE
           IF SP-INS-ADJ-CASH-ADVANCE(SP-SUB)
              MOVE HIGH-CREDIT TO VDUNUM2 PD-INSCOVR(PD-SUB)
           ELSE
           IF SP-INS-ADJ-PRIN-3PMTS(SP-SUB)
              COMPUTE PD-INSCOVR(PD-SUB) =
                  DISCLOSED-FINAMT + (3 * PD-REGPYAMT)
              MOVE PD-INSCOVR(PD-SUB) TO VDUNUM2
           ELSE
           IF SP-INS-AMTFIN-2PMTS(SP-SUB)
              COMPUTE PD-INSCOVR(PD-SUB) =
                  DISCLOSED-FINAMT + (2 * PD-REGPYAMT)
              MOVE PD-INSCOVR(PD-SUB) TO VDUNUM2
           ELSE
           IF SP-INS-AMTFIN-1PMTS(SP-SUB)
              COMPUTE PD-INSCOVR(PD-SUB) =
                  DISCLOSED-FINAMT + PD-REGPYAMT
              MOVE PD-INSCOVR(PD-SUB) TO VDUNUM2
           ELSE
           IF SP-INS-MIP(SP-SUB)
              IF PD-SUB = 1
                 MOVE SPCASH-ADVANCE TO VDUNUM2
                                        PD-INSCOVR(PD-SUB)
              ELSE
                 COMPUTE PD-INSCOVR(PD-SUB) =
                     TOTAL-NOTE / PD-ORGTERM
                               * PD-INSTRM(PD-SUB)
                 MOVE PD-INSCOVR(PD-SUB) TO VDUNUM2
              END-IF
           ELSE
           IF SP-INS-TN-INT-CL(SP-SUB)
              COMPUTE PD-INSCOVR(PD-SUB) =
                 PD-PROCEEDS + NONMEMO-FEES + PD-SERCHG
                    + (PD-PRBAL + PD-PRINTDUE - PD-PRFINCHGRB
                         - PD-PRINSRB) + PD-INSPREM(2) + PD-INSPREM(3)
                    + PD-INSPREM(4) + PD-INSPREM(5) + PD-INSPREM(6)
           ELSE
           IF SP-INS-TN-INT-SC-CL(SP-SUB)
              COMPUTE PD-INSCOVR(PD-SUB) = PD-PROCEEDS + NONMEMO-FEES
                    + PD-INSPREM(2) + PD-INSPREM(3)
                    + PD-INSPREM(4) + PD-INSPREM(5) + PD-INSPREM(6)
           ELSE
           IF SP-INS-NET-PAYOFF(SP-SUB)
              MOVE DISCLOSED-FINAMT TO PD-INSCOVR(PD-SUB)
           ELSE
              MOVE 0 TO VDUNUM2 PD-INSCOVR(PD-SUB).

           IF SP-INS-MAX-TERM-BENEFIT(SP-SUB)
              IF PD-ORGTERM > SP-INSMAXTERM(SP-SUB)
                 IF PD-REGPYAMT > SP-INSMAXBENIF(SP-SUB)
      * BOTH TERM AND PAYMENT EXCEED MAX
                    COMPUTE PD-INSCOVR(PD-SUB) =
                     ( SP-INSMAXTERM(SP-SUB) * SP-INSMAXBENIF(SP-SUB) )
                                - PD-SUM-MAINTFEE - PD-EXTCHG
                    MOVE PD-INSCOVR(PD-SUB) TO VDUNUM2
                 ELSE
      * TERM EXCEEDS MAX BUT PAYMENT DOES NOT
                    COMPUTE PD-INSCOVR(PD-SUB) =
                          ( SP-INSMAXTERM(SP-SUB) * PD-REGPYAMT )
                                - PD-SUM-MAINTFEE - PD-EXTCHG
                    MOVE PD-INSCOVR(PD-SUB) TO VDUNUM2
              ELSE
                 IF PD-REGPYAMT > SP-INSMAXBENIF(SP-SUB)
      * TERM DOES NOT EXCEED MAX BUT PAYMENT DOES
                    COMPUTE PD-INSCOVR(PD-SUB) =
                          ( PD-ORGTERM * SP-INSMAXBENIF(SP-SUB) )
                                - PD-SUM-MAINTFEE - PD-EXTCHG
                    MOVE PD-INSCOVR(PD-SUB) TO VDUNUM2
                  ELSE
                     MOVE TOTAL-NOTE TO PD-INSCOVR(PD-SUB) VDUNUM2.

           PERFORM SCREENIO.

       COMPUTE-INS-COVERAGE-EXIT.
           EXIT.

      ******************************************************************
       COMPUTE-INS-TERM SECTION.
      ******************************************************************
           MOVE 0 TO I-LEVEL.
       COMPUTE-INS-TRM.
           IF I-LEVEL < 6
              ADD 1 TO I-LEVEL
              PERFORM COMPUTE-INS-TERM-I-LEVEL
              GO TO COMPUTE-INS-TRM.

      ******************************************************************
       COMPUTE-INS-TERM-I-LEVEL SECTION.
      ******************************************************************
           IF I-LEVEL = 1
              IF PD-INSCOMP(1) NOT = 0
                 MOVE 0 TO SUB
                 IF PD-INSURED = "J"
                    MOVE 1 TO SUB.

           IF I-LEVEL = 1
              IF PD-INSCOMP(1) NOT = 0
                 MOVE "SN N030272." TO VDU
                 IF PD-INSTYPES-DL
                    ADD 1 TO SUB
                    PERFORM SET-INSURANCE-TERM-VDU
                    MOVE VDUNUM0 TO PD-INSTRM(1)
                    PERFORM SCREENIO
                 ELSE
                    IF PD-INSTYPES-LL
                       ADD 3 TO SUB
                       PERFORM SET-INSURANCE-TERM-VDU
                       MOVE VDUNUM0 TO PD-INSTRM(1)
                       PERFORM SCREENIO.

           IF I-LEVEL = 2
              IF PD-INSCOMP(2) NOT = 0
                 IF PD-INSTYPES-AH
                    MOVE "SN N030282." TO VDU
                    MOVE 5 TO SUB
                    PERFORM SET-INSURANCE-TERM-VDU
                    MOVE VDUNUM0 TO PD-INSTRM(2)
                    PERFORM SCREENIO.

           IF I-LEVEL = 3
              IF PD-INSCOMP(3) NOT = 0
                 MOVE "SN N030292." TO VDU
                 IF PD-INSTYPES-PP
                    MOVE 6 TO SUB
                    PERFORM SET-INSURANCE-TERM-VDU
                    MOVE VDUNUM0 TO PD-INSTRM(3)
                    PERFORM SCREENIO
                 ELSE
                    IF PD-INSTYPES-PP2
                       MOVE 7 TO SUB
                       PERFORM SET-INSURANCE-TERM-VDU
                       MOVE VDUNUM0 TO PD-INSTRM(3)
                       PERFORM SCREENIO.

           IF I-LEVEL = 4
              IF PD-INSCOMP(4) NOT = 0
                 IF PD-INSTYPES-O1
                    MOVE "SN N030302." TO VDU
                    MOVE 8 TO SUB
                    PERFORM SET-INSURANCE-TERM-VDU
                    MOVE VDUNUM0 TO PD-INSTRM(4)
                    PERFORM SCREENIO.

           IF I-LEVEL = 5
              IF PD-INSCOMP(5) NOT = 0
                 IF GP-OT-INS-TERM = "Y"
                    MOVE "SNNN060312." TO VDU
                    MOVE 9 TO SUB
                    PERFORM SET-INSURANCE-TERM-VDU
                    MOVE VDUNUM0 TO PD-INSTRM(5)
                    PERFORM SCREENIO
                 ELSE
                    MOVE PD-INTDATE TO NDTE-DATE
                    MOVE PD-ORGTERM TO NDTE-HOLD
                    PERFORM INCREMENT-UNITPER
                    MOVE "SNNN060312." TO VDU
                    MOVE NDTE-DATE TO DATE-YYYYMMDD
                                      PD-INSEXP-DATE(5)
                    PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
                    MOVE DATE-MMDDYY TO VDUNUM0
                    PERFORM SCREENIO.

           IF I-LEVEL = 6
              IF PD-INSCOMP(6) NOT = 0
                 IF GP-OT-INS-TERM = "Y"
                    MOVE "SNNN060322." TO VDU
                    MOVE 10 TO SUB
                    PERFORM SET-INSURANCE-TERM-VDU
                    MOVE VDUNUM0 TO PD-INSTRM(6)
                    PERFORM SCREENIO
                 ELSE
                    MOVE PD-INTDATE TO NDTE-DATE
                    MOVE PD-ORGTERM TO NDTE-HOLD
                    PERFORM INCREMENT-UNITPER
                    MOVE "SNNN060322." TO VDU
                    MOVE NDTE-DATE TO DATE-YYYYMMDD
                                      PD-INSEXP-DATE(6)
                    PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
                    MOVE DATE-MMDDYY TO VDUNUM0
                    PERFORM SCREENIO.

      ******************************************************************
       SET-INSURANCE-TERM-VDU SECTION.
      ******************************************************************
           IF SP-INSURE-EXT-PERIOD(SUB)
              PERFORM EXTENSION-DAYS-CALCULATION
              IF EDAY-MONTHS > 0
                 COMPUTE VDUNUM0 = EDAY-MONTHS + PD-ORGTERM
              ELSE
                 MOVE PD-ORGTERM TO VDUNUM0
           ELSE
              MOVE PD-ORGTERM TO VDUNUM0.

      ******************************************************************
       COMPUTE-PAYMENTS SECTION.
      ******************************************************************
           IF PD-REGPYAMT-FG NOT = " "
              GO TO COMPUTE-PAYMENTS-EXIT.

           MOVE 0 TO PD-NOREGPY
                     PD-REGPYAMT
                     PD-LASTPYAMT.
           IF PD-LOANTYPE = "I"
              COMPUTE REGPY-WK = PD-LNAMT + PD-INTCHG
           ELSE
              COMPUTE REGPY-WK = PD-LNAMT - PD-EXTCHG
                                  - (PD-MAINTFEE * PD-ORGTERM).

           IF SP-IRREGULAR-PAY-FG = "L"
              PERFORM COMPUTE-PAYMENTS-ODD-LAST
           ELSE
              PERFORM COMPUTE-PAYMENTS-ODD-FIRST.

       COMPUTE-PAYMENTS-EXIT.
           MOVE PD-REGPYAMT TO PD-SUM-REGPYAMT.

      ******************************************************************
       COMPUTE-PAYMENTS-ODD-FIRST SECTION.
      ******************************************************************
           DIVIDE REGPY-WK BY PD-ORGTERM GIVING REGPY-WK
                                            REMAINDER ODDPY-WK.

           ADD REGPY-WK ODDPY-WK PD-EXTCHG PD-MAINTFEE
                                         GIVING PD-1STPYAMT.
           ADD PD-MAINTFEE TO REGPY-WK.
           IF PD-ORGTERM = 1
              MOVE REGPY-WK TO PD-REGPYAMT
           ELSE
              MOVE REGPY-WK TO PD-REGPYAMT
                             PD-LASTPYAMT
              IF PD-ORGTERM > 2
                 SUBTRACT 2 FROM PD-ORGTERM GIVING PD-NOREGPY.

      ******************************************************************
       COMPUTE-PAYMENTS-ODD-LAST SECTION.
      ******************************************************************
           DIVIDE REGPY-WK BY PD-ORGTERM
                            GIVING REGPY-TEMP-WK
                                     REMAINDER ODDPY-WK.
           IF ODDPY-WK = 0
              MOVE REGPY-TEMP-WK TO REGPY-WK
           ELSE
              COMPUTE ODDPY-WK = REGPY-WK
                  - ((REGPY-TEMP-WK + .01) * PD-ORGTERM)
              ADD 0.01 REGPY-TEMP-WK GIVING REGPY-WK.

           ADD REGPY-WK PD-EXTCHG PD-MAINTFEE
                                     GIVING PD-1STPYAMT.
           ADD PD-MAINTFEE TO REGPY-WK.
           IF PD-ORGTERM = 1
              ADD ODDPY-WK TO PD-1STPYAMT
              MOVE REGPY-WK TO PD-REGPYAMT
           ELSE
              MOVE REGPY-WK TO PD-REGPYAMT
                               PD-LASTPYAMT
              ADD ODDPY-WK TO PD-LASTPYAMT
              IF PD-ORGTERM > 2
                 SUBTRACT 2 FROM PD-ORGTERM GIVING PD-NOREGPY.

      ******************************************************************
       COMPUTE-FINANCE-CHARGE SECTION.
      ******************************************************************
           COMPUTE PD-FINCHG = PD-INTCHG + PD-EXTCHG
                          + PD-SERCHG
                          + (PD-MAINTFEE * PD-ORGTERM).
           PERFORM LOAN-CALCULATIONS.
           ADD TOTAL-INSFINCHG TOTAL-FEEFINCHG TO PD-FINCHG.

           IF PD-FINCHG < SP-MINSF-CHG
              MOVE "FINANCE CHARGE BELOW MINIMUM" TO MESS
              PERFORM SEND-MESS.

           MOVE PD-FINCHG TO PD-SUM-FINCHG.

      ******************************************************************
       CALCULATE-APR SECTION.
      ******************************************************************

      * CALCULATE EXCEPT WHEN MANUAL OVERRIDE OCCURS:
           IF CALCULATE-APR-FG = "N"
              GO TO CALCULATE-APR-EXIT.

           PERFORM COMPUTE-MEMO-OURS-NOTOURS.

           COMPUTE APR-FINANCED =
                 PD-SELLPR + NON-MEMO-CHGS
                    + PD-PRBAL + PD-PRINTDUE
                     - PD-PRFINCHGRB - PD-PRINSRB.
           IF BR-DOWNPY-FLAG NOT = "Y"
              SUBTRACT PD-DOWNPY PD-TRADEIN FROM APR-FINANCED.
           PERFORM LOAN-CALCULATIONS.
           SUBTRACT TOTAL-INSFINCHG TOTAL-FEEFINCHG
                                            FROM APR-FINANCED.

      * JTG 032296
      * ADDED 'IF' TO STOP LOANS WITH ZERO FINANCE CHARGES,
      * ODD FIRST OR LAST PAYMENTS AND DISCLOSURE FORMULA 'B'
      * FROM RETURNING .0XX APRS:
           IF APR-FINANCED = (PD-1STPYAMT
                                  + (PD-NOREGPY * PD-REGPYAMT)
                                   + PD-LASTPYAMT
                             )
              MOVE 0 TO APR-APR
           ELSE
              MOVE PD-ORGTERM TO APR-ORGTERM
              MOVE PD-1STPYAMT TO APR-1STPYAMT
              MOVE PD-REGPYAMT TO APR-REGPYAMT
              MOVE PD-LASTPYAMT TO APR-LASTPYAMT
              MOVE PD-INTDATE TO APR-INTDATE
              MOVE PD-1STPYDATE TO APR-1STPYDATE
              MOVE PD-UNITPER-CD TO APR-UNITPER-CD
              MOVE PD-UNITPER-FREQ TO APR-UNITPER-FREQ
              MOVE SP-DISFRMLA TO APR-DISFRMLA
              PERFORM APR-REGZ.

           COMPUTE VDUNUM2 ROUNDED = APR-APR.
           MOVE VDUNUM2 TO PD-APRATE.

           MOVE "SN N033200." TO VDU.
           MOVE PD-APRATE TO VDUNUM3.
           PERFORM SCREENIO.

           MOVE "S  A010201." TO VDU.
           PERFORM SCREENIO.

       CALCULATE-APR-EXIT.
           EXIT.

      ******************************************************************
       TEST-PAY SECTION.
      ******************************************************************
           MOVE " " TO TEST-PAY-FG.
           IF PD-ORGTERM = 1
              IF PD-LASTPYAMT NOT = 0
                 MOVE "E" TO TEST-PAY-FG
                 MOVE "LAST PAYMENT MUST BE ZERO" TO MESS
                 PERFORM SEND-MESS.
           IF PD-ORGTERM > 1
              IF NOT (PD-1STPYAMT > 0
                          AND PD-REGPYAMT > 0
                            AND PD-LASTPYAMT > 0
                     )
                 MOVE "E" TO TEST-PAY-FG
                 MOVE "FIRST, REGULAR OR LAST PAYMENT CAN'T BE ZERO"
                                                               TO MESS
                 PERFORM SEND-MESS.

           SUBTRACT 1 FROM PD-ORGTERM GIVING PD-NOREGPY.
           IF PD-LASTPYAMT NOT = 0
              SUBTRACT 1 FROM PD-NOREGPY.

           PERFORM LOAN-CALCULATIONS.
           IF HOLD-TOTAL-REPAY NOT = TOTAL-REPAY
              MOVE "E" TO TEST-PAY-FG
              MOVE "PAYMENTS DO NOT NET TO LOAN AMOUNTS" TO MESS
              PERFORM SEND-MESS.

       TEST-PAY-EXIT.
           EXIT.

      ******************************************************************
       MEMO-ENTRY SECTION.
      ******************************************************************
           PERFORM SEND-MEMO.
       ENTER-MEMO.
           MOVE "E  A300M2." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS NOT = "00"
              GO TO ENTER-MEMO.
           MOVE VDUBUF TO PD-MESSAGE.
           IF PD-MESSAGE = " "
              MOVE "-------" TO VDUBUF
              MOVE "S  A070M1." TO VDU
              PERFORM SCREENIO
              MOVE "------------------------------" TO VDUBUF
              MOVE "S  A300M2." TO VDU
              PERFORM SCREENIO.

      *******************************************************
      *    GET-LPDLADJ
      *    PERFORM LPDLADJ TO GET INSURANCE PREMIUM ADJUSTMENTS
      *    DLADJ-INSADJ-OURS:
      *         > 0 (THE DEALER'S PREMIUMS WERE TO HIGH)
      *         < 0 (THE DEALER'S PREMIUMS WERE TO LOW)
      *******************************************************
      ******************************************************************
       GET-LPDLADJ SECTION.
      ******************************************************************
           MOVE " " TO IO-FG.
           MOVE 0 TO PD-INSPREM-DLADJ.

           PERFORM VARYING DLADJ FROM 1 BY 1 UNTIL DLADJ > 4
              MOVE PD-INSTBL(DLADJ) TO HOLD-INSTBL(DLADJ)
           END-PERFORM.

           PERFORM LPDLADJ.
           IF DLADJ-INSADJ-OURS = 0
              GO TO GET-LPDLADJ-EXIT.

           ADD DLADJ-INSADJ-OURS TO PD-PROCEEDS.
           MOVE DLADJ-INSADJ-OURS TO PD-INSPREM-DLADJ.
           PERFORM GET-LPDLADJ-SET-INS
                VARYING DLADJ FROM 1 BY 1
                  UNTIL DLADJ > 4.

      * INSURE DEALER PROCEEDS WILL NOT GO NEGATIVE:
           IF PD-PROCEEDS < 0
              MOVE
           "DEALER INSURANCE ADJUSTMENT WILL CAUSE, NEGATIVE PROCEEDS"
                                                TO MESS
              PERFORM SEND-MESS
              MOVE "CAN'T UPDATE LOAN" TO MESS
              PERFORM SEND-MESS
              MOVE 0 TO PD-INSPREM-DLADJ
              SUBTRACT DLADJ-INSADJ-OURS FROM PD-PROCEEDS
              PERFORM RESTORE-INPUTED-INS
                   VARYING DLADJ FROM 1 BY 1
                        UNTIL DLADJ > 4
              MOVE "N" TO IO-FG.

           GO TO GET-LPDLADJ-EXIT.

       GET-LPDLADJ-SET-INS.
           MOVE COP-INS-PREMIUM(DLADJ) TO PD-INSPREM(DLADJ).
           MOVE COP-INS-TERM(DLADJ) TO PD-INSTRM(DLADJ).
           MOVE COP-INS-COVERAGE(DLADJ) TO PD-INSCOVR(DLADJ).

       GET-LPDLADJ-EXIT.
           EXIT.

      *******************************************************
       RESTORE-INPUTED-INS SECTION.
      *******************************************************
           MOVE HOLD-INSTBL(DLADJ) TO PD-INSTBL(DLADJ).

      *******************************************************
       NEW-RECORD-SETUP SECTION.
      *******************************************************

           MOVE 1 TO NEW-FLAG.
           PERFORM CLEAR-PD-FILE.

           MOVE 1 TO ELE.
           MOVE BR-STATE TO DEF-ORGST
                            PD-ORGST
                            PD-OWNST.
           MOVE BRANCH TO DEF-ORGBR
                          PD-ORGBR
                          PD-OWNBR.

           MOVE "SR"   TO CD-TYPE.
           IF GP-THE-ONLY-SF-SRCD NOT = " "
              MOVE GP-THE-ONLY-SF-SRCD TO DEF-SRCD
                                          PD-SRCD
                                          CD-CODE
              MOVE "N" TO  CHFG(10)
           ELSE
              MOVE "NB" TO DEF-SRCD
                           PD-SRCD
                           CD-CODE
              MOVE " " TO CHFG(10).
           MOVE 10 TO ELE.
           PERFORM SEND-CD-DESC.

           IF BR-DEFAULT-SF-PURCD = " "
              MOVE SPACES TO DEF-PURCD
              MOVE " " TO CHFG(7)
           ELSE
              MOVE "N" TO CHFG(7)
              MOVE "PU"                TO CD-TYPE
              MOVE BR-DEFAULT-SF-PURCD TO DEF-PURCD
                                          PD-PURCD
                                          CD-CODE
              MOVE 7 TO ELE
              PERFORM SEND-CD-DESC
              IF IO-FG = 9
                 MOVE " " TO CHFG(7).

      * IF I DONT DO WEEKLY/BIWEEKLY
           IF BR-UNITPER-FG NOT = "Y"
              MOVE "N" TO CHFG(14)
              MOVE "M" TO BR-DEFAULT-SF-UNITPER-CD
              MOVE BR-DEFAULT-SF-UNITPER-CD TO DEF-UNITPER-CD
                                               PD-UNITPER-CD
           ELSE
              IF BR-DEFAULT-SF-UNITPER-CD = " "
                 MOVE "_" TO DEF-UNITPER-CD
                 MOVE " " TO CHFG(14)
              ELSE
                 IF NOT (BR-DEFAULT-SF-UNITPER-CD = "M"
                                                  OR "W"
                                                   OR "B"
                                                    OR "S")
                    MOVE "N" TO CHFG(14)
                    MOVE "M" TO BR-DEFAULT-SF-UNITPER-CD
                    MOVE BR-DEFAULT-SF-UNITPER-CD TO DEF-UNITPER-CD
                                                     PD-UNITPER-CD
                 ELSE
                    MOVE "N" TO CHFG(14)
                    MOVE BR-DEFAULT-SF-UNITPER-CD TO DEF-UNITPER-CD
                                                     PD-UNITPER-CD.
           MOVE 1 TO DEF-UNITPER-FREQ
                     PD-UNITPER-FREQ.


      *    CALL XFER USING STAT DEF-LIST DEF-BUF.
      *    CALL WRFORM USING STAT DEF-LIST.
           MOVE DEF-LIST TO WR-LIST.
           MOVE DEF-BUF  TO WR-BUF.
           PERFORM CALL-WRFORM.

           MOVE "C" TO PD-DLRVPRIN-FG(1)
                       PD-DLRVPRIN-FG(2)
                       PD-DLRVPRIN-FG(3)
                       PD-DLRVCHGS-FG(1)
                       PD-DLRVCHGS-FG(2)
                       PD-DLRVCHGS-FG(3)
                       PD-DLPARVHELD-FG
                       PD-DLPARVPAID-FG
                       PD-DLDISC-FG.

           IF GP-DLRVPRIN-1-FG NOT = "Y"
              MOVE "I" TO PD-DLRVPRIN-FG(1).
           IF GP-DLRVPRIN-2-FG NOT = "Y"
              MOVE "I" TO PD-DLRVPRIN-FG(2).
           IF GP-DLRVPRIN-3-FG NOT = "Y"
              MOVE "I" TO PD-DLRVPRIN-FG(3).
           IF GP-DLRVCHGS-3-FG NOT = "Y"
              MOVE "I" TO PD-DLRVCHGS-FG(3).
      *    IF BR-USE-PARTIC-FLAT-TABLE = "Y"
      *       IF DL-USE-PARTIC-FLAT-TABLE = "Y"
      *          MOVE "I" TO PD-DLPARVHELD-FG.

           MOVE 999.99 TO PD-SERVPER.
           MOVE 999.999 TO PD-ENDORATE
                           PD-OVRDRATE.
           MOVE "N" TO CHFG(10) CHFG(16) CHFG(18)
                       CHFG(19) CHFG(20) CHFG(21)
                       PD-DLRECOURSE.

           IF GP-USE-CONRATE = "Y"
              MOVE " " TO CHFG(19).

           MOVE " " TO CHFG(33) CHFG(38) CHFG(39).
           MOVE "Y" TO CALCULATE-APR-FG.
           MOVE 0 TO ELE
                     PRIOR-LNAMT.

           PERFORM CREATE-TRAILER.

      *******************************************************
       DISPLAY-FIELDS SECTION.
      *******************************************************
           MOVE " " TO DISPLAY-BUF1
                       DISPLAY-BUF2
                       X-BUF
                       DEF-BUF
                       PRIOR-LOAN-STAT.
           MOVE PD-CLASS TO LC-CODE
                            D-LCNO.
           PERFORM GET-SP.

      * NEED FOR APPROVAL
           PERFORM LOAN-CALCULATIONS.

           PERFORM GET-LC.
           MOVE LC-DESC TO D-LC-DESC.

           IF QUOTE-ID-FG = "Q"
              GO TO DISP-SKIP-BW.

           MOVE 1 TO ELE.
       DISP-NEXT-BW.
           MOVE PD-SSNO(ELE) TO BW-SSNO.
           PERFORM NUMBW-TO-ALPBW.
           MOVE " " TO BW-LNAME
                       BW-FNAME.
           IF BW-SSNO NOT = 0
              PERFORM GET-BW1
              MOVE ALP-BW TO D-010(ELE)
              MOVE INSPECT-W TO D-011(ELE)
              MOVE PD-MAKERCD(ELE) TO D-012(ELE).
           IF ELE < 4
              ADD 1 TO ELE
              GO TO DISP-NEXT-BW.

       DISP-SKIP-BW.
           IF PD-PRLNNO NOT  = 0
              PERFORM D12-PROCESS-PRIOR-LN
              IF ERROR-IN-PRIOR-LOAN
                 MOVE 9999999.99 TO D-111
                 MOVE " " TO D-112
              ELSE
                 MOVE PRIOR-LNAMT TO D-111
                 MOVE " " TO D-112.
           MOVE PD-SUM-LNAMT TO D-LNAMT.
           MOVE PD-PROCEEDS TO D-PROCEEDS.

           IF GP-INCL-OTH-IN-EARNED-N
              COMPUTE D-ANTIC = PD-ANTICERN(1) + PD-ANTICERN(2)
                              + PD-ANTICERN(3) + PD-ANTICERN(4)
                              + PD-ANTICERN(5)
           ELSE
           IF GP-INCL-OTH-IN-EARNED-R
              COMPUTE D-ANTIC = PD-ANTICERN(1) + PD-ANTICERN(2)
                              + PD-ANTICERN(3) + PD-ANTICERN(5)
           ELSE
              COMPUTE D-ANTIC = PD-ANTICERN(1) + PD-ANTICERN(2)
                              + PD-ANTICERN(3) + PD-ANTICERN(4)
                              + PD-ANTICERN(5) + PD-ANTICERN(6).



      *JTG   + PD-ANTICERN(5) + PD-ANTICERN(6). PERSP-LNCOST-FRMLA 'D'
           MOVE PD-ORGST TO D-050.
           MOVE PD-ORGBR TO D-051.
           MOVE PD-SUBCLASS TO D-052.
           MOVE SP-DESC TO D-053.
           MOVE PD-LOANDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-060.

           MOVE "PU"     TO CD-TYPE.
           MOVE PD-PURCD TO CD-CODE D-070.
           PERFORM GET-CD.
           MOVE CD-DESC TO D-071.

           MOVE "CO"      TO CD-TYPE.
           MOVE PD-COLLCD TO CD-CODE D-080.
           PERFORM GET-CD.
           MOVE CD-DESC TO D-081.

           MOVE PD-COLLID TO D-090.
           MOVE PD-MSG1 TO D-091.
      *    MOVE PD-MSG2 TO D-092.
           IF NOT F3-YES
              PERFORM CREATE-TRAILER
              STRING PD-MSG1 PD-MSG2
                        DELIMITED BY "   " INTO WK-HHGS-1
               PERFORM SAVE-TRAILER-REC.

           MOVE "SR"    TO CD-TYPE.
           MOVE PD-SRCD TO CD-CODE D-100.
           PERFORM GET-CD.
           MOVE CD-DESC TO D-101.

           MOVE PD-PRLNNO TO W-LNNO D-110.

           MOVE "LOAN AMOUNT:" TO D-PPRIN.
           MOVE "ANTIC/CHECK:" TO D-ANTIC-DLCK.
      *    CALL XFER USING STAT DISPLAY-LIST1 DISPLAY-BUF1.
      *    CALL WRFORM USING STAT DISPLAY-LIST1.
           MOVE DISPLAY-LIST1 TO WR-LIST.
           MOVE DISPLAY-BUF1 TO WR-BUF.
           PERFORM CALL-WRFORM.

           IF BR-LC-CODE = "Y"
              MOVE PD-LC-CODE TO D-400.
           MOVE PD-DLNO TO D-120
                           DL-DLNO.
           PERFORM GET-DL1.
           MOVE DL-SHORT TO D-121.
           MOVE PD-DLRECOURSE TO D-130.
           PERFORM GET-RECOURSE-DESC.
           MOVE VDUBUF TO D-131.
           MOVE PD-DLPARTRCAMT TO D-132.
           MOVE PD-UNITPER-CD TO D-140.
           MOVE PD-UNITPER-FREQ TO D-141.
           MOVE PD-SUM-ORGTERM TO D-150.
           MOVE PD-INTDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-160.

           MOVE PD-1STPYDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO ALP-DATE-EDIT.
           MOVE PD-UNITPER-CD TO DATER-UNITPER-CD.
           MOVE PD-UNITPER-FREQ TO DATER-UNITPER-FREQ.
           PERFORM UNITPER-MASK.
           MOVE ALP-DATE-EDIT TO D-170.
           MOVE PD-CASHDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-180.
           MOVE PD-CONRATE TO D-190.
           MOVE PD-APRATE TO D-200.
           MOVE PD-OVRDRATE TO D-210.
           PERFORM CALC-YIELD.
           MOVE WS-YIELD TO D-YLD.
           MOVE PD-SELLPR  TO D-220.
           MOVE PD-DOWNPY  TO D-230.
           MOVE PD-TRADEIN TO D-231.
           MOVE PD-SUM-SERCHG TO D-240.
           MOVE PD-SUM-MAINTFEE TO D-241.
           MOVE PD-SUM-INTCHG TO D-250.
           MOVE PD-SUM-EXTCHG TO D-251.
           MOVE PD-INSCODES TO D-260.

           MOVE 1 TO ELE.
       DISP-NEXT-IC.
           MOVE PD-INSCOMP(ELE) TO D-1COMP(ELE).
           MOVE PD-INSPREM(ELE) TO D-1PREM(ELE).
           MOVE PD-INSTRM(ELE) TO D-1TERM(ELE).
           MOVE PD-INSCOVR(ELE) TO D-1COVR(ELE).
           MOVE PD-INSOURS(ELE) TO D-1IOURS(ELE).
           IF ELE < 4
              ADD 1 TO ELE
              GO TO DISP-NEXT-IC.

           MOVE 1 TO SUB.
           MOVE 5 TO ELE.
       DISP-NEXT-2IC.
           MOVE PD-INSCOMP(ELE) TO D-2COMP(SUB).
           MOVE PD-INSPREM(ELE) TO D-2PREM(SUB).
           IF GP-OT-INS-TERM = "Y"
              MOVE PD-INSTRM(ELE) TO D-2TERM(SUB)
           ELSE
              MOVE PD-INSEXP-DATE(ELE) TO DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY TO D-2EXP(SUB).
           MOVE PD-INSCOVR(ELE) TO D-2COVR(SUB).
           MOVE PD-INSOURS(ELE) TO D-2IOURS(SUB).
           IF ELE < 6
              ADD 1 TO ELE SUB
              GO TO DISP-NEXT-2IC.

           PERFORM SETUP-FEES-FOR-DISPLAY.

           MOVE PD-1STPYAMT TO D-350.
           MOVE PD-REGPYAMT TO D-351.
           MOVE PD-LASTPYAMT TO D-360.
           MOVE PD-PURDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO D-370.

           IF PD-DLRVPRIN(2) = 0
                   AND PD-DLRVPRIN(3) = 0
              MOVE PD-DLRVPRIN(1) TO D-380
           ELSE
              ADD PD-DLRVPRIN(1) PD-DLRVPRIN(2) PD-DLRVPRIN(3)
                                         GIVING D-380
              INSPECT D-380 REPLACING LEADING " " BY "*".

           IF PD-DLRVCHGS(2) = 0
                   AND PD-DLRVCHGS(3) = 0
              MOVE PD-DLRVCHGS(1) TO D-381
           ELSE
              ADD PD-DLRVCHGS(1) PD-DLRVCHGS(2) PD-DLRVCHGS(3)
                                         GIVING D-381
              INSPECT D-381 REPLACING LEADING " " BY "*".

           IF PD-DLPARVPAID = 0
              MOVE PD-DLPARVHELD TO D-390
           ELSE
              ADD PD-DLPARVHELD PD-DLPARVPAID GIVING D-390
              INSPECT D-390 REPLACING LEADING " " BY "*".

           MOVE PD-DLDISC TO D-391.
      *    CALL XFER USING STAT DISPLAY-LIST2 DISPLAY-BUF2.
      *    CALL WRFORM USING STAT DISPLAY-LIST2.
           MOVE DISPLAY-LIST2 TO WR-LIST.
           MOVE DISPLAY-BUF2 TO WR-BUF.
           PERFORM CALL-WRFORM.
           IF PD-MESSAGE NOT = " "
              PERFORM SEND-MEMO
              PERFORM ALARM.

           MOVE "N" TO INSELIG-DISPLAY-FG.
           PERFORM TEST-VALIDITY-OF-INSURANCES.

       EXIT-DISPLAY-FIELDS.
           EXIT.

      *******************************************************
       SETUP-FEES-FOR-DISPLAY SECTION.
      *******************************************************
           MOVE 1 TO SUB2 SUB.

       DISPLAY-NEXT-FEE.
           MOVE PD-FEECODE(SUB) TO D-1FEECD(SUB2).
           MOVE PD-FEEAMT(SUB) TO D-1FEEAMT(SUB2).
           MOVE PD-FEEOURS(SUB) TO D-1FOURS(SUB2).
           ADD 1 TO SUB.
           MOVE PD-FEECODE(SUB) TO D-2FEECD(SUB2).
           MOVE PD-FEEAMT(SUB) TO D-2FEEAMT(SUB2).
           MOVE PD-FEEOURS(SUB) TO D-2FOURS(SUB2).
           IF SUB2 < 2
              ADD 1 TO SUB2
                       SUB
              GO TO DISPLAY-NEXT-FEE.

           IF PD-FEECODE(4) NOT = " "
              MOVE "->" TO D-2FEECD(2)
              ADD PD-FEEAMT(4) PD-FEEAMT(5)
                  PD-FEEAMT(6) PD-FEEAMT(7)
                  PD-FEEAMT(8) PD-FEEAMT(9)
                  PD-FEEAMT(10)
                         GIVING D-2FEEAMT(2)
              MOVE PD-FEEOURS(4) TO D-2FOURS(2)
              IF (PD-FEEOURS(5) NOT = " ")
                       AND (PD-FEEOURS(5) NOT = PD-FEEOURS(4))
                 MOVE "?" TO D-2FOURS(2)
              ELSE
              IF (PD-FEEOURS(6) NOT = " ")
                       AND (PD-FEEOURS(6) NOT = PD-FEEOURS(4))
                 MOVE "?" TO D-2FOURS(2)
              ELSE
              IF (PD-FEEOURS(7) NOT = " ")
                       AND (PD-FEEOURS(7) NOT = PD-FEEOURS(4))
                 MOVE "?" TO D-2FOURS(2)
              ELSE
              IF (PD-FEEOURS(8) NOT = " ")
                       AND (PD-FEEOURS(8) NOT = PD-FEEOURS(4))
                 MOVE "?" TO D-2FOURS(2)
              ELSE
              IF (PD-FEEOURS(9) NOT = " ")
                       AND (PD-FEEOURS(9) NOT = PD-FEEOURS(4))
                 MOVE "?" TO D-2FOURS(2)
              ELSE
              IF (PD-FEEOURS(10) NOT = " ")
                       AND (PD-FEEOURS(10) NOT = PD-FEEOURS(4))
                 MOVE "?" TO D-2FOURS(2).

      *******************************************************
       HI-CREDIT-ENTRY SECTION.
      *******************************************************
           MOVE " " TO IO-TYPE.
           IF BR-AVAIL-CREDIT NOT = "Y" AND NOT = "S"
              MOVE 0 TO PD-CREDITLIM PD-WCBC-CREDITLIM
              GO TO EXIT-HI-CREDIT.

           IF LC-CALC-HI-CREDIT NOT = "W"
              MOVE 0 TO PD-WCBC-CREDITLIM
              GO TO SKIP-WCBC-CREDITLIM.

       ENTER-WCBC-CREDITLIM.
           MOVE "^-BACK, ENTER WCBC CREDIT LIMIT:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "S  A060SEL." TO VDU.
           PERFORM SCREENIO.
           MOVE "EN N060CKNO." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              MOVE "RTN" TO IO-TYPE
              GO TO EXIT-HI-CREDIT.
           IF VDUSTATUS NOT = "00"
              MOVE "S  A060CKNO." TO VDU
              PERFORM SCREENIO
              GO TO HI-CREDIT-ENTRY.
           MOVE VDUNUM0 TO PD-WCBC-CREDITLIM.
           MOVE "S  A060CKNO." TO VDU.
           PERFORM SCREENIO.
           MOVE 0 TO PD-CREDITLIM.
           GO TO EXIT-HI-CREDIT.

       SKIP-WCBC-CREDITLIM.

           IF LC-CALC-HI-CREDIT = "C" OR "L" OR " "
              MOVE 0 TO PD-CREDITLIM
              GO TO EXIT-HI-CREDIT.

           MOVE "^-BACK, ENTER CREDIT LIMIT:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "S  A060SEL." TO VDU.
           PERFORM SCREENIO.

           MOVE "EN N060CKNO." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              MOVE "RTN" TO IO-TYPE
              GO TO EXIT-HI-CREDIT.
           IF VDUSTATUS NOT = "00"
              MOVE "S  A060CKNO." TO VDU
              PERFORM SCREENIO
              GO TO SKIP-WCBC-CREDITLIM.

           MOVE VDUNUM0 TO PD-CREDITLIM.
           IF PD-CREDITLIM = 0
              MOVE 0-CREDLIM-SEQ TO PASSWDW-SEQ
              MOVE "TO ALLOW ZERO (0) :" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO SKIP-WCBC-CREDITLIM.

           MOVE "S  A060CKNO." TO VDU.
           PERFORM SCREENIO.

       EXIT-HI-CREDIT.
           EXIT.

      *******************************************************
       ENTER-DEALER-CHECK-PAYCODE SECTION.
      *******************************************************
       ENTER-DEALER-CHK-PAYCD.
           MOVE " " TO IO-TYPE.
           IF TEST-PROCEEDS < 0
              MOVE "PROCEEDS CAN NOT BE LESS THAN 0" TO MESS
              PERFORM SEND-MESS
              MOVE "RTN" TO IO-TYPE
              GO TO EXIT-ENTER-DEALER-CHK-PAYCD.
           IF PD-PROCEEDS NOT > 0
      * SEE LONPB2 FOR SPECIAL VERIFICATION ON PD-PROCEEDS
              MOVE "B" TO PD-DLPAID
              GO TO EXIT-ENTER-DEALER-CHK-PAYCD.

           IF GP-ALLOW-MANUAL-CHECKS = "N"
              IF GP-ALLOW-BATCH-CHECKS = "N"
      * ^-BACK, DEALER CK: S-SYSTEM, F3-MULTIPLE CK:
                 MOVE CK-LEGEND-2-NO-M TO MESS
              ELSE
      * ^-BACK,DEALER CK: S-SYSTEM, B-BATCH, F3-MULTIPLE CK:
                 MOVE CK-LEGEND-NO-M TO MESS
           ELSE
              IF GP-ALLOW-BATCH-CHECKS = "N"
      * ^-BACK, DEALER CK: S-SYSTEM, M-MANUAL, F3-MULTIPLE CK:
                 MOVE CK-LEGEND-2 TO MESS
              ELSE
      * ^-BACK,DEALER CK: S-SYSTEM,M-MANUAL,B-BATCH,F3-MULTIPLE CK:
                 MOVE CK-LEGEND TO MESS.

           PERFORM SEND-LEGEND.
           MOVE "R RA060SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "16"
             IF (GP-DL-ACH-FG = "Y" AND DL-ACH-FG = "Y")
               MOVE ACH-NON-BATCH-SEQ TO PASSWDW-SEQ
               MOVE "FOR NON-BATCH ACH DISBURSEMENT:" TO PASSWDW-PROMPT2
               PERFORM PASSWORD-MUST-EXIST
               IF PASSWDW-STAT NOT = "OK"
                  MOVE
                  "PLEASE SELECT 'B' FOR DEALER DIRECT DEPOSIT CHECKS"
                     TO MESS
                  PERFORM SEND-MESS
                  GO TO ENTER-DEALER-CHK-PAYCD
               END-IF
             END-IF
             MOVE NON-BATCH-SEQ TO PASSWDW-SEQ
             MOVE "FOR NON-BATCH DISBURSEMENT:"
                 TO PASSWDW-PROMPT2
             PERFORM VERIFY-PASSWORD
             IF PASSWDW-STAT NOT = "OK"
                GO TO ENTER-DEALER-CHK-PAYCD
             ELSE
                MOVE "Y" TO MULTIPLE-CK-FG
                MOVE " " TO PD-DLPAID
                GO TO CALL-CHECK-DISBURSEMENTS.
           IF VDUSTATUS = "1U"
              MOVE "RTN" TO IO-TYPE
              GO TO EXIT-ENTER-DEALER-CHK-PAYCD.
           IF VDUSTATUS NOT = "00"
              GO TO ENTER-DEALER-CHK-PAYCD.
           IF BR-CALC-INS-ADJ = "Y"
              IF PD-INSPREM-DLADJ NOT = 0
                 MOVE
              "DEALER INS. PREMIUM ADJUSTMENT REQUIRED,"
                                                    TO MESS
                 PERFORM SEND-MESS
                 MOVE "SELECT MULTIPLE CHECK DISBURSEMENT!" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-DEALER-CHK-PAYCD.
           MOVE VDUBUF TO CHECK-PAYCODE.

           IF GP-ALLOW-BATCH-CHECKS = "N"
              IF CK-CODE = "B"
                 GO TO ENTER-DEALER-CHK-PAYCD.
           IF GP-ALLOW-MANUAL-CHECKS = "N"
              IF CK-CODE = "M"
                 GO TO ENTER-DEALER-CHK-PAYCD.

              IF (GP-DL-ACH-FG = "Y" AND DL-ACH-FG = "Y" AND
                  CK-CODE NOT = "B")
                  MOVE ACH-NON-BATCH-SEQ TO PASSWDW-SEQ
                  MOVE "FOR NON-BATCH ACH DISBURSEMENT:"
                                            TO PASSWDW-PROMPT2
                  PERFORM PASSWORD-MUST-EXIST
                  IF PASSWDW-STAT NOT = "OK"
                     MOVE
                    "PLEASE SELECT 'B' FOR DEALER DIRECT DEPOSIT CHECKS"
                        TO MESS
                     PERFORM SEND-MESS
                     GO TO ENTER-DEALER-CHK-PAYCD
                  END-IF
                  MOVE
                  "NOTE: DEALER IS ACH AND YOU ARE NOT SELECTING ACH"
                       TO MESS
                  PERFORM SEND-MESS.
           IF GP-DL-ACH-FG = "Y"
              IF DL-ACH-FG NOT = "Y"
                 IF CK-CODE = "B"
                    MOVE
                    "SELECT 'B' ONLY FOR DEALER DIRECT DEPOSIT CHECKS"
                       TO MESS
                    PERFORM SEND-MESS
                    GO TO ENTER-DEALER-CHK-PAYCD.
           IF CK-CODE = "S" OR "M" OR "B"
              MOVE CK-CODE TO PD-DLPAID
              MOVE "N" TO MULTIPLE-CK-FG
           ELSE
              GO TO ENTER-DEALER-CHK-PAYCD.

           IF CK-CODE = "B"
              GO TO EXIT-ENTER-DEALER-CHK-PAYCD.

           MOVE NON-BATCH-SEQ TO PASSWDW-SEQ.
           MOVE "FOR NON-BATCH DISBURSEMENT:" TO PASSWDW-PROMPT2.
           PERFORM VERIFY-PASSWORD.
           IF PASSWDW-STAT NOT = "OK"
              GO TO ENTER-DEALER-CHK-PAYCD.

       ENTER-CHECK-NO.
           IF CK-CODE NOT = "M"
              GO TO ENTER-FREE-TYPE.
           MOVE "^-BACK,  ENTER CHECK #:" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "S  A060SEL." TO VDU.
           PERFORM SCREENIO.
           MOVE "EN N060CKNO." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-DEALER-CHK-PAYCD.
           IF VDUSTATUS NOT = "00"
              GO TO ENTER-CHECK-NO.
           INSPECT VDUNUM0 REPLACING ALL " " BY "0".
           IF VDUNUM0 = 0
              MOVE "INVALID CHECK #" TO MESS
              PERFORM SEND-LEGEND
              GO TO ENTER-CHECK-NO.
           MOVE BRANCH TO CK-BRNO.
           MOVE VDUNUM0 TO PD-CKNO
                           CK-NO.
           PERFORM OPEN-CK1-FILE.
           PERFORM READ-CK1-FILE.
           PERFORM CLOSE-CK1-FILE.
           IF IO-FG = 0
              MOVE "CHECK ALREADY EXISTS!" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-CHECK-NO.

           IF BR-AUTO-CHECK = "Y"
              IF CK-NO NOT < BR-NEXT-CHECK
                 MOVE "INVALID MANUAL CHECK NUMBER" TO MESS
                 PERFORM SEND-MESS
                 GO TO ENTER-CHECK-NO.

           GO TO CALL-CHECK-DISBURSEMENTS.

       ENTER-FREE-TYPE.
           MOVE "^-BACK, FREE TYPING ON CHECK ? (Y/N):" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "R RA060SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO ENTER-DEALER-CHK-PAYCD.
           IF VDUSTATUS NOT = "00"
              GO TO ENTER-FREE-TYPE.
           IF VDUBUF = "     N"
              MOVE " " TO PD-FREE1
                          PD-FREE2
              GO TO CALL-CHECK-DISBURSEMENTS.
           IF VDUBUF NOT = "     Y"
              GO TO ENTER-FREE-TYPE.

           MOVE "WI/FTENT" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CK-FREE-TYPE-BUF.
           CANCEL FORM-PROGX.
           IF CK-FREE-RTNCD = "X"
              MOVE " " TO PD-FREE1
                          PD-FREE2
              GO TO ENTER-DEALER-CHK-PAYCD.
           MOVE CK-FREE-TYPE1 TO PD-FREE1.
           MOVE CK-FREE-TYPE2 TO PD-FREE2.

           MOVE " " TO MESS.
           PERFORM MSG-LINE.

       CALL-CHECK-DISBURSEMENTS.
           IF BR-CALC-INS-ADJ = "Y"
              IF PD-INSPREM-DLADJ NOT = 0
                 PERFORM DISPLAY-PREMIUM-WINDOW.

            PERFORM SAVE-SCREEN.
            MOVE PD-DLPAID TO PASS-DLPAID-FG.
            MOVE "WI/SFDISB" TO FORM-NAM.
            CALL FORM-PROGX USING FORM-PATH MULTIPLE-CK-FG
                                 PASS-DLPAID-FG PROG-BUF.
            MOVE PASS-DLPAID-FG TO PD-DLPAID.
            CANCEL FORM-PROGX.
            IF PASS-DLPAID-FG = "X"
               MOVE "RTN" TO IO-TYPE.

       EXIT-ENTER-DEALER-CHK-PAYCD.
           EXIT.

      *******************************************************
       CALC-YIELD SECTION.
      *******************************************************
           PERFORM COMPUTE-YIELD.
           MOVE "SN N033YLD." TO VDU.
           MOVE APR-APR TO VDUNUM3
                           WS-YIELD
                           PD-YLDRATE.
           PERFORM SCREENIO.

      *******************************************************
       SAVE-SCREEN SECTION.
      *******************************************************
           MOVE 1 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           IF MENU-RESUME = "Y"
              MOVE "N" TO MENU-RESUME
              IF WK-OLD-PROG-FORM = "  "
                 MOVE 99 TO MENU-FG
                 GO TO EXIT-SAVE-SCREEN
              ELSE
                 MOVE WK-OLD-PROG-FORM TO NEW-PROG-FORM
                                          OLD-PROG-FORM
                 MOVE " " TO WK-OLD-PROG-FORM.
           MOVE ELE TO WK-ELE.
           MOVE PD-RECORD TO WK-SAVE-RECORD.
           PERFORM REWRITE-WK-FILE.
        EXIT-SAVE-SCREEN.
           PERFORM CLOSE-WK-FILE.

      *******************************************************
       RESTORE-SCREEN SECTION.
      *******************************************************
           MOVE 1 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF NEW-PROG-FORM NOT = OLD-PROG-FORM
              MOVE OLD-PROG-FORM TO WK-OLD-PROG-FORM.
           MOVE NEW-PROG-FORM TO OLD-PROG-FORM.
           IF IO-FG = 0
              GO TO RESTORE-CLEAR.
           MOVE " " TO WK-SAVE-RECORD.
           MOVE 0 TO WK-ELE.

           PERFORM WRITE-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           GO TO EXIT-RESTORE-SCREEN.

       RESTORE-CLEAR.
           IF WK-ELE NOT = 0
              SUBTRACT 1 FROM WK-ELE GIVING FIRST-ELE.
           MOVE WK-SAVE-RECORD TO PD-RECORD.
           MOVE 0 TO WK-ELE.
           PERFORM REWRITE-WK-FILE.
       EXIT-RESTORE-SCREEN.
           IF FIRST-ELE = 0
              MOVE 0 TO NEW-FLAG
           ELSE
              MOVE 1 TO NEW-FLAG.
           PERFORM CLOSE-WK-FILE.

      *******************************************************
       RESTORE-TRAILER-REC SECTION.
      *******************************************************
           MOVE 6 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           PERFORM CLOSE-WK-FILE.

           PERFORM DISPLAY-TRAILER-REC.

      *******************************************************
       DISPLAY-TRAILER-REC SECTION.
      *******************************************************

      * INSPECT-X HOLDS FREE FROM BEFORE CALL
           IF INSPECT-X = WK-HHGS-1
              GO TO DISPLAY-TRAILER-REC-EXIT.

           MOVE "S  A300091." TO VDU.
           MOVE WK-HHGS-1 TO INSPECT-X.
           MOVE 1 TO IX1 IX2.
       DISPLAY-TRAILER-REC-1A.
           MOVE INSPECT-Z(IX1) TO VDUTAB(IX2).
           IF IX1 < 30
              ADD 1 TO IX1 IX2
              GO TO DISPLAY-TRAILER-REC-1A.
           PERFORM SCREENIO.

      * THIS IS DUMMY LOGIC SINCE NO ROOM FOR FIELD ON SCREEN:
           MOVE "S  A330092." TO VDU.
           MOVE 31 TO IX1.
           MOVE 1 TO IX2.
       DISPLAY-TRAILER-REC-1B.
           MOVE INSPECT-Z(IX1) TO VDUTAB(IX2).
           IF IX1 < 63
              ADD 1 TO IX1 IX2
              GO TO DISPLAY-TRAILER-REC-1B.
      *    PERFORM SCREENIO.
      * THIS IS DUMMY LOGIC SINCE NO ROOM FOR FIELD ON SCREEN:

       DISPLAY-TRAILER-REC-EXIT.
           EXIT.

      *******************************************************
       CREATE-TRAILER SECTION.
      *******************************************************
           MOVE 6 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF IO-FG = 0
              MOVE SPACES TO WK-SAVE-RECORD
              MOVE 0 TO WK-MILEAGE-1 WK-VALUE-1
                        WK-SELLPR-1 WK-MISC-AMT-1
                        WK-VIN-CHG-DATE-1
                        WK-MILEAGE-2 WK-VALUE-2
                        WK-SELLPR-2 WK-MISC-AMT-2
                        WK-VIN-CHG-DATE-2
                        WK-MILEAGE-3 WK-VALUE-3
                        WK-SELLPR-3 WK-MISC-AMT-3
                        WK-VIN-CHG-DATE-3
              PERFORM REWRITE-WK-FILE
              GO TO CLOSE-TRAILER.

           MOVE SPACES TO WK-SAVE-RECORD.
           MOVE 0 TO WK-MILEAGE-1 WK-VALUE-1
                     WK-SELLPR-1 WK-MISC-AMT-1
                     WK-VIN-CHG-DATE-1
                     WK-MILEAGE-2 WK-VALUE-2
                     WK-SELLPR-2 WK-MISC-AMT-2
                     WK-VIN-CHG-DATE-2
                     WK-MILEAGE-3 WK-VALUE-3
                     WK-SELLPR-3 WK-MISC-AMT-3
                     WK-VIN-CHG-DATE-3.

           MOVE 0 TO WK-ELE.

           PERFORM WRITE-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
       CLOSE-TRAILER.
           PERFORM CLOSE-WK-FILE.

      *******************************************************
       TEST-ALLOT-LBOX SECTION.
      *******************************************************

      * IF ANSWER TO "Y" TO ALLOTMENT THEN DO NOT ASK LOCK BOX QUESTION.
           PERFORM ACCOUNT-LBOX.
           IF IO-TYPE = "RTN"
              GO TO TEST-ALLOT-LBOX-EXIT.

           IF CK-CODE NOT = "Y"
              PERFORM ACCOUNT-ALLOTMENTS.

       TEST-ALLOT-LBOX-EXIT.
           EXIT.

      *******************************************************
       ACCOUNT-ALLOTMENTS SECTION.
      *******************************************************
       ACCT-ALLOT.
           MOVE " " TO PD-ALLOTCD IO-TYPE CK-CODE.
           IF BR-ALLOTMNTS NOT = "Y"
              GO TO ACCOUNT-ALLOT-EXIT.

           MOVE "^-BACK, IS ACCOUNT UNDER AN ALLOTMENT PLAN ?"
                                                        TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "R RA060SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              MOVE "RTN" TO IO-TYPE
              GO TO ACCOUNT-ALLOT-EXIT.
           IF VDUSTATUS NOT = "00"
              GO TO ACCT-ALLOT.
           MOVE VDUBUF TO CHECK-PAYCODE.
           IF CK-CODE = "Y"
              MOVE "Y" TO PD-ALLOTCD
           ELSE
              IF CK-CODE NOT = "N"
                 GO TO ACCT-ALLOT.
           MOVE " " TO MESS.
           PERFORM SEND-LEGEND.
       ACCOUNT-ALLOT-EXIT.
           EXIT.

      *******************************************************
       ACCOUNT-LBOX SECTION.
      *******************************************************

       ACCT-LBOX.

           MOVE " " TO PD-LBOX IO-TYPE CK-CODE.
           IF BR-LBOX NOT = "Y"
              GO TO ACCOUNT-LBOX-EXIT.

           MOVE "^-BACK, IS ACCOUNT UNDER A LOCK BOX PLAN ?" TO MESS.
           PERFORM SEND-LEGEND.

           MOVE "R RA060SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              MOVE "RTN" TO IO-TYPE
              GO TO ACCOUNT-LBOX-EXIT.
           IF VDUSTATUS NOT = "00"
              GO TO ACCT-LBOX.
           MOVE VDUBUF TO CHECK-PAYCODE.
           IF CK-CODE = "Y"
              MOVE "Y" TO PD-LBOX
           ELSE
              IF CK-CODE NOT = "N"
                 GO TO ACCT-LBOX.

           MOVE " " TO MESS.
           PERFORM SEND-LEGEND.

       ACCOUNT-LBOX-EXIT.
           EXIT.

      ********************************************
       GET-PRIOR-COLLATERAL SECTION.
      ********************************************

           PERFORM OPEN-LTC1-FILE.
           MOVE PD-OWNBR  TO LTC-BRNO.
           MOVE PD-PRLNNO TO LTC-ACCTNO
                             LN-ACCTNO.
           MOVE 1         TO LTC-SEQNO.
           PERFORM READ-LTC1-FILE.
      *    UNLOCK LTC-FILE.
           IF IO-FG NOT = 0
              MOVE SPACES TO WK-AUTO-1
              MOVE 0 TO WK-MILEAGE-1 WK-VALUE-1
                        WK-SELLPR-1 WK-MISC-AMT-1 WK-VIN-CHG-DATE-1
              MOVE SPACES TO WK-AUTO-2
              MOVE 0 TO WK-MILEAGE-2 WK-VALUE-2
                        WK-SELLPR-2 WK-MISC-AMT-2 WK-VIN-CHG-DATE-2
              MOVE SPACES TO WK-AUTO-3
              MOVE 0 TO WK-MILEAGE-3 WK-VALUE-3
                        WK-SELLPR-3 WK-MISC-AMT-3 WK-VIN-CHG-DATE-3
              MOVE SPACES TO WK-HHGS-1
              MOVE SPACES TO WK-HHGS-2
              MOVE SPACES TO WK-HHGS-3
           ELSE
              MOVE LTC-AUTO(1) TO WK-AUTO-1
              MOVE LTC-AUTO(2) TO WK-AUTO-2
              MOVE SPACES      TO WK-AUTO-3
              MOVE 0 TO WK-MILEAGE-3 WK-VALUE-3
                        WK-SELLPR-3 WK-MISC-AMT-3 WK-VIN-CHG-DATE-3
              MOVE LTC-HHGS(1) TO WK-HHGS-1
              MOVE LTC-HHGS(2) TO WK-HHGS-2
              MOVE LTC-HHGS(3) TO WK-HHGS-3.

           PERFORM CLOSE-LTC1-FILE.

           PERFORM OPEN-WK-FILE.
           MOVE 6 TO WK-KEY.
           PERFORM WRITE-WK-FILE.
           IF IO-FG = 9
              PERFORM REWRITE-WK-FILE.
           PERFORM CLOSE-WK-FILE.
           PERFORM DISPLAY-TRAILER-REC.

           MOVE "S  A020080." TO VDU.
           MOVE SAVED-PRIOR-COLLCD TO PD-COLLCD VDUBUF.
           PERFORM SCREENIO.

           MOVE "CO"      TO CD-TYPE.
           MOVE PD-COLLCD TO CD-CODE.
           PERFORM GET-CD.
           MOVE "S  A020081." TO VDU.
           MOVE CD-DESC TO VDUBUF.
           PERFORM SCREENIO.

           MOVE "S  A200090." TO VDU.
           MOVE SAVED-PRIOR-COLLID TO PD-COLLID VDUBUF.
           PERFORM SCREENIO.

       GET-PRIOR-COLLATERAL-EXIT.
           EXIT.

      *******************************************************
       WRITE-SCRATCH SECTION.
      *******************************************************

           MOVE "LOAN TEMP SAVE IN PROGRESS.........." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-PD1-FILE.

           MOVE PD-RECORD  TO WK-SAVE-RECORD.
           MOVE PD-SSNO(1) TO SAVE-SSNO.
           PERFORM SET-SCRATCH-KEY.
           PERFORM READ-PD1-FILE.

           MOVE WK-SAVE-RECORD TO PD-RECORD.
           MOVE PD-ID     TO PD2-ID.
           MOVE PD-BRANCH TO PD2-BRANCH.

      * PD2-BWNAME IS ALREADY SET FURTHER UP IN THE CODE
      *    CALL FLDVAL USING STAT FLD011 MESS.
      *    MOVE MESS TO PD2-BWNAME.
      *    MOVE HOLD-BW-NAME TO PD2-BWNAME.

           IF IO-FG = 9
              GO TO CREATE-NEW-SCRATCH.

           PERFORM REWRITE-PD1-FILE.
           GO TO EXIT-WRITE-SCRATCH.

       CREATE-NEW-SCRATCH.
           PERFORM SET-SCRATCH-KEY.
           PERFORM WRITE-PD1-FILE.
           IF IO-FG = 9
              MOVE "RECALL # USED BY ANOTHER USER !" TO MESS
              PERFORM SEND-MESS
              MOVE "PLEASE REENTER RECALL # AND REINPUT" TO MESS
              PERFORM SEND-MESS.

       EXIT-WRITE-SCRATCH.
           IF F3-YES
              PERFORM CREATE-LT-SCRATCH.
           PERFORM CLOSE-PD1-FILE.

      *******************************************************
       DELETE-SCRATCH SECTION.
      *******************************************************
           MOVE "LOAN TEMP DELETE IN PROGRESS........" TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-PD1-FILE.
           MOVE PD-SSNO(1) TO SAVE-SSNO.
           PERFORM SET-SCRATCH-KEY.
           PERFORM READ-PD1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PD1-FILE.
           PERFORM CLOSE-PD1-FILE.

           MOVE PD-SSNO(1) TO PC-SOC-SEC.
           MOVE BRANCH     TO PC-BRANCH
                              PC2-BRANCH.
           MOVE "C" TO PC-ID.
           PERFORM OPEN-PC1-FILE.
           PERFORM READ-PC1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PC1-FILE.

           PERFORM CLOSE-PC1-FILE.

      *******************************************************
       DELETE-QUOTE SECTION.
      *******************************************************
           MOVE "QUOTE DELETE IN PROGRESS........" TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM OPEN-PD1-FILE.
           PERFORM SET-QUOTE-KEY.
           PERFORM READ-PD1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PD1-FILE.
           PERFORM CLOSE-PD1-FILE.

           MOVE PD-SSNO(1) TO PC-SOC-SEC.
           MOVE BRANCH     TO PC-BRANCH
                              PC2-BRANCH.
           MOVE "C" TO PC-ID.
           PERFORM OPEN-PC1-FILE.
           PERFORM READ-PC1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PC1-FILE.
           PERFORM CLOSE-PC1-FILE.

      *******************************************************
       D12-PROCESS-PRIOR-LN SECTION.
      *******************************************************
           MOVE " " TO PASS-STAT-FG
                       RESCISSION-FLAG.

           IF ( PD-PRLNNO = 0 ) OR
              ( NOT ( PD-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO" ))
              GO TO D12-EXIT.

           MOVE PD-PRLNNO TO W-LNNO
                             PASS-PRLNNO.
           MOVE TRANS-DATE TO PASS-TRANS-DATE.
           IF PD-POCD-INRESCISSION
      * NEED THIS FLAG TO TEST IF READ ON PD1 IS SUCCESSFUL, THEY
      * MANUALLY PAID OUT THE PRIOR LOAN, NOT ALLOWED, BUT THEN
      * YOU LOSE THE PD-POCD TO TEST IF ENTERING A RESCISSION LOAN...
              MOVE "Y" TO RESCISSION-FLAG
              MOVE PD-INTDATE TO PASS-TRANS-DATE.

           MOVE PD-SRCD TO PASS-CURRENT-PD-SRCD.
           MOVE PD-REC TO WK-SAVE-RECORD.
           MOVE " " TO SAVED-PRIOR-COLLCD
                       SAVED-PRIOR-COLLID.

           MOVE "R" TO PD-ID.
           MOVE BRANCH TO PD-BRANCH.
           MOVE PD-PRLNNO TO PD-SOC-SEC.
           PERFORM GET-PD1.
           IF IO-FG = 9
              IF NOT (QUOTE-ONLY OR PD-POCD-INRESCISSION)
                 GO TO D12-END
              ELSE
                 GO TO D12-GET-PAYOFF
           ELSE
      * IF MAKING A RESCISSION LOAN, AND YOU FIND THE PD FOR A MANUAL
      * PAYOFF, DONT ALLOW IT....
              IF RESCISSION-FLAG = "Y"
                 MOVE "Z" TO PASS-STAT-FG
                 GO TO D12-END.

      * SAVED FIELDS CHECKED IN LNAPPROVAL FOR WORLD, 8/24/16 PR 1182:
           MOVE PD-PRPDUE-DAYS TO SAVE-PRPDUE-DAYS.
           MOVE PD-PRLNAMT TO SAVE-PRLNAMT.

           MOVE PD-DLNO TO PRIOR-DLNO.
           COMPUTE PRIOR-LNAMT ROUNDED =
                (PD-PRBAL + PD-PRINTDUE)
                              - (PD-PRFINCHGRB + PD-PRINSRB).

           IF PD-PLDATE NOT = 0
                     OR PD-CURBAL = 0
              MOVE "Z" TO PASS-STAT-FG
              GO TO D12-END.
      *--------------------------------------------------------
      *    IF SALES FINANCE RENEWAL 'SC' IS FOR SALES TO DIRECT
      *--------------------------------------------------------
           IF PASS-CURRENT-PD-SRCD = "SC"
              MOVE "S" TO PASS-STAT-FG
              GO TO D12-END.
      *--------------------------------------------------------
      *    IF RENEWAL IS FOR A DIRECT LOAN, NOT ALLOWED
      *--------------------------------------------------------
           IF PD-SALEFIN = "N"
              MOVE "N" TO PASS-STAT-FG
              GO TO D12-END.

      *---------------------------------------------------------------
      *    INSURE THAT TRCD OF RENEWED LOAN MATCHS THE SOURCE CODE
      *    OF THIS LOAN BEING BOOKED NOW
      *---------------------------------------------------------------
           MOVE PD-PO-TRCD TO HOLD-PRIOR-PO-TRCD.
           IF PD-PO-TRCD NOT = PASS-CURRENT-PD-SRCD
              MOVE "J" TO PASS-STAT-FG
              GO TO D12-END.

           MOVE PD-SSNO(1) TO SAVE-SSNO.

      *    COMPUTE PRIOR-LNAMT ROUNDED =
      *         (PD-PRBAL + PD-PRINTDUE)
      *                       - (PD-PRFINCHGRB + PD-PRINSRB).

           MOVE PD-ORGST TO CIP-PRIOR-LOAN-STATE.
           MOVE PD-CLASS TO CIP-PRIOR-LOAN-CLASS.
           MOVE PD-SUBCLASS TO CIP-PRIOR-SUB-CLASS.
           MOVE PD-PRBAL TO CIP-PRBAL.
           MOVE PD-PRINTDUE TO CIP-PRINTDUE.

           MOVE PD-PRFINCHGRB TO CIP-PRFINCHGRB.
           MOVE PD-PRINSRB TO CIP-PRINSRB.
           MOVE PD-LOANDATE TO CIP-PRIOR-LOAN-DATE.
           MOVE PD-PRPAID-AHEAD TO CIP-PRPAID-AHEAD.

           MOVE PD-COLLCD TO SAVED-PRIOR-COLLCD.
           MOVE PD-COLLID TO SAVED-PRIOR-COLLID.

           MOVE PD-BNKRPTDATE TO PRIOR-BNKRPTDATE.

           GO TO D12-END.

       D12-GET-PAYOFF.
           MOVE 0 TO IO-FG.

           MOVE "LP/PAYOFX" TO FORM-NAM.
           MOVE "CALCULATING - PLEASE WAIT" TO MESS.
           PERFORM SEND-LEGEND.
           CALL FORM-PROGX USING FORM-PATH PASS-PAYOFF-FLDS.
           CANCEL FORM-PROGX.
           PERFORM RESET-LEGEND.

           IF ERROR-IN-PAYOFF
              MOVE 9 TO IO-FG
              GO TO D12-END.

           COMPUTE PRIOR-LNAMT ROUNDED =
                (PASS-PRBAL + PASS-PRINTDUE)
                        - (PASS-PRFINCHGRB + PASS-PRINSRB).

           MOVE PASS-PRIOR-LOAN-STATE TO CIP-PRIOR-LOAN-STATE.
           MOVE PASS-PRIOR-LOAN-CLASS TO CIP-PRIOR-LOAN-CLASS.
           MOVE PASS-PRIOR-SUB-CLASS TO CIP-PRIOR-SUB-CLASS.
           MOVE PASS-PRBAL TO CIP-PRBAL.
           MOVE PASS-PRINTDUE TO CIP-PRINTDUE.

           MOVE PASS-PRFINCHGRB TO CIP-PRFINCHGRB.
           MOVE PASS-PRINSRB TO CIP-PRINSRB.
           MOVE PASS-PRIOR-LOAN-DATE TO CIP-PRIOR-LOAN-DATE.

           IF PASS-CDEL-ARREARAGE > 0
              MOVE PASS-CDEL-ARREARAGE TO CIP-PRPAID-AHEAD
           ELSE
              MOVE 0 TO CIP-PRPAID-AHEAD.

           MOVE PASS-SSNO TO SAVE-SSNO.

       D12-END.
           MOVE WK-SAVE-RECORD TO PD-REC.
           IF IO-FG = 9
              MOVE "E" TO PRIOR-LOAN-STAT
              GO TO D12-EXIT.
           MOVE CIP-PRBAL TO PD-PRBAL.
           MOVE CIP-PRINTDUE TO PD-PRINTDUE.
           MOVE CIP-PRFINCHGRB TO PD-PRFINCHGRB.
           MOVE CIP-PRINSRB TO PD-PRINSRB.
           MOVE CIP-PRPAID-AHEAD TO PD-PRPAID-AHEAD.
           IF PRIOR-LOAN-NOT-VALID
              MOVE 0 TO PD-PRBAL PD-PRINTDUE
                        PD-PRFINCHGRB PD-PRINSRB
           ELSE
              IF ( NEW-FLAG NOT = 1       ) OR
                 ( VIA-QUOTE-SCAN-FG = "Y") OR
                 ( VIA-LOAN-SCAN-FG = "Y" )
                 PERFORM SEND-PURCHASE-FIELDS.
           MOVE " " TO PRIOR-LOAN-STAT.

       D12-EXIT.
           EXIT.

      ****************************************************
       DO-FEEENT-WINDOW SECTION.
      ****************************************************
           MOVE 1 TO ONE.
           MOVE SP-FEEFRMLA(1) TO FW-PROTECT-FEE1-FG.
           MOVE SP-FEEFRMLA(2) TO FW-PROTECT-FEE2-FG.

           PERFORM FEEENT-WIN.
           MOVE "LONPB" TO VDU-FORM-NAME.

           PERFORM SETUP-FEES-FOR-DISPLAY.
           MOVE FEE-LIST TO WR-LIST.
           MOVE D-330-3405(1) TO WR-BUF.
           PERFORM CALL-WRFORM.

           PERFORM COMPUTE-PRINCIPLE.
           PERFORM COMPUTE-PAYMENTS.
           PERFORM COMPUTE-INS-COVERAGE.
           PERFORM COMPUTE-ANTICTERM.
           PERFORM COMPUTE-PURBAL.
           PERFORM COMPUTE-FINANCE-CHARGE.
           PERFORM SETUP-PURCHASE-FIELDS.
           PERFORM COMPUTE-ANTICIPATED.
           PERFORM COMPUTE-DEALER-CHECK.
           PERFORM CALC-YIELD.
           PERFORM SEND-X-LIST.
           PERFORM CALCULATE-APR.


      *********************************************
       DO-RSVENT-WINDOW SECTION.
      *********************************************
           MOVE 1 TO ONE.
           PERFORM RSV-CALC-AMTFIN.
           COMPUTE RSVENT-ANTICERN =
                     PD-ANTICERN(1) + PD-ANTICERN(2)
                   + PD-ANTICERN(3) + PD-ANTICERN(5).

           IF NOT GP-INCL-OTH-IN-EARNED-R
              ADD PD-ANTICERN(4) TO RSVENT-ANTICERN.

           IF NOT (GP-INCL-OTH-IN-EARNED-N OR GP-INCL-OTH-IN-EARNED-R)
              ADD PD-ANTICERN(6) TO RSVENT-ANTICERN.

      *JTG   + PD-ANTICERN(5) + PD-ANTICERN(6). PERSP-LNCOST-FRMLA 'D'


           MOVE PD-PROCEEDS       TO RSVENT-PROCEEDS.
           MOVE PD-YLDRATE        TO RSVENT-YLDRATE.
           MOVE PD-DLRVPRIN(1)    TO RSVENT-DLRVPRIN(1).
           MOVE PD-DLRVPRIN(2)    TO RSVENT-DLRVPRIN(2).
           MOVE PD-DLRVPRIN(3)    TO RSVENT-DLRVPRIN(3).
           MOVE PD-DLRVCHGS(1)    TO RSVENT-DLRVCHGS(1).
           MOVE PD-DLRVCHGS(2)    TO RSVENT-DLRVCHGS(2).
           MOVE PD-DLRVCHGS(3)    TO RSVENT-DLRVCHGS(3).
           MOVE PD-DLPARVHELD     TO RSVENT-DLPARVHELD.
           MOVE PD-DLPARVPAID     TO RSVENT-DLPARVPAID.
           MOVE PD-DLDISC         TO RSVENT-DLDISC.
           MOVE PD-ANTICERN(6)    TO RSVENT-LNCOST.
           MOVE PD-INSPREM-DLADJ  TO RSVENT-INSPREM-DLADJ.
           MOVE PD-DLCOMM-PP-CMSI TO RSVENT-DLCOMM-PP-CMSI.
           MOVE PD-DLCOMM-O3-CMSI TO RSVENT-DLCOMM-O3-CMSI.

           MOVE PD-DLRVPRIN-FG(1)    TO RSVENT-DLRVPRIN-FG(1).
           MOVE PD-DLRVPRIN-FG(2)    TO RSVENT-DLRVPRIN-FG(2).
           MOVE PD-DLRVPRIN-FG(3)    TO RSVENT-DLRVPRIN-FG(3).
           MOVE PD-DLRVCHGS-FG(1)    TO RSVENT-DLRVCHGS-FG(1).
           MOVE PD-DLRVCHGS-FG(2)    TO RSVENT-DLRVCHGS-FG(2).
           MOVE PD-DLRVCHGS-FG(3)    TO RSVENT-DLRVCHGS-FG(3).
           MOVE PD-DLPARVHELD-FG     TO RSVENT-DLPARVHELD-FG.
           MOVE PD-DLPARVPAID-FG     TO RSVENT-DLPARVPAID-FG.
           MOVE PD-DLDISC-FG         TO RSVENT-DLDISC-FG.
           MOVE PD-DLCOMM-PP-CMSI-FG TO RSVENT-DLCOMM-PP-CMSI-FG.
           MOVE PD-DLCOMM-O3-CMSI-FG TO RSVENT-DLCOMM-O3-CMSI-FG.
           MOVE PD-LOANTYPE          TO RSVENT-LOANTYPE.

           PERFORM RSVENT-WIN.
           MOVE "LONPB" TO VDU-FORM-NAME.

           MOVE RSVENT-DLRVPRIN(1)    TO PD-DLRVPRIN(1).
           MOVE RSVENT-DLRVPRIN(2)    TO PD-DLRVPRIN(2).
           MOVE RSVENT-DLRVPRIN(3)    TO PD-DLRVPRIN(3).
           MOVE RSVENT-DLRVCHGS(1)    TO PD-DLRVCHGS(1).
           MOVE RSVENT-DLRVCHGS(2)    TO PD-DLRVCHGS(2).
           MOVE RSVENT-DLRVCHGS(3)    TO PD-DLRVCHGS(3).
           MOVE RSVENT-DLPARVHELD     TO PD-DLPARVHELD.
           MOVE RSVENT-DLPARVPAID     TO PD-DLPARVPAID.
           MOVE RSVENT-DLDISC         TO PD-DLDISC.
           MOVE RSVENT-LNCOST         TO PD-ANTICERN(6).
           MOVE RSVENT-INSPREM-DLADJ  TO PD-INSPREM-DLADJ.
           MOVE RSVENT-DLCOMM-PP-CMSI TO PD-DLCOMM-PP-CMSI.
           MOVE RSVENT-DLCOMM-O3-CMSI TO PD-DLCOMM-O3-CMSI.

           MOVE RSVENT-DLRVPRIN-FG(1)    TO PD-DLRVPRIN-FG(1).
           MOVE RSVENT-DLRVPRIN-FG(2)    TO PD-DLRVPRIN-FG(2).
           MOVE RSVENT-DLRVPRIN-FG(3)    TO PD-DLRVPRIN-FG(3).
           MOVE RSVENT-DLRVCHGS-FG(1)    TO PD-DLRVCHGS-FG(1).
           MOVE RSVENT-DLRVCHGS-FG(2)    TO PD-DLRVCHGS-FG(2).
           MOVE RSVENT-DLRVCHGS-FG(3)    TO PD-DLRVCHGS-FG(3).
           MOVE RSVENT-DLPARVHELD-FG     TO PD-DLPARVHELD-FG.
           MOVE RSVENT-DLPARVPAID-FG     TO PD-DLPARVPAID-FG.
           MOVE RSVENT-DLDISC-FG         TO PD-DLDISC-FG.
           MOVE RSVENT-DLCOMM-PP-CMSI-FG TO PD-DLCOMM-PP-CMSI-FG.
           MOVE RSVENT-DLCOMM-O3-CMSI-FG TO PD-DLCOMM-O3-CMSI-FG.
           PERFORM COMPUTE-PRINCIPLE.
           PERFORM COMPUTE-PAYMENTS.
           PERFORM COMPUTE-INS-COVERAGE.
           PERFORM COMPUTE-INS-TERM.
           PERFORM COMPUTE-ANTICTERM.
           PERFORM COMPUTE-PURBAL.
           PERFORM COMPUTE-FINANCE-CHARGE.
           PERFORM COMPUTE-ANTICIPATED.
           PERFORM COMPUTE-DEALER-CHECK.
           PERFORM CALC-YIELD.
           PERFORM SEND-X-LIST.

      **********************************************************
       CREATE-LT-SCRATCH SECTION.
      **********************************************************
           MOVE 6 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           PERFORM CLOSE-WK-FILE.
           IF IO-FG NOT = 0
              GO TO CREATE-LT-SCRATCH-EXIT.

           PERFORM OPEN-PC1-FILE.
            
           PERFORM CLEAR-PC-FILE.

           MOVE "C"        TO PC-ID.
           MOVE PD-SSNO(1) TO PC-SOC-SEC.
           MOVE BRANCH     TO PC-BRANCH
                              PC2-BRANCH.
      * COLLATERAL
      *    MOVE WK-LT-RECORD TO PC-LTC-RECORD.

           MOVE WK-HHGS-1    TO PC-LTC-HHGS(1).
           MOVE WK-HHGS-2    TO PC-LTC-HHGS(2).
           MOVE WK-HHGS-3    TO PC-LTC-HHGS(3).
           MOVE WK-AUTO-1    TO PC-LTC-AUTO(1).
           MOVE WK-AUTO-2    TO PC-LTC-AUTO(2).
           MOVE WK-AUTO-3    TO PC-LTC-AUTO(3).

           MOVE PD-LOANDATE  TO PC-LOANDATE.
           MOVE PD-ORGTERM   TO PC-ORGTERM.
           MOVE PD-REGPYAMT  TO PC-REGPYAMT.
           PERFORM WRITE-PC1-FILE.
           IF IO-FG NOT = 0
              PERFORM REWRITE-PC1-FILE.

       CREATE-LT-SCRATCH-EXIT.
           PERFORM CLOSE-PC1-FILE.

      **********************************************************
       DISPLAY-PREMIUM-WINDOW SECTION.
      **********************************************************
           MOVE 10 TO WINDOW-LINES.
           MOVE 40 TO WINDOW-COLUMNS.
           MOVE 14 TO WINDOW-BEGIN-Y.
           MOVE 21 TO WINDOW-BEGIN-X.
           MOVE "PRMIUM" TO VDU-FORM-NAME.
           MOVE "WI/PRMIUM" TO WINDOW-FORM-NAM.

           PERFORM OPEN-WINDOW.
           DISPLAY PRMIUM-SCREEN.

           MOVE PRMIUM-FORM-FIELDS TO WR-BUF.
           MOVE PRMIUM-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.

           MOVE "SNNN052INS1." TO VDU.
           MOVE PD-INSPREM(1) TO VDUNUM2.
           PERFORM SCREENIO.
           MOVE "SNNN052INS2." TO VDU.
           MOVE PD-INSPREM(2) TO VDUNUM2.
           PERFORM SCREENIO.
           MOVE "SNNN052INS3." TO VDU.
           MOVE PD-INSPREM(3) TO VDUNUM2.
           PERFORM SCREENIO.
           MOVE "SNNN052INS4." TO VDU.
           MOVE PD-INSPREM(4) TO VDUNUM2.
           PERFORM SCREENIO.

       DISPLAY-PREMIUM-ACCEPT.
      *    CALL XFER USING STAT WSEL-LIST MESS.
      *    CALL WRFORM USING STAT WSEL-LIST.
           MOVE WSEL-LIST TO WR-LIST.
           MOVE " F7-DONE " TO WR-BUF.
           PERFORM CALL-WRFORM.

           MOVE "E  A010SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1>"
              GO TO DISPLAY-PREMIUM-EXIT.
           IF VDUSTATUS NOT = "00"
              GO TO DISPLAY-PREMIUM-ACCEPT.

       DISPLAY-PREMIUM-EXIT.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY PRMIUM-SCREEN.
           PERFORM CLOSE-WINDOW.
           MOVE "LONPB" TO VDU-FORM-NAME.


      **********************************************************
       VERIFY-PASSWORD SECTION.
      **********************************************************
           MOVE " "                          TO PASSWDW-STAT.
           MOVE "LONPB0"                     TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           MOVE "CL/PASSWD"                  TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.

      *******************************************************
       PASSWORD-MUST-EXIST SECTION.
      *******************************************************
           MOVE "EX" TO PASSWDW-STAT.
           MOVE "LONPB0" TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           MOVE "CL/PASSWD" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.

      ******************************************************************
       CHECK-FOR-PASSWORD SECTION.
      ******************************************************************

      * CHECKING TO SEE IF LOGIN ID IS A GROUP MEMBER

           MOVE CASE-BUF TO USER-GROUP WGR-WORD.
           PERFORM CHECK-MEMBER.
           IF ( WGR-ERR > 0 )
              GO TO PASSWORD-REQUIRED-BR.

      * CHECKING TO SEE IF BRANCH ENTERED IS WITHIN THE MEMBER.

           PERFORM OPEN-GR1-FILE.
           MOVE USER-GROUP TO GR-ID.
           PERFORM SEARCH-GR-INIT.
           MOVE BRANCH TO WGR-SRESULT.
           PERFORM SEARCH-GR-VERIFY.

           IF ( WGR-ERR > 0 )
              GO TO PASSWORD-REQUIRED-BR.

      *  SECRETARY HAS VALID GROUP AND BRANCH LOGIN, SO THEY MUST ENTER
      *  A PASSWORD TO APPROVE THE GI LIMIT STOP, (THEY DONT KNOW PASSWORD!)
      *-----------------------------------------------------------------
      *  CHECK FOR SEQUENCE 2 PASSWORD - MERCURY HAS SECRETARY LOGINS
      *  SUCH AS P0158VP1 WHO NEED TO RUN REPORTS FOR VP'S BUT SHOULDN'T
      *  BE ALLOWED TO APPROVE; PASSWD = LONPB0 SEQ 2
      *-----------------------------------------------------------------
           MOVE APPROVAL-SEQ2 TO PASSWDW-SEQ.
           PERFORM VERIFY-PASSWORD.

           IF ( PASSWDW-STAT NOT = "OK" )
              MOVE MESSAGE-NEED-PASSWORD TO MESS
              PERFORM SEND-MESS.

           GO TO EXIT-CHECK-FOR-PASSWORD.

      * LOGIN ID OR BRANCH ENTERED IS NOT VALID MEMBER OF GROUP,
      * MUST ENTER PASSWORD TO MAKE CHANGE TO LIMIT.

       PASSWORD-REQUIRED-BR.

           MOVE APPROVAL-SEQ TO PASSWDW-SEQ.
           PERFORM VERIFY-PASSWORD.
           IF ( PASSWDW-STAT NOT = "OK" )
              MOVE MESSAGE-NEED-PASSWORD TO MESS
              PERFORM SEND-MESS.

       EXIT-CHECK-FOR-PASSWORD.
           EXIT.

      *****************************************************
       SETUP-PURCHASE-FIELDS SECTION.
      *****************************************************

      * PASS PD DEALER RELATED FIELDS:
           MOVE PD-DLRVPRIN(1) TO PURFLD-DLRVPRIN(1).
           MOVE PD-DLRVPRIN(2) TO PURFLD-DLRVPRIN(2).
           MOVE PD-DLRVPRIN(3) TO PURFLD-DLRVPRIN(3).
           MOVE PD-DLRVCHGS(1) TO PURFLD-DLRVCHGS(1).
           MOVE PD-DLRVCHGS(2) TO PURFLD-DLRVCHGS(2).
           MOVE PD-DLRVCHGS(3) TO PURFLD-DLRVCHGS(3).
           MOVE PD-DLPARVHELD  TO PURFLD-DLPARVHELD.
           MOVE PD-DLPARVPAID  TO PURFLD-DLPARVPAID.
           MOVE PD-DLDISC      TO PURFLD-DLDISC.

      * PASS PD DEALER RELATED FLAG FIELDS:
           MOVE PD-DLRVPRIN-FG(1) TO PURFLD-DLRVPRIN-FG(1).
           MOVE PD-DLRVPRIN-FG(2) TO PURFLD-DLRVPRIN-FG(2).
           MOVE PD-DLRVPRIN-FG(3) TO PURFLD-DLRVPRIN-FG(3).
           MOVE PD-DLRVCHGS-FG(1) TO PURFLD-DLRVCHGS-FG(1).
           MOVE PD-DLRVCHGS-FG(2) TO PURFLD-DLRVCHGS-FG(2).
           MOVE PD-DLRVCHGS-FG(3) TO PURFLD-DLRVCHGS-FG(3).
           MOVE PD-DLPARVHELD-FG  TO PURFLD-DLPARVHELD-FG.
           MOVE PD-DLPARVPAID-FG  TO PURFLD-DLPARVPAID-FG.
           MOVE PD-DLDISC-FG      TO PURFLD-DLDISC-FG.
           PERFORM COMPUTE-PURCHASE-FIELDS.
           IF PURFLD-STAT = "DL"
              MOVE "DEALER RECORD NOT FOUND" TO MESS
              PERFORM SEND-MESS
              GO TO IO-ERROR.

      * SET NEW PD DEALER RELATED FIELDS:
           MOVE PURFLD-DLRVPRIN(1) TO PD-DLRVPRIN(1).
           MOVE PURFLD-DLRVPRIN(2) TO PD-DLRVPRIN(2).
           MOVE PURFLD-DLRVPRIN(3) TO PD-DLRVPRIN(3).
           MOVE PURFLD-DLRVCHGS(1) TO PD-DLRVCHGS(1).
           MOVE PURFLD-DLRVCHGS(2) TO PD-DLRVCHGS(2).
           MOVE PURFLD-DLRVCHGS(3) TO PD-DLRVCHGS(3).
           MOVE PURFLD-DLPARVHELD  TO PD-DLPARVHELD.
           MOVE PURFLD-DLPARVPAID  TO PD-DLPARVPAID.
           MOVE PURFLD-DLDISC      TO PD-DLDISC.

      *****************************************************
       DUAL-CHECK SECTION.
      *****************************************************

           ADD 1 TO SUB.

           IF ( PD-SSNO(SUB) = ZEROES ) OR ( BISCAN-CALL-CODE = 9 )
              GO TO EXIT-DUAL-CHECK.

           MOVE PD-SSNO(SUB) TO BISCAN-SSNO.
           MOVE PD-SRCD      TO BISCAN-SRCD.
           MOVE PD-PRLNNO    TO BISCAN-PRLNNO.

           IF ( SP-DUAL-IN-STATE  NOT = "Y" ) AND
              ( SP-DUAL-IN-BRANCH NOT = "Y" )
              MOVE 2 TO BISCAN-CALL-CODE
              PERFORM CALL-SCAN.

           IF ( BISCAN-CALL-CODE = 9 )
              MOVE "RTN" TO IO-TYPE.

       EXIT-DUAL-CHECK.
           EXIT.

      *****************************************************
       CALL-SCAN SECTION.
      *****************************************************

           MOVE SP-DUAL-IN-STATE  TO BISCAN-STATE-FG.
           MOVE SP-DUAL-IN-BRANCH TO BISCAN-BRANCH-FG.
           MOVE PD-OWNBR          TO BISCAN-BRANCH.
           MOVE PD-ORGST          TO BISCAN-STATE.
           MOVE TRANS-DATE        TO BISCAN-TRANS-DATE.
           MOVE "CL/BISCAN"       TO FORM-NAM.

           CALL FORM-PROGX USING FORM-PATH
                                BISCAN-WORKERS.
           CANCEL FORM-PROGX.

       EXIT-CALL-SCAN.
           EXIT.

      *****************************************************
       D13-SP-EDT-TABLE-LOOKUP SECTION.
      *****************************************************
           MOVE "Y" TO PASSED-EDITS-FLAG.
           SET ETBL TO 1.
           MOVE 0 TO COUNTER.
           MOVE  9999.999 TO RATE-LOW
           MOVE -9999.999 TO RATE-HIGH
           MOVE SPACES TO MESS.

           IF PD-ORGTERM < 1
              MOVE "VALUE OUT OF RANGE SET IN SP RECORD" TO MESS
              GO TO D13-EXIT-WITH-ERROR.

      *----------------------------------------------------------------
      * TEST THE VARIANCE EDITS IN THE SPR (VL & VH)
      *  RATHER THAN TESTING A FLAT RATE, THE VARIANCE TELLS HOW MUCH
      *  THE CONTRACT RATE CAN VARY FROM THE CALCULATED APR
      *  EXAMPLE:   CALCULATED RATE = 12.270 %
      *             VARIANCE HIGH   = .20
      *             VARIANCE LOW    = .23
      *
      *        COMPUTE RATE LOW  = 12.270 - .20 = 12.070 %
      *        COMPUTE RATE HIGH = 12.270 + .23 = 12.500 %
      *
      *        IF THE CONTRACT RATE DOES NOT FALL BETWEEN
      *             12.070 AND 12.500
      *        THEN
      *           THE CONTRACT CANNOT BE UPDATED.
      *----------------------------------------------------------------
       D13-APR-VARIANCE-VALIDATION.
           IF NOT (GP-USE-CONRATE = "Y")
              GO TO D13-EXIT.

           ADD 1 TO COUNTER.

           IF COUNTER > SP-EDT-NOEDITS(ETBL)
              GO TO D13-APR-VARIANCE-TABLE2.

           IF SP-EDT-TYPE(ETBL,COUNTER) = "V"
              IF SP-EDT-HL(ETBL,COUNTER) = "L"
                 SUBTRACT SP-EDT-RATE(ETBL,COUNTER) FROM PD-APRATE
                          GIVING RATE-LOW
              ELSE
                 ADD SP-EDT-RATE(ETBL,COUNTER) TO PD-APRATE
                          GIVING RATE-HIGH.

           IF COUNTER NOT > SP-EDT-NOEDITS(ETBL)
              GO TO D13-APR-VARIANCE-VALIDATION.

       D13-APR-VARIANCE-TABLE2.
           IF SP-EDT-NOEDITS(ETBL) NOT < 6 AND ETBL NOT = 2
              MOVE 0 TO COUNTER
              SET ETBL TO 2
              GO TO D13-APR-VARIANCE-VALIDATION.

      *    -------------------------------------------------------------
      *    TEST FOR ERROR:  APR - VARIANCE NOT < 0
      *    -------------------------------------------------------------
           IF RATE-LOW < 0
              MOVE " SPR ERROR: APR - VARIANCE < 0" TO MESS
              GO TO D13-EXIT-WITH-ERROR.

      *    -------------------------------------------------------------
      *    TEST FOR ERROR:  APR + VARIANCE EXCEEDS 999.999
      *    -------------------------------------------------------------
           IF RATE-HIGH > 999.999
              MOVE " SPR ERROR: APR + VARIANCE > 999.999" TO MESS
              GO TO D13-EXIT-WITH-ERROR.

      *    -------------------------------------------------------------
      *    TEST VARIANCE RATE LOW: CONTRACT APR < CALC'D APR - VARIANCE
      *    -------------------------------------------------------------
           IF (PD-CONRATE < RATE-LOW) AND (RATE-LOW NOT = 9999.999)
              MOVE RATE-LOW TO DISP-RATE
              STRING " CONTRACT APR FALLS BELOW MINIMUN VARIANCE OF "
                      DISP-RATE "%" DELIMITED BY SIZE INTO MESS
              GO TO D13-EXIT-WITH-ERROR.

      *    -------------------------------------------------------------
      *    TEST VARIANCE RATE LOW: CONTRACT APR > CALC'D APR + VARIANCE
      *    -------------------------------------------------------------
           IF (PD-CONRATE > RATE-HIGH) AND (RATE-HIGH NOT = -9999.999)
              MOVE RATE-HIGH TO DISP-RATE
              STRING " CONTRACT APR EXCEEDS MAXIMUM VARIANCE OF "
                      DISP-RATE "%" DELIMITED BY SIZE INTO MESS
              GO TO D13-EXIT-WITH-ERROR.

           GO TO D13-EXIT.
       D13-EXIT-WITH-ERROR.
           PERFORM SEND-MESS.
           MOVE "N" TO PASSED-EDITS-FLAG.
       D13-EXIT.
           EXIT.

      *****************************************************
      * FOR DL-PARVPAID-FRMLA    =  3  AND
      *     DL-PARVPAID-FRMLA-IB = "3"
      * WISCONSIN #2049
      *****************************************************
       BUYRATE-WINDOW SECTION.
      *****************************************************
           MOVE PURFLD-BUYRATE    TO BUYRTE-BUYRATE.
    
           MOVE "WI/BUYRTE"  TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH
                                BUYRTE-BUF.
           CANCEL FORM-PROGX.
           MOVE BUYRTE-BUYRATE    TO PURFLD-BUYRATE.
    
       BUYRATE-WINDOW-EXIT.
           EXIT.

      **************************************************************************
       FORM-RESET SECTION.
      **************************************************************************
           MOVE LPLOAN-SYSDATE TO LONPB-SYSDATE.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DISPLAY LONPB-SCREEN UPON TCLP-MAIN-WINDOW-HANDLE.
           MOVE LONPB-FORM-FIELDS TO WR-BUF.
           MOVE LONPB-FORM-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       FORM-RESET-EXIT.
           EXIT.

      **************************************************************************
       SETUP-LINK-INFO SECTION.
      **************************************************************************
           IF VDU-FORM-NAME = "LPSMNU"
              MOVE LPSMNU-HELP--FILE TO HELP-LINK-FILE
              MOVE LPSMNU-HELP--DIR  TO HELP-LINK-DIR
           ELSE
              MOVE LONPB-HELP--FILE TO HELP-LINK-FILE
              MOVE LONPB-HELP--DIR TO HELP-LINK-DIR.

      **************************************************************************
       VDU-CONVERT-FIELD SECTION.
      **************************************************************************
           MOVE "00" TO STAT.
           MOVE VDU-FIELD-TO-CONVERT TO VDU-ALP-FIELD.
           EVALUATE TRUE
              COPY "LIBLP/LONPB_EVA.CPY".
              COPY "LIBLP/LPSMNU_EVA.CPY".
              COPY "LIBLP/LPLNMU_EVA.CPY".
              COPY "LIBLP/LPCAMU_EVA.CPY".
              COPY "LIBLP/LPVDMU_EVA.CPY".
              COPY "LIBWI/GLIMI2_EVA.CPY".
              COPY "LIBWI/GLIMI3_EVA.CPY".
              COPY "LIBWI/PRMIUM_EVA.CPY".
              COPY "LIBWI/RSVENT_EVA.CPY".
              COPY "LIBWI/FEEENT_EVA.CPY".
              WHEN OTHER       MOVE   "2A" TO STAT
           END-EVALUATE.

      ******************************************************************
      *
      *     C O P Y - L I B R A R Y - S E C T I O N S
      *
      ******************************************************************
       COPY "LIBWI/LNAPPROVAL.CPY".
       COPY "LIBLP/YIELDPD.CPY".
       COPY "LIBLP/OURSPD.CPY".
       COPY "LIBLP/PURFLDPD.CPY".
       COPY "LIBLP/DLCKPD.CPY".
       COPY "LIBWI/FEEENT.CPY".
       COPY "LIBWI/FEEENTPD.CPY".
       COPY "LIBWI/RSVENT.CPY".
       COPY "LIBWI/RSVENTPD.CPY".
       COPY "LIBLP/LPANTI.CPY".
       COPY "LIBLP/LPMENU.CPY".
       COPY "LIBLP/LPAPRZ.CPY".
       COPY "LIBLP/LPDAMTS.CPY".
       COPY "LIBGB/DATER.CPY".
       COPY "LIBLP/LPUPER.CPY".
       COPY "LIBLP/UPERTST.CPY".
       COPY "LIBLP/LPPDCL.CPY".
       COPY "LIBLP/LPPCCL.CPY".
       COPY "LIBLP/CALCPV.CPY".
       COPY "LIBLP/LPEDAYP.CPY".
       COPY "LIBLP/LPICOMM.CPY".
       COPY "LIBLP/LPMDTEPD.CPY".
       COPY "LIBGB/SCREEN.CPY".
       COPY "LIBGB/GPENV.CPY".
       COPY "LIBWI/PFSWINDOWS.CPY".
       COPY "LIBLP/LPDLADJ.CPY".
       COPY "LIBLP/LPZ3CL.CPY".
       COPY "LIBLP/INSELIG.CPY".
       COPY "LIBGB/GRWORK.CPY".
       COPY "LIBGB/GRSERCH.CPY".

      **************************************************************************
       MISC-PARAGRAPHS SECTION.
      **************************************************************************
       COPY "LIBGB/SYSTEM.CPY".
       COPY "LIBGB/TMMSG.CPY".

      *----------------------------------------------------------------
       INVALID-DUE-DAY.
           IF PD-1STPYDA = 31
              MOVE " 31ST OF MONTH INVALID FOR SEMI-MONTHLY PAPER"
                                                          TO MESS
           ELSE
              STRING
              PD-1STPYDA,"TH OF MONTH INVALID FOR SEMI-MONTHLY PAPER"
                                       DELIMITED BY "  " INTO MESS.

      *----------------------------------------------------------------
       INVALID-MESSAGE.
           MOVE "INVALID CLASS/DEALER COMBINATION" TO MESS.
           PERFORM SEND-MESS.

      *-----------------------------------------------------------------
       GET-GI.
           PERFORM OPEN-GI1-FILE.
           PERFORM READ-GI1-FILE.
           PERFORM CLOSE-GI1-FILE.

      *-----------------------------------------------------------------
       SEND-1STPYDATE.
           MOVE PD-INTDATE TO NDTE-DATE.
           MOVE 1 TO NDTE-HOLD.
           MOVE PD-UNITPER-CD TO DATER-UNITPER-CD.
           MOVE PD-UNITPER-FREQ TO DATER-UNITPER-FREQ.
           PERFORM INCREMENT-UNITPER.
           IF PD-UNITPER-CD  = "S"
              IF NDTE-DD = 14 OR 15
                 MOVE 16 TO NDTE-DD.
           MOVE "S  8000170." TO VDU.
           MOVE NDTE-DATE TO PD-1STPYDATE
                             PD-ORIG-1STPYDATE
                             VDU-DATE-YYYYMMDD.
           PERFORM SCREENIO.
       GET-CODE.
           MOVE "GC"     TO CDB-TYPE.
           MOVE PD-OWNBR TO CDB-BRANCH.
           PERFORM OPEN-CDB1-FILE.
           PERFORM READ-CDB1-FILE.
           PERFORM CLOSE-CDB1-FILE.
           IF IO-FG = 9
              MOVE " * NOT ON FILE * " TO CDB-DESC.
       GET-LC.
           PERFORM OPEN-LC1-FILE.
           PERFORM READ-LC1-FILE.
           PERFORM CLOSE-LC1-FILE.
           IF IO-FG = 9
              MOVE "INVALID" TO LC-DESC.
           MOVE "N" TO FORCE-ENTERED-PRIN1 FORCE-ENTERED-PRIN2
                       FORCE-ENTERED-DISC.

       GET-CD.
           PERFORM READ-CD1-FILE.
           IF IO-FG = 9
              MOVE " INVALID CODE" TO CD-DESC.
       SAVE-TRAILER-REC.
           MOVE 6 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM REWRITE-WK-FILE.
           PERFORM CLOSE-WK-FILE.
       PRIOR-LN-ERROR-MSG.
           IF ERROR-IN-PAYOFF
              MOVE "PRIOR LOAN INVALID" TO MESS
              PERFORM SEND-MESS
           ELSE
              MOVE "INITIATE RENEWAL IN TRANSACTION POSTING"
                                                      TO MESS
              PERFORM SEND-MESS.
       RECALL-COLLATERAL.
           MOVE 6 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
      *    MOVE PC-LTC-RECORD TO WK-LT-RECORD.
           MOVE PC-LTC-HHGS(1) TO WK-HHGS-1.
           MOVE PC-LTC-HHGS(2) TO WK-HHGS-2.
           MOVE PC-LTC-HHGS(3) TO WK-HHGS-3.
           MOVE PC-LTC-AUTO(1) TO WK-AUTO-1.
           MOVE PC-LTC-AUTO(2) TO WK-AUTO-2.
           MOVE PC-LTC-AUTO(3) TO WK-AUTO-3.
           PERFORM REWRITE-WK-FILE.
       GET-DL1.
           PERFORM OPEN-DL1-FILE.
           PERFORM READ-DL1-FILE.
           PERFORM CLOSE-DL1-FILE.
           IF IO-FG = 9
              MOVE " INVALID DEALER" TO DL-SHORT.
       GET-BW1.
           PERFORM READ-BW1-FILE.
           IF IO-FG = 9
              MOVE " " TO BW-FNAME
              MOVE "NOT FOUND" TO BW-LNAME
              MOVE "Y" TO BW-ERROR-YN.     

           PERFORM APPEND-BW-NAMES.

      *-----------------------------------------------------------------
       GET-PD1.
           PERFORM OPEN-PD1-FILE.
           PERFORM READ-PD1-FILE.
           PERFORM CLOSE-PD1-FILE.
      *-----------------------------------------------------------------
       GET-SP.
           MOVE PD-ORGST TO SP-ORGST.
           MOVE PD-SPRCLASS TO SP-SPRCLASS.
           MOVE PD-SUBCLASS TO SP-SUBCLASS.
           MOVE PD-LAWCODE TO SP-LAWCODE.
           PERFORM READ-SP1-FILE.
           IF IO-FG = 9
              MOVE "INVALID LAW RECORD" TO MESS
              PERFORM SEND-MESS
              GO TO IO-ERROR.

           IF SP-DLDISC-RVPRIN1-PCNT = 202.02
              MOVE 0 TO SP-DLDISC-RVPRIN1-PCNT.
           IF SP-DLDISC-RVPRIN1-AF-PCNT = 202.02
              MOVE 0 TO SP-DLDISC-RVPRIN1-AF-PCNT.
       GET-RECOURSE-DESC.
           MOVE " INVALID" TO VDUBUF.
           IF PD-DLRECOURSE = "F"
              MOVE "ULL" TO VDUBUF.
           IF PD-DLRECOURSE = "P"
              MOVE "ARTIAL" TO VDUBUF.
           IF PD-DLRECOURSE = "N"
              MOVE "ONE" TO VDUBUF.
       VERIFY-INSURANCE.
           IF PD-INSCOMP(SUB) NOT = 0
                      OR PD-INSPREM(SUB) NOT = 0
              MOVE 9 TO IO-FG.
       SEND-CD-DESC.
           PERFORM GET-CD.
           MOVE "S  A200  1." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE CD-DESC TO VDUBUF.
           PERFORM SCREENIO.

      *-----------------------------------------------------------------
       APPEND-BW-NAMES.
           MOVE BW-LNAME TO INSPECT-W.
           MOVE BW-FNAME TO ADD-ON.
           PERFORM ADD-IT.

      *-----------------------------------------------------------------
       ADD-IT.
           INSPECT INSPECT-W REPLACING FIRST "  " BY " +".
           INSPECT INSPECT-W REPLACING FIRST
              "+                        " BY ADD-ON.
       ADD-IT2.
           PERFORM ADD-IT.
           MOVE "/" TO ADD-ON.
           PERFORM ADD-IT.
       NUMBW-TO-ALPBW.
           MOVE " " TO ALP-BW.
           IF BW-SSNO NOT = 0
              MOVE BW-SSNO TO NUM-BW
              MOVE NUM-BW123 TO ALP-BW123
              MOVE NUM-BW45 TO ALP-BW45
              MOVE NUM-BW6789 TO ALP-BW6789
              MOVE "-" TO ALP-HYPHEN1 ALP-HYPHEN2.
       SEND-BW-NO-NAME.
           PERFORM NUMBW-TO-ALPBW.
           MOVE "S  A110  0." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE ALP-BW TO VDUBUF.
           PERFORM SCREENIO.
           PERFORM SEND-BW-NAME.
       SEND-BW-NAME.
           MOVE "S  A330  1." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE INSPECT-W TO VDUBUF HOLD-BW-NAME.
           PERFORM SCREENIO.
           IF ELE = 1
              MOVE INSPECT-W TO PD2-BWNAME.
       SEND-BW-MAKERCD.
           MOVE "S  A010  2." TO VDU.
           MOVE ELE TO VDUROW.
           MOVE PD-MAKERCD(ELE) TO VDUBUF.
           PERFORM SCREENIO.

      *-----------------------------------------------------------------
       SEND-MEMO.
           MOVE "S  A060M1." TO VDU.
           MOVE "MEMO: " TO VDUBUF.
           PERFORM SCREENIO.
           MOVE "S  A300M2." TO VDU.
           MOVE PD-MESSAGE TO VDUBUF.
           PERFORM SCREENIO.
       NOT-FOUND.
           MOVE "NOT FOUND" TO MESS.
           PERFORM SEND-MESS.
       SP-INVALID.
           MOVE "ENTRY INCONSISTENT WITH STATE PARAMETERS" TO MESS.
           PERFORM SEND-MESS.
       INVALID-FOR-SF.
           MOVE "INVALID FOR SALES FINANCE CONTRACTS" TO MESS.
           PERFORM SEND-MESS.
       MSG-LINE.
           MOVE MESS TO TMMSG-MESS.
           PERFORM CALL-TMMSG.
       SEND-LEGEND.
           MOVE MESS      TO WR-BUF.
           MOVE MSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       SEND-WSEL-LEGEND.
           MOVE MESS      TO WR-BUF.
           MOVE WSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       RESET-LEGEND.
           MOVE " " TO MESS.
           PERFORM SEND-LEGEND.
       LOAN-CLASS-PROMPT.
           MOVE "S  A110KEYTYPE." TO VDU.
           MOVE "LOAN CLASS:" TO VDUBUF.
           PERFORM SCREENIO.
       SET-SCRATCH-KEY.
           MOVE SAVE-SSNO TO PD-SOC-SEC.
           MOVE BRANCH    TO PD-BRANCH.
           MOVE "L"       TO PD-ID.
       SET-QUOTE-KEY.
           MOVE QUOTE-SOC-SEC TO PD-SOC-SEC.
           MOVE BRANCH TO PD-BRANCH.
           MOVE "Q" TO PD-ID.
       SEND-X-LIST.
           MOVE PD-SUM-LNAMT TO X-PRIN.
           MOVE TEST-PROCEEDS TO X-DLCK.

           IF GP-INCL-OTH-IN-EARNED-N
              COMPUTE X-ANTIC = PD-ANTICERN(1) + PD-ANTICERN(2)
                              + PD-ANTICERN(3) + PD-ANTICERN(4)
                              + PD-ANTICERN(5)
           ELSE
           IF GP-INCL-OTH-IN-EARNED-R
              COMPUTE X-ANTIC = PD-ANTICERN(1) + PD-ANTICERN(2)
                              + PD-ANTICERN(3) + PD-ANTICERN(5)
           ELSE
              COMPUTE X-ANTIC = PD-ANTICERN(1) + PD-ANTICERN(2)
                              + PD-ANTICERN(3) + PD-ANTICERN(4)
                              + PD-ANTICERN(5) + PD-ANTICERN(6).


      *JTG   + PD-ANTICERN(5) + PD-ANTICERN(6). PERSP-LNCOST-FRMLA 'D'
           MOVE PD-1STPYAMT TO X-350.
           MOVE PD-REGPYAMT TO X-351.
           MOVE PD-LASTPYAMT TO X-360.
           MOVE PD-PURDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO X-370.

           IF PD-DLRVPRIN(2) = 0
                   AND PD-DLRVPRIN(3) = 0
              MOVE PD-DLRVPRIN(1) TO X-380
           ELSE
              ADD PD-DLRVPRIN(1) PD-DLRVPRIN(2) PD-DLRVPRIN(3)
                                         GIVING X-380
              INSPECT X-380 REPLACING LEADING " " BY "*".

           IF PD-DLRVCHGS(2) = 0
                   AND PD-DLRVCHGS(3) = 0
              MOVE PD-DLRVCHGS(1) TO X-381
           ELSE
              ADD PD-DLRVCHGS(1) PD-DLRVCHGS(2) PD-DLRVCHGS(3)
                                         GIVING X-381
              INSPECT X-381 REPLACING LEADING " " BY "*".

           IF PD-DLPARVPAID = 0
              MOVE PD-DLPARVHELD TO X-390
           ELSE
              ADD PD-DLPARVHELD PD-DLPARVPAID GIVING X-390
              INSPECT X-390 REPLACING LEADING " " BY "*".

           MOVE PD-DLDISC TO X-391.

           MOVE "LOAN AMOUNT:" TO X-PPRIN.
           MOVE "ANTIC/CHECK:" TO X-ANTIC-DLCK.
      *    CALL XFER USING STAT X-LIST X-BUF.
      *    CALL WRFORM USING STAT X-LIST.
           MOVE X-LIST TO WR-LIST.
           MOVE X-BUF  TO WR-BUF.
           PERFORM CALL-WRFORM.

      *-----------------------------------------------------------------
       CALL-SFVERI.
           MOVE " " TO ERRORS-EXIST.
           IF ERRORS-EXIST NOT = "Y"
              IF ( WS-APPROVAL-FG NOT = "S" )
                 PERFORM SAVE-SCREEN
                 MOVE "LONPB0" TO LPLOAN-CALLED-FROM
                 MOVE "CL/SFVERI" TO FORM-NAM
                 CALL FORM-PROGX USING FORM-PATH ERRORS-EXIST
                                                ACTION
                                                PROG-BUF
                 CANCEL FORM-PROGX
              ELSE
                 MOVE SPACES TO ERRORS-EXIST.

      *-----------------------------------------------------------------
       SEND-PRIOR-MESS.
           IF PASS-STAT-FG = "Z"
              MOVE "PRIOR LOAN PAID OFF OR BALANCE EXPENSED" TO MESS
              PERFORM SEND-MESS
           ELSE
           IF PASS-STAT-FG = "S"
              MOVE "'SC' IS FOR SALES TO DIRECT - NOT ALLOWED"
                                                        TO MESS
              PERFORM SEND-MESS
           ELSE
           IF PASS-STAT-FG = "J"
              STRING "PRIOR LOAN PAID OFF USING TRANSACTION CODE '"
                     HOLD-PRIOR-PO-TRCD
                     "'                                   "
                     DELIMITED BY SIZE INTO MESS
              PERFORM SEND-MESS
           ELSE
              MOVE "PRIOR LOAN IS DIRECT LOAN - NOT ALLOWED" TO MESS
              PERFORM SEND-MESS.
      *-----------------------------------------------------------------
       VERIFY-PROCEEDS.
      *JGW IF PD-SRCD = "RN" OR "RB"
           IF PD-SRCD = "RN"
              IF (PD-SELLPR - PD-DOWNPY - PD-TRADEIN) NOT = 0
                 MOVE
              "(SELLPR - DOWNPY - TRADEIN) MUST BE ZERO FOR RENEWALS"
                                                           TO MESS
                 PERFORM SEND-MESS
                 MOVE 9 TO IO-FG.

      *-----------------------------------------------------------------
       BLANK-PRIOR-LOAN.
           MOVE " " TO PRIOR-LOAN-STAT PASS-STAT-FG.

      *BUG: ADDED PD-PR_____ FIELDS 
           MOVE 0 TO PD-PRLNNO
                     PD-PRBAL
                     PD-PRINTDUE
                     PD-PRFINCHGRB
                     PD-PRINSRB
                     PD-PRPAID-AHEAD
                     PRIOR-LNAMT
                     PRIOR-BNKRPTDATE.
           MOVE PD-SRCD TO HOLD-CIP-SRCD.


           MOVE "SNNN060110." TO VDU.
           MOVE 0 TO VDUNUM0.
           PERFORM SCREENIO.

           MOVE "SNNN062111." TO VDU.
           MOVE 0 TO VDUNUM2.
           PERFORM SCREENIO.

           MOVE "S  A040112." TO VDU.
           PERFORM SCREENIO.

           IF NEW-FLAG NOT = 1
              PERFORM SEND-PURCHASE-FIELDS.

      **************************************************************************
       IO-ROUTINE SECTION.
      **************************************************************************
       COPY "LIBGB/CONNECT_SQL.CPY".
       COPY "LIBLP/LPSPGS_SQL.CPY".
       COPY "LIBLP/LPPDGS_SQL.CPY".
       COPY "LIBLP/LPPCGS_SQL.CPY".
       COPY "LIBLP/LPLTCGS_SQL.CPY".
       COPY "LIBLP/LPLCGS_SQL.CPY".
       COPY "LIBLP/LPICGS_SQL.CPY".
       COPY "LIBLP/LPDLGS_SQL.CPY".
       COPY "LIBLP/LPCKGS_SQL.CPY".
       COPY "LIBLP/LPCDBGS_SQL.CPY".
       COPY "LIBLP/LPCDGS_SQL.CPY".
       COPY "LIBLP/LPBWGS_SQL.CPY".
       COPY "LIBGL/GLGIGS_SQL.CPY".
       COPY "LIBGB/GBGRGS_SQL.CPY".
       COPY "LIBGB/GBBRGS_SQL.CPY".
       COPY "LIBGB/GBBRRN.CPY".
       COPY "LIBLP/LPDL1RN.CPY".
       COPY "LIBLP/LPLC1RN.CPY".
       COPY "LIBLP/LPLTC1RN.CPY".
       COPY "LIBLP/LPPD1IN.CPY".
       COPY "LIBLP/LPPD2RN.CPY".
       COPY "LIBLP/LPPC1IN.CPY".
       COPY "LIBLP/LPSP1RN.CPY".
       COPY "LIBLP/LPBW1RN.CPY".
       COPY "LIBLP/LPCD1RN.CPY".
       COPY "LIBLP/LPCDB1RN.CPY".
       COPY "LIBLP/LPIC1RN.CPY".
       COPY "LIBLP/LPWKI.CPY".
       COPY "LIBLP/LPCK1RN.CPY".
       COPY "LIBGL/GLGI1RN.CPY".
       COPY "LIBGB/GBGR1RN.CPY".
       COPY "LIBGB/FERRORS.CPY".
           MOVE "E" TO ERRCD.

      **************************************************************************
       END-ROUTINE SECTION.
      **************************************************************************
           PERFORM CLOSE-FILES.
       EXIT-PROG.
           PERFORM CLOSE-WINDOW UNTIL WINDOWS-OPEN = 0.
       STOP-RUN.
           EXIT PROGRAM.
