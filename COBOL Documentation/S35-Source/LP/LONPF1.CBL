       IDENTIFICATION DIVISION.
       PROGRAM-ID.      LONPF1.
       DATE-WRITTEN.    030186.
      ***********************************************************************
      *  DESC:  LOAN PROCESSING
      *         TRANSACTION POSTING
      *         PROGRAM 1 - TRANSACTION DRIVER
      * REV :
      *  042995 SLC ADDED PLTYPE LOGIC
      *  051295 SLC IF DEFERMENTS PER CONTRACT AND DEFERMENTS PER YEAR = 0 AND
      *             DEFERMENT POLICY IS SPACE, DISALLOW DEFERMENTS (NO OPTION)
      *  051395 SLC ADDED LOGIC FOR TR AND TA TRANCODES.
      *  052095 SLC ADDED LOGIC FOR O2 TRANCODE.
      *  052595 SLC ADDED LOGIC FOR W2 TRANCODE.
      *  053095 SLC COMBINED OTHBAL AND OT2BAL IN L-090
      *  053095 SLC ADDED LOGIC FOR Z2 TRANCODE.
      *  060795 BAH COMBINE APOTH AND APOT2 IN L-050
      *  061595 BLL ADD MAX-DEFER-FG IF MAX DEFERMNTS EXCEEDED
      *  062295 MJD ADDED PASSWORD TO P4 AND P5.
      *  082995 KEC FOR DEFERMENT FORMULA OF 9, NO D2 THRU D9 ALLOWED
      *  083095 KEC IF CURBAL IS LESS THAN OT2BAL, THEN TWO MESSAGES
      *             STATE THAT YOU CAN'T POST AND CALL HOME OFFICE.
      *  090895 BAH HOLD-DLRVCHGS(3) WAS NOT GETTING CLEARED !!!!!!!!!
      *  092595 JTG ADDED LOGIC FOR INTER BRANCH PAYMENTS
      *  092695 MJD ADDED PW-PROTECTION TO CA,CC,C1,C2,CP, AND TS.
      *  092695 JTG CHANGED TO READ GIFILE USING LN-OWNBR AND NOT
      *             POSTING BRANCH NO.
      *  100395 MJD ADDED PASSWORD REQUIREMENT TO RESERVE 3.
      *  111795 BLL CHANGE BAL CHECK TO STOP IF CURBAL NOT > OT2BAL
      *             INSTEAD OF IF CURBAL < OT2BAL
      *  MJD 011096 ADDED LOGIC FOR SP-MAX-ALLOW-DELINQ. THE MAXIMUM
      *              NUMBER OF ALLOWED DELINQUENCIES PER CONTRACT.
      *  MJD 011296 ADDED TEST OF BR-NO-OUT-DLR-RSV FOR "PC","PR","PP",
      *             "P4","P5" TRANSACTIONS.
      *  JTG 013196 ADDED F5, FOR PAYOFF
      *  MJD 021396 CHANGED PASSWORD PROMT FOR TS TO READ TRANSFER TO SERVICE
      *               INSTEAD OF TRANSFER TO REPO.
      *  JTG 022096 ADDED BR-LNCHGS-WINDOW OPTION
      *  BAH 032796 ADDED GP-DEFAULT-ACCRATE FOR RELIANCE
      *  MJD 040896 PREVENT POSTING OF "O2" TO A AFP CLASS LOAN.
      *  JTG 042996 ADDED CLEAR OF UPDATE AFPDLLP-AMOUNT
      *  JTG 042996 STOPPED AFP CLASS FROM POSTING WITHDRAWAL FROM RESERVES
      *  MJD 043096 ADDED PASSWORD TO "IR" TRCD.
      *  MJD 050396 REQ #E114. WHEN UPDATING INTERBRANCH PAYMENTS, AFTER
      *             PAYMENT IS UPDATED RETURN TO INTERRUPT SCREEN.
      *             IF INTER BRANCH POSTING THEN FORCE FULL-DISPLAY
      *             TO 'B' FOR BRIEF. REST OF LOGIC IS IN LONPF0
      *  JTG 050896 ADDED LOGIC FOR "LR" LOAN RE-SCHEDULE TRANSACTION
      *  JTG 052396 ADDED LOGIC FOR GP-ALLOW-PI-WITH-SE-BAL
      *  BAH 061296 PASSWORD "SE", RAC #29
      *  JFF 061496 ADDED CHECK IN TEST-VALID-CLASS-TSTP TO VERIFY
      *             INTEREST TYPES WERE THE SAME WHEN TRANSFERED.
      *  MJD 071096 CHANGED DISPLAY OF PDTH. IF MONTHLY: MMYY OR MM/DD/YY.
      *             IF WEEKLY: MMDD OR MM/DDWYY
      *  JTG 092496 WHEN POSTING A 'Z2' AND IT WILL CAUSE THE ACCOUNT
      *             TO GO INTO EXPIRATION; CHANGED PROGRAM TO INSTRUCT
      *             OPERATOR TO ASSESS ALL LATE CHARGES DUE, SINCE ONCE
      *             IN EXPIRATION, NO LATE CHARGES WILL BE CHARGE THE ACCOUNT!!
      *  MJD 100396 ADDED BR-INBR-BRIEF-FG TO DECIDE WHETHER OR NOT TO FORCE
      *             BRIEF WHEN IN INTERBRANCH.
      *  BLV 100996 CHANGED PASSWORD SEQUENCE FOR DEFERMENTS; DF-SEQ(0) FOR
      *             POSTING DEFERMENT; DF1-SEQ(1) FOR EXCEEDING MAX DEFERMENTS
      *  JTG 101196 ADDED CLEAR HOLD-EARNINGS-IB-OWING
      *                         HOLD-EARNINGS-IB-ERNINT
      *                         HOLD-EARNINGS-IB
      *                   CLEAR OF LXE-WORKER & LXE-WORKER2
      *  JTG 120296 CORRECTED BUG IN CLEAR OF WK-LXE-EARN(1)(2)(3)
      *  BAH 120696 DONT ALLOW POSTING TO AN ACCT THATS BEING RENEWED INTO
      *             A RESCISSION ACCOUNT
      *  JTG 010397 CHANGED TEST FOR LCPDTH & LCHG DISPLAY TO NEVER DISPLAY
      *             IF SP-LCFRMLA = " " AND REMOVED TEST ON JUDGEMENT
      *             SINCE ACCOUNTS IN JUDGEMENT CAN CONTINUE AS PRECOMP
      *  JTG 022797 CHANGED LOGIC TO ASSURE A MATCHING SPR RECORD EXISTS
      *             FOR 'TP' & 'TS' TRANSACTIONS
      *  JTG 030497 REMOVED UNNECESSARY SEND-MESS MESSAGES FOR 'TP' & 'TS'
      *  JTG 120296 CHANGED TO STILL FLAG THE LOAN AS BEING A SERVICE
      *             ACCOUNT (PASS-STAT-FG = S) (FOR QUOTERS), BUT ALLOW
      *             PAYOFF TO COMPUTE (FOR LONPFC.C)
      *  JTG 120296 CHANGED TO STILL FLAG THE LOAN AS BEING A SERVICE
      *             ACCOUNT (PASS-STAT-FG = S) (FOR QUOTERS), BUT ALLOW
      *             PAYOFF TO COMPUTE (FOR LONPFC.C)
      *  JTG 040797 CLEARED EARN-BUF TO SPACES IN DISPLAY-EARNINGS ROUTINE
      *             WAS LEAVING GARBAGE D-LCPDTH FROM ENTRY-LINE-DISPLAY
      *  JTG 041097 CHG TO TEST FOR SP-EXPR-FRMLA-CONT & NOT SP-EXPR-FRMLA = " "
      *  MJD 050697 ADDED TEST FOR "ST" TRCD FOR ADDONS.
      *  BAH 050897 ALWAYS DISPLAY BALANCES,EVEN ON REVERSALS, #487
      *  JTG 060397 ADDED NEW TRCD (R3) AND (C3) OTHER 3 INSURANCE
      *             CHANGED CLEAR OF LPPFBUF: REB-AMOUNT(), U-INSOURS()
      *                                       INS-RB-TBL()
      *  MJD ADDED CLEAR OF INS-RB-TBL(6-8)
      *  MJD 072897 ADDED BR-LONPF-OPT-DISPLAY. IF "Y" THEN DISPLAY LAST TWO
      *             TRANSACTIONS AND LAST/NEXT/TODAY DUE AMOUNTS LIKE CPINQ
      *  BAH 080697 ADDED RV-SEQ FROM A48 TO PASSWORD REVERSALS
      *  JTG 081397 ADDED DUE DATE CHANGE RESTRICTION LOGIC FOR RELIANCE #63
      *  GLF 090597 REPLACED 'IO' ON GP-FILE WITH GET 'GPENV'
      *  JTG 091897 ADDED TEST FOR TRCD = 'AH', WORLD A90
      *  JTG 092397 ALLOWED 'SS' TRASACTION ON INTERBRANCH PAYMENTS, RELIANCE 66
      *               AND PASSWORD PROTECTED 'SS' PASSWORD SEQ #17
      *  GLF 101097 ADDED CTRL 'N'
      *  MJD 101797 MOVED WK-UPDATE-BUF TO LP01WK
      *  GLF 101797 ADDED MOVE LN-APPNO TO EXT-WI-CL-APPNO
      *  JTG 111197 ADDED BR-DUEDATE-CHANGE-CD OPTION 'M' MERCURY
      *              RE: LIBLP/LPDUEDA (ADDED LPCEPP, AGEING, LPUPWK)
      *  BAH 111197 ADDED HOLD-SP1-KEY TO CL/LEDGER LINKAGE CALL (LC-GIFTNET)
      *  JTG 111197 ADDED LOGIC FOR LIBLP/DEFPOL RE: BR-NODEF-1ST-X-MONTHS #167
      *  BLV 020698 ADDED PASSWD SEQ 18 FOR TRANSACTIONS PR, PC, PP
      *  KEC 030998 ADDED 'F4-TOGGLE ON DATE' OPTION.  TOGGLE ON DATE
      *              FROM LP-PAYDATE TO LP-TRDATE AND BACK.
      *  BLV 041698 CHANGE REFNO ENTRY FOR P2, P3 TRANSACTIONS FROM
      *             NUMERIC TO ALPHA...NOT SURE WHY IT WAS NUMERIC.
      *   CS 042898 ADDED "RB" "RO" RENEWAL CODES
      *  JTG 042998 ALLOWED INPUT OF TRCD'S "RB" AND "RO" RENEWAL CODES
      *  BAH 060498 IF TRCD "PL" AND BR-AUTO-PL-REF-AC "Y" AND PRE-COMP AND
      *             NOT ALREADY ACCELERATED, ASK FOR ACCELERATION RATE, #E180
      *  JTG 060498 ALLOWED, LP-TRCD = "PB" OR "RN" OR "RB" OR "RO" FOR SALES
      *             FINANCE ACCOUNTS, WHICH WILL BE CONVERTED TO A SALES
      *             FINANCE CLASS
      *  BAH 060598 ALLOWED INPUT OF TRCD "PX" PARTIAL CHARGE OFF, MERCURY #175
      *  BAH 060898 ALLOW INPUT OF TRCD "BK" BANKRUPT, MERCURY #174
      *  KEC 060898 ADDED 'POSTING-TYPE' FOR KNOWING IF POSTING FROM
      *              WITHIN THE BRANCH OR FROM ANOTHER BRANCH
      *              (INTERBRANCH).
      *             MADE CHACGE FOR POSTING A TRCD OF 'SS'.  IF IT IS
      *              DONE FROM WITHIN THE BRANCH, DO NOT CHECK FOR
      *              PASSWORD.  IF IT IS DONE FROM ANOTHER BRANCH, CHECK
      *              FOR PASSWORD.                         [ PR#: E181 ]
      *  KEC 060998 ADDED NEW PASSWORD SEQUENCE NUMBER FOR TRCD OF 'SS':
      *                SS-SEQ-STANDARD    HAS VALUE OF 17;
      *                SS-SEQ-INTERBRANCH HAS VALUE OF 20.
      *  JTG 070298 TEMPORARY STOP OF INSURANCE CANCELS UNTIL LONPF2.C
      *             IS CORRECTED TO PROPERLY GENERATED TP-FIELDS SO LPEOD5
      *             WILL UPDATE GENERAL LEDGER CORRECTLY.
      *  BAH 070898 ALLOW INPUT OF TRCD "BD" TO REMOVE BANKRUPT, MERCURY #195
      *  JTG 071598 ADDED THE FOLLOWING PASSWORD SEQUENCES TO PROTECT RENEWALS:
      *                   LN-RB-RO-SEQNO - 21
      *                   SF-RB-RO-SEQNO - 22
      *                   SF-PB-RN-SEQNO - 23
      *
      * JTG 072098 CHANGED TO STOP BANKRUPT RENEWALS VIA 'RB' AND 'RO'
      * JTG 072098 RE-ENABLED BANKRUPT RENEWALS VIA 'RB' AND 'RO'
      * JTG 072198 ADDED LOGIC FOR CARRY OVER OF OT2 MONIES ON RENEWALS
      * BAH 081198 ADDED MERCURY'S NEW EDIT ON ALLOWABLE DELINQUENCY, #193
      * JTG 081198 CORRECTED DISPLAY LIST FOR CODE-LIST REMOVED 'PMPT-DATE'
      * KEC 081198 ADDED PASSWORD LOGIC/SEQ(24) FOR 'PX' TRANSACTION.
      *             THIS IS PER JIM ROSENAUER'S REQUEST!!!
      * MJD 081198 ADDED ENV VARIABLE TO DETERMINE WHETHER OR NOT
      *            TO DISPLAY BALANCES ON REVERSALS. FIXED DISPLAY TO INDICATE
      *            INCLUDED O2 BAL WITH "SC RN PB RB RO" TRANSACTIONS
      * JTG 081898 ALLOWED 'PB' ON BANKRUPT ACCOUNTS IF GP-I-AM-WORLD <JGW
      * JTG 090998 CORRECTED MERCURY'S NEW EDIT ON ALLOWABLE DELINQUENCY, #193
      *            PER SHEILA WHO REQUEST THAT WE TEST FOR MORE THAN 1 PAYMENT
      *            PAID AHEAD
      * JTG 101298 ALLOWED DISPLAY OF NEGATIVE CURBAL REVOL REGENCY
      * JTG 101698 ADDED LOGIC FOR REVOLVING ADDON WINDOW CALL, 'PU'
      * JTG 101698 ADDED LOGIC FOR REVOLVING PAYMENTS
      * JTG 110798 ADDED LOGIC FOR REVOLVING OTHER CHARGES (OT)
      * JTG 121898 ADDED CTRL 'Y', REVOLVING TRANSACTION SCAN REGENCY
      * MJD 990201 ADDED LN-ACCT-FROZEN. IF FLAG = "Y" THEN DO NOT
      *            ALLOW POSTING TO ACCOUNT.
      * JTG 990218 ADDED LOGIC TO STOP LAST DUE & NEXT DUE FROM DISPLAYING
      * MJD 990305 ADDED LOGIC TO VERIFY REFNO IF GP-REFNO-VERIFY = "Y"
      * MJD 990324 CHANGED VERIFY-REFNO TO IGNORE "BK" TRCD'S
      * JTG 990324 ADDED 'PN' NON CASH PAYMENT.WITH GL ENTRY           TFC #013
      *            ADDED 'PZ' NON CASH PAYMENT/NO RECDEL.WITH GL ENTRY TFC #012
      * JTG 990331 CHANGED 'NSF ONLY' TO 'NSF BANK REVERSAL'
      * JTG 990405 ALLOWED 'Z2' 'O2' INTERBRANCH PAYMENTS          MERCURY #XXX
      * JTG 990412 ALLOWED 'BK" AND 'BD' FOR REVOLVING             REGENCY #XXX
      * JTG 990427 ALLOWED 'PL" FOR REVOLVING                      REGENCY #XXX
      * BLV 990624 ALLOW REPO TRANSACTIONS SX & SV ON PL ACCOUNTS IF
      *            GP-ALLOW-REPO-ON-PL IS "Y" (TFC PR#20, GR SUBURBAN PR#809)
      * BAH 990630 CHANGED VERIFY-REFNO TO SKIP TESTING IF LP-TRCD = "SP" OR
      *            "DC" OR "P2" OR "P3" OR "PR" OR "PC" OR "PP" OR "P4" OR "P5"
      * JTG 990701 ADDED LOGIC FOR DIRECT LOAN REVOLVING 'AV' CASH ADVANCE
      * JTG 990729 ADDED CD-RO-NUM TO PROVIDE AN ALPHA KEY RE: CD-RO-CODE
      * JTG 990730 ADDED 'WI' AND 'WL' FOR REVOLVING
      * CS  990805 CHANGE TEST FOR BR-RI-BEFORE REPO TO TEST LN-LOANTYPE NOT
      *            IBPC-FG, ACCTS IN EXPIRATION DID NOT FORCE RI OR AC
      *            PER THE MEANING OF THE FLAG
      *  MJD 990806 ADDED GP-INCL-OTH-IN-EARNED FLAG. IF "Y" THEN INCLUDE
      *             EARNINGS BUCKET 6 (OTHER) IN ACCUMULATED TOTALS
      *             OTHERWISE EXCLUDE BUCKET 6.
      * JTG 990816 ADDED 'PE' FOR REVOLVING
      *  CS 990816 PUT BACK TEST ON IBPC-FG(REPO) WE STILL DO NOT ALLOW AN
      *            RI ON ANY ACCOUNT IN IB STATUS
      * JTG 990901 ADDED 'AP' LOGIC FOR REVOLVING, #47 REGENCY
      * JTG 991011 CHANGED SETUP-LINE FOR 'AP' DISPLAY REVOLVING, #47 REGENCY
      *            AND CHANGED CALL TO CL/LEDGER.C TO PASS LC-REC
      *  MJD 991220 ADDED SP-DEFPOLCD = "B" (WORLD PR#216)
      *  MJD 991223 ADDED PASSWORD FOR EFFECTIVE DATE OF A RENEWAL
      *             {RN, PB, SC, RB, RO} [WORLD PR#221)
      *  JTG 000324 NEW DEFERMENT FORMULA SP-DEFFRMLA = 97 (> OF INTDUE OR
      *             1/ 3 OF REGPAY) MERCURY #224
      *  MJD 000403 ADDED PASSWORD FOR PN AND PZ TRANSACTIONS;SEQ=27 (MERC PR#?)
      *  MJD 000505 ADDED PASSWORD TO REFNO ENTRY OF "LBOX" (MERC PR#227)
      *  BLV 000508 ADDED PASSWORD FOR PE, SEQ #29  (MERC PR#231)
      *  KEC 000608 {PR#00229} MERCURY FINANCE [CINDY SHAFFER]
      *              ADDED VERIFICATION FOR IF POSTING A "RI"
      *              TRANSACTION OR "PL" TRANSACTION (WITH AUTO
      *              REFUND/ACCELERATE P&L SET TO "Y") WITH A DEFERMENT
      *              REBATE FORMULA "X", THE DEFERMENT MUST BE REBATED
      *              BEFORE A "RI" OR "PL" TRANSACTION CAN HAPPEN.
      *  JTG 000710 {PR#00229} MERCURY FINANCE [CINDY SHAFFER]
      *              CORRECTED LOGIC TO BYPASS TEST IF ACCOUNT IS IN 'IB' STATUS
      *  BLV 000712 ALLOW PL TRANS TO ON-HAND REPO ACCOUNT IF GP-ALLOW-PL-ON-SX
      *             IS "Y", TFC PR# 77
      *  MJD 000912 CHANGED TO DISPLAY A MESSAGE IF A LOCK BOX ACCOUNT
      *             IS DISPLAYED. (MFC PR#227)
      *  JTG 000912 ALLOW POSTING AND REVERSALS OF "PA" (NSF) (LBOX)
      *             TRANSACTIONS  (MFC PR#234)
      *  JTG 000925 TOOK OUT FORCED 'NSF' ON REVERSAL OF 'PA' 'LBOX'
      *             ALLOW POSTING AND REVERSALS OF "PA" (NSF) (LBOX)
      *             TRANSACTIONS  (MFC PR#234)
      *  BAH 000926 ADDED RN-SEQ (30) PASSWORD FOR ALL "RN" TRANSACTIONS
      *             AJ FINANCIAL, PR# 1288
      *  JTG 000928 CORRECTED POSTING "PA" (LBOX) TRANSACTION
      *             NOTE: I HAD TO DUPLICATE PASSWORD LOGIC IN ROUTINE
      *                   THAT AUTOMATICALLY SENT 'LBOX' TO THE
      *                   REFERENCE FIELD                 (MFC PR#234)
      *  MJD 001011 FIXED BUG.  IF YOU HIT F4 AFTER RETURNING FROM ANOTHER
      *             POSTING PROGRAM WITHOUT PAGING UP OF DOWN THEN THE
      *             PAYMENT LINES ARE CLEARED. THE PROBLEM IS THAT THIS
      *             PROGRAM DOES NOT REDISPLAY THAT PART OF THE SCREEN UPON
      *             RETURNING FROM OTHER POSTING PROGRAMS, THERBY LEAVING THE
      *             BUFFERS BLANK.
      *             FIXED BUF, IF YOU PAGE DOWN ON THE FIRST PAGE OF PAYMENT
      *             INFO WHEN BR-LONP-OPT-DISPLAY = "Y" THEN THE 1-7
      *             LINES OF PAYMENTS ARE MOVED TO THE BOTTOM OF
      *             THE SCREEN WITH BLANK LINES PADDING THE TOP.
      *  MJD 001019 ADDED LOGIC TO ACCEPT PG-UP AND PG-DOWN AS SCROLL KEYS.
      *             YAS PER JTG).
      *  BAH 001027 POSTING A "PP" AND ENTERING A REFNO, THE VDUBUF WAS NEVER
      *             MOVED TO LP-REFNO INSIDE DLRVNO-ENTRY SECTION, KRUSE/CENTRIX
      *  JTG 001121 ADDED BR-ALLOW-OV-TRCD FOR 'OV' OVERPAYMENT     PR#J015
      *             CLEAR OF HOLD-OVPAID-CHECK
      *  BAH 001207 ADDED PASSWORD FOR SUNBELT, CANT "PB,RN" UNTIL LOAN IS > 90
      *             DAYS OLD, PR# 1368
      *  BAH 001219 CHANGED ABOVE PASSWORD FROM 91 DAYS TO 3 MONTHS 1 DAY,
      *             SUNBELT PR# 1387
      *  MG  010201 REMOVED "01 WK-LXE" AND ADDED LIBLP/LPWKLXE.
      *  CS  010313 ADDED PASSWORD FOR SP TRANSACTION SEQ (32) MERCURY
      *  JTG 010316 CHANGED TO TEST FOR LP-REFNO = ALLOT, LBOX, TCOLL,
      *             TPAY OR WESTU                                 MERCURY PR#245
      *  JTG 010321 ADDED TEST FOR GP-ALLOW-SET-FOR-NONCASH = "Y" TO FURTHER
      *             TEST ALLOWING FOR LP-REFNO = ALLOT, LBOX, TCOLL,
      *             TPAY OR WESTU                                 MERCURY PR#245
      *  CS  010525 ALLOWED INTERBRANCH PO POSTING. ADDED PASSWORD SEQ 33
      *             PO-SEQ-INTERBRANCH (MERCURY #250)
      *  CS  010608 ADD PASSWORD FOR BACKDATE OF SX TRANSACTION REGIONAL PR#1478
      *             [DIR:LP  PROG:LONPF1  SEQ:34
      *  CS  010610 IF GP-REPO-CODE = 'A' CHECK THE LS FILE (REPO INFO) THAT
      *             'WILL CUSTOMER REDEEM - LSX-REDEEM-DATE NOT = ZERO.
      *  BAH 010612 REGACC, IF ACCOUNT IN "REPO ON HAND" OR "REPO SOLD" STATUS,
      *             FORCE THE USER TO USE THE REPO DATE AS THE EFFECTIVE
      *             DATE FOR ANY REBATES, OR ENTER PASSWORD, PR# 1478
      *             78  REPO-EFF-SEQ        VALUE 35.
      *  CS  010614 IF GP-REPO-CODE = 'A' AND ACCOUNT IS IN REPO-ON-HAND OR
      *             REPO-SOLD DONT ALLOW POST OF 'PY', 'PA', 'OT', 'AP' UNLESS
      *             PASSWORD ENTERED [DIR:LP PROG:LONPF1: SEQ:36 REGACC PR#1478
      *  JTG 010614 ADDED NEW TRCD "OP" FOR AUTOMATIC OT/AP COMBINATION
      *             ADDED NEW TRCD "RE" FOR REPO EXENSE ADDON,
      *             ADDED REFNO SCAN WHEN GP-REFNO-VERIFY = 'Y' OR
      *             WHEN "RE" IS POSTED                          REGACC PR#1478
      *  BAH 010619 ADDED HOLD-REPO-AUCTION-EXP FOR "SS", REGACC PR# 1478
      *  JTG 010620 ADDED NEW TRCD "OP" FOR AUTOMATIC OT/AP COMBINATION
      *             ADDED NEW TRCD "RE" FOR REPO EXENSE ADDON,
      *             CORRECTED DISPLAY OF PAYMENT LINE REGACC PR#1478
      *  JTG 010720 ADDED NEW RATE TYPE 'Z' AMORTIZED WHERE RUNTIME COMPUTES
      *             INTEREST ON A 30 DAY METHOD (REAL ESTATE) AND LOAN CALCS
      *             ARE DONE SIMPLE, REMOVED TIE TO CTBL, FORCING TESTS ON (1)
      *             NOTE: STOPPED BACKDATING UNLESS ENV VARIABLE
      *                   "BACKDATING_Z" EXISTS
      *                                             LENDMARK PR#1045 & PR#1380
      *  JTG 010807 ALLOWED OTHER REFNO'S WHEN ACCOUNT IS UNDER LOCK BOX
      *             STATUS AND 'PA' IS POSTED                       MERC PR#331
      *  JTG 010814 CHANGED GI-PAYWESTU TO GI-PAYMGRAM           MERCURY PR#258
      *  JTG 010814 CREATED NOW OPTION 'M' FOR BR-BP-PAYOFF-OV
      *             AND BR-LBOX-PAYOFF-OV WHICH WILL CREATE 'OV' TRANSACTION
      *             BUT WILL NOT CREATE A CHECK REQUEST           MERCURY PR#256
      *  JTG 010904 ALLOWED IB TYPE LOANS TO ACCELERATE     JIM R. (ALL) PR#1582
      *  JTG 011004 ADDED HOLD-LXZ(FIELDS) FOR UPDATE LX-Z RECORD
      *             RE: NEW RATE TYPE 'Z' AMORTIZED   LENDMARK PR#1045 & PR#1380
      *  BAH 011011 BR-AUTO-PL-REF-AC WAS NOT ACCEL'ING AN "IB", THIS WAS
      *             MISSED BY THE 010904 CHANGE !!
      *  BAH 011016 GP-REPO-CD "A", PASSWD OPT 36, NEEDED TO TEST PLDATE = 0
      *  BAH 011205 ADD PASSWORD ON "RI" WITH "CHECK" IN THE REFNO, JIM R.
      *  JTG 020117 CHANGED FIELDS FROM S9(6)V99 TO S9(7)V99    LENDMARK PR#J021
      *  BAH 020304 CHANGED MERCURY'S ALLOWABLE DELINQ POLICY "A" FROM NOT
      *             ALLOWING AN ACCOUNT TO GO PAID AHEAD, TO NOT ALLOWING THE
      *             "AD" UNLESS IT MAKES THE ACCOUNT CURRENT, MERC PR#267
      *  JTG 020308 ADDED "CT" COUNTY TAX CODE KENTUCKY AND PERCENTS
      *             ADDED "CY" CITY   TAX CODE KENTUCKY AND PERCENTS
      *             ADDED HOLD-INS-TAX-RB() OCCURS 8 S9(7)V99 REFUNDS WORLD #288
      *  JTG 020426 ALLOWED'DC' TRANSACTION
      *             ADDED HOLD-LXZ(FIELDS) FOR UPDATE LX-Z RECORD
      *             RE: NEW RATE TYPE 'Z' AMORTIZED   LENDMARK PR#1045 & PR#1380
      *  JTG 020501 REMOVED ALLOWED'DC' TRANSACTION
      *             ADDED HOLD-LXZ(FIELDS) FOR UPDATE LX-Z RECORD
      *             RE: NEW RATE TYPE 'Z' AMORTIZED   LENDMARK PR#1045 & PR#1380
      *  BAH 020502 PASSWORD FOR BACKDATE OF PL TRANSACTION REGACC PR#1782
      *             DIR:LP  PROG:LONPF1  SEQ:38
      *  BAH 020515 ADDED ADDITIONAL LSX FIELDS TO BE MANDATORY BEFORE
      *             POSTING "SX" IF GP-REPO-CODE = "A", REGACC PR# 1799
      *  JTG 020603 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *             ADDED CLEAR OF HOLD-LXM-MIP-CLPAID HOLD-LXM-MIP-CLPDTH
      *                            HOLD-LXM-MIP-AHPAID HOLD-LXM-MIP-AHPDTH
      *  BAH 020626 ADDED LSX-REASON-CODE TO BE MANDATORY BEFORE
      *             POSTING "SX" IF GP-REPO-CODE = "A", REGACC PR# 1775
      *  BAH 020712 PASSWORD FOR "AP" ON P&L ACCOUNTS (SEQ=39), WORLD #297
      *  JTG 020731 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *             ALLOWED 'CC' AND 'CA' TO CANCEL MIP INSURANCE
      *  JTG 020806 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *             CHANGED SEND-DUE-DATE ROUTINE TO INCLUDE DUE MONTHLY
      *             INSURANCE PREMIUMS (MIP)
      *  BAH 020924 CHANGED FIELDS TO BE REQUIRED ON "SX", REGACC PR# 2
      *  BAH 021011 ADDED NEW TRANSACTION CODE OF "IN" INSURANCE LOSS, EXACTLY
      *             LIKE "PE", REGACC PR# 0007
      *  BAH 021023 PASSWORD FOR "O2" (OPT = 40) , JIMR PR# 1945
      *  BAH 021024 SPLIT OUT PASSWORD FOR P2 AND P3, P3 NOW OPT=6
      *             WORLD #305
      *  BAH 021106 REGACC DOES NOT WANT TO TEST LN-LBOX OR LN-ALLOTCD FLAGS
      *             ANYMORE... KM
      *  BAH 021108 ALLOW F11 FROM POSTING DATE TO BRING UP COLLECTIONS ASSIST
      *             SCREEN, REGACC PR# 8, NEED TO UNSET F11PROG
      *  CS  021111 ALLOW SET POOL (SP) THRU INTERBRANCH POSTING [PR#308 WORLD]
      *  JTG 021011 ADDED NEW CODE FILE TYPE 'BR' -BATCH PAYMENT REFERENCE CODES
      *             BATCH PAYMENT REVISIONS ADDED BATCH-REFCD      REGACC #0006
      *  JTG 021203 ADDED NEW CODE FILE TYPE 'BR' -BATCH PAYMENT REFERENCE CODES
      *             REMOVED GP-BATCH-PAY-REVISIONS                 REGACC #0006
      *  JTG 021206 CHANGED TO MAKE BATCH-REFCD = LOW-VALUES UNLESS IT
      *             IS VALID  GP-BATCH-PAY-REVISIONS               REGACC #0006
      *  JTG 030113 REMOVED TEST ON LN-LBOX OR LN-ALLOTCD FLAGS
      *             WHEN POSTING 'PA' TRANSACTIONS.... JG .. KM    REGACC #0006
      *  JTG 030205 CHANGED LDUE & TDUE DISPLAY PER DIRK FOR EXCLUSION
      *             OF MIP INSURANCE PREMIUMS                      REGENCY #1998
      *  CS  030410 ADDED HOLD-NFE-CK-NUMBER [CASHCO PR#2034]
      *  CS  030415 ADDED TEST OF GP-NF-UPD-REFNO CODES TO DETERMINE IF
      *             NF CHECKNO ENTRY WINDOW SHOULD DISPLAY [CASHCO PR#2034]
      *  CS  030422 REMOVED 'PA' AS A TRANSACTION CODE THAT WILL TRIGGER
      *             ENTRY OF CHECK NUMBER (WI/NFENTR)  [CASHCO PR#2034]
      *  CS  030422 PER JR JUST TEST THE FIRST 2 CHARACTERS MATCH THE GP-UPD-
      *             REFNO [CASHCO PR#2034]
      *  JTG 030701 ACCOUNTS BYPASS LATE CHARGE ASSESS ROUTINE WHEN
      *             SP-LCFRMLA = ' ' BUT ACCOUNT IS SETUP FOR DEALER LATE
      *             CHARGE FORMULA                               MIDATL #J029
      *  BAH 030711 PASSWORD POSTING "PI" ON A PL ACCOUNT, FINMGM PR# 2114
      *  JTG 030724 TESTED BR-ALLOTMNTS TO DETERMINE WHETHER TO DISPLAY
      *             "ACCOUNT UNDER ALLOTMENT PLAN" OR "ACCOUNT UNDER LOCK
      *             BOX TYPE PLAN"                           CENTRIX ANDREA JTGX
      *  JTG 030926 ADDED TEST ON 'DC' DUE DATE CHANGE TRANSACTION TO NOT ALLOW
      *             A REQUESTED DAY TO BE GREATER THAN THE LAST VALID DAY
      *             IN THE ORIGINAL FIRST PAYMENT DUE MONTH        REGENCY #0417
      *  BAH 040609 PASSWORD "AD" FOR ACCOUNTS NOT FLAGGED AS SALES OR SMALL,
      *             THESE ARE REAL ESTATE ACCOUNTS, LENDMARK PR# 2315
      *  JTG 040722 CREATED NEW TRCD 'ZX' WHAT WORKS LIKE 'SX'     CENTRIX #2314
      *  BLV 040728 ADDED OPTION TO ONLY ALLOW LETTERS & NUMBERS (NO SPECIAL
      *             CHARS) IN REFNO IF GP-REFNO-VERIFY = "A", CENTRIX PR# 2350
      *   CS 040812 IF GP-REFNO-VERIFY = "T", SEE IF LP-TRCD EXISTS IN CODE FILE
      *             (TC TYPE).  IF IT DOES, COMPARE THE CD-TC-REFNO (10) AGAINST
      *             LP-REFNO. IF NO MATCH IS FOUND, DONT ALLOW [LENDMARK PR#2353
      *   CS 040816 FIXED TEST FOR VERIFY-REFNO-TRCD. WASNT WORKING IF YOU
      *             ENTERED A PAYMENT CODE THAT WASNT IN THE CODE FILE WAS
      *             NOT ALLOWING PAST THE REFNO.. CHANGED TO: IF IO-FG NOT
      *             ZERO ON READ OF CDFILE.... SET WS-MATCH FLAG TO "Y"
      *  JTG 040825 ADDED 'RI' 'RS' 'RM' AND 'AC' TO INTERBRANCH TRANS LIST
      *             AND PASSWORD PROTECTED                           WORLD #0357
      * JTG 040922 CHANGED TO ALLOW ENTRY OF BATCH-REFCD IN LP-REFNO
      *            ON 'OT' TRANSACTION                            CENTRIX #2253
      * BAH 040929 "DC" NEW DAY > 28 AND NOT FEBRUARY, WASNT DISPLAYING THE
      *            REFNO CORRECT, LENDMARK, PL# 449
      *  CS 050209 DONT ALLOW BACKDATE PRIOR TO INTEREST PAID THRU OR LATE
      *            CHARGE PAID THRU [PR#460 REGIONAL]
      *  CS 050214 DISPLAY WARNING MESSAGE IF POSTING < OR > 3 MONTHS FROM
      *            TRANS DATE [REGIONAL PR#460]
      * BAH 050223 ADDED BR-AUTO-PL-REF-AC VALUES OF "2" AND "3"
      *            "2" = PL OR P2 WILL AUTO REFUND,  "3" = PL OR P2 OR P3
      *            WILL AUTO REFUND, LENDMARK PR# 2473
      *  CS 050225 ALLOW INTERBRANCH POSTING OF "AI,AL,WI,WL,WO,DC,OP"
      *                                              [PR#2468 SUN FINANCE LA]
      *  CS 050309 COMMENTED OUT THIS CHANGE FROM 050209...DONT ALLOW
      *            BACKDATE PRIOR TO INTEREST PAID THRU OR LATE
      *            CHARGE PAID THRU [PR#460 REGIONAL], EXAMPLE:
      *              LCPDTH 3/15/05, TRYING TO PAY ON 3/9/05 AND IT WONT LET
      *              THEM...
      *  BAH 050406 ADDED LONPP1 FOR THRIFT INVESTMENT HARD COPY, PR# 2507
      *  BAH 050603 FORCE CERTAIN BANKRUPT FIELDS TO BE ENTERED BEFORE ALLOWING
      *             A "BK" TRANSACTION, REGACC PR# 104
      *  BLF 050719 COMMENTED OUT CHANGE FROM 02/14/05 (PR# 460), WAS COMMENTED
      *             OUT ON 3/9/05 BUT THEN GOT UNSTARRED AGAIN & THEY CAN'T
      *             POST BACKDATED TRANSACTIONS
      *  BAH 050811 WHEN GP-HIDE-FIRST-5-SSNO = Y, THIS PROGRAM DOES A FLDVAL
      *             TO GET VALUE OF SSNO INSTEAD OF USING BORROWER-KEY. DOES IT
      *             THIS WAY IN CASE YOU ARE POSTING FOR COMAKER. CHANGED TO
      *             USE BORROWER-KEY , BECAUSE THE SOC FIELD IS XXX-XX-1234
      *              REGACC PR# 109
      *   CS 050816 PER MULLEN, CHANGE PR#460 TO STILL TEST BACKDATED TRANS
      *             AGAINST INTEREST PAID THRU IF LOAN IN "IB" STATUS
      *  BAH 050817 ALLOW "PE" INTERBRANCH. ADDED PASSWORD SEQ 49, SUN PR#2586
      *  BAH 050915 ADDED TEST ON GP-DEFERMENT-APPROVAL FOR LENDMARK TO FIND
      *             LSP TRAILER AND MAKE SURE # DEFERMENTS WAS APPROVED PR#2568
      *   CS 051028 DONT ALLOW RESERVE TRANSACTIONS[PR,PC,PP,P4,P5] ON SERVICE
      *             ACCOUNTS PR#512 CINDY
      *   CS 051031 DONT ALLOW RESERVE TRANSACTIONS[PR,PC,PP,P4,P5] ON DIRECT
      *             ACCOUNTS PR#518 CINDY
      *  BAH 051104 CHANGED DEFERMENT APPROVAL TEST TO USE LC FLAGS AND NOT
      *             LN FLAGS....LENDMARK
      *  BAH 051115 ALLOW "IN" INTERBRANCH. ADDED PASSWORD SEQ 50,
      *             REGACC PR#115
      *  BAH 060208 CAN NOT RENEW A CLASS 8 LOAN, FINMGM PR# 2702
      *  CLS 060320 ADD PASSWD SEQ 51, IF SERVICE MUST POST 'TP' MIDATL PR2698
      *  BLF 060322 IF RENEWAL & ACCOUNT DOES AUTO ELECTRON PMTS, DISPLAY THIS
      *             INFO IN WINDOW & USER MUST TYPE "CONTINUE".
      *             LENDMARK PR# 2711
      *  BAH 060525 ADD LN-OTHBAL TO DUE AND NEXT DUE, SOAUTO PR# 2797
      *   CS 060608 IN PROGRESS:  ADDED GP-I-AM-SECURITY PR#2503 TO MATCH
      *             LN-DLNO EXTENTION TO RESERVE LEVEL. IF DLNO ENDS IN 01
      *             MUST USE RESERVE 1
      *  BAH 060712 DONT DO BACKDATE-TEST IF LN-INTPDTH-DATE = 0 ON A NEW LOAN
      *             HAMPTON ROADS, KEVIN
      *  BAH 061005 ALLOW BANKRUPT CHAPTER 12 FOR WORLD PR# 497
      *   CS 061127 ALLOW "BK" TO POST INTERBRANCH ADDED TO CDV-INTERBRANCH
      *                                                    WORLD PR# 505
      *   CS 061127 ALLOW "BD" TO POST INTERBRANCH ADDED TO CDV-INTERBRANCH
      *                                                    WORLD PR# 505
      *  BAH 070201 ADDED LOGIC FOR TESTING BR-MIN-MONTHS-DEF REGACC PR# 162
      *   CS 070622 CURRENTLY ALLOW F1,'L' TO REPRINT LAST LEDGER LINE, ALLOWED
      *            'M' AND INPUT OF HOW MANY LINES TO PRINT OLDEST TO NEW
      *                                                   REGMGM PR#2993
      *   CS 070710 DON'T ALLOW MULTIPLE DF'S IF SP-DEFFRMLA 96 PR#2477 MULLEN
      *  BAH 071101 WHEN ADDING LN-OTHBAL TO TDUE AND NDUE, DO NOT ALLOW IT
      *             TO BE GREATER THAN PAYOFF. SOAUTO/FFG PL# 607
      *  BAH 080111 ALLOW "IN" INTERBRANCH, CDV-INTERBRANCH REGACC PR# 194
      *  BAH 080402 MAKE A SEPARATE PASSWORD FOR "BD" FOR WORLD, PR# 576
      *  BLM 080717 IF I-AM-WORLD, SKIP CHECK ON GP-ALLOW-SET-FOR-NONCASH
      *             FLAG IN REFCD ENTRY; IF I-AM WORLD & ON-FILE REFCD IS
      *             ENTERED, ONLY ALLOW POSTING A "PA" OR "PO", WORLD PR# 573
      *  BAH 080728 PASSWORD "NC" BRANCHES DO NOT ALLOW ANY "RN" OR "PB" IF THE
      *             CUSTOMER WAS 91 OR MORE DAYS PAST DUE.  REGMGM PR# 3225
      *  BLM 080930 IF I-AM-WORLD, ADD CHECK TO STOP HARD-CODED ALLOTMENT
      *             REF CODES: ALLOT, LBOX, TCOLL, TPAY, MGRAM
      *  BAH 080930 CHANGE REQUIRED LSX FIELDS FOR "SX" POSTING, REGACC PR#218
      *   CS 081010 ALLOW INTERBRANCH 'PL', 'P2' REGIONAL ACCEPT PR#222 SEQ 55
      *             PASSWORD MUST EXIST!
      *   CS 081112 ADD TEST ON GP-INCL-OTH-IN-EARNED = 'R'. IF 'R' EXCLUDE
      *             OTHER(ANTICERN(6) AND MAINTFEE(ANTICERN(4) FROM EARNINGS
      *             AND UNEARNED    REGACC PR#210
      *  BAH 081125 ADD TEST ON ST-REINSTATE-WINDOW FOR MAKER/COMAKER WHEN
      *             GP-REPO-CODE = "A" AND POSTING 'SX', REGACC PR# 228
      *   CS 081210 ADDED SX,RE,SV,IR,PX,PW,W2,PI TO INTERBR POSTING. INSTEAD
      *             OF VERIFY-PASSWORD, THE PASSWORD MUST EXIST BEFORE YOU
      *             ARE ALLOWED TO CONTINUE   REGACC PR#231
      *   CS 090213 ADDED PR238-SEQ-INTERBR IF PA,WL,WI,DC,OP,RP,R1,R2,R3
      *             PASSWORD MUST EXIST WHEN POSTING INTERBR. REGACC PR238
      *  BLM 090507 IF I-AM-REGMGM: SKIP CHECK ON GP-ALLOW-SET-FOR-NONCASH
      *             FLAG IN REFCD ENTRY, IF REGMGM & ON-FILE REFCD IS
      *             ENTERED, ONLY ALLOW POSTING A "PA" OR "PO", IF REGMGM
      *             ADD CHECK TO STOP HARD-CODED ALLOTMENT REF CODES: ALLOT,
      *             LBOX, TCOLL, TPAY, MGRAM.  REGMGM PR# 3359
      *   CS 090728 IF I-AM-SECURITY, DONT ALLOW POST OF PR,PC,PP,P4,P5 IF
      *             DL-BR = 4,(PLAN 4)  SECURITY AUTO PR#3402
      *  BLM 100309 ADD TRCD "DE", DISBURSE ESCROW, WILL ENTER AMT OF
      *             DISBURSEMENT & WHAT IT'S FOR, TAXES, INS, ETC.
      *             REGWAN PR# 3506
      *  BLM 100309 DON'T ALLOW PO IF ES-BALNCE NOT = 0, REGWAN PR# 3506
      *  BLM 100309 ADD TRCD "EP", ESCROW PREPAYMENT, WILL ENTER AMT OF
      *             PREPAID; ALSO CHANGED 'DE' DISBURSE ESCROW TO TRCD
      *             OF 'ED', REGWAN PR# 3506
      *  BLM 100309 CHECK FOR LN-ESCROW-FG OF "I" AS WELL AS "Y", ALLOW
      *             EP, ED, CTRL-R, AND CHECK FOR ESCROW ON PAYOFFS,
      *             REGWAN PR# 3506
      *  BLM 100316 ADJUST MESSAGES FOR POSTIVIE OR NEGATIVE ESCROW
      *             BALANCES ON PAYOFF, REGWAN PR# 3506
      *  BLM 100405 DON'T ALLOW POSTING OF "AH" TRANSACTION IF LOAN HAS ACTIVE
      *             ESCROW (LN-ESCROW-FG = "Y"), REGWAN PL# 683
      *   CS 110121 CORRECTED 'IF' CONDITION ON (PI,SX,SV,IR) INTERBRANCH.
      *             AN END-IF WAS NEEDED FOR EACH OF THE ABOVE
      *                                                      FINMGM PL#716
      *  BAH 110328 ADDED PASSWORD OPT 64 TO POST "OT" TO AN ACTIVE SCRA
      *             ACCOUNT (LSR-SCRA-ACTIVE). REGACC PR# 289
      *  BLM 120302 DON'T ALLOW F11 COLLECTION ASSIST WINDOW IF I-AM-WORLD &
      *             MEXICO, WORLD PR# 792
      *   CS 120727 BUG IN GP-I-AM-SECURITY TEST LP-TRCD = PC OR PR OR PP OR P4
      *             OR P5, THERE WAS A "." AFTER PERFORM GET-DL & IF YOUR
      *             DEALER BRANCH WAS = 4, YOU COULD NOT POST. THIS TEST WAS
      *             MEANT ONLY FOR SECURITY AUTO
      *   CS 120806 ADDED NEW DEFPOL-MAXIMUMS, "1","D","2". "1"-EXCEEDS 1ST
      *             XMONTHS, "D", MONTHS BETWEEN LAST DF AND CURRENT DF-D9,
      *             "2" MONTHS BETWEEN LAST D2 AND CURRENT DF TYPE POSTING
      *             REGACC PR#318
      *   CS 120807  ADDED CLEAR OF HOLD-PRIOR-DF-POSTDATE  PR#318 REGACC
      *  BAH 130107 ADDED COLAS2 FOR REGACC ONLY, PR# 330
      *  BAH 130111 ADDED LC-DISPLAY-ERN OPTION OF "I" FOR POFF-INTDUE
      *                                              AMERICAN ACC PR# 4190
      *  BAH 130226 PASSWORD FOR "OT" (OPT = 65) , SOAUTO PR# 4217
      *  BAH 130305 CHANGED MANDATORY LSX AND LSY FIELDS FOR POSTING "SX"
      *             IF GP-REPO-CODE = "A", REGACC PR# 333
      *  BAH 130315 CHANGED MANDATORY LSX AND LSY FIELDS FOR POSTING "SX"
      *             IF GP-REPO-CODE = "A", REGACC PR# 336
      *   CS 130502 ADDED TESTS FOR NUMBER OF DF'S ALLOWED PER TERM BREAK (AFTER
      *             PASSES DEFPOL CHECKS). ALLOW THE 'DF' BUT WRITE A MEMO
      *             THAT ACCOUNT IS IN TDR1 STATUS (STATUS UPDATE TO LR-PX10-
      *             TDR1/TDR1-DATE.
      *             ALSO ADD TESTS FOR NUMBER OF DF'S USING A REFCD "UNE?" THAT
      *             PUT ACCT IN TDR2 STATUS (UPDATED TO LR-PX10-TDR2/DATE
      *             WRITE A SPECIAL ERRLOG FOR TDR2 CHANGES  REGACC PR#338
      *             TDR1 (DF'S ALLOWED PER TERM BREAK) ARE USED IN
      *             COLAS2,
      *  CS 130506 IF SCREEN WASNT CLEARED AND YOU CONTINUED TO POST DF', YOU
      *            GOT MESSAGE WILL BE TDR1 STATUS.  REGACC PR#338
      * BAH 130521 ADDED CODE FOR GP-DUE-29-30-31, SOAUTO PR# 4239
      *  CS 130606 IN TERM-BREAK-DF-TDR1, IF LR-PX10-TDR1 WAS 'Y' AND POSTING
      *            ADDITIONAL 'DF' THE HOLD-TDR1 WAS BEING SET TO 'N' CAUSING
      *            UPDATE (LONPF2) TO MOVE 'N' TO LR-PX10-TDR1 REGACC PR#338
      *  CS 130711 WHEN POSTING A DF 'UNE' REFCD THAT WOULD PUT IN TDR2 STATUS
      *            THEN PRESSING F1 AT THE AMOUNT FIELD, AND POSTING A 'PY',
      *            HOLD-TRD FIELDS WERE NOT RESET SO THE LR TDR DF STATUS
      *            WERE UPDATED ON A PY POSTING REGACC PR#338
      *  CS 130719 IF POSTING A 'DF' MOVE LP-TRCD TO TRCD-WORKER, THE NUMBER
      *            OF 'DF' WAS GETTING LOST WHEN YOU WENT TO LONPFC & THEN
      *            F4 BACK TO REFCD  PR#815 REGACC
      * BAH 131017 CHANGED LIBLP/DEFPOL FOR SP-DEFPOLCD "C" HONOR PR#4382
      *  CS 131105 POSTING 'DF' DID NOT UPDATE TDR1 STATUS WHEN AT TERM BREAK,
      *            WHEN POSTING 'DF' NEEDED TO 'MOVE 1 TO TRCD-NODF'
      *                                                 REGACC PL826
      * MJD 140429 CHANGED 'OR"' TO 'OR "'
      * BLM 140718 ADD PA-NOT-DEBIT PASSWORD SEQ 66 FOR WORLD.  WILL ASK IF
      *            I-AM-WORLD, TRCD = PA & REFCD NOT = DEBIT.  WORLD PR# 1005
      * BAH 140814 ADDED TEST FOR LPSMNU IN HELP
      * BAH 140925 PASSWORD 'PB' PRIOR OR EQUAL TO 1STPYDATE, WORLD PR# 1020
      *  CS 151030 ADD "CNT" TO VALID-ESCROW-REFNO
      * BAH 151222 CUSTOM INTER BRANCH BRANCH CHECKS FOR CITIZENS, PR#4919
      * BAH 160108 PASSWORD 'SP' IF CURRENT POOL 20000-49999, REGMGM PR#4929
      * BAH 160118 SPLIT OUT LTFILE, PD0003
      * BAH 160209 SPLIT OUT LSFILE, PD0003
      *   CS 160222 REMOVE COPY LPWKLXE, ITS AN EARNINGS COPY MEMBER THAT IS
      *             PASSED IN LOAN PROCESSING VIA LP01WK USING WK-LX2-REC. 
      *             REPLACED WK-LX2-REC WITH WK-LXE-REC IN LP01WK 
      *             MOVED LPWKLXE TO LPWKLXE.NO
      *             SAVED VERSION LONPFL.160222
      *  CS 160302 INITIALIZE HOLD-ALT-PREPAY-FG(LPPFBUF) SET TO "Y" WHEN
      *            PAID-THRU-PAYS > SP-ALT-PREPAY-MONTHS   WORLD PR#1140
      * KEC 2016.0311 CHANGED CD-PX???? TO CD-PX-????
      * KEC 2016.0325 CHANGED CDSCAN-WINDOW-BUF TO HAVE MATCHING CD1-KEY
      *               LAYOUTS (FOR EACH CODE TYPE; CD-TYPE).
      *               CDSCAN-CD1-KEY IS THE NEW (PRIMARY) WITH REDEFINES OF
      *               CDSCAN-??-KEY (NEW).
      * KEC 2016.0329 CHANGED TC2SCN WORKERS TO MATCH CD1-KEY FOR TC LAYOUT.
      *  CS  160330 ADD CHECK ON OT/O2 POSTING IF SCRA ACTIVE AND THE
      *            LOAN REDUCTION RATE = 6%  SOUTHERN AUTO PR#5025
      *                                 LP/LONPF1 SEQ 68
      * BAH 160404 ALLOW BANKRUPT CHAPTER 28 (WI 128 PERSONAL
      *            RECEIVERSHIP), WORLD PR# 1139
      * KEC 2016.0509 CHANGED LN-APPNO TO USE LN-APP-NUMBER FOR MA1-KEY.
      *  CS  160512 ADD PASSWORD FOR POSTING ANY TRANSACTION WHERE LP-PAYDATE
      *             IS MORE THAN 3 DAYS PRIOR TO SYS-DATE  WORLD PR#1158
      *             LP/LONPF1 SEQ 69 MOVE BACKDATE-MORE-THAN-3DAY-SEQ 
      *  CS 160705  ADD PASSWORD ON 'OP' SEQ 70
      *             SEQ 71 POST 'OP' INTERBRANCH AM THRIFT PR#5128
      * KEC 2016.1116 ADDED RVLINE-SEQNO WHICH IS FOR LTR-SEQNO.
      * BAH 161128 VERIFY-DEFERMENT-APPROVAL AND VALIDATE-DEL-POLICY WERE
      *            TESTING WRONG LETTER FOR "DF" TO FORCE 1 TO NUMBER OF
      *            DEFERMENTS TO APPROVE. PL# 955
      *  CS 170123 ADD "RC","RA" TO CDV-INTERBRANCH, ADDED SEQ 72 FOR POSTING
      *            ALL INSURANCE REBATES INTERBRANCH
      *            INS-REB-SEQ-INTERBR      VALUE 72.  REGENCY PR#5248
      * BAH 170123 ADD PASSWORD ON 'JD' SEQ 73, NSA PR#5236 
      * 170313 BAH ACTIVATE 8 DIGIT DATES, PD0006
      *  CS 170530 ALLOW POSTING OF O2 WITH A REFNO THE SAME AS A BATCH REFCD
      *                ( NOT (LP-TRCD = "PA" OR "PO" OR "Z2" OR "PY" OR "PE"
      *                                OR "DF" OR "D2" OR "D3" OR "D4"
      *                                OR "D5" OR "D6" OR "D7" OR "D8"
      *                                OR "D9" OR "SS" OR "IN"
      *                                OR "OT" OR "O2"<-NEW SOAUTO PR#5299 
      * BAH 170615 ACTIVATE 8 DIGIT DATES, PD0006
      * BAH 171129 FIXED WK-LXE-REC
      *  CS 171218 ALLOW 'PA' WITH BATCH REF PHDBT/PHACH  PR#1290
      *            WITHOUT PASSWORD PROMPT  
      * KEC 2018-0824 LOAN APP MODULE REMOVAL FROM A30
      *               LEAVING LN-APP-NUMBER & EXT-WI-CL-APP-NUMBER
      *               HERE IN CASE NEEDED IN THE FUTURE.
      * BAH 181227 GLOBAL LPFILE
      * BAH 190116 REMOVED LPWKLXE, NOW THE LXE RECORD IS IN ITS OWN FILE AND
      *            I ADDED IT TO THE LP01WK ALSO. NOTHING WILL WIPE IT OUT
      * BAH 190116 GLOBAL LXFILE
      * BAH 190131 REMOVED COLAS2, REGACC
      * KEC 190219 A32 REMOVED REDEFINE FOR LN-LC-CODEX; UNUSED
      * BAH 20190308 MOVED LP-REFNO REDEFINITION TO LPWSLP COPY MEMBER
      *              LP-POOLID, LP-TODD, LP-FROMDD, LP-ADDON
      *  CS 190607 WHEN CLEARING LXE TRAILER, CLEAR THE FUTURE FIELDS
      *  CS 190610 CLEAR LXG-FUTURE-GLNO,GLAMT
      *  BAH 20190625 REMOVED LC-REVOLVING, PT#0153
      *  BAH 20190627 REMOVED "AV" AND "PU" FROM THE CDV-TAB
      *  BAH 20190701 REMOVED U-INSOURS FROM LPPFBUF
      *  BAH 20190709 REMOVED LRFILE PT0151
      *   CS 20190726 REMOVED TESTS ON GP-NF-UPD-REFNO SAVED LONPF1.190726
      * BAH 2020.0401 TEST CD-BR-MULTIPLE-REFCDS AND DONT ALLOW MANUAL ENTRY
      *               OF A REFCD THAT HAS THIS "Y". IT PRODUCES GL ENTRIES
      *               TO 0000000 SINCE YOU CAN'T ENTER A GL ACCOUNT WHEN
      *               THAT FIELD IS Y. ONLY CHANGED IN A32, NOT A15. (KM)
      * BAH 2020.0720 ADD PASSWORD ON 'OP' IF ACCOUNT P&L, #1453
      * BAH 2021.0202 DO NOT ALLOW CD-BR-FILE-TYPE "C", DEBIT CARD UMC PR#1490
      * BAH 2022.0103 DO NOT ALLOW POSTING OF REBATE WITH "CHECK" REFCD ON
      *               ZERO BALANCE ACCOUNT, DO NOT ALLOW "CHECK" REFCD 
      *               INTERBRANCH, #1531
      * BAH 2022.0314 REMOVED EXT-SPANISH-FORMS AND ALL MX FORMS
      * BAH 2022.0802 HARD CODED STARTS OF LP
      * JKC 2022.0930 CHANGED TO USE START-LP1-FILE-SCAN INSTEAD OF
      *          START-LP1-FILE; NEED TO USE START-LP1-FILE-SCAN WHEN
      *          START-LP1-FILE-NOT-GREATER IS USED FIRST; NEEDED FOR
      *          FOR DISPLAYING MULTIPLE PAGES IN AN UP & DOWN FUNCTION;
      *          NEED TO ADD ONE TO LP-SEQNO (IN WBEG) IN ORDER TO GET 
      *          THE DISPLAY TO WORK LIKE WITH VISION FILES.
      * JKC 2023.0131 PR#1588 PREVENTED ENTRY OF REFNO WITH A BACK (\)
      *          AND FORWARD (/) SLASH.
      * BAH 2023.0511 REMOVED LONPP0 PRINT
      * BAH 2024.0311 REMOVED EXT-WI-CL-APP-NUMBER
      * BAH 2024.0410 REMOVED HOLD-TDR1 HOLD-TDR2 HOLD-TDR2-ERR FROM UPDATE-BUF
      * BAH 2024.0419 WI/REINST HAD BEEN QA'D, SO I QA'D LIBWI/REINSTW
      ****************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. 3B.
       OBJECT-COMPUTER. 3B.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
       COPY "LIBLP/LPFSWK.CPY".

       DATA DIVISION.
       FILE SECTION.
       COPY "LIBLP/LPFDWK.CPY".

       WORKING-STORAGE SECTION.
       77  SCCS-IDENTIFIER PIC X(41) VALUE
           "@(#)LP/LONPF1.CBL S35 04/23/24-14:46:28 >".
      **************************************************
      *     P R O G R A M   W O R K E R S              *
      **************************************************
       COPY "LIBLP/LP01LN.CPY".
       COPY "LIBLP/LP01LN_SQL.CPY".
       COPY "LIBLP/LPWSLN.CPY".
       COPY "LIBLP/LP01LC.CPY".
       COPY "LIBLP/LP01LC_SQL.CPY".
       COPY "LIBLP/LPWSLC.CPY".
       COPY "LIBLP/LP01BW.CPY".
       COPY "LIBLP/LP01BW_SQL.CPY".
       COPY "LIBLP/LPWSBW.CPY".
       COPY "LIBLP/LP01DL.CPY".
       COPY "LIBLP/LP01DL_SQL.CPY".
       COPY "LIBLP/LPWSDL.CPY".
       COPY "LIBLP/LP01LP.CPY".
       COPY "LIBLP/LP01LP_SQL.CPY".
       COPY "LIBLP/LPWSLP.CPY".
       COPY "LIBLP/LP01LSP.CPY".
       COPY "LIBLP/LP01LSP_SQL.CPY".
       COPY "LIBLP/LPWSLSP.CPY".
       COPY "LIBLP/LP01LSR.CPY".
       COPY "LIBLP/LP01LSR_SQL.CPY".
       COPY "LIBLP/LPWSLSR.CPY".
       COPY "LIBLP/LP01LSX.CPY".
       COPY "LIBLP/LP01LSX_SQL.CPY".
       COPY "LIBLP/LPWSLSX.CPY".
       COPY "LIBLP/LP01LTP.CPY".
       COPY "LIBLP/LP01LTP_SQL.CPY".
       COPY "LIBLP/LPWSLTP.CPY".
       COPY "LIBLP/LP01LX.CPY".
       COPY "LIBLP/LP01LX_SQL.CPY".
       COPY "LIBLP/LPWSLX.CPY".
       COPY "LIBLP/LP01LXG.CPY".
       COPY "LIBLP/LP01LXG_SQL.CPY".
       COPY "LIBLP/LPWSLXG.CPY".
       COPY "LIBLP/LP01LXE.CPY".
       COPY "LIBLP/LP01LXE_SQL.CPY".
       COPY "LIBLP/LPWSLXE.CPY".
       COPY "LIBLP/LP01SP.CPY".
       COPY "LIBLP/LP01SPA.CPY".
       COPY "LIBLP/LP01SPB.CPY".
       COPY "LIBLP/LP01SPC.CPY".
       COPY "LIBLP/LP01SP_SQL.CPY".
       COPY "LIBLP/LPWSSP.CPY".
       COPY "LIBLP/LP01CD.CPY".
       COPY "LIBLP/LP01CD_SQL.CPY".
       COPY "LIBLP/LPWSCD.CPY".
       COPY "LIBLP/LP01ST.CPY".
       COPY "LIBLP/LP01ST_SQL.CPY".
       COPY "LIBLP/LPWSST.CPY".
       COPY "LIBGL/GL01GI.CPY".
       COPY "LIBGL/GL01GI_SQL.CPY".
       COPY "LIBGL/GLWSGI.CPY".
       COPY "LIBGB/GB01BR.CPY".
       COPY "LIBGB/GB01BR_SQL.CPY".
       COPY "LIBGB/GBWSBR.CPY".
       COPY "LIBGB/GB01GB.CPY".
       COPY "LIBGB/GB01GB_SQL.CPY".
       COPY "LIBGB/GBWSGB.CPY".
       COPY "LIBLP/LP01ES.CPY".
       COPY "LIBLP/LP01ES_SQL.CPY".
       COPY "LIBLP/LPWSES.CPY".
       01  WK-IFN              PIC X(2)     VALUE "WK".
       01  WK-KEY              PIC 9(2)     VALUE 0.

       01  ELE                 PIC 99       VALUE 0.

       01  TEST-BS-REFNO.
           03  TEST-BS-REFNOX   OCCURS 5  PIC X(01).
       01  WS-REFNOX.
           03  WS-REFNO         OCCURS 5 PIC X.

      *-----------------------------------------------------------------
      * MISC WORKERS FOR LAST/TODAY/NEXT DUE
      *-----------------------------------------------------------------
       01  DUE-LINE            VALUE " ".
           03  FILLER          PIC X.
           03  DUE-PROMPT      PIC X(11).
           03  DUE-DATE-DUE    PIC 99/99/99  BLANK ZERO.
           03  DUE-LCAMT       PIC Z(6).ZZ.
           03  FILLER          PIC X.
           03  DUE-AMOUNT      PIC Z(6).ZZ.
           03  FILLER          PIC XX.
       01  DEF-LINE REDEFINES DUE-LINE.
           03  FILLER          PIC X.
           03  DEF-PROMPT      PIC X(24).
           03  DEF-DATE        PIC 9(4).

       01  BACKDATE-FG          PIC X VALUE " ".
       01  WS-INTPDTH           PIC 99/99/99.

      *-----------------------------------------------------------------
      *WORKERS FOR REFNO VERIFY ROUTINE
      *-----------------------------------------------------------------
       01  WS-SUB              PIC 99.
       01  WS-MATCH            PIC X.
           88  WS-MATCH-FOUND         VALUE "Y".
       01  REFNO-OKAY          PIC X.
       01  TEST-ESCROW-DISB-REFNO  PIC X(3).
           88  VALID-ESCROW-REFNO 
              VALUE "TAX" "INS" "PMI" "OTH" "REF" "CNT".
      *-----------------------------------------------------------------
       01  TC-SUB              PIC 99.

       01  WSEL-LIST           PIC X(5)     VALUE "WSEL.".
       01  MSEL-LIST           PIC X(5)     VALUE "MSEL.".
       01  LN-WK               PIC 9(6)     COMP VALUE 0.
       01  TOTEARN             PIC S9(6)V99 COMP.
       01  SUB                 PIC 9(6)     COMP VALUE 0.
       01  DISP-REV-BAL        PIC X        VALUE "Y".
       01  OPT-SUB             PIC 9(6)     COMP VALUE 0.
       01  WK-LAWCODE          PIC 99.
       01  FIRST-TIME          PIC 9        VALUE 0.
       01  JDRATE-EDIT         PIC ZZ.ZZ    VALUE " ".
       01  DEFERMENT-APPROVED  PIC X        VALUE SPACES.
       01  TRCD-WORKER         VALUE " ".
           03  FILLER          PIC X.
           03  TRCD-FTST       PIC X.
           03  TRCD-NODF       REDEFINES TRCD-FTST
                               PIC 9.
           03  TRCD-NODEL      REDEFINES TRCD-FTST
                               PIC 9.
           03  TRCD-PLTYPE     REDEFINES TRCD-FTST
                               PIC 9.

       01  WORKER-PI                PIC S9(7)V99.
       01  EXPIRATION-INFORMED-FG   PIC X.

      * PAYMENTS OUT OF RESERVE WORKERS:
       01  DLRVNO-RSV-NO       PIC 9.
       01  DLRVNO-DEALER-NO    PIC 9(4)V99.

       01  DLRVNO-RTN          PIC X.
       01  REFNO-WORKER.
           03  REFNO-DLRVNO    PIC X.
           03  REFNO-DLRVNO-N REDEFINES REFNO-DLRVNO
                               PIC Z.
           03  REFNO-DLNO      PIC X(4).
           03  REFNO-DLNO-N   REDEFINES REFNO-DLNO
                               PIC 9999.


      * P4-P5 RESERVE WORKERS:
       01  P4P5-TRANS-CODE                 PIC XX.
       01  P4P5-RSV-NO                 PIC 9.
       01  P4P5-DEALER-NO            PIC 9(4)V99.
       01  P4P5-RTN                  PIC X.
       01  REFNO-P4P5-WORKER.
           03  REFNO-P4P5-TRANS-CODE       PIC XX.
           03  REFNO-P4P5-DLRVNO     PIC X.
           03  REFNO-P4P5-DLRVNO-N  REDEFINES REFNO-P4P5-DLRVNO
                                     PIC 9.
           03  REFNO-P4P5-FILLER     PIC X(3).

       01  DF-BUF.
           03  FILLER          PIC X(5).
           03  DF-ANSWER       PIC X.

       01  DEL-MAXIMUM         PIC X.
       01  DEL-TRAMT           PIC S9(7)V99 COMP-3 VALUE 0.

       01  CASH-MESS.
           03  FILLER          PIC X(31)    VALUE
           "** SAME AS CASH AVAILABLE THRU".
           03  CASH-MESS-DT    PIC 99/99/99.
           03  FILLER          PIC X(3)     VALUE
           " **".

       01  PL-NEWAR-MESS.
           03  FILLER                  PIC X(16) VALUE
           "** ACCOUNT HAS (".
           03  PL-NEWAR-MESS-AMT       PIC $ZZZ,ZZ9.99.
           03  FILLER                  PIC X(25) VALUE
           ") REMAINING IN NEW AR! **".

       01  DIS-BRANCH.
           03  FILLER          PIC X(21)    VALUE
           "A/C OWNED BY BRANCH# ".
           03  DIS-BR          PIC ZZZ9.

       01  EXPIRED-MESSAGE.
           03  FILLER          PIC X(18)    VALUE
           "PAST EXP. DATE OF ".
           03  DIS-DATE        PIC ZZ/ZZ/ZZ.
           03  FILLER          PIC X(33)    VALUE
           ". NEXT PAYMENT CAUSES EXPIRATION".

       01  POSTING-TYPE                       PIC X(1)     VALUE "S".
           88  POSTING-INTERBRANCH                         VALUE "I".
           88  POSTING-STANDARD                            VALUE "S".

      *=================================================================
      *
      *    LINE BUFFER  - LOTS OF REDEINFES! AT THE 01 LEVEL
      *
      *=================================================================
       01  LN-BUF                                          VALUE SPACES.
           03  L-010                        PIC 9(6).
           03  L-DATE-SIGNAL                PIC X.
           03  L-020                        PIC XX.
           03  FILLER                       PIC X.
           03  L-030                        PIC X(5).
           03  L-040                        PIC Z(5).99-   BLANK ZEROES.
           03  L-040RATE          REDEFINES L-040
                                            PIC ZZZZ.999-.
           03  FILLER             REDEFINES L-040.
               05  L-040D                   PIC X.
               05  L-040DLNO                PIC 9999.99-.
           03  L-050                        PIC Z(4).99-   BLANK ZEROES.
           03  L-060                        PIC Z(4).99-   BLANK ZEROES.
           03  L-070                        PIC Z(5).99-   BLANK ZEROES.
           03  L-080-MO                     PIC 99.
           03  L-080-DAYR                   PIC 99.
           03  L-BAL.
               05  L-090                    PIC Z(5).99-   BLANK ZEROES.
               05  L-100                    PIC Z(4).99-   BLANK ZEROES.
           03  FILLER             REDEFINES L-BAL.
               05  FILLER                   PIC X(4).
               05  L-NEWPMT                 PIC ZZZZZ9.99.
               05  FILLER                   PIC X(4).
           03  L-110                        PIC Z(5)9.99-.
           03  FILLER                      REDEFINES L-110.
               05  FILLER                   PIC X(9).
               05  L-120                    PIC X.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * DISPLAY BUFFER USED IS PRINCIPAL IS OVER 99,999.99
      * LEFT OUT PAID THRU, DOESNT MATTER ON A PAYOFF
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
       01  LN2-BUF                         REDEFINES LN-BUF.
           03  L2-010                       PIC 9(6).
           03  L2-DATE-SIGNAL               PIC X.
           03  L2-020                       PIC XX.
           03  FILLER                       PIC X.
           03  L2-030                       PIC X(5).
           03  L2-040                       PIC Z(7).99- BLANK ZEROES.
           03  L2-040RATE                  REDEFINES L2-040
                                            PIC ZZZZZZ.999-.
           03  FILLER                      REDEFINES L2-040.
               05  FILLER                   PIC X.
               05  L2-040D                  PIC X.
               05  FILLER                   PIC X.
               05  L2-040DLNO               PIC 9999.99-.
           03  L2-050                       PIC Z(4).99- BLANK ZEROES.
           03  L2-060                       PIC Z(5).99- BLANK ZEROES.
           03  L2-070                       PIC Z(6).99- BLANK ZEROES.
           03  FILLER                       PIC X.
           03  L2-090                       PIC Z(5).99- BLANK ZEROES.
           03  L2-100                       PIC Z(4).99- BLANK ZEROES.
           03  L2-110                       PIC Z(5)9.99-.
           03  FILLER                      REDEFINES L2-110.
               05  FILLER                   PIC X(9).
               05  L2-120                   PIC X.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
       01  EARN-BUF               REDEFINES LN-BUF.
           03  D-INTYTD                     PIC ZZZZ9.99-.
           03  D-TOTEARN                    PIC ZZZZ9.99-.
           03  D-LCPDTH.
               05 D-LCPDTH-MO               PIC 99.
               05 D-LCPDTH-DAYR             PIC 99.
           03  D-DEFMNTS                    PIC 99.
           03  D-ALDEL                      PIC 99       BLANK ZEROES.
           03  D-EARNED                     PIC ZZZZ9.99-.
           03  D-DLPROC                     PIC ZZZZ9.99-.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

       01  LINE-BUF                      VALUE SPACES.
           03  D-LINE                    OCCURS 8 TIMES
                                         PIC X(80).

       01  LINE-BUFX                REDEFINES LINE-BUF.
           03  FILLER                    OCCURS 8.
               05  FILLER                PIC X(40).
               05  D-OPT-LINE            PIC X(40).

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

       01  TOGGLE-BUFFER                             VALUE SPACES.
           03  T-LINE                                OCCURS 8.
               05  T-DATE                     PIC 9(06).
               05  T-DATE-SIGNAL              PIC X(01).
               05  FILLER                     PIC X(73).

       01  TOGGLE-DATES-BUFFER                             VALUE ZEROES.
           03  TOGGLE-DATES-TABLE                          OCCURS 8.
               05  TOGGLE-PAYDATE             PIC 9(08).
               05  TOGGLE-TRANS-DATE          PIC 9(08).

       01  TOGGLE-DATE                        PIC X(01)    VALUE "P".
           88  TOGGLE-DATE-PAYDATE                         VALUE "P".
           88  TOGGLE-DATE-TRANS-DATE                      VALUE "T".

       01  TOGGLE-FIRST-TIME                  PIC X(01)    VALUE "Y".
           88  TOGGLE-FIRST-TIME-NO                        VALUE "N".
           88  TOGGLE-FIRST-TIME-YES                       VALUE "Y".

      *-----------------------------------------------------------------
       01  LINE-LIST.
            03  FILLER                       PIC X(4) VALUE
               "LN1 ".
           03  FILLER                       PIC X(24) VALUE
               "GL8 F21 GD8 F22 GA8 F23 ".
           03  FILLER                       PIC X(24) VALUE
               "GL9 F31 GD9 F32 GA9 F33 ".
           03  FILLER                       PIC X(24) VALUE
               "GL0 F41 GD0 F42 GA0 F43 ".
           03  FILLER                       PIC X(32) VALUE
               "GL1 F51 GD1 F52 GA1 F53 GL2 F61 ".
           03  FILLER                       PIC X(40) VALUE
               "GD2 F62 GA2 F63 GL3 F71 GD3 F72 GA3 F73 ".
           03  FILLER                       PIC X(24) VALUE
               "GL4 F81 GD4 F82 GA4 F83.".

       01  EARN-LIST.
           03  FILLER                       PIC X(34) VALUE
               "H09 H10 H17 H18 H181 H21 PROCEEDS.".

       01  ENTRY-LINE                       PIC X(48) VALUE
           "010 020 030 040 050 060 070 080 090 100 110 120.".


       01  CODE-LIST                        PIC X(30) VALUE
           "PMPT1 PMPT2 PMPT3 PMPT4 PMPT5.".

       01  PROMPT-INITIAL-VALUES.
           03  FILLER          PIC X(33) VALUE
               " DATE  CD REF    AMOUNT   OTHER".
           03  FILLER          PIC X(6) VALUE
               "INT/LC".
           03  FILLER          PIC X(24) VALUE
               "     PRIN PDTH   OTHER".
           03  FILLER          PIC X(6) VALUE
               "INT/LC".
           03  FILLER          PIC X(11) VALUE
               "      PRIN".

       01  LONPF1-SEL.
           03  FILLER                PIC X(10) VALUE
           "F1-LNNO ^/".
           03  FILLER                PIC X     VALUE X'76'.
           03  FILLER                PIC X(42) VALUE
           " F4 F5-PAYOFF F6-POST F7-EXIT P-PRINT    :".
       01  LONPF1-SEL2.
           03  FILLER                PIC X(10) VALUE
           "F1-LNNO ^/".
           03  FILLER                PIC X     VALUE X'76'.
           03  FILLER                PIC X(42) VALUE
           " F4 F5-PAY F6-POST F7-EXIT L/M-LGR P-PRNT:".

       01  LONPF1-010.
           03  FILLER                PIC X(10) VALUE
           "F1-EXIT ^/".
           03  FILLER                PIC X     VALUE X'76'.
           03  FILLER                PIC X(42) VALUE
           " F2-MEMO F3-CHG F4 F5-PAYOFF F6-REV F7-LN#".

       COPY "LIBLP/LPIPBUF.CPY".
       COPY "LIBLP/LP01NO.CPY".

      ******************************************************************
       COPY "LIBCL/CLMENUW_EXT.CPY".

       COPY "LIBGB/GETENVW.CPY".
       COPY "LIBGB/SYSTEMW.CPY".

       COPY "LIBLP/LPPOFFW.CPY".
       COPY "LIBLP/LPIBPCW.CPY".
       COPY "LIBLP/LPEARNW.CPY".
       COPY "LIBGB/DATERW.CPY".
       COPY "LIBGB/SPPDTHW.CPY".
       COPY "LIBLP/LPPDUEW.CPY".
       COPY "LIBLP/LPDUEDAW.CPY".
       COPY "LIBLP/DEFPOLW.CPY".
       COPY "LIBGB/AGEINGW.CPY".
       COPY "LIBLP/LPCEPPW.CPY".
       COPY "LIBLP/LPUPWKW.CPY".
       COPY "LIBLP/LPMENUW.CPY".
       COPY "LIBLP/LPXDTEW.CPY".
       COPY "LIBLP/LPMDTEW.CPY".
       COPY "LIBLP/PAYOFXW.CPY".
       COPY "LIBLP/LPCDELW.CPY".
       COPY "LIBLP/LPWKPATH.CPY".
       COPY "LIBGB/CONNECTW_SQL.CPY".
       COPY "LIBGB/FILEWK.CPY".
       COPY "LIBGB/MESSWK.CPY".
       COPY "LIBGB/GPENVW.CPY".
       COPY "LIBCL/CRNOR2W.CPY".

       COPY "LIBGB/PASSWDW.CPY".
       78  DF-SEQ                   VALUE 0.
       78  DF1-SEQ                  VALUE 1.
       78  DC-SEQ                   VALUE 2.
       78  PL-SEQ                   VALUE 3.
       78  P2-SEQ                   VALUE 4.
       78  PA-SEQ                   VALUE 5.
       78  P3-SEQ                   VALUE 6.
       78  SX-SEQ                   VALUE 7.
       78  SV-SEQ                   VALUE 8.
       78  AD-SEQ                   VALUE 9.
       78  P4-SEQ                   VALUE 10.
       78  CA-SEQ                   VALUE 11.
       78  TS-SEQ                   VALUE 12.
       78  DLRVNO3-SEQ              VALUE 13.
       78  IR-SEQ                   VALUE 14.
       78  SE-SEQ                   VALUE 15.
       78  RV-SEQ                   VALUE 16.
       78  SS-SEQ-STANDARD          VALUE 17.
       78  PR-SEQ                   VALUE 18.
       78  BK-SEQ                   VALUE 19.
       78  SS-SEQ-INTERBRANCH       VALUE 20.
       78  LN-RB-RO-SEQ             VALUE 21.
       78  SF-RB-RO-SEQ             VALUE 22.
       78  SF-PB-RN-SEQ             VALUE 23.
       78  PX-SEQ                   VALUE 24.
       78  LOCK-SEQ                 VALUE 25.
       78  RENEWAL-EFFDTE-SEQ       VALUE 26.
       78  PN-PZ-SEQ                VALUE 27.
       78  LBOX-SEQ                 VALUE 28.
       78  PE-SEQ                   VALUE 29.
       78  RN-SEQ                   VALUE 30.
       78  PB-91-SEQ                VALUE 31.
       78  SP-SEQ                   VALUE 32.
       78  PO-SEQ-INTERBRANCH       VALUE 33.
       78  SX-BACKDATE-SEQ          VALUE 34.
       78  REPO-EFF-SEQ             VALUE 35.
       78  REPO-POSTING-ALLOWED-SEQ VALUE 36.
       78  CHECK-SEQ                VALUE 37.
       78  PL-BACKDATE-SEQ          VALUE 38.
       78  AP-PL-SEQ                VALUE 39.
       78  O2-SEQ                   VALUE 40.
       78  SP-SEQ-INTERBRANCH       VALUE 41.
       78  PI-SEQ                   VALUE 42.
       78  AD-REAL-ESTATE-SEQ       VALUE 43.
       78  RI-SEQ-INTERBRANCH       VALUE 44.
       78  RS-SEQ-INTERBRANCH       VALUE 45.
       78  RM-SEQ-INTERBRANCH       VALUE 46.
       78  AC-SEQ-INTERBRANCH       VALUE 47.
       78  POST-3-MONTHS            VALUE 48.
       78  PE-SEQ-INTERBRANCH       VALUE 49.
       78  IN-SEQ-INTERBRANCH       VALUE 50.
       78  POST-TO-SERVICE-SEQ      VALUE 51.
       78  DF-REG-SEQ               VALUE 52.
       78  BD-SEQ                   VALUE 53.
       78  RN-PB-91-SEQ             VALUE 54.
       78  PLP2-SEQ-INTERBRANCH     VALUE 55.
       78  SX-SEQ-INTERBRANCH       VALUE 56.
       78  SV-SEQ-INTERBRANCH       VALUE 57.
       78  IR-SEQ-INTERBRANCH       VALUE 58.
       78  RE-SEQ-INTERBRANCH       VALUE 59.
       78  PI-SEQ-INTERBRANCH       VALUE 60.
       78  PX-SEQ-INTERBRANCH       VALUE 61.
       78  PW-SEQ-INTERBRANCH       VALUE 62.
       78  PR238-SEQ-INTERBR        VALUE 63.
      *PA,WL,WI,WO,DC,OP,RP,R1,R2,R3 INTERBRANCH
       78  OT-SCRA-SEQ              VALUE 64.
       78  OT-SEQ                   VALUE 65.
       78  PA-NOT-DEBIT-SEQ         VALUE 66.
       78  PB-PRIOR-1STPAY-SEQ      VALUE 67.
       78  OT-O2-SCRA-SEQ           VALUE 68.
       78  BACKDATE-MORE-THAN-3DAY-SEQ VALUE 69.
       78  OP-SEQ                   VALUE 70.    
       78  OP-SEQ-INTERBRANCH       VALUE 71.       
       78  INS-REBATE-SEQ-INTERBR   VALUE 72.
       78  JD-SEQ                   VALUE 73.    
       78  OP-PL-SEQ                VALUE 74.    

       01  CDV-SUB               PIC 9(6) COMP.
           88 CDV-NO-MATCH       VALUE 0.
           88 CDV-MATCH          VALUE 1 THRU 100.

      * WHEN CHANGING CDV CODES YOU MUST
      *      MODIFY CORRESPONDING NEW-PROG SELECTION
      *      A N D  KEEP A SPACE IN LAST CDV-00 TABLE
      *
      *      N O T E:
      *                TRCD'S '9A', '9X', '95', '96' AND '97'
      *                ARE USED IN LONPW5.C AND LONPW6.C AND LONPW7.C
      *                                     AND LONPFA.C AND LONPF2.C
      *                TO INDICATE AUTO ALLOTMENT, AUTO LOCK BOX,
      *                            TRUE PAY, TRUE COLL AND MAIL GRAM PAYOFFS

       01  CDV-BUF               VALUE " ".
           03  CDV-CD            OCCURS 87
                                 PIC X(2).
       01  CDV-00.
           03  FILLER            PIC X(58) VALUE
           "PYPAPRPCRNSCPBPOJDRCRARPR1R2R3RIRMRDRSCCCACPC1C2ALAIOTWLWI".
           03  FILLER            PIC X(58) VALUE
           "WODFD2D3D4D5D6D7D8D9APPLPIPWACIRTSTPSPDCADA2A3A4A5A6A7A8A9".
           03  FILLER            PIC X(54) VALUE
           "PEPPP2P3P4P5SESXSVSSO2W2Z2LRAHRBROPXBKBDPNPZOPREINZXED".
      *    "C C 9 9 9 9 E E E C 7 7 C G C A A C 9 9 C C 7 7 C E E".
           03  FILLER            PIC X(4) VALUE
           "EP  ".

      * THESE ARE THE PROGRAMS THAT THE ABOVE TRANSACTION WILL CALL
      * "C" WOULD MEAN LONPFC, "B" LONPFB, "9", LONPF9, ETC.
       01  CDV-PROG-TAB.
           03  FILLER            PIC X(29) VALUE
           "CCCCAAAA9BBBBBBBBBBBBBBB77777".
           03  FILLER            PIC X(29) VALUE
           "7CCCCCCCCC799999DDEEEEEEEEEEE".
           03  FILLER            PIC X(27)  VALUE
           "CC9999EEEC77CGCAAC99CC77CEE".
           03  FILLER            PIC X(2)   VALUE
           "E ".

       01  CDV-PROG-TABX        REDEFINES CDV-PROG-TAB.
           03  CDV-NEW-PROG      OCCURS 87
                                 PIC X.

      *    INITIALIZED FOR NON-MANUALLY ENTERED TRCD'S
       01  CDV-IX                PIC 9(2) COMP VALUE 1.

       01  CDV-CHECK             PIC X(32) VALUE
           "RCRARPR1R2R3RIRSRMRDCCCACPC1C2RV".

       01  CDV-MORTGAGE-INT-Z     PIC X(30) VALUE
           "PYOTRVPAPORCRARPR1R2R3".

       01  CDV-INTERBRANCH.
           03  FILLER   PIC X(46) VALUE
           "PYSSDFD2D3D4D5D6D7D8D9RVO2Z2PAPOSPOTAPRIRSRMAC".
           03  FILLER   PIC X(46) VALUE
           "AIALWIWLWODCOPPEINBKBDINPLP2SXRESVIRPXPWW2PIRP".
           03  FILLER   PIC X(12) VALUE
           "R1R2R3OPRCRA".

       COPY "LIBWI/RVLINEW.CPY".
       COPY "LIBWI/COLASTW.CPY".
       COPY "LIBWI/TC2SCNW.CPY".
       COPY "LIBWI/DLSCANW.CPY".
       COPY "LIBWI/MEMOSCW.CPY".
       COPY "LIBWI/CDSCANW.CPY".

       COPY "LIBWI/PFSWINDOWSW.CPY".

       COPY "LIBGB/CONAME_EXT.CPY".
       COPY "LIBGB/SCREENW.CPY".
       COPY "LIBLP/LONPF_DEF.CPY".
       COPY "LIBLP/LPSMNU_DEF.CPY".
       COPY "LIBLP/LPLNMU_DEF.CPY".
       COPY "LIBLP/LPCAMU_DEF.CPY".
       COPY "LIBLP/LPVDMU_DEF.CPY".
       COPY "LIBWI/DLRVNO_DEF.CPY".
       COPY "LIBWI/CONTYN_DEF.CPY".
       COPY "LIBWI/P4P5_DEF.CPY".
       COPY "LIBLP/LONPF_WKS.CPY".
       COPY "LIBLP/LPSMNU_WKS.CPY".
       COPY "LIBLP/LPLNMU_WKS.CPY".
       COPY "LIBLP/LPCAMU_WKS.CPY".
       COPY "LIBLP/LPVDMU_WKS.CPY".
       COPY "LIBWI/DLRVNO_WKS.CPY".
       COPY "LIBWI/CONTYN_WKS.CPY".
       COPY "LIBWI/P4P5_WKS.CPY".
       COPY "LIBGB/HELPLINK.CPY".

       COPY "LIBGB/GETFMW.CPY".
       COPY "LIBLP/LPLOANW.CPY".
       COPY "LIBLP/LPPFBUF.CPY".

       SCREEN SECTION.
       COPY "LIBLP/LONPF_SCN.CPY".
       COPY "LIBLP/LPSMNU_SCN.CPY".
       COPY "LIBLP/LPLNMU_SCN.CPY".
       COPY "LIBLP/LPCAMU_SCN.CPY".
       COPY "LIBLP/LPVDMU_SCN.CPY".
       COPY "LIBWI/DLRVNO_SCN.CPY".
       COPY "LIBWI/CONTYN_SCN.CPY".
       COPY "LIBWI/P4P5_SCN.CPY".
       01  BLANK-SCREEN.
           03  BLANK SCREEN.

      /*************************************************
      *   C O N T R O L   M O D U L E                  *
      **************************************************
       PROCEDURE DIVISION
             USING FORM-PATHNAME EXIT-PATHNAME PROG-BUF UPDATE-BUF.
       DECLARATIVES.
       DECLARE-ERROR SECTION.
           USE AFTER ERROR PROCEDURE ON
              WK-FILE.
       COPY "LIBGB/DECLARE.CPY".
           PERFORM CLOSE-ST1-FILE.
           PERFORM CLOSE-SP1-FILE.
           PERFORM CLOSE-LTP1-FILE.
           PERFORM CLOSE-LSX1-FILE.
           PERFORM CLOSE-LSR1-FILE.
           PERFORM CLOSE-LSP1-FILE.
           PERFORM CLOSE-LP1-FILE.
           PERFORM CLOSE-LC1-FILE.
           PERFORM CLOSE-ES1-FILE.
           PERFORM CLOSE-DL1-FILE.
           PERFORM CLOSE-CD1-FILE.
           PERFORM CLOSE-BW1-FILE.
           PERFORM CLOSE-GI1-FILE.
           PERFORM CLOSE-GB-FILE.
           PERFORM CLOSE-BR-FILE.
           CLOSE WK-FILE.
       COPY "LIBGB/DECLAR2.CPY".

      **************************************************
      *      P R O G R A M   C O N T R O L
      *
      *    ROUTE/CD = 2   BACK FROM/TO LONPF0
      *       "     = 3   BACK FROM/TO LONPF2 (UPDATE)
      *                                LONPF5 (TS-UPDATE)
      *                                LONPFZ (TP-UPDATE)
      *       "     = 4   BACK FROM/TO LONPF3 (TRCD'S)
      *       "     = 5   BACK FROM/TO LONPF3 (CHGS)
      *       "     = 6   BACK FROM/TO LONPF4 (MEMO)
      *       "     = 7   BACK FROM    CODE PROGRAMS
      *       "     = 8   BACK FROM    CODE PROGRAMS
      **************************************************
       MAIN-PROGRAM SECTION.

           PERFORM SQL-CONNECT.

      D    STOP MESS.
           MOVE FORM-PATHNAME TO FORM-PATH.
           MOVE "LONPF" TO VDU-FORM-NAME.

           MOVE USER-PID TO TEMP-PID.

      *  -------------------------------------------------------------
      *  TEST ENVIRONMENT VARIABLE "RVLINES" TO DETERMINE WHETHER
      *  OR NOT TO DISPLAY BALANCES ON REVERSALS.
      *  -------------------------------------------------------------
           MOVE "RVLINES" TO GETENV-BUF
           PERFORM GETENV-CALL
           IF STAT = "00"
              MOVE "N" TO DISP-REV-BAL
           ELSE
              MOVE "Y" TO DISP-REV-BAL.

      * "I" INTERBRANCH
           IF ( PATH-MACHINE = SPACES )
              MOVE "S" TO POSTING-TYPE
           ELSE
              MOVE "I" TO POSTING-TYPE.

      *  ------------------------------------------------------------
      *  IF INTER BRANCH POSTING, FORCE BRIEF DISPLAY AND AFTER UPDATING
      *     RETURN TO INTERRUPT MENU. REST OF LOGIC IS IN LONPF0.
      *     (REQ #E114 MJD 050396)
      *  ------------------------------------------------------------
           IF ( POSTING-INTERBRANCH )
              MOVE PATH-BRANCH TO BR-NO
              PERFORM GET-BR
              IF BR-INBR-BRIEF-FG = "Y"
                 MOVE "B" TO FULL-DISPLAY.

           IF INTERRUPT-FG = "Y"
              MOVE " " TO VDU-WIMENU-SELECTION
           ELSE
              MOVE "C" TO VDU-WIMENU-SELECTION.
           MOVE "F"    TO VDU-CLMENU-SELECTION.

           MOVE SPACES TO CONV-REV-FLAG IP-PROG.

           MOVE SPACES TO INS-RB-TBL(1) INS-RB-TBL(2)
                          INS-RB-TBL(3) INS-RB-TBL(4)
                          INS-RB-TBL(5) INS-RB-TBL(6)
                          INS-RB-TBL(7) INS-RB-TBL(8).

           PERFORM GET-GPENV.

           PERFORM OPEN-LC1-FILE.
      *    PERFORM OPEN-LN1-FILE.

           MOVE 0      TO IO-FG.
           MOVE SPACES TO ERRCD.

           PERFORM RESTORE-SCREEN.

      * ALLOW CNTRL 'N' INTERRUPT:
           MOVE "WI/MAKERS"   TO VDU-CTRL-N-PROG.

      * ALLOW CNTRL 'R' INTERRUPT:
      *    IF (LN-ESCROW-FG = "Y" OR LN-ESCROW-FG = "I")
      *       MOVE "WI/ESINFO"   TO VDU-CTRL-R-PROG.

      * ALLOW CNTRL 'B' INTERRUPT:
      * HELP, THIS NEEDS TO GET PASSED TO WI/RVLINE, BUT IS CALLED IN THE
      * SCREEN THEN ALL PROGRAMS WOULD HAVE TO COPY RVLINEW
           MOVE "WI/RVLINE"   TO VDU-CTRL-B-PROG.

           MOVE LN-OWNBR      TO RVLINE-BRNO.
           MOVE LN-ACCTNO     TO RVLINE-ACCTNO.
           MOVE LN-UNITPER-CD TO RVLINE-UNITPER-CD.
           MOVE RVLINE-BUF    TO VDU-CTRL-B-BUF.

           MOVE "M" TO MAKER-CD.
           MOVE 0   TO SUB.
       NEXT-MAKER-CK.
           ADD 1 TO SUB.
           IF BORROWER-KEY = LN-SSNO(SUB)
              MOVE LN-MAKERCD(SUB) TO MAKER-CD
              GO TO MAIN-GET-SP.
           IF SUB < 4
              GO TO NEXT-MAKER-CK.

       MAIN-GET-SP.
           PERFORM GET-SP.
           IF IO-FG NOT = 0
              MOVE "INVALID STATE PARAMETER RECORD" TO MESS
              PERFORM SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

           MOVE SP1-KEY    TO HOLD-SP1-KEY.
           MOVE SP-LAWCODE TO WK-LAWCODE.

           PERFORM GET-GB.
           IF IO-FG NOT = 0
              MOVE "INVALID GLOBAL RECORD" TO MESS
              PERFORM SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

           MOVE LN-OWNBR TO BR-NO.
           PERFORM GET-BR.
           IF IO-FG NOT = 0
              MOVE "INVALID BRANCH RECORD" TO MESS
              PERFORM SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

           IF ROUTE-CD = "7" OR = "8"
              GO TO PROGRAM-SELECTION.

           PERFORM SETUP-INIT-SP-SCAN.
           IF FULL-DISPLAY = "F"
              IF BR-LONPF-OPT-DISPLAY = "Y"
                 PERFORM DISPLAY-ENTRY-UP-OPT
              ELSE
                 PERFORM DISPLAY-ENTRY-UP
              END-IF
           ELSE
              IF BR-LONPF-OPT-DISPLAY = "Y"
                 PERFORM DISPLAY-ENTRY-UP-OPT
              ELSE
                 PERFORM DISPLAY-ENTRY-UP-BRIEF
              END-IF
              PERFORM SETUP-INIT-SP-SCAN
              MOVE HOLD2-KEY-UP TO HOLD1-KEY-DOWN.

           IF ROUTE-CD = "4" OR = "6"
      * GET INITIAL POSTING PROMPTS BACK
              MOVE CODE-LIST             TO WR-LIST
              MOVE PROMPT-INITIAL-VALUES TO WR-BUF
              PERFORM CALL-WRFORM.

           PERFORM CLEAR-HOLD-FIELDS.

           IF ROUTE-CD = "3"
              MOVE 0 TO LP-EARNED(1) LP-EARNED(2) LP-EARNED(3)
              PERFORM DISPLAY-EARNINGS
              GO TO PROGRAM-SELECTION.

           IF LN-OWNBR NOT = BRANCH
              MOVE LN-OWNBR   TO DIS-BR
              MOVE DIS-BRANCH TO MESS
              PERFORM SEND-MESS.

           IF BR-ALLOTMNTS = "Y"
              IF LN-ALLOTCD = "Y"
                 MOVE "ACCOUNT UNDER ALLOTMENT PLAN" TO MESS
                 PERFORM SEND-MESS.

           IF BR-ALLOTMNTS = "Y"
              IF LN-LBOX = "Y"
                 MOVE "ACCOUNT UNDER LOCK BOX TYPE PLAN" TO MESS
                 PERFORM SEND-MESS.

       PROGRAM-SELECTION.
           PERFORM SELECTION-MODULE.
           GO TO END-ROUTINE.

      ******************************************************************
       SELECTION-MODULE SECTION.
      ******************************************************************
       SELECTION-ENTRY.

           IF ( ROUTE-CD = "7" )
              MOVE 1 TO FIRST-TIME
              GO TO BAR-ENTRY-ROUTINE.

           IF ( ROUTE-CD = "8" )
              MOVE 0 TO LP-OTHBAL LP-INTBAL LP-APINT LP-APOTH
              MOVE 0 TO LP-LCBAL LP-APLC LP-APOT2 LP-OT2BAL
              MOVE 1 TO FIRST-TIME
              MOVE CDV-00 TO CDV-BUF
              PERFORM CDV-VERIFY
              IF ( CDV-MATCH )
                 MOVE CDV-SUB TO CDV-IX
                 GO TO BAR-REF-ENTRY.

           IF ( ROUTE-CD > 2 ) OR ( FIRST-TIME = ZEROES )
              MOVE 1 TO FIRST-TIME
              GO TO BAR-ENTRY-ROUTINE.

           MOVE SPACES TO ROUTE-CD.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *   LONPF1-SEL2 =
      *          "F1-LNNO ^/V F4 F5-PAY F6-POST F7-EXIT L-LDGR P-PRINT:"
      *   LONPF1-SEL  =
      *          "F1-LNNO ^/V F4 F5-PAYOFF F6-POST F7-EXIT P-PRINT    :"
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF ( BR-LCARDFG = "Y" )
              MOVE LONPF1-SEL2 TO MESS
           ELSE
              MOVE LONPF1-SEL  TO MESS.

           PERFORM SEND-LEGEND.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE "E RA060SEL." TO VDU.
           PERFORM SCREENIO.

           IF ( F1-KEY ) MOVE 0      TO NEW-PROG-SUB
                         MOVE "2"    TO ROUTE-CD
                         GO TO SELECTION-EXIT-PROG.

           IF ( F4-KEY ) PERFORM TOGGLE-ON-DATE
                         GO TO SELECTION-ENTRY.

           IF ( F5-KEY ) 
              MOVE "WI/WIPOFF" TO FORM-NAM
              CALL FORM-PROGX USING FORM-PATH EXIT-PATHNAME
              CANCEL FORM-PROGX
              GO TO SELECTION-ENTRY.

           IF ( F6-KEY ) GO TO BAR-ENTRY-ROUTINE.

           IF ( F7-KEY ) IF ( INTERRUPT-FG = "Y" )
                            MOVE "E" TO ERRCD
                            GO TO SELECTION-MODULE-EXIT
                         ELSE
                         IF ( INTERRUPT-FG = SPACES )
                            DESTROY ALL CONTROLS
                            PERFORM MENU-SELECTION
                            MOVE ZEROES TO ELE
                            PERFORM SAVE-SCREEN
                            IF ( MENU-FG = 99 )
                               GO TO SELECTION-ENTRY
                            ELSE
                               GO TO SELECTION-MODULE-EXIT.

           IF ( UP-KEY OR PAGE-UP-KEY )
              PERFORM DISPLAY-ENTRY-UP
              GO TO SELECTION-ENTRY.

           IF ( DOWN-KEY OR PAGE-DOWN-KEY )
              PERFORM DISPLAY-ENTRY-DOWN.

           GO TO SELECTION-ENTRY.

       BAR-ENTRY-ROUTINE.

           MOVE ENTRY-LINE TO WR-LIST.
           MOVE SPACES     TO WR-BUF.
           PERFORM CALL-WRFORM.

           MOVE "DRAWER." TO WR-LIST.
           MOVE "__"      TO WR-BUF.
           PERFORM CALL-WRFORM.

           MOVE SPACES TO ROUTE-CD.

           PERFORM CLEAR-LP-FILE.

           MOVE LN-STATUSFG    TO LP-STATUSFG.
           MOVE LN-ACCTNO      TO LP-ACCTNO.
           MOVE TRANS-DATE     TO LP-TRDATE.
           MOVE BORROWER-KEY   TO LP-SSNO.
           MOVE LN-LCPDTH-DATE TO LP-LCPDTH-DATE.

      * CLEAR MAIN COMBINED LX PAYMENT TRAILER
           PERFORM CLEAR-LX-FILE.

      * CLEAR LXG PAYMENT GL DISTRIBUTION TRAILER
           PERFORM CLEAR-LXG-FILE.

           MOVE LP-BRNO   TO LXG-BRNO.
           MOVE LP-ACCTNO TO LXG-ACCTNO.

      * CLEAR LXE PAYMENT EARNINGS TRAILER
           PERFORM CLEAR-LXE-FILE.

           MOVE LP-BRNO   TO LXE-BRNO.
           MOVE LP-ACCTNO TO LXE-ACCTNO.

           PERFORM CLEAR-HOLD-FIELDS.
           PERFORM CLEAR-REBATE-TABLE.
           PERFORM DISPLAY-EARNINGS.

      *-----------------------------------------------------------------
      *    ENTERING POSTING DATE
      *-----------------------------------------------------------------
       BAR-DATE-ENTRY.

      * "F1-EXIT ^/V F2-MEMO F3-CHG F4 F5-PAYOFF F6-REV F7-LN#".
           MOVE LONPF1-010 TO MESS.
           PERFORM SEND-LEGEND.

           MOVE "EN N060010." TO VDU.
           PERFORM SCREENIO.

           IF ( F1-KEY ) GO TO SELECTION-ENTRY.

           IF ( F2-KEY )
              MOVE LN-ACCTNO        TO EXT-WI-CL-ACCTNO
              MOVE LN-OWNBR         TO EXT-WI-CL-OWNBR
      *       MOVE LN-APP-NUMBER    TO EXT-WI-CL-APP-NUMBER
              MOVE 1                TO EXT-WI-CL-SSNO-NO
              MOVE LN-SSNO(1)       TO EXT-WI-CL-SSNO(1)
              MOVE "T"              TO MEMOSC-ONLY
              MOVE "WI/MEMOSC" TO FORM-NAM
              CALL FORM-PROGX USING FORM-PATH MEMOSC-BUF EXIT-PATHNAME
              CANCEL FORM-PROGX
              GO TO SELECTION-EXIT-PROG.

           IF ( F3-KEY )
              IF LN-ACCT-FROZEN = "Y"
                 PERFORM ACCOUNT-IS-FROZEN
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-DATE-ENTRY
                 END-IF
              END-IF
              MOVE 3   TO NEW-PROG-SUB
              MOVE "5" TO ROUTE-CD
              GO TO SELECTION-EXIT-PROG.

           IF ( F4-KEY ) PERFORM TOGGLE-ON-DATE
                         GO TO BAR-ENTRY-ROUTINE.

           IF ( F5-KEY )
              MOVE "WI/WIPOFF" TO FORM-NAM
              CALL FORM-PROGX USING FORM-PATH EXIT-PATHNAME
              CANCEL FORM-PROGX
              GO TO BAR-ENTRY-ROUTINE.


           IF ( F6-KEY )
                         IF LN-ACCT-FROZEN = "Y"
                            PERFORM ACCOUNT-IS-FROZEN
                            IF PASSWDW-STAT NOT = "OK"
                               GO TO BAR-DATE-ENTRY
                            END-IF
                         END-IF
                         MOVE RV-SEQ TO PASSWDW-SEQ
                         MOVE "TO REVERSE LAST TRANSACTION"
                                     TO PASSWDW-PROMPT2
                         PERFORM VERIFY-PASSWORD
                         IF ( PASSWDW-STAT NOT = "OK" )
                            GO TO BAR-DATE-ENTRY
                         ELSE
                            MOVE ZEROES TO VDUNUM0
                            MOVE "00"   TO VDUSTATUS
                            MOVE "RV"   TO LP-TRCD.

           IF (        F7-KEY ) MOVE ZEROES TO NEW-PROG-SUB
                                MOVE "2"    TO ROUTE-CD
                                GO TO SELECTION-EXIT-PROG.

           IF ( F11-KEY )
              MOVE LN-OWNBR  TO COLAST-LN-OWNBR
              MOVE LN-ACCTNO TO COLAST-LN-ACCTNO
              MOVE "WI/COLAST" TO FORM-NAM
              CALL FORM-PROGX USING FORM-PATH COLAST-BUF EXIT-PATHNAME
              CANCEL FORM-PROGX.

           IF ( UP-KEY OR PAGE-UP-KEY )
              PERFORM DISPLAY-ENTRY-UP
              GO TO BAR-ENTRY-ROUTINE.

           IF ( DOWN-KEY  OR PAGE-DOWN-KEY)
              PERFORM DISPLAY-ENTRY-DOWN
              GO TO BAR-ENTRY-ROUTINE.

           IF ( NOT ENTER-KEY ) GO TO BAR-DATE-ENTRY.

           IF LN-ACCT-FROZEN = "Y" AND LP-TRCD NOT = "RV"
              PERFORM ACCOUNT-IS-FROZEN
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-DATE-ENTRY.


      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ACCOUNT IS BEING RENEWED INTO A RESCISSION ACCOUNT, DURING THE
      * RESCISSION PERIOD, DO NOT ALLOW ANY POSTING, BECAUSE THE NET
      * PAYOFF FIGURES ARE ALREADY FIGURED INTO THE NEW LOAN !! BAH
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF ( LN-POCD-PB-RESC )
              MOVE "ACCOUNT IS IN RESCISSION RENEWAL" TO MESS
              PERFORM SEND-MESS
              GO TO BAR-DATE-ENTRY.

           IF ( LN-OWNBR NOT = BRANCH )
              IF ( GB-OTHER-BRANCH-POST = "N" )
                 MOVE "ACCOUNT BELONGS TO ANOTHER BRANCH" TO MESS
                 PERFORM SEND-MESS
                 MOVE "010." TO WR-LIST
                 MOVE SPACES TO WR-BUF
                 PERFORM CALL-WRFORM
                 GO TO BAR-DATE-ENTRY.

           PERFORM GET-GI-CONTROL.

           IF ( IO-FG = 9 )
              MOVE "NO GENERAL LEDGER INTERFACE,CAN'T POST" TO MESS
              PERFORM SEND-MESS
              GO TO BAR-DATE-ENTRY.

           MOVE LPLOAN-SYSDATE TO ALP-DATE.
           PERFORM CONVERT-ALPDATE-TO-YYYYMMDD.
           MOVE DATE-YYYYMMDD TO SYS-DATE.

      * MUST STAY VDUNUM0, NOT ENTERED WITH SCREENIO DATE EDITS
      *    MOVE VDUNUM0 TO LP-PAYDATE.

           MOVE VDUNUM0       TO DATE-MMDDYY.
           PERFORM CONVERT-MMDDYY-TO-YYYYMMDD.
           MOVE DATE-YYYYMMDD TO LP-PAYDATE.     

           IF ( LP-PAYDATE = ZEROES )
              MOVE "SN N060010." TO VDU
              MOVE SYS-DATE      TO DATE-YYYYMMDD LP-PAYDATE
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY   TO VDUNUM0
              PERFORM SCREENIO
              GO TO BAR-DATE-CONT.

           MOVE LP-PAYDATE TO NUM-DATE.
           PERFORM TSTDAT.
           IF ( NUM-DATE = 0 )
              GO TO BAR-DATE-ENTRY.

           MOVE "SN N060010." TO VDU.
           MOVE LP-PAYDATE    TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO VDUNUM0.
           PERFORM SCREENIO.

           IF ( BR-POST-AHEAD-FG = "N" )
      * SYS-DATE IS SYSTEM-DATE
              IF SYS-DATE < LP-PAYDATE
                 MOVE "POST DATING TRANSACTIONS IS NOT ALLOWED!!"
                                                            TO MESS
                 PERFORM SEND-MESS
                 GO TO BAR-DATE-ENTRY.

      * WORLD PASSWORD PROTECT ANY TRANSACTION BEING POSTED 
      * GREATER THAN 3 DAYS PRIOR.
           MOVE LP-PAYDATE TO NUM-DATE.
           PERFORM TIM.
           IF ELAPSED-DAYS > 3
              MOVE BACKDATE-MORE-THAN-3DAY-SEQ  TO PASSWDW-SEQ
              MOVE "TO BACKDATE TRANSACTION"    TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "EXCEEDS BACKDATING 3 DAYS " TO MESS      
                 PERFORM SEND-MESS
                 GO TO BAR-DATE-ENTRY.

       BAR-DATE-CONT.
           MOVE TRANS-DATE TO NDTE-DATE.
           MOVE 3 TO NDTE-HOLD.
           PERFORM INCREMENT-MONTHS.
           IF LP-PAYDATE > NDTE-DATE
              MOVE POST-3-MONTHS TO PASSWDW-SEQ
              PERFORM PASSWORD-MUST-EXIST
              IF PASSWDW-STAT NOT = "OK"
                 MOVE
                     "WARNING: EFFECTIVE DATE IS 3 MONTHS IN FUTURE"
                                     TO MESS
                 PERFORM SEND-MESS.

           MOVE TRANS-DATE TO NDTE-DATE.
           MOVE -3         TO NDTE-HOLD.
           PERFORM INCREMENT-MONTHS.
           IF LP-PAYDATE < NDTE-DATE
              MOVE POST-3-MONTHS TO PASSWDW-SEQ
              PERFORM PASSWORD-MUST-EXIST
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "WARNING: EFFECTIVE DATE IS 3 MONTHS IN THE PAST"
                                     TO MESS
                 PERFORM SEND-MESS.

           IF LP-PAYDATE < LN-LOANDATE
              MOVE "PRIOR TO LOAN DATE" TO MESS
              PERFORM SEND-MESS
              GO TO BAR-ENTRY-ROUTINE.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    TEST IF ACCOUNT HAS GONE PAST EXPIRATION AND THE LAST PAYMENT
      *     MADE WAS BEFORE EXPIRATION, IF SO LET OPERATOR KNOW, ACCOUNT
      *     WILL EXPIRE WITH NEXT PAYMENT POSTED
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE SPACES     TO EXPIRATION-INFORMED-FG.
           PERFORM EXPIRATION-DATE-CALCULATION.
           IF (LP-TRCD NOT = "RV") AND (LP-PAYDATE NOT < XDTE-DATE)
              IF ( LN-DATE-PAID-LAST = ZEROES )
                 MOVE LN-INTDATE TO SYS-DATE
              ELSE
                 MOVE LN-DATE-PAID-LAST TO SYS-DATE
              END-IF
              IF SYS-DATE < XDTE-DATE
                 MOVE XDTE-DATE TO DATE-YYYYMMDD
                 PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
                 MOVE DATE-MMDDYY TO DIS-DATE
                 MOVE EXPIRED-MESSAGE TO MESS
                 PERFORM SEND-MESS
                 MOVE "Y" TO EXPIRATION-INFORMED-FG.

           IF ( LP-TRCD = "RV" )
              MOVE "S  A020020." TO VDU
              MOVE LP-TRCD       TO VDUBUF
              PERFORM SCREENIO
              PERFORM CLEAR-LEGEND
              GO TO BAR-REF-ENTRY.

           IF (LN-CASHDATE NOT = 0) AND (LN-INT-REBATE   = SPACES)
              PERFORM ALARM
              MOVE LN-CASHDATE TO CASH-MESS-DT
              MOVE CASH-MESS   TO MESS
           ELSE
              MOVE "F3-TRANSACTION CODES" TO MESS.

           PERFORM SEND-LEGEND.

      *=================================================================
      *  TRANSACTION CODE VALUES:
      *  PGM
      *             --------------------------------
      *  F5    TS   UPDATE ONLY
      *             --------------------------------
      *  F7    AL - ASSESS LATE CHARGES
      *  F7    AI -   "   INTEREST "
      *  F7    OT - ADD-ON (OTHER)     
      *
      *  F7    WL - WAIVE LATE CHARGES 
      *  F7    WI -   "   INTEREST "  
      *  F7    WO -   "   OTHER    "
      *  F7    AP - ADJUST PRINCIPAL BALANCE
      *             --------------------------------
      *  F8    RV - REVERSE PRIOR PAYMENT RECORD(S)
      *             --------------------------------
      *  F9    PL - P&L ACTIVE
      *        P? - WHERE ? = P&L TYPE
      *             (FROM 2 THRU 5)
      *  F9    PI - P&L INACTIVE
      *  F9    PW - P&L WRITE OFF
      *  F9    JD - JUDGEMENT
      *        SJ - SPLIT JUDGEMENT (N/A)
      *             --------------------------------
      *  FA    PO - PAY OFF
      *  FA    RN - RENEWAL
      *  FA    SC - SALES FINANCE CONVERSION
      *  FA    PB - PRESENT BORROWER RENEWAL
      *             --------------------------------
      *  FB    RC - REBATE CREDIT LIFE INS.
      *  FB    RA -   "    ACCIDENT & HEALTH INS.
      *  FB    RP -   "    PERSONAL PROPERTY INS.
      *  FB    R1 -   "    OTHER 1 INS.
      *  FB    R2 -   "    OTHER 2 INS.
      *  FB    R3 -   "    OTHER 3 INS.
      *  FB    RI -   "    INTEREST
      *  FB    RM -   "    MAINTFEE
      *  FB    RD -   "    DEFERMENT
      *  FB    RS -   "    SERVCHRG
      *
      *  FB    CC - CANCEL CREDIT LIFE INS.
      *  FB    CA -   "    ACCIDENT & HEALTH INS.
      *  FB    CP -   "    PERSONNAL PROPERTY INS.
      *  FB    C1 -   "    OTHER 1 INS.
      *  FB    C2 -   "    OTHER 2 INS.
      *  FB    C3 -   "    OTHER 3 INS.
      *  FB    CD -   "    DEFERMENT
      *             --------------------------------
      *  FC    PY - PAYMENT (NORMAL) 
      *  FC    AH -    "    A&H INSURANCE
      *  FC    PR -    "    DEALER RESERVE
      *  FC    PS -    "    DEALER SPECIAL RESERVE
      *  FC    PA -    "    UNDER ALLOTMENT PLAN
      *  FC    PE -    "    EXCEPTION (INS. / REPO, ETC)
      *  FC    PN -    "    NON CASH PAYMENT UPDATES LIKE 'PY'
      *  FC    PZ -    "    NON CASH PAYMENT UPDATES LIKE 'PY' BUT NOT RECENCY
      *  FC    DF - DEFERMENT
      *        D? - WHERE ? = NO. OF DEFERMENTS
      *             (FROM 2 THRU 9)
      *  FC    DE - DISBURSE ESCROW
      *             --------------------------------
      *  FD    TP - TRANSFER TO PURCHASED (FROM SERV.)
      *  FD    TS - RESERVE PAYMENT (GO TO SERV.ACCT)
      *             --------------------------------
      *  FE    SP - SET POOL ID
      *  FE    DC - DUE DATE CHANGE
      *  FE    AD - ALLOWABLE DELINQUENCY
      *        A? - WHERE ? = NO. OF ALLOW DELINQ
      *             (FROM 2 THRU 9)
      *             --------------------------------
      *  FZ    TP   UPDATE ONLY
      *             --------------------------------
      *
      *=================================================================
       BAR-CD-ENTRY.
           MOVE "Y" TO ENTER-AMT-FG.
           MOVE 0 TO BYPASS-AMT-ENT-FG.

           MOVE "E  A020020." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "16"
              MOVE 3 TO NEW-PROG-SUB
              MOVE "4" TO ROUTE-CD
              GO TO SELECTION-EXIT-PROG.
           IF VDUSTATUS = "10" OR = "1U"
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS NOT = "00"
              GO TO BAR-CD-ENTRY.
           MOVE VDUBUF TO LP-TRCD.

      * TEMPORARY, REMOVE AFTER 'LR' LOAN RE-SCHEDULE WORKS
      * YOU WILL NEED TO BRING LONPFG BACK ALSO
           IF LP-TRCD = "LR"
              GO TO BAR-CD-ENTRY.

      * TEST FOR AFP CLASS IF POSTING "O2"
      * ALSO USES LC-SMALLOAN AND LC-SALESFIN FURTHER DOWN
           MOVE LN-CLASS TO LC-CODE.
           PERFORM READ-LC1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           IF LC-AFP-CLASS = "Y"
              IF LP-TRCD = "O2"
                 MOVE "INVALID FOR AFP LOANS" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF LC-SERVACCT = "Y"
              IF LP-TRCD NOT = "TP"
                 MOVE POST-TO-SERVICE-SEQ TO PASSWDW-SEQ
                 MOVE "TO POST TO SERVICE ACCOUNTS" TO PASSWDW-PROMPT2       
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "POSTING TO SERVICE ACCOUNTS NOT ALLOWED"
                                                        TO MESS
                    GO TO BAR-CD-ENTRY-RTN.


      *DONT ALLOW RESERVE[PC,PR,PP,PR,P5 ON SERVICE CLASSES
           IF LN-SERVACCT = "Y"
              IF LP-TRCD = "PC" OR "PR" OR "PP" OR "P4" OR "P5"
                 MOVE
                "RESERVE TRANSACTION NOT ALLOWED ON SERVICE ACCTS"
                                                    TO MESS
                  PERFORM SEND-MESS
                  GO TO BAR-CD-ENTRY.

           IF LN-SMALLOAN = "Y"
              IF LP-TRCD = "PC" OR "PR" OR "PP" OR "P4" OR "P5"
                 MOVE
                "RESERVE TRANSACTION NOT ALLOWED ON DIRECT LOAN ACCTS"
                                                    TO MESS
                  PERFORM SEND-MESS
                  GO TO BAR-CD-ENTRY.


      * LENDMARK PR# 2711 3/22/06
           IF GP-LOAN-ACH-PROCESSING = "Y"
              IF LN-ACH = "Y"
                 IF LP-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR " RO"
                    MOVE 10 TO WINDOW-LINES
                    MOVE 50 TO WINDOW-COLUMNS
                    MOVE 16 TO WINDOW-BEGIN-Y
                    MOVE 21 TO WINDOW-BEGIN-X
                    MOVE "CONTYN" TO VDU-FORM-NAME
                    MOVE "WI/CONTYN" TO WINDOW-FORM-NAM

                    PERFORM OPEN-WINDOW
                    DISPLAY CONTYN-SCREEN

                    MOVE CONTYN-FORM-FIELDS TO WR-BUF
                    MOVE CONTYN-FORM-LIST   TO WR-LIST
                    PERFORM CALL-WRFORM
           
                    MOVE "S  A000MSG1." TO VDU
                    MOVE "THIS ACCOUNT IS SET UP FOR AUTOMATIC"
                      TO VDUBUF
                    PERFORM SCREENIO
                    MOVE "S  A000MSG2." TO VDU
                    MOVE "ELECTRONIC (ACH) PAYMENTS!" TO VDUBUF
                    PERFORM SCREENIO
                    MOVE "S  A010WSEL." TO VDU
                    MOVE "TYPE `CONTINUE' TO PROCEED:" TO VDUBUF
                    PERFORM SCREENIO
                    MOVE "E  A010SEL." TO VDU
                    PERFORM SCREENIO
                    IF VDUBUF NOT = "CONTINUE"
                       DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN
                       DESTROY CONTYN-SCREEN
                       PERFORM CLOSE-WINDOW
                       MOVE "LONPF" TO VDU-FORM-NAME
                       GO TO BAR-CD-ENTRY
                    ELSE
                       DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN
                       DESTROY CONTYN-SCREEN
                       PERFORM CLOSE-WINDOW
                       MOVE "LONPF" TO VDU-FORM-NAME.


      * TEST FOR AFP CLASS IF POSTING WITHDRAWAL FROM RESERVES
      *  ALSO BRANCH FLAG BR-NO-OUT-DLR-RSV:
              IF LP-TRCD = "PC" OR "PR" OR "PP" OR "P4" OR "P5"
                 IF BR-NO-OUT-DLR-RSV = "N"
                    MOVE "WITHDRAWL FROM RESERVE NOT ALLOWED" TO MESS
                    GO TO BAR-CD-ENTRY-RTN
                 ELSE
                    IF LC-AFP-CLASS = "Y"
                       MOVE
                       "AFP CLASS, WITHDRAWL FROM RESERVE NOT ALLOWED"
                            TO MESS
                       GO TO BAR-CD-ENTRY-RTN.

           IF BR-OTH-INS-LEVELS NOT = "Y"
              IF (LP-TRCD = "R1" OR "R2" OR "R3"
                          OR "C1" OR "C2" OR "C3")
                 MOVE "INVALID" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  JTG 020731 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *             ALLOWED 'CC' AND 'CA' TO CANCEL MIP INSURANCE
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF (LP-TRCD = "CC" OR "CA") AND
              (LN-MIP-FG = "Y"       )
              GO TO BAR-REF-SKIP-CANCEL-TEST.
    
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  JTG 020805 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *             STOPPED 'RC' AND 'RA' FOR MIP INSURANCE
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF (LP-TRCD = "RC" OR "RA") AND
              (LN-MIP-FG = "Y"       )
                 MOVE "INVALID, USE 'CC' AND/OR 'CA'" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

      *-------------------------------------------------------------------
      * TEMPORARY STOP OF INSURANCE CANCELS UNTIL LONPF2.C IS CORRECTED
      * TO PROPERLY GENERATED TP-FIELDS SO LPEOD5 WILL UPDATE
      * GENERAL LEDGER CORRECTLY.
      *-------------------------------------------------------------------
      *    IF BR-INS-ADDON = "Y" OR "O"
      *-------------------------------------------------------------------
              IF LP-TRCD = "CC" OR "CA" OR "CP" OR "C1" OR "C2" OR "C3"
                 MOVE "INVALID" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

       BAR-REF-SKIP-CANCEL-TEST.
      * TEST FOR PASSWORD PROTECTION ON EFFECTIVE DATE OF PB, RN, RB, RO, SC.
           IF LP-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
              IF TRANS-DATE NOT = LP-PAYDATE
                 MOVE RENEWAL-EFFDTE-SEQ TO PASSWDW-SEQ
                 IF TRANS-DATE < LP-PAYDATE
                    MOVE "TO POSTDATE A RENEWAL" TO PASSWDW-PROMPT2
                 ELSE
                    MOVE "TO PRE-DATE A RENEWAL" TO PASSWDW-PROMPT2
                 END-IF
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD PROTECTION ON SP TRANSACTIONS
           IF LP-TRCD = "SP"
              IF ( POSTING-INTERBRANCH )
                 MOVE SP-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO SET POOL INTERBR" TO PASSWDW-PROMPT2
              ELSE
                 MOVE SP-SEQ TO PASSWDW-SEQ
                 MOVE "TO SET POOL ID" TO PASSWDW-PROMPT2
              END-IF
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

           IF GP-USE-SCRA = "Y"
              IF LP-TRCD = "OT"
                 MOVE LN-OWNBR  TO LSR-BRNO
                 MOVE LN-ACCTNO TO LSR-ACCTNO
                 MOVE 1         TO LSR-SEQNO
                 PERFORM OPEN-LSR1-FILE
                 PERFORM READ-LSR1-FILE
                 PERFORM CLOSE-LSR1-FILE
                 IF IO-FG = 0 AND LSR-SCRA-ACTIVE = "Y"
                    MOVE OT-SCRA-SEQ TO PASSWDW-SEQ
                    MOVE "TO POST OT TO SCRA" TO PASSWDW-PROMPT2
                    PERFORM VERIFY-PASSWORD
                    IF PASSWDW-STAT NOT = "OK"
                       GO TO BAR-CD-ENTRY.

           IF GP-USE-SCRA = "Y"
              IF LP-TRCD = "OT" OR "O2"
                 MOVE LN-OWNBR  TO LSR-BRNO
                 MOVE LN-ACCTNO TO LSR-ACCTNO 
                 MOVE 1 TO LSR-SEQNO
                 PERFORM OPEN-LSR1-FILE
                 PERFORM READ-LSR1-FILE
                 PERFORM CLOSE-LSR1-FILE
                 IF IO-FG = 0 AND LSR-SCRA-ACTIVE = "Y"
                     IF LN-REDURATE = 6.000
                        MOVE OT-O2-SCRA-SEQ TO PASSWDW-SEQ
                        MOVE "TO POST OT /O2 TO SCRA"
                                 TO PASSWDW-PROMPT2
                        PERFORM VERIFY-PASSWORD
                        IF PASSWDW-STAT NOT = "OK"
                           GO TO BAR-CD-ENTRY. 

           IF LP-TRCD = "JD"
              MOVE JD-SEQ TO PASSWDW-SEQ
              MOVE "TO POST JD" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY. 

           IF LP-TRCD = "OT"
              MOVE OT-SEQ TO PASSWDW-SEQ
              MOVE "TO POST OT" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

           IF LP-TRCD = "O2"
              MOVE O2-SEQ TO PASSWDW-SEQ
              MOVE "TO POST O2" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

           IF LP-TRCD = "OP"
              IF (POSTING-INTERBRANCH)
                  MOVE OP-SEQ-INTERBRANCH TO PASSWDW-SEQ
                  MOVE "TO POST 'OP' INTERBRANCH" TO PASSWDW-PROMPT2
              ELSE
              IF LN-PLCD NOT = SPACES
                  MOVE OP-PL-SEQ      TO PASSWDW-SEQ
                  MOVE "TO POST 'OP' ON P&L" TO PASSWDW-PROMPT2
              ELSE
                  MOVE OP-SEQ             TO PASSWDW-SEQ
                  MOVE "TO POST 'OP'"             TO PASSWDW-PROMPT2
              END-IF
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.


      * TEST FOR PASSWORD PROTECTION ON IR TRANSACTIONS
           IF LP-TRCD = "IR"
              IF ( POSTING-INTERBRANCH )
                 MOVE IR-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'IR' INTERBRANCH" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF ( PASSWDW-STAT NOT = "OK" )
                    MOVE "OPTION NOT ALLOWED INTERBRANCH" TO MESS
                    PERFORM SEND-MESS
                    GO TO BAR-CD-ENTRY
                 END-IF
              ELSE
                 MOVE IR-SEQ TO PASSWDW-SEQ
                 MOVE "TO REDUCE INTEREST" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-CD-ENTRY.



      * TEST FOR PASSWORD PROTECTION ON PE TRANSACTIONS
           IF LP-TRCD = "PE"
              IF ( POSTING-INTERBRANCH )
                 MOVE PE-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST PAY EXCEPT INTERB" TO PASSWDW-PROMPT2
              ELSE
                 MOVE PE-SEQ TO PASSWDW-SEQ
                 MOVE "TO POST PAYMENT EXCEPTION" TO PASSWDW-PROMPT2
              END-IF
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.


      * TEST FOR PASSWORD PROTECTION ON PR, PC, PP TRANSACTIONS
           IF LP-TRCD = "PR" OR "PC" OR "PP"
              MOVE PR-SEQ TO PASSWDW-SEQ
              MOVE "TO POST RESERVE PAYMENT" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD PROTECTION ON PN AND PZ TRANSACTIONS
           IF LP-TRCD = "PN" OR "PZ"
              MOVE PN-PZ-SEQ TO PASSWDW-SEQ
              MOVE "TO POST TRANSACTION" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD PROTECTION ON CA,CC,C1,C2, AND CP TRANSACTIONS
           IF LP-TRCD = "CC" OR "CA" OR "CP" OR "C1" OR "C2" OR "C3"
              MOVE CA-SEQ TO PASSWDW-SEQ
              MOVE "TO CANCEL INSURANCE" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD PROTECTION ON AP'S TO P&L ACCOUNTS
           IF LP-TRCD = "AP" AND LN-PLDATE NOT = 0
              MOVE AP-PL-SEQ TO PASSWDW-SEQ
              MOVE "TO ADJUST PRINCIPAL ON A P&L" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

           IF LP-TRCD = "AD" OR "A2" OR "A3" OR "A4" OR "A5" OR
                        "A6" OR "A7" OR "A8" OR "A9"
              IF BR-ALDEL-FLAG NOT = "Y"
                 MOVE "ALLOWABLE DELIQUENCY TRANSACTIONS NOT ALLOWED!"
                    TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
                 MOVE AD-SEQ TO PASSWDW-SEQ
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-CD-ENTRY
                 ELSE
                    PERFORM VALIDATE-DEL-POLICY
                    IF DEL-MAXIMUM = "Y"
                       GO TO BAR-CD-ENTRY-RTN.

      * LENDMARK PR# 2315 6/9/2004
      * PASSWORD ACCOUNTS NOT FLAGGED AS SALES OR SMALL, THESE ARE
      * REAL ESTATE ACCOUNTS
           IF LP-TRCD = "AD" OR "A2" OR "A3" OR "A4" OR "A5" OR
                        "A6" OR "A7" OR "A8" OR "A9"
              IF LC-SMALLOAN = "N" AND LC-SALEFIN = "N"
                  MOVE "TO POST THIS TO REAL ESTATE" TO PASSWDW-PROMPT2
                  MOVE AD-REAL-ESTATE-SEQ TO PASSWDW-SEQ
                  PERFORM VERIFY-PASSWORD
                  IF PASSWDW-STAT NOT = "OK"
                     GO TO BAR-CD-ENTRY.

           IF LP-TRCD = "A2" OR "A3" OR "A4" OR "A5" OR
                        "A6" OR "A7" OR "A8" OR "A9"
              IF SP-DEFFRMLA = 8
                 MOVE "ONLY 'AD' VALID WITH FORMULA '8'" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = " "
              MOVE "S  A020020." TO VDU
              MOVE "PY" TO VDUBUF LP-TRCD
              PERFORM SCREENIO.

      *   PR#460 DONT ALLOW BACKDATE PRIOR TO LN-INTPDTH-DATE OR LN-LCPDTH-DATE
           IF LP-TRCD = "PY"  OR " " OR "PA" OR "PE" OR "AI" OR "AL" OR
                "DF" OR "D2" OR "D3" OR "D4" OR "D5" OR "D6" OR
                "Z2" OR "SS" OR "PR" OR "PC" OR "PP" OR "AH" OR
                "D7" OR "D8" OR "D9"
                PERFORM BACKDATE-TEST
                IF BACKDATE-FG = "N"
                   GO TO BAR-CD-ENTRY.

           IF GP-REPO-CODE = "A"
              IF (LN-REPOCD = "X" OR "S") AND LN-PLDATE = 0
                IF LP-TRCD = "PA" OR "PY" OR "OT" OR "AP" OR "OP"
                   MOVE REPO-POSTING-ALLOWED-SEQ TO PASSWDW-SEQ
                   MOVE "TO POST TO REPO ACCOUNT"
                                             TO PASSWDW-PROMPT2
                   PERFORM VERIFY-PASSWORD
                   IF PASSWDW-STAT NOT = "OK"
                      MOVE "CAN NOT POST TO ACCOUNTS IN REPO STATUS"
                                                             TO MESS
                      GO TO BAR-CD-ENTRY-RTN.


           IF SP-LC-INT-ON-REPO-NON-PL = "N"
              IF LP-TRCD = "SX"
                IF LN-PLDATE = ZEROS
                  PERFORM IBPC-TEST
                  IF IBPC-FG NOT = "I"
                     NEXT SENTENCE
                  ELSE
                    IF LN-INTPDTH-DATE < LP-PAYDATE
                      MOVE "ASSESS INTEREST(AI) BEFORE 'SX'" TO MESS
                      GO TO BAR-CD-ENTRY-RTN.

      *------------------------------------------------------------
      *    TEST FOR MORTGAGE INT TYPE 'Z' LOANS VALID TRANSACTIONS:
      *------------------------------------------------------------
           IF SP-CAL-RATETYPE(1) = "Z"
              MOVE CDV-MORTGAGE-INT-Z TO CDV-BUF
              PERFORM CDV-VERIFY
              IF NOT CDV-MATCH
                 MOVE
                 "INVALID FOR MORTGAGE INTEREST TYPE 'Z' LOANS!"
                                                      TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

      *------------------------------------------------------------
      *    ONLY ALLOW "ED" (ESCROW DISBURSEMENT) OR "EP" (ESCROW
      *    PREPAYMENT) IF ACCT HAS ESCROW FLAG TURNED ON
      *------------------------------------------------------------
           IF LP-TRCD = "ED"
              IF NOT (LN-ESCROW-FG = "Y" OR LN-ESCROW-FG = "I")
                 MOVE
                "CANNOT POST 'ED' TRANSACTION ON ACCOUNT WITHOUT ESCROW"
                                                      TO MESS
                 GO TO BAR-CD-ENTRY-RTN.
           IF LP-TRCD = "EP"
              IF NOT (LN-ESCROW-FG = "Y" OR LN-ESCROW-FG = "I")
                 MOVE
                "CANNOT POST 'EP' TRANSACTION ON ACCOUNT WITHOUT ESCROW"
                                                      TO MESS
                 GO TO BAR-CD-ENTRY-RTN.
      *------------------------------------------------------------
      *    DON'T ALLOW "AH" PAYMENT IF ACCOUNT HAS ACTIVE
      *    ESCROW (LN-ESCROW-FG = "Y")
      *------------------------------------------------------------
           IF LP-TRCD = "AH"
              IF LN-ESCROW-FG = "Y"
                 MOVE
               "CANNOT POST 'AH' TRANSACTION ON LOAN WITH ACTIVE ESCROW"
                                                      TO MESS
                 GO TO BAR-CD-ENTRY-RTN.
      *------------------------------------------------------------
      *    TEST FOR INTERBRANCH POSTING VALID TRANSACTIONS:
      *------------------------------------------------------------
           IF ( POSTING-INTERBRANCH )
              MOVE CDV-INTERBRANCH TO CDV-BUF
              PERFORM CDV-VERIFY
              IF NOT CDV-MATCH
                 MOVE "INVALID FOR INTERBRANCH POSTING!" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           MOVE CDV-00 TO CDV-BUF.
           PERFORM CDV-VERIFY.
           IF CDV-MATCH
              MOVE CDV-SUB TO CDV-IX
              GO TO VERIFY-CONTINUE.

           MOVE "INVALID" TO MESS.
           GO TO BAR-CD-ENTRY-RTN.

       VERIFY-CONTINUE.
      *-----------------------------------------------------------------
      * JTG      - WHEN POSTING A 'Z2' AND IT WILL CAUSE THE ACCOUNT
      * 09/24/96   TO GO INTO EXPIRATION, INSTRUCT OPERATOR TO ASSESS
      *            ALL LATE CHARGES DUE, SINCE ONCE IN EXPIRATION,
      *            NO LATE CHARGES WILL BE CHARGED TO THE ACCOUNT!!
      *-----------------------------------------------------------------
              IF ( EXPIRATION-INFORMED-FG = "Y" )
                 AND
                 ( ( SP-LCFRMLA NOT = " "            ) OR
                   ( LN-LC-CODE NOT = ZEROES         )
                 )
                 AND
                 ( LP-TRCD = "PY" OR "PA" OR "PE" OR "DF"
                                  OR "D2" OR "D3" OR "D4" OR "D5"
                                  OR "D6" OR "D7" OR "D8" OR "D9"
                                  OR "AI" OR "CI" OR "IR" OR "PR"
                                  OR "PC" OR "PP" OR "Z2" OR "SS"
                                  OR "PN" OR "PZ" OR "IN"
                 )
                   MOVE
           "N O T E:  ASSESS ALL LATE CHARGES!  -----  B E F O R E"
                                                            TO MESS
                   PERFORM SEND-MESS
                   MOVE
           "THIS POSTING PUTS THE ACCOUNT IN EXPIRATION STATUS"
                                                            TO MESS
                   PERFORM SEND-MESS.

      *-----------------------------------------------------------------
      * CHECK FOR PASSWORD ON POSTING PO INTERBRANCH 05/25/01 CS-MERC #250
           IF LP-TRCD = "PO"
              IF ( POSTING-INTERBRANCH )
                 MOVE PO-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'PO' INTERBRANCH" TO PASSWDW-PROMPT2
      *          PERFORM PASSWORD-MUST-EXIST
                 PERFORM VERIFY-PASSWORD
                 IF ( PASSWDW-STAT NOT = "OK" )
                    GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "IN"
              IF ( POSTING-INTERBRANCH )
                 MOVE IN-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'IN' INTERBRANCH" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF ( PASSWDW-STAT NOT = "OK" )
                    GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "IR"
              IF ( POSTING-INTERBRANCH )
                 MOVE IR-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'IR' INTERBRANCH" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF ( PASSWDW-STAT NOT = "OK" )
                    MOVE "OPTION: 'IR' POSTING INTERBRANCH NOT ALLOWED"
                                                   TO MESS
                    PERFORM SEND-MESS
                    GO TO BAR-CD-ENTRY-RTN.




      *-----------------------------------------------------------------
      * CHECK FOR PASSWORD ON POSTING RI INTERBRANCH 08/25/04 WORLD #0357
           IF LP-TRCD = "RI"
              IF ( POSTING-INTERBRANCH )
                 MOVE RI-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'RI' INTERBRANCH" TO PASSWDW-PROMPT2
      *          PERFORM PASSWORD-MUST-EXIST
                 PERFORM VERIFY-PASSWORD
                 IF ( PASSWDW-STAT NOT = "OK" )
                    GO TO BAR-CD-ENTRY-RTN.
      *-----------------------------------------------------------------
      * CHECK FOR PASSWORD ON POSTING RS INTERBRANCH 08/25/04 WORLD #0357
           IF LP-TRCD = "RS"
              IF ( POSTING-INTERBRANCH )
                 MOVE RS-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'RS' INTERBRANCH" TO PASSWDW-PROMPT2
      *          PERFORM PASSWORD-MUST-EXIST
                 PERFORM VERIFY-PASSWORD
                 IF ( PASSWDW-STAT NOT = "OK" )
                    GO TO BAR-CD-ENTRY-RTN.
      *-----------------------------------------------------------------
      * CHECK FOR PASSWORD ON POSTING RM INTERBRANCH 08/25/04 WORLD #0357
           IF LP-TRCD = "RM"
              IF ( POSTING-INTERBRANCH )
                 MOVE RM-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'RM' INTERBRANCH" TO PASSWDW-PROMPT2
      *          PERFORM PASSWORD-MUST-EXIST
                 PERFORM VERIFY-PASSWORD
                 IF ( PASSWDW-STAT NOT = "OK" )
                    GO TO BAR-CD-ENTRY-RTN.
      *PR#5248
           IF LP-TRCD = "RC" OR "RA" OR "RP" OR "R1" OR "R2" OR "R3"
              IF POSTING-INTERBRANCH
                  MOVE INS-REBATE-SEQ-INTERBR TO PASSWDW-SEQ
                  MOVE "TO POST INS. REBATES INTERBR"             
                                              TO PASSWDW-PROMPT2
                  PERFORM VERIFY-PASSWORD
                  IF (PASSWDW-STAT NOT = "OK")
                      GO TO BAR-CD-ENTRY-RTN.


      *-----------------------------------------------------------------
      * CHECK FOR PASSWORD ON POSTING AC INTERBRANCH 08/25/04 WORLD #0357
           IF LP-TRCD = "AC"
              IF ( POSTING-INTERBRANCH )
                 MOVE AC-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'AC' INTERBRANCH" TO PASSWDW-PROMPT2
      *          PERFORM PASSWORD-MUST-EXIST
                 PERFORM VERIFY-PASSWORD
                 IF ( PASSWDW-STAT NOT = "OK" )
                    GO TO BAR-CD-ENTRY-RTN.

      *-----------------------------------------------------------------

           IF LP-TRCD = "PL" OR "P2"
              IF ( POSTING-INTERBRANCH )
                 MOVE PLP2-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'PL', 'P2' INTERBRANCH"
                                          TO PASSWDW-PROMPT2     
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "OPTION NOT ALLOWED INTERBRANCH" TO MESS
                    PERFORM SEND-MESS
                    GO TO BAR-CD-ENTRY.


      *-----------------------------------------------------------------

      *<X> IF LP-TRCD = "PO" OR "SC" OR "PB" OR "RN" OR "RB" OR "RO"
           IF LP-TRCD = "PO"
              IF LN-OT2BAL NOT = 0
                 MOVE "OTHER 2 BALANCE EXISTS, NOT ALLOWED!" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF (LP-TRCD = "PO" OR "PB" OR "RN" OR "RB" OR "RO")
              IF (LN-ESCROW-FG = "Y" OR LN-ESCROW-FG = "I")
                 PERFORM OPEN-ES1-FILE
                 MOVE LN-ACCTNO TO ES-ACCTNO
                 PERFORM READ-ES1-FILE
                 PERFORM CLOSE-ES1-FILE
                 IF IO-BAD
                    MOVE "ACCOUNT MISSING ESCROW RECORD!" TO MESS
                    PERFORM SEND-MESS
                    MOVE "X" TO ERRCD
                    GO TO END-ROUTINE
                 ELSE IF ES-BALANCE > 0
                    MOVE "ESCROW SCHEDULE HAS A BALANCE." TO MESS
                    PERFORM SEND-MESS
                    MOVE
                      "PLEASE POST 'ED' TO REFUND ESCROW BEFORE PAYOFF."
                       TO MESS
                    GO TO BAR-CD-ENTRY-RTN
                 ELSE IF ES-BALANCE < 0
                    MOVE
                    "ESCROW SCHEDULE HAS A NEGATIVE BALANCE." TO MESS
                    PERFORM SEND-MESS
                    MOVE
                      "ESCROW BALANCE MUST BE ZERO BEFORE PAYOFF."
                       TO MESS
                    GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "DC"
              IF NOT (LN-UNITPER-CD = "M" AND LN-UNITPER-FREQ = 1)
                 MOVE
            "DUE DATE CHANGE, ONLY ALLOWED FOR MONTHLY PAY PERIODS"
                                                        TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
                 MOVE LP-TRDATE TO DUEDA-TRANS-DATE
                 PERFORM DUE-DATE-CHANGE-TEST
                 IF DUEDA-ALLOWED = "N"
                    MOVE "DUE DATE CHANGE IS NOT ALLOWED TODAY" TO MESS
                    GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "TP"
              IF LN-SERVACCT NOT = "Y"
                 MOVE "ACCOUNT MUST BE SERVICED" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "TP" AND (LN-REPOCD = "X" OR "S")
              MOVE "CAN NOT 'TP' A REPO" TO MESS
              GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "TS" AND (LN-REPOCD = "X" OR "S")
              MOVE "CAN NOT 'TS' A REPO" TO MESS
              GO TO BAR-CD-ENTRY-RTN.

            IF LP-TRCD = "TS"
               IF SP-1098FRMLA = "B"
                  MOVE "INT. COMPUTED USING UNEARNED METHOD - CANNOT BE
      -             "SERVICED" TO MESS
                  GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "RN" OR "SC" OR "PB" OR "TS" OR "RB" OR "RO"
              IF LN-SERVACCT = "Y"
                 MOVE "ACCOUNT MUST BE OWNED, AND NOT SERVICED!"
                                                                TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

      * TEST FOR PASSWORD PROTECTION ON LOAN 'RB' OR 'RO' TRANSACTIONS
           IF (LN-SALEFIN = "N") AND (LP-TRCD = "RB" OR "RO")
              MOVE LN-RB-RO-SEQ TO PASSWDW-SEQ
              MOVE "TO POST RENEWAL" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD PROTECTION ON SALES 'RB' OR 'RO' TRANSACTIONS
           IF (LN-SALEFIN = "Y") AND (LP-TRCD = "RB" OR "RO")
              MOVE SF-RB-RO-SEQ TO PASSWDW-SEQ
              MOVE "TO POST RENEWAL" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD PROTECTION ON SALES 'PB' OR 'RN' TRANSACTIONS
           IF (LN-SALEFIN = "Y") AND (LP-TRCD = "PB" OR "RN")
              MOVE SF-PB-RN-SEQ TO PASSWDW-SEQ
              MOVE "TO POST RENEWAL" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD PROTECTION ON RN TRANSACTIONS
           IF LP-TRCD = "RN"
              MOVE RN-SEQ TO PASSWDW-SEQ
              MOVE "TO POST A RENEWAL" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD PROTECTION ON TS TRANSACTIONS
           IF LP-TRCD = "TS"
              MOVE TS-SEQ TO PASSWDW-SEQ
              MOVE "TO TRANSFER TO SERVICE" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD TO NOT ALLOW 'PB' LOANS LESS OR EQUAL TO 1STPYDATE
      * 1STPYDATE = 9/23/14, PASSWORD REQUIRED IF PB IS 9/23 AND PRIOR
           IF LP-TRCD = "PB" 
              IF LP-PAYDATE NOT > LN-1STPYDATE
                 MOVE PB-PRIOR-1STPAY-SEQ TO PASSWDW-SEQ
                 MOVE "TO 'PB' A LOAN PRIOR TO 1STPAY" TO 
                                                   PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD TO NOT ALLOW 'PB' LOANS UNTIL LOAN IS 91 DAYS OLD
      * SUNBELT PR# 1368 12/7/00
      * 12/19/00 PR# 1387 CHANGED TO TEST 3 MONTHS AND 1 DAY INSTEAD OF 91 DAYS
           IF LP-TRCD = "PB" OR "RN"
              MOVE LN-LOANDATE TO NUM-DATE
              MOVE LP-PAYDATE TO SYS-DATE
              PERFORM TIM360
              IF (ELAPSED-MONTHS < 3) OR
                  (ELAPSED-MONTHS = 3 AND ELAPSED-REM < 1)
                 MOVE PB-91-SEQ TO PASSWDW-SEQ
                 MOVE "TO 'PB' A LOAN WITHIN 3MO 1DAY" 
                                            TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-CD-ENTRY.

      * GEORGIA SC 90 DAYS RESTRICTION:
           IF LP-TRCD = "SC"
              IF SP-RBSPOPT1(7) = 6
                 MOVE LN-PURDATE TO NUM-DATE
                 MOVE LP-PAYDATE TO SYS-DATE
                 PERFORM TIM
                 IF ELAPSED-DAYS NOT > 90
                    MOVE "90 DAYS HAVE NOT ELAPSED SINCE PURCHASE"
                                                        TO MESS
                    PERFORM SEND-MESS
                    GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "TS" OR "TP" OR "RN" OR "SC" OR "PB"
                           OR "RB" OR "RO"
              IF LN-PLCD NOT = " "
                 MOVE "ACCOUNT IS P&&L, CODE NOT ALLOWED" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "SC" OR "TS" OR "TP"
              IF LN-SALEFIN NOT = "Y"
                 MOVE "A/C NOT SALES FINANCE" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.


           IF LP-TRCD = "PA"
              IF BR-ALLOTMNTS = "Y"
                 IF NOT (LN-ALLOTCD = "Y" OR LN-LBOX = "Y")
                    STRING
                    "ACCOUNT NOT UNDER AN ALLOTMENT "
                    "OR LOCK BOX TYPE PLAN          "
                     DELIMITED BY SIZE INTO MESS
                    PERFORM SEND-MESS.

           IF LP-TRCD = "JD"
              IF LN-JDDATE NOT = 0
                 MOVE "ALREADY UNDER JUDGEMENT" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "AC"
              IF LN-ACCELDATE NOT = 0
                 MOVE "ALREADY ACCELERATED" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           MOVE LP-PAYDATE TO IBPC-DATE.
           PERFORM IBPC-TEST.

      * SEE IF TEST IS REQUIRED FOR INT, SC OR MF REBATES:
      * IS ACCOUNT PC AND EXPIRING ON THIS POSTING?
      * IS ACCOUNT GOING TO SIMPLE INTEREST?
      * IS ACCOUNT EXPIRING ON ORIGINAL MATURITY
      * AND THERE ARE DEFERMENTS, WHICH MAY ALLOW FOR REBATES?
           IF LP-TRCD = "RV" OR "RI" OR "RS" OR "RM"
                OR (NOT (IBPC-FG = "P" AND IBPC-EXPIRED-FLAG = "E"))
                 OR SP-EXPR-FRMLA-CONT
                  OR SP-EXPD-FRMLA = " "
                   OR (SP-EXPD-FRMLA = "A" AND LN-TOTNODEF = 0)
              GO TO VERIFY-CONT-GA.

           PERFORM CALL-PAYOFF.
           MOVE WK-SAVE-RECORD TO LN-REC.

           IF PASS-INT-REB NOT = 0
              IF NOT (LN-INT-REBATE = "Y" OR "R")
                 MOVE "INTEREST MUST BE REBATED BEFORE EXPIRING"
                                                            TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF PASS-SC-REB NOT = 0
              IF NOT (LN-SC-REBATE = "Y" OR "R")
                 MOVE "SERVICE CHG MUST BE REBATED BEFORE EXPIRING"
                                                            TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF PASS-MF-REB NOT = 0
              IF NOT (LN-MF-REBATE = "Y" OR "R")
                 MOVE "MAINT. FEE MUST BE REBATED BEFORE EXPIRING"
                                                            TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

      * TEST FOR GEORGIA SERVICE CHARGE REBATE FRMLA:
       VERIFY-CONT-GA.
           IF IBPC-FG = "P" AND LP-TRCD = "RS"
              IF SP-RBFRMLA(8) = "H"
                 IF LN-INT-REBATE NOT = "Y" AND NOT = "R"
                    MOVE
               "MUST REBATE INTEREST, BEFORE REBATING SERVICE CHARGE"
                                                                TO MESS
                    GO TO BAR-CD-ENTRY-RTN.



      ******************************************
      *          P&L   CODES
      *
      *    PL -   ....GO TO ACTIVE P&L:
      *            LN-PLCD = " "  TO  "P"
      *    P2-P3  ....GO TO ACTIVE P&L:
      *            LN-PLCD = " "  TO  "P"
      *            LN-PLTYPE " "  TO  "P/2/3/4/5"
      *    P4-P5  ....GO TO ACTIVE P&L:
      *            LN-PLCD = " "  TO  "P"
      *            LN-PLTYPE " "  TO  "P/2/3/4/5"
      *            AND WILL TAP DELAER RESERVE FOR P&L EXPENSE
      *    PI -   ....GO TO INACTIVE P&L:
      *            LN-PLCD = "P"  TO  "I"
      *    PW -   ....GO TO P&L WRITE OFF:
      *            LN-PLCD = "I"  TO  "W"
      *    SE -   ....SHIFT EXPENSE TO NEW AR
      *           LN-PLTYPE 2-3 ONLY
      ******************************************
           IF LN-PLCD = " "
              IF LP-TRCD = "PI"
                 MOVE "ACCOUNT MUST BE ACTIVE P&&L" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
               ELSE
                 IF LP-TRCD = "PW"
                    MOVE "ACCOUNT MUST BE INACTIVE P&&L" TO MESS
                    GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "PW"
              IF POSTING-INTERBRANCH
                 MOVE PW-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'PW' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF ( PASSWDW-STAT NOT = "OK" )
                     MOVE "OPTION NOT ALLOWED INTERBRANCH" TO MESS
                     PERFORM SEND-MESS
                     GO TO BAR-CD-ENTRY.

           IF LP-TRCD = "PI"
              IF POSTING-INTERBRANCH
                 MOVE PI-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'PI' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF ( PASSWDW-STAT NOT = "OK" )
                     MOVE "OPTION NOT ALLOWED INTERBRANCH" TO MESS
                     PERFORM SEND-MESS
                     GO TO BAR-CD-ENTRY
                 END-IF
              ELSE
                 MOVE PI-SEQ TO PASSWDW-SEQ
                 MOVE "FOR INACTIVE P&L " TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF ( PASSWDW-STAT NOT = "OK" )
                       GO TO BAR-CD-ENTRY
                 ELSE
                 IF LN-PLTYPE = "2" OR "3" OR "4" OR "5"
                      IF LN-STATE-WORKER NOT = 0
                         SUBTRACT LN-STATE-WORKER2 FROM
                          LN-STATE-WORKER GIVING WORKER-PI
                                      PL-NEWAR-MESS-AMT
                             IF WORKER-PI > 0
                               MOVE PL-NEWAR-MESS TO MESS
      * SEE IF ACCOUNT CAN GO TO INACTIVE P&L WITH REMAINING
      * SHIFTED EXPENSE BALANCE
                              IF GP-ALLOW-PI-WITH-SE-BAL NOT = "Y"
                                 GO TO BAR-CD-ENTRY-RTN
                              ELSE
                                 PERFORM SEND-MESS.

           IF LN-BNKRPTDATE NOT = 0
              IF LP-TRCD = "BK"
                 MOVE "ACCOUNT IS ALREADY IN BANKRUPT STATUS" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF LN-BNKRPTDATE = 0
              IF LP-TRCD = "BD"
                 MOVE "ACCOUNT IS NOT IN BANKRUPT STATUS" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF LN-PLCD = "P"
              IF LP-TRCD = "PL" OR "P2" OR "P3" OR "P4" OR "P5"
                 MOVE "ACCOUNT IS ALREADY ACTIVE P&&L" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
                 IF LP-TRCD = "PW"
                    MOVE "ACCOUNT MUST BE INACTIVE P&&L" TO MESS
                    GO TO BAR-CD-ENTRY-RTN.

           IF LN-PLCD = "I"
              IF LP-TRCD NOT = "PW"
                 MOVE "ACCOUNT IS INACTIVE P&&L" TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

           IF LN-PLCD = "W"
              MOVE "NO POSTING ALLOWED, P&&L WRITE OFF !!!" TO MESS
              GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "PL" OR "P2" OR "P3" OR "P4" OR "P5"
              IF LN-PURBAL NOT = 0
                 IF LN-PURBAL NOT = LN-CURBAL
                    MOVE "REDUCE THE PURCHASE BAL TO 0 FIRST" TO MESS
                    GO TO BAR-CD-ENTRY-RTN.

            IF LP-TRCD = "P2" OR "P3" OR "P4" OR "P5"
               MOVE LP-TRCD     TO TRCD-WORKER
               MOVE "PX"        TO CD-TYPE
               MOVE TRCD-PLTYPE TO CD-CODE
               PERFORM GET-CD
               IF IO-FG = 9
                  MOVE "P&&L TYPE IS NOT DEFINED" TO MESS
                  GO TO BAR-CD-ENTRY-RTN.

            IF LP-TRCD = "P4" OR "P5"
               IF LN-SALEFIN NOT = "Y"
                  MOVE "CAN'T TAP DEALER RESERVE ON DIRECT LOANS!"
                                                             TO MESS
                  GO TO BAR-CD-ENTRY-RTN.

            IF LP-TRCD = "P4" OR "P5"
               IF LN-SERVACCT = "Y"
                  MOVE "CAN'T TAP DEALER RESERVE ON SERVICE ACCOUNTS!"
                                                             TO MESS
                  GO TO BAR-CD-ENTRY-RTN.

            IF LP-TRCD = "PL" OR "P2" OR "P3" OR "P4" OR "P5"
               IF LN-REPOCD = "X"
                  IF GP-ALLOW-PL-ON-SX NOT = "Y"
                     MOVE "ACCOUNT MUST BE A SOLD REPOSESSION!" TO MESS
                     GO TO BAR-CD-ENTRY-RTN.

            IF LP-TRCD = "RE"
               IF GP-REPO-CODE NOT = "A"
                  MOVE "MUST HAVE REPO OPTIONS TURNED ON" TO MESS
                  GO TO BAR-CD-ENTRY-RTN
               ELSE
               IF NOT (LN-REPOCD = "X" OR "S")
                  MOVE "ACCOUNT MUST BE A REPOSESSION!" TO MESS
                  GO TO BAR-CD-ENTRY-RTN.

            IF LP-TRCD = "RE"
               IF POSTING-INTERBRANCH
                  MOVE RE-SEQ-INTERBRANCH TO PASSWDW-SEQ
                  MOVE "TO POST 'RE' INTERBR" TO PASSWDW-PROMPT2       
                  PERFORM PASSWORD-MUST-EXIST
                  IF PASSWDW-STAT NOT = "OK"
                     MOVE "OPTION NOT ALLOWED INTERBRANCH" TO MESS
                     GO TO BAR-CD-ENTRY-RTN.


            IF LP-TRCD = "P4"
               IF LN-REPOCD NOT = "S"
                  MOVE "ACCOUNT MUST BE A REPOSESSION!" TO MESS
                  GO TO BAR-CD-ENTRY-RTN.

            IF LP-TRCD = "P5"
               IF LN-REPOCD = "X" OR "S"
                  MOVE "ACCOUNT IS A REPOSESSION, USE 'P4'!" TO MESS
                  GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "PX"
              IF LN-PLCD NOT = " "
                 MOVE "PARTIAL CHARGEOFF NOT ALLOWED, ACCOUNT IS P&&L"
                                                              TO MESS
                 GO TO BAR-CD-ENTRY-RTN.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * TEST FOR PASSWORD PROTECTION ON LOAN 'PX' TRANSACTIONS
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF ( LP-TRCD = "PX" )
              IF POSTING-INTERBRANCH
                 MOVE PX-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'PX' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF (PASSWDW-STAT NOT = "OK")
                    MOVE "OPTION NOT ALLOWED INTERBRANCH" TO MESS
                    PERFORM SEND-MESS
                    GO TO BAR-CD-ENTRY
                 END-IF
              ELSE
                 MOVE PX-SEQ                      TO PASSWDW-SEQ
                 MOVE "TO POST PARTIAL CHARGEOFF" 
                                           TO  PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF ( PASSWDW-STAT NOT = "OK" )
                    GO TO BAR-CD-ENTRY.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF LP-TRCD = "SE"
              IF LN-PLCD  = " "
                 MOVE "ACCOUNT MUST BE P&&L, CODE NOT ALLOWED" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
              IF LN-PLCD NOT = "P"
                 MOVE "ACCOUNT IS NOT ACTIVE P&&L, CODE NOT ALLOWED"
                                                          TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
              IF NOT (LN-PLTYPE = "2" OR "3")
                 MOVE
                 "ACCOUNT MUST BE P&&L TYPE P2 OR P3" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
                 MOVE SE-SEQ TO PASSWDW-SEQ
                 MOVE "TO SHIFT P&&L RECEIVABLE" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-CD-ENTRY.

      * REGACC, IF ACCOUNT IN "REPO ON HAND" OR "REPO SOLD" STATUS, FORCE
      * THE USER TO USE THE REPO DATE AS THE EFFECTIVE DATE FOR ANY REBATES.
           IF GP-REPO-CODE = "A"
              IF LP-TRCD = "RC" OR "RA" OR "RP" OR "R1" OR "R2" OR "R3"
                                 OR "RI" OR "RS" OR "RM" OR "RD"
                 IF LN-REPOCD = "X" OR "S"
                    IF LP-PAYDATE NOT = LN-REPODATE
                       MOVE REPO-EFF-SEQ TO PASSWDW-SEQ
                       MOVE "TO ACCEPT REPO REBATE DATE" TO
                                            PASSWDW-PROMPT2
                       PERFORM VERIFY-PASSWORD
                       IF PASSWDW-STAT NOT = "OK"
                          MOVE "MUST USE REPO DATE FOR REFUNDS" TO MESS
                          GO TO BAR-CD-ENTRY-RTN.


           IF LP-TRCD = "SX" OR "ZX"
              IF LN-REPOCD = "X"
                 MOVE "ACCOUNT IS ALREADY IN REPOSESSION STATUS" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
              IF LN-REPOCD = "S"
                 MOVE "REPOSESSED ITEM WAS SOLD!" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
              IF (LN-PLCD  NOT = " " AND GP-ALLOW-REPO-ON-PL NOT = "Y")
                 MOVE "ACCOUNT IS P&&L, REPO NOT ALLOWED" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
              IF BR-AC-BEFORE-REPO NOT = "N"
                     AND IBPC-FG = "P"
                     AND LN-ACCELDATE = 0
                 MOVE "ACCOUNT MUST BE ACCELERATED BEFORE SETTING REPO"
                                                                 TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
              IF BR-RI-BEFORE-REPO NOT = "N"
                    AND IBPC-FG = "P"
                     AND (NOT (LN-INT-REBATE = "Y" OR "R"))
                 MOVE "INTEREST MUST BE REBATED BEFORE SETTING REPO"
                                                                 TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
              IF POSTING-INTERBRANCH
                 MOVE SX-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST INTERBR 'SX' " TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                   MOVE "OPTION NOT ALLOWED INTERBRANCH" TO MESS
                   PERFORM SEND-MESS
                   GO TO BAR-CD-ENTRY
                 END-IF
              ELSE
                 MOVE SX-SEQ TO PASSWDW-SEQ
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD ON SX OR ZX DATE PRIOR TO TRANSACTION DATE
           IF LP-TRCD = "SX" OR "ZX"
              IF TRANS-DATE > LP-PAYDATE
                 MOVE SX-BACKDATE-SEQ TO PASSWDW-SEQ
                 MOVE "TO BACKDATE 'SX' TRANSACTION"
                      TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-CD-ENTRY.

      * TEST FOR PASSWORD ON PL DATE PRIOR TO TRANSACTION DATE
           IF LP-TRCD = "PL"
              IF TRANS-DATE > LP-PAYDATE
                 MOVE PL-BACKDATE-SEQ TO PASSWDW-SEQ
                 MOVE "TO BACKDATE 'PL' TRANSACTION"
                      TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-CD-ENTRY.

      *    -------------------------------------------------------------
      *    DON'T ALLOW BACKDATING ON RATE TYPE 'Z' LOANS
      *
      *    U N L E S S  ENVIRONMENT VARIABLE "BACKDATING_Z" EXISTS
      *    -------------------------------------------------------------
           IF SP-CAL-RATETYPE(1) = 'Z'
              IF TRANS-DATE > LP-PAYDATE
                 MOVE "BACKDATING_Z" TO GETENV-BUF
                 PERFORM GETENV-CALL
                 IF STAT NOT = "00"
                    MOVE " " TO MESS
                    STRING "BACKDATING NOT ALLOWED FOR MORTGAGE "
                           "TYPE 'Z' INTEREST ACCOUNTS!"
                    DELIMITED BY SIZE INTO MESS
                    GO TO BAR-CD-ENTRY-RTN.

           IF LP-TRCD = "PA" OR "WL" OR "WI" OR "WO" OR
                        "DC" OR "OP" OR "RP" OR "R1" OR "R2" OR "R3"
              IF POSTING-INTERBRANCH
                 MOVE PR238-SEQ-INTERBR TO PASSWDW-SEQ
                 MOVE "TO POST '##' INTERBRANCH" TO PASSWDW-PROMPT2
                 INSPECT PASSWDW-PROMPT2 REPLACING ALL "##" BY LP-TRCD
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "## NOT ALLOWED INTERBRANCH" TO MESS
                    INSPECT MESS REPLACING ALL "##" BY LP-TRCD
                    PERFORM SEND-MESS
                    GO TO BAR-CD-ENTRY.

      *    -------------------------------------------------------------


           IF LP-TRCD = "SX" OR "ZX"
              IF GP-REPO-CODE = "A"
                 MOVE LN-OWNBR  TO LSX-BRNO
                 MOVE LN-ACCTNO TO LSX-ACCTNO
                 MOVE 1         TO LSX-SEQNO
                 PERFORM OPEN-LSX1-FILE
                 PERFORM READ-LSX1-FILE
                 PERFORM CLOSE-LSX1-FILE
                 IF (IO-BAD)
                    MOVE "MUST CREATE REPO TRAILER INFO" TO MESS
                    GO TO BAR-CD-ENTRY-RTN
                 ELSE
                    IF (LSX-VOLUNTARY-FG = SPACES) OR
                       (LSX-REASON-CODE = SPACES) OR
                       (LSX-REASON = SPACES) OR
                       (LSX-REPODATE = 0) OR
                       (LSX-REDEEM-DATE = 0) OR
                       (LSX-AGENT-PHONE = 0) OR
                       (LSX-AGENT-FAX = 0) OR
                       (LSX-DISPOSAL-HOLD = SPACES) OR
                       (LSX-COLLATERAL-LOCATION = SPACES) OR
                       (LSX-Y-ASSIGNED-TO = SPACES) OR
                       (LSX-SUPPLIER-ID = 0) OR
                       (LSX-STORED-LOCATION = SPACES) OR
                       (LSX-STORED-ADDRESS = SPACES) OR
                       (LSX-Y-STORED-CITY = SPACES) OR
                       (LSX-Y-STORED-STATE = SPACES) OR
                       (LSX-Y-STORED-ZIP = SPACES) OR
                  (BW-STATE = "CA" AND LSX-AGENCY-NAME = SPACES) OR
                  (BW-STATE = "CA" AND LSX-AGENCY-PHONE = 0) OR
                  (BW-STATE = "CA" AND LSX-AGENCY-ADDRESS = SPACES) OR
                  (BW-STATE = "CA" AND LSX-AGENCY-CITY = SPACES) OR
                  (BW-STATE = "CA" AND LSX-AGENCY-STATE = SPACES) OR
                  (BW-STATE = "CA" AND LSX-AGENCY-ZIP = SPACES)
                          PERFORM MISSING-REPO-X-INFO
                          GO TO BAR-CD-ENTRY.

      *
      *    IF LP-TRCD = "SX" OR "ZX"
      *       IF GP-REPO-CODE = "A"
      *          PERFORM CHECK-FOR-REINSTATE.

           IF LP-TRCD = "SV"
              IF LN-REPOCD NOT = "X"
                 MOVE "ACCOUNT IS NOT IN REPOSSESSION STATUS" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
              IF (LN-PLCD  NOT = " " AND GP-ALLOW-REPO-ON-PL NOT = "Y")
                 MOVE "ACCOUNT IS P&&L, 'SV' IS NOT ALLOWED" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
              IF POSTING-INTERBRANCH
                 MOVE SV-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO POST 'SV' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "OPTION NOT ALLOWED INTERBRANCH" TO MESS
                    PERFORM SEND-MESS
                    GO TO BAR-CD-ENTRY
                 END-IF
              ELSE
                 MOVE SV-SEQ TO PASSWDW-SEQ
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-CD-ENTRY.


           IF LP-TRCD = "BD"
              MOVE BD-SEQ TO PASSWDW-SEQ
              MOVE "TO REMOVE BANKRUPT STATUS" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    TRANSACTION CODE OF 'SS'
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF ( LP-TRCD = "SS" )
              IF ( LN-REPOCD NOT = "X" )
                 MOVE "ACCOUNT IS NOT IN REPOSESSION STATUS" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
                 IF ( POSTING-INTERBRANCH )
                    MOVE SS-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 ELSE
                    MOVE SS-SEQ-STANDARD    TO PASSWDW-SEQ
                 END-IF
                 MOVE "TO POST 'SS' SOLD TRANSACTION" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF ( PASSWDW-STAT NOT = "OK" )
                    GO TO BAR-CD-ENTRY.

      *- - - - -- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    CHECKING IF MULTIPLE DEFERMENTS ALLOWED:
      *    NO MULITPLE DEFERMENTS (D2 - D9) FOR DEFERMENT FORMULA OF 9 OR 97
      *    OR 96
      *- - -- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

           IF ( SP-DEFFRMLA = 9 OR 97 OR 96 ) AND
              ( LP-TRCD = "D2" OR "D3" OR "D4" OR "D5" OR
                          "D6" OR "D7" OR "D8" OR "D9" )
              MOVE "MULTIPLE DEFERMENTS NOT ALLOWED" TO MESS
              GO TO BAR-CD-ENTRY-RTN.

      ******************************************************************
      ********************  VALIDATE DEFERMENTS  ***********************
      ******************************************************************
           IF LP-TRCD = "DF" OR "D2" OR "D3" OR "D4" OR "D5"
                             OR "D6" OR "D7" OR "D8" OR "D9"
              MOVE DF-SEQ TO PASSWDW-SEQ
              MOVE "TO POST A DEFERMENT TO THIS ACCOUNT" TO
                                             PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY
              ELSE
                MOVE LP-TRCD TO DEFPOL-TRCD
                MOVE TRANS-DATE TO DEFPOL-DATE
                PERFORM VALIDATE-DF-POLICY
                IF DEFPOL-MAXIMUM = "X"
                   MOVE "DEFERMENTS WILL EXCEED ORIGINAL TERM" TO MESS
                   GO TO BAR-CD-ENTRY-RTN
                ELSE
      * REGACC PR# 162
                IF DEFPOL-MAXIMUM = "R"
                   MOVE "MISSING LR FILE" TO MESS
                   PERFORM SEND-MESS
                   MOVE DF-REG-SEQ TO PASSWDW-SEQ
                   MOVE "TO OVERRIDE MINIMUM MONTHS" TO
                                                    PASSWDW-PROMPT2
                   PERFORM PASSWORD-MUST-EXIST-AND-FLAGGED
                   IF PASSWDW-STAT NOT = "OK"
                      GO TO BAR-CD-ENTRY
                   END-IF

                ELSE
                IF DEFPOL-MAXIMUM = "1"
                   MOVE "MINIMUM XMONTHS HAVE NOT ELAPSED" TO MESS
                   PERFORM SEND-MESS
                   MOVE DF-REG-SEQ TO PASSWDW-SEQ
                   MOVE "TO OVERRIDE MINIMUM MONTHS" TO
                                                 PASSWDW-PROMPT2
                   PERFORM PASSWORD-MUST-EXIST-AND-FLAGGED
                   IF PASSWDW-STAT NOT = "OK"
                      GO TO BAR-CD-ENTRY
                   END-IF
                ELSE
                IF DEFPOL-MAXIMUM = "D"
                   MOVE "DF  MONTHS HAVE NOT ELAPSED" TO MESS
                   PERFORM SEND-MESS
                   MOVE DF-REG-SEQ TO PASSWDW-SEQ
                   MOVE "TO OVERRIDE 'DF' MONTHS   " TO
                                                  PASSWDW-PROMPT2
                   PERFORM PASSWORD-MUST-EXIST-AND-FLAGGED
                   IF PASSWDW-STAT NOT = "OK"
                       GO TO BAR-CD-ENTRY
                   END-IF
                ELSE
                IF DEFPOL-MAXIMUM = "2"
                   MOVE "D2  MONTHS HAVE NOT ELAPSED" TO MESS
                   PERFORM SEND-MESS
                   MOVE DF-REG-SEQ TO PASSWDW-SEQ
                   MOVE "TO OVERRIDE 'D2' MONTHS   " TO
                                                  PASSWDW-PROMPT2
                   PERFORM PASSWORD-MUST-EXIST-AND-FLAGGED
                   IF PASSWDW-STAT NOT = "OK"
                       GO TO BAR-CD-ENTRY
                   END-IF
                ELSE
                IF DEFPOL-MAXIMUM = "Y"
                   PERFORM DF-EXCEED-MAX
                      IF DF-ANSWER NOT = "Y" OR
                        ((SP-DEFPOLCD = " "  OR SP-DEFPOLCD = "B")
                                  AND SP-DEFPOLMX(1) = 0
                                  AND SP-DEFPOLMX(2) = 0)
                      GO TO BAR-CD-ENTRY.

           IF GP-DEFERMENT-APPROVAL = "Y"
              IF LP-TRCD = "DF" OR "D2" OR "D3" OR "D4" OR "D5"
                                OR "D6" OR "D7" OR "D8" OR "D9"
                 PERFORM VERIFY-DEFERMENT-APPROVAL
                 IF DEFERMENT-APPROVED = "N"
                    GO TO BAR-CD-ENTRY
                 ELSE
                    MOVE "S  A050030." TO VDU
                    MOVE LSP-REASON-CODE TO VDUBUF LP-REFNO
                    PERFORM SCREENIO.

      *-----------------------------------------------------------------
      *
      *    VERIFY DEFERMENT 'X'
      *
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * KEC 2000.0608 {PR#00229} MERCURY FINANCE [CINDY SHAFFER]
      * JTG 2000.0710 {PR#00229} MERCURY FINANCE [CINDY SHAFFER]
      *                CORRECTED LOGIC TO BYPASS TEST IF ACCOUNT
      *                IS IN 'IB' STATUS
      *
      *   THIS VERIFICATION IS FOR IF POSTING A "RI" TRANSACTION OR
      *   "PL" TRANSACTION (WITH AUTO REFUND/ACCELERATE P&L SET TO "Y")
      *   WITH A DEFERMENT REBATE FORMULA "X", THE DEFERMENT MUST BE
      *   REBATED BEFORE A "RI" OR "PL" TRANSACTION CAN HAPPEN.
      *
      *-----------------------------------------------------------------
       VERIFY-DEFERMENT-X.

      *- - - - - - - - - - - - - - - - - - - - - - - - -{ CHECK CODES  }
           IF ( SP-RBFRMLA(10) NOT = "X"      ) OR
              ( IBPC-FG = "I"                 ) OR
              ( ( LP-TRCD    NOT = "RI" ) AND
                ( LP-TRCD    NOT = "PL" )
              )
              GO TO VERIFY-DEFERMENT-X-SKIP.

      *- - - - - - - - - - - - - - - - - - - - - - -{ CHECK DEFERMENTS }
           IF ( LN-DF-REBATE = "Y"    ) OR
              ( LN-TOTDEF    = ZEROES )
              GO TO VERIFY-DEFERMENT-X-SKIP.

      * CHECK AUTO REFUND FLAGS
      * ALL FLAG VALUES INCLUDE THE "PL"
           IF ( LP-TRCD = "PL" ) AND
              ( BR-AUTO-PL-REF-AC NOT = "Y" AND
                                   NOT = "2" AND
                                    NOT = "3")
              GO TO VERIFY-DEFERMENT-X-SKIP.

      * P2 ONLY AUTO WITH '2', OR '3'
           IF ( LP-TRCD = "P2" ) AND
              ( BR-AUTO-PL-REF-AC NOT = "2" AND
                                   NOT = "3")
              GO TO VERIFY-DEFERMENT-X-SKIP.

      * P3 ONLY AUTO WITH '3'
           IF ( LP-TRCD = "P3" ) AND
              ( BR-AUTO-PL-REF-AC NOT = "3")
              GO TO VERIFY-DEFERMENT-X-SKIP.

      *- - - - - - - - - - - - - - - - - - - - - - - -{ CHECK MATURITY }
           MOVE LPLOAN-SYSDATE TO ALP-DATE.
           PERFORM CONVERT-ALPDATE-TO-YYYYMMDD.
           PERFORM MATURITY-DATE-CALCULATION.
           IF DATE-YYYYMMDD NOT < MDTE-DATE
              GO TO VERIFY-DEFERMENT-X-SKIP.

      *- - - - - - - - - - - - - - - - -{ MUST REBATE DEFERMENT FIRST  }

           STRING "MUST REFUND DEFERMENTS BEFORE POSTING A '",
                  LP-TRCD, "'"
                  DELIMITED BY "  " INTO MESS.

           GO TO BAR-CD-ENTRY-RTN.

      *-----------------------------------------------------------------
       VERIFY-DEFERMENT-X-SKIP.

           GO TO BAR-CD-CONTINUE.

      *-----------------------------------------------------------------
       BAR-CD-ENTRY-RTN.
           PERFORM SEND-MESS.
           GO TO BAR-CD-ENTRY.

       BAR-CD-CONTINUE.
           PERFORM CLEAR-LEGEND.
           IF LP-TRCD = "CA" AND LN-MIP-FG NOT = "Y"
              MOVE "THIS WILL CANCEL A&H INSURANCE" TO MESS
              PERFORM SEND-MESS.
       BAR-REF-ENTRY.
           IF LP-TRCD = "PU" OR "AV"
              GO TO BAR-CURBAL-CHECK.
           IF LP-TRCD = "PA" AND LN-LBOX = "Y"
              MOVE "S  A050030." TO VDU
              MOVE "LBOX"        TO VDUBUF
                                    LP-REFNO
              PERFORM SCREENIO.

           IF LP-TRCD = "CC" OR "CA"
              GO TO BAR-REFNO-CCCA
           ELSE
           IF LP-TRCD = "TS" OR "TP"
              GO TO BAR-REFNO-TSTP
           ELSE
              IF LP-TRCD = "DF" OR "D2" OR "D3" OR "D4"
                        OR "D5" OR "D6" OR "D7" OR "D8" OR "D9"
                 IF SP-DEFPERCD = 4
                    GO TO BAR-REFNO-DF.
       BAR-REF-ENTRY-NORMAL.
           IF LP-TRCD = "SP"
              MOVE "ENTER POOL ID, F6-SCAN" TO MESS
              PERFORM SEND-LEGEND
              PERFORM ALARM
              MOVE "ENNN050030." TO VDU
           ELSE
           IF LP-TRCD = "DC"
              MOVE DC-SEQ TO PASSWDW-SEQ
              MOVE "TO CHANGE ACCOUNT'S DUE DAY" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY
              ELSE
                 MOVE "ENTER NEW DUE DAY" TO MESS
                 PERFORM SEND-LEGEND
                 PERFORM ALARM
                 MOVE "ENNN050030." TO VDU
           ELSE
           IF LP-TRCD = "BK"
              MOVE BK-SEQ TO PASSWDW-SEQ
              MOVE "TO MAKE THIS ACCT BANKRUPT STATUS" 
                                             TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY
              ELSE
                 MOVE "ENTER BANKRUPT CHAPTER (7, 11, 12, 13, 28)"
                                                   TO MESS
                 PERFORM SEND-LEGEND
                 PERFORM ALARM
                 MOVE "ENNN050030." TO VDU
           ELSE
           IF LP-TRCD = "PL"
              MOVE PL-SEQ TO PASSWDW-SEQ
              MOVE "TO MAKE THIS ACCT P&L STATUS" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY
              ELSE
                 MOVE "E  A050030." TO VDU
           ELSE
           IF LP-TRCD = "P2" OR "P3"
              MOVE LP-TRCD     TO TRCD-WORKER
              MOVE "PX"        TO CD-TYPE
              MOVE TRCD-PLTYPE TO CD-CODE
              PERFORM GET-CD
              IF IO-FG = 9
                 MOVE "P&&L TYPE IS NOT DEFINED" TO MESS
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
                 IF LP-TRCD = "P2"
                    MOVE P2-SEQ TO PASSWDW-SEQ
                 ELSE
                    MOVE P3-SEQ TO PASSWDW-SEQ
                 END-IF
                 MOVE "TO MAKE THIS ACCOUNT P&L STATUS"
                                      TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT= "OK"
                    GO TO BAR-CD-ENTRY
                 ELSE
                    PERFORM ALARM
                    MOVE "E  A050030." TO VDU
           ELSE
           IF LP-TRCD = "PA"
              MOVE PA-SEQ TO PASSWDW-SEQ
              MOVE "TO POST ALLOT/LBOX PAYMENTS"
                                      TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO BAR-CD-ENTRY
              ELSE
                 MOVE "E  A050030." TO VDU
           ELSE
           IF LP-TRCD = "PR" OR "PC" OR "PP"
              PERFORM DLRVNO-ENTRY
              IF VDUSTATUS = "10" OR = "1U"
                 GO TO BAR-ENTRY-ROUTINE
              ELSE
                 IF VDUSTATUS NOT = "OK"
                    GO TO BAR-REF-ENTRY-NORMAL
                 ELSE
                    GO TO REFERENCE-CHECK
           ELSE
           IF LP-TRCD = "P4" OR "P5"
              PERFORM P4P5-TEST
              IF VDUSTATUS NOT = "OK"
                 GO TO BAR-CD-ENTRY-RTN
              ELSE
                 MOVE P4-SEQ TO PASSWDW-SEQ
                 MOVE "TO MAKE THIS ACCOUNT P&L STATUS"
                                    TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT= "OK"
                    GO TO BAR-CD-ENTRY
                 ELSE
                    PERFORM P4P5-ENTRY
                    IF VDUSTATUS = "10" OR = "1U"
                       GO TO BAR-ENTRY-ROUTINE
                    ELSE
                       IF VDUSTATUS NOT = "OK"
                          GO TO BAR-REF-ENTRY-NORMAL
                       ELSE
                          GO TO REFERENCE-CHECK
           ELSE
           IF LP-TRCD = "ED"
              MOVE
           "ENTER 'TAX','INS','PMI','OTH','REF','CNT'. (F8=HELP)"
                 TO MESS
              PERFORM SEND-LEGEND
              MOVE "E  A050030." TO VDU
           ELSE
              IF (GP-REFNO-VERIFY = "Y" OR "T") OR
                 (LP-TRCD = "RE" )
                 MOVE "ENTER REFERENCE NO, F6-SCAN" TO MESS
              ELSE
                 MOVE "ENTER REFERENCE NO" TO MESS
              END-IF
              PERFORM SEND-LEGEND
              MOVE "E  A050030." TO VDU.

           PERFORM SCREENIO.

           IF VDUSTATUS = "10" OR = "1U"
              GO TO BAR-ENTRY-ROUTINE.

           IF LP-TRCD = "SP"
              IF VDUSTATUS = "1<"
                 PERFORM SCAN-POOLID
                 IF IO-FG = 9
                    GO TO BAR-REF-ENTRY-NORMAL.

           IF (GP-REFNO-VERIFY = "Y") OR
              (LP-TRCD = "RE"       )
              IF F6-KEY
                 PERFORM REFNO-SCAN
                 IF IO-FG = 9
                    GO TO BAR-REF-ENTRY-NORMAL.


           IF (GP-REFNO-VERIFY = "T")
              IF F6-KEY
                 PERFORM TC2SCN-SCAN
                 IF IO-FG = 9
                    GO TO BAR-REF-ENTRY-NORMAL.

           IF VDUSTATUS NOT = "00"
              GO TO BAR-REF-ENTRY-NORMAL.

           IF LP-TRCD = "SP"
      *       MOVE VDUNUM0         TO LP-POOLID
              MOVE VDUNUM0         TO LPWSLP-LP-POOLID
              MOVE LPWSLP-LP-REFNO TO LP-REFNO
              GO TO REFERENCE-CHECK.

           IF LP-TRCD = "BK"
      *       MOVE VDUNUM0         TO LP-POOLID
              MOVE VDUNUM0         TO LPWSLP-LP-POOLID
              MOVE LPWSLP-LP-REFNO TO LP-REFNO
              IF NOT (LPWSLP-LP-POOLID = 7 OR 11 OR 12 OR 13 OR 28)
                 GO TO BAR-REF-ENTRY-NORMAL
              ELSE
                 GO TO REFERENCE-CHECK.

           IF LP-TRCD = "ED"
              MOVE VDUBUF TO TEST-ESCROW-DISB-REFNO
              IF NOT VALID-ESCROW-REFNO
                 MOVE "PLEASE ENTER VALID ESCROW DISBURSEMENT TYPE."
                    TO MESS
                 PERFORM SEND-MESS
                 GO TO BAR-REF-ENTRY-NORMAL.

           IF LP-TRCD NOT = "DC"
              MOVE VDUBUF TO LP-REFNO
              GO TO REFERENCE-CHECK.

      * "DC" ONLY (DUE DATE CHANGE)
           MOVE SPACES  TO LP-REFNO LPWSLP-LP-REFNO.

      * MOVED LP-REFNO REDEFINITION TO LPWSLP COPY MEMBER, LP-TODD AND
      *                                                    LP-FROMDD
      *    MOVE VDUNUM0 TO LP-TODD.

           MOVE VDUNUM0 TO LPWSLP-LP-TODD.
           IF LPWSLP-LP-TODD = 0 OR > 31
              GO TO BAR-REF-ENTRY-NORMAL.

           MOVE LN-ORIG-1STPYDATE TO NUM-DATE.
           IF LPWSLP-LP-TODD = 31
              IF NOT (NUM-MO = 1 OR 3 OR 5 OR 7 OR 8 OR 10 OR 12)
                 MOVE
           "DAY IS > THAN LAST VALID DAY IN ORIGINAL 1ST PAY DATE"
                                                          TO MESS
                 PERFORM SEND-MESS
                 GO TO BAR-REF-ENTRY-NORMAL.

           IF LPWSLP-LP-TODD > 28
              IF NUM-MO = 02
                 MOVE "DAY IS > THAN 28TH OF FEBRUARY" TO MESS
                 PERFORM SEND-MESS
                 GO TO BAR-REF-ENTRY-NORMAL.

           MOVE LN-1STPYDA      TO LPWSLP-LP-FROMDD.
           MOVE "T"             TO LPWSLP-LP-T.
           MOVE LPWSLP-LP-REFNO TO LP-REFNO.

           MOVE "S  A050030." TO VDU.
           MOVE LP-REFNO      TO VDUBUF.
           PERFORM SCREENIO.

           GO TO BAR-CURBAL-CHECK.

       REFERENCE-CHECK.
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * CHECK ENTRY OF REFNO TO SEE IF IT CONTAINS ANY SPECIAL
      * CHARACTERS LIKE A BACK (\) OR FORWARD (/) SLASH; IF SO THEN
      * FORCE RE-ENTRY.
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE ZEROES TO SUB.

           INSPECT LP-REFNO TALLYING SUB FOR ALL "\"
                                     SUB FOR ALL "/".

           IF ( SUB NOT = ZEROES )
              MOVE "INVALID CHARACTERS" TO MESS
              PERFORM SEND-MESS
              GO TO BAR-REF-ENTRY-NORMAL.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    DETERMINE IF OPERATOR TYPED IN A REFNO THAT IS ON FILE
      *    AS A BATCH PAYMENT REFCD AND IF SO SET 'LPLONPW' FIELDS:
      *       BATCH-REFCD
      *       BATCH-REFCD-LC-FG
      *       BATCH-REFCD-FILE-TYPE
      *    FOR PROGRAM LOGIC LIKE 'ALLOT', 'LBOX', 'TPAY', 'TCOLL', 'MGRAM' ETC
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE LOW-VALUES  TO BATCH-REFCD.
           MOVE "N"         TO BATCH-REFCD-LC-FG.
           MOVE " "         TO BATCH-REFCD-FILE-TYPE.
           IF LP-REFNO NOT = " "
              PERFORM OPEN-CD1-FILE
              MOVE "BR"     TO CD-TYPE
              MOVE LP-REFNO TO CD-CODE
              PERFORM READ-CD1-FILE
              IF IO-GOOD
      * WE SHOULDN'T ALLOW USE IN PAYMENT POSTING OF A REFCD WHERE
      * MULTI-REFCD IS SET TO Y, IT PRODUCES GL ENTRIES TO 0000000 SINCE
      * YOU CAN'T ENTER A GL ACCOUNT WHEN THAT FIELD IS Y. ONLY CHANGED
      * IN A32, NOT A15.
                 IF CD-BR-MULTIPLE-REFCDS = "Y"
                    MOVE "INVALID REF CODE - MULTIPLE" TO MESS
                    PERFORM SEND-MESS
                    GO TO BAR-REF-ENTRY-NORMAL
                 ELSE
                    IF CD-BR-FILE-TYPE = "C"
                       MOVE "INVALID FILE TYPE - C" TO MESS
                       PERFORM SEND-MESS
                       GO TO BAR-REF-ENTRY-NORMAL
                    ELSE
                       MOVE LP-REFNO        TO BATCH-REFCD
                       MOVE CD-BR-LC-FG     TO BATCH-REFCD-LC-FG
                       MOVE CD-BR-FILE-TYPE TO BATCH-REFCD-FILE-TYPE.
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

           IF LP-TRCD = "PA"
              IF NOT ( LP-REFNO = "DEBIT" OR "PHDBT" OR "PHACH")
                 MOVE PA-NOT-DEBIT-SEQ TO PASSWDW-SEQ
                 MOVE "TO POST ALLOT/LBOX PAYMENTS"
                                      TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO BAR-REF-ENTRY-NORMAL.

      * 7/17/08  OK, WORLD NEEDS TO POST SOME INS CLAIM BATCH PMTS
      *          MANUALLY BUT IT WON'T ALLOW USING ON-FILE REF CODES
      *          UNLESS THAT DARN NONCASH FLAG IS SET, SO SKIP
      *          THAT LOGIC.  ALSO, DON'T ALLOW ANYTHING BUT PA OR
      *          PO.       BARB

           IF (LP-TRCD = "PE") AND
               (LP-REFNO = "DEBIT" OR "PHDBT" OR "PHACH")
              NEXT SENTENCE
           ELSE
              IF (BATCH-REFCD NOT = " ") AND (BATCH-REFCD = LP-REFNO)
                 IF NOT (LP-TRCD = "PA" OR "PO" )
                    MOVE " INVALID FOR TRANSACTION CODE" TO MESS
                    PERFORM SEND-MESS
                    GO TO BAR-REF-ENTRY-NORMAL.

           IF ( LP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
                                   OR "TPAY" OR "MGRAM")
                 MOVE " INVALID REFERENCE CODE" TO MESS
                 PERFORM SEND-MESS
                 GO TO BAR-REF-ENTRY-NORMAL.

           GO TO SKIP-NONCASH-REFNO-CHECK.


      *    IF ( LP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
      *                            OR "TPAY" OR "MGRAM"
      *       )
      *       OR
      *       ( (BATCH-REFCD NOT = " "       ) AND
      *         (BATCH-REFCD = LP-REFNO      )
      *       )
      *       IF ( GP-ALLOW-SET-FOR-NONCASH NOT = "Y"
      *          )
      *          OR
      *          ( NOT (LP-TRCD = "PA" OR "PO" OR "Z2" OR "PY" OR "PE"
      *                                OR "DF" OR "D2" OR "D3" OR "D4"
      *                                OR "D5" OR "D6" OR "D7" OR "D8"
      *                                OR "D9" OR "SS" OR "IN"
      *                                OR "OT" OR "O2"
      *                )
      *          )
      *          MOVE " INVALID FOR TRANSACTION CODE" TO MESS
      *          PERFORM SEND-MESS
      *          GO TO BAR-REF-ENTRY-NORMAL
      *       END-IF
      *       MOVE LBOX-SEQ TO PASSWDW-SEQ
      *       MOVE "TO ENTER LOCKBOX TYPE AS REFNO" TO PASSWDW-PROMPT2
      *       PERFORM VERIFY-PASSWORD
      *       IF PASSWDW-STAT NOT = "OK"
      *          GO TO BAR-REF-ENTRY-NORMAL.

       SKIP-NONCASH-REFNO-CHECK.
           IF LP-REFNO = "NSF  "
              IF LP-TRCD NOT = "RV"
                 GO TO BAR-REF-ENTRY-NORMAL
              ELSE
                 IF LN-LBOX = "Y"
                    MOVE "NSF LOCKBOX TYPE REVERSAL" TO MESS
                 ELSE
                    MOVE "NSF BANK REVERSAL   "      TO MESS
                 END-IF
                 PERFORM SEND-MESS.

           IF LP-REFNO NOT = "NSF  "
              IF LP-TRCD = "RV"
                 MOVE "CORRECTING ENTRY ONLY - NOT NSF" TO MESS
                 PERFORM SEND-MESS.

      * #1531 DO NOT ALLOW "CHECK" REFCD INTERBRANCH
           IF LP-REFNO = "CHECK"
              IF ( POSTING-INTERBRANCH )
                 MOVE "INVALID FOR INTERBRANCH" TO MESS
                 PERFORM SEND-MESS
                 GO TO BAR-REF-ENTRY-NORMAL
              ELSE
                 MOVE CDV-CHECK TO CDV-BUF
                 PERFORM CDV-VERIFY
                 IF CDV-NO-MATCH
                    GO TO BAR-REF-ENTRY-NORMAL
                 ELSE
      * NOW CHECK IF PASSWORD NEEDED FOR "RI"
                 IF LP-TRCD = "RI"
                    MOVE CHECK-SEQ TO PASSWDW-SEQ
                    MOVE "TO ENTER 'CHECK' AS REFNO" TO PASSWDW-PROMPT2
                    PERFORM VERIFY-PASSWORD
                    IF PASSWDW-STAT NOT = "OK"
                       GO TO BAR-REF-ENTRY-NORMAL.

           MOVE LP-REFNO TO LPWSLP-LP-REFNO.
           IF LPWSLP-LP-ADDON-TEXT = "ADD" OR "ADJ" OR "CNL"
              GO TO BAR-REF-ENTRY-NORMAL.

      *    IF REVERSAL THEN CALL ANOTHER PROG BASED ON TRCD.
           IF LP-TRCD = "RV"
              MOVE LP-REFNO TO HOLD-LP-REFNO
              GO TO SELECTION-PROG-BRANCH.

      * #1531 DO NOT ALLOW "CHECK" REFCD ON ACCOUNTS WITH 0 BALANCE
           IF LP-REFNO = "CHECK"
      *       GO TO SELECTION-PROG-BRANCH.
              GO TO BAR-CURBAL-CHECK.

      *    IF JUDGEMENT THEN ENTER JUDGEMENT-RATE
           IF LP-TRCD = "JD"
              GO TO BAR-REFNO-JD
           ELSE
           IF GP-REFNO-VERIFY = "T"
              PERFORM VERIFY-REFNO-TRCD
           ELSE
              PERFORM VERIFY-REFNO
           END-IF
           IF NOT WS-MATCH-FOUND
              GO TO BAR-REF-ENTRY-NORMAL
           END-IF

      *       ACCELERATE ACCOUNT
           IF LP-TRCD = "AC" OR
                (
                  (LP-TRCD = "PL" AND
                      ( BR-AUTO-PL-REF-AC = "Y" OR "2" OR "3") )
                        OR
                  (LP-TRCD = "P2" AND
                      ( BR-AUTO-PL-REF-AC = "2" OR "3") )
                        OR
                  (LP-TRCD = "P3" AND BR-AUTO-PL-REF-AC = "3")
                )
                 GO TO BAR-REFNO-AC
           ELSE
      *          INTEREST CHANGE/REDUCTION
              IF LP-TRCD = "IR"
                 GO TO BAR-REFNO-IR
              ELSE
                  GO TO BAR-REFNO-NF.

      *****************************************
      *    JUDGEMENT RATE ENTRY
      *****************************************
       BAR-REFNO-JD.
           MOVE "SN N033040." TO VDU.
           MOVE LN-JDRATE TO VDUNUM3.
           PERFORM SCREENIO.
           MOVE "ENTER JUDGEMENT RATE" TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM ALARM.
           MOVE "ENNN033040." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10" OR = "1U"
              GO TO BAR-REF-ENTRY.
           IF VDUSTATUS NOT = "00"
              IF VDUSTATUS NOT = "1D"
                 GO TO BAR-REFNO-JD.
           MOVE VDUNUM3 TO LP-NEWSTAT-RATE HOLD-LN-JDRATE.
           GO TO BAR-CURBAL-CHECK.

      *****************************************
      *    ACCELERATION RATE ENTRY
      *****************************************
       BAR-REFNO-AC.
           IF (LP-TRCD = "PL" AND
                   (BR-AUTO-PL-REF-AC = "Y" OR "2" OR "3") )
      * ALREADY ACCELERATED
              IF LN-ACCELDATE NOT = 0
                  GO TO BAR-CURBAL-CHECK.
           IF (LP-TRCD = "P2" AND
                          (BR-AUTO-PL-REF-AC = "2" OR "3") )
      * ALREADY ACCELERATED
              IF LN-ACCELDATE NOT = 0
                  GO TO BAR-CURBAL-CHECK.
           IF (LP-TRCD = "P3" AND BR-AUTO-PL-REF-AC = "3")
      * ALREADY ACCELERATED
              IF LN-ACCELDATE NOT = 0
                  GO TO BAR-CURBAL-CHECK.

           MOVE "SN N033040." TO VDU.
      * CHANGED TO APR RE: MERCURY
      *    MOVE 999.996 TO VDUNUM3.
      *    MOVE 999.997 TO VDUNUM3.
      * 3/27/96 BAH ADDED GP-DEFAULT-ACCRATE
           MOVE GP-DEFAULT-ACCRATE TO VDUNUM3.
           PERFORM SCREENIO.
           MOVE "ENTER ACCELERATION RATE" TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM ALARM.
           MOVE "ENNN033040." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10" OR = "1U"
              GO TO BAR-REF-ENTRY.
           IF VDUSTATUS NOT = "00"
              IF VDUSTATUS NOT = "1D"
                 GO TO BAR-REFNO-AC.
           MOVE VDUNUM3 TO LP-NEWSTAT-RATE HOLD-LN-JDRATE.
           IF LP-NEWSTAT-RATE = 999.999
              MOVE "ACCELERATION RATE MUST BE LESS THAN 999.999"
                 TO MESS
              PERFORM SEND-MESS
              GO TO BAR-REFNO-AC.
           GO TO BAR-CURBAL-CHECK.

      *****************************************
      *    INTEREST CHANGE/REDUCTION RATE ENTRY
      *****************************************
       BAR-REFNO-IR.
           MOVE "SN N033040." TO VDU.
           MOVE 0 TO VDUNUM3.
           PERFORM SCREENIO.
           MOVE "ENTER RATE CHANGE/REDUCTION:" TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM ALARM.
           MOVE "ENNN033040." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10" OR = "1U"
              GO TO BAR-REF-ENTRY.
           IF VDUSTATUS NOT = "00"
              IF VDUSTATUS NOT = "1D"
                 GO TO BAR-REFNO-IR.
           MOVE VDUNUM3 TO LP-NEWSTAT-RATE HOLD-LN-JDRATE.
           IF LP-NEWSTAT-RATE > 999.995
              MOVE "RATE CHANGE/REDUCTION MUST BE LESS THAN 999.996"
                 TO MESS
              PERFORM SEND-MESS
              GO TO BAR-REFNO-IR.

           GO TO BAR-CURBAL-CHECK.

      *********************************************************
      *    ENTRY OF MIP INSURANCE REINSTATEMENT CODE "REINS"
      *********************************************************
       BAR-REFNO-CCCA.
           IF LP-TRCD = "CC" AND LN-CL-REBATE = "Y"
              MOVE "ENTER 'CLRE' TO REINSTATE MIP CREDIT LIFE"
                                                       TO MESS
              PERFORM SEND-LEGEND
              PERFORM ALARM
           ELSE
           IF LP-TRCD = "CA" AND LN-AH-REBATE = "Y"
              MOVE "ENTER 'AHRE' TO REINSTATE MIP A&H" TO MESS
              PERFORM SEND-LEGEND
              PERFORM ALARM
           ELSE
              MOVE "ENTER REFNO:" TO MESS
              PERFORM SEND-LEGEND.
           MOVE "E  A050030." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10" OR = "1U"
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS NOT = "00"
              GO TO BAR-REFNO-CCCA.
           MOVE VDUBUF TO LP-REFNO.
           IF ( LP-REFNO = "CLRE"      ) AND
              ( (LP-TRCD NOT = "CC") OR
                (LN-CL-REBATE NOT = "Y")
              )
              MOVE "INVALID ENTRY" TO MESS
              PERFORM SEND-MESS
              GO TO BAR-REFNO-CCCA.
           IF ( LP-REFNO = "AHRE"      ) AND
              ( (LP-TRCD NOT = "CA") OR
                (LN-AH-REBATE NOT = "Y")
              )
              MOVE "INVALID ENTRY" TO MESS
              PERFORM SEND-MESS
              GO TO BAR-REFNO-CCCA.
           GO TO BAR-CURBAL-CHECK.

      *****************************************
      *    CLASS TRANSFER CLASS ENTRY
      *****************************************
       BAR-REFNO-TSTP.
           IF LP-TRCD = "TS"
              MOVE "ENTER SERVICE LOAN CLASS NO:" TO MESS
           ELSE
              IF LP-TRCD = "TP"
                 MOVE "ENTER PURCHASED LOAN CLASS NO:" TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM ALARM.

           MOVE "ENNN050030." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10" OR = "1U"
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS NOT = "00"
              GO TO BAR-REFNO-TSTP.
           IF VDUNUM0 = 0 OR > 99
              GO TO BAR-REFNO-TSTP.

           MOVE VDUNUM0         TO LP-TOCL LPWSLP-LP-TODD.
           MOVE "T"             TO LPWSLP-LP-T.
           MOVE LN-CLASS        TO LP-FROMCL LPWSLP-LP-FROMDD.
           MOVE LPWSLP-LP-REFNO TO LP-REFNO.
           PERFORM TEST-VALID-CLASS-TSTP.
           IF IO-FG NOT = 0
              MOVE SPACES TO LP-REFNO LPWSLP-LP-REFNO
              GO TO BAR-REFNO-TSTP.

           GO TO BAR-CURBAL-CHECK.

      *****************************************
      *    DEFERMENT RATE ENTRY
      *****************************************
       BAR-REFNO-DF.
           MOVE "ENTER DEFERMENT RATE" TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM ALARM.
           MOVE "ENNN022030." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10" OR = "1U"
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS NOT = "00"
              IF VDUSTATUS NOT = "1D"
                 GO TO BAR-REFNO-DF.
      * USE HOLD-LN-JDRATE TO PASS DEFERMENT RATE TO LONPFC
           MOVE VDUNUM2 TO JDRATE-EDIT HOLD-LN-JDRATE.
           MOVE JDRATE-EDIT TO LP-REFNO.
           GO TO BAR-CURBAL-CHECK.

       BAR-REFNO-NF.
      * GP-REFNO-VERIFY OF "A": ONLY ALLOW ALPHA OR NUMBERS IN REFNO:
           IF GP-REFNO-VERIFY = "A"
              PERFORM VERIFY-REFNO-ALPHA-NUMERIC
              IF REFNO-OKAY NOT = "Y"
                 MOVE "PLEASE ENTER ONLY LETTERS OR NUMBERS!" TO MESS
                 PERFORM SEND-MESS
                 GO TO BAR-REF-ENTRY-NORMAL.


           IF LP-REFNO = SPACES
              GO TO BAR-CURBAL-CHECK.

      *-----------------------------------------------------------------
       BAR-CURBAL-CHECK.
           IF LN-CURBAL = 0
              MOVE "LOAN BALANCE = 0" TO MESS
              PERFORM SEND-MESS
              GO TO BAR-ENTRY-ROUTINE.

           IF ( LN-CURBAL NOT > LN-OT2BAL ) AND
              ( LP-TRCD NOT = "RV"        )
              MOVE
             "OTHER 2 BALANCE IS GREATER THAN CURRENT BALANCE ..."
                                                         TO MESS
              PERFORM SEND-MESS
              MOVE
             "CANNOT POST!!!  PLEASE CALL HOME OFFICE FOR DIRECTIONS"
                                                            TO MESS
              PERFORM SEND-MESS
              GO TO BAR-ENTRY-ROUTINE.

       SELECTION-PROG-BRANCH.
      * PROGRAM SELECTED BASED ON LP-TRCD ENTERED
           MOVE CDV-NEW-PROG(CDV-IX) TO NEW-PROG-SUB.

      * "RV" ENTERED AS F6 ABOVE
           IF LP-TRCD = "RV"
              MOVE "8" TO NEW-PROG-SUB.

       SELECTION-EXIT-PROG.
      * EXIT WITH NO FORM CHANGE
           MOVE "P" TO ERRCD.
           PERFORM SAVE-SCREEN.

       SELECTION-MODULE-EXIT.
           EXIT.

      ******************************************************************
       DLRVNO-ENTRY SECTION.
      ******************************************************************
           MOVE 0 TO DLRVNO-RSV-NO.
           MOVE LN-DLNO TO DLRVNO-DEALER-NO.

           IF BR-TAP-OTHER-DL = "Y"
              IF LP-TRCD = "PR" OR "PC"
                 MOVE "F3-OVERRIDE DEALER, ENTER RESERVE 1 OR 2 OR 3:"
                                                            TO MESS
                 PERFORM SEND-LEGEND
                 PERFORM ALARM
                 MOVE "E  A050030." TO VDU
                 PERFORM SCREENIO
                 IF (VDUSTATUS = "10" OR = "1U")
                          OR (NOT (VDUSTATUS = "00" OR "16"))
                    GO TO DLRVNO-ENTRY-EXIT
                 ELSE
                    IF VDUSTATUS = "00"
                       GO TO DLRVNO-ENTRY-TEST-RVNO
                    ELSE
                       PERFORM DLRVNO-WINDOW
                       IF DLRVNO-RTN NOT = " "
                          GO TO DLRVNO-ENTRY
                       ELSE
                          GO TO DLRVNO-ENTRY-SET-RVNO
              ELSE
                 MOVE "F3-OVERRIDE DEALER, ENTER REFERENCE:"
                                                            TO MESS
                 PERFORM SEND-LEGEND
                 PERFORM ALARM
                 MOVE "E  A050030." TO VDU
                 PERFORM SCREENIO
                 IF (VDUSTATUS = "10" OR = "1U")
                          OR (NOT (VDUSTATUS = "00" OR "16"))
                    GO TO DLRVNO-ENTRY-EXIT
                 ELSE
                    IF VDUSTATUS = "16"
                       PERFORM DLRVNO-WINDOW
                       IF DLRVNO-RTN NOT = " "
                          GO TO DLRVNO-ENTRY
                       ELSE
                          GO TO DLRVNO-ENTRY-SET-RVNO
                    ELSE
                       MOVE VDUBUF TO LP-REFNO
                       MOVE "OK" TO VDUSTATUS
                       GO TO DLRVNO-ENTRY-EXIT
           ELSE
              IF LP-TRCD = "PR" OR "PC"
                 MOVE "ENTER RESERVE 1 OR 2 OR 3:" TO MESS
                 PERFORM SEND-LEGEND
                 PERFORM ALARM
                 MOVE "E  A050030." TO VDU
                 PERFORM SCREENIO
                 IF (VDUSTATUS = "10" OR = "1U")
                            OR (VDUSTATUS NOT = "00")
                    GO TO DLRVNO-ENTRY-EXIT
                 ELSE
                    GO TO DLRVNO-ENTRY-TEST-RVNO
              ELSE
                 MOVE "F1, ^, ENTER REFERENCE:" TO MESS
                 PERFORM SEND-LEGEND
                 PERFORM ALARM
                 MOVE "E  A050030." TO VDU
                 PERFORM SCREENIO
                 IF (VDUSTATUS = "10" OR = "1U")
                            OR (VDUSTATUS NOT = "00")
                    GO TO DLRVNO-ENTRY-EXIT
                 ELSE
                    MOVE VDUBUF TO LP-REFNO
                    MOVE "OK" TO VDUSTATUS
                    GO TO DLRVNO-ENTRY-EXIT.

        DLRVNO-ENTRY-SET-RVNO.
           MOVE " " TO REFNO-WORKER.
           MOVE DLRVNO-RSV-NO TO REFNO-DLRVNO-N.
           IF DLRVNO-DEALER-NO NOT = LN-DLNO
              MOVE DLRVNO-DEALER-NO TO LP-DLNO
                                  REFNO-DLNO-N
           ELSE
              MOVE 0 TO LP-DLNO.
           MOVE "S  A050030." TO VDU.
           MOVE REFNO-WORKER TO VDUBUF
                                LP-REFNO.
           PERFORM SCREENIO.
           MOVE "OK" TO VDUSTATUS.
           GO TO DLRVNO-ENTRY-EXIT.

        DLRVNO-ENTRY-TEST-RVNO.
      * I DONT THINK THIS IF IS CORRECT. I THINK IT WANTS TO BE THE RESERVE
      * NUMBER ON THE REFNO LINE ONLY BUT SECURITY AUTO NEEDS IT TO WORK THIS
      * WAY SO IF YOU CHANGE PLEASE ACCOMODATE, CHANGE DATES BACK TO 95 SO
      * I DID NOT CHANGE.  CS.

           MOVE VDUBUF TO REFNO-WORKER
                          LP-REFNO.

           IF REFNO-DLRVNO = "1" OR "2" OR "3"
                                  AND REFNO-DLNO = " "
              IF REFNO-DLRVNO = "3"
                 MOVE DLRVNO3-SEQ TO PASSWDW-SEQ
                 MOVE "TO ACCESS RESERVE 3" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO DLRVNO-ENTRY
                 END-IF
              END-IF
              MOVE "OK" TO VDUSTATUS
              IF VDUSTATUS = "OK"
                  GO TO DLRVNO-ENTRY-EXIT
              ELSE
                  GO TO DLRVNO-ENTRY.

       DLRVNO-ENTRY-EXIT.
           EXIT.

      ******************************************************************
       DLRVNO-WINDOW SECTION.
      ******************************************************************
           MOVE 7 TO WINDOW-LINES.
           MOVE 40 TO WINDOW-COLUMNS.
           MOVE 16 TO WINDOW-BEGIN-Y.
           MOVE 21 TO WINDOW-BEGIN-X.
           MOVE "DLRVNO" TO VDU-FORM-NAME.
           MOVE "WI/DLRVNO" TO WINDOW-FORM-NAM.

           PERFORM OPEN-WINDOW.
           DISPLAY DLRVNO-SCREEN.

           MOVE DLRVNO-FORM-FIELDS TO WR-BUF.
           MOVE DLRVNO-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.

           MOVE " " TO DLRVNO-RTN.

           MOVE LN-DLNO TO DL-DLNO.
           PERFORM GET-DL.
           MOVE "SNNN042DLNO." TO VDU.
           MOVE LN-DLNO TO VDUNUM2.
           PERFORM SCREENIO.
           MOVE "S  A150NAME." TO VDU.
           MOVE DL-SHORT TO VDUBUF.
           PERFORM SCREENIO.

       DLRVNO-WINDOW-DLNO.
           MOVE " F1, F6-SCAN, ENTER DEALER NO:" TO MESS.
           PERFORM SEND-LEGEND-W.
           MOVE "ENNN042DLNO." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              MOVE "CLR" TO DLRVNO-RTN
              GO TO DLRVNO-WINDOW-EXIT.
           IF VDUSTATUS = "1<"
              PERFORM DEALER-SCAN
              IF IO-FG = 9
                 GO TO DLRVNO-WINDOW-DLNO.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO DLRVNO-WINDOW-DLNO.
           MOVE VDUNUM2 TO DLRVNO-DEALER-NO
                           DL-DLNO.
           PERFORM GET-DL.
           IF IO-FG = 9
              GO TO DLRVNO-WINDOW-DLNO.
           MOVE "S  A150NAME." TO VDU.
           MOVE DL-SHORT TO VDUBUF.
           PERFORM SCREENIO.

           IF LP-TRCD = "PP"
              GO TO DLRVNO-WINDOW-ACCEPT.
       DLRVNO-WINDOW-RVNO.
           MOVE " F1, ENTER RESERVE NO (1-3):" TO MESS.
           PERFORM SEND-LEGEND-W.
           MOVE "ENNN010RVNO." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              MOVE "CLR" TO DLRVNO-RTN
              GO TO DLRVNO-WINDOW-EXIT.
           IF VDUSTATUS = "1U"
              GO TO DLRVNO-WINDOW-DLNO.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO DLRVNO-WINDOW-RVNO.
           IF VDUNUM0 < 1 OR > 3
              GO TO DLRVNO-WINDOW-RVNO.
           MOVE VDUNUM0 TO DLRVNO-RSV-NO.

           IF DLRVNO-RSV-NO = 3
              MOVE DLRVNO3-SEQ TO PASSWDW-SEQ
              MOVE "TO ACCESS RESERVE 3" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO DLRVNO-WINDOW-RVNO.

       DLRVNO-WINDOW-ACCEPT.
           MOVE " F1, ^-BACK, F7-ACCEPT:" TO MESS.
           PERFORM SEND-LEGEND-W.
           MOVE "E  A010SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              MOVE "CLR" TO DLRVNO-RTN
              GO TO DLRVNO-WINDOW-EXIT.
           IF VDUSTATUS = "1U"
              GO TO DLRVNO-WINDOW-DLNO.
           IF VDUSTATUS = "1U"
              IF LP-TRCD = "PP"
                 GO TO DLRVNO-WINDOW-DLNO
              ELSE
                 GO TO DLRVNO-WINDOW-RVNO.
           IF VDUSTATUS NOT = "1>"
              GO TO DLRVNO-WINDOW-ACCEPT.

       DLRVNO-WINDOW-EXIT.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY DLRVNO-SCREEN.
           PERFORM CLOSE-WINDOW.
           MOVE "LONPF" TO VDU-FORM-NAME.


      ************************************************************
      * B A C K D A T E    T E S T
      ************************************************************
      * PR# 460 DONT ALLOW BACKDATE PRIOR TO INT/LC PAID THRU
      * IN THE EXAMPLE BELOW, WE DONT KNOW THAT INTEREST PAID-THRU SHOULD BE
      * 02/25/05. SINCE ITS THE PMT AFTER THE BACKDATED PMT (11/30/04) THAT
      * COULD BE A PROBLEM... ALLOWED BACKDATE OF RENEWAL CODES & PO.
      *
      *    12/30/04   100.00    INTPDTH  12/30/04
      *    01/30/05   100.00             01/30/05
      *    02/25/05   100.00             02/25/05
      *    11/30/04   100.00             02/25/05
      *    03/25/05   100.00             03/25/05
      *      RV       100.00-            11/30/04
      *
      * THE REVERSAL OF 3/25/05 PMT CAUSED INTEREST PAID THRU TO GO BACK TO
      * 11/30/04. RV LOOPS THRU LP LOOKING FOR RECORD NOT "RV" OR LP-REV NOT =
      * "Y" & USES THAT PAYDATE TO SET INTEREST PAID THRU

      ******************************************************************
       BACKDATE-TEST SECTION.
      ******************************************************************
           MOVE "Y" TO BACKDATE-FG.

           MOVE LP-PAYDATE TO IBPC-DATE.
           PERFORM IBPC-TEST.

           IF IBPC-FG NOT = "I"
              GO TO BACKDATE-TEST-EXIT.
           IF LN-INTPDTH-DATE = 0
              GO TO BACKDATE-TEST-EXIT.

           IF LN-INTPDTH-DATE > LP-PAYDATE
              MOVE LN-INTPDTH-DATE TO WS-INTPDTH
              STRING
              "BACKDATE PRIOR TO INTEREST PAID THRU ",
               " ", WS-INTPDTH, " ", "NOT ALLOWED" DELIMITED BY
                      "  " INTO MESS
              PERFORM SEND-MESS
              MOVE "N" TO BACKDATE-FG.

       BACKDATE-TEST-EXIT.
           EXIT.

      *************************************
       VERIFY-DEFERMENT-APPROVAL SECTION.
      *************************************
           MOVE "N" TO DEFERMENT-APPROVED.

           MOVE LN-OWNBR  TO LSP-BRNO.
           MOVE LN-ACCTNO TO LSP-ACCTNO.
           MOVE 1         TO LSP-SEQNO.
           PERFORM OPEN-LSP1-FILE.
           PERFORM READ-LSP1-FILE.
           PERFORM CLOSE-LSP1-FILE.
           IF (IO-BAD)
              MOVE "MUST HAVE PAID THRU MODIFICATION APPROVAL"
                   TO MESS PERFORM SEND-MESS
              MOVE "N" TO DEFERMENT-APPROVED
              GO TO EXIT-VERIFY-DEFERMENT-APPROVAL.

      * VERIFY THAT NUMBER APPROVED IN THE LS RECORD IS GREATER
      * OR EQUAL TO WHAT THEY ARE TRYING TO POST
      * IF THEY HAVE 3 IN THE LS RECORD, THAN THEY CAN NOT POST
      * MORE THAN AN D3 TRANSACTION.
           MOVE LP-TRCD TO TRCD-WORKER.
           IF TRCD-FTST = "F"
              MOVE "1" TO TRCD-NODEL.
           IF TRCD-NODEL > LSP-PERIODS-TO-DEFER
              MOVE "POSTING EXCEEDS APPROVED # OF PERIODS"
                   TO MESS PERFORM SEND-MESS
              MOVE "N" TO DEFERMENT-APPROVED
              GO TO EXIT-VERIFY-DEFERMENT-APPROVAL.

      * NOW CHECK THAT ALL THE PROPER AUTHORITIES HAVE APPROVED
      * THIS DEFEREMENT
      * REAL ESTATE MUST HAVE VP APPROVAL, ALL OTHERS JUST NEED
      * THE A-VP
           IF LC-SMALLOAN = "N" AND LC-SALEFIN = "N"
      * REAL ESTATE
              IF LSP-VP-APPROVE = "Y"
                 MOVE "Y" TO DEFERMENT-APPROVED
              ELSE
                 MOVE "RE LOAN TYPE - NEEDS VP APPROVAL"
                   TO MESS PERFORM SEND-MESS
                 MOVE "N" TO DEFERMENT-APPROVED
           ELSE
      * OTHER TYPES NEED EITHER OR APPROVAL
              IF LSP-AVP-APPROVE = "Y" OR LSP-VP-APPROVE = "Y"
                 MOVE "Y" TO DEFERMENT-APPROVED
              ELSE
                 MOVE "NEEDS ASSISTANT VP APPROVAL"
                   TO MESS PERFORM SEND-MESS
                 MOVE "N" TO DEFERMENT-APPROVED.


       EXIT-VERIFY-DEFERMENT-APPROVAL.
           EXIT.

      ***************************************************
       P4P5-ENTRY SECTION.
      ***************************************************
           MOVE " "  TO P4P5-TRANS-CODE.
           MOVE 0 TO P4P5-RSV-NO.
           MOVE LN-DLNO TO P4P5-DEALER-NO.

           IF BR-TAP-OTHER-DL = "Y"
              MOVE "F3-OVERRIDE DL, ENTER RSV PYCD & RESERVE NO:"
                                                         TO MESS
           ELSE
              MOVE "ENTER RESERVE PYCD & RESERVE NO (1-2-3):"
                                                         TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM ALARM
           MOVE "E  A050030." TO VDU
           PERFORM SCREENIO
           IF (VDUSTATUS = "10" OR = "1U")
                    OR (NOT (VDUSTATUS = "00" OR "16"))
              GO TO P4P5-ENTRY-EXIT
           ELSE
              IF VDUSTATUS = "00"
                 GO TO P4P5-ENTRY-TEST-RVNO
              ELSE
                 PERFORM P4P5-WINDOW
                 IF P4P5-RTN NOT = " "
                    GO TO P4P5-ENTRY
                 ELSE
                    GO TO P4P5-ENTRY-SET-RVNO.

        P4P5-ENTRY-SET-RVNO.
           MOVE " " TO REFNO-P4P5-WORKER.
           MOVE P4P5-TRANS-CODE TO REFNO-P4P5-TRANS-CODE.
           IF P4P5-RSV-NO NOT = 0
              MOVE P4P5-RSV-NO TO REFNO-P4P5-DLRVNO-N.
           IF P4P5-DEALER-NO NOT = LN-DLNO
              MOVE P4P5-DEALER-NO TO LP-DLNO
           ELSE
              MOVE 0 TO LP-DLNO.
           MOVE "S  A050030." TO VDU.
           MOVE REFNO-P4P5-WORKER TO VDUBUF
                                     LP-REFNO.
           PERFORM SCREENIO.
           MOVE "OK" TO VDUSTATUS.
           GO TO P4P5-ENTRY-EXIT.

        P4P5-ENTRY-TEST-RVNO.
           MOVE VDUBUF TO REFNO-P4P5-WORKER
                          LP-REFNO.
           IF REFNO-P4P5-FILLER = " "
              IF REFNO-P4P5-TRANS-CODE = "PR" OR "PC"
                 IF REFNO-P4P5-DLRVNO = "1" OR "2" OR "3"
                    MOVE "OK" TO VDUSTATUS
                    GO TO P4P5-ENTRY-EXIT
                 ELSE
                    GO TO P4P5-ENTRY
              ELSE
              IF REFNO-P4P5-TRANS-CODE = "PP"
                 IF REFNO-P4P5-DLRVNO = " "
                    MOVE "OK" TO VDUSTATUS
                    GO TO P4P5-ENTRY-EXIT
                 ELSE
                    GO TO P4P5-ENTRY
              ELSE
                 GO TO P4P5-ENTRY
           ELSE
              GO TO P4P5-ENTRY.


       P4P5-ENTRY-EXIT.
           EXIT.

      *********************************************************
       P4P5-WINDOW SECTION.
      *********************************************************
           MOVE 9 TO WINDOW-LINES.
           MOVE 40 TO WINDOW-COLUMNS.
           MOVE 14 TO WINDOW-BEGIN-Y.
           MOVE 21 TO WINDOW-BEGIN-X.
           MOVE "P4P5" TO VDU-FORM-NAME.
           MOVE "WI/P4P5" TO WINDOW-FORM-NAM.

           PERFORM OPEN-WINDOW.
           DISPLAY P4P5-SCREEN.

           MOVE " " TO P4P5-RTN.

           MOVE LN-DLNO TO DL-DLNO.
           PERFORM GET-DL.
           MOVE "SNNN042DLNO." TO VDU.
           MOVE LN-DLNO TO VDUNUM2.
           PERFORM SCREENIO.
           MOVE "S  A150NAME." TO VDU.
           MOVE DL-SHORT TO VDUBUF.
           PERFORM SCREENIO.

       P4P5-WINDOW-DLNO.
           MOVE " F1, F6-SCAN, ENTER DEALER NO:" TO MESS.
           PERFORM SEND-LEGEND-W.
           MOVE "ENNN042DLNO." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              MOVE "CLR" TO P4P5-RTN
              GO TO P4P5-WINDOW-EXIT.
           IF VDUSTATUS = "1<"
              PERFORM DEALER-SCAN
              IF IO-FG = 9
                 GO TO P4P5-WINDOW-DLNO.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO P4P5-WINDOW-DLNO.
           MOVE VDUNUM2 TO P4P5-DEALER-NO DL-DLNO.
           PERFORM GET-DL.
           IF IO-FG = 9
              GO TO P4P5-WINDOW-DLNO.
           MOVE "S  A150NAME." TO VDU.
           MOVE DL-SHORT TO VDUBUF.
           PERFORM SCREENIO.

       P4P5-WINDOW-TRCD.
           MOVE " F1, ENTER PAYMENT CODE, PR, PC, PP:" TO MESS.
           PERFORM SEND-LEGEND-W.
           MOVE "E  A020TRCD." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              MOVE "CLR" TO P4P5-RTN
              GO TO P4P5-WINDOW-EXIT.
           IF VDUSTATUS = "1U"
              GO TO P4P5-WINDOW-DLNO.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO P4P5-WINDOW-TRCD.
           IF NOT (VDUBUF = "PR" OR "PC" OR "PP")
              GO TO P4P5-WINDOW-TRCD.
           MOVE VDUBUF TO P4P5-TRANS-CODE.

           IF P4P5-TRANS-CODE = "PP"
              MOVE 0 TO P4P5-RSV-NO
              MOVE "SNNN010RVNO." TO VDU
              PERFORM SCREENIO
              GO TO P4P5-WINDOW-ACCEPT.
       P4P5-WINDOW-RVNO.
           MOVE " F1, ENTER RESERVE NO (1-3):" TO MESS.
           PERFORM SEND-LEGEND-W.
           MOVE "ENNN010RVNO." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              MOVE "CLR" TO P4P5-RTN
              GO TO P4P5-WINDOW-EXIT.
           IF VDUSTATUS = "1U"
              GO TO P4P5-WINDOW-TRCD.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO P4P5-WINDOW-RVNO.
           IF VDUNUM0 < 1 OR > 3
              GO TO P4P5-WINDOW-RVNO.
           MOVE VDUNUM0 TO P4P5-RSV-NO.

       P4P5-WINDOW-ACCEPT.
           MOVE " F1, ^-BACK, F7-ACCEPT:" TO MESS.
           PERFORM SEND-LEGEND-W.
           MOVE "E  A010SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              MOVE "CLR" TO P4P5-RTN
              GO TO P4P5-WINDOW-EXIT.
           IF VDUSTATUS = "1U"
              IF P4P5-TRANS-CODE = "PP"
                 GO TO P4P5-WINDOW-TRCD
              ELSE
                 GO TO P4P5-WINDOW-RVNO.
           IF VDUSTATUS NOT = "1>"
              GO TO P4P5-WINDOW-ACCEPT.

       P4P5-WINDOW-EXIT.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY P4P5-SCREEN.
           PERFORM CLOSE-WINDOW.
           MOVE "LONPF" TO VDU-FORM-NAME.


      ******************************************************************
       DISPLAY-ENTRY-DOWN SECTION.
      ******************************************************************

           MOVE " " TO LINE-BUF LN-BUF.
           MOVE 0 TO LN-WK.
           MOVE "Y" TO TOGGLE-FIRST-TIME.
           MOVE HOLD1-KEY-DOWN TO LP1-KEY.

           IF LP-SEQNO = 99999
              MOVE 9 TO IO-FG
              GO TO DISPLAY-DOWN-EXIT.

           MOVE LP1-KEY TO HOLD2-KEY-UP.
           PERFORM OPEN-LP1-FILE.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ***NOTE*** 'START-LP1-FILE-SCAN' MUST BE USED WHEN FIRST USING
      * 'START-LP1-FILE-NOT-GREATER'; USED WHEN DISPLAYING MULTIPLE
      * PAGES IN AN UP & DOWN FUNCTION; YOU NEED TO ADD ONE TO 
      * LP-SEQNO (IN WBEG) IN ORDER TO GET THE DISPLAY TO WORK
      * LIKE VISION FILES.
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE LP-PATH-OWNBR TO QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO.
           MOVE LP-ACCTNO     TO QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           COMPUTE QLP1-WBEG-SEQNO = LP-SEQNO + 1.
           MOVE ALL "9"       TO QLP1-WEND-SEQNO.
      *-   -   -{ ADD ONE TO WHERE SCAN BEG FIELDS }
           IF ( LP-BRNO = 9999 )
              MOVE LP-BRNO    TO QLP1-WSBEG-BRNO
           ELSE
              COMPUTE QLP1-WSBEG-BRNO = LP-BRNO + 1.

           IF ( LP-ACCTNO = 99999999 )
              MOVE LP-ACCTNO  TO QLP1-WSBEG-ACCTNO
           ELSE
              COMPUTE QLP1-WSBEG-ACCTNO = LP-ACCTNO + 1.

           PERFORM START-LP1-FILE-SCAN.

           MOVE 0 TO ENTRY-FLAG.

       READ-LPFILE1-NEXT.

           IF ENTRY-FLAG = 2
              MOVE 9 TO IO-FG
              GO TO BYPASS-LPFILE1-READ.

           PERFORM READ-LP1-FILE-NEXT.
           IF IO-FG = 0
              IF (LP-ACCTNO NOT = LN-ACCTNO) OR
                    (LP-BRNO NOT = LP-PATH-OWNBR)
                 ADD 1 TO ENTRY-FLAG
                 GO TO READ-LPFILE1-NEXT.

       BYPASS-LPFILE1-READ.

           ADD 1 TO LN-WK.

           IF IO-FG = 0
              PERFORM SETUP-LINE
              MOVE LN-WK TO SUB
              PERFORM SET-TOGGLE-BUFFER.

           MOVE LN-BUF TO D-LINE(LN-WK).
           MOVE SPACE TO LN-BUF.

           IF LN-WK = 8
              GO TO DISPLAY-XFER-DOWN.

           IF IO-FG = 0
              GO TO READ-LPFILE1-NEXT.

           IF FULL-PAGE-FG = "Y"
              MOVE "N" TO FULL-PAGE-FG
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 99999     TO LP-SEQNO
              MOVE LP1-KEY TO HOLD2-KEY-UP
              PERFORM DISPLAY-ENTRY-UP
              GO TO DISPLAY-DOWN-EXIT.

       DISPLAY-XFER-DOWN.
           PERFORM DISPLAY-ALL-LINES.

       DISPLAY-DOWN-EXIT.

           IF IO-FG = 0
              MOVE "Y" TO FULL-PAGE-FG
              MOVE LP1-KEY TO HOLD1-KEY-DOWN
           ELSE
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 99999     TO LP-SEQNO
              MOVE LP1-KEY   TO HOLD1-KEY-DOWN.

           PERFORM CLOSE-LP1-FILE.

      ******************************************************************
       DISPLAY-ENTRY-UP SECTION.
      ******************************************************************

           MOVE " " TO LINE-BUF LN-BUF.
           MOVE 9 TO LN-WK.
           MOVE "Y" TO TOGGLE-FIRST-TIME.
           MOVE HOLD2-KEY-UP TO LP1-KEY.

           IF LP-SEQNO = 0
              MOVE 9 TO IO-FG
              GO TO DISPLAY-UP-EXIT.

           MOVE LP1-KEY TO HOLD1-KEY-DOWN.
           PERFORM OPEN-LP1-FILE.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  DEFAULT THE WBEG AND WEND
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE LP-PATH-OWNBR TO QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO.
           MOVE LP-ACCTNO     TO QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           MOVE ALL "0"       TO QLP1-WBEG-SEQNO.
           MOVE LP-SEQNO      TO QLP1-WEND-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.
           MOVE 0 TO ENTRY-FLAG.

       READ-LPFILE2-NEXT.

           IF ENTRY-FLAG = 2
              MOVE 9 TO IO-FG
              GO TO BYPASS-LPFILE2-READ.

           PERFORM READ-LP1-FILE-PREVIOUS.
           IF IO-FG = 0
              IF (LP-ACCTNO NOT = LN-ACCTNO) OR
                   (LP-BRNO NOT = LP-PATH-OWNBR)
                 ADD 1 TO ENTRY-FLAG
                 GO TO READ-LPFILE2-NEXT.

       BYPASS-LPFILE2-READ.

           SUBTRACT 1 FROM LN-WK.

           IF LN-WK < 1
              MOVE "Y" TO FULL-PAGE-FG
              GO TO DISPLAY-XFER-UP.

           IF IO-FG = 0
              PERFORM SETUP-LINE
              MOVE LN-WK TO SUB
              PERFORM SET-TOGGLE-BUFFER.

           MOVE LN-BUF TO D-LINE(LN-WK).
           MOVE SPACE TO LN-BUF.

           IF IO-FG = 0
              GO TO READ-LPFILE2-NEXT.

           IF FULL-PAGE-FG = "Y"
              MOVE "N" TO FULL-PAGE-FG
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 0         TO LP-SEQNO
              MOVE LP1-KEY   TO HOLD1-KEY-DOWN
              PERFORM DISPLAY-ENTRY-DOWN
              GO TO DISPLAY-UP-EXIT.

       DISPLAY-XFER-UP.
           PERFORM DISPLAY-ALL-LINES.

       DISPLAY-UP-EXIT.

           IF IO-FG = 0
              MOVE "Y"     TO FULL-PAGE-FG
              MOVE LP1-KEY TO HOLD2-KEY-UP
           ELSE
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 0         TO LP-SEQNO
              MOVE LP1-KEY TO HOLD2-KEY-UP.

           PERFORM CLOSE-LP1-FILE.

      ******************************************************************
       DISPLAY-ENTRY-UP-BRIEF SECTION.
      ******************************************************************

           MOVE " " TO LINE-BUF LN-BUF.
           MOVE "Y" TO TOGGLE-FIRST-TIME.
           MOVE HOLD2-KEY-UP TO LP1-KEY.

           PERFORM OPEN-LP1-FILE.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  DEFAULT THE WBEG AND WEND
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE LP-PATH-OWNBR TO QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO.
           MOVE LP-ACCTNO     TO QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           MOVE ALL "0"       TO QLP1-WBEG-SEQNO.
           MOVE LP-SEQNO      TO QLP1-WEND-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.

       START-LPFILE2-BRIEF-NEXT.

           PERFORM READ-LP1-FILE-PREVIOUS.
           IF IO-FG = 0
              IF (LP-ACCTNO = LN-ACCTNO) AND (LP-BRNO = LP-PATH-OWNBR)
                 IF LP-TRCD = "RV" OR LP-REV NOT = " "
                    GO TO START-LPFILE2-BRIEF-NEXT
                 ELSE
                    PERFORM SETUP-LINE
                    MOVE LN-BUF  TO D-LINE(1)
                    MOVE 1       TO SUB
                    PERFORM SET-TOGGLE-BUFFER
                    PERFORM DISPLAY-ALL-LINES.

       EXIT-DISPLAY-ENTRY-UP-BRI.
           EXIT.

      ******************************************************************
       SETUP-LINE SECTION.
      ******************************************************************

           MOVE " " TO LN-BUF.

           IF LP-APCUR > 99999.99 OR LP-APCUR < -99999.99
              PERFORM SETUP-LINE2
              GO TO EXIT-SETUP-LINE.

           IF ( TOGGLE-DATE-PAYDATE )
              MOVE LP-PAYDATE TO DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY TO L-010
           ELSE
              MOVE LP-TRDATE TO DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY TO L-010.

           IF LP-TRDATE NOT = LP-PAYDATE
              IF ( TOGGLE-DATE-PAYDATE )
                 MOVE "."          TO L-DATE-SIGNAL
              ELSE
      * LOWER CASE T
                 MOVE X'74' TO L-DATE-SIGNAL.

           MOVE LP-TRCD TO L-020.

           MOVE LP-REFNO TO L-030 LPWSLP-LP-REFNO.

           IF LP-TRCD  = "JD" OR "AC" OR "IR"
              MOVE LP-NEWSTAT-RATE TO L-040RATE
           ELSE
           IF (LP-TRCD = "P4" OR "P5") AND
              (LP-DLNO NOT = 0)
              MOVE "D" TO L-040D
              MOVE LP-DLNO TO L-040DLNO
           ELSE
              MOVE LP-TRAMT TO L-040
              IF ((LP-TRCD = "RT" OR "ET" OR "LP" OR "NP" OR "ST") OR
                     (LP-TRCD = "RV" AND
                       (LPWSLP-LP-ADDON-TEXT = "ADD" OR "ADJ" OR "CNL")
                      )
                  )
                 IF LP-IBPC = "P"
                    MOVE LP-APCUR TO L-040.

           ADD LP-APOTH LP-APOT2 GIVING L-050.
           IF (  (LP-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO")
                 OR ( (LP-TRCD = "RV") AND
                         (LP-REVTRCD = "PB" OR "RN" OR "SC"
                                            OR "RB" OR "RO")
                    )
              )  AND (LP-APOT2 NOT = 0)
              INSPECT L-050 REPLACING TRAILING " " BY "*".

           ADD LP-APINT LP-APLC GIVING L-060.
           MOVE LP-APCUR TO L-070.
           IF (LP-TRCD = "AP") 
              MOVE LP-APINTOWE TO L-050
              ADD LP-LCPARTIALS LP-INTDUE GIVING L-060
              COMPUTE L-070 = 0 - LP-APINTOWE
                                - LP-INTDUE
                                - LP-LCPARTIALS
           ELSE
              IF ((LP-TRCD = "RT" OR "ET" OR "LP" OR "NP" OR "ST") OR
                   (LP-TRCD = "RV" AND
                     (LPWSLP-LP-ADDON-TEXT = "ADD" OR "ADJ" OR "CNL")
                    )
                  )
                 IF LP-IBPC = "P"
                    MOVE LP-TRAMT TO L-070.

      * 5/8/97 BAH ALWAYS DISPLAY BALANCE, #487
      * 8/11/98 SUPPRESS BALANCE IF ENV 'RVLINES' IS SET (MJD AS PER JTG)
           IF (LP-TRCD = "RV" OR LP-REV NOT = " ") AND
               NOT (LP-TRCD = "RV" AND LP-REVSEQNO = 0) AND
                   DISP-REV-BAL = "N"
              MOVE "*" TO L-120
           ELSE
              MOVE LP-PDTH-DATE TO NUM-DATE
              MOVE NUM-MO TO L-080-MO
              IF LN-UNITPER-CD-DAYS
                 MOVE NUM-DA TO L-080-DAYR
              ELSE
                 MOVE NUM-YR TO L-080-DAYR
              END-IF
              COMPUTE L-090 = LP-OTHBAL + LP-OT2BAL
              ADD LP-INTBAL LP-LCBAL GIVING L-100
              MOVE LP-CURBAL TO L-110
              IF (LP-TRCD = "RV" OR LP-REV NOT = " ") AND
                      NOT (LP-TRCD = "RV" AND LP-REVSEQNO = 0)
              MOVE "*" TO L-120.

       EXIT-SETUP-LINE.
           EXIT.

      ******************************************************************
       SETUP-LINE2 SECTION.
      ******************************************************************

           IF ( TOGGLE-DATE-PAYDATE )
              MOVE LP-PAYDATE TO DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY TO L2-010
           ELSE
              MOVE LP-TRDATE  TO DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY TO L2-010.


           IF LP-TRDATE NOT = LP-PAYDATE
              IF ( TOGGLE-DATE-PAYDATE )
                 MOVE "."          TO L2-DATE-SIGNAL
              ELSE
      * LOWER CASE T
                 MOVE X'74' TO L2-DATE-SIGNAL.

           MOVE LP-TRCD  TO L2-020.

           MOVE LP-REFNO TO L2-030 LPWSLP-LP-REFNO.

           IF LP-TRCD  = "JD" OR "AC" OR "IR"
              MOVE LP-NEWSTAT-RATE TO L2-040RATE
           ELSE
           IF (LP-TRCD = "P4" OR "P5")
                     AND (LP-DLNO NOT = 0)
              MOVE "D" TO L2-040D
              MOVE LP-DLNO TO L2-040DLNO
           ELSE
              MOVE LP-TRAMT TO L2-040
              IF ((LP-TRCD = "RT" OR "ET" OR "LP" OR "NP" OR "ST") OR
                   (LP-TRCD = "RV" AND
                     (LPWSLP-LP-ADDON-TEXT = "ADD" OR "ADJ" OR "CNL")
                    )
                 )
                 IF LP-IBPC = "P"
                    MOVE LP-APCUR TO L2-040.

           ADD LP-APOTH LP-APOT2 GIVING L2-050.
           IF (  (LP-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO")
                 OR ( (LP-TRCD = "RV") AND
                         (LP-REVTRCD = "PB" OR "RN" OR "SC"
                                            OR "RB" OR "RO")
                    )
              )  AND (LP-APOT2 NOT = 0)
              INSPECT L2-050 REPLACING TRAILING " " BY "*".

           ADD LP-APINT LP-APLC GIVING L2-060.
           MOVE LP-APCUR TO L2-070.
           IF (LP-TRCD = "AP") 
              MOVE LP-APINTOWE TO L2-050
              ADD LP-LCPARTIALS LP-INTDUE GIVING L2-060
              COMPUTE L2-070 = 0 - LP-APINTOWE
                                 - LP-INTDUE
                                 - LP-LCPARTIALS
           ELSE
              IF ((LP-TRCD = "RT" OR "ET" OR "LP" OR "NP" OR "ST") OR
                   (LP-TRCD = "RV" AND
                     (LPWSLP-LP-ADDON-TEXT = "ADD" OR "ADJ" OR "CNL")
                   )
                 )
                 IF LP-IBPC = "P"
                    MOVE LP-TRAMT TO L2-070.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * 5/8/97 BAH ALWAYS DISPLAY BALANCE, #487
      * 8/11/98 SUPPRESS BALANCE IF ENV 'RVLINES' IS SET (MJD AS PER JTG)
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF (LP-TRCD = "RV" OR LP-REV NOT = " ") AND
               NOT (LP-TRCD = "RV" AND LP-REVSEQNO = 0) AND
                  DISP-REV-BAL = "Y"
              MOVE "*" TO L2-120
           ELSE
              COMPUTE L2-090 = LP-OTHBAL + LP-OT2BAL
              ADD LP-INTBAL LP-LCBAL GIVING L2-100
              MOVE LP-CURBAL TO L2-110
              IF (LP-TRCD = "RV" OR LP-REV NOT = " ") AND
                             NOT (LP-TRCD = "RV" AND LP-REVSEQNO = 0)
                 MOVE "*" TO L2-120.

       EXIT-SETUP-LINE2.
           EXIT.

      **********************************************
       TEST-VALID-CLASS-TSTP SECTION.
      **********************************************
           MOVE LP-TOCL TO LC-CODE.
           PERFORM READ-LC1-FILE.
           IF IO-FG NOT = 0
                 OR (LC-SERVACCT NOT = "Y" AND LP-TRCD = "TS")
                  OR (LC-SERVACCT = "Y" AND LP-TRCD = "TP")
                   OR (LC-SALEFIN NOT = "Y" AND LP-TRCD = "TP")
                    OR (LC-LOANTYPE NOT = LN-LOANTYPE)
              MOVE 9 TO IO-FG
              GO TO TEST-VALID-CLASS-TSTP-EXIT.

           PERFORM OPEN-SP1-FILE.

      *------------------------------------------------------
      *    NEW LOGIC TO ASSURE A MATCHING SPR RECORD EXISTS
      *------------------------------------------------------
           MOVE LN-ORGST TO SP-ORGST.
           MOVE LP-TOCL TO SP-SPRCLASS.
           MOVE LN-SUBCLASS TO SP-SUBCLASS.
           MOVE LN-LAWCODE TO SP-LAWCODE.
           PERFORM READ-SP1-FILE.
           IF IO-FG = 9
              MOVE "MATCHING SPR RECORD FOR 'TO' CLASS MISSING"
                                                       TO MESS
              PERFORM SEND-MESS
           ELSE
              IF SP-EFFDATE > LN-LOANDATE
                 MOVE 9 TO IO-FG
                 MOVE "LOAN DATE IS PRIOR TO SPR EFFECTIVE DATE"
                                                        TO MESS
                 PERFORM SEND-MESS
              END-IF
              IF SP-EXPDATE NOT = 0
                 IF SP-EXPDATE NOT > LN-LOANDATE
                    MOVE 9 TO IO-FG
                    MOVE
                    "LOAN DATE IS ON OR AFTER THE SPR EXPIRATION DATE"
                                                              TO MESS
                    PERFORM SEND-MESS.

           GO TO TEST-VALID-CLASS-TSTP-EXIT.

       TEST-VALID-CLASS-TSTP-EXIT.
           PERFORM CLOSE-SP1-FILE.


      **********************************************
       REFNO-SCAN SECTION.
      **********************************************

           MOVE "BS"   TO CDSCAN-TYPE.
           MOVE SPACES TO CDSCAN-CODE.

           MOVE "WI/CDSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CDSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF CDSCAN-STATUS NOT = "00" OR CDSCAN-CODE = SPACES
              MOVE 9 TO IO-FG
              GO TO EXIT-REFNO-SCAN.

           MOVE 0 TO IO-FG.

           MOVE "S  A050030."   TO VDU.
           MOVE CDSCAN-CODE TO VDUBUF.
           PERFORM SCREENIO.

           MOVE CDSCAN-CODE TO VDUBUF.

       EXIT-REFNO-SCAN.
           EXIT.

      **********************************************
       TC2SCN-SCAN SECTION.
      **********************************************

           MOVE "TC"    TO TC2SCN-TYPE.
           MOVE LP-TRCD TO TC2SCN-CODE.
           MOVE SPACES  TO TC2SCN-REFNO.

           MOVE "WI/TC2SCN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH TC2SCN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.

           IF TC2SCN-REFNO    = SPACES 
              MOVE 9 TO IO-FG
              GO TO TC2SCN-SCAN-EXIT.

           MOVE "S  A050030."   TO VDU.
           MOVE TC2SCN-REFNO    TO VDUBUF.
           PERFORM SCREENIO.

           MOVE 0               TO IO-FG.
           MOVE TC2SCN-REFNO    TO VDUBUF.
           MOVE "00"            TO VDUSTATUS.

       TC2SCN-SCAN-EXIT.
           EXIT.

      ******************************************************************
       SCAN-POOLID SECTION.
      ******************************************************************

           MOVE 0 TO IO-FG.

           MOVE "PL"   TO CDSCAN-PL-TYPE.
           MOVE ZEROES TO CDSCAN-PL-POOLID.
           MOVE SPACES TO CDSCAN-PL-FILLER.

           MOVE "WI/CDSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CDSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF (CDSCAN-STATUS NOT = "00") OR (CDSCAN-PL-POOLID = ZEROES)
              MOVE 9 TO IO-FG
              GO TO EXIT-SCAN-POOLID.

           MOVE "SNNN050030." TO VDU.
           MOVE CDSCAN-PL-POOLID TO VDUNUM0.
           PERFORM SCREENIO.

           MOVE CDSCAN-PL-POOLID TO VDUNUM0.
           MOVE "00" TO VDUSTATUS.

       EXIT-SCAN-POOLID.
           EXIT.

      **********************************************
       DEALER-SCAN SECTION.
      **********************************************
           MOVE 0 TO DLSCAN-NUM.
           MOVE "WI/DLSCAN " TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH DLSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
      
           IF DLSCAN-STATUS NOT = "00" OR DLSCAN-NUM = " "
               MOVE 9 TO IO-FG
               GO TO EXIT-DEALER-SCAN.

           MOVE "SNNN042DLNO." TO VDU.
           MOVE DLSCAN-DLNO TO VDUNUM2.
           PERFORM SCREENIO.
           MOVE DLSCAN-DLNO TO VDUNUM2.
           MOVE 0 TO IO-FG.

       EXIT-DEALER-SCAN.
           EXIT.

      *********************************
       CDV-VERIFY SECTION.
      *********************************
           MOVE 0 TO CDV-SUB.

       CDV-VERIFY-NEXT.
           ADD 1 TO CDV-SUB.
           MOVE CDV-CD(CDV-SUB) TO STAT.
           IF STAT = LP-TRCD
              GO TO CDV-VERIFY-EXIT.

           IF STAT NOT = " "
              GO TO CDV-VERIFY-NEXT.

           MOVE 0 TO CDV-SUB.

       CDV-VERIFY-EXIT.
           EXIT.

      *************************************
       SAVE-SCREEN SECTION.
      *************************************
           MOVE 3 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           IF MENU-RESUME = "Y"
              MOVE "N" TO MENU-RESUME
              IF WK-OLD-PROG-FORM = " "
                 MOVE 99 TO MENU-FG
                 GO TO EXIT-SAVE-SCREEN
              ELSE
                 MOVE WK-OLD-PROG-FORM TO NEW-PROG-FORM OLD-PROG-FORM
                 MOVE " " TO WK-OLD-PROG-FORM.

           MOVE ELE    TO WK-ELE.

      * SAVE RECORDS IN THE WORK FILE

           MOVE LP-REC  TO WK-LP-REC.

      * COMBINED LX-REC
           MOVE LX-REC TO WK-LX-REC.
      * GL DISTRIBUTION LXG-REC
           MOVE LXG-REC TO WK-LXG-REC.

      * EARNINGS LXE-REC
           IF SP-ERNFRMLA(1) = 15 OR SP-ERNFRMLA(5) = 16
              MOVE LN-ERN-IB-INTOWE TO LXE-WORKER
           ELSE
              MOVE 0                TO LXE-WORKER.

           MOVE LXE-REC TO WK-LXE-REC.

           PERFORM REWRITE-WK-FILE.
       EXIT-SAVE-SCREEN.
           PERFORM CLOSE-WK-FILE.

      ******************************************
       RESTORE-SCREEN SECTION.
      ******************************************
           MOVE 3 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF NEW-FORM NOT = OLD-FORM
              MOVE OLD-PROG-FORM TO WK-OLD-PROG-FORM
              MOVE NEW-PROG-FORM TO OLD-PROG-FORM.
           IF IO-FG = 0
              GO TO RESTORE-CLEAR.
           MOVE " " TO WK-SAVE-RECORD.
           MOVE 0 TO WK-ELE.
           PERFORM WRITE-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           GO TO EXIT-RESTORE-SCREEN.
       RESTORE-CLEAR.
           MOVE WK-SAVE-RECORD TO LN-REC.
           MOVE WK-LP-REC      TO LP-REC.

      * LX TRAILERS
           MOVE WK-LX-REC      TO LX-REC.
           MOVE WK-LXG-REC     TO LXG-REC.
           MOVE WK-LXE-REC     TO LXE-REC.
           MOVE 0 TO WK-ELE.
           PERFORM REWRITE-WK-FILE.

       EXIT-RESTORE-SCREEN.
           PERFORM CLOSE-WK-FILE.


      ********************************************************
       DF-EXCEED-MAX SECTION.
      ********************************************************
       DF-QUESTION.
           MOVE " " TO DF-BUF.
           IF (SP-DEFPOLCD = " " OR SP-DEFPOLCD = "B")
                                AND SP-DEFPOLMX(1) = 0
                                AND SP-DEFPOLMX(2) = 0
              MOVE "DEFERMENTS NOT ALLOWED" TO MESS
              PERFORM SEND-LEGEND
              GO TO EXIT-DF-EXCEED-MAX
           ELSE
              MOVE "DEFERMENTS EXCEED MAXIMUM, CONTINUE ? (Y/N):"
                                                         TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "R RA060SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS NOT = "00"
              GO TO DF-QUESTION.
           MOVE VDUBUF TO DF-BUF.
           IF NOT (DF-ANSWER = "Y" OR "N")
              GO TO DF-QUESTION.
           MOVE " " TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "S  A000SEL." TO VDU.
           PERFORM SCREENIO.
           IF DF-ANSWER = "Y"
              MOVE DF1-SEQ TO PASSWDW-SEQ
              MOVE "TO EXCEED MAXIMUM DEFERMENTS" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "N" TO DF-ANSWER
              ELSE
                 MOVE "Y" TO MAX-DEFER-FG.

       EXIT-DF-EXCEED-MAX.
           EXIT.

      ******************************************
       VALIDATE-DEL-POLICY SECTION.
      ******************************************

      * VALIDATE ALLOWABLE DELINQUENCY POLICY
           MOVE " " TO DEL-MAXIMUM.
           MOVE LP-TRCD TO TRCD-WORKER.
           IF TRCD-FTST = "F"
              MOVE "1" TO TRCD-NODEL.

      * ALWAYS TEST MAXIMUMS
           IF (LN-TOTNOALDEL + TRCD-NODEL) > SP-MAX-ALLOW-DELINQ
             OR (LN-YTDNOALDEL + TRCD-NODEL) > SP-YTD-MAX-ALLOW-DELINQ
              MOVE "ALLOWABLE DELINQUENCY EXCEEDS MAXIMUM" TO MESS
              MOVE "Y" TO DEL-MAXIMUM
              GO TO EXIT-VALIDATE-DELINQ.

      * MERCURY:
           IF SP-ALLOW-DELINQ-POLCD = "A"
              MOVE LN-1STPYDATE TO CEPP1-DATE
              MOVE TRANS-DATE TO CEPP2-DATE
              ADD TRCD-NODEL TO LN-TOTNOALDEL
              PERFORM CONTRACTUAL-DELINQUENCY
              SUBTRACT TRCD-NODEL FROM LN-TOTNOALDEL
      * DO NOT ALLOW AN "AD" UNLESS IT MAKES THE ACCOUNT CURRENT WITHIN
      * 1 REGULAR PAYMENT (NO ONE IS ON THE MONEY!)
              IF NOT (CDEL-DELINQUENT >= 0 AND
                       CDEL-DELINQUENT <= LN-REGPYAMT)
                 MOVE "MUST MAKE ACCOUNT CURRENT" TO MESS
                 MOVE "Y" TO DEL-MAXIMUM
              ELSE
      *    ONLY ALLOW IF THE SUM OF TOTAL MONIES RECEIVED IN THE LAST
      *    4 MONTHS IS EQUAL TO OR GREATER THAN 3 CONTRACTUAL PAYMENTS
                 MOVE LP-REC TO WK-LP-REC
                 PERFORM VALIDATE-DEL-A-PAYMENTS
                 MOVE WK-LP-REC TO LP-REC
                 IF DEL-TRAMT < (LN-REGPYAMT * 3)
                    MOVE "ALLOWABLE DELINQUENCY POLICY NOT MET"
                       TO MESS
                    MOVE "Y" TO DEL-MAXIMUM.

       EXIT-VALIDATE-DELINQ.
           EXIT.

      *************************************************
       VALIDATE-DEL-A-PAYMENTS SECTION.
      *************************************************
           MOVE 0 TO DEL-TRAMT.

      * SET DATE 4 MONTHS BACK FROM TODAY
           MOVE TRANS-DATE TO NDTE-DATE.
           MOVE -4 TO NDTE-HOLD.
           PERFORM INCREMENT-MONTHS.

           PERFORM OPEN-LP1-FILE.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  DEFAULT THE WBEG AND WEND
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE LP-PATH-OWNBR TO LP-BRNO
                                 QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO.
           MOVE LN-ACCTNO     TO LP-ACCTNO
                                 QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           MOVE ALL "0"       TO QLP1-WBEG-SEQNO.
           MOVE 99999         TO LP-SEQNO
                                 QLP1-WEND-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.

       VALIDATE-DEL-A-PAYMENTS-NEXT.
           PERFORM READ-LP1-FILE-PREVIOUS.
           IF IO-FG NOT = 0
              GO TO EXIT-VALIDATE-DEL-A.

           IF (LP-BRNO NOT = LP-PATH-OWNBR) OR
                (LP-ACCTNO NOT = LN-ACCTNO)
              GO TO EXIT-VALIDATE-DEL-A.

           IF LP-TRCD = "RV" OR LP-REV = "Y"
              GO TO VALIDATE-DEL-A-PAYMENTS-NEXT.
           IF LP-TRCD = "PY" OR "PA" OR "PO" OR "AH" OR "Z2" OR
                        "DF" OR "D2" OR "D3" OR "D4" OR "D5" OR
                        "D6" OR "D7" OR "D8" OR "D9"
      * IS DATE WITHIN LAST 4 MONTHS
              IF LP-PAYDATE NOT < NDTE-DATE
                 ADD LP-TRAMT TO DEL-TRAMT
              ELSE
                 GO TO EXIT-VALIDATE-DEL-A.

           GO TO VALIDATE-DEL-A-PAYMENTS-NEXT.
       EXIT-VALIDATE-DEL-A.
           PERFORM CLOSE-LP1-FILE.


      *******************************************************
       VERIFY-PASSWORD SECTION.
      *******************************************************
           MOVE " " TO PASSWDW-STAT.
           MOVE "LONPF1" TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           IF PASSWDW-SEQ = DF-SEQ
              MOVE "TO OVERRIDE DEFERMENT POLICY" TO PASSWDW-PROMPT2
           ELSE
           IF PASSWDW-SEQ = SX-SEQ
              MOVE "TO SET ACCOUNT IN REPO STATUS" TO PASSWDW-PROMPT2
           ELSE
           IF PASSWDW-SEQ = SV-SEQ
              MOVE "TO TAKE ACCOUNT OUT OF REPO" TO PASSWDW-PROMPT2.
           MOVE "CL/PASSWD" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.

      *******************************************************
      * PASSWORD MUST EXIST SECTION
      *   LIKE VERIFY PASSWORD, BUT WILL GIVE BAD STATUS IF
      *   PASSWORD NOT IN FILE AND THE ENTER FLAG NOT 'Y'
      *   WILL ASK FOR PASSWORD & ACT JUST LIKE VERIFY
      *******************************************************
       PASSWORD-MUST-EXIST-AND-FLAGGED SECTION.
           MOVE "EN" TO PASSWDW-STAT.
           MOVE "LONPF1" TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           MOVE "CL/PASSWD" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.

      *******************************************************
      * PASSWORD MUST EXIST SECTION
      *   LIKE VERIFY PASSWORD, BUT WILL GIVE BAD STATUS IF
      *   PASSWORD NOT IN FILE.  IF PASSWORD IN FILE, WILL
      *   ASK FOR PASSWORD & ACT JUST LIKE VERIFY
      *******************************************************
       PASSWORD-MUST-EXIST SECTION.
           MOVE "EX" TO PASSWDW-STAT.
           MOVE "LONPF1" TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           MOVE "CL/PASSWD" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.

      ****************************
        P4P5-TEST SECTION.
      ****************************
           MOVE "OK" TO VDUSTATUS.
           IF BR-AC-BEFORE-P4P5 NOT = "N"
                 AND IBPC-FG = "P"
                  AND LN-ACCELDATE = 0
              MOVE "ACCOUNT MUST BE ACCELERATED BEFORE 'P4' OR 'P5'"
                                                           TO MESS
              MOVE " " TO VDUSTATUS
           ELSE
           IF BR-RI-BEFORE-P4P5 NOT = "N"
                 AND IBPC-FG = "P"
                  AND (NOT (LN-INT-REBATE = "Y" OR "R"))
              MOVE "INTEREST MUST BE REBATED BEFORE 'P4' OR 'P5'"
                                                           TO MESS
              MOVE " " TO VDUSTATUS.

      ******************************************************************
       DISPLAY-ENTRY-UP-OPT SECTION.
      ******************************************************************

      * DISPLAY LAST TWO PAYMENTS WITH LAST/NEXT/TODAY NUMBERS

           MOVE " "          TO LINE-BUF LN-BUF.
           MOVE "Y"          TO TOGGLE-FIRST-TIME.

           PERFORM OPEN-LP1-FILE.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  DEFAULT THE WBEG AND WEND
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE HOLD2-KEY-UP  TO LP1-KEY.
           MOVE LP-PATH-OWNBR TO QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO.
           MOVE LP-ACCTNO     TO QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           MOVE ALL "0"       TO QLP1-WBEG-SEQNO.
           MOVE LP-SEQNO      TO QLP1-WEND-SEQNO.

           MOVE 2            TO OPT-SUB.

           MOVE LP1-KEY TO HOLD1-KEY-DOWN.

           PERFORM START-LP1-FILE-NOT-GREATER.

       START-LPFILE2-OPT-NEXT.

           PERFORM READ-LP1-FILE-PREVIOUS.
           IF IO-FG = 0
              IF (LP-ACCTNO = LN-ACCTNO) AND (LP-BRNO = LP-PATH-OWNBR)
                 PERFORM SETUP-LINE
                 MOVE LN-BUF  TO D-LINE(OPT-SUB)
                 MOVE OPT-SUB TO SUB
                 PERFORM SET-TOGGLE-BUFFER.

           IF OPT-SUB = 2
              MOVE 1 TO OPT-SUB
              GO TO START-LPFILE2-OPT-NEXT.

           IF D-LINE(1) = SPACES
              MOVE D-LINE(2) TO D-LINE(1)
              MOVE SPACES TO D-LINE(2)
              MOVE 0      TO LP-SEQNO
              MOVE LP1-KEY TO HOLD2-KEY-UP.

           PERFORM CREATE-NO-REC.
           PERFORM SEND-DUE-DAYS.
           PERFORM DISPLAY-ALL-LINES.

       EXIT-DISPLAY-ENTRY-UP-OPT.
           EXIT.

      **************************************************
       SEND-DUE-DAYS SECTION.
      **************************************************
           MOVE "LAST  DUE:" TO DUE-PROMPT
           MOVE NO-LDUE-DATE TO DATE-YYYYMMDD
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
           MOVE DATE-MMDDYY TO DUE-DATE-DUE
           MOVE NO-LDUELC    TO DUE-LCAMT.
           IF LN-MIP-FG = "Y"
              MOVE NO-LDUE-DATE TO POFF-PAYDATE
              PERFORM DETERMINE-MIP-REQUIRED
              IF LN-MIP-CLPDTH-DATE NOT = NO-LDUE-DATE
                 ADD POFF-LXM-MIP-CLPAID TO NO-LDUECONTR NO-LDUEAMT
              END-IF
              IF LN-MIP-AHPDTH-DATE NOT = NO-LDUE-DATE
                 ADD POFF-LXM-MIP-AHPAID TO NO-LDUECONTR NO-LDUEAMT
              END-IF
           END-IF
           IF GP-NO-LC-IN-ARREARAGE
              MOVE NO-LDUECONTR TO DUE-AMOUNT
           ELSE
              MOVE NO-LDUEAMT TO DUE-AMOUNT
           END-IF
           MOVE DUE-LINE TO D-OPT-LINE(4).

           MOVE "TODAY DUE:" TO DUE-PROMPT.
           MOVE NO-TDUE-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO DUE-DATE-DUE.
           MOVE NO-TDUELC    TO DUE-LCAMT.
           IF LN-MIP-FG = "Y"
              MOVE NO-TDUE-DATE TO POFF-PAYDATE
              PERFORM DETERMINE-MIP-REQUIRED
    
              IF POFF-LXM-MIP-CLPAID NOT = 0
                 MOVE LN-MIP-CLPDTH-DATE TO NDTE-DATE
                 MOVE 1             TO NDTE-HOLD
                 PERFORM INCREMENT-MONTHS
                 IF NO-TDUE-DATE NOT < NDTE-DATE
                    ADD POFF-LXM-MIP-CLPAID
                                 TO NO-TDUECONTR NO-TDUEAMT
                 END-IF
              END-IF
    
              IF POFF-LXM-MIP-AHPAID NOT = 0
                 MOVE LN-MIP-AHPDTH-DATE TO NDTE-DATE
                 MOVE 1             TO NDTE-HOLD
                 PERFORM INCREMENT-MONTHS
                 IF NO-TDUE-DATE NOT < NDTE-DATE
                    ADD POFF-LXM-MIP-AHPAID
                                 TO NO-TDUECONTR NO-TDUEAMT
                 END-IF
              END-IF.

      *    IF GP-I-AM-SOAUTO OR GP-I-AM-FFG
      *       IF (LN-OTHBAL + NO-TDUECONTR) < NO-TDUEPOFF
      *          ADD LN-OTHBAL TO NO-TDUECONTR.
      *    IF GP-I-AM-SOAUTO OR GP-I-AM-FFG
      *       IF (LN-OTHBAL + NO-TDUEAMT) < NO-TDUEPOFF
      *          ADD LN-OTHBAL TO NO-TDUEAMT.

      * IF ACCOUNT HAS A DUE DAY OF 29,30 OR 31 AND THAT DATE DOES NOT EXIST
      * IN THE CURRENT MONTH, ON THE LAST DAY OF THE MONTH, ADD IN A REGULAR
      * PAYMENT TO THE DUE AMOUNT
           IF GP-DUE-29-30-31 = "Y"
              IF LN-1STPYDA = 29 OR 30 OR 31
      * FIRST GET LAST DAY OF CURRENT MONTH
                 MOVE TRANS-DATE TO NDTE-DATE
                 MOVE 31 TO NDTE-DD
                 PERFORM NEW-DATE-CALCULATION
      * CHECK TO SEE IF TODAY IS LAST DAY OF CURRENT MONTH
                 IF NDTE-DATE = TRANS-DATE
      * IF SO, DOES THE DUE DAY EXIST IN THIS MONTH ?
                    IF LN-1STPYDA > NDTE-DD
                       ADD LN-REGPYAMT TO NO-TDUECONTR NO-TDUEAMT.

           IF GP-NO-LC-IN-ARREARAGE
              MOVE NO-TDUECONTR TO DUE-AMOUNT
           ELSE
              MOVE NO-TDUEAMT TO DUE-AMOUNT.
           MOVE DUE-LINE TO D-OPT-LINE(5).

           MOVE "NEXT  DUE:" TO DUE-PROMPT.
           MOVE NO-NXDUE-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY   TO DUE-DATE-DUE.
           MOVE NO-NXDUELC    TO DUE-LCAMT.
           IF LN-MIP-FG = "Y"
              MOVE NO-NXDUE-DATE TO POFF-PAYDATE
              PERFORM DETERMINE-MIP-REQUIRED
              ADD POFF-LXM-MIP-CLPAID
                  POFF-LXM-MIP-AHPAID TO NO-NXDUECONTR
                                         NO-NXDUEAMT.
           IF GP-NO-LC-IN-ARREARAGE
              MOVE NO-NXDUECONTR TO DUE-AMOUNT
           ELSE
              MOVE NO-NXDUEAMT TO DUE-AMOUNT.
           MOVE DUE-LINE TO D-OPT-LINE(6).

           IF LN-CURBAL NOT = 0
              MOVE NO-PDTH-DATE TO NDTE-DATE
              MOVE LN-UNITPER-CD TO DATER-UNITPER-CD
              MOVE LN-UNITPER-FREQ TO DATER-UNITPER-FREQ
              MOVE 1 TO NDTE-HOLD
              PERFORM INCREMENT-UNITPER
      * NDTE-DATE YYYYMMDD TO MMDD OR MMYY
              IF NOT LN-UNITPER-CD-DAYS
                 MOVE NDTE-YY TO NDTE-DD
              END-IF
           ELSE
              MOVE 0 TO NO-DEFERMENT NDTE-DATE.

           MOVE "DEFERMENT CHARGE FOR " TO DEF-PROMPT.
           MOVE NDTE-DATE TO DEF-DATE.
           MOVE NO-DEFERMENT TO DUE-AMOUNT.
           MOVE DUE-LINE TO D-OPT-LINE(7).

      *****************************************
       CREATE-NO-REC SECTION.
      *****************************************
           MOVE LN-ACCTNO          TO CRNOR2-ACCTNO.
           MOVE TRANS-DATE         TO CRNOR2-SYSDATE.
           MOVE "N"                TO CRNOR2-LPREC-FG.
           MOVE "CL/CRNOR2" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CRNOR2-LINK NO-REC
                                 POFF-WORKERS LN-REC.
           CANCEL FORM-PROGX.
       END-CREATE-NO-REC.
           EXIT.

      ******************************************************************
       SET-TOGGLE-BUFFER SECTION.
      ******************************************************************

           IF ( TOGGLE-FIRST-TIME-YES )
              MOVE "N"    TO TOGGLE-FIRST-TIME
              MOVE SPACES TO TOGGLE-BUFFER
              MOVE SPACES TO TOGGLE-DATES-BUFFER.

           MOVE LP-PAYDATE  TO TOGGLE-PAYDATE   (SUB).
           MOVE LP-TRDATE   TO TOGGLE-TRANS-DATE(SUB).
           MOVE LN-BUF      TO T-LINE           (SUB).

       EXIT-SET-TOGGLE-BUFFER.
           EXIT.

      ******************************************************************
       TOGGLE-ON-DATE SECTION.
      ******************************************************************

           IF ( TOGGLE-DATE-PAYDATE )
              MOVE "T" TO TOGGLE-DATE
           ELSE
              MOVE "P" TO TOGGLE-DATE.

      *    -------------------------------------------------------------
      *    IF WE HAVE RETURNED FROM ANOTHER POSTING PROGRAM AND HOVE NOT
      *    PAGED UP/DOWN THEN WE NEED TO REINITIALIZE THE BUFFERS IN
      *    WORKING STORAGE BY REDISPLAYING THE PAYMENT LINES WITH A PHONEY
      *    PAGE DOWN.
      *    -------------------------------------------------------------
           IF TOGGLE-BUFFER = SPACES
              MOVE HOLD2-KEY-UP TO HOLD1-KEY-DOWN
              PERFORM DISPLAY-ENTRY-DOWN.

           MOVE SPACES TO LINE-BUF.
           MOVE ZEROES TO SUB.

      *=================================================================
       NEXT-TOGGLE-ON-DATE.

           ADD 1 TO SUB.

           IF ( SUB > 8 )
              GO TO END-TOGGLE-ON-DATE.

           IF ( TOGGLE-PAYDATE   (SUB) NOT NUMERIC ) AND
              ( TOGGLE-TRANS-DATE(SUB) NOT NUMERIC )
              GO TO NEXT-TOGGLE-ON-DATE.


           IF TOGGLE-TRANS-DATE(SUB) NOT = TOGGLE-PAYDATE(SUB)
              IF ( TOGGLE-DATE-PAYDATE )
                 MOVE TOGGLE-PAYDATE   (SUB) TO DATE-YYYYMMDD
                 PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
                 MOVE DATE-MMDDYY            TO T-DATE       (SUB)
                 MOVE "."                    TO T-DATE-SIGNAL(SUB)
              ELSE
                 MOVE TOGGLE-TRANS-DATE(SUB) TO DATE-YYYYMMDD
                 PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
                 MOVE DATE-MMDDYY            TO T-DATE       (SUB)
                 MOVE X'74'                  TO T-DATE-SIGNAL(SUB)
           ELSE
              MOVE TOGGLE-PAYDATE      (SUB) TO DATE-YYYYMMDD
              PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
              MOVE DATE-MMDDYY               TO T-DATE       (SUB)
              MOVE SPACES                    TO T-DATE-SIGNAL(SUB).

           MOVE T-LINE(SUB) TO D-LINE(SUB).

           GO TO NEXT-TOGGLE-ON-DATE.

       END-TOGGLE-ON-DATE.

           PERFORM DISPLAY-ALL-LINES.

       EXIT-TOGGLE-ON-DATE.
           EXIT.

      ******************************
      *CHECK-FOR-REINSTATE SECTION.
      ******************************

      *    PERFORM OPEN-ST1-FILE.
      *    PERFORM OPEN-BW1-FILE.

      *    MOVE LN-SSNO(1) TO BW-SSNO.
      *    PERFORM CHECK-REINSTATE-STATE.

      *    MOVE LN-SSNO(2) TO BW-SSNO.
      *    PERFORM CHECK-REINSTATE-STATE.

      *    PERFORM CLOSE-ST1-FILE.
      *    PERFORM CLOSE-BW1-FILE.

      *    GO TO EXIT-CHECK-FOR-REINSTATE.

      *CHECK-REINSTATE-STATE.
      *    PERFORM READ-BW1-FILE.
      *    IF IO-FG = 0
      *       MOVE BW-STATE TO ST-CODE
      *       PERFORM READ-ST1-FILE
      *       IF IO-FG = 0
      *          IF ST-REINSTATE-WINDOW = "Y"
      *             MOVE " " TO REINST-CALLED-CLMENU
      *             MOVE LN-ACCTNO TO REINST-LN-ACCTNO
      *             MOVE EXT-CONAME-DAILY-PASSWORD TO REINST-PASSWD
      *             MOVE ST-CODE TO REINST-STATE
      *             MOVE EXT-WI-CL-WORKER TO REINST-WORKER
      *             MOVE REINST-BUF TO SCAN-BUF
      *             PERFORM CALL-WINDOW-PROGRAM
      *             MOVE SCAN-BUF TO REINST-BUF.

      *EXIT-CHECK-FOR-REINSTATE.
      *    EXIT.

      *****************************************************************
      * VERIFY REFNO
      *
      * VERIFIES LP-REFNO AGAINST CODE FILE TO MAKE SURE VALID
      * CODE IS ENTERRED. THIS IS BASED ON A GLOBAL PARAMETER
      * FLAG (GP-REFNO-VERIFY).
      *
      * IF A DIRECT MATCH IS NOT FOUND THEN A WILDCARD SEARCH WILL
      * BE PERFORMED.
      *
      * EXAMPLE:      INPUT      CODE FILE     MATCH
      *              -------     ---------     -----
      *              "APS12"      "APS12"        Y
      *              "APS12"      "APS??"        Y  (WILDCARD)
      *              "APS  "      "APS??"        N  (SEE NOTE)
      *              "APS12"      "APS  "        N
      *              "APS  "      "APS12"        N
      *
      *   NOTE: "#" DENOTES A WILDCARD THAT CAN TAKE THE VALUE
      *         OF ANY ALPHANUMERIC (EXCLUDING SPACES, INCLUDING
      *         CHARACTERS WITH HEX VALUES > 24H)
      *****************************************************************
       VERIFY-REFNO SECTION.

      *    -------------------------------------------------------------
      *    IF THE GP FLAG IS NOT SET THEN DO NOT PERFORM THE TEST
      *       EXCEPT IF TRCD = "RE" REPO EXPENSE,  REGACC PR#1478
      *    -------------------------------------------------------------
           IF (GP-REFNO-VERIFY NOT = "Y") AND
              (LP-TRCD NOT = "RE"       )
              MOVE "Y" TO WS-MATCH
              GO TO EXIT-VERIFY-REFNO.

      *    -------------------------------------------------------------
      *    WE DO NOT NEED TO VERIFY CERTAIN TRCD'S AS THEY ARE TESTED ELSEWHERE
      *    -------------------------------------------------------------
           IF LP-TRCD = "BK" OR "SP" OR "DC" OR "P2" OR "P3" OR
                        "PR" OR "PC" OR "PP" OR "P4" OR "P5"
              MOVE "Y" TO WS-MATCH
              GO TO EXIT-VERIFY-REFNO.

      *    -------------------------------------------------------------
      *    WE DO NOT NEED TO VERIFY IF THEY ENTER THROUGH THE FIELD
      *       EXCEPT IF TRCD = "RE" REPO EXPENSE,  REGACC PR#1478
      *    -------------------------------------------------------------
           IF (LP-REFNO = " "     ) AND
              (LP-TRCD NOT = "RE" )
              MOVE "Y" TO WS-MATCH
              GO TO EXIT-VERIFY-REFNO.

           MOVE "N" TO WS-MATCH.

      * FIRST LOOK FOR A DIRECT MATCH OF ALL 5 CHARACTERS
           MOVE "BS"     TO CD-TYPE.
           MOVE LP-REFNO TO CD-CODE.
           PERFORM OPEN-CD1-FILE.
           PERFORM READ-CD1-FILE.
           IF IO-FG = 0
              MOVE "Y" TO WS-MATCH
              GO TO EXIT-VERIFY-REFNO.

           MOVE "BS"     TO CD-TYPE.
           MOVE LP-REFNO TO CD-CODE.

           PERFORM START-CD1-FILE-NOT-GREATER.

      * DO NOT HAVE A DIRECT MATCH SO NOW FIND THE CLOSEST ONE AND
      * TEST FOR WILDCARDS
       NEXT-REFNO.
           PERFORM READ-CD1-FILE-PREVIOUS.
           IF IO-FG NOT = 0
              GO TO EXIT-VERIFY-REFNO.

      *    -------------------------------------------------------------
      *  WE HAVE SCANNED PAST THE VALID REFNO CODES INTO ANOTHER TYPE
      *    -------------------------------------------------------------
           IF CD-TYPE NOT = "BS"
              GO TO EXIT-VERIFY-REFNO.

      *    -------------------------------------------------------------
      *    WE HAVE SCANNED PAST ANY VALID MATCHES AND NEED TO GET OUT
      *    -------------------------------------------------------------
           IF LP-REFNO < CD-CODE
              GO TO EXIT-VERIFY-REFNO.

      *    -------------------------------------------------------------
      *    IF THE CODE WE READ DOES NOT HAVE ANY WILDCARDS THEN SKIP
      *    -------------------------------------------------------------
           MOVE CD-CODE TO TEST-BS-REFNO.
           IF NOT (TEST-BS-REFNOX(1) = "#"  OR
                   TEST-BS-REFNOX(2) = "#"  OR
                   TEST-BS-REFNOX(3) = "#"  OR
                   TEST-BS-REFNOX(4) = "#"  OR
                   TEST-BS-REFNOX(5) = "#"   )
              GO TO NEXT-REFNO.

      *    -------------------------------------------------------------
      *    TEST EACH INDIVIDUAL CHARACTER OF REFNO TO DETERMINE A MATCH
      *    -------------------------------------------------------------
           MOVE "Y" TO WS-MATCH.
           MOVE LP-REFNO TO WS-REFNOX.
           PERFORM VARYING WS-SUB FROM 1 BY 1 UNTIL WS-SUB > 5
              IF TEST-BS-REFNOX(WS-SUB) NOT = "#"
                 IF TEST-BS-REFNOX(WS-SUB) NOT = WS-REFNO(WS-SUB)
                    MOVE "N" TO WS-MATCH
                 END-IF
              END-IF
           END-PERFORM.

      * IF NO MATCH IS FOUND THEN GET THE NEXT VALID CODE
           IF WS-MATCH NOT = "Y"
              GO TO NEXT-REFNO.

       EXIT-VERIFY-REFNO.
           PERFORM CLOSE-CD1-FILE.

      *****************************************************
       VERIFY-REFNO-ALPHA-NUMERIC SECTION.
      *****************************************************

      * GP-REFNO-VERIFY = "A", SO NO SPECIAL CHARACTERS IN REFNO:

           MOVE LP-REFNO TO WS-REFNOX.
           MOVE "Y" TO REFNO-OKAY.
           PERFORM VARYING WS-SUB FROM 1 BY 1 UNTIL WS-SUB > 5
              IF WS-REFNO(WS-SUB) NOT ALPHABETIC
                 IF WS-REFNO(WS-SUB) NOT NUMERIC
                    MOVE "N" TO REFNO-OKAY
                 END-IF
              END-IF
           END-PERFORM.

      *****************************************************
       VERIFY-REFNO-TRCD SECTION.
      *****************************************************

      * CHECKS CODE FILE(TC) FOR TRANSACTION CODE AND VALID REFNO
      * FOR THAT TRANSACTION CODE

           IF LP-TRCD = "BK" OR "SP" OR "DC" OR "P2" OR "P3" OR
                        "PR" OR "PC" OR "PP" OR "P4" OR "P5"
              MOVE "Y" TO WS-MATCH
              GO TO VERIFY-REFNO-TRCD-EXIT.

           MOVE "TC"    TO  CD-TYPE.
           MOVE LP-TRCD TO  CD-CODE.
           PERFORM OPEN-CD1-FILE.
           PERFORM READ-CD1-FILE.
           IF IO-GOOD
              MOVE "N" TO WS-MATCH
              PERFORM VARYING TC-SUB FROM 1 BY 1 UNTIL TC-SUB > 10
                    IF LP-REFNO NOT = "~~~~~"
                     IF CD-TC-REFNO(TC-SUB) = LP-REFNO
                        MOVE "Y" TO WS-MATCH
                    END-IF
                   END-IF
              END-PERFORM
           ELSE
              MOVE "Y" TO WS-MATCH.
           PERFORM CLOSE-CD1-FILE.
       VERIFY-REFNO-TRCD-EXIT.
           EXIT.



      ******************************************************************
      *
      *    C O P Y - L I B R A R Y - S E C T I O N S
      *
      ******************************************************************
       COPY "LIBGB/GPENV.CPY".
       COPY "LIBLP/LPIBPC.CPY".
       COPY "LIBLP/LPEARN.CPY".
       COPY "LIBLP/LPMENU.CPY".
       COPY "LIBLP/LPXDTE.CPY".
       COPY "LIBLP/LPMDTE.CPY".
       COPY "LIBWI/PFSWINDOWS.CPY".
       COPY "LIBGB/SCREEN.CPY".
       COPY "LIBGB/DATER.CPY".
       COPY "LIBGB/AGEING.CPY".
       COPY "LIBLP/LPCEPP.CPY".
       COPY "LIBLP/LPUPWK.CPY".
       COPY "LIBGB/SPPDTH.CPY".
       COPY "LIBLP/LPPDUE.CPY".
       COPY "LIBLP/LPDUEDA.CPY".
       COPY "LIBLP/DEFPOL.CPY".
       COPY "LIBLP/LPCDEL.CPY".
       COPY "LIBLP/MIPPO.CPY".
       COPY "LIBLP/LPLPCL.CPY".
       COPY "LIBLP/LPLXCL.CPY".
       COPY "LIBLP/LPLXECL.CPY".
       COPY "LIBLP/LPLXGCL.CPY".


      **************************************************************************
       SETUP-LINK-INFO SECTION.
      **************************************************************************
           IF VDU-FORM-NAME = "LPSMNU"
              MOVE LPSMNU-HELP--FILE TO HELP-LINK-FILE
              MOVE LPSMNU-HELP--DIR  TO HELP-LINK-DIR
           ELSE
              MOVE LONPF-HELP--FILE TO HELP-LINK-FILE
              MOVE LONPF-HELP--DIR TO HELP-LINK-DIR.

      **************************************************************************
       VDU-CONVERT-FIELD SECTION.
      **************************************************************************
           MOVE "00" TO STAT.
           MOVE VDU-FIELD-TO-CONVERT TO VDU-ALP-FIELD.
           EVALUATE TRUE
              COPY "LIBLP/LONPF_EVA.CPY".
              COPY "LIBLP/LPSMNU_EVA.CPY".
              COPY "LIBLP/LPLNMU_EVA.CPY".
              COPY "LIBLP/LPCAMU_EVA.CPY".
              COPY "LIBLP/LPVDMU_EVA.CPY".
              COPY "LIBWI/DLRVNO_EVA.CPY".
              COPY "LIBWI/CONTYN_EVA.CPY".
              COPY "LIBWI/P4P5_EVA.CPY".
              WHEN OTHER       MOVE   "2A" TO STAT
           END-EVALUATE.

      ******************************************************************
       MISCELLANEOUS-ROUTINES SECTION.
      ******************************************************************
       COPY "LIBGB/GETENV.CPY".
       COPY "LIBGB/SYSTEM.CPY".
       FORM-RESET.
       INVALID-MESSAGE.
           MOVE "DEALER / RESERVE MISMATCH" TO MESS.
           PERFORM SEND-MESS.
       GET-SP.
           MOVE LN-ORGST    TO SP-ORGST.
           MOVE LN-SPRCLASS TO SP-SPRCLASS.
           MOVE LN-SUBCLASS TO SP-SUBCLASS.
           MOVE LN-LAWCODE  TO SP-LAWCODE.
           PERFORM OPEN-SP1-FILE.
           PERFORM READ-SP1-FILE.
           PERFORM CLOSE-SP1-FILE.
       GET-GB.
           PERFORM OPEN-GB-FILE.
           MOVE LN-OWNBR TO GB-BRNO.
           MOVE 1        TO GB-NO.
           PERFORM READ-GB-FILE.
           PERFORM CLOSE-GB-FILE.
       GET-BR.
           PERFORM OPEN-BR-FILE.
           PERFORM READ-BR-FILE.
           PERFORM CLOSE-BR-FILE.
       GET-DL.
           PERFORM OPEN-DL1-FILE.
           PERFORM READ-DL1-FILE.
           PERFORM CLOSE-DL1-FILE.
       GET-CD.
           PERFORM OPEN-CD1-FILE.
           PERFORM READ-CD1-FILE.
           PERFORM CLOSE-CD1-FILE.

       CALL-PAYOFF.
           MOVE 0 TO IO-FG.
           MOVE LN-ACCTNO  TO PASS-PRLNNO.
           MOVE LP-PAYDATE TO PASS-TRANS-DATE.
           IF LN-SALEFIN = "Y"
              MOVE "SC"    TO PASS-CURRENT-PD-SRCD
           ELSE
              MOVE "BW"    TO PASS-CURRENT-PD-SRCD.
           MOVE "LP/PAYOFX" TO FORM-NAM.
           MOVE "CALCULATING - PLEASE WAIT" TO MESS.
           PERFORM SEND-LEGEND.
           CALL FORM-PROGX USING FORM-PATH PASS-PAYOFF-FLDS.
           CANCEL FORM-PROGX.

           MOVE " " TO MESS.
           PERFORM SEND-LEGEND.

      *-----------------------------------------------------------------
       DISPLAY-EARNINGS.
           MOVE " " TO EARN-BUF.
           IF HOLD-DISPLAY-ERN = "A"
              ADD HOLD-LN-ACCERN(1) HOLD-LN-ACCERN(2) HOLD-LN-ACCERN(3)
                  HOLD-LN-ACCERN(5) GIVING TOTEARN
              IF NOT(GP-INCL-OTH-IN-EARNED-N OR
                                           GP-INCL-OTH-IN-EARNED-R)
                 ADD HOLD-LN-ACCERN(6) TO TOTEARN
              END-IF
              IF NOT (GP-INCL-OTH-IN-EARNED-R)
                 ADD HOLD-LN-ACCERN(4) TO TOTEARN
              END-IF
              MOVE TOTEARN TO D-TOTEARN
           ELSE
              IF HOLD-DISPLAY-ERN = "U"
                 PERFORM COMPUTE-EARNINGS
                 MOVE EARN-TOT-UNEARN TO D-TOTEARN
              ELSE
                 IF HOLD-DISPLAY-ERN = "T"
                    MOVE HOLD-LN-TOTERN TO D-TOTEARN
                 ELSE
                    IF HOLD-DISPLAY-ERN = "I"
                       COMPUTE D-TOTEARN = NO-LCHG-INTDUE - NO-TDUELC
                    ELSE
                       MOVE LN-TOTPAYMNTD TO D-TOTEARN.
           MOVE LN-YTDINTPD TO D-INTYTD.

           MOVE TRANS-DATE TO IBPC-DATE.
           PERFORM IBPC-TEST.
           IF ( IBPC-FG = "P" OR LN-LOANTYPE = "I" ) AND
              ( LN-ACCELDATE = 0                   ) AND
              ( ( SP-LCFRMLA NOT = " "            ) OR
                ( LN-LC-CODE NOT = ZEROES         ) 
              )
              MOVE LN-LCPDTH-DATE TO NUM-DATE
              MOVE NUM-MO TO D-LCPDTH-MO
              IF LN-UNITPER-CD-DAYS
                 MOVE NUM-DA TO D-LCPDTH-DAYR
              ELSE
                 MOVE NUM-YR TO D-LCPDTH-DAYR.

           MOVE LN-TOTNODEF TO D-DEFMNTS.
           MOVE LN-TOTNOALDEL TO D-ALDEL.
           COMPUTE D-EARNED ROUNDED = LP-EARNED(1) + LP-EARNED(2)
                                    + LP-EARNED(3).
           MOVE LP-DLPROC TO D-DLPROC.
           MOVE EARN-BUF TO WR-BUF.
           MOVE EARN-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.


      **************************************************************************
      *    CLEAR HOLD FIELDS IN LPPFBUF
      *
      * NOTE:
      *       IF TRCD = 'AV' SPACES ARE MOVE TO HOLD-PAY-CK-FIELDS
      *
      * REV:
      * JTG 020308 ADDED "CT" COUNTY TAX CODE KENTUCKY AND PERCENTS
      *            ADDED "CY" CITY   TAX CODE KENTUCKY AND PERCENTS
      *            ADDED HOLD-INS-TAX-RB()  OCCURS 8 S9(7)V99 REFUNDS WORLD #288
      * JTG 020603 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *            ADDED HOLD-LXM-MIP-CLPAID HOLD-LXM-MIP-CLPDTH
      *                  HOLD-LXM-MIP-AHPAID HOLD-LXM-MIP-AHPDTH
      *  CS 160302 CLEAR HOLD-ALT-PREPAY-FG  WORLD PR1140
      **************************************************************************
       CLEAR-HOLD-FIELDS.
           MOVE LN-ACCERN(1)  TO HOLD-LN-ACCERN(1).
           MOVE LN-ACCERN(2)  TO HOLD-LN-ACCERN(2).
           MOVE LN-ACCERN(3)  TO HOLD-LN-ACCERN(3).
           MOVE LN-ACCERN(4)  TO HOLD-LN-ACCERN(4).
           MOVE LN-ACCERN(5)  TO HOLD-LN-ACCERN(5).
           MOVE LN-ACCERN(6)  TO HOLD-LN-ACCERN(6).
           MOVE LN-TOTERN     TO HOLD-LN-TOTERN.
           MOVE LN-TOTSERACCT TO HOLD-LN-TOTSERACCT.
           MOVE LN-TOTINT     TO HOLD-LN-TOTINT.
           MOVE LN-TOTDEF     TO HOLD-LN-TOTDFMNTS.
           MOVE LN-TOTLCHG    TO HOLD-LN-TOTLCHG.
           MOVE LN-JDRATE     TO HOLD-LN-JDRATE.
           MOVE 0 TO HOLD-PARTIALS HOLD-LCPAID HOLD-AFPDLLP.
           MOVE 0 TO HOLD-OVPAID-CHECK.
           MOVE 0 TO HOLD-REPO-AUCTION-EXP.
           MOVE SPACES        TO HOLD-ALT-PREPAY-FG.
           MOVE SPACES        TO MAX-DEFER-FG.

      * CLEAR HOLD FIELDS FOR SP-ERNFRMLA 15 & 16:
           MOVE 0 TO HOLD-EARNINGS-IB-OWING
                     HOLD-EARNINGS-IB-ERNINT
                     HOLD-EARNINGS-IB.

      * CLEAR HOLD-INS-TAX-RB REBATE FIELDS:
           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 8
              MOVE 0 TO HOLD-INS-TAX-RB(SUB)
           END-PERFORM.

      * CLEAR HOLD FIELDS FOR AMOTIZED INTEREST (Z) PAYMENT INFO
      
           MOVE 0 TO HOLD-LXZ-POST-REGPY HOLD-LXZ-POST-EXTRA-PRIN
                     HOLD-LXZ-POST-OTH   HOLD-LXZ-POST-LCHG
                     HOLD-LXZ-PDUE-APINT HOLD-LXZ-PDUE-APPRIN
                     HOLD-LXZ-CUR-APINT  HOLD-LXZ-CUR-APPRIN.

      * CLEAR HOLD FIELDS FOR MIP MONTHLY INSURANCE PREMIUM PAYMENT INFO
      
           MOVE 0 TO HOLD-LXM-MIP-CLPAID HOLD-LXM-MIP-CLPDTH
                     HOLD-LXM-MIP-AHPAID HOLD-LXM-MIP-AHPDTH.

      * CLEAR NEW DF FIELD HOLD-PRIOR-DF-POSTDATE
      
           MOVE 0 TO HOLD-PRIOR-DF-POSTDATE.
      * MOVED THIS INTO LPPFBUF INSTEAD OF FLDVAL, NEEDS CLEARED
           MOVE 0 TO MS-PENALTY.

       CLEAR-LEGEND.
           MOVE " " TO MESS.
           PERFORM SEND-LEGEND.
       CLEAR-REBATE-TABLE.
           MOVE 0 TO REB-AMOUNT(1)  REB-AMOUNT(2)
                     REB-AMOUNT(3)  REB-AMOUNT(4)
                     REB-AMOUNT(5)  REB-AMOUNT(6)
                     REB-AMOUNT(7)  REB-AMOUNT(8)
                     REB-AMOUNT(9)  REB-AMOUNT(10)
                     REB-AMOUNT(11) REB-AMOUNT(12)
                     REB-AMOUNT(13).
           MOVE 0 TO HOLD-DLRVCHGS-ADJ(1) HOLD-DLRVCHGS-ADJ(2)
                     HOLD-DLRVCHGS-ADJ(3)
                     HOLD-DLPARVPAID-ADJ HOLD-DLPARVHELD-ADJ
                     ADDON-INT-REBATE ADDON-INT-EARNED.
       DISPLAY-ALL-LINES.
           MOVE LINE-BUF TO WR-BUF.
           MOVE LINE-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       GET-GI-CONTROL.
           MOVE LN-OWNBR TO GI-BRANCH.
           MOVE LN-CLASS TO GI-CLASS.
           PERFORM OPEN-GI1-FILE.
           PERFORM READ-GI1-FILE.
           PERFORM CLOSE-GI1-FILE.
       ACCOUNT-IS-FROZEN.
           IF LN-FROZEN-REASON = SPACES
              MOVE "ACCOUNT IS FROZEN!" TO MESS
           ELSE
              MOVE SPACES TO MESS
              STRING "ACCOUNT IS FROZEN, ",LN-FROZEN-REASON DELIMITED
                        BY "  " INTO MESS.
           PERFORM SEND-MESS.
           MOVE LOCK-SEQ TO PASSWDW-SEQ.
           MOVE "TO CHANGE A FROZEN ACCOUNT" TO PASSWDW-PROMPT2.
           PERFORM PASSWORD-MUST-EXIST-AND-FLAGGED.
       SEND-LEGEND.
           MOVE MESS TO WR-BUF.
           MOVE MSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       SEND-LEGEND-W.
           MOVE MESS TO WR-BUF.
           MOVE WSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       SETUP-INIT-SP-SCAN.
           MOVE " " TO HOLD1-KEY-DOWN.
           MOVE LN-OWNBR  TO LP-BRNO.
           MOVE LN-ACCTNO TO LP-ACCTNO.
           MOVE 99999     TO LP-SEQNO.
           MOVE "Y" TO FULL-PAGE-FG.
           MOVE LP1-KEY TO HOLD2-KEY-UP.
       MISSING-REPO-X-INFO.
           IF (LSX-VOLUNTARY-FG = SPACES)
              MOVE "MISSING REPO VOLUNTARY FLAG IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-REASON-CODE = SPACES)
              MOVE "MISSING REPO REASON CODE IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-REASON = SPACES)
              MOVE "MISSING REPO REASON IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-REPODATE = 0)
              MOVE "MISSING REPODATE IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-REDEEM-DATE = 0)
              MOVE "MISSING REDEEM DATE IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-AGENT-PHONE = 0)
              MOVE "MISSING AGENT PHONE IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-AGENT-FAX = 0)
              MOVE "MISSING AGENT FAX IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-DISPOSAL-HOLD = SPACES)
              MOVE "MISSING DISPOSAL HOLD IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-COLLATERAL-LOCATION = SPACES)
              MOVE "MISSING COLLATERAL LOC IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-Y-ASSIGNED-TO = SPACES)
              MOVE "MISSING ASSIGNED TO IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-SUPPLIER-ID = 0)
              MOVE "MISSING SUPPPLIER ID IN TRAILER" TO MESS
              PERFORM SEND-MESS.
           IF (LSX-STORED-LOCATION = SPACES) OR
               (LSX-STORED-ADDRESS = SPACES) OR
                (LSX-Y-STORED-CITY = SPACES) OR
                 (LSX-Y-STORED-STATE = SPACES) OR
                  (LSX-Y-STORED-ZIP = SPACES)
              MOVE "MISSING REPO STORED INFO IN TRAILER" TO MESS
              PERFORM SEND-MESS.

           IF (BW-STATE = "CA" AND LSX-AGENCY-NAME = SPACES) OR
               (BW-STATE = "CA" AND LSX-AGENCY-PHONE = 0) OR
                (BW-STATE = "CA" AND LSX-AGENCY-ADDRESS = SPACES) OR
                 (BW-STATE = "CA" AND LSX-AGENCY-CITY = SPACES) OR
                  (BW-STATE = "CA" AND LSX-AGENCY-STATE = SPACES) OR
                   (BW-STATE = "CA" AND LSX-AGENCY-ZIP = SPACES)
              MOVE "MISSING AGENCY INFO IN TRAILER" TO MESS
              PERFORM SEND-MESS.

      ********************************************
       IO-ROUTINES SECTION.
      ********************************************
       COPY "LIBGB/CONNECT_SQL.CPY".
       COPY "LIBLP/LPSTGS_SQL.CPY".
       COPY "LIBLP/LPSPGS_SQL.CPY".
       COPY "LIBLP/LPLXGGS_SQL.CPY".
       COPY "LIBLP/LPLXEGS_SQL.CPY".
       COPY "LIBLP/LPLXGS_SQL.CPY".
       COPY "LIBLP/LPLTPGS_SQL.CPY".
       COPY "LIBLP/LPLSXGS_SQL.CPY".
       COPY "LIBLP/LPLSRGS_SQL.CPY".
       COPY "LIBLP/LPLSPGS_SQL.CPY".
       COPY "LIBLP/LPLPGS_SQL.CPY".
       COPY "LIBLP/LPLNGS_SQL.CPY".
       COPY "LIBLP/LPLCGS_SQL.CPY".
       COPY "LIBLP/LPESGS_SQL.CPY".
       COPY "LIBLP/LPDLGS_SQL.CPY".
       COPY "LIBLP/LPCDGS_SQL.CPY".
       COPY "LIBLP/LPBWGS_SQL.CPY".
       COPY "LIBGL/GLGIGS_SQL.CPY".
       COPY "LIBGB/GBGBGS_SQL.CPY".
       COPY "LIBGB/GBBRGS_SQL.CPY".
       COPY "LIBLP/LPST1RN.CPY".
       COPY "LIBLP/LPBW1RN.CPY".
       COPY "LIBLP/LPLSP1RN.CPY".
       COPY "LIBLP/LPLSR1RN.CPY".
       COPY "LIBLP/LPLSX1RN.CPY".
       COPY "LIBLP/LPLTP1RN.CPY".
       COPY "LIBLP/LPLC1RN.CPY".
       COPY "LIBLP/LPDL1RN.CPY".
       COPY "LIBLP/LPCD1RN.CPY".
       COPY "LIBLP/LPLP1RN.CPY".
       COPY "LIBLP/LPSP1RN.CPY".
       COPY "LIBGB/GBBRRN.CPY".
       COPY "LIBGB/GBGBRN.CPY".
       COPY "LIBGL/GLGI1RN.CPY".
       COPY "LIBLP/LPWKI.CPY".
       COPY "LIBLP/LPES1RN.CPY".

       COPY "LIBGB/FERRORS.CPY".
           MOVE "E" TO ERRCD.

       END-ROUTINE.
           PERFORM CLOSE-FILES.
       EXIT-PROG.
           PERFORM CLOSE-WINDOW UNTIL WINDOWS-OPEN = 0.
       STOP-RUN.
           EXIT PROGRAM.
