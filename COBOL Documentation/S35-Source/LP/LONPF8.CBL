       IDENTIFICATION DIVISION.
       PROGRAM-ID.      LONPF8.
       DATE-WRITTEN.    030786.
      *********************************************************************
      *  DESC:  LOAN PROCESSING
      *         TRANSACTION POSTING
      *         PROGRAM 8 -     TRCD  RV
      * REV:
      *  BAH 050195 CHANGED TO NOT ALLOW REVERSE ON LP-SSNO = 9999999999
      *  SLC 053095 COMBINED OTHBAL AND OT2BAL IN L-090
      *  JTG 070795 ADDED TEST FOR SP-LCFRMLA = 'L', MERCURY (UCCC)
      *  SLC 070895 ADDED REVERSALS OF CONVERTED TRANSACTIONS.
      *  BAH 071795 STOPPED REVERSAL OF 'BT' (BRANCH TRANSFER) TRANSACTIONS
      *  JTG 080495 CORRECTED DISPLAY OF 'NSF' AFTER RVENT WINDOW
      *  JTG 080995 STARRED OUT TEST ON CURBAL = 0, RE: RVENT
      *             TO TEST REVERSAL OF A PAYOFF
      *  JTG 080995 CORRECTED RV OF WL WHEN LP-INTDUE HAD MONIES WHICH
      *             CAUSED A CORRUPTION OF LN-INTBAL
      *  JTG 081695 ADDED CONV-AMT-PAID-LAST CONV-DATE-PAID-LAST
      *                   CONV-LCPDTH-DATE CONV-INTPDTH
      *  JTG 082595 ADDED TEST FOR SP-LCFRMLA = 'M', MERCURY (LA)
      *  JTG 092195 CORRECTED REVERSAL OF 'TP' & 'TS'
      *  JTG 092595 ADDED LOGIC FOR INTER BRANCH PAYMENTS
      *  MJD 092695 ADDED PASSWORD PROTECTION FOR REVERSALS ATTEMPTED THROUGH
      *             INTERBRANCH POSTING.
      *  JTG 092895 MODIFIED TO HOLD ENTERED LP-REFNO FOR RVENT ENTRY
      *  BAH 101095 "CHECK" REBATES WERE GETTING WIPED OUT BECAUSE OF A
      *             TEST I DID FOR MANUAL-REBATES AND THE NON ACCRUAL REPORT
      *  JTG 101895 CORRECTED UPDATE OF LN-TOTLCHG RE: CONVERSION RV WINDOW
      *  MJD 021296 CHANGED SCREEN PROMTS FOR DEALER PURCHASE.
      *  BAH 022296 LP-LCPARTIALS HOLDS APLC FROM AN AL, AP, NOT GETTING
      *             NEGATIVE ON A REVERSAL
      *  MJD 042596 ADDED GP-FILE, GP-DLR-DISP-TYPE.
      *  BAH 042996 ADDED TEST ON TYPING "CHECK" ON A REVERSAL OF A "CHECK"
      *             REBATE
      *  JTG 043096 ADDED LOGIC TO UPDATE HOLD-AFPDLLP
      *  MJD 071196 ADDED TEST OF LN-UNITPER-CD FOR WEEKLT PDTH. USE
      *             PDTH-DATE-FULL INSTEAD OF PDTH-DATE.
      *  BAH 082996 LP-LCPAID HOLDS "MS" PRE PAYMENT PENALTY ON THE "RI"
      *             (REDUC = 999.01), MULTIPLY IT BY -1
      *  JTG 101196 ADDED 'LXE-WORKER' & 'LXE-WORKER2' FOR LPCERN-- A50 VERSION
      *                   SP-ERNFRMLA 15 & 16, REAL INTEREST BEARINGING METHOD
      *  BAH 121996 ADDED L2-BUF WITH A LINE DISPLAY THAT CAN HANDLE
      *             APCUR OF > 99999.99 FOR ADVANCED CREDIT, #421
      *  JTG 010397 CHANGED TEST FOR LCPDTH & LCHG DISPLAY TO NEVER DISPLAY
      *             IF SP-LCFRMLA = " " AND REMOVED TEST ON JUDGEMENT
      *             SINCE ACCOUNTS IN JUDGEMENT CAN CONTINUE AS PRECOMP
      *  JTG 040797 CLEARED EARN-BUF TO SPACES IN DISPLAY-EARNINGS ROUTINE
      *             WAS LEAVING GARBAGE D-LCPDTH FROM ENTRY-LINE-DISPLAY
      *  MJD 050697 ADDED "ST" TRCD FOR ADDONS
      *  MJD 060497 ADDED "R3" AS A VALID REV-TRCD. ADDED INS-RB-TBL(6-8)
      *             AND REB-AMOUNT(11-13)
      *  GLF 090897 REPLACED 'IO' ON GP-FILE WITH GET 'GPENV'
      *  JTG 091897 ADDED TEST FOR TRCD = 'AH', WORLD A90
      *  JTG 092397 ALLOWED REVERSE OF 'SS' TRASACTION ON INTERBRANCH PAYMENTS,
      *             RELIANCE 66
      *  GLF 101497 ALLOWED CTRL 'N'
      *  MJD 101797 MOVED WK-UPDATE-BUF TO LP01WK
      *  MJD 111797 ADDED PASSWORD TO REVERSAL OF CHARGE-OFF IF TRANSACTION
      *             DATE IS AFTER A MONTH END.  (REQ #168)
      *  JTG 121097 CORRECTED ABOVE (REQ #168) MERCURY WHICH WAS CAUSING A
      *             PASSWORD ON A REVERSED PAYOFF POSTED AFTER A MONTH END
      *   CS 042898 ADDED "RB" AND "RO" NEW RENEWAL CODES
      *  JTG 042998 CHANGED ERROR MESSAGE TO:
      *             "INITIATE REVERSAL FROM DIRECT LOAN VOID"
      *  BAH 060898 ADDED "BK" TO CDV-17, MERCURY #E 174
      *             *** ALSO, READ-EARNINGS WAS NOT CLEARING LXE-WORKER
      *             AND LXE-WORKER2 ON BAD IO-FG..
      *  BAH 062698 TILLNO IS NOW ALPHANUMERIC
      *  BAH 070898 ADDED TRCD "BD" TO REMOVE BANKRUPT STATUS, MERCURY # 195
      *  BAH 073098 DISPLAY BALANCES EVEN ON REVERSALS, #487
      *  MJD 081198 ADDED ENV VARIABLE TO DETERMINE WHETHER OR NOT
      *             TO DISPLAY BALANCES ON REVERSALS. FIXED DISPLAY TO INDICATE
      *             INCLUDED O2 BAL WITH "SC" "RN" "PB" "RB" "RO" TRANSACTIONS
      *  BAH 081498 DONT BRING UP REVERSAL WINDOW ON A LP-SEQNO = 1, CAUSING
      *             MAJOR PROBLEMS WITH BULK PURCHASES...CINDY/MERCURY
      *  JTG 101298 ALLOWED DISPLAY OF NEGATIVE CURBAL REVOL REGENCY
      *  JTG 111298 ALLOWED REVERAL OF 'PU' REVOLVING, REGENCY
      *  JTG 112598 STOPPED REVERSAL OF 'BT' ON TRANSFERED ACCOUNTS WITH
      *             PAYOFF CODE 'BT', MERCURY
      *  JTG 990225 ADDED GET OF ENV VARIABLE "RVPURCHASES" TO
      *             DETERMINE WHETHER OR NOT TO TO ALLOW REVERSAL OF PURCHASES
      *  BAH 990303 DONT BRING UP REVERSAL WINDOW FOR REGENCY CONVERTED
      *             PAYMENTS
      *  JTG 990324 ADDED 'PN' NON CASH PAYMENT.WITH GL ENTRY           TFC #013
      *             ADDED 'PZ' NON CASH PAYMENT/NO RECDEL.WITH GL ENTRY TFC #012
      *  JTG 990331 CHANGED DISPLAY OF VALID TRCD'S FOR NSF REVERSAL
      *  JTG 990405 ALLOWED 'Z2' 'O2' INTERBRANCH PAYMENTS          MERCURY #XXX
      *  JTG 111298 ALLOWED REVERAL OF 'AV' REVOLVING, REGENCY
      *  GLB 990720 ADD CASH DRAWER PASSWORD OPTION TO ENTER DRAWER NO.
      *             BR-PASSWORD-DRAWER(Y/N) & CA-PASSWORD (4 CHAR PASSWORD)
      *             REGMGM PR# 901
      *  MJD 990803 ADDED GP-INCL-OTH-IN-EARNED FLAG. IF "Y" THEN INCLUDE
      *             EARNINGS BUCKET 6 (OTHER) IN ACCUMULATED TOTALS
      *             OTHERWISE EXCLUDE BUCKET 6.
      *  JTG 990820 ADDED LOGIC FOR REVOLVING 'PE' PAYMENT EXCEPTION
      *  JTG 990929 ADDED LOGIC FOR REVOLVING 'AP' APPLY TO PRINCIPAL
      *  JTG 991011 CHANGED SETUP-LINE FOR 'AP' DISPLAY REVOLVING, #47 REGENCY
      *  MJD 991220 ADDED LN-TOTNODEFACT AND LN-YTDNODEFACT (WORLD PR#216)
      *  MJD 000119 ADDED LN-TOTNOLCHG (WORLD PR#218)
      *  JTG 000405 ADDED TEST GETENV ALLOW_RV_PB_NO_PD TO SKIP VERIFY OF
      *             PD RECORD ON REVERSAL OF 'PB' PAYOFF,
      *             RE: WORLD FIX ACCOUNTS AFTER CRASH WORLD2
      *  JTG 000417 CHANGED NEW DEFERMENT FORMULA 97 INTDUE OR 1/3 OF REGPAY
      *             TO BE DISBURSED TO LP-APINT AND LP-APCUR, MERCURY #224
      *  JTG 000419 CHANGED TO ALLOW NSF ON "PA" IF LP-REFNO = "LBOX"
      *                                    MELLON BANK LOCK BOX    (MERC PR#227)
      *  JTG 000523 CORRECTED NEW DEFERMENT FORMULA 97 INTDUE OR 1/3 OF REGPAY
      *             TO NOT UPDATE LN-TOTPAYMNTD IN THIS POSTING PROGRAM,
      *             WHICH CAUSED PAIDTHRU TO INCREASE WRONGFULLY  MERCURY #224
      *  JTG 000912 ALLOW POSTING AND REVERSALS OF "PA" (NSF) (LBOX)
      *             TRANSACTIONS  MERCURY PR#234
      *  JTG 000925 TOOK OUT FORCED 'NSF' ON REVERSAL OF 'PA' 'LBOX'
      *             ALLOW POSTING AND REVERSALS OF "PA" (NSF) (LBOX)
      *             TRANSACTIONS  (MFC PR#234)
      *  JTG 000929 CORRECTED FOR REVERSALS ON REVOLVING ACCOUNTS WHERE THE
      *             LOAN BALANCE AFTER THE REVERSAL BE GO TO ZERO AND
      *             PUTTING BALANCES IN LCBAL AND/OR INTBAL  REGENCY DIRK/LORI
      *             ACCOUNT # 0105-80-060302
      *  MJD 001006 ADDED FORCED ENTRY OF MEMO ON NON NSF REVERSALSI
      *             IF GP-RV-MEMO = "Y" (WORLD AS PER JTG)
      *  MJD 001013 ADDED PASSWORD TO REVERSAL OF INTERBRANCH PAYMENTS:
      *             ONLY ALLOW REVERSAL OF PAYMENTS POSTED VIA INTERBRANCH
      *             BY THE POSTING BRANCH AND NSF IN THE REFNO. (WORLD PR#243)
      *  JTG 001026 CORRECTED THE ABOVE LOGIC TO ALLOW A BRANCH TO POST A
      *             PAYMENT TO ONE OF ITS ACCOUNTS AND REVERSE IT WITH OR
      *             WITH OUT 'NSF'                              (WORLD PR#243)
      *  MJD 001116 ADDED LP-PREPAY-PENALTY, USED BY LONPFA TO HOLD PREPAYMENT
      *             PENALTY ON PAYOFFS (NEWS PR#1264).
      *  BAH 001127 ADDED THE REV-REBATE TEST ON REVERSING A NON NSF INTERBRANCH
      *             WHEN OWNING BRANCH TRIED TO "RV" A "PB" WITH NO REBATES,
      *             AND THE PREVIOUS TRANSACTION WAS AN INTERBRANCH PAYMENT,
      *             THIS "IF" WAS ASKING FOR THE PASSWORD, WHEN IT SHOULD NOT !!
      *             BECAUSE IT LOOPS BACK THRU HERE WITH REV-REBATE = "Y",
      *             LOOKING FOR REB'S
      *  JTG 001128 ADDED LOGIC FOR 'OV' OVERPAYMENT TRANSACTION PR#J015
      *  MG  010201 REMOVED "01 WK-LXE" AND ADDED LIBLP/LPWKLXE.
      *  CS  010312 ADDED PASSWORD TO REVERSAL OF 'SP' TRANSACTION. SEQ 5
      *             MERCURY SECURITIZATION
      *  JTG 010321 CHANGED TO TEST FOR LP-REFNO = ALLOT, LBOX, TCOLL,
      *             TPAY OR WESTU                                 MERCURY PR#245
      * JTG 010409 CHANGED TO TEST FOR LP-REFNO = ALLOT, LBOX, TCOLL,
      *             TPAY OR WESTU  FOR REVERSAL PASSWORD       MERCURY PR#245
      * CS  010524  CHANGED TEST ON GP-RV-MEMO TO FROM Y,N TO Y,N AND LOWERCASE
      *             A-Z.  IF 1ST CHAR OF USERID IS GREATER THAN GP-RV-MEMO
      *             REVERSAL MEMO WINDOW DISPLAYED (REGIONAL PR#1480)
      * CS  010611  ALLOWED REVERSAL OF INTERBRANCH PAYOFF MERCURY (SHOULD HAVE
      *             BEEN DONE WHEN ALLOWED INTERBRANCH PAYOFF (MERC PR#250)
      * C&B 010613  REMOVED OLD REDEF OF MESS BY CDV-BUF & EXPANDED CDV-BUF;
      *             MADE NEW BUFFER FOR CDV-INTERBRANCH-REV-REBATE WHICH
      *             INCLUDES REBATES TO BE ALLOWED ON REVERSAL OF INTERBRANCH
      *             PO (NOT ALLOWING REVERSALS OF INDIVIDUAL REBATE CODES
      *             INTERBRANCH, JUST AS PART OF PO)
      * JTG 010619  CORRECTED REVOLVING REVERSAL OF 'WI' AND 'WL', LOGIC WAS
      *             MISSING TO SETUP THE REVERSED RT APPLIED FIELDS IN THE HOLD
      *             FIELDS WHICH ARE PASSED TO LONPF2 FOR UPDATE  REGENCY PR#326
      * CS  010628  CORRECTED 010613 ENTRY. ONLY PERFORM CDV-VERIFY IF
      *             REV-REBATE NOT = "Y".  ON A PAYOFF ALL ASSOCIATED REFUNDS
      *             WILL NOT NOT PERFORM CDV-VERIFY (INTERBRANCH) FOUND BY MERC
      * JTG 010713 ADDED NEW RATE TYPE 'Z' AMORTIZED WHERE RUNTIME COMPUTES
      *            INTEREST ON A 30 DAY METHOD (REAL ESTATE) AND LOAN CALCS
      *            ARE DONE SIMPLE, REMOVED TIE TO CTBL, FORCING TESTS ON (1)
      *                                            LENDMARK PR#1045 & PR#1380
      *  JTG 010814 CHANGED GI-PAYWESTU TO GI-PAYMGRAM           MERCURY PR#258
      *  JTG 010914 'RE' ON 'IB' WILL ACT LIKE 'OT' TRANSACTION   REGACC PR#1575
      *  JTG 010921 CORRECTED 'RE' ON 'IB' WILL ACT LIKE 'OT'     REGACC PR#1575
      *  JTG 010927 ALLOWED REVERSAL OF 'OV' INTERBRANCH         MERCURY PR#261
      *  JTG 011004 ADDED HOLD-LXZ(FIELDS) FOR UPDATE LX-Z RECORD
      *             RE: NEW RATE TYPE 'Z' AMORTIZED   LENDMARK PR#1045 & PR#1380
      *  JTG 020117 CHANGED FIELDS FROM S9(6)V99 TO S9(7)V99    LENDMARK PR#J021
      *  JTG 020308 ADDED "CT" COUNTY TAX CODE KENTUCKY AND PERCENTE
      *             ADDED "CY" CITY   TAX CODE KENTUCKY AND PERCENTS
      *             ADDED HOLD-INS-TAX-RB() OCCURS 8 S9(7)V99 REFUNDS
      *             OPENED UP USE OF LP-PRORATED-INS-REB TO HOLD PRORATED PORTION
      *             OF INSURANCE REFUND                               WORLD #288
      *  JTG 020729 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *  BAH 021011 ADDED NEW TRANSACTION CODE OF "IN" INSURANCE LOSS, EXACTLY
      *             LIKE "PE", REGACC PR# 0007
      *  JTG 021119 ADDED NEW CODE FILE TYPE 'BR' -BATCH PAYMENT REFERENCE CODES
      *             BATCH PAYMENT REVISIONS                         REGACC #0006
      *  CS  021121 ADDED PASSWORD REVERSAL OF 'SP' INTERBRANCH (6) [WORLD
      *                            REVERSAL OF 'OT' INTERBRANCH (7)  PR#310]
      *                            REVERSAL OF 'AP' INTERBRANCH (8)
      *  JTG 021203 REMOVED GP-BATCH-PAY-REVISIONS
      *             BATCH PAYMENT REVISIONS                         REGACC #0006
      *  JTG 021206 REMOVED TEST ON BATCH-REFCD = " " BATCH PAYMENT REVISIONS
      *                                                             REGACC #0006
      *  BLV 030321 WORLD IS TESTING CASH DRAWER PASSWORDS IN A FEW BRANCHES;
      *             PROBLEMS BECAUSE WE ARE ENTERING THE POSTING CASH DRAWER,
      *             BUT HERE WE WERE TESTING THE BRANCH CASH DRAWER PASSWORD
      *             FLAG OF OWNING BRANCH.  SO WILL READ IN POSTING BRANCH &
      *             SAVE FLAG, THEN RESTORE OWNING BRANCH
      *  BLV 030325 FIX CHANGE ABOVE, NORMAL (NON-INTERBRANCH) PMT WAS ASKING
      *             FOR DRAWER INSTEAD OF PASSWORD
      *  JTG 030423 CHANGED REVERSAL OF PAYOFFS TO SKIP TEST FOR PASSWORD
      *             AFTER 'REV-REBATE IS SET = TO Y'. ROUTINE WAS READING
      *             PAYMENT RECORD OF TRANSACTION POSTED PRIOR TO PAYOFF
      *             AND IF THIS WAS EX. 'LBOX' WAS ASKING FOR PASSWORD
      *             EVEN IF PAYOFF WAS NOT POSTED 'EX. LBOX'         REGACC J027
      *  JTG 030528 ADDED SP-LCFRMLA = 'P' LIKE 'I'                  PACE #408
      *  JTG 030702 ACCOUNTS BYPASS LATE CHARGE ASSESS ROUTINE WHEN
      *             SP-LCFRMLA = ' ' BUT ACCOUNT IS SETUP FOR DEALER LATE
      *             CHARGE FORMULA                               MIDATL #J029
      *  JTG 031013 CHANGED REVERSE 'AP' TO DISPLAY THE AMOUNT REVERSED
      *             IN APPLIED TO PRINCIPAL                  CENTRIX KRUSE #J035
      *  JTG 031106 CORRECTED REVERSAL OF BATCH PAYMENT REFNO TRANSACTIONS,
      *             IT WAS UPDATING CASH DRAWER AND NOT ALLOTMENT PAYABLE
      *  BLV 040804 ADDED PO TRANSACTION CODE TO CHECK IN PASSWORD SEQ 4;
      *             THIS IS THE SEQUENCE THAT STOPS USER FROM REVERSING AN
      *             INTERBRANCH PMT UNLESS IT'S REVERSED BY THE SAME BRANCH
      *             THAT POSTED IT & HAS NSF IN THE REFNO.  OTHERWISE, ANY
      *             BRANCH COULD GO INTO INTERBRANCH PAYMENTS & REVERSE A
      *             PAYOFF EVEN IF THEY DIDN'T POST IT! PER JR E-MAIL
      *  JTG 040826 ADDED 'RI' 'RS' 'RM' AND 'AC' TO INTERBRANCH TRANS LIST
      *             AND PASSWORD PROTECTED                           WORLD #0357
      *  JTG 040910 THE LOGIC FOR SET OF INTERNAL FIELD 'BATCH-REFCD' WAS
      *             CORRECTED TO ONLY SET IT FOR THE REVERSED PAYOFF TRANSACTION      *             LP-TRCD 'PO' AND NOT FOR REBATES OR ANY PRIOR PAYMENT
      *             RECORD. 'BATCH-REFCD' IS PASSED TO PAYMENT UPDATE
      *             PROGRAM (LONPF2.C).
      *
      *             EXAMPLE:
      *                        07/08/04  PA LBOX
      *                        09/10/04  RI CCARD
      *                        09/10/04  RS CCARD
      *                        09/10/04  PO CCARD
      *
      *             DURING THE REVERSAL ROUTINE BATCH-REFCD WAS SET TO 'CCARD'
      *             UNTIL THE 07/08/04 PA LBOX RECORD WAS PROCESSED, WHICH THEN
      *             SET BATCH-REFCD TO 'LBOX'. PAYMENT UPDATE PROGRAM LONPF2.C
      *             EXPECTS LP-REFNO OF 'PO' TRANSACTION TO MATCH 'BATCH-REFCD'
      *             AND SINCE THEY WERE NOT EQUAL THE CASH DRAWER WAS UPDATED.
      *                                                           REGACC #0006JG
      *  JTG 050316 ADDED LOGIC TO SET 'LP-REFNO' IN THE PAYMENT RECORD TO
      *             THE VALUE THE CUSTOMER TYPED WHEN REVERSING. WILL CHANGE
      *             LONPF2.C TO SET 'TP-REFNO' TO THE VALUE OF LP-REFNO
      *             BEFORE LP-REFNO WAS ALTERED TO VALUE CUSTOMER TYPED.
      *                                                            CENTRIX #2466
      *  BAH 050428 HAD TO REMOVE ABOVE CHANGE(2466), WAS WIPING OUT VALUABLE
      *             ADDON INFO IN LP-REFNO FOR LONPFF TO DETERMINE TYPE OF
      *             OF ADDON !!!!
      *  JTG 050502 PUT BACK LOGIC (2466) WHEN NOT REVERSING ADDON-POSTING
      *             PAYMENT RECORDS
      *             NOTE: STOPPED THIS IF REVERSING AN ADDON-POSTING.
      *                   REVERSAL OF ADDONS CALLS LONPFF.C WHICH NEEDS
      *                   THE REAL REFCD OF THE REVERSED PAYMENT RECORD.
      *                                                            CENTRIX #2466
      *  BAH 050714 MIP MONTHLY INSURANCE ON RENEWALS, REGWAN PL# 499
      *   CS 061005 CHANGED REVERSAL-ROUTINE TEST OF LP-SEQNO =1 TO GO WITH
      *             'BF' SEQNO OTHER THAN 1.... ADDED LP-TRCD = 'BF' AND
      *              GP-POST-XX-BF-PAYMENTS... WAS ALLOWING A DELETE OF A BF
      *              IF LP-SEQNO WAS NOT 1.  PR#2569
      *   CS 070319 ADDED REVERSAL OF BK & BD TO INTERBRANCH PASSWORD
      *             SEQ 9 WORLD PR#505
      *   CS 070521 ADD REVERSAL OF 'PE' TO CDV-INTERB &ADD PASSWORD SEQ 10
      *                                                    WORLD PER JR
      *   CS 070709 ADDED SP-DEFFRMLA(IB) 96 MULLEN PR#2477
      *  BLF 071018 ADDED PASSWORD FOR REVERSING TRANSACTION FROM PRIOR DATE,
      *             SEQ 11, REGMGM PR# 3080
      *  BAH 080111 ALLOW "IN" INTERBRANCH REVERSAL REGACC PR# 194
      *   CS 080204 ADDED GP-I-AM-MIDATL TEST, IF YOU ARE MIDATL, INPUT OF
      *             DLRSVPRIN3 IS ALLOWED... THE REVERSAL NEEDS TO TAKE CARE OF
      *                                                 MIDATLANTIC PR#3136
      *   CS 080313 ADDED MESSAGE WHEN REVERSING A 'SP' TRANSACTION THAT
      *             THE POOLID WAS BEING RESET TO ZERO SERVICE FIN PR#621
      *  BLM 080926 CHANGED PASSWORD CHECK ON REVERSING INTERBRANCH.  USED TO
      *             ALLOW POSTING BRANCH TO REVERSE IF 'NSF', NOW ALLOW EVEN
      *             IF NOT NFS.  MADE SEPARATE I-AM-WORLD TEST, LEFT OTHER
      *             ONE ALONE.  THIS IS FOR PASSWORD OPTION 4. WORLD PR# 602.
      *   CS 081010 ALOW INTERBRANCH REVERAL OF PL,P2 SEQ 12 PR#222 REGACC
      *             PASSWORD MUST EXIST!
      *   CS 081113 ADD TEST GP-INCL-OTH-IN-EARNED = 'R'. IF 'R' EXCLUDE
      *             OTHER(ANTIC 6) AND MAINTFEE(ANTIC 4) FROM EARNINGS
      *                                                     REGACC PR#210
      * BAH 081119 ADDED IB DEFFRMLA 95 TO WORK LIKE 96 REGACC PR# 3280
      *  CS 081211 ADDED INTERBRANCH REVERSAL OF SX(13),SV(14),RE(15),IR(16)
      *            PX(17),PW(18),W2(19),PI(20)    REGACC PR#231
      *  CS 090130 IF REVOLVING, LP-TRCD = "ST" AND LP-REFNO ="EXPIR" DONT
      *            ALLOW REVERSAL. THIS TRANSACTION IS A RESULT OF A PROGRAM
      *            THAT CAPITALIZES CONTINGENT INTEREST TO THE BALANCE PR#3215
      *                                                         REGENCY
      *  CS 090212 ADDED PASSWORD SEQ 21 RV-PR238-SEQ-INTERBR.  PROMPT FOR
      *            PASSWORD IF LP-TRCD = AL,PA,AI,WL,WI,WO,DC,OP,RP,R1,R2,
      *            R3 IF POSTING INTERBRANCH                   REGACC PR#238
      *  CS 090219 WHEN CAPITALIZING CONTINGENT INTEREST TO THE BALANCE
      *            A 'DUMMY' RT-ST IS CREATED. NOT ALLOWED TO REVERSE, ADDED
      *            IF LP-TRCO = 'ST' AND LP-REFNO = EXPIR, DONT ALLOW REVERSAL
      *                                                     REGENCY
      *  CS 090311 REVERSAL OF 'IR' INTERBRANCH WAS TESTING FOR RV-REV
      *  CS 090311 REVERSAL OF 'IR' INTERBRANCH WAS TESTING FOR RV-RE-SEQ-INTER
      *            BR INSTEAD OF RV-RI-SEQ-INTERBR
      * BAH 090729 PASSWORD REVERSAL OF ADDON TRANSACTIONS, REGMGM PR# 3417
      *            "LP" OR "NP" OR "ET" OR "RT" OR "ST"    OPT = 22
      * BLM 090923 IF LP-TRCD = "PS" (PAYMENT RESCHEDULE), SKIP THIS
      *            TRANSACTION WHEN YOU ARE REVERSING, BUT ALLOW REVERSING
      *            BEYOND PS TRANSACTION, REGACC PR# 254
      * BLM 090925 IF "PS" TRANSACTION FOUND SET FLAG REVERSE-AFTER-RESCHED-FG,
      *            IF FLAG IS SET, DON'T SUBTRACT LP-APLC FROM TOTLCHG.
      *            RESCHEDULE (PS) TRANSACTION ZEROES OUT LN-TOTLCHG, SO
      *            REVERSAL WOULD MAKE IT GO NEGATIVE, REGACC PR# 254
      *  CS 091124 ADDED GP-I-AM-UNITED TO DISBURSE-PUR-DISPLAY-MIDATL, THIS
      *            ALLOWS USE OF RESERVE PRIN3 & REMOVES MF WAS ALSO A BUG ON
      *            DISPLAY OF SERVICE CHARGE RV  UNITED PR#3344
      * BLM 100309 DON'T ALLOW REVERSAL OF "ES" TRANSACTION; THIS PMT IS
      *            CREATED BY LP/ESCCROW, INVOLVES PMT SCHEDULE THAT CAN'T
      *            BE EASILY REVERSED, MUST REMOVE MANUALLY AT THIS TIME,
      *            REGWAN PR# 3506
      * BLM 100309 REVERSE APPLIED TO ESCROW ON REVERSAL, REGWAN PR# 3506
      *  CS 100309 APPLIED TO ESCROW WAS NOT SUBTRACTED OUT OF PAYMENTS TO DATE
      *            CAUSING WRONG PAID THRU DATES ON REVERSAL, REGWAN PR# 3506
      * BLM 100324 ON ABOVE CHANGE, ONLY SUBTRACT LP-APPLIED-TO-ESCROW IF
      *            LN-ESCROW-FG = "Y", WAS SUBTRACTING 2020'S ON NON-ESCROW
      *            ACCOUNTS & PUTTING GARBAGE IN THE PAID THRU!! REGWAN PR# 3506
      * BAH 110317 ADDED CHECK ON REV-REBATE = " " IN FRONT OF A BUNCH OF 'IF'
      *            STATEMENTS IN THE REVERSAL-ROUTINE. PAYOFF LOOPS BACK THRU
      *            LOOKING FOR REBATES, WAS GETTING CAUGHT ON THE LAST LP
      *            RECORD PRIOR TO REVERSAL. EXAMPLE: A "PL" FOLLOWED BY A
      *            "PO" INTERBRANCH, AND POSTING BR WAS REVERSING THE "PO"
      *            AND KEPT GETTING "PL/P2 INTERBRANCH REVERSAL NOT ALLOWED",
      *            THEY WERE JUST TRYING TO REVERSE THE "PO" BUT HITS THE "PL"
      *            WHILE LOOKING FOR REBATES TIED TO THE "PO". PL# 730 WORLD
      *  BAH 130111 ADDED LC-DISPLAY-ERN OPTION OF "I" FOR POFF-INTDUE
      *                                              AMERICAN ACC PR# 4190
      *   CS 130506 REMOVED SETTING OF HOLD-TDR1 (TRIAD) WHEN GP-I-AM-REGACC
      *            AND A 'DF' - 'D9' IS REVERSED, ITS NOW IN LONPF2.
      *                                                REGACC PR#338
      *   CS 131206 IF GP-USE-ACCRUAL-EARN-FILE = "R" AND ACCT IS FLAGGED IN
      *             NONACCRUAL STATUS (LR-NONACCRUAL-STATUS) AS 'Y', PROMPT
      *             FOR PASSWORD IF REVERSING A 'DF' PRIOR TO LR-NONACCRUAL-
      *             START-DATE   REGACC PR#347
      *  BAH 140124 FIX GET-LR-NONACCRUAL-STATUS, MUST BE A SECTION! PR#347
      *   CS 140128 ADDED LR-FILE TO DECLARATIVE, THE OPEN OF THE LRFILE WAS
      *             BEING DONE EVERYTIME A 'DF' TRANSACTION WAS READ(REGACC).
      *             ALSO NOT IN DECLARATIVES WAS GIVING AN ERROR AND DROPPING
      *             TO SYSTEM PROMPT.
      *
      *  BLM 140718 IF I-AM-WORLD, DON'T CHECK REV-PA-SEQ PASSWORD IF TRYING
      *             TO REVERSE PA OR PE WITH REFCD OF "DEBIT", WORLD PR# 1005
      *  BAH 140814 ADDED TEST FOR LPSMNU IN HELP
      *  BAH 160125 SPLIT OUT LTFILE, PD0003
      *   CS 160222 REMOVE COPY LPWKLXE, ITS AN EARNINGS COPY MEMBER THAT IS
      *             PASSED IN LOAN PROCESSING VIA LP01WK USING WK-LX2-REC. 
      *             REPLACED WK-LX2-REC WITH WK-LXE-REC IN LP01WK 
      *             MOVED LPWKLXE TO LPWKLXE.NO
      *             SAVED VERSION LONPF8.160222
      *  BAH 160201 CUSTOM INTER BRANCH BRANCH CHECKS FOR CITIZENS, PR# 4965
      *   CS 160302 ADDED HOLD-ALT-PREPAY-FG, UPDATE OF LP-ALT-PREPAY-FG
      *             WHEN REVERSING A PAYMENT THAT CREATED A PREPAYMENT NOT
      *             LESS THAN SP-ALT-PREPAY-MONTHS.
      *  BAH 160304 CHANGED TILLNO TO NUMERIC BUT NO ROOM ON SCREEN FOR 2 DIGITS
      *
      * KEC 2016.0509 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED LN-APPNO TO USE LN-APP-NUMBER FOR MA1-KEY.
      *  MJD 160613 ADDED LOGIC FOR LXR RECORD    REG MGT  PR# 4915
      * BAH 161117 ADDED 2 DIGIT FIELD "DRAWER" ABOVE PAYMENT LINE FOR 
      *            NEW CASH DRAWER ENTRY
      *   CS 170127 ALLOW REVERSAL OF "RC","RA", ALL OTHER INSURANCE'S ARE
      *             ALREADY IN THE CDV-INTERBRANCH BUFFER PR#5248A REGENCY 
      *             RE-INS-REBATE-SEQ-INTERBR SEQ24 REGENCY PR#5248A
      *  BAH 170209 DO NOT ALLOW REVERSAL OF (LP-TRCD = "AA" AND
      *             LP-REFNO = "INVES") FOR INVESTINET AUTO PAYS, WORLD 1226
      * BAH 170615 ACTIVATE 8 DIGIT DATES, PD0006
      * BAH 171129 FIXED WK-LXE-REC
      * BAH 180130 DON'T CHECK REV-PA-SEQ PASSWORD IF TRYING TO REVERSE PA
      *             OR PE WITH REFCD OF "PHACH" OR "PHDBT", WORLD PR# 1300
      * KEC 2018-0824 LOAN APP MODULE REMOVAL FROM A30 [LARM30];
      *         LEAVING LN-APP-NUMBER & EXT-WI-CL-APP-NUMBER
      *         HERE IN CASE NEEDED IN THE FUTURE.
      * BAH 181231 GLOBAL LPFILE
      * BAH 190116 GLOBAL LXFILE, SPLIT
      * BAH 20190308 MOVED LP-REFNO REDEFINITION TO LPWSLP COPY MEMBER
      *  CS 190418 ADD SP-LCFRMLA 'S' TO IF CONDTION,LC-PAID,LC-
      *            PARTIAL NOT SET CORRECTLY
      *            IF (SP-LCFRMLA = "F" OR "H" OR "I" OR "J"
      *                              OR "K" OR "L" OR "M" OR "P"
      *                                            WORLD PR#1369
      * KEC 20190717 COMMENTED OUT THE USE OF REVOL-SIGN-WORKERS.
      * BAH 2022.0314 REMOVED EXT-SPANISH-FORMS AND ALL MX FORMS
      * BAH 2022.0328 STOP INTERBRANCH REVERSAL OF REBATES WITH REFCD "CHECK"
      *                                                          #1549
      * BAH 2022.0802 HARD CODED STARTS OF LP
      *
      * JKC 2022-0930 CHANGED TO USE START-LP1-FILE-SCAN INSTEAD OF
      *          START-LP1-FILE; NEED TO USE START-LP1-FILE-SCAN WHEN
      *          START-LP1-FILE-NOT-GREATER IS USED FIRST; NEEDED FOR
      *          FOR DISPLAYING MULTIPLE PAGES IN AN UP & DOWN FUNCTION;
      *          NEED TO ADD ONE TO LP-SEQNO (IN WBEG) IN ORDER TO GET 
      *          THE DISPLAY TO WORK LIKE WITH VISION FILES.
      * BAH 2023.0328 ADDED SP-LCFRMLA "T" FOR "WI" UCCC LATE CHARGE #1597
      * BAH 2024.0311 REMOVED EXT-WI-CL-APP-NUMBER
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. 3B.
       OBJECT-COMPUTER. 3B.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
       COPY "LIBLP/LPFSWK.CPY".
       I-O-CONTROL.
       DATA DIVISION.
       FILE SECTION.
       COPY "LIBLP/LPFDWK.CPY".

       WORKING-STORAGE SECTION.
       77  SCCS-IDENTIFIER PIC X(41) VALUE
           "@(#)LP/LONPF8.CBL S35 03/25/24-12:17:30 >".
      **************************************************
      *     P R O G R A M   W O R K E R S              *
      **************************************************
       COPY "LIBLP/LP01LN.CPY".
       COPY "LIBGB/GB01BR.CPY".
       COPY "LIBGB/GB01BR_SQL.CPY".
       COPY "LIBGB/GBWSBR.CPY".
       COPY "LIBLP/LP01LP.CPY".
       COPY "LIBLP/LP01LP_SQL.CPY".
       COPY "LIBLP/LPWSLP.CPY".
       COPY "LIBLP/LP01LX.CPY".
       COPY "LIBLP/LP01LX_SQL.CPY".
       COPY "LIBLP/LPWSLX.CPY".
       COPY "LIBLP/LP01LXE.CPY".
       COPY "LIBLP/LP01LXE_SQL.CPY".
       COPY "LIBLP/LPWSLXE.CPY".
       COPY "LIBLP/LP01LXG.CPY".
       COPY "LIBLP/LP01LXG_SQL.CPY".
       COPY "LIBLP/LPWSLXG.CPY".
       COPY "LIBLP/LP01LTP.CPY".
       COPY "LIBLP/LP01LTP_SQL.CPY".
       COPY "LIBLP/LPWSLTP.CPY".
       COPY "LIBLP/LP01SP.CPY".
       COPY "LIBLP/LP01SPA.CPY".
       COPY "LIBLP/LP01SPB.CPY".
       COPY "LIBLP/LP01SPC.CPY".
       COPY "LIBLP/LP01SP_SQL.CPY".
       COPY "LIBLP/LPWSSP.CPY".
       COPY "LIBLP/LP01CA.CPY".
       COPY "LIBLP/LP01CA_SQL.CPY".
       COPY "LIBLP/LPWSCA.CPY".
       COPY "LIBGL/GL01GL.CPY".
       COPY "LIBGL/GL01GL_SQL.CPY".
       COPY "LIBGL/GLWSGL.CPY".
       COPY "LIBLP/LP01PD.CPY".
       COPY "LIBLP/LP01PD_SQL.CPY".
       COPY "LIBLP/LPWSPD.CPY".
       COPY "LIBLP/LP01DL.CPY".
       COPY "LIBLP/LP01DL_SQL.CPY".
       COPY "LIBLP/LPWSDL.CPY".
       01  WK-IFN              PIC X(2)     VALUE "WK".

       01  WK-KEY              PIC 9(2)     VALUE 0.

       01  WSEL-LIST           PIC X(5)      VALUE "WSEL.".
       01  HOLD-POOLID         PIC 9(5)      COMP   VALUE 0.
       01  ELE                 PIC 99        COMP   VALUE 0.
       01  TOTEARN             PIC S9(6)V99  COMP   VALUE 0.
       01  UNEARNED            PIC S9(6)V99  COMP   VALUE 0.
       01  LN-WK               PIC 9(6)      COMP   VALUE 0.
       01  LCAP-LCPDTH-DATE-DATE  PIC 9(8)      COMP   VALUE 0.
       01  XXX-REFNO           PIC X(5).
       01  DISP-REV-BAL        PIC X                VALUE "Y".
       01  RV-PURCHASES-FG     PIC X                VALUE "N".
       01  RV-INTERBR-PASSWD-ENTERED PIC X          VALUE "N".

       01  REV-REFNO           PIC X(5)             VALUE " ".
       01  REV-TRCD            PIC XX.
           88  AD-POSTING      VALUE "AD" "A2" "A3" "A4"
                                     "A5" "A6" "A7" "A8"
                                     "A9".
           88  DF-POSTING      VALUE "DF" "D2" "D3" "D4"
                                     "D5" "D6" "D7" "D8"
                                     "D9".
           88  ADDON-POSTING   VALUE "LP" "NP" "ET" "RT" "ST".
           88  REBATE-POSTING  VALUE "RC" "RA" "RP" "R1"
                                     "R2" "R3" "RI" "RS"
                                     "RM" "RD".
       01  HOLD-REV-TRCD      REDEFINES REV-TRCD.
           03 FILLER           PIC X.
           03 TRCD-NODF       PIC 9.

      *----------------------------------------------------------------
      * SAVE-LP-REFER : USED WITH HOLD-BR-TENDER-CD
      *        TO COMPARE FIRST TWO CHARACTERS OF REFERENCE SO THAT
      *        CASH BACK WINDOW WILL OPEN IF OPERATORS INITIALS ARE ENTERED
      *        WITH CA AND PR.
      * HOLD-BR-TENDER-CD: USED TO BREAK DOWN BR-TENDER-CD SO THAT THE
      *        FIRST TWO CHARACTERS ONLY CAN BE COMPARED.
      *----------------------------------------------------------------
       01  SAVE-LP-REFNO            PIC X(5).
       01  SAVE-LP-REFNOX  REDEFINES SAVE-LP-REFNO.
           03  SAVE-LP-REFER        PIC X(2).
           03  FILLER               PIC X(3).
       01  HOLD-BR-TENDER-CDX   OCCURS 3.
           03  HOLD-BR-TENDER-CD    PIC X(2).
           03  FILLER               PIC X(3).
       01  SV-PASSWORD-DRAWER  PIC X                VALUE "N".

       01  HOLD-LN-PLCD        PIC X.
      *01  REVOL-SIGN-WORKER.
      *    03  REVOL-SIGN-WK       PIC 9(6).99-.
      *    03  FILLER             REDEFINES REVOL-SIGN-WK.
      *        05  FILLER          PIC X(9).
      *        05  REVOL-SIGN      PIC X.


       01  DEF-NODEF           PIC S9    VALUE +0.
       01  DEF-NODEFACT        PIC S9    VALUE +0.
       01  SEND-PAYOFF-FG      PIC X.
       01  HOLD-LP-REVTRCD     PIC XX.
       01  HOLD-LP-CURBAL     PIC S9(7)V99 COMP.

       01  TEST-USER-PROFILE           PIC X.
       01  REVERSE-AFTER-RESCHED-FG    PIC X VALUE "N".

      *01  TEST-ALPHA-TILLNO      PIC X.
      *01  NUMERIC-TILLNO         PIC 99.
      *01  NUMERIC-TILLNOX REDEFINES NUMERIC-TILLNO.
      *    03  FILLER             PIC X.
      *    03  NUMERIC-TILLNO1    PIC 9.

       01  SUB                 PIC 9(6) COMP    VALUE 0.
       01  SUB1                PIC 9(6) COMP    VALUE 0.
       01  SUB2                PIC 9(6) COMP    VALUE 0.
       01  MSUB                PIC 9(6) COMP    VALUE 0.
       01  GLNO-EDIT.
           03  GLBR-ED         PIC 9(4)     VALUE 0.
           03  FILLER          PIC X        VALUE "-".
           03  GLNO-ED         PIC 9(7)     VALUE 0.

       01  REBATE-DISP-TAB     PIC X(22) VALUE
           "RCRARPRIRSRMRDRER1R2R3".
       01  REBATE-DISP-RED REDEFINES REBATE-DISP-TAB.
           03  REB-TYPE        PIC XX  OCCURS 11.

       01  D-BRNO              PIC Z999.
      **************************************************
      *         ORDER LINE BUFFER                      *
      **************************************************
       01  LN-BUF              VALUE SPACES.
           03  L-010           PIC 9(6).
           03  FILLER          PIC X.
           03  L-020           PIC XX.
           03  FILLER          PIC X.
           03  L-030           PIC X(5).
           03  L-040           PIC Z(5).99- BLANK ZERO.
           03  L-040RATE       REDEFINES L-040
                               PIC ZZZZ.999-.
           03  L-050           PIC Z(4).99- BLANK ZERO.
           03  L-060           PIC Z(4).99- BLANK ZERO.
           03  L-070           PIC Z(5).99- BLANK ZERO.
           03  L-080-MO        PIC 99.
           03  L-080-DAYR      PIC 99.
           03  L-090           PIC Z(5).99- BLANK ZERO.
           03  L-100           PIC Z(4).99- BLANK ZERO.
           03  L-110           PIC Z(5)9.99-.
           03  FILLER         REDEFINES L-110.
               05  FILLER      PIC X(9).
               05  L-120       PIC X.
      * DISPLAY BUFFER USED IS PRINCIPAL IS OVER 99,999.99
      * LEFT OUT PAID THRU, DOESNT MATTER ON A PAYOFF
       01  LN2-BUF             REDEFINES LN-BUF.
           03  L2-010          PIC 9(6).
           03  FILLER          PIC X.
           03  L2-020          PIC XX.
           03  FILLER          PIC X.
           03  L2-030          PIC X(5).
           03  L2-040          PIC Z(7).99- BLANK ZERO.
           03  L2-050          PIC Z(4).99- BLANK ZERO.
           03  L2-060          PIC Z(5).99- BLANK ZERO.
           03  L2-070          PIC Z(6).99- BLANK ZERO.
           03  FILLER          PIC X.
           03  L2-090          PIC Z(5).99- BLANK ZERO.
           03  L2-100          PIC Z(4).99- BLANK ZERO.
           03  L2-110          PIC Z(5)9.99-.
           03  FILLER         REDEFINES L2-110.
               05  FILLER      PIC X(9).
               05  L2-120      PIC X.
       01  GL-BUF              REDEFINES LN-BUF.
           03  D-GLNO          OCCURS 3 PIC X(12).
           03  D-GLDESC        OCCURS 3 PIC X(20).
           03  D-GLAMT         OCCURS 3 PIC Z(7).ZZ-.
       01  EARN-BUF            REDEFINES LN-BUF.
           03  D-INTYTD        PIC ZZZZ9.99-.
           03  D-TOTEARN       PIC ZZZZ9.99-.
           03  D-LCPDTH        PIC 9999       BLANK ZERO.
           03  FILLER         REDEFINES D-LCPDTH.
               05 D-LCPDTH-MO   PIC 99.
               05 D-LCPDTH-DAYR PIC 99.
           03  D-DEFMNTS       PIC 99.
           03  D-ALDEL         PIC 99         BLANK ZERO.
           03  D-EARNED        PIC ZZZZ9.99-.
           03  D-DLPROC        PIC ZZZZ9.99-.
      *    CANNOT REDEFINE - SEE SETUP-LINE ROUTINE
       01  ENTRY-BUF           VALUE " ".
           03  EB-010          PIC 9(6).
           03  EB-020          PIC XX.
           03  EB-030          PIC X(5).
           03  EB-040          PIC Z(5).99- BLANK ZERO.
           03  EB-040RATE      REDEFINES EB-040
                               PIC ZZZZ.999-.
           03  EB-050          PIC Z(4).99- BLANK ZERO.
           03  EB-060          PIC Z(4).99- BLANK ZERO.
           03  EB-070          PIC Z(5).99- BLANK ZERO.
           03  EB-080-MO       PIC 99.
           03  EB-080-DAYR     PIC 99.
           03  EB-090          PIC Z(5).99- BLANK ZERO.
           03  EB-100          PIC Z(4).99- BLANK ZERO.
           03  EB-110          PIC Z(5)9.99.
           03  EB-120          PIC X.

       01  LINE-BUF            VALUE SPACES.
           03  D-LINE          OCCURS 8 TIMES
                               PIC X(80).
       01  D-TP-BUF REDEFINES LINE-BUF.
           03  FILLER          PIC X(14).
           03  D-GD8           PIC X(20).
           03  D-F22           PIC XXX.
           03  D-GA8           PIC ZZZ,ZZZ.ZZ-.
           03  FILLER          PIC X(32).
           03  FILLER          PIC X(14).
           03  D-GD9           PIC X(20).
           03  FILLER          PIC XXX.
           03  D-GA9           PIC ZZZ,ZZZ.ZZ-.
           03  FILLER          PIC X(32).
           03  FILLER          PIC X(14).
           03  D-GD0           PIC X(20).
           03  FILLER          PIC XXX.
           03  D-GA0           PIC ZZZ,ZZZ.ZZ-.
           03  FILLER          PIC X(32).
           03  FILLER          PIC X(14).
           03  D-GD1           PIC X(20).
           03  FILLER          PIC XXX.
           03  D-GA1           PIC ZZZ,ZZZ.ZZ-.
           03  FILLER          PIC X(32).
           03  FILLER          PIC X(14).
           03  D-GD2           PIC X(20).
           03  FILLER          PIC XXX.
           03  D-GA2           PIC ZZZ,ZZZ.ZZ-.
           03  FILLER          PIC X(32).
           03  FILLER          PIC X(14).
           03  D-GD3           PIC X(20).
           03  FILLER          PIC XXX.
           03  D-GA3           PIC ZZZ,ZZZ.ZZ-.
           03  D-F73.
               05  D-F73A      PIC X(11).
               05  D-F73B      PIC X(10).
               05  D-F73C      PIC ZZZ,ZZ9.99-.
           03  FILLER          PIC X(14).
           03  D-GD4           PIC X(20).
           03  D-F82           PIC XXX.
           03  D-GA4           PIC ZZZ,ZZZ.ZZ-.
           03  D-F83.
               05  D-F83A      PIC X(11).
               05  D-F83B      PIC X(10).
               05  D-F83C      PIC ZZZ,ZZ9.99-.

       01  LINE-TP-LIST.
           03  FILLER          PIC X(20)    VALUE
           "GD8 F22 GA8 GD9 GA9 ".
           03  FILLER          PIC X(36)    VALUE
           "GD0 GA0 GD1 GA1 GD2 GA2 GD3 GA3 GD4 ".
           03  FILLER          PIC X(16)    VALUE
           "F73 F82 GA4 F83.".

       01  LINE-LIST.
           03  FILLER          PIC X(4) VALUE
               "LN1 ".
           03  FILLER          PIC X(24) VALUE
               "GL8 F21 GD8 F22 GA8 F23 ".
           03  FILLER          PIC X(24) VALUE
               "GL9 F31 GD9 F32 GA9 F33 ".
           03  FILLER          PIC X(24) VALUE
               "GL0 F41 GD0 F42 GA0 F43 ".
           03  FILLER          PIC X(32)    VALUE
               "GL1 F51 GD1 F52 GA1 F53 GL2 F61 ".
           03  FILLER          PIC X(40)    VALUE
               "GD2 F62 GA2 F63 GL3 F71 GD3 F72 GA3 F73 ".
           03  FILLER          PIC X(24)    VALUE
               "GL4 F81 GD4 F82 GA4 F83.".


       01  ENTRY-LINE          PIC X(48)    VALUE
           "010 020 030 040 050 060 070 080 090 100 110 120.".

       01  GL-LIST.
           03  FILLER          PIC X(36) VALUE
           "GL1 GL2 GL3 GD1 GD2 GD3 GA1 GA2 GA3.".

       01  EARN-LIST.
           03  FILLER          PIC X(34) VALUE
           "H09 H10 H17 H18 H181 H21 PROCEEDS.".

       COPY "LIBWI/PFSWINDOWSW.CPY".
       COPY "LIBGB/CAPASSWDW.CPY".
       COPY "LIBWI/RVENTW.CPY".
       COPY "LIBWI/MEMOSCW.CPY".
       COPY "LIBGB/SYSTEMW.CPY".
       COPY "LIBGB/GETENVW.CPY".
       COPY "LIBLP/LPWKPATH.CPY".
       COPY "LIBGB/SPPDTHW.CPY".
       COPY "LIBGB/DATERW.CPY".
       COPY "LIBGB/TIMEWK.CPY".
       COPY "LIBLP/LPMDTEW.CPY".
       COPY "LIBLP/LPXDTEW.CPY".
       COPY "LIBLP/LPIBPCW.CPY".
       COPY "LIBLP/LPCDELW.CPY".
       COPY "LIBLP/LPCEPPW.CPY".
       COPY "LIBLP/AFPDLLPW.CPY".
       COPY "LIBLP/LPMENUW.CPY".
      *COPY "LIBLP/LPWKLXE.CPY".
       COPY "LIBCL/CLMENUW_EXT.CPY".
       COPY "LIBGB/PASSWDW.CPY".
       01  RV-SEQ             PIC 9   VALUE 1.
       01  RV-PL-SEQ          PIC 9   VALUE 2.
       01  RV-PA-SEQ          PIC 9   VALUE 3.
       01  RV-POSTBR-SEQ      PIC 9   VALUE 4.
       01  RV-SP-SEQ          PIC 9   VALUE 5.
       01  RV-SP-SEQ-INTERBRANCH  PIC 9   VALUE 6.
       01  RV-OT-SEQ-INTERBRANCH  PIC 9   VALUE 7.
       01  RV-AP-SEQ-INTERBRANCH  PIC 9   VALUE 8.
       01  RV-BK-BD-SEQ-INTERBR   PIC 9   VALUE 9.
       01  RV-PE-SEQ-INTERBR      PIC 99  VALUE 10.
       01  RV-PRIOR-DATE          PIC 99  VALUE 11.
       01  RV-PLP2-SEQ-INTERBR    PIC 99  VALUE 12.
       01  RV-SX-SEQ-INTERBR      PIC 99  VALUE 13.
       01  RV-SV-SEQ-INTERBR      PIC 99  VALUE 14.
       01  RV-RE-SEQ-INTERBR      PIC 99  VALUE 15.
       01  RV-IR-SEQ-INTERBR      PIC 99  VALUE 16.
       01  RV-PX-SEQ-INTERBR      PIC 99  VALUE 17.
       01  RV-PW-SEQ-INTERBR      PIC 99  VALUE 18.
       01  RV-WOW2-SEQ-INTERBR    PIC 99  VALUE 19.
       01  RV-PI-SEQ-INTERBR      PIC 99  VALUE 20.
       01  RV-PR238-SEQ-INTERBR   PIC 99  VALUE 21.
      *ALPAAIWLWIWODCOPRPR1R2R3
       01  RV-ADDON-SEQ           PIC 99  VALUE 22.
       01  RV-DF-SEQ              PIC 99  VALUE 23.
       01  RV-INS-REBATE-SEQ-INTERBR PIC 99  VALUE 24.


       COPY "LIBGB/CONAME_EXT.CPY".
       COPY "LIBGB/SCREENW.CPY".
       COPY "LIBLP/LONPF_DEF.CPY".
       COPY "LIBLP/LPSMNU_DEF.CPY".
       COPY "LIBLP/LPLNMU_DEF.CPY".
       COPY "LIBLP/LPCAMU_DEF.CPY".
       COPY "LIBLP/LPVDMU_DEF.CPY".
       COPY "LIBWI/RVENT_DEF.CPY".
       COPY "LIBLP/LONPF_WKS.CPY".
       COPY "LIBLP/LPSMNU_WKS.CPY".
       COPY "LIBLP/LPLNMU_WKS.CPY".
       COPY "LIBLP/LPCAMU_WKS.CPY".
       COPY "LIBLP/LPVDMU_WKS.CPY".
       COPY "LIBWI/RVENT_WKS.CPY".
       COPY "LIBGB/HELPLINK.CPY".

       COPY "LIBGB/GPENVW.CPY".
       COPY "LIBGB/CONNECTW_SQL.CPY".
       COPY "LIBGB/FILEWK.CPY".
       COPY "LIBGB/MESSWK.CPY".

      *    W A R N I N G:  BUFFER REDEFINES MESS
      *    CODE VERIFICATION BUFFER
      *    THIS BUFFER MUST BE 2 BYTES LONGER THAN LONGEST
      *    STRING TO BE VERIFIED; CODE ORDER SHOULD BE
      *    ASSUMED SIGNIFICANT UNLESS PROCEDURAL
      *    STATEMENTS INDICATE OTHERWISE.
       01  CDV-BUF           VALUE " ".
           03  CDV-CD        PIC X(2) OCCURS 83.
       01  CDV-SUB           PIC 9(6) COMP-3.
           88 CDV-NO-MATCH   VALUE 0.
           88 CDV-MATCH      VALUE 1 THRU 100.
       01  CDV-02            PIC X(30) VALUE
           "RCRARPRIRSRMRDRER1R2R3CCCACOCE".
       01  CDV-16            PIC X(22)  VALUE
           "RCRARPRIRSRMRDRER1R2R3".
       01  CDV-17            PIC X(40) VALUE
           "OTWOAPJDPLP2P3P4P5PIPWTSTPSPACO2W2Z2BKBD".
       01  CDV-INTERBRANCH.
           03  FILLER        PIC X(56) VALUE
           "PYSSDFD2D3D4D5D6D7D8D9RVO2Z2PAPOOVSPOTAPRIRSRMACBKBDPEIN".
           03  FILLER        PIC X(44) VALUE
           "PLP2SXSVREIRPXPWW2PIALPAAIWLWIWODCOPRPR1R2R3".

       COPY "LIBGB/GETFMW.CPY".
       COPY "LIBLP/LPLOANW.CPY".
       COPY "LIBLP/LPPFBUF.CPY".

       SCREEN SECTION.
       COPY "LIBLP/LONPF_SCN.CPY".
       COPY "LIBLP/LPSMNU_SCN.CPY".
       COPY "LIBLP/LPLNMU_SCN.CPY".
       COPY "LIBLP/LPCAMU_SCN.CPY".
       COPY "LIBLP/LPVDMU_SCN.CPY".
       COPY "LIBWI/RVENT_SCN.CPY".

       PROCEDURE DIVISION
              USING FORM-PATHNAME EXIT-PATHNAME PROG-BUF UPDATE-BUF.
       DECLARATIVES.
       DECLARE-ERROR SECTION.
           USE AFTER ERROR PROCEDURE ON
              WK-FILE.
       COPY "LIBGB/DECLARE.CPY".
           PERFORM CLOSE-SP1-FILE.
           PERFORM CLOSE-PD1-FILE.
           PERFORM CLOSE-LXG1-FILE.
           PERFORM CLOSE-LXE1-FILE.
           PERFORM CLOSE-LX1-FILE.
           PERFORM CLOSE-LTP1-FILE.
           PERFORM CLOSE-LP1-FILE.
           PERFORM CLOSE-DL1-FILE.
           PERFORM CLOSE-CA1-FILE.
           PERFORM CLOSE-GL1-FILE.
           PERFORM CLOSE-BR-FILE.
      * PD-FILE NOT CLOSED TO INSURE LOCKING
      * OF RECORD GOING INTO UPDATE PROGRAM (LONPF2)
           CLOSE WK-FILE.

       COPY "LIBGB/DECLAR2.CPY".

      **************************************************
      *      P R O G R A M   C O N T R O L             *
      **************************************************
       MAIN-PROGRAM SECTION.
           PERFORM SQL-CONNECT.

      D    STOP MESS.
           MOVE FORM-PATHNAME TO FORM-PATH.
           MOVE "LONPF" TO VDU-FORM-NAME.

           MOVE USER-PID TO TEMP-PID.
           IF INTERRUPT-FG = "Y"
              MOVE " " TO VDU-WIMENU-SELECTION
           ELSE
              MOVE "C" TO VDU-WIMENU-SELECTION.
           MOVE "F" TO VDU-CLMENU-SELECTION.

           PERFORM GET-GPENV.

           MOVE 0 TO IO-FG.
           MOVE SPACES TO ERRCD ROUTE-CD REV-TRCD REV-REBATE.

           PERFORM RESTORE-SCREEN.
           MOVE LP-REFNO TO RVENT-REFNO.

           PERFORM OPEN-SP1-FILE.
           MOVE HOLD-SP1-KEY TO SP1-KEY.
           PERFORM READ-SP1-FILE.
           PERFORM CLOSE-SP1-FILE.
           IF IO-FG NOT = 0
              MOVE "INVALID STATE PARAMETER RECORD" TO MESS
              PERFORM SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

      * ALLOW CNTRL 'N' INTERRUPT:
           MOVE "WI/MAKERS" TO VDU-CTRL-N-PROG.

           MOVE LN-LCPDTH-DATE TO LCAP-LCPDTH-DATE-DATE.

      *    -------------------------------------------------------------
      *    TEST ENVIRONMENT VARIABLE "RVLINES" TO DETERMINE WHETHER
      *    OR NOT TO DISPLAY BALANCES ON REVERSALS.
      *    -------------------------------------------------------------
           MOVE "RVLINES" TO GETENV-BUF.
           PERFORM GETENV-CALL.
           IF STAT = "00"
              MOVE "N" TO DISP-REV-BAL
           ELSE
              MOVE "Y" TO DISP-REV-BAL.

           PERFORM SELECTION-MODULE.
           GO TO END-ROUTINE.

      *************************************
       SELECTION-MODULE SECTION.
      *************************************

           MOVE " " TO INS-RB-TBL(1) INS-RB-TBL(2)
                       INS-RB-TBL(3) INS-RB-TBL(4)
                       INS-RB-TBL(5) INS-RB-TBL(6)
                       INS-RB-TBL(7) INS-RB-TBL(8).

      * STOP REVERSAL OF TRANSFERED ACCOUNTS:
           IF LN-POCD = "BT"
              MOVE "ACCOUNT WAS TRANSFERED, REVERSAL NOT ALLOWED"
                                                           TO MESS
              PERFORM SEND-MESS
              GO TO RET-TO-ENTRY-ROUTINE.

           PERFORM REVERSAL-ROUTINE.
           IF ROUTE-CD = "7"
              GO TO RET-TO-ENTRY-ROUTINE.

           PERFORM DISPLAY-ENTRY-LINE.
           IF ROUTE-CD = "7"
              GO TO RET-TO-ENTRY-ROUTINE.

           PERFORM ACCEPT-ENTRY-ROUTINE.
           IF ROUTE-CD = "7"
              GO TO RET-TO-ENTRY-ROUTINE.

           MOVE EXT-CONAME-USER-ID TO TEST-USER-PROFILE.

           IF (GP-RV-MEMO = "N" OR " ") OR
               LP-REFNO = "NSF"
               GO TO SKIP-REVERSAL-WINDOW.

           IF GP-RV-MEMO = "Y" OR
              TEST-USER-PROFILE > GP-RV-MEMO
                MOVE LN-OWNBR         TO EXT-WI-CL-OWNBR 
                MOVE LN-ACCTNO        TO EXT-WI-CL-ACCTNO
      *         MOVE LN-APP-NUMBER    TO EXT-WI-CL-APP-NUMBER
                MOVE 1                TO EXT-WI-CL-SSNO-NO
                MOVE LN-SSNO(1)       TO EXT-WI-CL-SSNO(1)
                MOVE "L"              TO MEMOSC-ONLY
                MOVE "R"              TO MEMOSC-MEMO-TYPE
                MOVE "WI/MEMOSC" TO FORM-NAM
                CALL FORM-PROGX USING FORM-PATH MEMOSC-BUF EXIT-PATHNAME
                CANCEL FORM-PROGX.

       SKIP-REVERSAL-WINDOW.
           MOVE "3" TO ROUTE-CD.
           IF REV-TRCD = "TS"
              MOVE "5" TO NEW-PROG-SUB
           ELSE
           IF REV-TRCD = "TP"
              MOVE "Z" TO NEW-PROG-SUB
      * ADDED THIS TO LPPFBUF TO GET PASSED
      *       CALL XFER USING STAT TP-LIST TP-BUF
           ELSE
           IF ADDON-POSTING
              MOVE "F" TO NEW-PROG-SUB
           ELSE
           IF REV-TRCD = "AV"
              MOVE "M" TO NEW-PROG-SUB
           ELSE
           IF REV-TRCD = "PU"
              MOVE "S" TO NEW-PROG-SUB
           ELSE
              MOVE "2" TO NEW-PROG-SUB.

           GO TO SELECTION-EXIT-PROG.

       RET-TO-ENTRY-ROUTINE.
           MOVE "1" TO NEW-PROG-SUB.
       SELECTION-EXIT-PROG.
           MOVE "P" TO ERRCD.
           PERFORM SAVE-SCREEN.
       SELECTION-MODULE-EXIT.
           EXIT.

      ************************************
       REVERSAL-ROUTINE SECTION.
      ************************************
           MOVE " " TO REV-REFNO.

           PERFORM OPEN-LP1-FILE.

           MOVE LP-PATH-OWNBR TO LP-BRNO
                                 QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO
           MOVE LN-ACCTNO     TO LP-ACCTNO
                                 QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           MOVE ALL "0"       TO QLP1-WBEG-SEQNO.
           MOVE ALL "9"       TO LP-SEQNO
                                 QLP1-WEND-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.

       REVERSAL-RTN-CONT.
           PERFORM READ-LP1-FILE-PREVIOUS.
           IF IO-FG NOT = 0
      * IF YOU NEED CONVERSIONS THAT ONLY HAVE ONE PAYMENT "BF" LINE TO BRING
      * UP WINDOW, ADD A TEST ON LN-CONVERCD HERE, ALONG WITH LP-SEQNO = 1
              OR (LP-SEQNO = 1)
      *CS 10/11/06 PR#2529
               OR (LP-TRCD = "BF" AND GP-POST-XX-BF-PAYMENTS = "Y")
                OR (LP-TRCD = "AA" AND LP-REFNO = "INVES")
                 OR (LP-BRNO NOT = LP-PATH-OWNBR)
                  OR (LP-ACCTNO NOT = LN-ACCTNO)
                  IF REV-REBATE = "Y"
                    GO TO REVERSAL-REC-FOUND
                  ELSE
                    MOVE "NO EXISTING PMT RECORDS" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

      * IO-FG = 0
      * SSNO = TO ALL 9'S SIGNALS AN AUTOMATED CONVERSION
           IF (LP-SSNO = 999999999 OR 9999999999)
      * ADDED 'R' AND 'T' FOR REGENCY NOT TO GET WINDOW
              IF (LN-CONVERCD NOT = "R" AND NOT = "T" AND NOT = "P")
                         AND (REV-REBATE NOT = "Y")
                    PERFORM IBPC-TEST
                    PERFORM DO-RVENT-WIN
                    IF RVENT-ERRCD="X"
                       MOVE "7" TO ROUTE-CD
                       GO TO REVERSAL-RTN-EXIT
                    ELSE
                       MOVE "Y" TO CONV-REV-FLAG
                       MOVE LP-TRCD  TO REV-TRCD
                       MOVE LP-REFNO TO REV-REFNO
                       GO TO BYPASS-SERVICE
              ELSE
                   IF REV-REBATE = "Y"
                      GO TO REVERSAL-REC-FOUND
                   ELSE
                      MOVE "NO EXISTING PMT RECORDS" TO MESS
                      PERFORM SEND-MESS
                      MOVE "7" TO ROUTE-CD
                      GO TO REVERSAL-RTN-EXIT.

           IF LP-TRCD = "RV" OR LP-REV = "Y"
                 GO TO REVERSAL-RTN-CONT.

           IF LP-TRCD = "PS"
              MOVE "Y" TO REVERSE-AFTER-RESCHED-FG
              GO TO REVERSAL-RTN-CONT.

           IF LP-TRCD = "ES"
              GO TO REVERSAL-RTN-CONT.

      *    ------------------------------------------------------------------
      *    ADDED PASSWORD TO REVERSAL OF CHARGE-OFF IF TRANSACTION
      *    DATE IS AFTER A MONTH END.  (REQ #168  MJD 11/17/97)
      *
      *      NOTE: REV-REBATE IS TESTED FOR ' ' SINCE REVERSAL OF A
      *            PAYOFF POSTED AFTER A P&L WILL READ THE PAYMENT RECORD
      *            OF THE P&L AGAIN LOOKING FOR REBATES
      *    ------------------------------------------------------------------
           IF (LP-TRCD = "PL" OR "P2" OR "P3" OR "P4" OR "P5")
                    AND (REV-REBATE NOT = "Y")
              MOVE LP-TRDATE TO NDTE-DATE
              MOVE 50 TO NDTE-DD
              PERFORM NEW-DATE-CALCULATION
              IF TRANS-DATE > NDTE-DATE
                 MOVE RV-PL-SEQ TO PASSWDW-SEQ
                 MOVE "TO REVERSE CHG-OFF AFTER EOM." TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.


           IF TRANS-DATE NOT = LP-TRDATE
              MOVE RV-PRIOR-DATE TO PASSWDW-SEQ
              MOVE "TO REVERSE PRIOR DATE TRANS" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "7" TO ROUTE-CD
                 GO TO REVERSAL-RTN-EXIT.

      *--CS 06/14/01 NEEDED TO ALLOW FOR INTERBRANCH P/O REVERSAL BUT
      *     DONT ALLOW REVERSAL OF INDIVIDUAL REBATES THRU INTERBRANCH.
      *     'RV-INTERBR-PASSWOD-ENTERED' ADDED TO STOP ASKING OF PASSWORD FOR
      *     EACH REBATE WHICH IS PART OF THE PAYOFF.

           IF PATH-MACHINE NOT = " "
              IF REV-REBATE NOT = "Y"
                 MOVE CDV-INTERBRANCH TO CDV-BUF
                 PERFORM CDV-VERIFY
                 IF NOT CDV-MATCH
                   MOVE "INVALID FOR INTER OFFICE!" TO MESS
                   PERFORM SEND-MESS
                   MOVE "7" TO ROUTE-CD
                   GO TO REVERSAL-RTN-EXIT
              END-IF
              IF RV-INTERBR-PASSWD-ENTERED = "N"
                 MOVE RV-SEQ TO PASSWDW-SEQ
                 MOVE "TO REVERSE TRANSACTION." TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT
                 ELSE
                    MOVE "Y" TO RV-INTERBR-PASSWD-ENTERED.

      * DETERMINE IF LP-REFNO IS ON FILE AS A BATCH-REFCD
      * NOTE: CL/CDBRRD WILL RETURN SPACES IN BATCH-REFCD
      *       IF IT IS NOT ON FILE
      
           IF REV-REBATE = " "
              IF LP-REFNO NOT = " "
                 MOVE LP-REFNO    TO BATCH-REFCD
                 MOVE "CL/CDBRRD" TO FORM-NAM
                 CALL FORM-PROGX USING FORM-PATH
                                      BATCH-REFCD
                                      BATCH-REFCD-LC-FG
                                      BATCH-REFCD-FILE-TYPE
                 CANCEL FORM-PROGX
                 IF BATCH-REFCD = " "
                    MOVE LOW-VALUES TO BATCH-REFCD
                    MOVE "N"        TO BATCH-REFCD-LC-FG.

      * PASSWORD PROTECT ALLOWING POSTING AND REVERSALS OF "PA" (NSF) (LBOX)
      * TRANSACTIONS  MERCURY PR#234
      * JTG 010409 CHANGED TO TEST FOR LP-REFNO = ALLOT, LBOX, TCOLL,
      *             TPAY OR MGRAM                              MERCURY PR#245
      * JTG 030423 CHANGED REVERSAL OF PAYOFFS TO SKIP TEST FOR PASSWORD
      *            AFTER 'REV-REBATE IS SET = TO Y'. ROUTINE WAS READING
      *            PAYMENT RECORD OF TRANSACTION POSTED PRIOR TO PAYOFF
      *            AND IF THIS WAS EX. 'LBOX' WAS ASKING FOR PASSWORD
      *            EVEN IF PAYOFF WAS NOT POSTED 'EX. LBOX'       REGACC  J027
      *IF WORLD, ALLOW REVERSAL OR PA OR PE WITH REFCD OF "DEBIT" WITHOUT
      *          MAKING THEM ENTER PASSWORD, WORLD PR# 1005:

           IF REV-REBATE = " "
             IF PATH-MACHINE = SPACES
                IF (LP-TRCD = "PA" OR "PE")
                   IF (LP-REFNO = "DEBIT" OR "PHACH" OR "PHDBT")
                      GO TO SKIP-CHECK-REV-PASSWD.


           IF REV-REBATE = " "
             IF PATH-MACHINE = SPACES
              IF ( LP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
                                      OR "TPAY" OR "MGRAM")
                 OR
                 ( (BATCH-REFCD NOT = " "       ) AND
                   (BATCH-REFCD = LP-REFNO      )
                 )
                 MOVE RV-PA-SEQ TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'PA TYPE' TRANSACTION"
                                                TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

       SKIP-CHECK-REV-PASSWD.
           IF REV-REBATE = " "
             IF PATH-MACHINE NOT = SPACES
              IF ( LP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
                                      OR "TPAY" OR "MGRAM")
                 OR
                 ( (BATCH-REFCD NOT = " "       ) AND
                   (BATCH-REFCD = LP-REFNO      )
                 )
                 MOVE RV-PR238-SEQ-INTERBR TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'PA TYPE INTERBRANCH' TRANSACTION"
                                                TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "PA INTERBR REVERSAL NOT ALLOWED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

      * ADDED IF REV-REBATE = " " IN FRONT OF ALL THESE IF'S BECAUSE WHEN
      * A PAYOFF LOOPS BACK THRU LOOKING FOR REBATES, IT WAS GETTING CAUGHT
      * ON THESE IF STATEMENTS FOR THE LAST LP RECORD PRIOR TO REVERSAL.
      * EXAMPLE WAS A "PL" FOLLOWED BY A "PO" INTERBRANCH, AND THE POSTING
      * BRANCH WAS TRYING TO REVERSE THE "PO" AND KEPT GETTING ERROR OF
      * PL/P2 INTERBRANCH REVERSAL NOT ALLOWED AND THEY WERE JUST TRYING TO
      * REVERSE THE "PO" BUT IT HIT THE "PL" WHILE LOOKING FOR REBATES TIED
      * TO THE "PO". SHOULD NOT LOOK AT ANY OF THESE PASSWORD IF STATEMENTS
      * WHILE JUST SEARCHING FOR REBATES, SO ONLY TEST IF REV-REBATE " ".
      * PL# 730 3/17/2011 BAH.

           IF REV-REBATE = " "
            IF LP-TRCD = "AL" OR "AI" OR "WL" OR "WI" OR "WO" OR
                        "DC" OR "OP" OR "RP" OR "R1" OR "R2" OR "R3"
             IF PATH-MACHINE NOT = SPACES
                MOVE RV-PR238-SEQ-INTERBR TO PASSWDW-SEQ
                  MOVE "TO REVERSE ## INTERBR" TO
                                                PASSWDW-PROMPT2
                  INSPECT PASSWDW-PROMPT2 REPLACING ALL "##" BY
                                                            LP-TRCD
                  PERFORM PASSWORD-MUST-EXIST
                  IF PASSWDW-STAT NOT = "OK"
                    MOVE "## INTERBR REVERSAL NOT ALLOWED" TO MESS
                    INSPECT MESS REPLACING ALL "##" BY LP-TRCD
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
            IF LP-TRCD = "RC" OR "RA" OR "RP" OR "R1" OR "R2" OR "R3"
             IF PATH-MACHINE NOT = SPACES
                MOVE RV-INS-REBATE-SEQ-INTERBR TO PASSWDW-SEQ
                  MOVE "TO REVERSE ## INTERBR" TO
                                                PASSWDW-PROMPT2
                  INSPECT PASSWDW-PROMPT2 REPLACING ALL "##" BY
                                                            LP-TRCD
                  PERFORM VERIFY-PASSWORD              
                  IF PASSWDW-STAT NOT = "OK"
                    MOVE "## INTERBR REVERSAL NOT ALLOWED" TO MESS
                    INSPECT MESS REPLACING ALL "##" BY LP-TRCD
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

      *************************************************************
      * PASSWORD PROTECT REVERSAL OF ADDONS
      *************************************************************
           IF REV-REBATE = " "
            IF LP-TRCD = "LP" OR "NP" OR "ET" OR "RT" OR "ST"
              IF PATH-MACHINE = " "
                 MOVE RV-ADDON-SEQ TO PASSWDW-SEQ
                 MOVE "TO REVERSE AN ADDON" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.


      * PASSWORD PROTECT REVERSAL OF SP (SET POOL) TRANSACTIONS
      * MERCURY 03/12/01
      
           IF REV-REBATE = " "
            IF LP-TRCD = "SP"
              IF PATH-MACHINE = " "
                  MOVE RV-SP-SEQ TO PASSWDW-SEQ
                  MOVE "TO REVERSE 'SP' TRANSACTION." TO PASSWDW-PROMPT2
              ELSE
                  MOVE RV-SP-SEQ-INTERBRANCH TO PASSWDW-SEQ
                  MOVE "TO REVERSE 'SP' INTERBRANCH." TO PASSWDW-PROMPT2
              END-IF
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "7" TO ROUTE-CD
                 GO TO REVERSAL-RTN-EXIT.
      *CS
           IF REV-REBATE = " "
            IF LP-TRCD = "OT"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-OT-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'OT' INTERBRANCH" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
            IF LP-TRCD = "AP"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-AP-SEQ-INTERBRANCH TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'AP' INTERBRANCH" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.


           IF REV-REBATE = " "
            IF LP-TRCD = "BD" OR "BK"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-BK-BD-SEQ-INTERBR TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'BK / 'BD' INTERBR"
                                                TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
            IF LP-TRCD = "PE"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-PE-SEQ-INTERBR TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'PE' INTERBR"
                                                TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.


           IF REV-REBATE = " "
            IF LP-TRCD = "PL" OR LP-TRCD = "P2"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-PLP2-SEQ-INTERBR TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'PL OR P2' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "PL/P2 INTERBR REVERSAL NOT ALLOWED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
            IF LP-TRCD = "SX"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-SX-SEQ-INTERBR   TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'SX' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "'SX' INTERBR REVERSAL NOT ALLOWED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
            IF LP-TRCD = "SV"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-SV-SEQ-INTERBR   TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'SX' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "'SV' INTERBR REVERSAL NOT ALLOWED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
             IF LP-TRCD = "RE"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-RE-SEQ-INTERBR   TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'RE' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "'RE' INTERBR REVERSAL NOT ALLOWED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
            IF LP-TRCD = "IR"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-IR-SEQ-INTERBR   TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'IR' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "'IR' INTERBR REVERSAL NOT ALLOWED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
            IF LP-TRCD = "PX"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-PX-SEQ-INTERBR   TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'PX' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "'PX' INTERBR REVERSAL NOT ALLOWED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
            IF LP-TRCD = "PW"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-PW-SEQ-INTERBR   TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'PW' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "'PW' INTERBR REVERSAL NOT ALLOWED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
            IF LP-TRCD = "PI"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-PI-SEQ-INTERBR   TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'PI' INTERBR" TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "'PI' INTERBR REVERSAL NOT ALLOWED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           IF REV-REBATE = " "
            IF LP-TRCD = "W2" OR "WO"
              IF PATH-MACHINE NOT = " "
                 MOVE RV-WOW2-SEQ-INTERBR   TO PASSWDW-SEQ
                 MOVE "TO REVERSE 'WO' OR 'W2' INTERBR"
                                         TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "'WO/W2' INTERBR REVERSAL NOT ALLOWED" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

      *    -------------------------------------------------------------------
      *    WORLD'S CHECK RESTRICT REVERSAL OF INTERBRANCH PAYMENTS
      *     NOTE:
      *         WHEN LP-POSTING-BR = 0 WORLD WAS NOT SETUP TO DO INTERBRANCH
      *
      *    EXAMPLE:
      *     BRANCH 1 POST A PAYMENT TO ACCOUNT IN BRANCH 2
      *     BRANCH 1 GETS NSF NOTICE ON CHECK
      *     BRANCH 1 TRIES TO REVERSE PAYMENT W/ NSF IN REFNO  - ALLOW POSTING
      *     BRANCH 1 TRIES TO REVERSE PAYMENT W/O NSF IN REFNO - ALLOW POSTING
      *     BRANCH 2 TRIES TO REVERSE PAYMENT- SEND WARNING & FORCE PASSWD
      *     BRANCH 3 TRIES TO REVERSE PAYMENT- SEND WARNING & FORCE PASSD
      *    -------------------------------------------------------------------
      * 9/26/08 - NOW WORLD WANTS BRANCH THAT POSTED PMT TO BE ABLE TO
      *           REVERSE WITHOUT PASSWORD WITHOUT REQUIRING THE NSF.
      *           I DON'T WANT TO ADD ANOTHER IF TO THIS CLUSTERBLEEP OF
      *           ANDS & ORS, SO WORLD WILL DO THE CHECK BELOW & SKIP
      *           PAST THE OLD CHECK BELOW

           IF ( (LP-TRCD = "PY" OR "PO") AND (LP-POSTING-BR NOT = 0) AND
                (REV-REBATE NOT = "Y") )
              IF ( BRANCH NOT = LP-POSTING-BR )
                 MOVE
                "REVERSAL MUST BE COMPLETED BY THE POSTING BRANCH #&&&&"
                    TO MESS
                 MOVE LP-POSTING-BR TO D-BRNO
                 INSPECT MESS REPLACING FIRST "&&&&" BY D-BRNO
                 PERFORM SEND-MESS
                 MOVE RV-POSTBR-SEQ TO PASSWDW-SEQ
                 MOVE "TO REVERSE INTERBR TRANSACTION."
                                                  TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

           GO TO END-CHECK-INTERBRANCH-REVERSAL.
      *    -------------------------------------------------------------------
      *    RESTRICT REVERSAL OF INTERBRANCH PAYMENTS
      *     NOTE:
      *           WHEN LP-POSTING-BR = 0 WORLD WAS NOT SETUP TO DO INTERBRANCH
      *
      *    EXAMPLE:
      *     BRANCH 1 POST A PAYMENT TO ACCOUNT IN BRANCH 2
      *     BRANCH 1 GETS NSF NOTICE ON CHECK
      *     BRANCH 1 TRIES TO REVERSE PAYMENT W/ NSF IN REFNO  - ALLOW POSTING
      *     BRANCH 1 TRIES TO REVERSE PAYMENT W/O NSF IN REFNO - FORCE PASSWD
      *     BRANCH 2 TRIES TO REVERSE PAYMENT                  - FORCE PASSWD
      *     BRANCH 3 TRIES TO REVERSE PAYMENT                  - FORCE PASSWD
      *    -------------------------------------------------------------------
      * ADDED THE REV-REBATE TEST 11/27/00, BARB AND BETH
      * WHEN OWNING BRANCH TRIED TO "RV" A "PB" WITH NO REBATES, AND THE
      * PREVIOUS TRANSACTION WAS AN INTERBRANCH PAYMENT, THIS "IF" WAS ASKING
      * FOR THE PASSWORD, WHEN IT SHOULD NOT !!
      * BECAUSE IT LOOPS BACK THRU HERE WITH REV-REBATE = "Y", LOOKING FOR REB'S
       CHECK-INTERBRANCH-REVERSAL.
           IF ( (LP-TRCD = "PY" OR "PO") AND (LP-POSTING-BR NOT = 0) AND
                (REV-REBATE NOT = "Y") )
              IF ( BRANCH NOT = LP-POSTING-BR )
                OR
                 ( BRANCH = LP-POSTING-BR   AND
                   BRANCH NOT = LN-OWNBR    AND
                   HOLD-LP-REFNO NOT = "NSF"
                 )
                 MOVE RV-POSTBR-SEQ TO PASSWDW-SEQ
                 MOVE "TO REVERSE INTERBR TRANSACTION."
                                                  TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

       END-CHECK-INTERBRANCH-REVERSAL.

           PERFORM READ-EARNINGS.

           IF LP-CURBAL = 0
              IF LP-TRCD = "PO"
                 GO TO REVERSAL-BYPASS-PD1
              ELSE
                 IF LP-TRCD = "RN" OR = "SC" OR = "PB"
                                 OR "RB" OR "RO"
                    GO TO REVERSAL-VERIFY-PD1.

           IF REV-REBATE = "Y"
      *     "RCRARORIRSRMRDRE".
              MOVE CDV-16 TO CDV-BUF
              PERFORM CDV-VERIFY
              IF CDV-NO-MATCH
                     AND (LP-TRCD = "CI" OR "CS" OR "CM")
                 MOVE "CAN NOT REVERSE CI CS OR CM" TO MESS
                 PERFORM SEND-MESS
                 MOVE "7" TO ROUTE-CD
                 GO TO REVERSAL-RTN-EXIT
              ELSE
              IF CDV-MATCH AND LP-MANUAL-RB NOT = "Y"
               IF  LP-EARNED(1) = 0
                      AND LP-EARNED(2) = 0
                       AND LP-EARNED(3) = 0
                        AND LXE-EARN(1) = 0
                         AND LXE-EARN(2) = 0
                          AND LXE-EARN(3) = 0
                           AND LP-INTPAID = 0
                IF LP-REFNO NOT = "CHECK"
                   COMPUTE REB-AMOUNT(CDV-SUB) = LP-TRAMT * -1
                   IF LP-TRCD = "RI"
                      COMPUTE HOLD-DLRVCHGS-ADJ(1) =
                                       LP-DLRVCHGS-ADJ(1) * -1
                      COMPUTE HOLD-DLRVCHGS-ADJ(2) =
                                       LP-DLRVCHGS-ADJ(2) * -1
                      COMPUTE HOLD-DLRVCHGS-ADJ(3) =
                                       LP-DLRVCHGS-ADJ(3) * -1
                      COMPUTE HOLD-DLPARVHELD-ADJ =
                                       LP-DLPARVHELD-ADJ * -1
                      COMPUTE HOLD-DLPARVPAID-ADJ =
                                       LP-DLPARVPAID-ADJ * -1
                      GO TO REVERSAL-RTN-CONT
                   ELSE
                      IF LP-TRCD = "RC"
                         MOVE "Y" TO INS-RB-TBL(1)
                         GO TO REVERSAL-RTN-CONT
                       ELSE
                         IF LP-TRCD = "RA"
                            MOVE "Y" TO INS-RB-TBL(2)
                            GO TO REVERSAL-RTN-CONT
                          ELSE
                            IF LP-TRCD = "RP"
                               MOVE "Y" TO INS-RB-TBL(3)
                               GO TO REVERSAL-RTN-CONT
                             ELSE
                               IF LP-TRCD = "R1"
                                  MOVE "Y" TO INS-RB-TBL(4)
                                  GO TO REVERSAL-RTN-CONT
                                ELSE
                                  IF LP-TRCD = "R2"
                                     MOVE "Y" TO INS-RB-TBL(5)
                                     GO TO REVERSAL-RTN-CONT
                                   ELSE
                                     IF LP-TRCD = "R3"
                                        MOVE "Y" TO INS-RB-TBL(6)
                                        GO TO REVERSAL-RTN-CONT
                                     ELSE
                                        IF LP-TRCD = "RS"
                                           PERFORM READ-LXR-REB-AMT
                                           GO TO REVERSAL-RTN-CONT
                                        ELSE
                                           GO TO REVERSAL-RTN-CONT.

           GO TO REVERSAL-REC-FOUND.

       REVERSAL-VERIFY-PD1.
           MOVE "R" TO PD-ID.
           MOVE BRANCH TO PD-BRANCH.
           MOVE LN-ACCTNO TO PD-SOC-SEC.
           PERFORM OPEN-PD1-FILE.
           PERFORM READ-PD1-FILE.
           IF IO-FG NOT = 0
              MOVE "INITIATE REVERSAL FROM 'DIRECT LOAN VOID'" TO MESS
              PERFORM SEND-MESS
      *    ------------------------------------------------------------------
      *    TEST ENVIRONMENT VARIABLE "ALLOW_RV_PB_NO_PD" TO DETERMINE WHETHER
      *    OR NOT TO SKIP VERIFY OF PD RECORD ON REVERSAL OF RENEWAL
      *    ------------------------------------------------------------------
              MOVE "ALLOW_RV_PB_NO_PD" TO GETENV-BUF
              PERFORM GETENV-CALL
              IF STAT = "00"
                 MOVE "WILL CONTINUE REVERSAL WITHOUT PD RECORD"
                                                          TO MESS
                 PERFORM SEND-MESS
              ELSE
                 MOVE "7" TO ROUTE-CD
                 GO TO REVERSAL-RTN-EXIT.
           MOVE "Y" TO PD1-EXISTS.

       REVERSAL-BYPASS-PD1.
      * FOUND THE PAYOFF RECORD, SAVE IT, AND GO GET REBATES
           MOVE "Y" TO REV-REBATE.
           MOVE LP-REC  TO WK-LP-REC.
      *    MOVE LX-REC  TO WK-LXE-REC WK-LXE.
           MOVE LX-REC  TO WK-LX-REC.
           MOVE LXE-REC TO WK-LXE-REC.
           MOVE LXG-REC TO WK-LXG-REC.
           GO TO REVERSAL-RTN-CONT.

       REVERSAL-REC-FOUND.
           IF LP-ALT-PREPAY-FG = "Y"
              MOVE "R" TO HOLD-ALT-PREPAY-FG
              MOVE "REVERSING A ALT PREPAYMENT, EVALUATE 'RI'" TO MESS
              PERFORM SEND-MESS.

           IF REV-REBATE = "Y"
      * THEY ARE ALL SAVED UP ABOVE WITH "Y" TO REV-REBATE, SO NOW RESTORE THEM
              MOVE WK-LP-REC  TO LP-REC
              MOVE WK-LXE-REC TO LXE-REC
              MOVE WK-LXG-REC TO LXG-REC
              MOVE WK-LX-REC  TO LX-REC
           ELSE
              MOVE LX-REC  TO WK-LX-REC
              MOVE LXE-REC TO WK-LXE-REC
              MOVE LXG-REC TO WK-LXG-REC.
           PERFORM CLOSE-LP1-FILE.

      * IF SP-CAL-RATETYPE(1) 'Z'
      *   GET THE LXZ FIELDS FOR THIS REVERSAL
      
           IF SP-CAL-RATETYPE(1) = "Z" AND LP-TRCD = "PY"
              PERFORM OPEN-LX1-FILE
              MOVE LP-BRNO   TO LX-BRNO
              MOVE LP-ACCTNO TO LX-ACCTNO
              MOVE LP-SEQNO  TO LX-SEQNO
              PERFORM READ-LX1-FILE
              PERFORM CLOSE-LX1-FILE
              IF IO-GOOD
                 COMPUTE HOLD-LXZ-POST-REGPY = -1 * LXZ-POST-REGPY
                 COMPUTE HOLD-LXZ-POST-EXTRA-PRIN =
                                          -1 * LXZ-POST-EXTRA-PRIN
                 COMPUTE HOLD-LXZ-POST-OTH = -1 * LXZ-POST-OTH
                 COMPUTE HOLD-LXZ-POST-LCHG = -1 * LXZ-POST-LCHG
                 COMPUTE HOLD-LXZ-PDUE-APINT = -1 * LXZ-PDUE-APINT
                 COMPUTE HOLD-LXZ-PDUE-APPRIN = -1 * LXZ-PDUE-APPRIN
                 COMPUTE HOLD-LXZ-CUR-APINT = -1 * LXZ-CUR-APINT
                 COMPUTE HOLD-LXZ-CUR-APPRIN = -1 * LXZ-CUR-APPRIN.

      *  IF LN-MIP-FG = "Y"
      *     GET THE LXM FIELDS FOR THIS REVERSAL
      
           IF LN-MIP-FG = "Y"
              IF LP-TRCD = "PY" OR "PA" OR "PE" OR "PR"
                        OR "PC" OR "PP" OR "SS" OR "IN"
                        OR "AH" OR "PX" OR "PN" OR "PZ"
                        OR "PO" OR "PB" OR "RN" OR "SC"
                        OR "RB" OR "RO"
                 PERFORM OPEN-LX1-FILE
                 MOVE LP-BRNO   TO LX-BRNO
                 MOVE LP-ACCTNO TO LX-ACCTNO
                 MOVE LP-SEQNO  TO LX-SEQNO
                 PERFORM READ-LX1-FILE
                 PERFORM CLOSE-LX1-FILE
                 IF IO-GOOD
                    COMPUTE HOLD-LXM-MIP-CLPAID =
                                        -1 * LXM-MIP-CLPAID
                    COMPUTE HOLD-LXM-MIP-AHPAID =
                                        -1 * LXM-MIP-AHPAID.

           IF LP-TRCD = "RS" 
              PERFORM OPEN-LX1-FILE
              MOVE LP-BRNO   TO LX-BRNO
              MOVE LP-ACCTNO TO LX-ACCTNO
              MOVE LP-SEQNO  TO LX-SEQNO
              PERFORM READ-LX1-FILE
              PERFORM CLOSE-LX1-FILE
              IF IO-GOOD
                 COMPUTE HOLD-LXR-REB-AMT = -1 * LXR-REB-AMT
              ELSE
                 MOVE 0 TO HOLD-LXR-REB-AMT
              END-IF.

      * GET THE GL FOR THIS REVERSAL
           PERFORM OPEN-LXG1-FILE.
           MOVE LP-BRNO   TO LXG-BRNO.
           MOVE LP-ACCTNO TO LXG-ACCTNO.
           MOVE LP-SEQNO  TO LXG-SEQNO.
           PERFORM READ-LXG1-FILE.
           PERFORM CLOSE-LXG1-FILE.
           IF IO-FG NOT = 0
              MOVE 0 TO LXG-GLNO(1)  LXG-GLNO(2)  LXG-GLNO(3)
                        LXG-GLAMT(1) LXG-GLAMT(2) LXG-GLAMT(3).

       REVERSAL-LP1-FILE.
           MOVE LP-TRCD  TO REV-TRCD.
           MOVE LP-REFNO TO REV-REFNO.

      * DONT ALLOW 'CHECK' REVERSAL IF REBATE WAS NOT A 'CHECK'
           IF REV-TRCD NOT = "OV"
              IF LP-REFNO NOT = "CHECK" AND HOLD-LP-REFNO = "CHECK"
                 MOVE "REBATE WAS NOT A 'CHECK'" TO MESS
                 PERFORM SEND-MESS
                 MOVE "7" TO ROUTE-CD
                 GO TO REVERSAL-RTN-EXIT.

      * DONT ALLOW 'PA' 'LBOX' REVERSAL IF NOT 'NSF'    MERCURY PR#234
      *    IF REV-TRCD = "PA"
      *       IF REV-REFNO = "LBOX"
      *          IF HOLD-LP-REFNO NOT = "NSF"
      *             MOVE "REVERSAL SHOULD BE A 'NSF'" TO MESS
      *             PERFORM SEND-MESS
      *             MOVE "7" TO ROUTE-CD
      *             GO TO REVERSAL-RTN-EXIT.

      * FORCE A REVERSAL OF A "CHECK" REBATE, TO HAVE "CHECK" IN REFNO
           IF REV-TRCD NOT = "OV"
              IF (LP-REFNO = "CHECK" AND HOLD-LP-REFNO NOT = "CHECK")
                OR
                 (LP-REFNO = "CHECK" AND HOLD-LP-REFNO = "CHECK")
                 MOVE "CHECK" TO HOLD-LP-REFNO VDUBUF
                 MOVE "S  A050030." TO VDU
                 PERFORM SCREENIO
              ELSE
      * FORCE A REVERSAL OF A MANUAL REBATE, TO HAVE THE TRCD IN REFNO
      * NONACR REPORT LOOKS FOR "RV" AND REFNO = "RI"
                 IF REBATE-POSTING AND LP-MANUAL-RB = "Y"
                    MOVE REV-TRCD TO HOLD-LP-REFNO VDUBUF
                    MOVE "S  A050030." TO VDU
                    PERFORM SCREENIO.
      * BOTH OF THESE ABOVE "IFS" CAN BE TRUE, BUT THE NONACR MUST SUFFER,
      * OTHERWISE GL WILL BE OUT OF BALANCE !!!!! (10-10-95)

      * STOP INTERBRANCH REVERSAL OF REBATES WITH REFCD "CHECK"
           IF PATH-MACHINE NOT = " "
              IF REV-TRCD NOT = "OV"
                 IF HOLD-LP-REFNO = "CHECK"
                    MOVE "INVALID FOR INTERBRANCH - CHECK" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT.

      * FORCE A REVERSAL OF A "CASH" PAYMENT, TO HAVE SAME REFNO
      * SO IT WILL PRINT ON CASH REGISTER, UNLESS THEY TYPE IN "NSF  "
           MOVE LN-OWNBR TO BR-NO.
           PERFORM OPEN-BR-FILE.
           PERFORM READ-BR-FILE.
           PERFORM CLOSE-BR-FILE.

      * TEST ONLY THE FIRST TWO CHARACTERS OF REFNO, BACAUSE LAST 3 ARE
      * WILDCARDS (INITIALS)
           MOVE LP-REFNO TO SAVE-LP-REFNO.
           PERFORM VARYING MSUB FROM 1 BY 1 UNTIL MSUB > 3
              MOVE BR-TENDER-CD(MSUB) TO HOLD-BR-TENDER-CD(MSUB)
           END-PERFORM.

      * ADDED THE FOLLOWING TEST ON NSF, 1/24/97, #130, DO NOT OVERWRITE
      * THE NSF REFERENCE CODE IF THE PREVIOUS CODE WAS A CASH PAYMENT
           IF HOLD-LP-REFNO NOT = "NSF  "
              IF SAVE-LP-REFER = HOLD-BR-TENDER-CD(1)
                              OR HOLD-BR-TENDER-CD(2)
                              OR HOLD-BR-TENDER-CD(3)
                 MOVE LP-REFNO TO HOLD-LP-REFNO VDUBUF
                 MOVE "S  A050030." TO VDU
                 PERFORM SCREENIO.

           PERFORM BYPASS-ALTER-LP-REFNO.

      *-------------------------------------------------------------
      * TEST ENVIRONMENT VARIABLE "RVPURCHASES" TO DETERMINE WHETHER
      * OR NOT TO TO ALLOW REVERSAL OF PURCHASES AND ADVANCES
      *-------------------------------------------------------------
           MOVE "RVPURCHASES" TO GETENV-BUF.
           PERFORM GETENV-CALL.
           IF STAT NOT = "00"
              MOVE "N" TO RV-PURCHASES-FG
           ELSE
              MOVE "Y" TO RV-PURCHASES-FG.

      *---------------------------------------------------------
      * TEST ALLOWING REVERSAL OF A PURCHASE OR ADVANCE
      *---------------------------------------------------------
           IF LP-TRCD = "PU" OR "AV"
              IF RV-PURCHASES-FG NOT = "Y"
                 MOVE
           "REVERSAL OF PURCHASES AND ADVANCES ARE NOT ALLOWED"
                                                        TO MESS
                 PERFORM SEND-MESS
                 MOVE "7" TO ROUTE-CD
                 GO TO REVERSAL-RTN-EXIT.
      *---------------------------------------------------------


           IF LP-REFNO = "NSF  "
              IF (REV-REFNO = "ALLOT")
                 MOVE " " TO MESS
                 STRING "NSF IS NOT ALLOWED WITH ALLOTMENT TRANSACTIONS"
                        DELIMITED BY SIZE INTO MESS
                 PERFORM SEND-MESS
                 MOVE "7" TO ROUTE-CD
                 GO TO REVERSAL-RTN-EXIT
              ELSE
              IF NOT ( (REV-TRCD = "PY" OR "PO" OR "PE" OR "SS" OR "IN"
                                        OR "Z2" OR "AH" OR "OV")
                       OR
                       (DF-POSTING)
                       OR
                       (REV-TRCD = "PA" AND REV-REFNO = "LBOX")
                     )
                 MOVE " " TO MESS
                 STRING "NSF IS VALID ONLY WITH PO, "
                        "PY, PE, AH, SS, Z2, DF'S OR PA+LBOX"
                        DELIMITED BY SIZE INTO MESS
                 PERFORM SEND-MESS
                 MOVE "7" TO ROUTE-CD
                 GO TO REVERSAL-RTN-EXIT.
      *    "RCRARORIRSRMRDRECCCACOCE"
           IF LP-REFNO = "CHECK"
              MOVE CDV-02 TO CDV-BUF
              PERFORM CDV-VERIFY
              IF CDV-NO-MATCH AND
                 (LP-TRCD = "CI" OR "CS" OR "CM")
                 MOVE "CAN NOT REVERSE CI CS OR CM" TO MESS
                 PERFORM SEND-MESS
                 MOVE "7" TO ROUTE-CD
                 GO TO REVERSAL-RTN-EXIT
              ELSE
              IF CDV-NO-MATCH
                 MOVE "REFNO 'CHECK' INVALID WITH TRANS CD" TO MESS
                 PERFORM SEND-MESS
                 MOVE "7" TO ROUTE-CD
                 GO TO REVERSAL-RTN-EXIT.

           IF DF-POSTING OR AD-POSTING
              IF REV-TRCD = "DF" OR "AD"
                 MOVE -1 TO DEF-NODEF DEF-NODEFACT
              ELSE
                 MOVE -1 TO DEF-NODEFACT
                 MULTIPLY -1 BY TRCD-NODF GIVING DEF-NODEF.
           IF DF-POSTING
              ADD DEF-NODEF TO LN-TOTNODEF
              ADD DEF-NODEFACT TO LN-TOTNODEFACT
              IF SP-DEFFRMLA = 8
                 MOVE 0 TO LCAP-LCPDTH-DATE-DATE LP-LCPDTH-DATE
              ELSE
                 MOVE DEF-NODEF TO NDTE-HOLD
                 PERFORM INCR-LCPDTH
           ELSE
              IF AD-POSTING
                 ADD DEF-NODEF TO LN-TOTNOALDEL
                 MOVE LN-TOTNOALDEL TO HOLD-NEW-1ST-DUE.

           IF (REV-TRCD = "AP") 
              MOVE 0 TO LP-APOTH LP-APINT LP-APLC LP-APCUR.

           IF REV-TRCD = "O2" OR "W2"
              MOVE 0 TO LP-APOT2 LP-APINT LP-APLC LP-APCUR.

           IF REV-TRCD = "Z2"
              COMPUTE LP-APOT2 = LP-APOT2 * (-1).

           IF SP-CAL-RATETYPE(1) NOT = "Z"
              ADD LN-INTBAL LP-APINT GIVING LP-INTBAL.
           ADD LN-OTHBAL LP-APOTH GIVING LP-OTHBAL.
           ADD LN-LCBAL LP-APLC GIVING LP-LCBAL.

           IF REV-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
              ADD LN-OT2BAL LP-APOT2 GIVING LP-OT2BAL
              COMPUTE LP-APOT2 = LP-APOT2 * (-1).

           IF ADDON-POSTING
              MOVE LN-INTBAL TO LP-INTBAL.
           IF DF-POSTING
              MOVE LN-LCBAL TO LP-LCBAL.

           MOVE LN-CURBAL TO LP-CURBAL.

           IF REV-TRCD = "TP"
              MOVE LN-DLRVPRIN(1) TO HOLD-LN-DLRVPRIN(1)
              MOVE LN-DLRVPRIN(2) TO HOLD-LN-DLRVPRIN(2)
              MOVE LN-DLRVPRIN(3) TO HOLD-LN-DLRVPRIN(3)
              MOVE LN-DLDISC      TO HOLD-LN-ANTIC-DISC
              MOVE LN-ANTICERN(1) TO HOLD-LN-ANTIC-INT
              MOVE LN-ANTICERN(3) TO HOLD-LN-ANTIC-SC
              MOVE LN-ANTICERN(4) TO HOLD-LN-ANTIC-MF
              MOVE LN-PROCEEDS TO HOLD-LN-PROCEEDS
              MOVE LN-DLPARTRCAMT TO HOLD-LN-PARTRCAMT
              MOVE LN-DLRECOURSE TO HOLD-LN-RECOURSE.

      *  JTG 010914 'RE' ON 'IB' WILL ACT LIKE 'OT' TRANSACTION   REGACC PR#1575
           IF (REV-TRCD = "OT") OR
              (REV-TRCD = "RE" AND LN-LOANTYPE = "I")
              SUBTRACT LP-INTDUE FROM LP-OTHBAL.

           IF REV-TRCD = "WO"
              ADD LP-INTDUE TO LP-OTHBAL.
           IF REV-TRCD = "AP"
              ADD LP-APINTOWE TO LP-OTHBAL
              ADD LP-INTDUE   TO LP-INTBAL
              ADD LP-LCPARTIALS  TO LP-LCBAL
              COMPUTE LP-CURBAL = LP-CURBAL
                                - LP-APINTOWE
                                - LP-INTDUE
                                - LP-LCPARTIALS.

           IF REV-TRCD = "O2"
              SUBTRACT LP-APINTOWE FROM LP-OT2BAL
              COMPUTE LP-CURBAL =
                 LP-CURBAL - LP-APINTOWE.

           IF REV-TRCD = "W2"
              ADD LP-APINTOWE TO LP-OT2BAL
              COMPUTE LP-CURBAL =
                 LP-CURBAL + LP-APINTOWE.

           IF REV-TRCD = "Z2"
              ADD LP-APCUR TO LP-OT2BAL.

      *    "OTWOAPJDPLPIPWRPTSTPSPBKBD" (NOT).
           MOVE CDV-17 TO CDV-BUF.
           PERFORM CDV-VERIFY.
           IF CDV-NO-MATCH AND
              (LP-TRCD = "CI" OR "CS" OR "CM")
              MOVE "CAN NOT REVERSE CI CS OR CM" TO MESS
              PERFORM SEND-MESS
              MOVE "7" TO ROUTE-CD
              GO TO REVERSAL-RTN-EXIT.

      * THE "DF" HAS THE AMOUNT IN INTDUE SO INTBAL COMES OUT RIGHT:
           IF (
                CDV-NO-MATCH
                     OR (REV-TRCD = "Z2")
              )
                IF ( REV-TRCD NOT = "WL" ) AND
                   ( SP-CAL-RATETYPE(1) NOT = "Z" ) AND
                   ( NOT (REV-TRCD = "RE" AND LN-LOANTYPE = "I") )
                   SUBTRACT LP-INTDUE FROM LP-INTBAL.

      * ADDON-POSTING, LP-APINTOWE HOLDS LN-INTPDTH-DATE BEFORE ADDON:
           IF (
                CDV-NO-MATCH
                     OR (REV-TRCD = "Z2")
              )
              IF NOT ADDON-POSTING
                 SUBTRACT LP-APINTOWE FROM LP-LCBAL.

           MULTIPLY -1 BY
              LP-TRAMT LP-APOTH LP-APINT LP-APLC LP-APCUR
              LP-INTDUE LP-DLPROC LP-EARNED(1) LP-EARNED(2)
              LP-EARNED(3) LXG-GLAMT(1) LXG-GLAMT(2) LXG-GLAMT(3)
              LP-INTPAID LXE-EARN(1) LXE-EARN(2) LXE-EARN(3)
              LXE-WORKER LXE-WORKER2 LP-NOLCHG LP-PREPAY-PENALTY
              LP-PRORATED-INS-REB LP-EXTRA-PRIN-LFP LP-APPLIED-TO-ESCROW.


      * ADDON-POSTING, LP-APINTOWE HOLDS LN-INTPDTH-DATE BEFORE ADDON
           IF REV-TRCD NOT = "SP" AND NOT = "DC" AND
                        NOT ADDON-POSTING
              MULTIPLY -1 BY LP-APINTOWE.
      * LP-LCPARTIALS HOLDS APLC FROM AN AL, AP, NOT GETTING NEGATIVE ON A
      * REVERSAL (2/22/96)
           IF (REV-TRCD = "AP")
              MULTIPLY -1 BY LP-LCPARTIALS.
      * "MS" PRE PAYMENT PENALTY
           IF REV-TRCD = "RI"
              IF SP-RBREDUC(7) = 9999.01
                 MULTIPLY -1 BY LP-LCPAID.

      * SETUP ADDON REBATE AMOUNT:
           IF REV-TRCD = "RI"
              IF LN-ADDON-FG = "Y"
                 ADD LN-ANTICADJ(1) LP-TRAMT GIVING ADDON-INT-REBATE.
           IF REB-AMOUNT(1) NOT = 0
              IF LN-ADDON-FG = "Y"
                 ADD LN-ANTICADJ(1) REB-AMOUNT(1)
                                         GIVING ADDON-INT-REBATE.


      * FOR PC ACCOUNTS, 'RI' MAY HAVE A VALUE:
           MOVE SPACES TO HOLD-DL-RVCHGS-CODE(1)
                          HOLD-DL-RVCHGS-CODE(2)
                          HOLD-DL-RVCHGS-CODE(3)
                          HOLD-DL-PARVHELD-CODE
                          HOLD-DL-PARVPAID-CODE.
           IF NOT ADDON-POSTING
              IF LP-IBPC = "P"
                 MULTIPLY -1 BY LP-DLRVCHGS-ADJ(1)
                 MULTIPLY -1 BY LP-DLRVCHGS-ADJ(2)
                 MULTIPLY -1 BY LP-DLRVCHGS-ADJ(3)
                 MULTIPLY -1 BY LP-DLPARVHELD-ADJ
                 MULTIPLY -1 BY LP-DLPARVPAID-ADJ
                 MOVE LN-DLNO TO DL-DLNO
                 PERFORM GET-DL
                 IF IO-FG NOT = 0
                    MOVE "DEALER IS NOT ON FILE!!" TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    GO TO REVERSAL-RTN-EXIT
                 ELSE
                    MOVE DL-RVCHGS-CODE(1) TO HOLD-DL-RVCHGS-CODE(1)
                    MOVE DL-RVCHGS-CODE(2) TO HOLD-DL-RVCHGS-CODE(2)
                    MOVE DL-RVCHGS-CODE(3) TO HOLD-DL-RVCHGS-CODE(3)
                    MOVE DL-PARVHELD-CODE TO HOLD-DL-PARVHELD-CODE
                    MOVE DL-PARVPAID-CODE TO HOLD-DL-PARVPAID-CODE.

      * FOR IB ACCOUNTS, 'PO' OR 'SC' MAY HAVE A VALUE:
           IF REV-TRCD = "PO" OR "SC"
              IF LP-IBPC = "I"
                 MULTIPLY -1 BY LP-DLRVCHGS-ADJ(1)
                 MULTIPLY -1 BY LP-DLRVCHGS-ADJ(2)
                 MULTIPLY -1 BY LP-DLRVCHGS-ADJ(3)
                 MULTIPLY -1 BY LP-DLPARVHELD-ADJ
                 MULTIPLY -1 BY LP-DLPARVPAID-ADJ.

           IF LN-SERVACCT NOT = "Y"
              PERFORM CALC-HOLD-LN-ACCERN.
           COMPUTE HOLD-LN-TOTERN =
                LN-TOTERN
                    + LP-EARNED(1) + LP-EARNED(2) + LP-EARNED(3)
                    + LXE-EARN(1)  + LXE-EARN(2)  + LXE-EARN(3).
      *             + WK-LXE-EARN(1) + WK-LXE-EARN(2) + WK-LXE-EARN(3).

           IF SP-ERNFRMLA(1) = 15
              PERFORM SETUP-EARNINGS-IB-15
           ELSE
              IF SP-ERNFRMLA(5) = 16
                 PERFORM SETUP-EARNINGS-IB-16.


           IF LN-SERVACCT NOT = "Y"
              IF NOT ADDON-POSTING
                  IF REV-TRCD NOT = "WI" AND NOT = "WL"
                     IF REV-TRCD NOT = "RD"
                        ADD LP-APINT LP-APLC TO HOLD-LN-TOTERN
                     ELSE
                        SUBTRACT LP-TRAMT FROM HOLD-LN-TOTERN.

           MOVE LN-TOTDEF TO HOLD-LN-TOTDFMNTS.
           IF DF-POSTING
              IF SP-DEFFRMLA = 97 OR 96 OR 95
                 COMPUTE HOLD-LN-TOTINT = LN-TOTINT + LP-APINT
              ELSE
                 COMPUTE HOLD-LN-TOTDFMNTS = LN-TOTDEF + LP-APINT
              END-IF
           ELSE
              IF REV-TRCD = "RD"
                 COMPUTE HOLD-LN-TOTDFMNTS = LN-TOTDEF - LP-TRAMT
              ELSE
                 IF REB-AMOUNT(7) NOT = 0
                   COMPUTE HOLD-LN-TOTDFMNTS = LN-TOTDEF - REB-AMOUNT(7)
                   SUBTRACT REB-AMOUNT(7) FROM HOLD-LN-TOTERN.

           IF NOT (DF-POSTING AND (SP-DEFFRMLA = 97 OR 96 OR 95))
              MOVE LN-TOTINT TO HOLD-LN-TOTINT.
           MOVE LN-TOTLCHG TO HOLD-LN-TOTLCHG.
           MOVE LN-TOTSERACCT TO HOLD-LN-TOTSERACCT.

      * PACESETTER DEFFRMLA 8 CAN HAVE LATE CHARGES
           IF REV-TRCD NOT = "WL"
              IF REVERSE-AFTER-RESCHED-FG = "N"
                 COMPUTE HOLD-LN-TOTLCHG = LN-TOTLCHG + LP-APLC.

           IF REV-TRCD NOT = "WI" AND
                        NOT DF-POSTING AND
                         NOT ADDON-POSTING
              COMPUTE HOLD-LN-TOTINT = LN-TOTINT + LP-APINT.

           IF ( SP-LCFRMLA = "F" OR "H" OR "I" OR "J"
                                 OR "K" OR "L" OR "M" OR "P"
                                 OR "S" OR "T" )
              IF REV-TRCD = "PY" OR "PA" OR "AL" OR "PE" OR "SS"
                         OR "PO" OR "PB" OR "SC" OR "RN" OR "IN"
                                 OR "RB" OR "RO" OR "PR" OR "PC"
                                 OR "PP" OR "AH" OR "PN" OR "PZ"
                 MOVE LP-LCPARTIALS TO HOLD-PARTIALS
                 MOVE LP-LCPAID TO HOLD-LCPAID.

           IF LN-SERVACCT NOT = "Y"
              GO TO BYPASS-SERVICE.

           ADD LP-EARNED(1) TO HOLD-LN-TOTSERACCT.

      * EARNED INTEREST
           ADD LP-EARNED(2) TO HOLD-LN-TOTSERACCT.
      * EARNED LCHG
           ADD LP-EARNED(3) TO HOLD-LN-TOTSERACCT.

       BYPASS-SERVICE.
           IF RVENTX-TRCD NOT = " "
              MOVE RVENTX-TRCD TO REV-TRCD.
           MOVE "RV" TO LP-TRCD.

      * LET REVERSAL 'RV' RECORD HAVE THE LP-PAYDATE OF THE
      * RECORD BEING REVERSED:
           MOVE TRANS-DATE TO LP-TRDATE LP-PAYDATE.
      *    MOVE TRANS-DATE TO LP-TRDATE.

           IF CONV-REV-FLAG="Y"
              MOVE LN-TOTLCHG TO HOLD-LN-TOTLCHG
              MOVE LN-TOTSERACCT TO HOLD-LN-TOTSERACCT
              MOVE LN-TOTINT TO HOLD-LN-TOTINT
              MOVE LP-APINT TO LP-INTDUE
              MOVE LP-APLC TO LP-APINTOWE

              MOVE RVENTX-PRIOR-PAYDATE TO LP-PAYDATE
                                           CONV-DATE-PAID-LAST
              MOVE RVENTX-PRIOR-PAYAMT  TO CONV-AMT-PAID-LAST
              MOVE RVENTX-LCPDTH-DATE   TO CONV-LCPDTH-DATE
                                           LCAP-LCPDTH-DATE-DATE

              MOVE LN-TOTDEF TO HOLD-LN-TOTDFMNTS
              ADD LP-APINT TO HOLD-LN-TOTERN
              ADD LP-APLC TO HOLD-LN-TOTERN
              IF DF-POSTING
                 IF SP-DEFFRMLA = 97 OR 96 OR 95
                    COMPUTE HOLD-LN-TOTINT = LN-TOTINT + LP-APINT
                 ELSE
                    COMPUTE HOLD-LN-TOTDFMNTS = LN-TOTDEF + LP-APINT
                 END-IF
                 IF REV-TRCD = "DF" OR "AD"
                    MOVE -1 TO DEF-NODEF DEF-NODEFACT
                    ADD DEF-NODEF TO LN-TOTNODEF
                    ADD DEF-NODEFACT TO LN-TOTNODEFACT
                 ELSE
                    MULTIPLY -1 BY TRCD-NODF GIVING DEF-NODEF
                    MOVE -1 TO DEF-NODEFACT
                    ADD DEF-NODEF TO LN-TOTNODEF
                    ADD DEF-NODEFACT TO LN-TOTNODEFACT
              ELSE
                 COMPUTE HOLD-LN-TOTLCHG = LN-TOTLCHG + LP-APLC
                 COMPUTE HOLD-LN-TOTINT = LN-TOTINT + LP-APINT.


       REVERSAL-RTN-EXIT.
           EXIT.

      ********************************
       DISPLAY-ENTRY-LINE SECTION.
      ********************************
           IF CONV-REV-FLAG NOT = "Y"
              IF NOT ADDON-POSTING
                 SUBTRACT LP-APCUR FROM LP-CURBAL
              ELSE
                 IF LP-IBPC = "I"
                    ADD LP-APCUR TO LP-CURBAL
                 ELSE
                    ADD LP-TRAMT TO LP-CURBAL.

      * UPDATE CONTRACTUAL PAYMENTS TO DATE:
           IF REV-TRCD = "PY" OR "PO" OR "PA" OR "AH" OR "PN"
                              OR "PR" OR "PC" OR "PP" OR "PZ"
                              OR DF-POSTING
              IF NOT ( DF-POSTING AND (SP-DEFFRMLA = 97 OR 96 OR 95))
                 ADD LP-APCUR TO LN-TOTPAYMNTD
                 IF LN-ESCROW-FG = "Y"
                    ADD LP-APPLIED-TO-ESCROW TO LN-TOTPAYMNTD
                 END-IF
              END-IF
              IF SP-CAL-RATETYPE(1) = "Z"
                 SUBTRACT LP-EXTRA-PRIN-LFP FROM LN-TOTPAYMNTD
                 ADD LP-EXTRA-PRIN-LFP TO LN-TOTEXCPAYMNTD
              END-IF
              IF SP-CONTRFRMLA = "A"
                 ADD LP-APLC TO LN-TOTPAYMNTD.

           IF REV-TRCD = "PY" OR "PO" OR "PA" OR "AH" OR "PN"
                              OR "PR" OR "PC" OR "PP" OR "PZ"
              ADD LP-APINT TO LN-TOTPAYMNTD.

      * UPDATE NON CONTRACTUAL PAYMENTS TODATE:
           IF REV-TRCD = "PE" OR "SS" OR "IN"
              ADD LP-TRAMT TO LN-TOTEXCPAYMNTD.

      * COMPUTE PAID THRU DATE
           IF REV-TRCD = "DC"
              MOVE HOLD-NEW-1ST-DUE TO PDTH-DATE-WORK
           ELSE
              MOVE LN-1STPYDATE TO PDTH-DATE-WORK.
           IF CONV-REV-FLAG NOT = "Y"
              PERFORM PAID-THRU-CALCULATION
              MOVE PDTH-DATE-FULL TO LP-PDTH-DATE.

      * COMPUTE INTEREST PAID BY BORROWER
           ADD LP-INTPAID TO LN-YTDINTPD.

       DISPLAY-BYPASS-PROCEEDS.
      * TEST FOR CALCULATION OF AFPDLLP AMOUNT: (RAC)
           IF ( (LN-PLCD NOT = " ")
                     AND (REV-TRCD = "PL" OR "P2" OR "P3"
                                           OR "P4" OR "P5")
              ) OR
                  ( (LN-PLCD = " ")
                     AND (REV-TRCD = "PY" OR "PO" OR "PA" OR "PN"
                                  OR "PE" OR "SS" OR "PZ" OR "IN")
                  )
              MOVE LN-DLNO TO DL-DLNO
              PERFORM GET-DL
              IF IO-FG = 0 AND DL-AFP-DEALER = "Y"
                 MOVE LP-TRDATE TO AFPDLLP-TODAY
                 MOVE LP-REVTRCD TO HOLD-LP-REVTRCD
                 MOVE REV-TRCD TO LP-REVTRCD
                 IF REV-TRCD = "PO"
                    MOVE LP-CURBAL TO HOLD-LP-CURBAL
                    PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 13
                        SUBTRACT REB-AMOUNT(SUB) FROM LP-CURBAL
                    END-PERFORM
                    PERFORM AFPDLLP
                    MOVE HOLD-LP-CURBAL TO LP-CURBAL
                    MOVE HOLD-LP-REVTRCD TO LP-REVTRCD
                    MOVE AFPDLLP-DUE-DEALER TO HOLD-AFPDLLP
                 ELSE
                 IF REV-TRCD = "PL" OR "P2" OR "P3" OR "P4" OR "P5"
                    MOVE LN-PLCD TO HOLD-LN-PLCD
                    MOVE " " TO LN-PLCD
                    PERFORM AFPDLLP
                    MOVE HOLD-LN-PLCD TO LN-PLCD
                 ELSE
                    PERFORM AFPDLLP
                 END-IF
                 MOVE HOLD-LP-REVTRCD TO LP-REVTRCD
                 MOVE AFPDLLP-DUE-DEALER TO HOLD-AFPDLLP.

           PERFORM DISPLAY-EARNINGS.
           MOVE "N" TO SEND-PAYOFF-FG.

           IF REV-REBATE NOT = "Y"
              IF CONV-REV-FLAG NOT = "Y"
                 IF NOT ADDON-POSTING
      * EX. REVERSED 'PY TPAY' AND TYPED 'NSF'
      *   LP-REFNO      = TPAY
      *   HOLD-LP-REFNO = NSF
                    MOVE LP-REFNO      TO HOLD-REV-LP-REFNO
                    MOVE HOLD-LP-REFNO TO LP-REFNO
                    PERFORM SETUP-LINE
                    PERFORM SEND-ENTRY-LINE
                    GO TO DISPLAY-ENTRY-LN-EXIT
                 ELSE
                    PERFORM SETUP-LINE
                    PERFORM SEND-ENTRY-LINE
                    GO TO DISPLAY-ENTRY-LN-EXIT
              ELSE
                 MOVE LP-REFNO TO XXX-REFNO
                 MOVE HOLD-LP-REFNO TO LP-REFNO
                 PERFORM SETUP-LINE
                 PERFORM SEND-ENTRY-LINE
                 MOVE XXX-REFNO TO LP-REFNO
                 GO TO DISPLAY-ENTRY-LN-EXIT.

           PERFORM SEND-PAYOFF-LINES.
           MOVE "Y" TO SEND-PAYOFF-FG.
       DISPLAY-ENTRY-LN-EXIT.
           EXIT.

      **************************************
       ACCEPT-ENTRY-ROUTINE SECTION.
      **************************************
       ACCEPT-ENTRY-RTN.
           MOVE "F1-CANCEL, DRAWER ENTRY   :" TO MESS.

      * 3/21/03 (WORLD) HEY, WE REALLY NEED TO TEST THE PASSWORD
      * DRAWER FLAG OF THE POSTING BRANCH IF DOING INTERBRANCH,
      * SO READ POSTING BRANCH THEN RESTORE OWNING BRANCH:

           IF PATH-MACHINE NOT = " "
              MOVE BRANCH TO BR-NO
              PERFORM OPEN-BR-FILE
              PERFORM READ-BR-FILE
              MOVE BR-PASSWORD-DRAWER TO SV-PASSWORD-DRAWER
              MOVE LN-OWNBR TO BR-NO
              PERFORM READ-BR-FILE
              PERFORM CLOSE-BR-FILE
           ELSE
              MOVE BR-PASSWORD-DRAWER TO SV-PASSWORD-DRAWER.

           IF SV-PASSWORD-DRAWER = "Y"
              INSPECT MESS REPLACING FIRST "ENTRY   :" BY "PASSWORD:"
           ELSE
              INSPECT MESS REPLACING FIRST "ENTRY   :" BY "NUMBER  :".
           PERFORM SEND-LEGEND.

           MOVE 0 TO CA-TILLNO.

       ACCEPT-ENTER-TILLNO.
           MOVE LP-TRDATE TO CA-DATE.
           MOVE BRANCH    TO CA-BRNO.
           MOVE 0         TO CA-TILLNO.
           MOVE CA1-KEY TO HOLD-CA1-KEY.
           IF SV-PASSWORD-DRAWER = "Y"
              IF PATH-MACHINE NOT = " "
                 MOVE EXT-FILPATH-BASE TO CA-ALL-BASE
                 MOVE PATH-MACHINE TO CA-ALL-MACHINE
                 MOVE PATH-DATA TO CA-ALL-DATA
                 MOVE CA-ALL-PATH TO CA-PATH
                 MOVE "Y" TO CA-PATH-OVERRIDE
              END-IF
              PERFORM ENTER-CASH-DRAWER-PASSWORD
              IF CAPASSWD-OKAY = "N"
                 GO TO ACCEPT-ENTER-TILLNO
              END-IF
              IF CAPASSWD-OKAY = "V"
                 GO TO ACCEPT-CHECK-VDUSTATUS
              END-IF
              IF CAPASSWD-OKAY = "Y"
      *          MOVE "S  A010120." TO VDU
      *          MOVE CA-TILLNO TO NUMERIC-TILLNO
      *          PERFORM CONVERT-TILLNO-TO-ALPHA
      *          MOVE TEST-ALPHA-TILLNO TO VDUBUF
      * ADDED NEW FIELD "DRAWER" FOR 2 DIGIT DRAWER ENTRY
                 MOVE "SN N020DRAWER." TO VDU
                 MOVE CA-TILLNO TO VDUNUM0
                 PERFORM SCREENIO
              END-IF
           ELSE
      * ADDED NEW FIELD "DRAWER" SO WE CAN ENTER A 2 DIGIT DRAWER
              MOVE "EN N020DRAWER." TO VDU
              PERFORM SCREENIO.
       ACCEPT-CHECK-VDUSTATUS.

           IF VDUSTATUS = "10"
              PERFORM ACCEPT-SCREEN-RESET
              PERFORM DISPLAY-ENTRY-UP
              GO TO ACCEPT-ENTRY-EXIT.

           IF LP-CURBAL = 0
              IF LP-INTBAL NOT = 0 OR
                 LP-OTHBAL NOT = 0 OR
                 LP-LCBAL  NOT = 0
                 PERFORM MUST-BE-ALL-ZERO
                 GO TO ACCEPT-ENTRY-RTN.

           IF VDUSTATUS = "18"
              GO TO ACCEPT-ENTRY-RTN.

           IF VDUSTATUS NOT = "00"
              GO TO ACCEPT-ENTRY-RTN.

      *    MOVE VDUBUF TO TEST-ALPHA-TILLNO.
      *    PERFORM CONVERT-TILLNO-TO-NUMERIC.
      *    MOVE NUMERIC-TILLNO TO CA-TILLNO LP-TILLNO.
           MOVE VDUNUM0 TO CA-TILLNO LP-TILLNO.

       ACCEPT-ENTRY-CONT.
           IF PATH-MACHINE NOT = " "
              MOVE EXT-FILPATH-BASE TO CA-ALL-BASE
              MOVE PATH-MACHINE TO CA-ALL-MACHINE
              MOVE PATH-DATA TO CA-ALL-DATA
              MOVE CA-ALL-PATH TO CA-PATH
              MOVE "Y" TO CA-PATH-OVERRIDE.

           PERFORM OPEN-CA1-FILE.
           MOVE LP-TRDATE TO CA-DATE.
           MOVE BRANCH    TO CA-BRNO.
           PERFORM READ-CA1-FILE.
           PERFORM CLOSE-CA1-FILE.
           IF IO-FG NOT = 0
              MOVE "INVALID CASH DRAWER #" TO MESS
              PERFORM SEND-MESS
              GO TO ACCEPT-ENTRY-RTN.
           IF CA-CLOSED-HHMM NOT = 0
              MOVE "CASH DRAWER CLOSED" TO MESS
              PERFORM SEND-MESS
              GO TO ACCEPT-ENTRY-RTN.

           GO TO ACCEPT-ENTRY-EXIT.
       ACCEPT-SCREEN-RESET.
           MOVE "Y"       TO FULL-PAGE-FG.
           MOVE LN-OWNBR  TO LP-BRNO.
           MOVE LN-ACCTNO TO LP-ACCTNO.
           MOVE 99999     TO LP-SEQNO.
           MOVE LP1-KEY   TO HOLD2-KEY-UP.
           MOVE "7" TO ROUTE-CD.
       ACCEPT-ENTRY-EXIT.
           IF ROUTE-CD NOT = " "
              PERFORM CLEAR-LEGEND.

      **************************************************
       DISPLAY-ENTRY-DOWN SECTION.
      **************************************************
           MOVE SPACES TO LINE-BUF LN-BUF.
           MOVE 0 TO LN-WK.
           MOVE HOLD1-KEY-DOWN TO LP1-KEY.
           IF LP-SEQNO = 99999
              MOVE 9 TO IO-FG
              GO TO DISPLAY-DOWN-EXIT.

      * ***NOTE*** 'START-LP1-FILE-SCAN' MUST BE USED WHEN FIRST USING
      * 'START-LP1-FILE-NOT-GREATER'; USED WHEN DISPLAYING MULTIPLE
      * PAGES IN AN UP & DOWN FUNCTION; YOU NEED TO ADD ONE TO 
      * LP-SEQNO (IN WBEG) IN ORDER TO GET THE DISPLAY TO WORK
      * LIKE VISION FILES.
      
           MOVE LP1-KEY TO HOLD2-KEY-UP.
           PERFORM OPEN-LP1-FILE.
           PERFORM READ-LP1-FILE.

           IF IO-FG NOT = 0
              MOVE LP-PATH-OWNBR TO QLP1-WBEG-BRNO
                                    QLP1-WEND-BRNO
              MOVE LP-ACCTNO     TO QLP1-WBEG-ACCTNO
                                    QLP1-WEND-ACCTNO
              COMPUTE QLP1-WBEG-SEQNO = LP-SEQNO + 1
              MOVE ALL "9"       TO QLP1-WEND-SEQNO
      *-   -   -{ ADD ONE TO WHERE SCAN BEG FIELDS }
              IF ( LP-BRNO = 9999 )
                 MOVE LP-BRNO    TO QLP1-WSBEG-BRNO
              ELSE
                 COMPUTE QLP1-WSBEG-BRNO = LP-BRNO + 1
              END-IF
   
              IF ( LP-ACCTNO = 99999999 )
                 MOVE LP-ACCTNO  TO QLP1-WSBEG-ACCTNO
              ELSE
                 COMPUTE QLP1-WSBEG-ACCTNO = LP-ACCTNO + 1
              END-IF
  
              PERFORM START-LP1-FILE-SCAN.

           MOVE 0 TO ENTRY-FLAG.
       DISPLAY-NEXT-DOWN.
           IF ENTRY-FLAG = 2
              MOVE 9 TO IO-FG
              GO TO DISPLAY-BYPASS-DOWN.
           PERFORM READ-LP1-FILE-NEXT.
           IF IO-FG = 0
              IF (LP-ACCTNO NOT = LN-ACCTNO) OR 
                  (LP-BRNO NOT = LP-PATH-OWNBR)
                 ADD 1 TO ENTRY-FLAG
                 GO TO DISPLAY-NEXT-DOWN.
       DISPLAY-BYPASS-DOWN.
           ADD 1 TO LN-WK.
           IF IO-FG = 0
              PERFORM SETUP-LINE.
           MOVE LN-BUF TO D-LINE(LN-WK).
           MOVE SPACE TO LN-BUF.
           IF LN-WK = 8
              GO TO DISPLAY-XFER-DOWN.
           IF IO-FG = 0
              GO TO DISPLAY-NEXT-DOWN.
           IF FULL-PAGE-FG = "Y"
              MOVE "N"       TO FULL-PAGE-FG
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 99999     TO LP-SEQNO
              MOVE LP1-KEY   TO HOLD2-KEY-UP
              PERFORM DISPLAY-ENTRY-UP
              GO TO DISPLAY-DOWN-EXIT.
       DISPLAY-XFER-DOWN.
           PERFORM DISPLAY-ALL-LINES.
       DISPLAY-DOWN-EXIT.
           IF IO-FG = 0
              MOVE "Y" TO FULL-PAGE-FG
              MOVE LP1-KEY TO HOLD1-KEY-DOWN
           ELSE
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 99999     TO LP-SEQNO
              MOVE LP1-KEY   TO HOLD1-KEY-DOWN.
           PERFORM CLOSE-LP1-FILE.

      **************************************************
       DISPLAY-ENTRY-UP SECTION.
      **************************************************
           MOVE SPACES TO LINE-BUF LN-BUF.
           MOVE 9 TO LN-WK.
           MOVE HOLD2-KEY-UP TO LP1-KEY.
           IF LP-SEQNO = 0
              MOVE 9 TO IO-FG
              GO TO DISPLAY-UP-EXIT.

           MOVE LP1-KEY TO HOLD1-KEY-DOWN.
           PERFORM OPEN-LP1-FILE.

           MOVE LP-BRNO       TO QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO.
           MOVE LP-ACCTNO     TO QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           MOVE ALL "0"       TO QLP1-WBEG-SEQNO.
           MOVE LP-SEQNO      TO QLP1-WEND-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.

           MOVE 0 TO ENTRY-FLAG.
       DISPLAY-NEXT-UP.
           IF ENTRY-FLAG = 2
              MOVE 9 TO IO-FG
              GO TO DISPLAY-BYPASS-UP.
           PERFORM READ-LP1-FILE-PREVIOUS.
           IF IO-FG = 0
              IF LP-ACCTNO NOT = LN-ACCTNO OR
                  (LP-BRNO NOT = LP-PATH-OWNBR)
                 ADD 1 TO ENTRY-FLAG
                 GO TO DISPLAY-NEXT-UP.
       DISPLAY-BYPASS-UP.
           SUBTRACT 1 FROM LN-WK.
           IF LN-WK < 1
              MOVE "Y" TO FULL-PAGE-FG
              GO TO DISPLAY-XFER-UP.
           IF IO-FG = 0
              PERFORM SETUP-LINE.
           MOVE LN-BUF TO D-LINE(LN-WK).
           MOVE SPACE TO LN-BUF.
           IF IO-FG = 0
              GO TO DISPLAY-NEXT-UP.
           IF FULL-PAGE-FG = "Y"
              MOVE "N" TO FULL-PAGE-FG
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 0         TO LP-SEQNO
              MOVE LP1-KEY TO HOLD1-KEY-DOWN
              PERFORM DISPLAY-ENTRY-DOWN
              GO TO DISPLAY-UP-EXIT.
       DISPLAY-XFER-UP.
           PERFORM DISPLAY-ALL-LINES.
       DISPLAY-UP-EXIT.
           IF IO-FG = 0
              MOVE "Y" TO FULL-PAGE-FG
              MOVE LP1-KEY TO HOLD2-KEY-UP
           ELSE
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 0         TO LP-SEQNO
              MOVE LP1-KEY   TO HOLD2-KEY-UP.
           PERFORM CLOSE-LP1-FILE.

      *********************************
       SEND-PAYOFF-LINES SECTION.
      *********************************
           MOVE LP-REC TO WK-LP-REC.
           MOVE LN-CURBAL TO LP-CURBAL.
           MOVE 0 TO SUB SUB1.
           MOVE SPACES TO LINE-BUF.
       SEND-PAYOFF-LINES-CONT.
           ADD 1 TO SUB.
           IF SUB > 13
              MOVE WK-LP-REC TO LP-REC
              COMPUTE LP-CURBAL = LP-CURBAL
                       - REB-AMOUNT(1)  - REB-AMOUNT(2)
                       - REB-AMOUNT(3)  - REB-AMOUNT(4)
                       - REB-AMOUNT(5)  - REB-AMOUNT(6)
                       - REB-AMOUNT(7)  - REB-AMOUNT(8)
                       - REB-AMOUNT(9)  - REB-AMOUNT(10)
                       - REB-AMOUNT(11) - REB-AMOUNT(12)
                       - REB-AMOUNT(13)
              GO TO SEND-PAYOFF-LINES-SETUP.
           IF SUB > 3 AND <9
              IF REB-AMOUNT(SUB) = 0
                 GO TO SEND-PAYOFF-LINES-CONT
              ELSE
                 PERFORM SEND-PAYOFF-LINES-REC
                 GO TO SEND-PAYOFF-LINES-SETUP.
           MOVE SUB TO SUB2.
      * O1
           IF SUB2 = 9
              MOVE 4 TO SUB2
           ELSE
      * O2
           IF SUB2 = 10
              MOVE 5 TO SUB2
           ELSE
      * O3
           IF SUB2 = 11
              MOVE 6 TO SUB2
           ELSE
      * O4
           IF SUB2 = 12
              MOVE 7 TO SUB2
           ELSE
      * O5
           IF SUB2 = 13
              MOVE 8 TO SUB2.
           IF INS-RB-TBL(SUB2) = "Y"
              PERFORM SEND-PAYOFF-LINES-REC
              GO TO SEND-PAYOFF-LINES-SETUP.
           GO TO SEND-PAYOFF-LINES-CONT.
       SEND-PAYOFF-LINES-SETUP.
           PERFORM SETUP-LINE.
           ADD 1 TO SUB1.
           MOVE LN-BUF TO D-LINE(SUB1).
           IF SUB > 13
              GO TO SEND-PAYOFF-LINES-EXIT
           ELSE
              GO TO SEND-PAYOFF-LINES-CONT.
       SEND-PAYOFF-LINES-REC.
           IF LP-TRCD = "RV"
              MOVE REB-TYPE(SUB) TO LP-REFNO
           ELSE
              MOVE REB-TYPE(SUB) TO LP-TRCD.
           MOVE REB-AMOUNT(SUB) TO LP-TRAMT LP-APCUR.
           MOVE 0 TO LP-APOTH LP-APINT LP-APLC.
           MOVE 0 TO LP-OTHBAL LP-INTBAL LP-LCBAL.
           SUBTRACT LP-APCUR FROM LP-CURBAL.
           MOVE SPACES TO LP-REV.
       SEND-PAYOFF-LINES-EXIT.
           PERFORM DISPLAY-ALL-LINES.

      *********************************
       SETUP-LINE SECTION.
      *********************************
           MOVE SPACES TO LN-BUF ENTRY-BUF.
           IF LP-APCUR > 99999.99 OR LP-APCUR < -99999.99
              PERFORM SETUP-LINE2
              GO TO END-SETUP-LINE.
           MOVE LP-PAYDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO L-010 EB-010.
           MOVE LP-TRCD TO L-020 EB-020.

           MOVE LP-REFNO TO L-030 EB-030 LPWSLP-LP-REFNO.

           IF LP-TRCD = "JD" OR "AC" OR "IR"
              MOVE LP-NEWSTAT-RATE TO L-040RATE EB-040RATE
           ELSE
              MOVE LP-TRAMT TO L-040 EB-040
              IF ((LP-TRCD = "RT" OR "ET" OR "LP" OR "NP" OR "ST") OR
                   (LP-TRCD = "RV" AND
                    (LPWSLP-LP-ADDON-TEXT = "ADD" OR "ADJ" OR "CNL")))
                 IF LP-IBPC = "P"
                    MOVE LP-APCUR TO L-040 EB-040.
           IF ( LP-TRCD = "AP" OR REV-TRCD = "AP" ) 
              MOVE LP-APINTOWE TO L-050 EB-050
              ADD LP-LCPARTIALS LP-INTDUE GIVING L-060 EB-060
              COMPUTE L-070 = 0 - LP-APINTOWE
                                - LP-INTDUE
                                - LP-LCPARTIALS
              COMPUTE EB-070 = 0 - LP-APINTOWE
                                 - LP-INTDUE
                                 - LP-LCPARTIALS
           ELSE
           IF (LP-TRCD = "O2" OR "W2") OR (LP-TRCD = "RV" AND
              (LP-REVTRCD = "O2" OR "W2"))
              MOVE LP-APINTOWE TO L-050 EB-050
           ELSE
           IF LP-TRCD = "Z2" OR (LP-TRCD = "RV" AND LP-REVTRCD = "Z2")
              MOVE LP-APOT2 TO L-050 EB-050
           ELSE
              MOVE LP-APOTH TO L-050 EB-050.

           IF (  (LP-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO")
                 OR ( (LP-TRCD = "RV") AND
                      (
                         (LP-REVTRCD = "PB" OR "RN" OR "SC"
                                            OR "RB" OR "RO")
                         OR (REV-TRCD = "PB" OR "RN" OR "SC"
                                             OR "RB" OR "RO")
                      )
                    )
              )  AND (LP-APOT2 NOT = 0)
              ADD LP-APOTH LP-APOT2 GIVING L-050 EB-050
              INSPECT L-050 REPLACING TRAILING " " BY "*"
              INSPECT EB-050 REPLACING TRAILING " " BY "*".

           IF ( LP-TRCD NOT = "AP"  )
              ADD LP-APINT LP-APLC GIVING L-060 EB-060

              IF ( REV-TRCD = "AP" ) 
                 COMPUTE L-070 EB-070 = LP-APINTOWE * -1
              ELSE
                 MOVE LP-APCUR TO L-070 EB-070
              END-IF
              IF ((LP-TRCD = "RT" OR "ET" OR "LP" OR "NP" OR "ST") OR
                   (LP-TRCD = "RV" AND
                    (LPWSLP-LP-ADDON-TEXT = "ADD" OR "ADJ" OR "CNL")
                   )
                 ) AND LP-IBPC = "P"
                 MOVE LP-TRAMT TO L-070 EB-070.
           MOVE LP-PDTH-DATE TO NUM-DATE.
           MOVE NUM-MO TO EB-080-MO.
           IF LN-UNITPER-CD-DAYS
               MOVE NUM-DA TO EB-080-DAYR
           ELSE
               MOVE NUM-YR TO EB-080-DAYR.
           IF (LP-TRCD = "O2" OR "W2" OR "Z2")
                    OR (LP-TRCD = "RV" AND LP-REVTRCD = "Z2")
              MOVE LP-OT2BAL TO EB-090
           ELSE
              MOVE LP-OTHBAL TO EB-090.
           ADD LP-INTBAL LP-LCBAL GIVING EB-100.
           MOVE LP-CURBAL TO EB-110.
       CHECK-BAL-DISP.

      * 7/30/98 BAH ALWAYS DISPLAY BALANCES, EVEN ON REVERSALS #487
      * 8/11/98 SUPPRESS BALANCE IF ENV 'RVLINES' IS SET (MJD AS PER JTG)

           IF (LP-TRCD = "RV" OR LP-REV NOT = " ") AND
               NOT (LP-TRCD = "RV" AND LP-REVSEQNO = 0) AND
                   DISP-REV-BAL = "N"
                 MOVE "*" TO L-120 EB-120
           ELSE
              MOVE LP-PDTH-DATE TO NUM-DATE
              MOVE NUM-MO TO L-080-MO
              IF LN-UNITPER-CD-DAYS
                 MOVE NUM-DA TO L-080-DAYR
              ELSE
                 MOVE NUM-YR TO L-080-DAYR
              END-IF
              COMPUTE EB-090 = LP-OTHBAL + LP-OT2BAL
              ADD LP-INTBAL LP-LCBAL GIVING EB-100
              MOVE LP-CURBAL TO EB-110
              COMPUTE L-090 = LP-OTHBAL + LP-OT2BAL
              ADD LP-INTBAL LP-LCBAL GIVING L-100
              MOVE LP-CURBAL TO L-110
              IF (LP-TRCD = "RV" OR LP-REV NOT = SPACES) AND
                 NOT (LP-TRCD = "RV" AND LP-REVSEQNO = 0)
                 MOVE "*" TO L-120 EB-120.

       END-SETUP-LINE.
           EXIT.

      *********************************
       SETUP-LINE2 SECTION.
      *********************************
           MOVE LP-PAYDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO L2-010.
           MOVE LP-TRCD     TO L2-020.
           MOVE LP-REFNO    TO L2-030 LPWSLP-LP-REFNO.
           MOVE LP-TRAMT    TO L2-040.
           IF ( (LP-TRCD = "RT" OR "ET" OR "LP" OR "NP" OR "ST") OR
                 (LP-TRCD = "RV" AND
                  (LPWSLP-LP-ADDON-TEXT = "ADD" OR "ADJ" OR "CNL") ) )
              IF LP-IBPC = "P"
                 MOVE LP-APCUR TO L2-040.
           IF ( LP-TRCD = "AP" OR REV-TRCD = "AP" ) 
             MOVE LP-APINTOWE TO L2-050
             ADD LP-LCPARTIALS LP-INTDUE GIVING L2-060
             COMPUTE L2-070 = 0 - LP-APINTOWE
                                - LP-INTDUE
                                - LP-LCPARTIALS
           ELSE
           IF (LP-TRCD = "O2" OR "W2") OR (LP-TRCD = "RV" AND
              (LP-REVTRCD = "O2" OR "W2"))
              MOVE LP-APINTOWE TO L2-050
           ELSE
           IF LP-TRCD = "Z2" OR (LP-TRCD = "RV" AND LP-REVTRCD = "Z2")
              MOVE LP-APOT2 TO L2-050
           ELSE
              IF (LP-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
                 OR (LP-TRCD = "RV" AND
                       (LP-REVTRCD = "PB" OR "RN" OR "SC"
                                          OR "RB" OR "RO"
                       OR REV-TRCD = "PB" OR "RN" OR "SC"
                                            OR "RB" OR "RO" )))
                 AND LP-APOT2 NOT = 0
              ADD LP-APOTH LP-APOT2 GIVING L2-050
              INSPECT L2-050 REPLACING TRAILING " " BY "*".

           IF ( LP-TRCD NOT = "AP"                     ) 
              ADD LP-APINT LP-APLC GIVING L2-060
              MOVE LP-APCUR TO L2-070
              IF ((LP-TRCD = "RT" OR "ET" OR "LP" OR "NP" OR "ST") OR
                   (LP-TRCD = "RV" AND
                    (LPWSLP-LP-ADDON-TEXT = "ADD" OR "ADJ" OR "CNL")
                   )
                 ) AND LP-IBPC = "P"
                 MOVE LP-TRAMT TO L2-070.

      * 8/11/98 SUPPRESS BALANCE IF ENV 'RVLINES' IS SET (MJD AS PER JTG)

           IF (LP-TRCD = "RV" OR LP-REV NOT = SPACES) AND
              NOT (LP-TRCD = "RV" AND LP-REVSEQNO = 0) AND
                   DISP-REV-BAL = "N"
              MOVE "*" TO L2-120
           ELSE
              COMPUTE L2-090 = LP-OTHBAL + LP-OT2BAL
              ADD LP-INTBAL LP-LCBAL GIVING L2-100
              MOVE LP-CURBAL TO L2-110
              IF (LP-TRCD = "RV" OR LP-REV NOT = SPACES) AND
                 NOT (LP-TRCD = "RV" AND LP-REVSEQNO = 0)
                 MOVE "*" TO L2-120.

      *************************************
       SAVE-SCREEN SECTION.
      *************************************
           MOVE 3 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           IF VDUSTATUS = "16"
              IF WK-OLD-PROG-FORM = " "
                 MOVE 99 TO MENU-FG
                 GO TO EXIT-SAVE-SCREEN
              ELSE
                 MOVE WK-OLD-PROG-FORM TO NEW-PROG-FORM OLD-PROG-FORM
                 MOVE " " TO WK-OLD-PROG-FORM.

           MOVE ELE     TO WK-ELE.
           MOVE LP-REC  TO WK-LP-REC.
           MOVE LX-REC  TO WK-LX-REC.
           MOVE LXE-REC TO WK-LXE-REC.
           MOVE LXG-REC TO WK-LXG-REC.
           PERFORM REWRITE-WK-FILE.
       EXIT-SAVE-SCREEN.
           PERFORM CLOSE-WK-FILE.

      *************************************
       RESTORE-SCREEN SECTION.
      *************************************
           MOVE 3 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF NEW-FORM NOT = OLD-FORM
              MOVE OLD-PROG-FORM TO WK-OLD-PROG-FORM
              MOVE NEW-PROG-FORM TO OLD-PROG-FORM.
           IF IO-FG = 0
              GO TO RESTORE-CLEAR.

           MOVE SPACES TO WK-SAVE-RECORD.
           MOVE 0      TO WK-ELE.
           PERFORM WRITE-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           GO TO EXIT-RESTORE-SCREEN.
       RESTORE-CLEAR.
           MOVE WK-SAVE-RECORD TO LN-REC.
           MOVE WK-LP-REC      TO LP-REC.
           MOVE WK-LX-REC      TO LX-REC.
           MOVE WK-LXE-REC     TO LXE-REC.
           MOVE WK-LXG-REC     TO LXG-REC.
           MOVE 0              TO WK-ELE.
           PERFORM REWRITE-WK-FILE.
       EXIT-RESTORE-SCREEN.
           PERFORM CLOSE-WK-FILE.

      *********************************
       CDV-VERIFY SECTION.
      *********************************
           MOVE 0 TO CDV-SUB.
       CDV-VERIFY-NEXT.
           ADD 1 TO CDV-SUB.
           MOVE CDV-CD(CDV-SUB) TO STAT.
           IF STAT = LP-TRCD
              GO TO CDV-VERIFY-EXIT.
           IF STAT NOT = " "
              GO TO CDV-VERIFY-NEXT.
           MOVE 0 TO CDV-SUB.
       CDV-VERIFY-EXIT.
           EXIT.

      *****************************
       DO-RVENT-WIN SECTION.
      *****************************

           PERFORM RVENT-WIN.

           MOVE "LONPF" TO VDU-FORM-NAME.

      *    MOVE THE FIELDS FROM THE SCREEN TO THE LP VARIABLES HERE
           MOVE RVENTX-TRCD TO LP-REVTRCD.
           COMPUTE LP-TRAMT = RVENTX-TRAMT * -1.
           COMPUTE LP-APOTH = RVENTX-APOTH * -1.
           COMPUTE LP-APOT2 = RVENTX-APOT2 * -1.
           COMPUTE LP-APINT = RVENTX-APINT * -1.
           COMPUTE LP-APLC = RVENTX-APLC * -1.
           COMPUTE LP-APCUR = LP-APCUR * -1.
           COMPUTE LP-INTPAID = LP-INTPAID * -1.
           MOVE RVENTX-PRINBAL     TO LP-CURBAL.
           MOVE RVENTX-PDTH-DATE   TO LP-PDTH-DATE.
           MOVE RVENTX-LCPDTH-DATE TO LP-LCPDTH-DATE.
           MOVE RVENTX-INTBAL      TO LP-INTBAL.
           MOVE RVENTX-LCBAL       TO LP-LCBAL.
           MOVE RVENTX-OTHBAL      TO LP-OTHBAL.
           MOVE RVENTX-OT2BAL      TO LP-OT2BAL.
           MOVE 0 TO LP-EARNED(1) LP-EARNED(2) LP-EARNED(3).
           MOVE LP-LCBAL TO LP-APINTOWE.
      *    STORE DATE IN MMDD.YY FORMAT.
      *    MOVE RVENTX-LC-DATE TO HOLD-LCPAID.
           MOVE RVENTX-LC-DATE TO DATE-MMDDYY.
           COMPUTE HOLD-LCPAID = DATE-MMDDYY * .01.
           MOVE RVENTX-LC-AMT TO HOLD-PARTIALS.

       EXIT-DO-RVENT-WIN.
           EXIT.

      *******************************************************
       VERIFY-PASSWORD SECTION.
      *******************************************************
           MOVE " " TO PASSWDW-STAT.
           MOVE "LONPF8" TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           MOVE "CL/PASSWD" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.

      *******************************************************
       PASSWORD-MUST-EXIST SECTION.
      *******************************************************
           MOVE "EX" TO PASSWDW-STAT.
           MOVE "LONPF8" TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           MOVE "CL/PASSWD" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.


      ************************************************
       SETUP-EARNINGS-IB-15 SECTION.
      ************************************************
           MOVE 0 TO HOLD-EARNINGS-IB.

           MOVE LN-EARN-ORDER(1) TO SUB.
           IF SUB > 3
              ADD LXE-EARN(SUB - 3) TO HOLD-EARNINGS-IB
           ELSE
              ADD LP-EARNED(SUB) TO HOLD-EARNINGS-IB.

           MOVE LN-EARN-ORDER(5) TO SUB.
           IF SUB > 3
              ADD LXE-EARN(SUB - 3) TO HOLD-EARNINGS-IB
           ELSE
              ADD LP-EARNED(SUB) TO HOLD-EARNINGS-IB.

      ************************************************
       SETUP-EARNINGS-IB-16 SECTION.
      ************************************************
           MOVE 0 TO HOLD-EARNINGS-IB.

           MOVE LN-EARN-ORDER(5) TO SUB.
           IF SUB > 3
              ADD LXE-EARN(SUB - 3) TO HOLD-EARNINGS-IB
           ELSE
              ADD LP-EARNED(SUB) TO HOLD-EARNINGS-IB.


      ******************************************************
       BYPASS-ALTER-LP-REFNO SECTION.
      ******************************************************
           IF ( (BATCH-REFCD NOT = LOW-VALUES) AND
                (LP-REFNO NOT = " ") )
               GO TO BYPASS-ALTER-LP-REFNO-EXIT
           ELSE
              IF REV-TRCD NOT = "TS" AND
                           NOT = "TP" AND
                            NOT = "SP" AND
                             NOT = "DC" AND
                              NOT ADDON-POSTING
                 MOVE HOLD-LP-REFNO TO LP-REFNO
              ELSE
                IF REV-TRCD = "SP"
                   MOVE LP-REFNO         TO LPWSLP-LP-REFNO
                   MOVE LPWSLP-LP-POOLID TO HOLD-POOLID
                   MOVE LP-PRIOR-POOLID  TO LPWSLP-LP-POOLID
                   MOVE LPWSLP-LP-REFNO  TO LP-REFNO
                   MOVE HOLD-POOLID      TO LP-PRIOR-POOLID
                   MOVE "SETTING POOLID TO ZERO (0)" TO MESS
                   PERFORM SEND-MESS
                ELSE
                   IF REV-TRCD = "DC"
                      MOVE LP-OLD1ST-PYDATE TO HOLD-NEW-1ST-DUE
                      MOVE LN-1STPYDATE TO LP-OLD1ST-PYDATE
                   ELSE
                      IF ADDON-POSTING
                         NEXT SENTENCE
                      ELSE
                         MOVE LP-FROMCL TO LP-TOCL
                         MOVE LN-CLASS  TO LP-FROMCL
                         MOVE LP-REFNO  TO HOLD-LP-REFNO.

       BYPASS-ALTER-LP-REFNO-EXIT.
           EXIT.

      ************************************************
       READ-LXR-REB-AMT SECTION.
      ************************************************

      * GET THE LXR-REB-AMT FOR THIS REVERSAL
      * SAVE AND RESTORE LX REC, LXE IS USED ELSEWHERE IF IT CONTAINS VALUES.

           PERFORM OPEN-LX1-FILE.
           MOVE LP-BRNO   TO LX-BRNO.
           MOVE LP-ACCTNO TO LX-ACCTNO.
           MOVE LP-SEQNO  TO LX-SEQNO.
           PERFORM READ-LX1-FILE.
           PERFORM CLOSE-LX1-FILE.
           IF IO-GOOD
              COMPUTE HOLD-LXR-REB-AMT = -1 * LXR-REB-AMT
           ELSE
              MOVE 0 TO HOLD-LXR-REB-AMT.

       COPY "LIBGB/CAPASSWD.CPY".
       COPY "LIBGB/GPENV.CPY".

      *************************************
       MISCELLANEOUS-ROUTINES SECTION.
      *************************************
       COPY "LIBGB/SYSTEM.CPY".
       COPY "LIBGB/GETENV.CPY".
       FORM-RESET.
       GET-DL.
           PERFORM OPEN-DL1-FILE.
           PERFORM READ-DL1-FILE.
           PERFORM CLOSE-DL1-FILE.
       READ-EARNINGS.
      * GET THE LXE-EARN'S FOR THIS REVERSAL
           PERFORM OPEN-LXE1-FILE.
           MOVE LP-BRNO   TO LXE-BRNO.
           MOVE LP-ACCTNO TO LXE-ACCTNO.
           MOVE LP-SEQNO  TO LXE-SEQNO.
           PERFORM READ-LXE1-FILE.
           PERFORM CLOSE-LXE1-FILE.
           IF IO-FG NOT = 0
              MOVE 0 TO LXE-EARN(1) LXE-EARN(2) LXE-EARN(3)
                        LXE-WORKER LXE-WORKER2.
           IF REV-REBATE NOT = "Y"
              MOVE LXE-REC TO WK-LXE-REC.
       CALC-HOLD-LN-ACCERN.
           MOVE LN-EARN-ORDER(1) TO SUB.
           IF SUB > 3
              COMPUTE HOLD-LN-ACCERN(1) = LN-ACCERN(1) +
                                          LXE-EARN(SUB - 3)
           ELSE
              COMPUTE HOLD-LN-ACCERN(1) = LN-ACCERN(1) + LP-EARNED(SUB).

           MOVE LN-EARN-ORDER(2) TO SUB.
           IF SUB > 3
              COMPUTE HOLD-LN-ACCERN(2) = LN-ACCERN(2) +
                                          LXE-EARN(SUB - 3)
           ELSE
              COMPUTE HOLD-LN-ACCERN(2) = LN-ACCERN(2) + LP-EARNED(SUB).

           MOVE LN-EARN-ORDER(3) TO SUB.
           IF SUB > 3
              COMPUTE HOLD-LN-ACCERN(3) = LN-ACCERN(3) +
                                          LXE-EARN(SUB - 3)
           ELSE
              COMPUTE HOLD-LN-ACCERN(3) = LN-ACCERN(3) + LP-EARNED(SUB).

           MOVE LN-EARN-ORDER(4) TO SUB.
           IF SUB > 3
              COMPUTE HOLD-LN-ACCERN(4) = LN-ACCERN(4) +
                                          LXE-EARN(SUB - 3)
           ELSE
              COMPUTE HOLD-LN-ACCERN(4) = LN-ACCERN(4) + LP-EARNED(SUB).

           MOVE LN-EARN-ORDER(5) TO SUB.
           IF SUB > 3
              COMPUTE HOLD-LN-ACCERN(5) = LN-ACCERN(5) +
                                          LXE-EARN(SUB - 3)
           ELSE
              COMPUTE HOLD-LN-ACCERN(5) = LN-ACCERN(5) + LP-EARNED(SUB).

           MOVE LN-EARN-ORDER(6) TO SUB.
           IF SUB > 3
              COMPUTE HOLD-LN-ACCERN(6) = LN-ACCERN(6) +
                                          LXE-EARN(SUB - 3)
           ELSE
              COMPUTE HOLD-LN-ACCERN(6) = LN-ACCERN(6) + LP-EARNED(SUB).

       DISPLAY-EARNINGS.
           MOVE " " TO EARN-BUF.
           IF HOLD-DISPLAY-ERN = "A"
              COMPUTE TOTEARN =
                 HOLD-LN-ACCERN(1) + HOLD-LN-ACCERN(2) +
                 HOLD-LN-ACCERN(3) +
                 HOLD-LN-ACCERN(5)
              IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                     GP-INCL-OTH-IN-EARNED-R)
                 ADD HOLD-LN-ACCERN(6) TO TOTEARN
              END-IF
              IF NOT (GP-INCL-OTH-IN-EARNED-R)
                 ADD HOLD-LN-ACCERN(4) TO TOTEARN
              END-IF
              MOVE TOTEARN TO D-TOTEARN
           ELSE
           IF HOLD-DISPLAY-ERN = "U" AND
              LN-SERVACCT NOT = "Y" AND
              LN-PLCD = " "
              COMPUTE UNEARNED =
                         (LN-ANTICERN(1) - HOLD-LN-ACCERN(1)) +
                         (LN-ANTICERN(2) - HOLD-LN-ACCERN(2)) +
                         (LN-ANTICERN(3) - HOLD-LN-ACCERN(3)) +
                         (LN-ANTICERN(5) - HOLD-LN-ACCERN(5)) +
                          LN-ANTICADJ(1) + LN-ANTICADJ(2) +
                          LN-ANTICADJ(3) +
                          LN-ANTICADJ(5)
              IF NOT(GP-INCL-OTH-IN-EARNED-N OR
                                       GP-INCL-OTH-IN-EARNED-R)
                 COMPUTE UNEARNED = UNEARNED +
                         (LN-ANTICERN(6) - HOLD-LN-ACCERN(6)) +
                          LN-ANTICADJ(6)
              END-IF
              IF NOT(GP-INCL-OTH-IN-EARNED-R)
                 COMPUTE UNEARNED = UNEARNED +
                         (LN-ANTICERN(4) - HOLD-LN-ACCERN(4)) +
                          LN-ANTICADJ(4)
              END-IF
              MOVE UNEARNED TO D-TOTEARN
           ELSE
           IF HOLD-DISPLAY-ERN = "T"
              MOVE HOLD-LN-TOTERN TO D-TOTEARN
           ELSE
           IF HOLD-DISPLAY-ERN = "P"
              MOVE LN-TOTPAYMNTD TO D-TOTEARN
           ELSE
      * "I" IS TODAY DUE INTEREST BUT CALCULATING IT IN THE POSTING PROGRAMS
      *     WAS TOO MESSY SO LEAVE IT BLANK, NOT ZERO, BUT BLANK, LONPF1 WILL
      *     REDISPLAY IT
           IF HOLD-DISPLAY-ERN = "I"
              NEXT SENTENCE
           ELSE
              MOVE 0 TO D-TOTEARN.

           MOVE LN-YTDINTPD TO D-INTYTD.

           IF (LP-IBPC = "P" OR LN-LOANTYPE = "I")
                                      AND (SP-LCFRMLA NOT = " ")
              MOVE LCAP-LCPDTH-DATE-DATE TO NUM-DATE
              MOVE NUM-MO TO D-LCPDTH-MO
              IF LN-UNITPER-CD-DAYS
                 MOVE NUM-DA TO D-LCPDTH-DAYR
              ELSE
                 MOVE NUM-YR TO D-LCPDTH-DAYR
              END-IF
           ELSE
              MOVE 0 TO D-LCPDTH.

           MOVE LN-TOTNODEF TO D-DEFMNTS.
           MOVE LN-TOTNOALDEL TO D-ALDEL.
           COMPUTE D-EARNED ROUNDED =
                 LP-EARNED(1) + LP-EARNED(2) + LP-EARNED(3)
                + LXE-EARN(1) + LXE-EARN(2)  + LXE-EARN(3).
           MOVE LP-DLPROC TO D-DLPROC.
           MOVE EARN-BUF TO WR-BUF.
           MOVE EARN-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.

       DISBURSE-PUR-DISPLAY.
           MOVE SPACES TO LINE-BUF.
           MOVE "RECOURSE         :" TO D-GD8.
           MOVE "RESERVE PRIN 1   :" TO D-GD9.
           MOVE "RESERVE PRIN 2   :" TO D-GD0.
           IF GP-DLR-DISP-TYPE = "C"
              MOVE "COMMISSION       :" TO D-GD1
           ELSE
              MOVE "DISCOUNT         :" TO D-GD1.
           MOVE "ANTIC. INTEREST  :" TO D-GD2.
           MOVE "ANTIC. SERV. CHG :" TO D-GD3.
           IF LN-MAINTFEE NOT = 0
              IF LN-MF-REBATE = " " OR = "C"
               MOVE "ANTIC. MAINT. FEE:" TO D-GD4.
           MOVE "ANT. ERN:" TO D-F73B.
           MOVE "PROCEEDS:" TO D-F83B.
           IF LP-TRCD = "RV"
              COMPUTE D-GA9 = HOLD-LN-DLRVPRIN(1) * -1
              COMPUTE D-GA0 = HOLD-LN-DLRVPRIN(2) * -1
              COMPUTE D-GA1 = HOLD-LN-ANTIC-DISC * -1
              COMPUTE D-GA2 = HOLD-LN-ANTIC-INT * -1
              COMPUTE D-GA3 = HOLD-LN-ANTIC-SC * -1
              COMPUTE D-GA4 = HOLD-LN-ANTIC-MF * -1
              MOVE HOLD-LN-RECOURSE TO D-F22
              COMPUTE D-GA8 = HOLD-LN-PARTRCAMT * -1
              COMPUTE D-F73C = (HOLD-LN-ANTIC-INT * -1) +
                               (HOLD-LN-ANTIC-SC  * -1) +
                               (HOLD-LN-ANTIC-MF  * -1) +
                               (HOLD-LN-ANTIC-DISC * -1)
              COMPUTE D-F83C = HOLD-LN-PROCEEDS * -1.
           MOVE LINE-BUF TO WR-BUF.
           MOVE LINE-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.

       DISBURSE-OTHER-PROMPT.
           MOVE "S  A110GL9." TO VDU.
           MOVE " G/L-NUMBER" TO VDUBUF.
           PERFORM SCREENIO.
           MOVE "S  A200GD9." TO VDU.
           MOVE "DESCRIPTION         " TO VDUBUF.
           PERFORM SCREENIO.
           MOVE "S  A110GA9." TO VDU.
           MOVE "     AMOUNT" TO VDUBUF.
           PERFORM SCREENIO.
       TEST-STAT.
           IF STAT NOT = "00"
              PERFORM FORM-IT
              GO TO IO-ERROR.
       INCR-LCPDTH.
           MOVE LN-LCPDTH-DATE  TO NDTE-DATE.
           MOVE LN-UNITPER-CD   TO DATER-UNITPER-CD.
           MOVE LN-UNITPER-FREQ TO DATER-UNITPER-FREQ.
           PERFORM INCREMENT-UNITPER.
           MOVE NDTE-DATE TO PDTH-DATE-FULL
                             LP-LCPDTH-DATE
                             LCAP-LCPDTH-DATE-DATE.
       CLEAR-LEGEND.
           MOVE SPACES TO MESS.
           PERFORM SEND-LEGEND.
       DISPLAY-ALL-LINES.
           MOVE LINE-BUF TO WR-BUF.
           MOVE LINE-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       SEND-WSEL-LEGEND.
           MOVE MESS TO WR-BUF.
           MOVE WSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       SEND-LEGEND.
           MOVE "S  A000MSEL." TO VDU.
           MOVE MESS TO VDUBUF.
           PERFORM SCREENIO.
       MUST-BE-ALL-ZERO.
           MOVE "BRING OTHBAL, INTBAL, & LCBAL TO 0 FIRST!" TO MESS.
           PERFORM SEND-MESS.
       SEND-ENTRY-LINE.
           MOVE ENTRY-BUF TO WR-BUF.
           MOVE ENTRY-LINE TO WR-LIST.
           PERFORM CALL-WRFORM.
           IF LP-TRCD = "RV"
              IF REV-TRCD = "TP"
                 PERFORM DISBURSE-PUR-DISPLAY
              ELSE
                 IF LXG-GLNO(1) NOT = 0
                    MOVE 0 TO SUB
                    MOVE SPACES TO GL-BUF
                    PERFORM DISBURSE-OTHER-PROMPT
                    PERFORM DISPLAY-GL-INFO 3 TIMES
                    MOVE GL-BUF TO WR-BUF
                    MOVE GL-LIST TO WR-LIST
                    PERFORM CALL-WRFORM.

       DISPLAY-GL-INFO.
           ADD 1 TO SUB.
           IF LXG-GLNO(SUB) NOT = 0
              MOVE LXG-GLNO(SUB) TO GL-BR-ACCOUNT
              MOVE GL-BRANCH TO GLBR-ED
              MOVE GL-ACCOUNT TO GLNO-ED
              MOVE GLNO-EDIT TO D-GLNO(SUB)
              PERFORM OPEN-GL1-FILE
              PERFORM READ-GL1-FILE
              PERFORM CLOSE-GL1-FILE
              IF IO-FG = 0
                 MOVE GL-DESCRIPTION TO D-GLDESC(SUB).
           MOVE LXG-GLAMT(SUB) TO D-GLAMT(SUB).


       COPY "LIBWI/PFSWINDOWS.CPY".
       COPY "LIBLP/LPIBPC.CPY".
       COPY "LIBLP/LPMDTE.CPY".
       COPY "LIBLP/LPXDTE.CPY".
       COPY "LIBGB/DATER.CPY".
       COPY "LIBGB/SPPDTH.CPY".
       COPY "LIBLP/LPCDEL.CPY".
       COPY "LIBLP/LPCEPP.CPY".
       COPY "LIBLP/AFPDLLP.CPY".
       COPY "LIBGB/SCREEN.CPY".
       COPY "LIBWI/RVENT.CPY".


      **************************************
       SETUP-LINK-INFO SECTION.
      **************************************
           IF VDU-FORM-NAME = "LPSMNU"
              MOVE LPSMNU-HELP--FILE TO HELP-LINK-FILE
              MOVE LPSMNU-HELP--DIR  TO HELP-LINK-DIR
           ELSE
              MOVE LONPF-HELP--FILE TO HELP-LINK-FILE
              MOVE LONPF-HELP--DIR TO HELP-LINK-DIR.

      **************************************
       VDU-CONVERT-FIELD SECTION.
      **************************************
           MOVE "00" TO STAT.
           MOVE VDU-FIELD-TO-CONVERT TO VDU-ALP-FIELD.
           EVALUATE TRUE
              COPY "LIBLP/LONPF_EVA.CPY".
              COPY "LIBLP/LPSMNU_EVA.CPY".
              COPY "LIBLP/LPLNMU_EVA.CPY".
              COPY "LIBLP/LPCAMU_EVA.CPY".
              COPY "LIBLP/LPVDMU_EVA.CPY".
              COPY "LIBWI/RVENT_EVA.CPY".
              WHEN OTHER       MOVE   "2A" TO STAT
           END-EVALUATE.

      ********************************************
       IO-ROUTINES SECTION.
      ********************************************
       COPY "LIBGB/CONNECT_SQL.CPY".
       COPY "LIBLP/LPSPGS_SQL.CPY".
       COPY "LIBLP/LPPDGS_SQL.CPY".
       COPY "LIBLP/LPLXGGS_SQL.CPY".
       COPY "LIBLP/LPLXEGS_SQL.CPY".
       COPY "LIBLP/LPLXGS_SQL.CPY".
       COPY "LIBLP/LPLTPGS_SQL.CPY".
       COPY "LIBLP/LPLPGS_SQL.CPY".
       COPY "LIBLP/LPDLGS_SQL.CPY".
       COPY "LIBLP/LPCAGS_SQL.CPY".
       COPY "LIBGL/GLGLGS_SQL.CPY".
       COPY "LIBGB/GBBRGS_SQL.CPY".
       COPY "LIBGB/GBBRRN.CPY".
       COPY "LIBLP/LPLP1RN.CPY".
       COPY "LIBLP/LPLX1RN.CPY".
       COPY "LIBLP/LPLXE1RN.CPY".
       COPY "LIBLP/LPLXG1RN.CPY".
       COPY "LIBLP/LPSP1RN.CPY".
       COPY "LIBLP/LPCA1RN.CPY".
       COPY "LIBGL/GLGL1RN.CPY".
       COPY "LIBLP/LPPD1IN.CPY".
       COPY "LIBLP/LPWKI.CPY".
       COPY "LIBLP/LPDL1RN.CPY".
       COPY "LIBLP/LPLTP1RN.CPY".

       COPY "LIBGB/FERRORS.CPY".
           MOVE "E" TO ERRCD.
       END-ROUTINE.
           IF ROUTE-CD NOT = "3" AND NOT = "4"
              IF PD1-EXISTS = "Y"
                 MOVE "N" TO PD1-EXISTS
                 PERFORM CLOSE-PD1-FILE.
           PERFORM CLOSE-FILES.
       EXIT-PROG.
       STOP-RUN.
           EXIT PROGRAM.
