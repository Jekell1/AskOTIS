       IDENTIFICATION DIVISION.
       PROGRAM-ID.      LONPB2.
       DATE-WRITTEN.    012484.
      *****************************************************************
      *                 (LP)
      *  DESCRIPTION:   SALES FINANCE LOAN
      *                 CONTRACT UPDATE
      *
      *  !!!! HEY   !!!!   THIS PROGRAM HAS BEEN ALTERED SO IT CAN BE CALLED
      *  !!!!!!!!!!!!!!!   FROM MERCURY'S BATCH PROGRAM TO CREATE LOANS
      *  !!!!!!!!!!!!!!!   FROM CMSI'S SAVED LOANS.  I HAD TO CHANGE
      *  !!!!!!!!!!!!!!!   ALL OCCURANCES OF PERFORM SEND-MESS TO
      *  !!!!!!!!!!!!!!!   PERFORM CONDITIONAL-SEND-MESS SO ERRORS
      *  !!!!!!!!!!!!!!!   MIGHT NOT GO TO THE SCREEN, SO PLEASE DON'T
      *  !!!!!!!!!!!!!!!   PERFORM SEND-MESS, PERFORM CONDITIONAL-SEND-MESS
      *
      * REV:
      *  052295 BLL SAVE DT-SEQ IN CX-DT-SEQ FOR MULTIPLE CHECKS
      *  060195 BAH CHANGED LT-COLL-AMT1 TO LT-MILEAGE
      *                     LT-COLL-AMT2 TO LT-VALUE
      *                     LT-COLL-AMT3 TO LT-SELLPR
      *                     LT-COLL-AMT4 TO LT-MISC-AMT
      *  060795 BLL BUG-MANUAL CKS ADDING TO DS-UNPAID
      *  062095 JTG ADDED SET OF TS-O3INS-DLPROC
      *  062895 MJD ADDED COPY MEMBERS LIBLP/POSTDATE AND POSTDATEW.
      *             SET TC-USERID, POSTTIME, AND POSTDATE.
      *             SET TS-USERID, POSTTIME, AND POSTDATE.
      *  071295 JTG REMOVED TS-PR,FIELDS AND ADDED TS-INSPREM-DLADJ
      *  080895 BAH WAS USING SECOND MAKERS NAME AS CHECK REASON, USE
      *             HOLD-BW-LNAME
      *  081195 JTG ADDED LOGIC FOR LPSRCD
      *  081195 MJD ADDED GP-FILE INFO FOR LIBLP/LPSRCD :
      *                   GP-THE-LAST-SF-SRCD.
      *  081595 ADDED GP-THE-ONLY-SF-SRCD LOGIC FOR DS UPDATES.
      *  083195 KEC ADDED LIBLP/LPNOCL
      *  MJD 091495 ADDED DS-DATE-TO DS1-KEY, ADDED DATE SET LOGIC.
      *  MJD 110895 ADDED LOGIC TO UPDATE TY-(DELINQ TABLE) BYPASSING
      *             VOLUME
      *  MJD 012496 NEW LOGIC FOR TY PL TABLE
      *  MJD 020196 ADDED LOGIC FOR TY-DLRVPRIN, TY-DLRVCHGS, DLPARVHELD.
      *  MJD 021996 ADDED LOGIC FOR BR-SFDLO3-WINDOW-FG = "B".
      *  MJD 022896 ADDED UPDATE-BA1-FILE SECTION. IF A BA-REC EXISTS FOR
      *             BORROWER, THEN IT IS DELETED.
      *  MJD 031196 ADDED LOGIC TO BLOCK GENERATION OF 0 ACCOUNT NUMBER.
      *  JTG 061896 ADDED MA-RECORD LOGIC TO CHECK FOR LOAN APPLICATION
      *  BAH 062496 ALLOW DEALER ADDRESS TO PRINT ON CHECKS
      *  MJD 071096 CHANGED PDTH-DATE TO PDTH-DATE-FULL TO USE MMDDYY FORMAT
      *  JTG 093096 ADDED UPDATE OF DSFILE (DELINQUENCY)
      *  JTG 100396 CHANGED TO UPDATE BI-FILE LAST
      *  JTG 101596 SET CLEAR OF LXE-WORKER & LXE-WORKER2, SPERNFRMLA 15 & 16
      *  JTG 102896 STOPPED DELETE OF BA-RECORDS
      *  JTG 112196 CORRECTED BUG WITH WRONG SUBSCRIPT ON COMPUTE OF COMMISSION
      *             NEW COPY MEMBERS LIBLP/LPIEXP/W
      *             (IEXP-SUB/SUB1 --> IEXP-LN/IC)
      *  JTG 011997 RENAMED PARAGRAPH NAMES FOR NON BATCH CHECK UPDATE
      *             TO 'CHECK-UPD.....ETC'
      *  MJD 012297 REMOVED REFERENCE TO LN-INSTBL(9-10).
      *  KEC 012397 REVISED ACCESSING MA-FILE: NEW FORMAT FOR MA-FILE.
      *  KEC 021897 REVISED ACCESSING BA-FILE: NEW FORMAT FOR BA-FILE.
      *  KEC 040897 REVISED TO PROPERLY ACCESS NEW APPLICATION MODULE.
      *  GLF 050797 ADDED COPY MEMBERS: SETCTBLW AND SETCTBL
      *  MJD 051597 ADDED LPPOF2 COPY MEMBER (PREVIOUSLY WAS PART OF LPPOFF)
      *  BLV 051997 ADDED APPLICATIONS MADE FOR TY & DS UPDATES
      *  JTG 060297 ADDED CALCULATION OF LN-YLDRATE TO CORRECT ADJUSTMENTS
      *             MADE RE: INSURANCE ADJUSTMENTS LN-INSPREM-DLADJ
      *  MJD 070297 ADDED UPDATE OF TY-DLDISC AND DS-DLDISC-VOL(1-2)
      *  JTG 072897 ADDED LPWDEL/W  MERCURY #E135
      *  JTG 073197 CORRECTED LOOP TO SUM INS OURS & FEES OURS
      *             RE: SERVICE ACCTS NEGATIVE DL-PROCEEDS
      *  JTG 080497 UPDATED DS-UNPAID INS OURS & FEES OURS
      *             RE: SERVICE ACCTS NEGATIVE DL-PROCEEDS
      *  GLF 090497 REPLACED 'IO' ON GP-FILE WITH GET 'GPENV'
      *  MJD 091797 REMOVED REFERENCE TO DELSUB. ADDED LPPDUE(W)
      *  MJD 112197 EXPANDED LN-REC TO 1800 BYTES
      *  JTG 111197 ADDED LOGIC FOR LIBLP/DEFPOL RE: BR-NODEF-1ST-X-MONTHS #167
      *  BLV 020698 ADDED LN-GIFTNET TO BICREA CALL
      *  MJD 030398 ADDED PLCD AND CONVERCD TO BICREA CALL
      *   CS 031898 ADD TEST OF LC-APP-REQ-FOR-LOAN IF THE BR-APP-REQUIRED-FOR
      *             INPUT Y (MERCURY)
      *  MJD 032098 ADDED GETENV(W) FOR USE IN LIBLP/POSTDATE
      *  KEC 051498 ADDED 'SET-TRACK-STATUS'.  WAS NOT UPDATING THE
      *              MA-STATUS-TRACK.
      *  JTG 061598 ADDED LOGIC TO UPDATE BANKRUPT DELINQUENT STATISTICS
      *  JTG 062398 ADDED LOGIC FOR S.F. RENEWALS (PB/RN/RB/RO)
      *  JTG 063098 EXPANDED DS-APP-TYPE-TBL TO 3 LEVELS
      *  JTG 071598 ADDED LN-PRDLDISCUNEARN UPDATE FOR CARRY OVER OF DISCOUNT
      *             UNEARNED ON RENEWALS
      *  JTG 081898 ALLOWED 'PB' ON BANKRUPT ACCOUNTS IF GP-I-AM-WORLD <JGW
      *  JTG 082098 CORRECTED SET OF LN-PRDLDISCUNEARN FOR CARRYOVER OF DISCOUNT
      *  091198 BAH ADD BW-FNAME TO CX-REASON, TC-REASON AND CK-REASON
      *             EAST TENN, PR# 745
      *  101598 JTG ADDED LOGIC FOR UPDATE OF REVOLVING SALES CONTRACT, REGENCY
      *  JTG 102398 CHANGED DS..APP..UPDATE FOR RENEWALS TO LEVEL 2 OTHER
      *  GLF 111298 MADE MEMO DATE 2000 COMPATIBL
      *  JTG 111398 BYPASSED SET OF CREDITLIM FOR REVOLVING SINCE IT IS INPUTED
      *             IN VONPB0.C
      *  JTG 990112 ADDED SP-LOANCOST-FRMLA AND SP-LOANCOST-AMT, REGENCY #006
      *  JTG 990126 STOPPED SETTING LOAN COSTS FOR REVOLVING AND SERVICE
      *  JTG 990226 ALLOWED UPDATE OF BW-FILE FOR REVOLVING, REGENCY
      *  JTG 990322 ADDED UPDATE OF TS-SP-LNCOST-FRMLA RE: TFC #008
      *  MJD 990416 CHANGED TO INCLUDE/EXCLUDE O2 IN DELINQ BASED
      *             ON GP-DELINQ-WITH-O2
      *  BAH 990429 FIXED RENEWAL BANKRUPT MEMO LOGIC LOOPING, WAS GOING TO
      *             START AGAIN INSTEAD OF READ-NEXT...REGENCY
      *  JTG 990720 STOPPED UPDATE OF BWFILE RE: LN-ACTIVE-FG      REVOLVING #45
      *  JTG 990726 ADDED LOGIC FOR UPDATE OF REVOLVING LOAN APPLICATION STATS
      *  MJD 990910 CHANGED TO SKIP INSURANCE BUCKETS 7 & 8 (O4 & O5) WHEN
      *             UPDATING TY. CHANGED TO UPDATE INS-ELIG FOR O1 IF
      *             APPLICABLE. ADDED LOGIC TO UPDATE INS-NOT-WRITTEN (9 & 10)
      *             IF AD&D OR ROADGARD ARE NOT WRITTEN (WORLD ONLY)
      *             (WORLD PR# AS PER JOHN)
      *  JTG 991116 ADDED TEST FOR ENV VARIABLE 'REVOL_CONV_ACCTNO'
      *             TO DETERMINE IF REVOLVING ACCOUNTS ARE BEING INPUT FOR
      *             MANUAL CONVERSION AND ACCOUNT NO. WILL BE INPUT
      * KEC 1999.1217 {PR#0000} WAS A PROBLEM THAT THE MA-TRACK-STATUS
      *                WAS NOT BEING PROPERLY SETUP.
      *                CHANGED THE FOLLOWING:
      *                  1.  ORIGINAL-TRACK-STATUS WAS X(1) NOT X(6).
      *                  2.  WAS MOVING MA-STATUS NOT MA-TRACK-STATUS
      *                       TO ORIGINAL-TRACK-STATUS.
      * BAH 000120 AUTOMATICALLY PUT A "U" IN THIRD POSITION OF ACTIONCD FOR
      *            GP-I-AM-TFC, TFC PR# 65
      * BLV 000313 UPDATE LN-CREDITLIM IF LC-CALC-HI-CREDIT = "W",
      *            WORLD PR# 225
      * JTG 000322 MODIFIED TO UPDATE UNEARNED STATISTICS, MERCURY #223
      * MJD 000406 ADDED UPDATE OF DS-PROCEEDS AND TY-PROCEEDS (MERC PR#223)
      * MJD 000814 CHANGED TO COMPUTE EARNINGS AFTER SETTING UP
      *            LN-PRDLDISC-UNEARN ON RENEWALS  AND CHANGED TO SKIP
      *            UPDATE OF VOLUME ON DLDISC UNEARNED IF CARRIED OVER
      *            FROM PREVIOUS LOAN
      *  JTG 010112 ADDED NEW 88 SP-CAL-SET-SMPRATE-OVRRIDE VALUE 4 MERC PR#J016
      *  BAH 010214 SAVE-NO-REC WAS 130, SHOULD BE 176, FIELDS WERE COMING OUT
      *             2020202, FINMGM
      *  JTG 010227 ADDED SET OF LN-EXTRA-PRIN-LFP LN-REMAIN-INT-SINCE-LFP
      *             LN-REMAIN-PRIN-SINCE-LFP      (LFP=LAST-FULL-PAYMENT)
      *             LENDMARK, PR#1045 & PR#1380
      *  BAH 010312 CARRY DLPOOL FROM OLD LOAN TO NEW LOAN ON "RB" "RO" LOANS
      *             MERC SECURITIZATION
      *  CS  010315 SET THE LC-POOLID TO DEFAULT LN-DLPOOL.  IF ITS A RENEWAL,
      *             THIS DEFAULT GETS OVERWROTE IN UPDATE PRIOR LOAN INFO WITH
      *             PRIOR-DLPOOL.
      *  BAH 010511 DONT UPDATE ACTIONCD WITH A "U" IF FLORIDA DEALERS, WHO ARE
      *             SET AS GP-I-AM-TFC !! JUDY
      *  GLB 010702 DLR:SUBSTITUTE COPY MEMBER LPCXCL TO CLEAR CX-RECORD
      *  GLB 010702 DLR:SUBSTITUTE COPY MEMBER LPCKCL TO CLEAR CK-RECORD
      *  GLB 010702 DLR:FIX MOVE FROM DL-NUM-->CX-DLNO;TO DL-DLNO-->CX-DL
      *  GLB 010702 FIX FIELDS FOR MANUAL CHECK
      *  GLB 011702 ADD CREATE DT-REC FOR "CK" MANUAL CHECK DETAIL
      *  BLV 010731 ADD LOGIC TO ALLOW THIS PROGRAM TO BE CALLED FROM LP/LNCREA,
      *             MERCURY AUTOMATIC UPDATE OF SAVED CMSI LOANS, MERC PR# 253
      *  JTG 010808 ADDED SP-LNCOST-FRMLA-VALID 'P' AMORTIZED
      *             PARTICIPATION EXPENSE                         REGACC PR#1559
      *  BLV 010817 SET UP IX-ALL-PATH & PUT IN CREAIX-IX-PATH, CREAIX WAS
      *             WRITING TO LOCAL PATH WHEN CALLED FROM LNCREA, MERC PR# 253
      *  BAH 020424 SET LN-LBOX FLAG TO "Y" SO BATCH PAYMENTS FIRST PAYMENT
      *             WILL HANDLE LATE CHARGES CORRECTLY, REGACC KEVIN
      *  BAH 020617 ADDED SET OF TS-DLPAID, REGACC PR# 1822
      *  JTG 020619 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *  JTG 020917 ADDED LN-DLCOMM-03-CMSI LN-DLCOMM-PP-CMSI      REGACC #1846
      *             ADDED TS-DLCOMM-PP-CMSI TS-DLCOMM-O3-CMSI
      *  GLB 030103 FIX MANUAL CHECK DT-REC "CK";
      *      CHANGE TO  0 PROCEEDS AND REVERSED PAYMENTS
      *  BLV 030226 CREATE LOAN MEMO TO DOCUMENT USER WHO APPROVED LOAN IF OVER
      *             LIMIT IF GP-APPROVAL-MEMO = Y, WORLD PR# 315
      *  JTG 030620 ADDED LOGIC FOR IB SALES FINANCE AMORTIZATED PARTICIPATION
      *             RESERVE PAID EXPENSE, DIFFERENCE BETWEEN A BUY RATE
      *             AND THE CONTRACT RATE                WISCONSIN FINANCE #2049
      *  BAH 030707 CHECK BR-IMMEDIATE-DOC-PRINT FLAG TO GO TO DOC PRINT
      *             SCREEN AFTER UPDATE, PL#414
      * KEC 2003.0819 ADDED NEW ROUTINE TO CREATE LOAN APPLICATION
      *               STATUS CHANGE MEMO (LIBLA/MEMOSTATUS)
      * BAH 030930 WAS NOT CREATING INITIAL KEY OR FORM REQEUST FOR
      *            FORMS 11 - 20, PAGE 2 OF FORMS SETUP IN SPR, NSA LAURA
      * BAH 031120 ADDED GP-NON-FILE-FEECODE TO UPDATE TY/BY FILE WITH
      *            NON FILE INSURANCE FOR WORLD SMITH REPLACEMENT
      * BAH 040107 ADDED NEW TRAILER UPDATE, LT-CODE "F" FOR FEECODE
      *            PAYABLE AMOUNT (COMMISSION) FOR WORLD PR# 331
      * JTG 040513 ADDED LOGIC TO CAUSE THE UNEARNED LOAN COST TO ROLL TO
      *            THE NEW LOAN AFTER 'RENEWAL'. NOTE: THIS COST IS REFLECTIVE
      *            OF THE DISCOUNT WHEN PURCHASING LOAN PAPER NOT CARRIED AS
      *            SALES PAPER WITH DEALER DISCOUNT.
      *            ADDED SP-LNCOST-FRMLA = 'R'                    REGENCY #2287
      * JTG 041014 ADDED GP-AMORTIZE-ACQUIST-FEE, THIS OPTION WILL TAKE THE
      *            AMOUNT ENTERED IN RESERVE PRINCIPAL 3 AND MOVE IT TO
      *            THE LOANS UNEARNED SERVICE CHARGE               REGACC #0081
      * BLF 050118 ADDED UPDATE OF DNFILE (DEALER ACH FAX NOTIFICATION FILE),
      *            WRITES FILE IN FAX DIRECTORY WITH DEALER INFO & PROCEEDS,
      *            REGACC PR# 96
      * BLF 050120 PUT "A" IN LN-PROC-DISBURSED IF I-AM-REGACC & DL-ACH-FG
      *            = "Y", FLAGGING AS DEALER DIRECT DEPOSIT, REGACC PR# 96
      * BLF 050202 ADD BRANCH NAME TO DN-FILE, FIX NOT UPDATING DN-CUST-NAME,
      *            REGACC PR# 96
      * BAH 050211 ADDED CREATE-TRIAD-TRAILER FOR ALL NEW LOANS IF GP FLAG
      *            IS SET.
      *  CS 050425 IF INSURANCE PREMIUM = ZERO, ZERO THE INSCOMP,INSCOMM,
      *             EFFDATE,EXPDATE, AND OUR FLAG WE WERE COMPUTING A COMMISSION
      *             AMOUNT [PR#479 NSA]
      *  JTG 050519 ADDED NEW FORMULAS FOR MEXICO
      *             SP-MFFRMLA-05 SP-RBFRMLA2 (G) SP-ERNFRMLA (24)   WORLD #0408
      *  JTG 050706 ADDED TEST FOR LN-FEEOURS = "Y" WHEN ADDING TO FEE-UNEARN
      *              "   CHANGES FOR REPORTING AND TAKING FEE CODE EARNINGS
      *             CREATED CD-GC-FEE-EARNINGS-FG         LENDMARK #2542
      *  BAH 060214 ADDED TEST OF GP-INTERIM-COUPONS AND SP-INTERIM-COUPON FOR
      *             SALES FINANCE UPDATE ACC PR# 2704
      *  BAH 060310 ADDED CORPORATE FORM PRINTING, MUST SET FM-PATH AND OPEN
      *             AND CLOSE IT INSIDE SP-PRFORM LOOP, LENDMARK, PR# 2730
      * KEC 2006.0720 CREATED A ROUTINE (UPDATE-LT1-A-FILE) TO CREATE LT-RECS
      *               (A) FROM THE PC-FILE {FROM CMSI UPLOAD}. REGACC #127
      *  BAH 061205 MOVE BR-COUPON-STATEMENT TO LN-COUPON-STATEMENT,
      *             REGACC PR# 158
      *   CS 070717 SET LR-PX10-ENVELOPE-MAKER-COMAKER TO 'M' REGACC PR#177
      *  BLF 070801 STARRED OFF "IF I-AM-WORLD" SO ROADGARD, AD&D & NONFILE
      *             INSURANCE WILL UPDATE TO STATS IF CODES ARE SET UP IN
      *             BRANCH OR GLOBAL PARAMTER RECORDS, CONSUMER PR# 3025
      *  BLF 071116 PUT "A" IN LN-PARVHELD-PAID-FG IF I-AM-REGACC & DL-ACH-FG
      *             = "Y", FLAGGING AS PARTICIPATION HELD DIRECT DEPOSIT,
      *             REGACC PR# 185
      * BAH 071205 FIX TS-DL-PARVPAID-CODE TO BE SET WITH THE IB CODE IF
      *            THE LOANTYPE IS "I", WAS FORCING THE DL-PARVPAID-CODE
      *            INSTEAD OF DL-PARVPAID-CODE-IB. LPEOD5TR HAD SPACES IN
      *            IT WHICH CAUSED OUT OF BALANCE DAYS. CITIZENS/TRIST PL# 612
      *  CS 071217 ADDED TEST IF BR-USE-PARTIC-FLAT-TABLE IS 'Y' MOVE ZERO
      *            TO TS-ANTICERN(4). ANTICERN(4) IS BEING USED TO AMORTIZE
      *            AN EXPENSE, ITS REALLY NOT AN UNEARNED PR#185
      *  CS 081111 ADDED TEST ON GP-INCL-OTH-IN-EARNED = 'R', DONT INCLUDE
      *            OTHER(ANTIC 6) OR MAINTFEE(ANTIC 4) IN EARNED OR UNEARNED
      *            REGACC USES TO AMORTIZE PARTICIPATION EXPENSE.  THE EXISTING
      *            UPDATE TO STATS IF GP-INCL-OTHER-IN-EARNED = 'N' DOESNT SEEM
      *            CORRECT TO ME.. UPDATES GAIN/LOSS REGARDLESS OF INCLUDE-OTHER
      *            FLAG BUT DOESNT UPDATE VOLUME, SEEMS TO ME SHOULDNT UPDATE
      *            EITHER BUT I DIDNT CHANGE IT, KEVIN SAYS REGACC DOENST CARE
      *                                                          REGACC PR#210
      * BAH 100128 ADDED LT-SEQ 5 FOR A 3RD HHGS COLLATERAL UNITED ACC ONLY
      *                                             UNITED PR# 3524
      *  CS 110407 ADD SP-LNCOST-FRMLA '4', DOES THE 'F'LAT AMOUNT IDENTIFIED IN
      *            SPR, PLUS TAKES PARTICIPATION PAID & UPDATES LN-ANTICERN(3)
      *            THEN ACCRUAL AMORTIZES THE RESERVE EXPENSE REGMGM PR#3765
      * BLM 110511 PROGRAM WAS PUTTING "A" IN LN-PROC-DISBURSED IF I-AM-REGACC
      *            & DL-ACH-FG = "Y", FLAGGING AS DEALER DIRECT DEPOSIT.
      *            CHANGED TO MOVE "A" TO LN-PROC-DISBURSED IF DL-ACH-FG = "Y",
      *            DONT CHECK IF I-AM-REGACC.  REGMGM PR# 3782
      * BLM 070816 IF GP-PURGE-TO-ARCHIVE = "Y", CHECK TO SEE IF ACCT #
      *            ALREADY EXISTS IN ARCHIVED LOAN FILE; IF SO, SKIP TO
      *            NEXT NUMBER, REGACC PR# 304
      * BAH 120618 ADDED OFAC-WINDOW FOR REGENCY, PR# 4054
      * BAH 120905 ADDED LT-VIN-CHG-DATE FOR REGACC PR# 319
      * KEC 130205 {PR#04196} REGENCY <A15> [LORI MCBEE]
      *            MADE CHANGES TO LOAN APPS - ADDED MX-FILE.
      * KEC 130625 ADDED NEW UPDATE ROUTINE FOR SOAU IN NOT UPDATING
      *            THE MA-STATUS INFO FIELDS (KEEPS THE 'A' ITEMS). SOAUTO #4285
      * BAH 130923 ALLOW GP-I-AM-WDT TO USE LT-SEQ 5 FOR A 3RD HHGS PR#4095
      * KEC 2013.1107 ADDED SP-LNCOST-FRMLA '5', DOES THE 'F'LAT AMOUNT
      *               IDENTIFIED IN SPR, PLUS TAKES PARTICIPATION PAID
      *               & UPDATES LN-ANTICERN(4) THEN ACCRUAL AMORTIZES
      *               THE RESERVE EXPENSE         REGACC #345
      *  CS 131230 REMOVED TEST OF GP-LR-TRAILER-TRIAD = "Y" OR "R", 'Y/N"
      *            ARE THE ONLY VALID OPTIONS, CONFUSED WITH GP-USE-ACCRUAL-EARN
      *            FILE WHICH DOES HAVE A VALUE OF 'R' TO DO A PREPROCESSOR
      *            PRIOR TO ACCRUAL PR#347
      * KEC 140213 ADDED LOGIC FOR WORLD TO DO LOAN APPS.
      *            ADDED UPDATE-BX1-FILE SECTION.            WORLD #967
      * BAH 141008 ADDED GP-DEFAULT-SKIP-TRW, COSMO PR# 4629
      * BAH 141010 FIXED BUG WITH LN-REP-CD, WAS GETTING SET WITH USERID
      *            FOR EVERYONE IF THERE WAS AN APP, SHOULD HAVE ONLY BEEN
      *            FOR SOAUTO, PL#861 MAPLE/LORI
      * BLM 151217 DON'T MOVE "A" TO LN-PROC-DISBURSED FOR ACH DEALER UNLESS
      *            WK-DLPAID = "B", KSTREET PR# 4865
      * CS 160112 ADD MOVE OF LN-OWNBR TO LP-BRNO
      * BAH 160118 SPLIT OUT LTFILE, PD0003
      * KEC 2016.0211 FIXED KEYS & RECS FOR FD-REC.
      *               CHANGED FMNO/FORMNO/NEXTFM/SETFM FROM 3 TO 4 BYTES.
      *  CS 160216 SET LX-BRNO
      * BAH 160218 EXPANDED LM-REC ADDED LM-BRNO, PD0003
      * BLM 160225 FIX FOR NEW TY-DATE FORMAT, YYYYMMDD INSTEAD OF YYYMMDD
      * KEC 2016.0310 CHANGED CD-GROUP, CD-SECURED & CD-TRW TO BE
      *               CD-CO-GROUP, CD-CO-SECURED & CD-CO-TRW.
      * KEC 2016.0315 CHANGED CD-FEE???? TO CD-GC-????.
      * KEC 2016.0505 CHANGED MA-APPNO TO MA-APP-NUMBER TO MATCH MA1-KEY.
      *               CHANGED MEMOSTATUS-APPNO TO MEMOSTATUS-APP-NUMBER
      *                AND INCREASE FROM 6 TO 9 BYTES.
      *               CHANGED MEMOSTATUS-NUMBER TO MEMOSTATUS-ACCTNO 
      *                AND INCREASE FROM 6 TO 8 BYTES.
      *               CHANGED MEMOSTATUS-STATUS-DATE FROM 6 TO 8 BYTES.
      *               CHANGED LN-APPNO TO USE LN-APP-NUMBER FOR MA1-KEY.
      *               CHANGED MA-STATUS-CD TO MA-STATUS-REASON.
      * BLM 160511 FIX FOR NEW DS-DATE FORMAT, YYYYMM INSTEAD OF YYYMM,
      *            FIX DS-UNEARNED, PD0003
      * KEC 2016.0524 CHANGED USE OF MA-APPDATE & MA-STATUS-DATE TO USE
      *               CCYYMMDD.
      * KEC 2016.0525 CHANGED USE OF MA-TRACK-STATUS TO BE X(10).
      * KEC 2016.0621 REMOVED USE OF THE MX-FILE [LIBLA/LAFDMX].
      *               REMOVED USE OF OLD STATUS ROUTINES [LIBLA/MASTATUS(W)].
      *               ADDED USE OF NEW MA-STATUS-INFO FIELDS; AS WELL AS
      *               ADDED USE OF NEW ROUTINES [LIBLA/LAFRMA & LAWSMA].
      * BLM 160726 IF GP-I-AM-WORLD & CD-COMM-PERCENT = 99.99, FORCE THE
      *            PAYABLE PERCENT TO 100, FOR LIVE CHECKS, WORLD PR# 1170
      * KEC 2016.0818 REMOVED USE OF THE BA-FILE [LIBLA/LAFDMX].
      *               REVISED LA-REC LAYOUT.
      * MJD 160824 ADDED LC-CALC-HI-CREDIT = "L"              61000/1180
      *  CS 160830 CHANGED TEST ON SAVE-DT-SEQ < 9999 TO < 999, SAVE-DT-SEQ
      *            IS MOVED TO DT-SEQ WHICH IS ONLY 9(3), CHANGED SAVE-DT-SEQ
      *            FROM PIC 9(4) TO PIC 9(3)
      * KEC 2016.0914 SET LR-BRNO USING LN-OWNBR.
      * BAH 2016.1205 ADDED UPDATE-LTR1-FILE
      * KEC 2017.0105 CHANGED DS-DATE TO DS-DATE-CCYYMM FOR CONSISTENCY
      *               WITH THE DATE FIELDS IN BY & UD FILE.
      * KEC 2017.0119 CHANGED FD-SMARTPORT TO FD-OPTION [88 LEVELS].
      *               (BLM REDID THIS CHANGE AFTER COPYING FROM A39)
      * BLM 2017.0427 ACTIVATE 8 DIGIT DATES
      * BLM 2018.0228 FIX TO UPDATE TY-FEE TABLE INSTEAD OF TY-INS TABLE
      *               FOR NONFILE, AD&D AND ROADGARD
      * KEC 2018.0824 LOAN APP MODULE REMOVAL FROM A30 [LARM30]
      * BAH 2019.0311 MOVED FM-BRNO2 INTO LPWSFM-EDIT-FM-INITKEY TO REMOVE THE
      *               REDEFINE IN THE FM-REC
      * BAH 2019.0402 SPLIT OUT TRFILE, TRCFILE TRSFILE
      *  CS 2019.0607 UPDATE-LXE,CLEAR LXE-EARN(4-7) AND FUTURE FIELDS ON WRITE
      *            CHANGED EARNING-WK OCCURANCES TO 10.EARNING-WK POPULATED BY
      *            MOVE OF LN-ANTICERN().  THE CLEAR OF THE LOAN SET LN-ANTICERN
      *            (7-10) TO 0. STILL MUST CLEAR FUTURE FIELDS BEFORE WRITE.
      *            INSTEAD OF MOVING 0 TO LXE-EARN(7-10), MOVING EARN-WK(7-10)
      *            SHOULD BE 0 NOW, BUT WHEN WE ADD ADDITIONAL EARNINGS 
      *            COMPONENTS SHOULD BE SET UP CORRECTLY
      *            CHANGED EARNING-WK TO S9(7)V99 FROM S9(5) TO MATCH LXE
      * BAH 2019.0613 ADDED CLEAR-FM-FILE (LPFMCL) AND SET FM-USERID
      * BAH 2019.0625 REMOVED GB-NEXT-SF-REVOL GB-NEXT-LN-REVOL PT0153
      * BAH 2019.0625 REMOVED LN-REVOLVING, PT0153
      * BAH 2019.0702 REMOVED BR-USE-PARTIC-FLAT-TABLE PT0051
      * BAH 2019.0703 REMOVED LTR PT0150
      * BAH 2019.0709 REMOVED GP-LR-TRAILER-TRIAD, PT0151 
      * BAH 2019.0719 ADDED CLEAR-LTF-FILE (LPLTFCL) FUTURE FIELDS NOT SET
      * BAH 2019.0719 ADDED CLEAR-LTA-FILE (LPLTACL) FUTURE FIELDS NOT SET
      * BAH 2019.0919 REMOVED ACCESS-CALL ON FMFILE
      * BAH 2020.0617 CHANGED PC-LT-RECORD TO PC-LTA-RECORD
      * BAH 2020.0615 ADDED OPEN-IC1-FILE AND CLOSE-IC1-FILE, REMOVED FROM
      *               LPIEXP COPY MEMBER #TST001
      * BAH 2020.0707 REMOVED CLOSE-BR-FILE, LEAVE OPEN #TST001
      * BLM 2021.0920 MOVE BX-PATH-OWNBR TO BX-BRNO BEFORE WRITING BX
      * BAH 2022.0422 UPDATE TS-ACTIONCD2, SECURITIZATION #1551
      * BAH 2022.0823 HARD CODED START
      * BAH 2024.0130 CALL CRNOR2 AND WRITE NOTICE RECORD
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. 3B.
       OBJECT-COMPUTER. 3B.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
       COPY "LIBLP/LPFSWK.CPY".

      *    SELECT ARCH-LN-FILE ASSIGN TO LN-ARCHIVE-PATH
      *           ORGANIZATION INDEXED
      *           ACCESS DYNAMIC
      *           LOCK MODE AUTOMATIC WITH LOCK ON RECORD
      *           RECORD KEY ARCH-LN1-KEY
      *           ALTERNATE RECORD KEY ARCH-LN3-KEY
      *                              = ARCH-LN-OWNBR
      *                                ARCH-LN-CLASS
      *                                ARCH-LN-ACCTNO
      *                                        WITH DUPLICATES
      *           ALTERNATE RECORD KEY ARCH-LN4-KEY WITH DUPLICATES
      *           ALTERNATE RECORD KEY ARCH-LN5-KEY WITH DUPLICATES
      *           ALTERNATE RECORD KEY ARCH-LN6-KEY WITH DUPLICATES
      *           ALTERNATE RECORD KEY ARCH-LN7-KEY WITH DUPLICATES
      *           FILE STATUS FILE-STAT.

       I-O-CONTROL.
       DATA DIVISION.
       FILE SECTION.

       COPY "LIBLP/LPFDWK.CPY".

      ********************************************************************
      *   ARCHIVED LOAN MASTER FILE
      ********************************************************************
      *FD  ARCH-LN-FILE
      *    LABEL RECORDS ARE STANDARD.
      *COPY "LIBLP/LP01LN.CPY" REPLACING LEADING "LN" BY "ARCH-LN"
      *                              TRAILING "STFG" BY "ARCH-LN-STFG".


       WORKING-STORAGE SECTION.
       77  SCCS-IDENTIFIER PIC X(43) VALUE
           "@(#)./LP/LONPB2.CBL S34 09/20/21-15:31:13 >".
      **********************************
      *       F I L E   I F N          *
      **********************************
       COPY "LIBGB/GB01GB.CPY".
       COPY "LIBGB/GB01GB_SQL.CPY".
       COPY "LIBGB/GBWSGB.CPY".
       COPY "LIBGB/GB01BR.CPY".
       COPY "LIBGB/GB01BR_SQL.CPY".
       COPY "LIBGB/GBWSBR.CPY".
       COPY "LIBLP/LP01LX.CPY".
       COPY "LIBLP/LP01LX_SQL.CPY".
       COPY "LIBLP/LPWSLX.CPY".
       COPY "LIBLP/LP01LXE.CPY".
       COPY "LIBLP/LP01LXE_SQL.CPY".
       COPY "LIBLP/LPWSLXE.CPY".
       COPY "LIBLP/LP01LC.CPY".
       COPY "LIBLP/LP01LC_SQL.CPY".
       COPY "LIBLP/LPWSLC.CPY".
       COPY "LIBLP/LP01DL.CPY".
       COPY "LIBLP/LP01DL_SQL.CPY".
       COPY "LIBLP/LPWSDL.CPY".
       COPY "LIBLP/LP01LN.CPY".
       COPY "LIBLP/LP01LN_SQL.CPY".
       COPY "LIBLP/LPWSLN.CPY".
       COPY "LIBLP/LP01LM.CPY".
       COPY "LIBLP/LP01LM_SQL.CPY".
       COPY "LIBLP/LPWSLM.CPY".
       COPY "LIBLP/LP01LP.CPY".
       COPY "LIBLP/LP01LP_SQL.CPY".
       COPY "LIBLP/LPWSLP.CPY".
       COPY "LIBLP/LP01NO.CPY".
       COPY "LIBLP/LP01NO_SQL.CPY".
       COPY "LIBLP/LPWSNO.CPY".
       COPY "LIBLP/LP01SP.CPY".
       COPY "LIBLP/LP01SPA.CPY".
       COPY "LIBLP/LP01SPB.CPY".
       COPY "LIBLP/LP01SPC.CPY".
       COPY "LIBLP/LP01SP_SQL.CPY".
       COPY "LIBLP/LPWSSP.CPY".
       COPY "LIBLP/LP01BW.CPY".
       COPY "LIBLP/LP01BW_SQL.CPY".
       COPY "LIBLP/LPWSBW.CPY".
       COPY "LIBLP/LP01BX.CPY".
       COPY "LIBLP/LP01BX_SQL.CPY".
       COPY "LIBLP/LPWSBX.CPY".
       COPY "LIBLP/LP01TY.CPY".
       COPY "LIBLP/LP01TY_SQL.CPY".
       COPY "LIBLP/LPWSTY.CPY".
       COPY "LIBLP/LP01CD.CPY".
       COPY "LIBLP/LP01CD_SQL.CPY".
       COPY "LIBLP/LPWSCD.CPY".
       COPY "LIBLP/LP01CDB.CPY".
       COPY "LIBLP/LP01CDB_SQL.CPY".
       COPY "LIBLP/LPWSCDB.CPY".
       COPY "LIBLP/LP01DS.CPY".
       COPY "LIBLP/LP01DS_SQL.CPY".
       COPY "LIBLP/LPWSDS.CPY".
       COPY "LIBLP/LP01PD.CPY".
       COPY "LIBLP/LP01PD_SQL.CPY".
       COPY "LIBLP/LPWSPD.CPY".
       COPY "LIBLP/LP01PC.CPY".
       COPY "LIBLP/LP01PC_SQL.CPY".
       COPY "LIBLP/LPWSPC.CPY".
       COPY "LIBLP/LP01CX.CPY".
       COPY "LIBLP/LP01CX_SQL.CPY".
       COPY "LIBLP/LPWSCX.CPY".
       COPY "LIBLP/LP01DT.CPY".
       COPY "LIBLP/LP01DT_SQL.CPY".
       COPY "LIBLP/LPWSDT.CPY".
       COPY "LIBLP/LP01FD.CPY".
       COPY "LIBLP/LP01FD_SQL.CPY".
       COPY "LIBLP/LPWSFD.CPY".
       COPY "LIBLP/LP01FM.CPY".
       COPY "LIBLP/LP01FM_SQL.CPY".
       COPY "LIBLP/LPWSFM.CPY".
       COPY "LIBLP/LP01CK.CPY".
       COPY "LIBLP/LP01CK_SQL.CPY".
       COPY "LIBLP/LPWSCK.CPY".
       COPY "LIBLP/LP01IC.CPY".
       COPY "LIBLP/LP01IC_SQL.CPY".
       COPY "LIBLP/LPWSIC.CPY".
       COPY "LIBLP/LP01LTF.CPY".
       COPY "LIBLP/LP01LTF_SQL.CPY".
       COPY "LIBLP/LPWSLTF.CPY".
       COPY "LIBLP/LP01LTA.CPY".
       COPY "LIBLP/LP01LTA_SQL.CPY".
       COPY "LIBLP/LPWSLTA.CPY".
       COPY "LIBLP/LP01LTC.CPY".
       COPY "LIBLP/LP01LTC_SQL.CPY".
       COPY "LIBLP/LPWSLTC.CPY".
       COPY "LIBLP/LP01LTB.CPY".
       COPY "LIBLP/LP01LTB_SQL.CPY".
       COPY "LIBLP/LPWSLTB.CPY".
       COPY "LIBLP/LP01LTP.CPY".
       COPY "LIBLP/LP01LTP_SQL.CPY".
       COPY "LIBLP/LPWSLTP.CPY".
       COPY "LIBLP/LP01LTI.CPY".
       COPY "LIBLP/LP01LTI_SQL.CPY".
       COPY "LIBLP/LPWSLTI.CPY".
       COPY "LIBLP/LPWSIX.CPY".
       COPY "LIBLP/LP01TRS.CPY".
       COPY "LIBLP/LP01TRS_SQL.CPY".
       COPY "LIBLP/LPWSTRS.CPY".
       COPY "LIBLP/LP01TRC.CPY".
       COPY "LIBLP/LP01TRC_SQL.CPY".
       COPY "LIBLP/LPWSTRC.CPY".
       01  HOLD-FM-PATH    PIC X(50) VALUE SPACES.
       01  WK-IFN          PIC X(2) VALUE "WK".
       01  WK-KEY          PIC 9(2).

      *THIS TABLE IS POPULATED MY MOVE OF LN-ANTICERN 1-6, 1-3 ARE MOVED 
      *TO LN, 4-6 TO LXE,A32 LXE-EARN OCCURS 7 TIMES.
       01  EARNING-WK-TAB  VALUE ZEROS.
           03  EARNING-WK  OCCURS 10 TIMES
                           PIC S9(7)V99.

       01  FEE-UNEARN      PIC S9(7)V99 VALUE 0.

       01  MISC-INS-WORKERS.
           03  ADD-WRITTEN         PIC X(01)   VALUE "N".
           03  ROADGARD-WRITTEN    PIC X(01)   VALUE "N".
           03  NON-FILE-WRITTEN    PIC X(01)   VALUE "N".


       01  WSEL-LIST       PIC X(5)    VALUE "WSEL.".
       01  MSEL-LIST       PIC X(5)    VALUE "MSEL.".

       01  NO-CREATE-FG    PIC 9.
       01  SAVE-NO-REC     PIC X(NO-SIZE).
       01  FM-SUB          PIC 9(6) COMP.
       01  SUB-LT          PIC 9(6) COMP-3.
       01  WRITE-THE-LT    PIC X.
       01  SAVE-CK-FMNO    PIC 9(4) VALUE 0.
       01  SUB             PIC 9(6) COMP.
       01  SUB1            PIC 9(6) COMP.
       01  SUB2            PIC 9(6) COMP.
       01  E-SUB           PIC 99   COMP.
       01  NO1-EXISTS      PIC X.
       01  REC-EXISTS      PIC X       VALUE "N".
       01  LOAN-RENEWAL    PIC X       VALUE "N".
       01  WK-REASON.
           03  FILLER      PIC X(13).
           03  WK-WHO      PIC X(17).
       01  SAVE-OUTBAL     PIC S9(7)V99  COMP VALUE 0.
       01  NON-MEMO-CHGS   PIC 9(6)V99   COMP.
       01  NOT-OUR-CHGS    PIC 9(6)V99   COMP.
       01  OUR-CHGS        PIC 9(6)V99   COMP.
       01  INS-COMM        PIC S9(7)V99  COMP.

       01  SAVE-PRLNNO      PIC 9(10).

       01  SAVE-LP1-KEY.
           03  SAVE-LP-BRNO   PIC 9(4).
           03  SAVE-LP-ACCTNO PIC 9(8).
           03  SAVE-LP-SEQNO  PIC 9(5).
       01  SAVE-CX1-KEY.
           03  SAVE-CX-BRNO   PIC 9(4).
           03  SAVE-CX-TYPE   PIC X(2).
           03  SAVE-CX-SEQNO  PIC 9(4).

       01  SAVE-DT-SEQ        PIC 9(3).
       01  SAVE-TS-LINE       PIC 999.
       01  SAVE-DLPAID        PIC X.
       01  HOLD-MA-ACCTNO     PIC 9(8).
       01  HOLD-LM1-KEY       PIC X(23).
       01  HOLD-LM-SEQ        PIC 9(3) VALUE 0.
       01  HOLD-BW-ZIP        PIC X(10) VALUE SPACES.
       01  HOLD-BW-NAME       PIC X(17) VALUE SPACES.
       01  HOLD-BW-FIRST-LAST PIC X(32) VALUE SPACES.
       01  S-LNS-FREE-WK-RECS PIC 99 VALUE 10.
       01  SAVE-WK-KEY        PIC 9(6).
       01  FIRST-CHECK        PIC X VALUE "Y".
       01  CHECK-TOTAL        PIC S9(6)V99 VALUE 0.

       01  DISPLAY-LOAN-NO.
           03  FILLER      PIC X(15)   VALUE
               " LOAN NUMBER:".
           03  DISP-LNNO   PIC ZZZZZZ.

       01  PRIOR-DLPOOL          PIC 9(5) COMP-3   VALUE 0.
       01  PRIOR-BNKRPTDATE      PIC 9(8) COMP     VALUE 0.
       01  PRIOR-CONFIDENTCD     PIC X             VALUE " ".
       01  PRIOR-DLDISC-UNEARN   PIC S9(7)V99 COMP VALUE 0.
       01  WS-MEMO-APPROVAL.
           03  WS-MEMO-APPROVAL-LIMIT  PIC $$$$$$9.
           03  FILLER                  PIC X(13) VALUE
               " APPROVED BY ".
           03  WS-MEMO-APPROVAL-USERID PIC X(10).
       01  HOLD-COMM-PERCENT     PIC 999V99 VALUE 0.

       COPY "LIBLP/LPIEXPW.CPY".
       COPY "LIBLP/LPWKPATH.CPY".
       COPY "LIBGB/CONNECTW_SQL.CPY".
       COPY "LIBGB/FILEWK.CPY".
       COPY "LIBGB/MESSWK.CPY".
       COPY "LIBCL/CREAIXW.CPY".
       COPY "LIBGB/DATERW.CPY".
       COPY "LIBLP/SETCTBLW.CPY".
       COPY "LIBGB/REBATEW.CPY".
       COPY "LIBLP/LPITRMW.CPY".
       COPY "LIBGB/SPPDTHW.CPY".
       COPY "LIBGB/AGEINGW.CPY".
       COPY "LIBLP/LPAMTSW.CPY".
       COPY "LIBLP/LPUERNW.CPY".
       COPY "LIBLP/LPEARNW.CPY".
       COPY "LIBLP/LPCERNW.CPY".
       COPY "LIBLP/LPREGZW.CPY".
       COPY "LIBLP/LPXDTEW.CPY".
       COPY "LIBLP/LPPOFFW.CPY".
       COPY "LIBLP/LPEADJW.CPY".
       COPY "LIBCL/CRNOR2W.CPY".
       COPY "LIBLP/LPRATEW.CPY".
       COPY "LIBLP/LPIBPCW.CPY".
       COPY "LIBLP/LPMDTEW.CPY".
       COPY "LIBLP/LPCEPPW.CPY".
       COPY "LIBLP/LPMENUW.CPY".
       COPY "LIBLP/LPAPRSW.CPY".
       COPY "LIBLP/LPAPRZW.CPY".
       COPY "LIBLP/LPUPERW.CPY".
       COPY "LIBLP/LPUPWKW.CPY".
       COPY "LIBLP/LPSETTYW.CPY".
       COPY "LIBLP/LPDSCLW.CPY".
       COPY "LIBLP/POSTDATEW.CPY".
       COPY "LIBGB/GETENVW.CPY".
       COPY "LIBLP/LPSRCDW.CPY".
       COPY "LIBGB/RBACTW.CPY".
       COPY "LIBGB/GPENVW.CPY".
       COPY "LIBGB/ACCESSW.CPY".
       COPY "LIBGB/DACCESSW.CPY".
       COPY "LIBGB/SYSTEMW.CPY".
       COPY "LIBLP/LPPDUEW.CPY".
       COPY "LIBLP/LNCOSTW.CPY".

       COPY "LIBGB/SCREENW.CPY".
       COPY "LIBLP/LONPB_DEF.CPY".
       COPY "LIBGB/CONAME_EXT.CPY".
       COPY "LIBLP/LONPB_WKS.CPY".
       COPY "LIBGB/HELPLINK.CPY".

       COPY "LIBGB/GETFMW.CPY".
       COPY "LIBLP/LPLOANW.CPY".
       COPY "LIBLP/LPPFBUF.CPY".

       SCREEN SECTION.
       COPY "LIBLP/LONPB_SCN.CPY".

       PROCEDURE DIVISION
           USING FORM-PATHNAME EXIT-PATHNAME PROG-BUF UPDATE-BUF.
       DECLARATIVES.
       DECLARE-ERROR SECTION.
           USE AFTER ERROR PROCEDURE ON
               WK-FILE.
       COPY "LIBGB/DECLARE.CPY".
           PERFORM CLOSE-TY1-FILE.
           PERFORM CLOSE-TRS1-FILE.
           PERFORM CLOSE-TRC1-FILE.
           PERFORM CLOSE-SP1-FILE.
           PERFORM CLOSE-PD1-FILE.
           PERFORM CLOSE-PC1-FILE.
           PERFORM CLOSE-NO1-FILE.
           PERFORM CLOSE-LXE1-FILE.
           PERFORM CLOSE-LX1-FILE.
           PERFORM CLOSE-LTP1-FILE.
           PERFORM CLOSE-LTI1-FILE.
           PERFORM CLOSE-LTF1-FILE.
           PERFORM CLOSE-LTC1-FILE.
           PERFORM CLOSE-LTB1-FILE.
           PERFORM CLOSE-LTA1-FILE.
           PERFORM CLOSE-LP1-FILE.
           PERFORM CLOSE-LN1-FILE.
           PERFORM CLOSE-LM1-FILE.
           PERFORM CLOSE-LC1-FILE.
           PERFORM CLOSE-IC1-FILE.
           PERFORM CLOSE-FM1-FILE.
           PERFORM CLOSE-FD1-FILE.
           PERFORM CLOSE-DT1-FILE.
           PERFORM CLOSE-DS1-FILE.
           PERFORM CLOSE-DL1-FILE.
           PERFORM CLOSE-CX1-FILE.
           PERFORM CLOSE-CK1-FILE.
           PERFORM CLOSE-CDB1-FILE.
           PERFORM CLOSE-CD1-FILE.
           PERFORM CLOSE-BX1-FILE.
           PERFORM CLOSE-BW1-FILE.
           PERFORM CLOSE-GB-FILE.
           PERFORM CLOSE-BR-FILE.
           CLOSE WK-FILE.
       COPY "LIBGB/DECLAR2.CPY".

      ***********************************
      *    C O N T R O L   M O D U L E   *
      ***********************************
       MAIN-PROGRAM SECTION.

           PERFORM SQL-CONNECT.

      D    STOP MESS.
           MOVE FORM-PATHNAME TO FORM-PATH.

      *    IF LPLOAN-CALLED-FROM = "LNCREA"
      *       PERFORM SETUP-LOCAL-PATHS.

           MOVE USER-PID TO TEMP-PID.

      *    IF LPLOAN-CALLED-FROM = "LNCREA"
      *       PERFORM LOAD-TRC1-FILE
      *       PERFORM LOAD-TRS1-FILE.

           MOVE "UPDATING LOAN MASTER...................." TO MESS.
           PERFORM SEND-LEGEND.

           MOVE 1 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           MOVE WK-SAVE-REC TO LN-REC.

      *-JTG 100396--UPDATE BI-------<<<<<<<<<<<TEMPORARY>>>>>>>>>>>>>>>
           MOVE WK-SAVE-REC TO HOLD-LN-REC.
      *-JTG 100396--UPDATE BI-------<<<<<<<<<<<TEMPORARY>>>>>>>>>>>>>>>

           MOVE WK-APPROVAL-LIMIT  TO WS-MEMO-APPROVAL-LIMIT.
           MOVE WK-APPROVAL-USERID TO WS-MEMO-APPROVAL-USERID.

           PERFORM OPEN-GB-FILE.
           MOVE LN-OWNBR TO GB-BRNO.
           MOVE 1        TO GB-NO.
           PERFORM READ-GB-FILE.
           PERFORM CLOSE-GB-FILE.

           MOVE LN-OWNBR TO BR-NO.
           PERFORM OPEN-BR-FILE.
           PERFORM READ-BR-FILE.

      * GET GLOBAL PARAMETER RECORD (FROM GPENV):
           PERFORM GET-GPENV.

           MOVE LN-CLASS TO LC-CODE.
           PERFORM OPEN-LC1-FILE.
           PERFORM READ-LC1-FILE.
           PERFORM CLOSE-LC1-FILE.

      * GET SPR RECORD:
           MOVE LN-SPRCLASS TO SP-SPRCLASS.
           MOVE LN-SUBCLASS TO SP-SUBCLASS.
           MOVE LN-LAWCODE TO SP-LAWCODE.
           MOVE LN-ORGST TO SP-ORGST.
           PERFORM OPEN-SP1-FILE.
           PERFORM READ-SP1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           PERFORM CLOSE-SP1-FILE.


      * PRLNNO AN INPUT FIELD
           MOVE 0 TO PRIOR-BNKRPTDATE.

           IF LN-PRLNNO NOT = 0
              IF (LN-SRCD = "RN" OR "PB" OR "RB" OR "RO")
                       AND (NOT LN-POCD-INRESCISSION)
                 MOVE "Y" TO LOAN-RENEWAL
                 MOVE LN-PRLNNO TO SAVE-PRLNNO
                 PERFORM SET-PD1-KEY
                 PERFORM OPEN-PD1-FILE
                 PERFORM READ-PD1-FILE
                 PERFORM CLOSE-PD1-FILE
                 IF IO-FG = 0
                    MOVE PD-DLPOOL TO PRIOR-DLPOOL
                    MOVE PD-BNKRPTDATE TO PRIOR-BNKRPTDATE
                    MOVE PD-CONFIDENTCD TO PRIOR-CONFIDENTCD
                    MOVE PD-PRDLDISC-UNEARN TO PRIOR-DLDISC-UNEARN
                 ELSE
                    MOVE "RENEWAL RECORD DELETED !" TO MESS
                    PERFORM CONDITIONAL-SEND-MESS
                    GO TO IO-ERROR.

           MOVE LN-DLNO TO DL-DLNO.
           PERFORM OPEN-DL1-FILE.
           PERFORM READ-DL1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           PERFORM CLOSE-DL1-FILE.

           PERFORM UPDATE-LN1-FILE.
           IF LN-PRLNNO NOT = 0
              PERFORM UPDATE-LT1-BNKRPT
              PERFORM UPDATE-LM1-BNKRPT.

           PERFORM SET-DELINQUENCY.

           PERFORM UPDATE-TRS-FILE.

           PERFORM UPDATE-NOTICE-FILE.

           PERFORM UPDATE-LP1-FILE.
           PERFORM UPDATE-LXE-FILE.
           PERFORM UPDATE-LT1-FEE-FILE.

           IF LN-MIP-FG = "Y"
              PERFORM UPDATE-LXM-FILE.

           PERFORM UPDATE-BW1-FILE.
           PERFORM UPDATE-BX1-FILE.

           IF WK-DLPAID = "B"
              PERFORM UPDATE-DT-BATCH.

           PERFORM UPDATE-FM1-FILE.
           IF WK-DLPAID NOT = "B"
              PERFORM CHECK-UPD.

           PERFORM UPDATE-DS1-FILE.
           PERFORM UPDATE-TY1-FILE.

           MOVE LN-ACCTNO TO DISP-LNNO.
           MOVE DISPLAY-LOAN-NO TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.

           PERFORM UPDATE-LTC1-FILE.
           PERFORM UPDATE-LT1-A-FILE.

      * CREATE MEMO TO DOCUMENT WHO APPROVED LOAN & CREDIT LIMIT
           IF GP-APPROVAL-MEMO = "Y"
              PERFORM UPDATE-LM-APPROVAL.

      * REGACC, UPDATE DEALER ACH FAX NOTIFICATION FILE:
      *    IF GP-I-AM-REGACC
      *       IF DL-ACH-FG = "Y"
      *          IF WK-DLPAID = "B"
      *             PERFORM UPDATE-DN-FILE.

           IF LOAN-RENEWAL NOT = "Y"
              GO TO UPDATES-COMPLETE.

      * REMOVE SCRATCH PAD RECORD:
           PERFORM OPEN-PD1-FILE.
           PERFORM SET-PD1-KEY.
           PERFORM READ-PD1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PD1-FILE
           ELSE
              MOVE "SCRATCH PAD RECORD NOT FOUND" TO MESS
              PERFORM CONDITIONAL-SEND-MESS.

           MOVE "L"        TO PD-ID.
           MOVE BRANCH     TO PD-BRANCH.
           MOVE LN-SSNO(1) TO PD-SOC-SEC.
           PERFORM READ-PD1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PD1-FILE.
           PERFORM CLOSE-PD1-FILE.

      * REMOVE SCRATCH COLLATERAL RECORD:
           PERFORM OPEN-PC1-FILE.
           MOVE "C"        TO PC-ID.
           MOVE BRANCH     TO PC-BRANCH.
           MOVE LN-SSNO(1) TO PC-SOC-SEC.
           PERFORM READ-PC1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PC1-FILE.
           PERFORM CLOSE-PC1-FILE.

       UPDATES-COMPLETE.

           MOVE 1 TO WK-KEY.
           PERFORM READ-WK-FILE.
           MOVE SPACES TO WK-SAVE-REC.
           MOVE 0 TO WK-ELE.
           PERFORM REWRITE-WK-FILE.

           IF DT-PAID = "S" OR BR-IMMEDIATE-DOC-PRINT = "Y"
              MOVE " " TO ERRCD
              MOVE MENU-PROG-FORM(2) TO OLD-PROG-FORM
              MOVE MENU-PROG-FORM(7) TO NEW-PROG-FORM
           ELSE
              MOVE "P" TO ERRCD
              MOVE MENU-PROG-FORM(2) TO NEW-PROG-FORM.

           GO TO END-ROUTINE.

      ****************************************************
       UPDATE-LN1-FILE SECTION.
      ****************************************************
           PERFORM OPEN-LN1-FILE.

      *    IF GP-PURGE-TO-ARCHIVE-FG = "Y"
      *       PERFORM SETUP-LN-ARCHIVE-PATH.

           PERFORM GET-ACCOUNT-NUMBER.

      * SET DEFAULT POOLID FROM CLASS FILE MERC(03/16/01)
           IF NOT (LC-POOLID = 20202 OR 02020)
              MOVE LC-POOLID TO LN-DLPOOL.

           MOVE TRANS-DATE  TO LN-ENTDATE.
           MOVE LN-LNAMT    TO LN-CURBAL.
           MOVE SP-JUDGRATE TO LN-JDRATE.

      * SET MIP INFO (MONTHLY INSURANCE PREMIUMS)
           IF SP-INS-MIP(1) OR SP-INS-MIP(2) OR
                 SP-INS-MIP(3) OR SP-INS-MIP(4)
              IF LN-INSTYPES-LL OR LN-INSTYPES-DL
                 MOVE LN-1STPYDATE TO PDTH-DATE-WORK
                 PERFORM PAID-THRU-CALCULATION
                 MOVE "Y" TO LN-MIP-FG
                 MOVE PDTH-DATE-FULL TO LN-MIP-CLPDTH-DATE
                 MOVE "M" TO LN-INSOURS(1).

           IF SP-INS-MIP(5) AND LN-INSTYPES-AH
              MOVE "Y" TO LN-MIP-FG
              MOVE PDTH-DATE-FULL TO LN-MIP-AHPDTH-DATE
              MOVE "M" TO LN-INSOURS(2).

      * TOTAL-REPAY TOTAL-NOTE PRINCIPLE
           PERFORM LOAN-CALCULATIONS.

      * TAKE EARNINGS UP FRONT
      * SET UP EARN ORDER FORM SPR'S
           IF LN-SERVACCT = "Y"
              MOVE SP-EARN-ORDER(1) TO LN-EARN-ORDER(1)
              MOVE SP-EARN-ORDER(2) TO LN-EARN-ORDER(2)
              MOVE SP-EARN-ORDER(3) TO LN-EARN-ORDER(3)
              MOVE SP-EARN-ORDER(4) TO LN-EARN-ORDER(4)
              MOVE SP-EARN-ORDER(5) TO LN-EARN-ORDER(5)
              MOVE SP-EARN-ORDER(6) TO LN-EARN-ORDER(6)
              GO TO UPD-INTYTD.

      * DETERMINE LOAN COSTS FOR ALL BUT SERVICE ACCOUNTS:
           IF SP-LNCOST-FRMLA NOT = "D"
              MOVE LN-LNAMT      TO LNCOST-LNAMT
              MOVE LN-DLPARVHELD TO LNCOST-DLPARVHELD
              MOVE LN-DLPARVPAID TO LNCOST-DLPARVPAID
              PERFORM COMPUTE-LOANCOST
              MOVE LNCOST-LOANCOST TO LN-ANTICERN(6)
              IF SP-LNCOST-FRMLA = "4"
                 MOVE LN-DLPARVPAID TO LN-ANTICERN(3)
              ELSE
              IF SP-LNCOST-FRMLA = "5"
                 MOVE LN-DLPARVPAID TO LN-ANTICERN(4).

      * UPDATE CD-GC-FEE-EARNINGS-FG FEES INTO ANTIC/UNEARNED INTO
      * LOAN ADDON ANTICIPATED:

           PERFORM UPDATE-LN1-FEEUNERN.
           MOVE FEE-UNEARN TO LN-ANTICERN(2).

           PERFORM COMPUTE-UERNINGS.
           MOVE 1 TO SUB.
           PERFORM SET-EARNINGS 6 TIMES.

      * UPDATE INTEREST PAID
      * NEED TO TAKE UPFRONT SERVICE CHARGE FOR IB'S
       UPD-INTYTD.
           IF SP-1098FRMLA = " " OR "B"
              COMPUTE LN-YTDINTPD = LN-ACCERN(1) + LN-ACCERN(2)
                                  + LN-ACCERN(3) + LN-ACCERN(4)
              MOVE LN-YTDINTPD TO LN-TOTINTPD.

      * UPDATE LATE CHARGE PAID THRU
           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.
           PERFORM PAID-THRU-CALCULATION.
           MOVE PDTH-DATE-FULL TO LN-LCPDTH-DATE.

      * UPDATE PRIOR LOAN INFO
           IF LOAN-RENEWAL = "Y"
              MOVE PD-PRBAL TO LN-PRBAL
              MOVE PD-PRINTDUE TO LN-PRINTDUE
              MOVE PD-PRFINCHGRB TO LN-PRFINCHGRB
              MOVE PD-PRINSRB TO LN-PRINSRB
              MOVE PD-PRPOCD TO LN-PRPOCD
              MOVE PD-PRPODATE TO LN-PRPODATE
              MOVE PD-PRCONPROFILE TO LN-PRCONPROFILE
              MOVE PD-PRDELINQAMT TO LN-PRDELINQAMT
              MOVE PD-PRLNAMT TO LN-PRLNAMT
              MOVE PD-PRPDUE-DAYS TO LN-PRPDUE-DAYS
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  JTG 040513 ADDED LOGIC TO CAUSE THE UNEARNED LOAN COST TO ROLL TO
      *             THE NEW LOAN AFTER 'RENEWAL'. NOTE: THIS COST IS REFLECTIVE
      *             OF THE DISCOUNT WHEN PURCHASING LOAN PAPER NOT CARRIED AS
      *             SALES PAPER WITH DEALER DISCOUNT.
      *             ADDED SP-LNCOST-FRMLA = 'R'                    REGENCY #2287
      *       NOTE: LN-PRDLDISC-UNEARN WILL HOLD THE COST (DISCOUNT)
      *             FOR DIRECT LOANS, EVEN THOUGH IT IS NOT TIED TO A DEALER.
      *
      *       WHEN SP-LNCOST-FRMLA = 'R'
      *            PRIOR-DLDISC-UNEARN IS CARRIED TO LN-ANTICERN(6)
      *   BUT WHEN
      *            GP-RENEW-DISC-UNERN FOR MERCURY
      *            PRIOR-DLDISC-UNEARN IS CARRIED TO LN-ANTICERN(5)
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
              MOVE PRIOR-DLDISC-UNEARN TO LN-PRDLDISC-UNEARN
              IF SP-LNCOST-FRMLA = "R"
      * CARRY OVER UNEARN LOAN COSTS (DISCOUNT)
      * AND ADD TO LN-ANTICERN(6):
                 ADD PRIOR-DLDISC-UNEARN TO LN-ANTICERN(6)
              ELSE
      * CARRY OVER UNEARN DEALER DISCOUNT AND ADD TO LN-ANTICERN(5):
                 ADD PRIOR-DLDISC-UNEARN TO LN-ANTICERN(5)
              END-IF
      * RETAIN CONFIDENTIAL STATUS:
              MOVE PRIOR-CONFIDENTCD TO LN-CONFIDENTCD
      * RETAIN DEALER POOL:
              MOVE PRIOR-DLPOOL TO LN-DLPOOL
      * RETAIN EXISTING BANKRUPT STATUS:
              IF PRIOR-BNKRPTDATE NOT = 0
                 MOVE PRIOR-BNKRPTDATE TO LN-BNKRPTDATE
                 MOVE "B" TO LN-STATUSFLAGS(1).
           IF LN-SERVACCT NOT = "Y"
              PERFORM COMPUTE-EARNINGS
              MOVE EARN-TOT-ACCERN TO LN-TOTERN LN-NONACRERN.

      * ESTABLISH CREDIT LIMIT
           IF BR-AVAIL-CREDIT = "Y" OR "S"
              IF LC-CALC-HI-CREDIT = " " OR "C" OR "L" OR "W"
                 PERFORM LOAN-CALCULATIONS
                 MOVE HIGH-CREDIT TO LN-CREDITLIM.

      * UPDATE INSURANCE EFF & EXP DATES & COMMISSION
      * MUST REMOVE 'M' MEMO FLAG SO AS TO COMPUTE
      * INSURANCE COMMISSION'S
           IF LN-MIP-FG = "Y"
              MOVE "Y" TO LN-INSOURS(1) LN-INSOURS(2).

           PERFORM OPEN-IC1-FILE.

           PERFORM VARYING IEXP-LN FROM 1 BY 1 UNTIL IEXP-LN > 8
              PERFORM IEXP-INS-CALCULATIONS
              MOVE IEXP-EFFDATE TO LN-INSEFF-DATE(IEXP-LN)
              MOVE IEXP-EXPDATE TO LN-INSEXP-DATE(IEXP-LN)
              IF NOT ( IEXP-LN = 6
                         AND (
                               (BR-SFDLO3-WINDOW-FG = "Y"
                                     AND LN-INSOURS(IEXP-LN) = "Y")
                                  OR
                                    (BR-SFDLO3-WINDOW-FG = "B")
                             )
                     )
                 MOVE IEXP-INSCOMM TO LN-INSCOMM(IEXP-LN)
              END-IF

      *- WHEN FLAT RATE APPLIED TO COMMISSION & BR-SFDLO3-WINDOW-FG IS 'N'
      *  WE WERE COMPUTING A COMMISSION
              IF LN-INSPREM(IEXP-LN) = ZEROS
                 MOVE ZEROS TO LN-INSCOMP(IEXP-LN)
                               LN-INSEFF-DATE(IEXP-LN)
                               LN-INSEXP-DATE(IEXP-LN)
                               LN-INSCOVR(IEXP-LN)
                               LN-INSPREM(IEXP-LN)
                               LN-INSCOMM(IEXP-LN)
                 MOVE SPACES TO LN-INSOURS(IEXP-LN)
              END-IF
           END-PERFORM.

           PERFORM CLOSE-IC1-FILE.

           IF LN-MIP-FG = "Y"
              MOVE "M" TO LN-INSOURS(1) LN-INSOURS(2).

      * GET SIMPLE AND EFFECTIVE RATES
           PERFORM APRS-RATE.
           MOVE APRS-SMPRATE TO LN-SMPRATE.
           MOVE APRS-EFFRATE TO LN-EFFRATE.

           IF SP-CAL-SET-EFFECTIVE(APRS-CTBL)
              MOVE LN-EFFRATE TO LN-OVRDRATE.

           IF SP-CAL-SET-SMPRATE-OVRRIDE(APRS-CTBL)
              MOVE LN-SMPRATE TO LN-OVRDRATE.

      * GET CORRECT YIELD RATES
           PERFORM COMPUTE-YIELD.
           MOVE APR-APR TO LN-YLDRATE.

      * GET IB EARNINGS FIELDS SP-ERNFRMLA = 15 & 16
           IF 15 = SP-ERNFRMLA(1) OR SP-ERNFRMLA(5)
              SUBTRACT LN-DLDISC FROM LN-LNAMT GIVING LN-ERN-IB-PRINBAL
              IF LN-LOANTYPE = "P"
                 SUBTRACT LN-INTCHG LN-EXTCHG FROM LN-ERN-IB-PRINBAL.

           IF SP-ERNFRMLA(5) = 16
              MOVE LN-LNAMT TO LN-ERN-IB-PRINBAL
              IF LN-LOANTYPE = "P"
                 SUBTRACT LN-INTCHG LN-EXTCHG FROM LN-ERN-IB-PRINBAL.

      * IF SPR'S INDICATE AMORTIZED INTEREST SET:
      *         LN-EXTRA-PRIN-LFP
      *         LN-REMAIN-INT-SINCE-LFP
      *         LN-REMAIN-PRIN-SINCE-LFP

           IF SP-CAL-AMORTIZED(CTBL-INDEX)
              PERFORM SET-INITIAL-AMORT-LFP.

      * ADDED GP-AMORTIZE-ACQUIST-FEE, THIS OPTION WILL TAKE THE
      * AMOUNT ENTERED IN RESERVE PRINCIPAL 3 AND MOVE IT TO
      * THE LOANS UNEARNED SERVICE CHARGE               REGACC #0081
           IF GP-AMORTIZE-ACQUIST-FEE = "Y"
              MOVE LN-DLRVPRIN(3) TO LN-ANTICERN(3).

      * REGACC, FLAG DEALER DIRECT DEPOSIT:
           IF DL-ACH-FG = "Y"
              IF WK-DLPAID = "B"
                 MOVE "A" TO LN-PROC-DISBURSED.

      * ACC PR# 2704
           IF GP-INTERIM-COUPONS = "Y"
              IF SP-INTERIM-COUPON = "Y"
                 MOVE "Y" TO LN-INTERIM-COUPON.

      * REGACC PR# 158
           MOVE BR-COUPON-STATEMENT TO LN-COUPON-STATEMENT.

           IF GP-DEFAULT-SKIP-TRW = "Y"
              MOVE GP-DEFAULT-SKIP-TRW TO LN-SKIP-TRW.

       WRITE-LOAN-REC.
           PERFORM WRITE-LN1-FILE.
           IF IO-FG = 0
              GO TO EXIT-UPDATE-LN1.

      * ASSIGN TO NEXT AVAILABLE ACCOUNT NUMBER:
           IF GB-NEXT-SF < 989999
              PERFORM GET-ACCOUNT-NUMBER
              GO TO WRITE-LOAN-REC.

           MOVE "GLOBAL LOAN COUNTER NOT < 990000 !" TO MESS
           PERFORM CONDITIONAL-SEND-MESS
           GO TO IO-ERROR.

       EXIT-UPDATE-LN1.
           PERFORM CLOSE-LN1-FILE.
           MOVE LN-ACCTNO TO LOAN-KEY HOLD-MA-ACCTNO.

      ******************************************************
      * READ FEES TALLYING ALL FEES FLAGGED AS EARNING TYPE
      * THAT OUR THE FINANCE COMPANIES FEES
      ******************************************************
      ******************************************************
       UPDATE-LN1-FEEUNERN SECTION.
      ******************************************************
           PERFORM OPEN-CDB1-FILE.

           MOVE 0 TO FEE-UNEARN.

           PERFORM VARYING SUB-LT FROM 1 BY 1 UNTIL SUB-LT > 10
              IF LN-FEECODE(SUB-LT) NOT = 0
                 MOVE "GC"               TO CDB-TYPE
                 MOVE LN-OWNBR           TO CDB-BRANCH
                 MOVE LN-FEECODE(SUB-LT) TO CDB-CODE
                 PERFORM READ-CDB1-FILE
                 IF ( IO-GOOD                  ) AND
                    ( CDB-GC-FEE-EARNINGS-FG = "Y" ) AND
                    ( LN-FEEOURS(SUB-LT) = "Y" )
                    ADD LN-FEEAMT(SUB-LT) TO FEE-UNEARN
                 END-IF
              END-IF
           END-PERFORM.

       EXIT-UPDATE-LN1-FEEUNERN.
           PERFORM CLOSE-CDB1-FILE.

      ******************************************************
       UPDATE-LT1-BNKRPT SECTION.
      ******************************************************

      * BRING FORWARD PRIOR LOAN BANKRUPT TRAILERS WITH NEW ACCOUNT

           PERFORM OPEN-LTB1-FILE.

           MOVE LN-OWNBR  TO LTB-BRNO.
           MOVE LN-PRLNNO TO LTB-ACCTNO.
           MOVE 1         TO LTB-SEQNO.
           PERFORM READ-LTB1-FILE.
           IF IO-FG = 0
              MOVE LN-OWNBR  TO LTB-BRNO
              MOVE LN-ACCTNO TO LTB-ACCTNO
              MOVE 1         TO LTB-SEQNO
              PERFORM WRITE-LTB1-FILE.

           PERFORM CLOSE-LTB1-FILE.

      ******************************************************
       UPDATE-LM1-BNKRPT SECTION.
      ******************************************************
           PERFORM OPEN-LM1-FILE.

           MOVE LM-PATH-OWNBR TO LM-BRNO
                                 QLM1-WBEG-BRNO
                                 QLM1-WEND-BRNO.
           MOVE LN-PRLNNO     TO LM-ACCTNO
                                 QLM1-WBEG-ACCTNO
                                 QLM1-WEND-ACCTNO.
           MOVE 0             TO LM-DATE
                                 QLM1-WBEG-DATE-REV.
           MOVE 0             TO LM-SEQ
                                 QLM1-WBEG-SEQ.
           MOVE ALL "9"       TO QLM1-WEND-DATE-REV
                                 QLM1-WEND-SEQ.
           COMPUTE QLM1-WSBEG-DATE-REV = LM-DATE-REVERSED + 1.

           MOVE LM1-KEY       TO HOLD-LM1-KEY.

           PERFORM START-LM1-FILE.

       UPDATE-LM1-BNKRPT-NEXT.
           PERFORM READ-LM1-FILE-NEXT.
           IF (IO-FG = 9) OR (LM-BRNO NOT = LM-PATH-OWNBR) 
                           OR (LM-ACCTNO NOT = LN-PRLNNO)
              GO TO UPDATE-LM1-BNKRPT-EXIT.

           IF (LM1-KEY = HOLD-LM1-KEY) OR (LM-MEMO-TYPE NOT = "B")
              GO TO UPDATE-LM1-BNKRPT-NEXT.

           MOVE LM1-KEY TO HOLD-LM1-KEY.

      * TAKE AN EXISTING MEMO RECORD AND REWRITE IT WITH A NEW ACCOUNT NO.
      * BRANCH WILL NOT CHANGE
           MOVE LN-ACCTNO TO LM-ACCTNO.
           PERFORM WRITE-LM1-FILE.

           GO TO UPDATE-LM1-BNKRPT-NEXT.

       UPDATE-LM1-BNKRPT-EXIT.
           PERFORM CLOSE-LM1-FILE.

      ******************************************************
       UPDATE-TRS-FILE SECTION.
      ******************************************************
           MOVE "UPDATING SALES TRANSACTION FILE.........." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-TRS1-FILE.
           MOVE 1 TO SAVE-TS-LINE.
       UPDATE-TRS-NEXT.
           PERFORM CLEAR-TRS-FILE.

           MOVE TRANS-DATE   TO TS-DATE.
           MOVE BRANCH       TO TS-BRNO.
      *    MOVE "S" TO TS-CODE.
           MOVE LN-CLASS     TO TS-CLASS.
           MOVE LN-ACCTNO    TO TS-ACCTNO.
           MOVE LN-LAWCODE   TO TS-LAWCODE.
           MOVE SAVE-TS-LINE TO TS-LINE.

           MOVE LN-LOANTYPE   TO TS-LOANTYPE.
           MOVE LN-LOANDATE   TO TS-LOANDATE.
           MOVE LN-INTDATE    TO TS-INTDATE.
           MOVE LN-PURCD      TO TS-PURCD.
           MOVE LN-SRCD       TO TS-SRCD.
           MOVE LN-COLLCD     TO TS-COLLCD.
           MOVE LN-ORGTERM    TO TS-ORGTERM.
           MOVE LN-DLRECOURSE TO TS-DLRECOURSE.
           MOVE LN-LNAMT      TO TS-LNAMT.
           MOVE LN-FINCHG     TO TS-FINCHG.
           MOVE LN-1STPYAMT   TO TS-1STPYAMT.
           MOVE LN-NOREGPY    TO TS-NOREGPY.
           MOVE LN-REGPYAMT   TO TS-REGPYAMT.
           MOVE LN-LASTPYAMT  TO TS-LASTPYAMT.
           MOVE LN-INSURED    TO TS-INSURED.

           MOVE LN-PRLNNO     TO TS-PRLNNO.
      *    MOVE LN-PRBAL TO TS-PRBAL.
      *    MOVE LN-PRINTDUE TO TS-PRINTDUE.
      *    MOVE LN-PRFINCHGRB TO TS-PRFINCHGRB.
      *    MOVE LN-PRINSRB TO TS-PRINSRB.

      * CARRY OVER UNEARN DEALER DISCOUNT:
           MOVE PRIOR-DLDISC-UNEARN TO TS-PRDLDISC-UNEARN.

           MOVE LN-DLNO        TO TS-DLNO.
           MOVE LN-DLDISC      TO TS-DLDISC.
           MOVE LN-DLRVPRIN(1) TO TS-DLRVPRIN(1).
           MOVE LN-DLRVPRIN(2) TO TS-DLRVPRIN(2).
           MOVE LN-DLRVPRIN(3) TO TS-DLRVPRIN(3).
           MOVE LN-DLRVCHGS(1) TO TS-DLRVCHGS(1).
           MOVE LN-DLRVCHGS(2) TO TS-DLRVCHGS(2).
           MOVE LN-DLRVCHGS(3) TO TS-DLRVCHGS(3).
           MOVE LN-DLPARVHELD  TO TS-DLPARVHELD.
           MOVE LN-DLPARVPAID  TO TS-DLPARVPAID.
           MOVE DL-RVCHGS-CODE(1) TO TS-DL-RVCHGS-CODE(1).
           MOVE DL-RVCHGS-CODE(2) TO TS-DL-RVCHGS-CODE(2).
           MOVE DL-RVCHGS-CODE(3) TO TS-DL-RVCHGS-CODE(3).
           MOVE DL-PARVHELD-CODE TO TS-DL-PARVHELD-CODE.
           IF LN-LOANTYPE = "P"
              MOVE DL-PARVPAID-CODE TO TS-DL-PARVPAID-CODE
           ELSE
              MOVE DL-PARVPAID-CODE-IB TO TS-DL-PARVPAID-CODE.
           MOVE LN-PROCEEDS TO TS-PROCEEDS.
           MOVE LN-PRLNNO TO TS-PRLNNO.
           MOVE LN-INSPREM-DLADJ TO TS-INSPREM-DLADJ.
           MOVE LN-SERVACCT TO TS-SERVACCT.
           MOVE LN-DLPARTRCAMT TO TS-DLPARTRCAMT.
           MOVE LN-PURBAL TO TS-PURBAL.
           MOVE LN-ANTICTERM TO TS-ANTICTERM.
           MOVE LN-MAINTFEE TO TS-MAINTFEE.
           MOVE LN-SERCHG TO TS-SERCHG.
           MOVE LN-EXTCHG TO TS-EXTCHG.
           MOVE LN-INSTYPES       TO TS-INSTYPES.
           MOVE LN-INSELIGIBLE    TO TS-INSELIGIBLE.
           MOVE LN-INTCHG         TO TS-INTCHG.
           MOVE LN-O3INS-DLPROC   TO TS-O3INS-DLPROC.

           MOVE SP-LNCOST-FRMLA   TO TS-SP-LNCOST-FRMLA.
           MOVE WK-DLPAID         TO TS-DLPAID.
           MOVE LN-DLCOMM-PP-CMSI TO TS-DLCOMM-PP-CMSI.
           MOVE LN-DLCOMM-O3-CMSI TO TS-DLCOMM-O3-CMSI.

           MOVE 1 TO SUB.
       UPDATE-TRS-NEXT-BORR.
           IF SUB NOT > 4
              MOVE LN-SSNO(SUB) TO TS-SSNO(SUB)
              MOVE LN-MAKERCD(SUB) TO TS-MAKERCD(SUB).
           IF SUB NOT > 8
              MOVE LN-INSCOMP(SUB)     TO TS-INSCOMP(SUB)
              MOVE LN-INSOURS(SUB)     TO TS-INSOURS(SUB)
              MOVE LN-INSEFF-DATE(SUB) TO TS-INSEFF-DATE(SUB)
              MOVE LN-INSEXP-DATE(SUB) TO TS-INSEXP-DATE(SUB)
              MOVE LN-INSPREM(SUB)     TO TS-INSPREM(SUB)
              MOVE LN-INSCOMM(SUB)     TO TS-INSCOMM(SUB).
           IF SUB NOT > 6
              MOVE LN-ACCERN(SUB) TO TS-EARNINGS(SUB)
              MOVE LN-ANTICERN(SUB) TO TS-ANTICERN(SUB)
      *       -------------------------------------------------------------
      *       ADDED GP-AMORTIZE-ACQUIST-FEE, THIS OPTION WILL TAKE THE
      *       AMOUNT ENTERED IN RESERVE PRINCIPAL 3 AND MOVE IT TO
      *       THE LOANS UNEARNED SERVICE CHARGE               REGACC #0081
      *
      *       NOTE: NO GL ENTRY MAKE DURING SF BOOKING FOR SERVICE CHARGE
      *       -------------------------------------------------------------
              IF SUB = 3
                 IF GP-AMORTIZE-ACQUIST-FEE = "Y"
                    MOVE 0 TO TS-ANTICERN(3).

      *       IF SUB = 4
      *          IF BR-USE-PARTIC-FLAT-TABLE = "Y"
      *             MOVE 0 TO TS-ANTICERN(4).


           IF SUB NOT > 10
              MOVE LN-FEEOURS(SUB) TO TS-FEEOURS(SUB)
              MOVE LN-FEECODE(SUB) TO TS-FEECODE(SUB)
              MOVE LN-FEEAMT(SUB) TO TS-FEEAMT(SUB).
           IF SUB < 10
              ADD 1 TO SUB
              GO TO UPDATE-TRS-NEXT-BORR.

           MOVE LN-EXTRA-PRIN-LFP         TO LP-EXTRA-PRIN-LFP.
           MOVE LN-REMAIN-INT-SINCE-LFP   TO LP-REMAIN-INT-SINCE-LFP.
           MOVE LN-REMAIN-PRIN-SINCE-LFP  TO LP-REMAIN-PRIN-SINCE-LFP.

           PERFORM SET-POSTDATE.

      *    IF LPLOAN-CALLED-FROM = "LNCREA"
      *       MOVE "BATCH" TO TS-USERID
      *    ELSE
              MOVE POST-USERID TO TS-USERID.
           MOVE POST-TIME TO TS-POSTTIME.
           MOVE POST-DATE TO TS-POSTDATE.

           MOVE LN-MIP-FG    TO TS-MIP-FG.
           MOVE LN-ACTIONCD2 TO TS-ACTIONCD2.

           PERFORM WRITE-TRS1-FILE.
           IF IO-FG = 0
              GO TO UPDATE-TRS-EXIT.

           IF SAVE-TS-LINE < 999
              ADD 1 TO SAVE-TS-LINE
              GO TO UPDATE-TRS-NEXT.

           MOVE "TRANSACTION SEQ = 999, REC NOT CREATED !" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.

       UPDATE-TRS-EXIT.
           PERFORM CLOSE-TRS1-FILE.

      ******************************************************
       UPDATE-LP1-FILE SECTION.
      ******************************************************
           MOVE "UPDATING LOAN PAYMENT FILE.............." TO MESS.
           PERFORM SEND-LEGEND.

      * GET ACCUMULATED EARNINGS FOR PAYMENT RECORDS:
           MOVE 1 TO SUB.
           PERFORM UPDATE-ACCERN UNTIL SUB > 6.

           PERFORM OPEN-LP1-FILE.
           MOVE LP-PATH-OWNBR TO SAVE-LP-BRNO.
           MOVE LN-ACCTNO     TO SAVE-LP-ACCTNO.
           MOVE 1             TO SAVE-LP-SEQNO.
       CREATE-LP-REC.
           PERFORM CLEAR-LP-FILE.

           MOVE SAVE-LP1-KEY TO LP1-KEY.

      * "NOT#1" INDICATES AN ERRONEOUS SITUATION WHERE
      * SEQNO 1 WAS POSTED PRIOR TO THIS LOAN'S CREATION
           IF LP-SEQNO NOT = 1
              MOVE "NOT#1" TO LP-REFNO.

           MOVE TRANS-DATE   TO LP-TRDATE.
           MOVE LN-INTDATE   TO LP-PAYDATE.
           MOVE LN-SRCD      TO LP-TRCD.
           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.
           PERFORM PAID-THRU-CALCULATION.
           MOVE PDTH-DATE-FULL TO LP-PDTH-DATE.
           MOVE LN-LCPDTH-DATE TO LP-LCPDTH-DATE.
           MOVE EARNING-WK(1) TO LP-EARNED(1).
           MOVE EARNING-WK(2) TO LP-EARNED(2).
           MOVE EARNING-WK(3) TO LP-EARNED(3).
           MOVE LN-LNAMT TO LP-CURBAL.

           PERFORM SET-POSTDATE.

      *    IF LPLOAN-CALLED-FROM = "LNCREA"
      *       MOVE "BATCH" TO LP-USERID
      *    ELSE
              MOVE POST-USERID TO LP-USERID.
           MOVE POST-TIME TO LP-POSTTIME.
           MOVE POST-DATE TO LP-POSTDATE.
           PERFORM WRITE-LP1-FILE.
           IF IO-FG = 0
              GO TO EXIT-UPDATE-LP1.

           IF SAVE-LP-SEQNO < 99999
              ADD 1 TO SAVE-LP-SEQNO
              GO TO CREATE-LP-REC.

           MOVE "LOAN PMT = 99999, PMT REC NOT CREATED !" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       EXIT-UPDATE-LP1.
           PERFORM CLOSE-LP1-FILE.

      ******************************************************
       UPDATE-LXE-FILE SECTION.
      ******************************************************

           IF EARNING-WK(4) = 0
              IF EARNING-WK(5) = 0
                 IF EARNING-WK(6) = 0
                    GO TO EXIT-UPDATE-LXE.

           MOVE "UPDATING LX TRAILER RECORD........" TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-LXE1-FILE.

           PERFORM CLEAR-LXE-FILE.

           MOVE LP-BRNO       TO LXE-BRNO.
           MOVE LP-ACCTNO     TO LXE-ACCTNO.
           MOVE LP-SEQNO      TO LXE-SEQNO.

           MOVE EARNING-WK(4) TO LXE-EARN(1).
           MOVE EARNING-WK(5) TO LXE-EARN(2).
           MOVE EARNING-WK(6) TO LXE-EARN(3).

      *06/06/2019 AS OF THIS DATE, THE EARNING-WK IS POPULATED BY THE MOVE
      *OF LN-ACRERN(1-6) TO EARNING-WK().
      *THE EARNIN-WK TABLE WHICH NOW OCCURS 10 TIMES IS INITIALLY SET TO 0
      *SO EARNING-WK(7-10) WILL BE 0 SO WE HAVE A GOOD SETUP WHEN WE ADD
      *ADDITIONAL EARNING COMPONENTS

           MOVE EARNING-WK(7)  TO LXE-EARN(4).
           MOVE EARNING-WK(8)  TO LXE-EARN(5).
           MOVE EARNING-WK(9)  TO LXE-EARN(6).
           MOVE EARNING-WK(10) TO LXE-EARN(7).

           PERFORM WRITE-LXE1-FILE.
           PERFORM CLOSE-LXE1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

       EXIT-UPDATE-LXE.
           EXIT.

      ******************************************************
       UPDATE-LXM-FILE SECTION.
      ******************************************************

           MOVE "UPDATING LXM TRAILER RECORD.............." TO MESS.
           PERFORM SEND-LEGEND.
    
           PERFORM OPEN-LX1-FILE.
           MOVE LP-BRNO   TO LX-BRNO.
           MOVE LP-ACCTNO TO LX-ACCTNO.
           MOVE LP-SEQNO  TO LX-SEQNO.
           PERFORM READ-LX1-FILE.
           IF IO-FG = 0
              PERFORM MOVE-LXM-FIELDS
              PERFORM REWRITE-LX1-FILE
              PERFORM CLOSE-LX1-FILE
           ELSE
              PERFORM CLEAR-LX-FILE
              MOVE LP-BRNO   TO LX-BRNO
              MOVE LP-ACCTNO TO LX-ACCTNO
              MOVE LP-SEQNO  TO LX-SEQNO
              PERFORM MOVE-LXM-FIELDS
              PERFORM WRITE-LX1-FILE
              PERFORM CLOSE-LX1-FILE.

           IF IO-FG NOT = 0
              GO TO IO-ERROR.

       EXIT-UPDATE-LXM.
           EXIT.

      *********************************************************
       UPDATE-BW1-FILE SECTION.
      *********************************************************
           MOVE "UPDATING BORROWER FILE.................." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM GET-COLLATERAL.
           MOVE 1 TO SUB.
           PERFORM OPEN-BW1-FILE.
       UPDATE-NEXT-BW.
           MOVE LN-SSNO(SUB) TO BW-SSNO.
           PERFORM READ-BW1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           IF SUB = 1
              STRING BW-LNAME,", ",BW-FNAME DELIMITED BY "   "
                INTO HOLD-BW-NAME
              STRING BW-FNAME," ",BW-LNAME DELIMITED BY "   "
                INTO HOLD-BW-FIRST-LAST
              MOVE BW-ZIP TO HOLD-BW-ZIP.
           ADD 1 TO BW-LOANS.
           IF SUB = 1
              IF CD-CO-SECURED = "R"
                 ADD LN-YTDINTPD TO BW-RE-INTYTD
              ELSE
                 ADD LN-YTDINTPD TO BW-INTYTD.
           IF LN-SERVACCT = "Y"
              ADD LN-LNAMT TO BW-LIAOTH
            ELSE
              IF LN-SMALLOAN = "Y"
                 ADD LN-LNAMT TO BW-LIASMLN
               ELSE
                 ADD LN-LNAMT TO BW-LIAOTH.
           PERFORM REWRITE-BW1-FILE.
           IF SUB = 4
              GO TO EXIT-UPDATE-BW1.
           ADD 1 TO SUB.
           IF LN-SSNO(SUB) NOT = 0
              GO TO UPDATE-NEXT-BW.
       EXIT-UPDATE-BW1.
           PERFORM CLOSE-BW1-FILE.

      *********************************************************
       UPDATE-BX1-FILE SECTION.
      *********************************************************

           IF ( LN-APP-NUMBER = ZEROES )
              GO TO UPDATE-BX1-FILE-EXIT.

           MOVE LN-SSNO(1)                 TO BX-SSNO.
           PERFORM OPEN-BX1-FILE.
           PERFORM READ-BX1-FILE.
           IF ( IO-BAD )
              PERFORM CLEAR-BX-FILE
              MOVE LN-SSNO(1)              TO BX-SSNO
              MOVE BX-PATH-OWNBR           TO BX-BRNO
              PERFORM WRITE-BX1-FILE.

           MOVE LN-LOANDATE                TO BX-KYC-LAST-VERDATE.

           PERFORM REWRITE-BX1-FILE.
           PERFORM CLOSE-BX1-FILE.
 
       UPDATE-BX1-FILE-EXIT.
           EXIT.

      ***********************************************
       UPDATE-NOTICE-FILE SECTION.
      ***********************************************
           PERFORM OPEN-NO1-FILE.
           MOVE LN-OWNBR  TO NO-BRNO.
           MOVE LN-ACCTNO TO NO-ACCTNO CRNOR2-ACCTNO.
           PERFORM READ-NO1-FILE.

           MOVE TRANS-DATE     TO CRNOR2-SYSDATE.
           MOVE "CL/CRNOR2"    TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CRNOR2-LINK NO-REC
                                 POFF-WORKERS LN-REC.
           CANCEL FORM-PROGX.

           MOVE LN-OWNBR  TO NO-BRNO.
           MOVE LN-ACCTNO TO NO-ACCTNO.
           IF IO-FG = 0
              PERFORM REWRITE-NO1-FILE
           ELSE
              PERFORM WRITE-NO1-FILE.

           PERFORM CLOSE-NO1-FILE.
       EXIT-UPDATE-NOTICE-FILE.
           EXIT.

      *********************************************************
       UPDATE-DT-BATCH SECTION.
      *********************************************************
           MOVE "UPDATING DEALER TRANSACTION FILE........" TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-DT1-FILE.
           MOVE 1 TO SAVE-DT-SEQ.
       NEXT-DT-BATCH-SEQ.
           PERFORM SETUP-DT-RECORD.
           MOVE WK-DLPAID TO DT-PAID.
           MOVE LN-PROCEEDS TO DT-PROCEEDS.
      * DT-STATUS = " "  -  RECORDS HAVE NOT BEEN RELEASED THRU BATCH
      * DT-STATUS = "R"  -  RECORDS HAVE BEEN RELEASED, WAITING TO PRINT
      * DT-STATUS = "P"  -  RECORDS HAVE BEEN PRINTED

      * FOR SERVICE ACCOUNTS, UPDATE DT-PROCEEDS WITH INSURANCE & FEES
      * THAT OUR OURS:
           IF LN-SERVACCT = "Y"
              PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 10
                 IF SUB < 9 AND LN-INSOURS(SUB) = "Y"
                    SUBTRACT LN-INSPREM(SUB) FROM DT-PROCEEDS
                 END-IF
                 IF LN-FEEOURS(SUB) = "Y"
                    SUBTRACT LN-FEEAMT(SUB) FROM DT-PROCEEDS
                 END-IF
              END-PERFORM.

       WRITE-DT-BATCH.
           PERFORM WRITE-DT1-FILE.
           IF IO-FG = 0
              GO TO EXIT-UPDATE-DT-BATCH.
           IF SAVE-DT-SEQ < 999
              ADD 1 TO SAVE-DT-SEQ
              GO TO NEXT-DT-BATCH-SEQ.
           MOVE "DEALER TRANSACTION = 9999, REC NOT CREATED !" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       EXIT-UPDATE-DT-BATCH.
           PERFORM CLOSE-DT1-FILE.

      *********************************************************
       CHECK-UPD SECTION.
      *********************************************************
           MOVE "UPDATING CHECK RECORDS..............." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-FM1-FILE.

           MOVE WK-DLPAID TO SAVE-DLPAID.
           ADD S-LNS-FREE-WK-RECS 1 GIVING SAVE-WK-KEY.
           MOVE "Y" TO FIRST-CHECK.
       CHECK-UPD-NEXT.
           MOVE SAVE-WK-KEY TO WK-KEY.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9
              GO TO EXIT-CHECK-UPD.

           IF WK-STATUS = "D"
              PERFORM DELETE-WK-FILE
              ADD 1 TO SAVE-WK-KEY
              GO TO CHECK-UPD-NEXT.

      *--------------------------------------------------------------
      * CHECK-UPD-DT:
           MOVE "UPDATING DEALER TRANSACTION FILE........" TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-DT1-FILE.
           MOVE 1 TO SAVE-DT-SEQ.
       CHECK-UPD-DT-NEXT.
           PERFORM SETUP-DT-RECORD.
           MOVE WK-PYAMT TO DT-PROCEEDS.
           MOVE SAVE-DLPAID TO DT-PAID.
           IF FIRST-CHECK = "N"
              MOVE 0 TO DT-DLRVPRIN(1) DT-DLRVPRIN(2)
                        DT-DLRVPRIN(3) DT-DLRVCHGS(1)
                        DT-DLRVCHGS(2) DT-DLRVCHGS(3)
                        DT-DLPARVHELD  DT-DLPARVPAID
                        DT-PURBAL.
           IF SAVE-DLPAID = "M" AND LN-PROCEEDS > 0
              MOVE WK-PYAMT TO DT-PAYMENTS
      *  GLB 07/02/01 RELEASED S/B 0 IF CHECK COMPLETED
      *       MOVE WK-PYAMT TO DT-RELEASED
              MOVE 0        TO DT-RELEASED
              MOVE WK-CKNUM TO DT-CKNO
              MOVE "P" TO DT-STATUS
              MOVE TRANS-DATE TO DT-CKDATE.
      *  GLB 07/02/01
           IF SAVE-DLPAID = "M"
              MOVE "N" TO DT-UNPAID.
           IF SAVE-DLPAID = "S"
              MOVE "R" TO DT-STATUS
              MOVE WK-PYAMT TO DT-RELEASED.
      * DT1-WRITE
           PERFORM WRITE-DT1-FILE.
           IF IO-FG = 0
              GO TO CHECK-UPD-DT-END.
           IF SAVE-DT-SEQ < 9999
              ADD 1 TO SAVE-DT-SEQ
              GO TO CHECK-UPD-DT-NEXT.
           MOVE "DEALER TRANSACTION = 9999, REC NOT CREATED !" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       CHECK-UPD-DT-END.
           PERFORM CLOSE-DT1-FILE.
           MOVE "N" TO FIRST-CHECK.

      *--------------------------------------------------------------
           IF SAVE-DLPAID = "M"
              GO TO CHECK-UPD-CK-TRC.

      *CHECK-UPD-CREATE-CX:
           PERFORM OPEN-CX1-FILE.
           MOVE BRANCH TO SAVE-CX-BRNO.
           MOVE "DL"   TO SAVE-CX-TYPE.
           MOVE 1      TO SAVE-CX-SEQNO.

           PERFORM CLEAR-CX-FILE.

           MOVE LN-CLASS TO CX-CLASS.
           MOVE WK-PYAMT TO CX-AMT.
           MOVE WK-PAYEE TO CX-PAYEE.
           MOVE WK-ADR1 TO CX-ADR1.
           MOVE WK-ADR2 TO CX-ADR2.
           MOVE WK-CITY TO CX-CITY.
           MOVE WK-STATE TO CX-STATE.
           MOVE WK-ZIP TO CX-ZIP.
           MOVE WK-BWPROC TO CX-BWPROC.
           MOVE LN-ACCTNO TO CX-REF.
           MOVE "SF CONTRACT: " TO WK-REASON.
           MOVE HOLD-BW-NAME TO WK-WHO.
           MOVE WK-REASON TO CX-REASON.
           MOVE LN-ACCTNO TO CX-ACCTNO.
           MOVE SAVE-DLPAID TO CX-PAID.
           MOVE "B2" TO CX-PGM.
           MOVE WK-CK-FREE1 TO CX-FREE1.
           MOVE WK-CK-FREE2 TO CX-FREE2.
           MOVE TRANS-DATE TO CX-DATE.
           MOVE DL-DLNO TO CX-DLNO.
           MOVE SAVE-DT-SEQ TO CX-DT-SEQ.
       CHECK-UPD-WRITE-CX.
           MOVE SAVE-CX1-KEY TO CX1-KEY.
           PERFORM WRITE-CX1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-WK-FILE
              PERFORM CLOSE-CX1-FILE
              ADD 1 TO SAVE-WK-KEY
              GO TO CHECK-UPD-FORM-REQ.

           IF SAVE-CX-SEQNO < 9999
              ADD 1 TO SAVE-CX-SEQNO
              GO TO CHECK-UPD-WRITE-CX.
           MOVE "REQUEST # = 9999.  REQUEST NOT CREATED!" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
           GO TO CHECK-UPD-NEXT.

      *--------------------------------------------------------------
       CHECK-UPD-FORM-REQ.
           PERFORM CLEAR-FM-FILE.

           MOVE SPACES                TO LPWSFM-EDIT-FM-INITKEY.

           MOVE CX-BRNO               TO LPWSFM-EDIT-FM-BRNO.
           MOVE CX-TYPE               TO LPWSFM-EDIT-FM-TYPE.
           MOVE CX-SEQNO              TO LPWSFM-EDIT-FM-SEQNO.
           MOVE SAVE-CK-FMNO          TO LPWSFM-EDIT-FM-CKFMNO.

           MOVE FM-PATH-OWNBR          TO FM-BRNO.
           MOVE LPWSFM-EDIT-FM-INITKEY TO FM-INITKEY.
           MOVE SAVE-CK-FMNO           TO FM-FMNO.

           PERFORM READ-FM1-FILE.

           MOVE FM-PATH-OWNBR          TO FM-BRNO.
           MOVE LPWSFM-EDIT-FM-INITKEY TO FM-INITKEY.
           MOVE SAVE-CK-FMNO           TO FM-FMNO.

      * CURRENTLY ZIP IS SPACES
           MOVE CX-ZIP                TO FM-ZIP.
           MOVE " "                   TO FM-PRINT.
           MOVE 0                     TO FM-STMT-COUNTER.
           MOVE TRANS-DATE            TO FM-TRDATE.
           MOVE EXT-CONAME-USER-ID    TO FM-USERID.
      
           IF IO-FG = 0
              PERFORM REWRITE-FM1-FILE
              GO TO CHECK-UPD-NEXT.

           IF FM-FMNO NOT = 0
              PERFORM WRITE-FM1-FILE
              IF IO-FG = 9
                 GO TO IO-ERROR.

           GO TO CHECK-UPD-NEXT.

      *--------------------------------------------------------------
       CHECK-UPD-CK-TRC.
           PERFORM OPEN-TRC1-FILE.

           PERFORM CLEAR-TRC-FILE.

           MOVE BRANCH     TO TC-BRNO.
           MOVE TRANS-DATE TO TC-KEY-DATE.
           MOVE WK-CKNUM   TO TC-CKNO.
           MOVE LN-CLASS   TO TC-CLASS.
           MOVE 0          TO TC-SEQ.

           MOVE "DL"            TO TC-TYPE.
           MOVE TRANS-DATE      TO TC-DATE.
           MOVE WK-PYAMT        TO TC-AMT.
           MOVE LN-ACCTNO       TO TC-REF.
           MOVE WK-PAYEE        TO TC-PAYEE.
           MOVE "SF CONTRACT: " TO WK-REASON.
           MOVE HOLD-BW-NAME    TO WK-WHO.
           MOVE WK-REASON       TO TC-REASON.
           MOVE LN-ACCTNO       TO TC-ACCTNO.
           MOVE SAVE-DLPAID     TO TC-PAID.
           MOVE "B2"            TO TC-PGM.
           MOVE LN-DLNO         TO TC-DLNO.

           PERFORM SET-POSTDATE.
      *    IF LPLOAN-CALLED-FROM = "LNCREA"
      *       MOVE "BATCH"      TO TC-USERID
      *    ELSE
              MOVE POST-USERID  TO TC-USERID.
           MOVE POST-TIME       TO TC-POSTTIME.
           MOVE POST-DATE       TO TC-POSTDATE.

           PERFORM WRITE-TRC1-FILE.
           IF IO-FG NOT = 0
              MOVE "CHECK REGISTER NOT UPDATED!" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              PERFORM CLOSE-TRC1-FILE.

      *--------------------------------------------------------------
      * UPDATE-CK:
           PERFORM OPEN-CK1-FILE.

           PERFORM CLEAR-CK-FILE.

           MOVE WK-CKNUM        TO CK-NO.
           MOVE BRANCH          TO CK-BRNO.
           MOVE "DL"            TO CK-TYPE.
           MOVE LN-CLASS        TO CK-CLASS.
           MOVE TRANS-DATE      TO CK-DATE.
           MOVE WK-PYAMT        TO CK-AMT.
           ADD WK-PYAMT         TO CHECK-TOTAL.
           MOVE WK-PAYEE        TO CK-PAYEE.
           MOVE LN-ACCTNO       TO CK-REF.
           MOVE "SF CONTRACT: " TO WK-REASON.
           MOVE HOLD-BW-NAME TO WK-WHO.
           MOVE WK-REASON    TO CK-REASON.
           MOVE 0            TO CK-VOID-DATE CK-DLRVNO.
           MOVE DL-DLNO      TO CK-DLNO.
           MOVE LN-ACCTNO    TO CK-ACCTNO.
           MOVE "B2"         TO CK-PGM.
           MOVE SAVE-DLPAID  TO CK-PAID.
           MOVE 0            TO CK-SSNO CK-BATCHID.
           MOVE "N"          TO CK-UNPAID.
           MOVE WK-CK-FREE1  TO CK-FREE1.
           MOVE WK-CK-FREE2  TO CK-FREE2.

           PERFORM WRITE-CK1-FILE.
           IF IO-FG = 0
      *       PERFORM DELETE-WK-FILE
              PERFORM CLOSE-CK1-FILE
      *       ADD 1 TO SAVE-WK-KEY
      *       GO TO CHECK-UPD-NEXT.
              GO TO CHECK-UPD-MANUAL-DT.

           PERFORM CLOSE-CK1-FILE.
           MOVE "CHECK RECORD NOT CREATED!" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.



      * GLB 07/02/01   N E W    U P D A T E
       CHECK-UPD-MANUAL-DT.
           MOVE "CREATING DEALER CHECK DETAIL........" TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM OPEN-DT1-FILE.
           MOVE 1           TO SAVE-DT-SEQ.
       UPDATE-DT-MANUAL-NEXT.
           PERFORM CLEAR-DT-FILE.
           MOVE CK-DLNO     TO DT-DLNO.
           MOVE CK-CLASS    TO DT-CLASS.
           MOVE CK-ACCTNO   TO DT-ACCTNO.
           MOVE TRANS-DATE  TO DT-DATE.
           MOVE SAVE-DT-SEQ TO DT-SEQ.
           PERFORM READ-DT1-FILE.
           IF IO-FG = 0
              ADD 1 TO SAVE-DT-SEQ
              IF SAVE-DT-SEQ < 9999
                 GO TO UPDATE-DT-MANUAL-NEXT
              ELSE
                 MOVE "UNABLE TO CREATE DEALER MANUAL CHECK DETAIL"
                    TO MESS
                 PERFORM CONDITIONAL-SEND-MESS
                 PERFORM CLOSE-DT1-FILE
                 PERFORM DELETE-WK-FILE
                 ADD 1 TO SAVE-WK-KEY
                 GO TO CHECK-UPD-NEXT.
           PERFORM CLEAR-DT-FILE.
           MOVE CK-DLNO     TO DT-DLNO.
           MOVE CK-CLASS    TO DT-CLASS.
           MOVE CK-ACCTNO   TO DT-ACCTNO.
           MOVE TRANS-DATE  TO DT-DATE.
           MOVE SAVE-DT-SEQ TO DT-SEQ.
           PERFORM WRITE-DT1-FILE.

           MOVE CK-NO       TO DT-CKNO.
           MOVE TRANS-DATE  TO DT-CKDATE.
           MOVE CK-PAID     TO DT-PAID.
           MOVE CK-DLRVNO   TO DT-DLRVNO.
           MOVE CK-BRNO     TO DT-BRNO.
           IF LN-SERVACCT = "Y"
              MOVE "S" TO DT-TYPE
           ELSE
              MOVE "P" TO DT-TYPE.

           MOVE "CK"        TO DT-TRCD.
           MOVE CK-UNPAID   TO DT-UNPAID.

           MOVE "C"         TO DT-STATUS.
           MOVE "M"         TO DT-MEMO.
      * GLB 01/03/03
      *    MOVE  CK-AMT     TO DT-PROCEEDS.
           SUBTRACT CK-AMT  FROM DT-PAYMENTS.

           PERFORM REWRITE-DT1-FILE.
           IF IO-FG = 0
                 PERFORM CLOSE-DT1-FILE
                 PERFORM DELETE-WK-FILE
                 ADD 1 TO SAVE-WK-KEY
                 GO TO CHECK-UPD-NEXT.

           PERFORM CLOSE-DT1-FILE.

           MOVE "UNABLE TO CREATE MANUAL CHECK DETAIL"
              TO MESS PERFORM CONDITIONAL-SEND-MESS.

       EXIT-CHECK-UPD.
           PERFORM CLOSE-FM1-FILE.

      *********************************************************
       UPDATE-DS1-FILE SECTION.
      *********************************************************
           MOVE "UPDATING DEALER STATISTICS FILE........." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-DS1-FILE.
           MOVE "N" TO REC-EXISTS.
       UPDATE-DS1-FILE-CHECK.
           PERFORM SET-DS1-KEY.
           PERFORM READ-DS1-FILE.
           IF IO-FG = 0
              MOVE "Y" TO REC-EXISTS
              GO TO UPDATE-DS1-FILE-UPD-REC.
           PERFORM CLEAR-DS-FILE.
           PERFORM SET-DS1-KEY.

      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
       UPDATE-DS1-FILE-UPD-REC.

           IF GP-THE-ONLY-SF-SRCD NOT = " " AND
                      LN-SRCD = GP-THE-ONLY-SF-SRCD
              ADD 1 TO DS-NPURUNIT(1) DS-NPURUNIT(2)
              ADD LN-LNAMT TO DS-NPURAMT(1) DS-NPURAMT(2)
           ELSE
           IF LN-SRCD = "NB"
              ADD 1 TO DS-NPURUNIT(1) DS-NPURUNIT(2)
              ADD LN-LNAMT TO DS-NPURAMT(1) DS-NPURAMT(2)
           ELSE
           IF LN-SRCD = "PB" OR "RN" OR "RB" OR "RO"
              ADD 1 TO DS-RNEWUNIT(1) DS-RNEWUNIT(2)
              ADD LN-LNAMT TO DS-RNEWAMT(1) DS-RNEWAMT(2)
           ELSE
              ADD 1 TO DS-OPURUNIT(1) DS-OPURUNIT(2)
              ADD LN-LNAMT TO DS-OPURAMT(1) DS-OPURAMT(2). 

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    UPDATE UNEARNED STATISTICS NET AND VOLUME
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF GP-UNEARNED-STATS = "Y"
              PERFORM VARYING DSSUB3 FROM 1 BY 1 UNTIL DSSUB3 > 6
                        AFTER DSSUB2 FROM 1 BY 1 UNTIL DSSUB2 > 2
                  IF DSSUB2 = 1
                     ADD EARN-UNEARN(DSSUB3) TO
                                 DS-UNEARNED-AMT(1 DSSUB2 DSSUB3)
                  ELSE
                  IF (DSSUB3 < 4) OR

                     ((DSSUB3 = 4 AND NOT GP-INCL-OTH-IN-EARNED-R) OR
                     (DSSUB3 = 5 AND LN-PRDLDISC-UNEARN = 0) OR
                     (DSSUB3 = 6 AND NOT (GP-INCL-OTH-IN-EARNED-N  OR
                                            GP-INCL-OTH-IN-EARNED-R)))

                      ADD LN-ANTICERN(DSSUB3)
                            TO DS-UNEARNED-AMT(1 DSSUB2 DSSUB3)
                               DS-UNEARNED-AMT(2 DSSUB2 DSSUB3)
                   END-IF
                   END-IF
              END-PERFORM


      *       ----------------------------------------------------------
      *       UPDATE PROCEEDS: WE DO NOT CARE ABOUT ACCOUNT STATUS.
      *       ----------------------------------------------------------
              ADD LN-PROCEEDS TO DS-PROCEEDS(1)
                                 DS-PROCEEDS(2).


           ADD LN-ORGTERM TO DS-SUMWGTTM.
           ADD LN-LNAMT TO DS-SUMWGTAV.
           COMPUTE DS-SUMWGTTA =
              DS-SUMWGTTA + (LN-ORGTERM * LN-LNAMT).
           IF LN-SERVACCT NOT = "Y"
              ADD LN-DLDISC TO DS-DLDISC
                               DS-DLDISC-VOL(1)
                               DS-DLDISC-VOL(2)
              ADD LN-DLRVPRIN(1) TO DS-DLRVPRIN(1)
              ADD LN-DLRVPRIN(2) TO DS-DLRVPRIN(2)
              ADD LN-DLRVPRIN(3) TO DS-DLRVPRIN(3)
              ADD LN-DLRVCHGS(1) TO DS-DLRVCHGS(1)
              ADD LN-DLRVCHGS(2) TO DS-DLRVCHGS(2)
              ADD LN-DLRVCHGS(3) TO DS-DLRVCHGS(3)
              ADD LN-DLPARVHELD TO DS-DLPARVHELD
              ADD LN-DLPARVPAID TO DS-DLPARVPAID
              IF SAVE-DLPAID NOT = "M"
                 ADD LN-PROCEEDS TO DS-UNPAIDCK.

      * FOR SERVICE ACCOUNTS, UPDATE DS-UNPAIDCK WITH INSURANCE & FEES
      * THAT OUR OURS:
           IF LN-SERVACCT = "Y"
              PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 10
                 IF SUB < 9 AND LN-INSOURS(SUB) = "Y"
                    SUBTRACT LN-INSPREM(SUB) FROM DS-UNPAIDCK
                 END-IF
                 IF LN-FEEOURS(SUB) = "Y"
                    SUBTRACT LN-FEEAMT(SUB) FROM DS-UNPAIDCK
                 END-IF
              END-PERFORM.

           ADD 1 TO DS-OUTSUNIT(1).
           ADD LN-LNAMT TO DS-OUTSAMT(1).

           IF LN-SERVACCT NOT = "Y"
              IF LN-DLRECOURSE = "F"
                 ADD 1 TO DS-RCOURSE-UNITS(1)
                 ADD LN-LNAMT TO DS-RCOURSE-AMT(1)
               ELSE
                 IF LN-DLRECOURSE = "P"
                    ADD 1 TO DS-RCOURSE-UNITS(2)
                    ADD LN-DLPARTRCAMT TO DS-RCOURSE-AMT(2)
                  ELSE
                    IF LN-DLRECOURSE = "N"
                       ADD 1 TO DS-RCOURSE-UNITS(3)
                       ADD LN-LNAMT TO DS-RCOURSE-AMT(3).

      * UPDATE DELINQUENCY NORMAL:
           IF GP-DELINQ-WITH-O2 = "Y"
              MOVE LN-CURBAL TO SAVE-OUTBAL
           ELSE
              SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL.
           ADD 1 TO DS-UNITS(DSNOW DSREC RDSUB)
                    DS-UNITS(DSNOW DSCON CSUB).
           ADD SAVE-OUTBAL TO DS-OUTBAL(DSNOW DSREC RDSUB)
                              DS-OUTBAL(DSNOW DSCON CSUB).
      * UPDATE DELINQUENCY BANKRUPT:
      *JGW IF LN-SRCD = "RB"
           IF PRIOR-BNKRPTDATE NOT = 0
              ADD 1 TO DS-UNITS-BNKRPT(DSNOW DSREC RDSUB)
                       DS-UNITS-BNKRPT(DSNOW DSCON CSUB)
              ADD SAVE-OUTBAL TO DS-OUTBAL-BNKRPT(DSNOW DSREC RDSUB)
                                 DS-OUTBAL-BNKRPT(DSNOW DSCON CSUB).

       UPDATE-DS1-FILE-EXIT.
           IF REC-EXISTS = "Y"
              PERFORM REWRITE-DS1-FILE
           ELSE
              PERFORM WRITE-DS1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.
           PERFORM CLOSE-DS1-FILE.

      *********************************************************
       UPDATE-TY1-FILE SECTION.
      *********************************************************
           MOVE "UPDATING TODAY'S TOTAL FILE............." TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM OPEN-TY1-FILE.
           MOVE "N" TO REC-EXISTS.
       UPDATE-TY1-FILE-CHECK.
           PERFORM SET-TY-KEY.
           PERFORM READ-TY1-FILE.
           IF IO-FG = 0
              GO TO UPDATE-TY1-FILE-UPD-REC.
           IF REC-EXISTS = "Y"
              GO TO IO-ERROR.

           MOVE "Y" TO REC-EXISTS.
           PERFORM CLEAR-TY-FILE.
           PERFORM SET-TY-KEY.
           PERFORM WRITE-TY1-FILE.
           IF IO-FG = 9 AND E-CODE NOT = "22"
              GO TO IO-ERROR.
           GO TO UPDATE-TY1-FILE-CHECK.

      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
       UPDATE-TY1-FILE-UPD-REC.

      * NOTE:
      *      ONLY APPLICATION AND UNEARNED INFORMATION IS UPDATED
      *      WHEN ACCOUNT IS REVOLVING:

           PERFORM GET-SRCD-SUB.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    UPDATE UNEARNED STATISTICS NET AND VOLUME
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF GP-UNEARNED-STATS = "Y"
              PERFORM VARYING TYSUB3 FROM 1 BY 1 UNTIL TYSUB3 > 6
                        AFTER TYSUB2 FROM 1 BY 1 UNTIL TYSUB2 > 2
                  IF TYSUB2 = 1
                     ADD EARN-UNEARN(TYSUB3) TO
                                 TY-UNEARNED-AMT(TYSUB2 TYSUB3)
                  ELSE
                  IF (TYSUB3 < 4) OR
                     ((TYSUB3 = 4 AND NOT GP-INCL-OTH-IN-EARNED-R) OR
                     (TYSUB3 = 5 AND LN-PRDLDISC-UNEARN = 0) OR
                     (TYSUB3 = 6 AND NOT (GP-INCL-OTH-IN-EARNED-N OR
                                             GP-INCL-OTH-IN-EARNED-R)))

                      ADD LN-ANTICERN(TYSUB3)
                                TO TY-UNEARNED-AMT(TYSUB2 TYSUB3)
                     END-IF
                  END-IF
              END-PERFORM
      *       ----------------------------------------------------------
      *       UPDATE PROCEEDS: WE DO NOT CARE ABOUT ACCOUNT STATUS.
      *       ----------------------------------------------------------
              ADD LN-PROCEEDS TO TY-PROCEEDS.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

           ADD LN-ORGTERM TO TY-SUMWGTTM.
           ADD LN-LNAMT TO TY-SUMWGTAV.
           COMPUTE TY-SUMWGTTA =
              TY-SUMWGTTA + (LN-ORGTERM * LN-LNAMT).

           IF SAVE-DLPAID = "M" AND LN-PROCEEDS > 0
              ADD CHECK-TOTAL TO TY-CKWRITTEN(2).

      * IF LOAN IS NOT A SERVICE ACCOUNT THEN UPDATE TY
      *     CURRENT - NET GAIN/LOSS & NEW VOLUME.
           IF LN-SERVACCT NOT = "Y"
              ADD LN-DLDISC     TO TY-DLDISC
              PERFORM VARYING SUB1 FROM 1 BY 1 UNTIL SUB1 > 2
                        AFTER SUB2 FROM 1 BY 1 UNTIL SUB2 > 3

                 ADD LN-DLRVPRIN(SUB2) TO TY-DLRVPRIN(SUB1 SUB2)
                 ADD LN-DLRVCHGS(SUB2) TO TY-DLRVCHGS(SUB1 SUB2)
                 IF SUB2 = 1
                    ADD LN-DLPARVHELD TO TY-DLPARVHELD(SUB1)
                 END-IF
              END-PERFORM.

           IF SRCD-NOT-PL
              ADD 1 TO TY-NO(1 SRCD)
                       TY-NO(2 SRCD)
              ADD LN-LNAMT TO TY-AMT(1 SRCD)
                              TY-AMT(2 SRCD)
              ADD LN-OT2BAL TO TY-O2(1 SRCD)
                               TY-O2(2 SRCD)
              ADD LN-INTCHG TO TY-INT(1 SRCD)
                               TY-INT(2 SRCD)
              ADD LN-EXTCHG TO TY-INT(1 SRCD)
                               TY-INT(2 SRCD).

      * UPDATE DELINQUENCY NORMAL:
           IF GP-DELINQ-WITH-O2 = "Y"
              MOVE LN-CURBAL TO SAVE-OUTBAL
           ELSE
              SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL.
           ADD 1 TO TY-UNITS(1 RDSUB)
                    TY-UNITS(2 CSUB).
           ADD SAVE-OUTBAL TO TY-OUTBAL(1 RDSUB)
                              TY-OUTBAL(2 CSUB).
      * UPDATE DELINQUENCY BANKRUPT:
      *JGW IF LN-SRCD = "RB"
           IF PRIOR-BNKRPTDATE NOT = 0
              ADD 1 TO TY-UNITS-BNKRPT(TYREC RDSUB)
                       TY-UNITS-BNKRPT(TYCON CSUB)
              ADD SAVE-OUTBAL TO TY-OUTBAL-BNKRPT(TYREC RDSUB)
                                 TY-OUTBAL-BNKRPT(TYCON CSUB).

      ***************************************
      * UPDATE INSURANCES
      ***************************************
      * LN-INSPREM ONLY OCCURS 8 TIMES, WHILE TY-INS STILL OCCURS 10, BAH
      * 12/9/96
      *  DO NOT INCLUDE 7 & 8 HERE THEY ARE NOT BEING USED YET
      *  AND WE DO NOT WANT TO COUND THEN AS NOT WRITTEN IN STATS
      *                                         (MJD 09/10/1999).
           PERFORM UPDATE-TY1-FILE-INS
              VARYING SUB FROM 1 BY 1
      *-------------------->UNTIL SUB > 10.
      *-------------------->UNTIL SUB > 8.
                            UNTIL SUB > 6.

           IF LN-INSELIGIBLE-DL OR LN-INSELIGIBLE-LL
              IF LN-INSOURS(1) = "Y"
                 ADD 1 TO TY-INS-NO-ELIG(1).

           IF LN-INSELIGIBLE-AH
              IF LN-INSOURS(2) = "Y"
                 ADD 1 TO TY-INS-NO-ELIG(2).

           IF LN-INSELIGIBLE-PP OR LN-INSELIGIBLE-PP2
              IF LN-INSOURS(3) = "Y"
                 ADD 1 TO TY-INS-NO-ELIG(3).

           IF LN-INSELIGIBLE-O1
              IF LN-INSOURS(4) = "Y"
                 ADD 1 TO TY-INS-NO-ELIG(4).

      * TEST FOR ROADGARD INSURANCE AND AD&D (WORLD)
           MOVE "N" TO ROADGARD-WRITTEN ADD-WRITTEN NON-FILE-WRITTEN.
           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 10
              IF LN-FEECODE(SUB) NOT = SPACES
                 IF LN-FEEOURS(SUB) = "Y"
                    IF LN-FEECODE(SUB) = GP-NON-FILE-FEECODE
                       ADD 1 TO TY-FEE-NO-WROTE(1)
                       ADD LN-FEEAMT(SUB) TO TY-FEE-AMT-WROTE(1)
                       MOVE "Y" TO NON-FILE-WRITTEN
                    END-IF
                    IF LN-FEECODE(SUB) = BR-ADD-INS-FEECODE
                       ADD 1 TO TY-FEE-NO-WROTE(2)
                       ADD LN-FEEAMT(SUB) TO TY-FEE-AMT-WROTE(2)
                       MOVE "Y" TO ADD-WRITTEN
                    END-IF
                    IF LN-FEECODE(SUB) = BR-ROAD-G-SGL-FEECODE OR
                       LN-FEECODE(SUB) = BR-ROAD-G-FAM-FEECODE
                          ADD 1 TO TY-FEE-NO-WROTE(3)
                          ADD LN-FEEAMT(SUB) TO TY-FEE-AMT-WROTE(3)
                          MOVE "Y" TO ROADGARD-WRITTEN
                    END-IF
                 END-IF
              END-IF
           END-PERFORM
           IF NON-FILE-WRITTEN = "N"
              ADD 1 TO TY-FEE-NO-NOTWROTE(1)
           END-IF
           IF ADD-WRITTEN = "N"
              ADD 1 TO TY-FEE-NO-NOTWROTE(2)
           END-IF
           IF ROADGARD-WRITTEN = "N"
              ADD 1 TO TY-FEE-NO-NOTWROTE(3).

       UPDATE-TY1-FILE-EXIT.
           PERFORM REWRITE-TY1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.
           PERFORM CLOSE-TY1-FILE.

      *********************************************************
       UPDATE-TY1-FILE-INS SECTION.
      *********************************************************

      * LN-INSPREM ONLY OCCURS 8 TIMES, WHILE TY-INS STILL OCCURS 10, BAH

           IF LN-INSOURS(SUB) = "Y"
              IF LN-INSPREM(SUB) NOT = 0
                 ADD 1 TO TY-INS-NO-WROTE(SUB)
                 ADD LN-INSPREM(SUB) TO TY-INS-AMT-WROTE(SUB)
              ELSE
                 ADD 1 TO TY-INS-NO-NOTWROTE(SUB).

      *********************************************************
       UPDATE-FM1-FILE SECTION.
      *********************************************************
           MOVE 0 TO FM-SUB NO-CREATE-FG.
           PERFORM OPEN-FD1-FILE.

      * SAVE ORIGINAL FM-PATH, COULD BE SET FROM LNCREA, DONT WANT
      * TO ASSUME ITS ../LP/FMFILE, AND CORPORATE PRINT NEEDS TO
      * ALTER IT.

      * MUST LOAD IT TO GET PATH SET FIRST, IF OVERRIDE WAS SET TO 
      * A "B", IT WILL LOAD THE LNCREA BRANCH, OTHERWISE, IT WILL
      * LOAD THE EXTERNAL
           PERFORM LOAD-FM1-FILE.

      * NOW SAVE IT, AND SET THE OVERRIDE TO NOT GET CHANGED!
           MOVE FM-PATH TO HOLD-FM-PATH.
           MOVE "Y" TO FM-PATH-OVERRIDE.
      * THIS PATH MUST STAY AS IS IF COMING FROM LNCREA, YOU DO NOT CREATE
      * FORM REQUEST IN THE LOCAL EXT-FILPATH IF UPDATING FROM LNCREA!
      * WE MUST ONLY CHANGE THE FM-PATH IF USING CORPORATE PRINT AND THEN
      * PUT IT BACK WHEN DONE, USING THE HOLD-FM-PATH

       CREATE-FM.
           ADD 1 TO FM-SUB.
           IF FM-SUB > 20
              GO TO EXIT-UPDATE-FM1.
           IF SP-PRFORM(FM-SUB) = 0
              GO TO CREATE-FM.

           IF FM-SUB NOT = 2
              IF SP-PRFLAG(FM-SUB) NOT = "Y"
                 GO TO CREATE-FM.

           IF FM-SUB = 4
              GO TO CREATE-FM.

      * FAIRCO:
      *    IF GB-DLALLOC-GL = "Y"
      *              AND DL-WELCOME-FMNO = SP-PRFORM(FM-SUB)
      *       MOVE DL-WELCOME-FMNO-TO-USE TO FD-FMNO
      *    ELSE
              MOVE SP-PRFORM(FM-SUB) TO FD-FMNO.

           PERFORM READ-FD1-FILE.
           IF IO-FG NOT = 0
              GO TO CREATE-FM.

           IF FM-SUB = 2
              MOVE FD-FMNO TO SAVE-CK-FMNO
              GO TO CREATE-FM.

           IF ( FD-OPTION-EXTRACTION )
              PERFORM GET-FM-PATH.

           PERFORM OPEN-FM1-FILE.

           PERFORM CLEAR-FM-FILE.

           MOVE SPACES             TO LPWSFM-EDIT-FM-INITKEY.

           MOVE LN-ACCTNO          TO LPWSFM-EDIT-FM-ACCTNO.
           MOVE FD-FMNO            TO LPWSFM-EDIT-FM-FORMNO.
      * LPWSFM-EDIT-FM-BRNO2 IS THE LAST 4 OF FM-INITKEY
           IF ( FD-OPTION-EXTRACTION )
              MOVE LN-OWNBR        TO LPWSFM-EDIT-FM-BRNO2.

           MOVE FM-PATH-OWNBR          TO FM-BRNO.
           MOVE LPWSFM-EDIT-FM-INITKEY TO FM-INITKEY.
           MOVE FD-FMNO                TO FM-FMNO.

           PERFORM READ-FM1-FILE.

      * EXISTS ? RESET ZIP, PRINT, BRNO; NO ? CREATE.

           MOVE FM-PATH-OWNBR          TO FM-BRNO.
           MOVE LPWSFM-EDIT-FM-INITKEY TO FM-INITKEY.
           MOVE FD-FMNO                TO FM-FMNO.

           MOVE HOLD-BW-ZIP        TO FM-ZIP.
           MOVE SPACES             TO FM-PRINT.
           MOVE 0                  TO FM-STMT-COUNTER.
           MOVE TRANS-DATE         TO FM-TRDATE.
           MOVE EXT-CONAME-USER-ID TO FM-USERID.

           IF IO-FG = 0
              PERFORM REWRITE-FM1-FILE
           ELSE
              PERFORM WRITE-FM1-FILE
              IF IO-FG NOT = 0
                 GO TO IO-ERROR.

           PERFORM CLOSE-FM1-FILE.

      * MUST RESET PATH FOR NEXT FORM #, MIGHT NOT BE CORPORATE
      * AND ALSO FOR CHECK WRITING
      * THIS MUST BE A " ", NOT A "B", NEEDS TO USE EXT-FIL UNLESS
      * COMING IN FROM LNCREA
           MOVE HOLD-FM-PATH               TO FM-PATH.

           GO TO CREATE-FM.

       EXIT-UPDATE-FM1.
           PERFORM CLOSE-FD1-FILE.

      *********************************************************
       UPDATE-LT1-FEE-FILE SECTION.
      *********************************************************
           PERFORM OPEN-LTF1-FILE.
           PERFORM OPEN-CDB1-FILE.

           MOVE "N" TO WRITE-THE-LT.

           PERFORM CLEAR-LTF-FILE.

           MOVE LN-OWNBR  TO LTF-BRNO.
           MOVE LN-ACCTNO TO LTF-ACCTNO.
           MOVE 1         TO LTF-SEQNO.

           PERFORM VARYING SUB-LT FROM 1 BY 1 UNTIL SUB-LT > 10
              MOVE 0 TO LTF-FEECODE-PAYABLE(SUB-LT)
           END-PERFORM.

           MOVE 0 TO SUB-LT.
       UPDATE-LT1-FEE-NEXT.
           ADD 1 TO SUB-LT.
           IF SUB-LT > 10
              GO TO END-UPDATE-LT1-FEE-FILE.

      * MUST BE OUR FEE
           IF LN-FEEAMT(SUB-LT) = 0 OR
               LN-FEEOURS(SUB-LT) NOT = "Y"
              GO TO UPDATE-LT1-FEE-NEXT.

           MOVE "GC"               TO CDB-TYPE.
           MOVE LN-OWNBR           TO CDB-BRANCH.
           MOVE LN-FEECODE(SUB-LT) TO CDB-CODE.
           PERFORM READ-CDB1-FILE.
           IF IO-FG NOT = 0
              GO TO UPDATE-LT1-FEE-NEXT.

           IF (CDB-GC-COMM-PERCENT = 99.99)
              MOVE 100 TO HOLD-COMM-PERCENT
           ELSE
              MOVE CDB-GC-COMM-PERCENT TO HOLD-COMM-PERCENT.
           IF HOLD-COMM-PERCENT NOT = 0 AND 
                                  NOT = 20.20
              COMPUTE LTF-FEECODE-PAYABLE(SUB-LT) ROUNDED =
                    HOLD-COMM-PERCENT / 100 * LN-FEEAMT(SUB-LT)
              MOVE LN-FEECODE(SUB-LT) TO LTF-FEECODE(SUB-LT)
              MOVE "Y" TO WRITE-THE-LT.

           GO TO UPDATE-LT1-FEE-NEXT.

       END-UPDATE-LT1-FEE-FILE.
           IF WRITE-THE-LT = "Y"
              PERFORM WRITE-LTF1-FILE.

       EXIT-UPDATE-LT1-FEE-FILE.
           PERFORM CLOSE-LTF1-FILE.
           PERFORM CLOSE-CDB1-FILE.

      *****************************************
       UPDATE-LTC1-FILE SECTION.
      *****************************************
           MOVE 6 TO WK-KEY.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9 OR WK-SAVE-RECORD = SPACES
              GO TO EXIT-UPDATE-LTC.

           MOVE SPACES TO LTC-REC.
           PERFORM OPEN-LTC1-FILE.

           IF WK-DESC-1 NOT = SPACES OR
                WK-DESC-2 NOT = SPACES OR
                 WK-HHGS-1 NOT = SPACES OR
                  WK-HHGS-2 NOT = SPACES OR
                   WK-HHGS-3 NOT = SPACES
              MOVE LTC-PATH-OWNBR    TO LTC-BRNO
              MOVE LN-ACCTNO     TO LTC-ACCTNO
              MOVE 1             TO LTC-SEQNO
              MOVE WK-DESC-1     TO LTC-DESC(1)
              MOVE WK-MAKE-1     TO LTC-MAKE(1)
              MOVE WK-MODEL-1    TO LTC-MODEL(1)
              MOVE WK-YEAR-1     TO LTC-YEAR(1)
              MOVE WK-STYLE-1    TO LTC-STYLE(1)
              MOVE WK-CLASS-1    TO LTC-CLASS(1)
              MOVE WK-VIN-1      TO LTC-VIN(1)
              MOVE WK-TITLE-NO-1 TO LTC-TITLE-NO(1)
              MOVE WK-MILEAGE-1  TO LTC-MILEAGE(1)
              MOVE WK-VALUE-1    TO LTC-VALUE(1)
              MOVE WK-SELLPR-1   TO LTC-SELLPR(1)
              MOVE WK-MISC-AMT-1 TO LTC-MISC-AMT(1)
              MOVE WK-SENT-FLAG-1 TO LTC-SENT-FLAG(1)
              MOVE 0              TO LTC-VIN-CHG-DATE(1)

              MOVE WK-DESC-2     TO LTC-DESC(2)
              MOVE WK-MAKE-2     TO LTC-MAKE(2)
              MOVE WK-MODEL-2    TO LTC-MODEL(2)
              MOVE WK-YEAR-2     TO LTC-YEAR(2)
              MOVE WK-STYLE-2    TO LTC-STYLE(2)
              MOVE WK-CLASS-2    TO LTC-CLASS(2)
              MOVE WK-VIN-2      TO LTC-VIN(2)
              MOVE WK-TITLE-NO-2 TO LTC-TITLE-NO(2)
              MOVE WK-MILEAGE-2  TO LTC-MILEAGE(2)
              MOVE WK-VALUE-2    TO LTC-VALUE(2)
              MOVE WK-SELLPR-2   TO LTC-SELLPR(2)
              MOVE WK-MISC-AMT-2 TO LTC-MISC-AMT(2)
              MOVE WK-SENT-FLAG-2 TO LTC-SENT-FLAG(2)
              MOVE 0              TO LTC-VIN-CHG-DATE(2)

              MOVE WK-HHGS-1 TO LTC-HHGS(1)
              MOVE WK-HHGS-2 TO LTC-HHGS(2)
              MOVE WK-HHGS-3 TO LTC-HHGS(3)
              PERFORM WRITE-LTC1-FILE.

           PERFORM CLOSE-LTC1-FILE.
       EXIT-UPDATE-LTC.
           EXIT.

      *****************************************************
       UPDATE-LT1-A-FILE SECTION.
      *****************************************************

           PERFORM OPEN-PC1-FILE.
           PERFORM OPEN-LTA1-FILE.

           MOVE "A"                        TO PC-ID.
           MOVE BRANCH                     TO PC-BRANCH.
           MOVE LN-SSNO(1)                 TO PC-SOC-SEC.
           PERFORM READ-PC1-FILE.
           IF ( IO-BAD )
              GO TO UPDATE-LT1-A-FILE-END.

           MOVE PC-LTA-AUTO-RECORD         TO WK-LTA-RECORD.

           PERFORM CLEAR-LTA-FILE.

           MOVE LN-OWNBR                   TO LTA-BRNO.
           MOVE LN-ACCTNO                  TO LTA-ACCTNO.
           MOVE 1                          TO LTA-SEQNO.

           MOVE WK-LTA-DLR-REQ            TO LTA-DLR-REQ.
           MOVE WK-LTA-INS-TYPE           TO LTA-INS-TYPE.
           MOVE WK-LTA-INS-CO             TO LTA-INS-CO.
           MOVE WK-LTA-POLICY-NO          TO LTA-POLICY-NO.
           MOVE WK-LTA-AGENCY             TO LTA-AGENCY.
           MOVE WK-LTA-AGENT              TO LTA-AGENT.

           MOVE WK-LTA-ADR1               TO LTA-ADR1.
           MOVE WK-LTA-ADR2               TO LTA-ADR2.
           MOVE WK-LTA-CITY               TO LTA-CITY.
           MOVE WK-LTA-STATE              TO LTA-STATE.
           MOVE WK-LTA-ZIP                TO LTA-ZIP.
           MOVE WK-LTA-PHONE              TO LTA-PHONE.
           MOVE WK-LTA-EFF-DATE           TO LTA-EFF-DATE.
           MOVE WK-LTA-EXP-DATE           TO LTA-EXP-DATE.
           MOVE WK-LTA-CAN-DATE           TO LTA-CAN-DATE.
           MOVE WK-LTA-CONF-DATE          TO LTA-CONF-DATE.
           MOVE WK-LTA-LAST-FORM          TO LTA-LAST-FORM.

           MOVE WK-LTA-COV-TYPE           TO LTA-COV-TYPE.
           MOVE WK-LTA-BIL-COV            TO LTA-BIL-COV.
           MOVE WK-LTA-PDL-COV            TO LTA-PDL-COV.
           MOVE WK-LTA-PIP-COV            TO LTA-PIP-COV.
           MOVE WK-LTA-UMB-COV            TO LTA-UMB-COV.
           MOVE WK-LTA-COL-COV            TO LTA-COL-COV.
           MOVE WK-LTA-LOSS-PAYEE         TO LTA-LOSS-PAYEE.
           MOVE WK-LTA-COM-COV            TO LTA-COM-COV.

           PERFORM WRITE-LTA1-FILE.

           PERFORM DELETE-PC1-FILE.

       UPDATE-LT1-A-FILE-END.
           PERFORM CLOSE-LTA1-FILE.
           PERFORM CLOSE-PC1-FILE.

       UPDATE-LT1-A-FILE-EXIT.
           EXIT.

      *****************************************************
       UPDATE-LM-APPROVAL SECTION.
      *****************************************************

           IF WS-MEMO-APPROVAL-USERID = SPACES
              GO TO EXIT-UPDATE-LM-APPROVAL.

           MOVE "UPDATING APPROVAL TO LOAN MEMO FILE...." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-LM1-FILE.
           MOVE WS-MEMO-APPROVAL TO LM-MEMO.
           PERFORM WRITE-MEMO-LINE.
           PERFORM CLOSE-LM1-FILE.

       EXIT-UPDATE-LM-APPROVAL.
           EXIT.


      ********************************************************
       WRITE-MEMO-LINE SECTION.
      ********************************************************

           MOVE LM-PATH-OWNBR TO LM-BRNO.
           MOVE LN-ACCTNO     TO LM-ACCTNO.
           SUBTRACT TRANS-DATE FROM 99999999 GIVING LM-DATE.
           ADD 1              TO HOLD-LM-SEQ.
       WRITE-MEMO-AGAIN.
           MOVE HOLD-LM-SEQ TO LM-SEQ.
           PERFORM WRITE-LM1-FILE.
           IF IO-FG NOT = 0
              IF LM-SEQ NOT = 999
                 ADD 1 TO HOLD-LM-SEQ
                 GO TO WRITE-MEMO-AGAIN
              ELSE
                 MOVE "MAXIMUM LINES FOR DAY ALREADY CREATED"
                                               TO MESS
                 PERFORM SEND-MESS.


      ********************************************************************
       FORM-RESET SECTION.
      ********************************************************************
           MOVE LPLOAN-SYSDATE TO LONPB-SYSDATE.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DISPLAY LONPB-SCREEN UPON TCLP-MAIN-WINDOW-HANDLE.
           MOVE LONPB-FORM-FIELDS TO WR-BUF.
           MOVE LONPB-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.
       FORM-RESET-EXIT.
           EXIT.

      ********************************************************************
       SETUP-LINK-INFO SECTION.
      ********************************************************************
           MOVE LONPB-HELP--FILE TO HELP-LINK-FILE.
           MOVE LONPB-HELP--DIR TO HELP-LINK-DIR.

      ********************************************************************
       VDU-CONVERT-FIELD SECTION.
      ********************************************************************
           MOVE "00" TO STAT.
           MOVE VDU-FIELD-TO-CONVERT TO VDU-ALP-FIELD.
           EVALUATE TRUE
              COPY "LIBLP/LONPB_EVA.CPY".
              WHEN OTHER       MOVE   "2A" TO STAT
           END-EVALUATE.

       COPY "LIBLP/LPEADJ.CPY".
       COPY "LIBLP/LPRATE.CPY".
       COPY "LIBLP/LPIBPC.CPY".
       COPY "LIBLP/LPXDTE.CPY".
       COPY "LIBLP/LPMDTE.CPY".
       COPY "LIBLP/LPCEPP.CPY".
       COPY "LIBLP/LPUERN.CPY".
       COPY "LIBLP/LPEARN.CPY".
       COPY "LIBLP/LPCERN.CPY".
       COPY "LIBLP/LPREGZ.CPY".
       COPY "LIBLP/LPAMTS.CPY".
       COPY "LIBGB/SPPDTH.CPY".
       COPY "LIBGB/DATER.CPY".
       COPY "LIBGB/SCREEN.CPY".
       COPY "LIBLP/YIELDLN.CPY".
       COPY "LIBLP/OURSLN.CPY".
       COPY "LIBLP/SETCTBL.CPY".
       COPY "LIBGB/REBATE.CPY".
       COPY "LIBLP/LPITRM.CPY".
       COPY "LIBGB/AGEING.CPY".
       COPY "LIBLP/LPAPRS.CPY".
       COPY "LIBLP/LPAPRZ.CPY".
       COPY "LIBLP/LPUPER.CPY".
       COPY "LIBLP/LPUPWK.CPY".
       COPY "LIBGB/RBACT.CPY".
       COPY "LIBLP/LPIEXP.CPY".
       COPY "LIBLP/POSTDATE.CPY".
       COPY "LIBLP/LPSRCD.CPY".
       COPY "LIBLP/LPBXCL.CPY".
       COPY "LIBLP/LPLTACL.CPY".
       COPY "LIBLP/LPLTFCL.CPY".
       COPY "LIBLP/LPFMCL.CPY".
       COPY "LIBGB/GPENV.CPY".
       COPY "LIBLP/LPPDUE.CPY".
       COPY "LIBLP/LNCOST.CPY".
       COPY "LIBLP/SETINITLFP.CPY".

      ********************************************************
      *   FOR UPDATE OF 'TY' & 'DS' FILES
      ********************************************************
       SET-DELINQUENCY SECTION.
      ********************************************************
           MOVE TRANS-DATE TO AGEING-DATE.
           PERFORM COMPUTE-CONTRACTUAL.
           PERFORM COMPUTE-RECENCY.

      ********************************************************
       GET-ACCOUNT-NUMBER SECTION.
      ********************************************************

           PERFORM OPEN-GB-FILE.
           MOVE LN-OWNBR TO GB-BRNO.
           MOVE 1        TO GB-NO.
           PERFORM READ-GB-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

      * DO NOT ALLOW 0 ACCOUNT NUMBER:
           IF GB-NEXT-SF = 0
              ADD 1 TO GB-NEXT-SF.

           MOVE GB-NEXT-SF TO LN-ACCTNO.
           ADD 1 TO GB-NEXT-SF.

           PERFORM REWRITE-GB-FILE.
           PERFORM CLOSE-GB-FILE.

       GET-ACCOUNT-NUMBER-EXIT.
           EXIT.

      ********************************************************
      * SETUP-LOCAL-PATHS SECTION.
      *********************************************************

      *     MOVE BRANCH TO BR-NO.
      *     PERFORM READ-BR-FILE.
      *     IF IO-BAD
      *        GO TO IO-ERROR.
      *                 
      *     MOVE EXT-FILPATH-BASE           TO FILPATH-BASE.
      *     MOVE BR-MACHINE                 TO FILPATH-MACHINE.
      *     MOVE BR-DATA-PATH               TO FILPATH-DATA.

      *     MOVE "B"                        TO BW-PATH-OVERRIDE 
      *                                        CK-PATH-OVERRIDE
      *                                        CX-PATH-OVERRIDE
      *                                        DL-PATH-OVERRIDE
      *                                        DS-PATH-OVERRIDE
      *                                        DT-PATH-OVERRIDE
      *                                        FM-PATH-OVERRIDE
      *                                        GB-PATH-OVERRIDE
      *                                        IC-PATH-OVERRIDE
      *                                        IX-PATH-OVERRIDE
      *                                        LM-PATH-OVERRIDE
      *                                        LN-PATH-OVERRIDE
      *                                        LP-PATH-OVERRIDE
      *                                        LTA-PATH-OVERRIDE
      *                                        LTB-PATH-OVERRIDE
      *                                        LTC-PATH-OVERRIDE
      *                                        LTF-PATH-OVERRIDE
      *                                        LTI-PATH-OVERRIDE
      *                                        LTP-PATH-OVERRIDE
      *                                        LX-PATH-OVERRIDE
      *                                        LXE-PATH-OVERRIDE
      *                                        NO-PATH-OVERRIDE
      *                                        PC-PATH-OVERRIDE
      *                                        PD-PATH-OVERRIDE
      *                                        TY-PATH-OVERRIDE
      *                                        TRS-PATH-OVERRIDE
      *                                        TRC-PATH-OVERRIDE.

      ** - - - - - - - - - - - - - - - -{ NO IO FOR IX FILE - HARDCODED }
      *     MOVE FILPATH-BASE               TO IX-ALL-BASE.
      *     MOVE FILPATH-MACHINE            TO IX-ALL-MACHINE.
      *     MOVE FILPATH-DATA               TO IX-ALL-DATA.
      *     MOVE IX-ALL-PATH                TO IX-PATH    CREAIX-IX-PATH.


      ********************************************************
      * IF FORM IS AN "E" EXTRACTION TYPE FORM (FD-OPTION), THEN
      * PUT THE CORPORATE BRNO PATH IN THE FM-PATH, SO ALL FORM REQUESTS
      * ARE CREATED IN THE HOME OFFICE, THEN WHEN THEY GO "PRINT" THEM ALL
      * IT WILL CREATE AN ASCII FILE
      ********************************************************
       GET-FM-PATH SECTION.
      ********************************************************

           IF GP-CORP-BRNO = 0
              GO TO EXIT-GET-FM-PATH.

           MOVE GP-CORP-BRNO TO BR-NO.
           PERFORM READ-BR-FILE.
           IF IO-FG = 9
              GO TO END-GET-FM-PATH.

           MOVE EXT-FILPATH-BASE           TO FM-ALL-BASE.
           MOVE BR-MACHINE                 TO FM-ALL-MACHINE.
           MOVE BR-DATA-PATH               TO FM-ALL-DATA.
           MOVE FM-ALL-PATH                TO FM-PATH.
           MOVE "Y"                        TO FM-PATH-OVERRIDE.

       END-GET-FM-PATH.
      * GET ORIGINAL BRANCH BACK
           MOVE LN-OWNBR TO BR-NO.
           PERFORM READ-BR-FILE.

       EXIT-GET-FM-PATH.
           EXIT.


      ************************************************
       MISC-PARAGRAPHS SECTION.
      ************************************************
       COPY "LIBGB/GETENV.CPY".
       COPY "LIBGB/ACCESS.CPY".
       COPY "LIBGB/DACCESS.CPY".
       COPY "LIBGB/SYSTEM.CPY".
       MOVE-LXM-FIELDS.
           MOVE "M"                TO LXM-CODE.
           MOVE 0                  TO LXM-MIP-CLPAID
                                      LXM-MIP-AHPAID.
           MOVE LN-MIP-CLPDTH-DATE TO LXM-MIP-CLPDTH-DATE.
           MOVE LN-MIP-AHPDTH-DATE TO LXM-MIP-AHPDTH-DATE.
       SEND-WSEL-LEGEND.
           MOVE WSEL-LIST TO WR-LIST.
           MOVE MESS TO WR-BUF.
           PERFORM CALL-WRFORM.
      *=================================================================
       GET-COLLATERAL.
           PERFORM OPEN-CD1-FILE.
           MOVE "CO"      TO CD-TYPE.
           MOVE LN-COLLCD TO CD-CODE.
           PERFORM READ-CD1-FILE.
           IF IO-FG NOT = 0
              MOVE " " TO CD-CO-SECURED.
           PERFORM CLOSE-CD1-FILE.
       SET-EARNINGS.
           MOVE UERN-EARNINGS(SUB) TO LN-UFERN(SUB) LN-ACCERN(SUB).
           MOVE SP-EARN-ORDER(SUB) TO LN-EARN-ORDER(SUB).
           ADD 1 TO SUB.
       UPDATE-ACCERN.
           IF LN-ACCERN(SUB) NOT = 0
              MOVE LN-EARN-ORDER(SUB) TO E-SUB
              IF E-SUB > 0 AND < 7
                 MOVE LN-ACCERN(SUB) TO EARNING-WK(E-SUB).
           ADD 1 TO SUB.
       SET-PD1-KEY.
           MOVE "R"         TO PD-ID.
           MOVE BRANCH      TO PD-BRANCH.
           MOVE SAVE-PRLNNO TO PD-SOC-SEC.
       SET-DS1-KEY.
           MOVE TRANS-DATE-YYYYMM TO DS-DATE-CCYYMM.
           MOVE LN-OWNBR TO DS-BRANCH.
           MOVE LN-DLNO  TO DS-DLNO.
           MOVE LN-CLASS TO DS-CLASS.
       SET-TY-KEY.
           MOVE LN-OWNBR TO TY-BRNO.
           MOVE TRANS-DATE TO TY-DATE.
           MOVE LN-CLASS TO TY-CLASS.
       SEND-LEGEND.
           MOVE MESS TO WR-BUF.
           MOVE MSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
      *    CALL XFER USING STAT MSEL-LIST MESS.
      *    CALL WRFORM USING STAT MSEL-LIST.
       SETUP-DT-RECORD.
           PERFORM CLEAR-DT-FILE.

           MOVE BRANCH TO DT-BRNO.
           MOVE LN-DLNO TO DT-DLNO.
           MOVE LN-CLASS TO DT-CLASS.
           MOVE LN-ACCTNO TO DT-ACCTNO.
           MOVE TRANS-DATE TO DT-DATE.
           MOVE SAVE-DT-SEQ TO DT-SEQ.
           IF LN-SERVACCT = "Y"
              MOVE "S" TO DT-TYPE
           ELSE
              MOVE "P" TO DT-TYPE.
           MOVE SAVE-LP-SEQNO TO DT-LPSEQNO.
           MOVE "NW" TO DT-TRCD.
           MOVE LN-DLRVPRIN(1) TO DT-DLRVPRIN(1).
           MOVE LN-DLRVPRIN(2) TO DT-DLRVPRIN(2).
           MOVE LN-DLRVPRIN(3) TO DT-DLRVPRIN(3).
           MOVE LN-DLRVCHGS(1) TO DT-DLRVCHGS(1).
           MOVE LN-DLRVCHGS(2) TO DT-DLRVCHGS(2).
           MOVE LN-DLRVCHGS(3) TO DT-DLRVCHGS(3).
           MOVE LN-DLPARVHELD TO DT-DLPARVHELD.
           MOVE LN-DLPARVPAID TO DT-DLPARVPAID.
           MOVE LN-PURBAL TO DT-PURBAL.

       CONDITIONAL-SEND-MESS.
      *    IF LPLOAN-CALLED-FROM NOT = "LNCREA"
              PERFORM SEND-MESS.
      *    ELSE
      *       IF LPLOAN-RETURN-ERR-BUF = SPACES
      *          MOVE MESS TO LPLOAN-RETURN-ERR-BUF.

      *********************************
      *      F I L E   I / O          *
      *********************************
       COPY "LIBLP/LPCKCL.CPY".
       COPY "LIBLP/LPCXCL.CPY".
       COPY "LIBLP/LPTYCL.CPY".
       COPY "LIBLP/LPDSCL.CPY".
       COPY "LIBLP/LPDTCL.CPY".
       COPY "LIBLP/LPLPCL.CPY".
       COPY "LIBLP/LPLXCL.CPY".
       COPY "LIBLP/LPLXECL.CPY".
       COPY "LIBLP/LPTRSCL.CPY".
       COPY "LIBLP/LPTRCCL.CPY".

      ************************************************
       IO-ROUTINE SECTION.
      ************************************************
       COPY "LIBGB/CONNECT_SQL.CPY".
       COPY "LIBLP/LPTYGS_SQL.CPY".
       COPY "LIBLP/LPTRSGS_SQL.CPY".
       COPY "LIBLP/LPTRCGS_SQL.CPY".
       COPY "LIBLP/LPSPGS_SQL.CPY".
       COPY "LIBLP/LPPDGS_SQL.CPY".
       COPY "LIBLP/LPPCGS_SQL.CPY".
       COPY "LIBLP/LPNOGS_SQL.CPY".
       COPY "LIBLP/LPLXEGS_SQL.CPY".
       COPY "LIBLP/LPLXGS_SQL.CPY".
       COPY "LIBLP/LPLTPGS_SQL.CPY".
       COPY "LIBLP/LPLTIGS_SQL.CPY".
       COPY "LIBLP/LPLTFGS_SQL.CPY".
       COPY "LIBLP/LPLTCGS_SQL.CPY".
       COPY "LIBLP/LPLTBGS_SQL.CPY".
       COPY "LIBLP/LPLTAGS_SQL.CPY".
       COPY "LIBLP/LPLPGS_SQL.CPY".
       COPY "LIBLP/LPLNGS_SQL.CPY".
       COPY "LIBLP/LPLMGS_SQL.CPY".
       COPY "LIBLP/LPLCGS_SQL.CPY".
       COPY "LIBLP/LPICGS_SQL.CPY".
       COPY "LIBLP/LPFMGS_SQL.CPY".
       COPY "LIBLP/LPFDGS_SQL.CPY".
       COPY "LIBLP/LPDTGS_SQL.CPY".
       COPY "LIBLP/LPDSGS_SQL.CPY".
       COPY "LIBLP/LPDLGS_SQL.CPY".
       COPY "LIBLP/LPCXGS_SQL.CPY".
       COPY "LIBLP/LPCKGS_SQL.CPY".
       COPY "LIBLP/LPCDBGS_SQL.CPY".
       COPY "LIBLP/LPCDGS_SQL.CPY".
       COPY "LIBLP/LPBXGS_SQL.CPY".
       COPY "LIBLP/LPBWGS_SQL.CPY".
       COPY "LIBGB/GBGBGS_SQL.CPY".
       COPY "LIBGB/GBBRGS_SQL.CPY".
       COPY "LIBGB/GBGBIN.CPY".
       COPY "LIBGB/GBBRRN.CPY".
       COPY "LIBLP/LPLC1RN.CPY".
       COPY "LIBLP/LPDL1RN.CPY".
       COPY "LIBLP/LPLM1IN.CPY".
       COPY "LIBLP/LPNO1IN.CPY".
       COPY "LIBLP/LPLN1IN.CPY".
      * CALLED-FROM NEEDS TO STAY AS LNCREA IN HERE!! SO BICREA KNOWS
       COPY "LIBLP/LPLP1IN.CPY".
       COPY "LIBLP/LPLX1IN.CPY".
       COPY "LIBLP/LPLXE1IN.CPY".
       COPY "LIBLP/LPSP1RN.CPY".
       COPY "LIBLP/LPBW1IN.CPY".
       COPY "LIBLP/LPBX1IN.CPY".
       COPY "LIBLP/LPTY1IN.CPY".
       COPY "LIBLP/LPCD1RN.CPY".
       COPY "LIBLP/LPCDB1RN.CPY".
       COPY "LIBLP/LPDS1IN.CPY".
       COPY "LIBLP/LPPD1IN.CPY".
       COPY "LIBLP/LPPC1IN.CPY".
       COPY "LIBLP/LPWKI.CPY".
       COPY "LIBLP/LPCX1IN.CPY".
       COPY "LIBLP/LPTRC1IN.CPY".
       COPY "LIBLP/LPTRS1IN.CPY".
       COPY "LIBLP/LPDT1IN.CPY".
       COPY "LIBLP/LPFD1RN.CPY".
       COPY "LIBLP/LPFM1IN.CPY".
       COPY "LIBLP/LPCK1IN.CPY".
       COPY "LIBLP/LPLTC1IN.CPY".
       COPY "LIBLP/LPLTA1IN.CPY".
       COPY "LIBLP/LPLTB1IN.CPY".
       COPY "LIBLP/LPLTP1RN.CPY".
       COPY "LIBLP/LPLTF1IN.CPY".
       COPY "LIBLP/LPLTI1RN.CPY".
       COPY "LIBLP/LPIC1RN.CPY".

      **************************************************************
      *   ARCHIVED LNFILE IO
      **************************************************************
      *OPEN-ARCH-LN1-FILE.
      *    PERFORM OPEN-IT.
      *    MOVE LN-ARCHIVE-PATH TO E-FILE.
      *    OPEN INPUT ARCH-LN-FILE.
      *    IF IO-FG = 8
      *      GO TO OPEN-ARCH-LN1-FILE.
      *    IF IO-FG = 7
      *      CLOSE ARCH-LN-FILE
      *      GO TO OPEN-ARCH-LN1-FILE.
      *    UNLOCK ARCH-LN-FILE.
      *READ-ARCH-LN1-FILE.
      *    PERFORM READ-IT.
      *    MOVE LN-ARCHIVE-PATH TO E-FILE.
      *    MOVE ARCH-LN1-KEY TO E-KEYX.
      *    READ ARCH-LN-FILE.
      *    IF IO-FG = 8
      *      GO TO READ-ARCH-LN1-FILE.
      *CLOSE-ARCH-LN1-FILE.
      *    PERFORM CLOSE-IT.
      *    CLOSE ARCH-LN-FILE.
      **************************************************************
       COPY "LIBGB/FERRORS.CPY".
           MOVE "E" TO ERRCD.

      **************************************************************
       END-ROUTINE SECTION.
      **************************************************************
           PERFORM CLOSE-FILES.
           DESTROY ALL.
       EXIT-PROG.
       STOP-RUN.
           EXIT PROGRAM.
