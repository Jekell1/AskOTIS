       IDENTIFICATION DIVISION.
       PROGRAM-ID.      LONPF2.
       DATE-WRITTEN.    021784.
      ******************************************************************
      *  DIRECTORY  :  LP
      *  DESCRIPTION:  LOAN PROCESSING TRANSACTION UPDATE
      *
      *      NOTE:
      *           "TS" & "TP" LP-TRCD ARE NOT INCLUDED
      *
      *           "AP" REVOLVING IS UPDATED IN LONPFX.C
      *
      *           "RV" OF ADDON RECORDS IS UPDATED IN LONPFF.C
      * NOTE:
      *  UPDATE ORDER: BW,CA,,LM,DS,TY,LN,LT,TR,DT,LP
      *         ** NF & LM ARE UPDATED ONLY WHEN GP-NF-UPD-REFNO
      *            CODES ARE IN USE.
      *      ========================================================
      *      INSURANCE COMMISSION IS SET CORRECTLY IN THE TR-FILE
      *      WITH THE FOLLOWING CODES:
      *                               "CC" "CA" "CP" "C1" "C2" "C3"
      *      ========================================================
      *
      * REV:
      *  042495 BAH SET LP-USERID LP-POSTTIME LP-POSTDATE
      *                 LP-REVTRCD LP-REVSEQNO
      *  042995 SLC ADDED PLTYPE LOGIC.
      *  051395 JTG ADDED LOGIC FOR SX, SV AND SS TRANCODES.
      *  061595 BLL ADDED TP-MAX-DEFER-FG
      *  062895 MJD ADDED COPY MEMBERS LIBLP/POSTDATE AND POSTDATEW.
      *             SET TP-USERID, POSTTIME, AND POSTDATE.
      *  070795 JTG ADDED TEST FOR SP-LCFRMLA = 'L', MERCURY (UCCC)
      *  071995 JTG ADDED SET OF PD-PRPDUE-DAYS FOR RENEWALS
      *  072095 JTG ADDED SET OF LN-PLAMT
      *  072195 JTG ADDED LPSRCD LOGIC
      *  072395 JTG ADDED SET OF LN-BI-FG TO TRIGGER BIFILE UPDATE
      *  072895 JTG ADDED LOGIC FOR DELSUB-SET ROUTINE
      *  080495 JTG ADDED LOGIC FOR SET OF LP-REVSEQNO ON REVERSED
      *             REFUNDS OF PAYOFF'S
      *  081095 JTG ADDED TO LN-TOTEXCPAYMNTD FOR 'Z2' PAYMENTS.
      *  081195 MJD ADDED GP-FILE INFO FOR LIBLP/LPSRCD :
      *                   GP-THE-ONLY-SF-SRCD.
      *  082495 JTG ADDED UPDATE OF LN-MTD-PRIN, LN-MTD-LC, LN-MTD-INT
      *                   LN-MTD-OT LN-MTD-EX
      *  082595 JTG ADDED TEST FOR SP-LCFRMLA = 'M', MERCURY (LA)
      *  MJD 091495 ADDED LOGIC FOR DS-DATE.
      *  JTG 092595 ADDED LOGIC FOR INTER BRANCH PAYMENTS
      *  JTG 092895 CORRECTED NOT UPDATING TYFILE ON CONV-REV WINDOW
      *             RE: 'NSF'
      *  JTG 100395 CORRECTED UPDATE OF DSFILE RE: O2 & W2 AND REPO AR
      *  BAH 101095 EDIT-FM-KEY WAS NOT BIG ENOUGH FOR EDIT-CX-KEY TO
      *             REDEFINE IT, THEREFORE, REBATE CHECKS WILL NOT PRINT.
      *  JTG 110995 ADDED LOGIC FOR TY-(DELINQ) UPDATE TO BYPASS UPDATE
      *             OF VOLUME
      *  MJD 020796 ADDED UPDATE OF DEALER RESERVES IN TY-REC.
      *  MJD 021296 ADDED UPDATES OF PL TABLE, PL RECOVERIES AND O2 BALS
      *  BAH 022896 ADDED E-CODE TEST OF "22" ON WRITE-TY1-FILE.
      *  KEC 031296 ON UPDATING PD-REC, MOVED ZEROES AND SPACES TO
      *             PD-APPROVAL-*.
      *  JTG 031396 CHANGED GET-ORIG-LN-PLSUB  SECTION, TO DEFAULT TO 1
      *  MJD 040996 ADDED FORM UPDATE OF 1ST PAY DATE ( FLD. H02.)
      *  JTG 042996 ADDED LOGIC TO UPDATE DS-AFPDLLP-MEMO
      *  JTG 051496 CORRECT SET OF TP-REFNO ON 'RV' FOR PAYOFF LP-REC
      *             LINES, OTHER THAN SUB 0. MADE TP-REFNO REFLECT THE
      *             TRANSACTION CODE OF THE REFUND.
      *  BAH 061496 AN ACCT HAD -AL IN STATUSFLAGS, REVERSING THE "AC"
      *             LEFT A SPACE, WHICH WOULDNT ALLOW THE "L" TO DISPLAY
      *             RAC #031
      *  BAH 070996 FIXED TP-REVTRCD AND TP-REVSEQNO, THEY WERE MOVING IN
      *             THE LP- VALUES, WHICH WERE NOT EVEN SET YET !!, RAC #0013
      *  MJD 071196 ADDED TEST OF LN-UNITPER-CD FOR WEEKLY PDTH.
      *  MJD 071896 ADDED TP-UNITPER-CD AND TP-UNITPER-FREQ.
      *  MJD 071996 ADDED LOGIC TO PRINT LN-1STPYDATE AS MM/DDWYY
      *             FOR WEEKLY UNIT PERIODS.
      *  JTG 073196 ADDED ZERO CLEAR OF CX-DT-SEQ
      *  BAH 082396 ADDED MS-PENALTY COMING FROM LONPFA, LONPFB VIA XFER
      *             WDT RBREDUC(7) = 9999.01
      *  JTG 090996 CHANGED TO UPDATE BIFILE LAST, RE: MERCURY NFS LOCK
      *             ADDED 'MOVE " " TO LN-BI-FG' TO STOP DOUBLE UPDATE
      *             OF BI-FILE
      *  JTG 100296 MOVED " " TO VDU-WIMENU-SELECTION, TO STOP RECURSION
      *  JTG 101196 ADDED 'LXE-WORKER' & 'LXE-WORKER2' FOR LPCERN-- A50 VERSION
      *                   SP-ERNFRMLA 15 & 16, REAL INTEREST BEARINGING METHOD
      *                                            - INSTANT AUTO, KY
      *  BLV 110496 CHANGED TO CONTINUE IF PD-REC MISSING ON REVERSE RENEWAL
      *  BAH 111596 ADDED AVCR-CURRENT-AVAIL TO DISPLAY FOR WDT WHEN
      *             BR-AVAIL-CREDIT = "S" (335)
      *  MJD ADDED READ OF BW-FILE PRIOR TO CALLING LPSTAT-DISPLAY
      *  JTG 010397 CHANGED TEST FOR LCPDTH & LCHG DISPLAY TO NEVER DISPLAY
      *             IF SP-LCFRMLA = " " AND REMOVED TEST ON JUDGEMENT
      *             SINCE ACCOUNTS IN JUDGEMENT CAN CONTINUE AS PRECOMP
      *  JTG 020397 TEST FOR CONVERTED HISTORY, IF SO DEFAULT TO CURRENT
      *             DUE DAY
      *  BLV 020697 INITIALIZE PD-MIN-CRED-SCORE, PD-CRED-SCORE-USERID
      *  JTG 030797 CORRECTED BUG IN DS1-COMPUTE-PART-RC-AMT
      *             SUBSCRIPT SHOULD BE 'DLRC' AND NOT 'SUB'
      *  BAH 031197 ADDED LOGIC FOR DL-RECOURSE-FRMLA = 'A', FAIRCO
      *  BAH 031797 DONT DO WRFORM IF BATCH PAYMENTS
      *  JTG 032197 CORRECTED 'SS' & 'RV SS' TO UPDATE DS-RCOURSE-AMT
      *  BLV 032497 CHECK DLRV-LP-DLRVNO: IF NOT NUMERIC, FORCE 1;
      *      CONVERTED 50 ACCTS DON'T HAVE 1 IN REF; RV ON PR GOES TO $
      *  JTG 032797 STOPPED 'DC' ON ANY PAPER NOT MONTHLY
      *  BAH 050597 ADDED UPDATE OF LN-INTWAIVERS
      *  MJD 050697 ADDED "ST" TRCD FOR ADDONS, ADDED SETCTBL(W)
      *  MJD 051597 ADDED LPPOF2 COPY MEMBER (PREVIOUSLY WAS PART OF LPPOFF)
      *  BAH 051697 ADDED SET OF DT-REVERSE-TRCD LIKE A50
      *  JTG 052097 ADDED 'LIBLP/ADDONSPR' TO GET CORRECT SPR RE: INS RB
      *  BAH 052897 ADDED "PE" AND "SS" TO ASK RECEIPT PRINT
      *  JTG 060497 ADDED LOGIC FOR 'O3' REBATE
      *  BAH 061297 MOVED CALC OF AVAILABLE-CREDIT DOWN TO AFTER THE
      *             WRITE-LP1 BECAUSE THE LN-TOTDEF WAS 1, BUT THE
      *             PAYMENT WAS NOT THERE YET, AND REBATE ROUTINES
      *             SAY "ALL DEFERMENTS NOT FOUND, STOP", PACESETTER
      *  JTG 061897 CORRECTED BUG IN UPDATING LT-INS-REBATE FLAG,
      *             PROGRAM WAS NOT TESTING FOR MATCHING LT-TYPE (1-6)
      *  JTG 073097 CHANGED UPDATING OF DEALER STATISTIC TO NOT ADD
      *             LP-APOTH TO P&L RECOVERIES
      *  JTG 080497 CHANGED TO UPDATE DS-UNPAIDCK & DT-PROCEEDS ON
      *             INSURANCE REBATES RE: SERVICE ACCOUNTS INSURANCE OURS
      *  JTG 082197 CORRECTED ABOVE ENTRY TO DT-PROCEEDS
      *  MJD 082297 CHANGED LN-REC/CONPROFILE TO LN-REC/CONPROFILE(1)
      *  JTG 082297 CORRECTED SET OF DT-REVERSE-TRCD FOR 'RV' PAYOFF
      *  GLF 090897 REPLACED 'IO' ON GP-FILE WITH GET 'GPENV'
      *  MJD 091797 REMOVED DELSUB LOGIC, ADDED LPPDUE(W)
      *  MJD 101797 MOVED WK-UPDATE-BUF TO LPFDWK
      *  BAH 111197 ADDED HOLD-SP1-KEY,LC-GIFTNET TO CL/LEDGER LINKAGE CALL
      *  MJD 010298 FIXED BAD LOGIC IN SETTING INTDUE
      *  BAH 012098 UPDATE-DS1-SXSVSS WAS NOT CREATING DS IF DIDNT
      *             EXISTS, NEITHER WAS UPDATE-LN1 FOR RECOURSE
      *  BLV 012998 MAKE CASH BACK WINDOW OPEN WHEN THEY ENTER THE
      *             THE OPERATORS INITIALS WITH CA AND PR. ONLY LOOK AT
      *             THE FIRST TWO CHARACTERS OF REFNO, THE NEXT 3 ARE
      *             WILDCARD ENTRIES.
      *  BAH 032598 ADDED BR-IMMEDIATE-RECEIPT FOR WORLD FROM A90
      *  BLV 032598 FIXED STILL NOT STOPPING FOR TENDER WINDOW
      *  BAH 040198 ADDED GP-REPODATE-PAYDATE FOR FEDERATED #663 AND RAC #518
      *             IF "Y", USE LP-PAYDATE, NOT LP-TRDATE
      *   CS 042898 ADDED "RB" AND "RO" WHERE "RN" TESTED
      *  MJD 051998 REMOVED XY-PASTDUE. CHANGED XY-EXREB TO BE XY-PART-CHGOFF
      *             REMOVED REF TO "RE" AND "CE" - JOHN SAID THAY WERE NO
      *             LONGER USED AND TO TRASH
      *  JTG 060498 ADDED UPDATE OF LN-PO-TRCD TO HOLD THE TRCD USED TO
      *             PAYOFF THIS LOAN
      *  BAH 060598 ADDED UPDATE OF LN-TOT-PARTIAL-CHGOFF, MERCURY TRCD = 'PX'
      *  JTG 061598 ADDED LOGIC TO UPDATE BANKRUPT DELINQ STATISTICS, VIA 'BK'
      *  JTG 061798 ADDED LOGIC TO UPDATE TY-PART-CHGOFF, RE: 'PX'
      *  JTG 061798 ADDED SET OF PD-PO-TRCD SO XONPC0.C COULD TEST RENEWAL TRCD
      *  BAH 062598 CHANGED TP-TILL PIC 9 TO TP-TILLNO PIC X, ADDED
      *             CA-TILLNO-ZERO
      *  JTG 062998 CHANGED DS-CNVT.... TO DS-RNEW....
      *                     DS-SVOS.... TO DS-TODL....
      *  JTG 071098 ADDED LOGIC TO UPDATE BANKRUPT DELINQ STATISTICS, VIA 'BD'
      *  JTG 072898 ADDED LOGIC FOR RENEWAL O2 MONIES MERCURY #192
      *  BAH 081098 ADDED UPDATE OF LN-YTDNOALDEL FOR MERCURY'S NEW EDIT
      *             ON ALLOWABLE DELINQUENCY, #193
      *  JTG 082098 CHANGED TO SET PD-PRDLDISC-UNEARN FOR LONPB2.C
      *  JTG 082198 ADDED GP-RENEW-DISC-UNERN FOR MERCURY TO INDICATED IF
      *             THE NEW LOAN SHOULD RE-ESTABLISH THE UNEARNED DISCOUNT
      *             OF THE LOAN RENEWED
      *  MJD 082498 CORRECTED SET LN-INTPDTH-DATE WHEN PRIOR LN-INTPDTH-DATE DATE
      *              WAS AFTER CURRENT PAYMENT DATE, PL# 197, FIRST COMMUNITY
      *  BAH 102098 ADDED TEST FOR LN-INTPDTH-DATE = 0 AS IT IS ON A NEW LOAN,
      *              FIX FROM 8/24/98 CAUSING PROBLEMS ON NEW LOANS..
      *  JTG 111698 CONSTRUCTED COPY MEMBER LONPF.REV FROM ROUTINES IN
      *             LONPF2.C FOR USE IN LONPFS.C, REGENCY REVOLVING
      *  JTG 120398 ADDED LOGIC FOR REVOLVING PAYMENT UPDATE, REGENCY REVOLVING
      *  JTG 121698 DISPLAYED 'R' VIA UNITPER-MASK LOGIC FOR REVOLVING ACCOUNT
      *  JTG 990201 ADDED LOGIC TO UPDATE RT-PY STATUS AND RT-PY-NOT-APPLIED
      *  JTG 990222 CHANGED TO SET LP-PAYDATE = TO REVERSED LP-RECORD'S PAYDATE:
      *  JTG 990226 ADDED UPDATE OF BW-FILE FOR REVOLVING, REGENCY
      *  JTG 990324 ADDED 'PN' NON CASH PAYMENT.WITH GL ENTRY           TFC #013
      *             ADDED 'PZ' NON CASH PAYMENT/NO RECDEL.WITH GL ENTRY TFC #012
      *  JTG 990331 ADDED LOGIC TO STOP UPDATE OF RECENCY FOR 'SS'&'SV' TFC #015
      *  MJD 990420 CHANGED TO INCLUDE/EXCLUDE O2 IN DELINQ BASED
      *             ON GP-DELINQ-WITH-O2
      *  JTG 990419 ADDED SP-RECFRMLA-PERCNT-PMT       "P"         MERCURY  #183
      *  JTG 990507 CORRECTED MISSING PERFORMS ON UPDATE-NEXT-REV-MMYY (+BLV)
      *  JTG 990513 FINISHED LOGIC FOR SP-RECFRMLA-PERCNT-PMT "P"  MERCURY  #183
      *  BLV 990628 CHANGED UPDATE-TY1-SXSVSS FOR REPO TRANSACTIONS POSTED TO
      *             P&L ACCOUNTS, TFC PR#20, GREATER SUBURBAN PR#809
      *  BLV 990629 CHANGED UPDATE-TY1-SS TO UPDATE PL RECOVERIES IF ACCOUNT
      *             IS IN P&L STATUS, TFC PR#20, GREATER SUBURBAN PR#809
      *  BLV 990629 CHANGED UPDATE-DS1-SXSVSS FOR REPO TRANSACTIONS POSTED TO
      *             P&L ACCOUNTS, TFC PR#20, GREATER SUBURBAN PR#809
      *  BAH 990702 CHECK IF LT BANKRUPT RECORDS ALREADY EXIST, TFC CAN NOW
      *             ACCESS STATUS SCREEN BEFORE POSTING 'BK', #26 , ONLY
      *             IF GP-BK-PRIOR-TO-POSTING = "Y"
      *  JTG 990707 STOPPED O2 FROM UPDATING PL RECOVERIES LIKE TY UPDATE
      *  JTG 990716 UPDATED LOGIC TO UPDATE DS & TY FILES FOR REVOLVING
      *  JTG 990730 ADDED 'WI' AND 'WL' FOR REVOLVING
      *  MJD 990803 ADDED GP-INCL-OTH-IN-EARNED FLAG. IF "Y" THEN INCLUDE
      *             EARNINGS BUCKET 6 (OTHER) IN ACCUMULATED TOTALS
      *             OTHERWISE EXCLUDE BUCKET 6.
      *  BLV 990816 REMOVE UPDATE LOGIC FOR SLOT 4 & 5 OF DS REPO TABLE:
      *             TFC PR#20, GREATER SUBURBAN PR#809
      *  BLV 990819 UPDATE SLOTS 4 & 5 OF TY & DS REPO TABLE FOR NORMAL
      *             (NON-REPO) TRANSACTIONS,TFC PR#20, GREATER SUBURBAN PR#809
      *  JTG 990809 ADDED LOGIC FOR REVOLVING 'PE' PAYMENT EXCEPTION
      *  JTG 990823 STOPPED UPDATE OF 'SUMWG FIELDS' FOR REVOLVING
      *  BLV 990830 FIXED NOT UPDATING TY OR DS OUTSTANDING P&L IF
      *             POSTING AN SS TO AN ACCOUNT IN P&L STATUS
      *  BLV 990831 FIXED UPDATE-DS1-SXSSSV & UPDATE-TY1-SXSSSV - CHECK
      *             CURBAL WHEN UPDATING AN SS, IF 0, DON'T UPDATE
      *             GAIN-LOSS FOR REPO SOLD
      *  BLV 990902 UPDATE DS PL RECOVERIES WHEN SS IS POSTED TO ACCOUNT
      *             IN P&L STATUS
      *  BLV 990913 FIXED SUBTRACTING O2'S FROM DEALER STAT PL RECOVERIES:
      *             WAS CHECKING RV-LP-TRCD, FIX TO CHECK HOLD-LP-TRCD
      *  MJD 991001 ADDED LOGIC TO COMPUTE COMMISSION AS EITHER % OR
      *             FIXED AMOUNT  (TFC PR#41)
      *  JTG 991011 CHANGED SETUP-LINE FOR 'AP' DISPLAY REVOLVING, #47 REGENCY
      *             AND CHANGED CALL TO CL/LEDGER.C TO PASS LC-REC
      *  JTG 991103 CHANGED TO NOT LET LN-MTD-PAYMENTS GO NEGATIVE ALLOWING
      *             BRANCH MANAGERS TO REVERSE DELINQUENT PAYMENTS AND RE-POST
      *             THEM THIS MONTH, CAUSING RECENCY TO BECOME CURRENT
      *             REGMGM #986
      *  MJD 991220 ADDED LN-TOTNODEFACT AND LN-YTDNODEFACT (WORLD PR#216)
      *  MJD 000119 ADDED LN-TOTNOLCHG (WORLD PR#218)
      *  JTG 000201 CHANGED LOGIC ON RESET OF LN-LCPARTIALS ON A REVERSAL
      *             TO CORRECTLY SET IT POSITIVE RE: LCFRMLA 'A' REGENCY #XXX
      *  JTG 000217 ADDED DL-DISC-CODE-NO-PL-EXP       ACE #980
      *  JTG 000322 MODIFIED TO UPDATE UNEARNED STATISTICS, MERCURY #223
      *  MJD 000407 ADDED FLDVAL ON "LONPW." IF LONPF2 IS CALLED FROM
      *             LONPW? AND THE LOAN HAS CHANGED PRIOR TO UPDATE THEN
      *             I NEED TO SET THE ERRCD TO "M" BUT I DON'T WANT
      *             TO AFFECT OTHER PROGRAMS.
      *  MJD 000410 ADDED UPDATE OF TY-PROCEEDS AND DS-PROCEEDS (MERC PR#223)
      *  JTG 000417 CHANGED NEW DEFERMENT FORMULA 97 INTDUE OR 1/3 OF REGPAY
      *             TO BE DISBURSED TO LP-APINT AND LP-APCUR, MERCURY #224
      *  JTG 000505 CORRECTED NEW DEFERMENT FORMULA 97 INTDUE OR 1/3 OF REGPAY
      *             TO BE DISBURSED TO LP-APINT AND LP-APCUR, MERCURY #224
      *  BLV 000518 CHANGED TO NOT LET LN-MTD-PAYMENTS GO NEGATIVE ALLOWING
      *             BRANCH MANAGERS TO REVERSE DELINQUENT PAYMENTS AND RE-POST
      *             THEM THIS MONTH, CAUSING RECENCY TO BECOME CURRENT,
      *             FOR MERCURY (LIKE REGMGM)
      *  BLV 000524 CHANGED TO CHECK GP-RECDEL-REVERSAL-FG INSTEAD OF
      *             GP-I-AM-REGMGM & GP-I-AM-MERC FOR COMPUTING RECDEL
      *  BLV 000712 UPDATE LOGIC FOR POSTING PL TO REPO-ON-HAND ACCOUNT:
      *             IN STATS, TAKE OUT OF REPO-ON-HAND BUCKET (BUCKET 1)
      *             AND ADD TO REPO-ON-HAND IN P&L RECEIVABLES(BUCKET 4);
      *             ALSO, REVISE LOGIC TO CONSIDER REPO BUCKETS 4 & 5 AS
      *             ANY REPO IN P&L RECEIVABLES (USED TO TRACK REPOS POSTED
      *             ON ACCOUNTS ALREADY IN P&L), TFC PR# 77
      *  BLV 000712 FIXED ABOVE CHANGE, WAS MISSING DEALER STATS FOR REVERSE
      *             OF PL OF ACCOUNT IN REPO SOLD OR REPO ON-HAND
      *  BLV 000726 REVISE ABOVE CHANGE TO UPDATE VOLUME FOR REPO BUCKETS 4 & 5
      *  MJD 000914 IF TRCD = "PA" AND REFNO = "LBOX" THEN SET LN-LBOX
      *             (MFC PR#227)
      *  JTG 000926 IF TRCD = "RV" AND REFNO = "NSF" AND REVERSED TRANSACTION
      *             IS 'PA' 'LBOX', THEN DON'T UPDATE CHECK TABLE IN TY-FILE
      *             FOR 'NSF'         (MFC PR#227)
      *  MJD 000927 CHANGED SETTING OF ALLOTCD/LBOX FLAG IN LOAN RECORD.
      *             IF POSTING A REVERSAL, THEN DO NOT CHANGE FLAGS.
      *              (AS PER CINDY)
      *  MJD 000929 ADDED UPDATE OF TY-LOCKBOX (MFX PR#237)
      *  MJD 001013 ADDED UPDATE OF LP-POSTING-BR (WORLD PR#243)
      *  MJD 001016 CHANGED TO UPDATE LP-COLLECTOR/TP-COLLECTOR EVERYTIME EACH
      *             FILE IS WRITTEN (BAY PR#1317)
      *  BAH 001027 REMOVED HOLD-LC-CODE, SOMEHOW, IT HAD A DEFAULT VALUE OF
      *             32, SO IT WAS NOT READING LC-FILE AND ALL THE FLAGS WERE
      *             SPACES AND AMERICAN THRIFT COULD NOT PRINT LEDGERS, JUDY
      *             WAS ONLY USED IN 1 PLACE ANYWAY, TO TEST READ OF LC
      *  MJD 001114 ADDED UPDATE OF TP-PENALTY-INT. (NEWS PR#1264)
      *  JTG 001117 ADDED LOGIC FOR 'OV' OVERPAYMENT TRANSACTION PR#J015
      *  JTG 001128 CHANGED LOGIC FOR 'OV' OVERPAYMENT TRANSACTION PR#J015
      *             TO TEST BR-ALLOW-OV-TRCD AND NOT LOOK ONLY AT
      *             HOLD-OVPAID-CHECK
      *  JTG 001130 ADDED LOGIC FOR MANUAL 'OV' AND MANUAL REVERSAL OF 'OV'
      *             OVERPAYMENT TRANSACTION PR#J015
      *  JTG 001204 CORRECTED LOGIC FOR 'OV' POSTED INTERBRANCH   PR#J015
      *  JTG 010109 ADDED TEST IN UPDATE-CA1-FILE ROUTINE TO TEST
      *             HOLD-BP-TRCD NOT = " " AND SKIP UPDATE PR#239
      *  JTG 010140 CLEAR THE LXE FIELDS AFTER THE FIRST TRP IS WRITTEN
      *              WK-LXE-WORKER  WK-LXE-WORKER2
      *  MG  010201 REMOVED "01 WK-LXE" AND ADDED LIBLP/LPWKLXE.
      *  JTG 010316 CHANGED TO TEST FOR LP-REFNO = ALLOT, LBOX, TCOLL,
      *             TPAY OR WESTU                                 MERCURY PR#245
      *  JTG 010413 CORRECTED TEST FOR LP-REFNO = ALLOT, LBOX, TCOLL,
      *             TPAY, WESTU  RE: SET OF LN-LBOX OR LN-ALLOCTCD
      *                                                          MERCURY PR#245
      *  JTG 010430 CHANGED RE: GEORGIA GILA CHANGE EFF: 04/13/01 WORLD PR#263
      *  JTG 010504 FIXED UPDATE OF 'OV' TRANSACTION WHEN ACCOUNT WAS IN A POOL
      *             WAS NOT CREATING 'TR REC' FOR GL UPDATE CENTRIX PR#J018
      *  JTG 010606 CORRECTED CHANGE MADE 010109 WHICH ADDED TEST IN
      *             UPDATE-CA1-FILE ROUTINE TO TEST HOLD-BP-TRCD NOT = " "
      *             AND SKIP UPDATE PR#239 SINCE LONPW4.C MANUAL BATCH
      *             ENTRY/UPDATE PASSES 'PY' TO HOLD-BP-TRCD AND MUST
      *             UPDATE THE CASH DRAWER, AUTOPRIME
      *  BAH 010615 ADDED UPDATE OF LS-X-10DAY-COST WITH NET PAYOFF AMT IF
      *             POSTING "SX" AND GP-REPO-CODE = "A", REGACC PR# 1478
      *  BAH 010615 ADDED UPDATE OF LS-X-SOLD-TO-AMT WHEN POSTING "SS" AND
      *             GP-REPO-CODE = "A", REGACC PR# 1478
      *  JTG 010614 ADDED NEW TRCD "OP" FOR AUTOMATIC OT/AP COMBINATION
      *             ADDED NEW TRCD "RE" FOR REPO EXENSE ADDON,   REGACC PR#1478
      *  BAH 010619 ADDED UPDATE OF LS-X-AUCTION-EXPENSE WHEN POSTING "SS" AND
      *             GP-REPO-CODE = "A" (WI/AUCTIN TO ENTER IT !) REGACC PR# 1478
      *  JTG 010620 CORRECTED UPDATE OF COLLECTED STATS FOR 'OP' & 'RE' PR# 1478
      *  GLB 010702 DLR:SUBSTITUTE COPY MEMBER LPCXCL TO CLEAR CX-RECORD
      *  GLB 010702 UPDATE NEW FIELD --> CX-SSNO
      *  JTG 010710 ADDED NEW RATE TYPE 'Z' AMORTIZED WHERE RUNTIME COMPUTES
      *             INTEREST ON A 30 DAY METHOD (REAL ESTATE) AND LOAN CALCS
      *             ARE DONE SIMPLE, REMOVED TIE TO CTBL, FORCING TESTS ON (1)
      *             ADDED FOUND-LN-REMAIN-INT-SINCE-LFP
      *             ADDED FOUND-LN-REMAIN-PRIN-SINCE-LFP
      *                                             LENDMARK PR#1045 & PR#1380
      *  BLV 010723 DON'T CLEAR PROMISE DATE AND AMT IF PAYMENT IS LESS THAN A
      *             PERCENT OF THE PROMISE AMOUNT BASED ON GP-PROM-AMT-MIN-PCT,
      *             DEVELOPMENT PR# 1489
      *  JTG 010814 CHANGED GI-PAYWESTU TO GI-PAYMGRAM           MERCURY PR#258
      *  JTG 010814 CREATED NOW OPTION 'M' FOR BR-BP-PAYOFF-OV
      *             AND BR-LBOX-PAYOFF-OV WHICH WILL CREATE 'OV' TRANSACTION
      *             BUT WILL NOT CREATE A CHECK REQUEST           MERCURY PR#256
      *  JTG 010828 CORRECTED LOGIC FOR WRITING THE OVERPAY CHECK
      *             MISSING END-IF'S IN STRING OF IF ON LP-TRCD   MERCURY PR#256
      *  JTG 010904 ALLOWED IB TYPE LOANS TO ACCELERATE     JIM R. (ALL) PR#1582
      *  JTG 010914 'RE' ON 'IB' WILL ACT LIKE 'OT' TRANSACTION   REGACC PR#1575
      *  JTG 010926 MADE THIS WORK, IF TRCD = "RV" AND REFNO = "NSF" AND
      *             REVERSED TRANSACTION IS 'PA' 'LBOX', THEN DON'T UPDATE
      *             CHECK TABLE IN TY-FILE FOR 'NSF'   RE: 000926    MFC PR#227
      *  JTG 011003 OV TRANSACTION REFINEMENTS                       MFC PR#261
      *             SET LP-REFNO & TR-REFNO ON 'OV' SAME AS PAYOFF,
      *             WHEN 'ALLOT' OR 'LBOX' OR 'TPAY' OR 'TCOLL' OR 'MGRAM'
      *  JTG 011005 CORRECTED OV TRANSACTION REFINEMENTS, TO STOP UPDATE OF
      *             TYFILE NSF CHECKS, WHEN 'ALLOT' OR 'LBOX' OR 'TPAY' OR
      *             'TCOLL' OR 'MGRAM'                               MFC PR#261
      *  JTG 011009 CORRECTED OV TRANSACTION REFINEMENTS, TO STOP CREATION OF
      *             CHECK REQUEST, WHEN 'ALLOT' OR 'LBOX' OR 'TPAY' OR
      *             'TCOLL' OR 'MGRAM'                               MFC PR#261
      *  JTG 011004 ADDED HOLD-LXZ(FIELDS) FOR UPDATE LX-Z RECORD
      *             RE: NEW RATE TYPE 'Z' AMORTIZED   LENDMARK PR#1045 & PR#1380
      *  JTG 011029 CORRECTED OV TRANSACTION REFINEMENTS, TO STOP CREATION OF
      *             CHECK REQUEST, WHEN 'ALLOT' OR 'LBOX' OR 'TPAY' OR
      *             'TCOLL' OR 'MGRAM' FOR BR-LBOX-PAYOFF-OV         MFC PR#261
      *  BAH 011109 ADDED SET OF TP-INSCOMP FOR THE MORP'S, REGACC PR# 1617
      *  JTG 011119 CORRECTED OV TRANSACTION REFINEMENTS, PROGRAM WAS SETTING
      *             TP-OTHBR-FG = 'G' FOR ALL CASES OF 'OV', WHICH CAUSED
      *             NO GL DISTRIBUTION TO CASH DRAWER, SHOULD HAVE BEEN ONLY
      *             WHEN 'ALLOT' OR 'LBOX' OR 'TPAY' OR 'TCOLL' OR 'MGRAM'
      *                                                               MFC PR#261
      *  BAH 011130 UPDATE LN-COLLECTOR WITH "DEF" WHEN DF,D2-D9 POSTED, AND
      *             CLEAR THE "DEF" IF REVERSED, REGACC PR# 1660
      *  BAH 011205 COMMENT OUT ABOVE CHANGE, THEY ARE NOT READY FOR IT !
      *             REGACC PR# 1660
      *  BAH 011211 ADDED SET OF TP-PROMAMT, TP-PROMDATE, AND TP-PROMID FROM
      *             THE LOAN REC BEFORE THE TRANSACTION CLEARS THEM, REGACC
      *             PR# 1662
      *  BAH 011211 PUT 011130 CHANGE BACK IN, NOW THEY ARE READY !! REGACC
      *             REGACC PR# 1660
      *  BAH 020201 DONT UPDATE TP PROMISED FIELDS FOR THE REBATES..REGACC
      *  BAH 020207 UPDATE TP-DUEDATE WITH THE REAL DUEDATE BEFORE THIS PAYMENT
      *             WAS UPDATED, REGACC PL # 348
      *  BAH 020208 THE CHECK REQUEST FOR AN INTERBRANCH "OV" WAS CREATING THE
      *             FORM REQUEST (FM) IN THE OWNING BRANCH INSTEAD OF THE
      *             POSTING BRANCH, NEEDED FM-ALL-PATH SET LIKE CX !! PL#345
      *  BAH 020218 ADDED FOUND-LN-LAST-PYPA-DATE FOR REGACC PR# 1721
      *  BAH 020227 ADDED GP-CLEAR-PROM-PDTH TO NOT CLEAR PROMISE DATE FIELDS
      *             UNLESS PDTH ADVANCES, REGACC PR# 1750
      *  JTG 020219 ADDED "CT" COUNTY TAX CODE KENTUCKY AND PERCENTS
      *             ADDED "CY" CITY   TAX CODE KENTUCKY AND PERCENTS
      *             ADDED SET OF TP-INS-TAX-RB      WORLD #288
      *  JTG 020402 CORRECTED SET OF TP-INSCOMM RE: INS-TAX-RB      WORLD #288
      *  BAH 020507 ADDED SET OF TP-PROMDAYS-PASTDUE FROM THE LOAN REC
      *             BEFORE THE TRANSACTION CLEARS THEM, REGACC PR# 1783
      *  BAH 020516 ADDED TEST OF FD-SMARTPORT = "E" FOR CREATING
      *             SP-REPO-FMNO REQUESTS IN THE CORPORATE BRNO AND THEN
      *             PRINT THEM INTO AN ASCII FILE EXTRACT, REGACC PR# 1800
      *  BAH 020626 MOVE SPACES LN-PLREASON ON A REVERSAL OF PL,  REGACC PR#1775
      *  JTG 020731 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *             ALSO ADDED FOUND-LN-MIP-CLPDTH
      *                        FOUND-LN-MIP-AHPDTH
      *             ALSO ADDED 'CC' AND 'CA' MIP UPDATE LOGIC
      *  JTG 020826 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *             ADDED 'CC' AND 'CA' MIP UPDATE LOGIC TO TRP REC
      *  BAH 020905 ADD/SUBTRACT ALL REBATES AND "PE" TO LS-X-RB-AMT, REGACC
      *             PR# 1896 FOR A TOTAL CREDITS ON DEFICIENCY BAL LETTER.
      *  BLV 020912 PUT VALUE OF 0 ON HOLD-PL-OTH-AR IN WORKING STORAGE, SAW
      *             GARBAGE IN TP-PL-OTH-AR FOR SOME TRANS TYPES (EG "CC")
      *  BAH 020923 ADDED LT-B-BDDATE BNKRPT DISMISSAL DATE, REGACC PR# 1901
      *             "BD" SETS IT, RV "BD" AND "BK" ZEROS IT.
      *  JTG 021001 ADDED IF SP-CAL-RATETYPE(1) = "Z" FOR ADDING
      *             LP-EXTRA-PRIN-LFP TO LN-TOTEXCPAYMNTD
      *             RE: NEW RATE TYPE 'Z' AMORTIZED   LENDMARK PR#1045 & PR#1380
      *  BAH 021011 ADDED NEW TRANSACTION CODE OF "IN" INSURANCE LOSS, EXACTLY
      *             LIKE "PE", REGACC PR# 0007
      *  BAH 021105 REGACC DID NOT WANT LN-LBOX OR LN-ALLOTCD BEING SET
      *             AUTOMATICALLY ANYMOER !! KEVIN
      *  JTG 021112 ADDED NEW CODE FILE TYPE 'BR' -BATCH PAYMENT REFERENCE CODES
      *             BATCH PAYMENT REVISIONS                         REGACC #0006
      *  JTG 021118 ADDED TEST IN CA1-FILE UPDATE FOR BATCH UPDATE WHEN 'PY'
      *                                                             REGACC #0006
      *  BAH 021125 "OV" UPDATE-TR1 WAS CREATING THE TRP RECORD WITH OWNING
      *              BRANCH INSTEAD OF POSTING BRANCH. POSTING BRANCH NEEDS THE
      *             "OV" TO CREDIT DIRECT PAYABLE AND DEBIT THEIR CASH/BANK,
      *             THEN THE CHECK THEY CUT WILL WASH THOSE ACCOUNTS. COLTN
      *             IT WAS PUTTING THE OWNING BRNO IN THE POSTING BRANCHES
      *             TR "OV" RECORD, SO IT GOT THE WRONG GI RECORD IN EOD5
      *             WAS ALSO NOT SETTING THE TR-ALL-PATH TO THE POSTING BR.
      *  CS 021126  IF BR-FORCE-VALID-CITY-COUNTY = "Y", THEN UPDATE TP-INS-TAX-      *             COUNTY-CD, TP-INS-TAX-CITY-CD FROM THE LX-X INSURANCE TAX
      *             FIELDS [WORLD PR#288]
      * BAH 021205  IF TWO PROMISE DATES, KEEP LN-PROMID SET WHEN 2ND DATE
      *             MOVES TO 1ST DATE...REGACC PR# 10 (AND LN-PROMDAYS-PASTDUE)
      * BAH 021205 IF CORPORATE FORM PRINTING, MUST SET FM-PATH BACK CORRECTLY
      *            OR RECEIPT WILL ALSO GO TO GP-CORP-BRNO
      * JTG 021210 CORRECTED SET OF TP-REFNO WHEN RV-LP-REFNO = " " AND
      *            BATCH-REFCD = " "                                REGACC 0006
      * BAH 030106  IF TWO PROMISE DATES, KEEP LN-PROMDAYS-PASTDUE SET
      *             WHEN 2ND DATE MOVES TO 1ST DATE...REGACC PR# 10
      * BAH 030109 REGACC'S "RE" WAS UPDATING THE REPO TRAILER FIELD TWICE.
      *            THERE WAS STILL AN OLD OCCURANCE OF "RE" BEING TESTED FOR
      *            REBATE OF EXTENSION CHARGE !! REMOVED THOSE...
      * CSJTG
      *     030129 MADE CORRECTION TO WORLD PROBLEM OF SETTING GLAMT IN
      *            TR-REC'S FOR REBATES, RE: INS SALES TAX
      * JTG 030207 ADDED MISSING TEST ON 'R3' IN UPDATE-LT:
      * JTG 030212 ADDONS CANCELLED VIA ADDON MODULE DO INCORRECT ADDITIONAL
      *            REFUND ON THE 'LT' INTEREST
      *
      *            CHANGED VALUES OF LT-INS-REBATE FLAG SUCH THAT WHEN:
      *              LT-INS-REBATE = " "  NO REFUND OR CANCEL OCCURED
      *                            = "Y"  INS. WAS CANCELLED VIA ADDON POSTING
      *                            = "R"  INS. WAS REBATED   VIA TRANS POSTING
      *                                                               MULL #382
      * BAH 030213 SET LN-INTERIM-TRW TO "Y" IF POSTING OR REVERSING SX OR SV
      *            REGACC PR# 16
      * BAH 030225 COMMENT OUT THIS CHANGE; UPDATE LN-COLLECTOR WITH "DEF"
      *            WHEN DF,D2-D9 POSTED, AS PER EMAIL FROM KEVIN
      * BLV 030311 IF I-AM-REGACC & POSTING A PL, SET LN-TILLNO TO "Y" FOR
      *            RMS COLLECTION EXTRACTION, REGACC PL# 0091
      * BAH 030328 UPDATING TRIAD LOAN TRAILER, LRFILE, REGACC PR#26
      * CS  030411 UPDATE NF-FILE WITH CUSTOMER CHECK NUMBER IF LP-REFNO
      *            MATCHES EITHER OF THE GP-NF-UPD-REFNO CODES [PR#2034 CASHCO]
      * CS  030416 CREATE A LOAN MEMO WITH DATE, REFNO, AMOUNT, TILL AND
      *            USERID [PR#2034 CASHCO]
      * BAH 030417 UPDATE TP-INSCOMP ON MIP TRANSACTIONS...REGWAN PR# 2035
      * BAH 030520 NEED TO SPACE OUT EDIT-FM-KEY, THE CHECK REQUEST KEY IS
      *            LONGER AND LEFT JUNK IN THE KEY FOR RECEIPTS...LENDMARK
      * JTG 030522 CORRECTED (MIP) MONTHLY INSURANCE PREMIUMS      REGENCY #407
      *            END OF DAY OUT OF BALANCE WHEN PAYMENT POSTED INTERBRANCH
      * BAH 030626 FIX TRIAD (T18), NOT ADDING CORRECT FIELD
      *
      * JTG 030701 ACCOUNTS BYPASS LATE CHARGE ASSESS ROUTINE WHEN
      *            SP-LCFRMLA = ' ' BUT ACCOUNT IS SETUP FOR DEALER LATE
      *            CHARGE FORMULA                               MIDATL #J029
      * JTG 031014 CHANGED REVERSE 'AP' TO SET THE AMOUNT REVERSED
      *            IN APPLIED TO PRINCIPAL & OTHER & INTEREST & LATE CHARGES
      *                                                      CENTRIX KRUSE #J035
      * BAH 040225 UPDATE BI-PLCD ON A PL-POSTING !! UPDATE-BI-FILE
      * JTG 040501 ADDED LOGIC TO CAUSE THE UNEARNED LOAN COST TO ROLL TO
      *            THE NEW LOAN AFTER 'RENEWAL'. NOTE: THIS COST IS REFLECTIVE
      *            OF THE DISCOUNT WHEN PURCHASING LOAN PAPER NOT CARRIED AS
      *            SALES PAPER WITH DEALER DISCOUNT.
      *            ADDED SP-LNCOST-FRMLA = 'R'                    REGENCY #2287
      * JTG 040519 ADDED GL CONTROL FIELDS FOR:
      *                - UNEARNED INTEREST REPO
      *                - UNEARNED ADDON INTEREST REPO
      *            THE UNEARNED WILL MOVE TO THESE ACCOUNTS POSTING A 'SX'
      *            AND REVERSING A 'SV'
      *            THE UNEARNED WILL MOVE (BACK) FROM THESE ACCOUNTS POSTING
      *            A 'SV' AND REVERSING A 'SX'                     REGACC #0049
      * JTG 040722 CREATED NEW TRCD 'ZX' WHAT WORKS LIKE 'SX'     CENTRIX #2314
      * BAH 040824 ADDED GP-BK-FLAG-CONFIDENTIAL TO AUTOMATICALLY FLAG LOAN AS
      *            CONFIDENTIAL WHEN "BK" POSTED, AND FORCE BACK TO "N" WHEN
      *            REVERSED OR "BD" POSTED, LENDMARK PR# 2364
      * BAH 040913 WHEN "SV" REDEEM IS UPDATED, MOVE REPO TRAILER (LS) SEQ 1 TO
      *            NEXT AVAILABLE SEQ AND WIPE OUT SEQNO 1, ON A REVERSAL OF
      *            "SV", PUT LAST SEQNO BACK AS SEQNO 1, REGACC PR# 78
      * BAH 041029 SET THESE 4 FIELDS EVEN IF NOT A "DC" TRANSACTION;
      *            TP-TOTNODEF, TP-LNAMT, TP-ORIG-1STPAY, TP-ORGTERM
      * BAH 050119 SET LS-X-EXTRACTED TO "N" ON AN "SX" TRANSACTION,
      *            REGACC PR# 97
      * BAH 050202 SET LN-BNKRPT-DISMISS-DATE (REDEFINE OF LN-CYCLE-DATE) ON A
      *            "BD", NEEDED FOR CREDIT BUREAU ! PL# 461 SECURITY AUTO
      *  JTG 050316 ADDED LOGIC TO SET 'LP-REFNO' IN THE PAYMENT RECORD TO
      *             THE VALUE THE CUSTOMER TYPED WHEN REVERSING. WILL CHANGE
      *             LONPF2.C TO SET 'TP-REFNO' TO THE VALUE OF LP-REFNO
      *             BEFORE LP-REFNO WAS ALTERED TO VALUE CUSTOMER TYPED.
      *                                                            CENTRIX #2466
      * BAH 050415 REVERSAL OF "OV" OVERPAYMENT WAS CLEARING THE PAYOFF CODE
      *            AND PAYOFF DATE, BETH
      * BAH 050608 DO NOT DELETE THE BANKRUPT TRAILER RECORD ON REVERSAL
      *            OF "BK" IF GP-I-AM-REGACC, PR# 104 REGACC
      * BAH 050714 LN-MIP-FG, MONTHLY INSURANCE NEEDS TO BE COMPUTED ON ALL
      *            RENEWALS, JUST LIKE THE PAYOFF, REGWAN PL# 499
      * BAH 050915 IF GP-DEFERMENT-APPROVAL, CREATE MEMO RECORDS FOR ALL
      *            LS-P TRAILER FIELDS, THEN DELETE LS-P TRAILER RECORD
      *            WHEN DEFERMENT IS POSTED, LENDMARK PR# 2568
      *  CS 060222 CHANGED UPDATE OF TY FOR PL PRINCIPAL COLLECTIONS, REBATES
      *            (INT,SC,MF& INSURANCES)SHOULD NOT BE INCLUDED IN RECOVERIES
      *            OF PRINCIPAL [PR#530 WORLD]
      *            CHANGED FROM ADD LP-APCUR TOTAL-REB-AMOUNTS TO PL-PRINCOL
      *            TO ADD LP-APCUR TO PL-PRINCOL SAME TO DS-RCPLAMT
      * BAH 060310 IF GP-I-AM-SOAUTO AND LP-TRCD = "OT" AND LP-REFNO = "LPI",
      *            CREATE A MEMO FOR LENDER PLACED INSURANCE, PR# 2728 SOAUTO
      *  CS 060604 IF GP-I-AM-SECURITY UPDATE DT-EVENT-CD WITH LP-REFNO.
      *                                                  SECURITY AUTO PR#2503
      * BAH 060622 ADDED HOLD-TR1-MIP-KEY FOR THE REWRITE OF THE TR MIP RECORD
      *            ONLY SET THIS KEY WHEN HOLD-TP-OTHBR-FG NOT = "C"
      *            REGWAN PL# 538
      * "C" IS THE POSTING BRANCH AND FOR THE RE-READ OF THE MIP TR RECORD,
      * YOU MUST HAVE THE OWNING BRANCH HOLD KEY...
      * EXAMPLE, THE OWNING BRANCH HAD ALREADY POSTED 3 PAYMENTS TO AN
      * ACCOUNT AND ALL HAD CORRECT MIP INFO SET
      * THEN AN INTERBRANCH PAYMENT TOOK PLACE, AND IT WIPED OUT THE FIRST
      * TP RECORDS MIP INFO WHEN IT SHOULD HAVE BEEN REWRITING THE 4TH ONE
      * IT HAD THE POSTING BRANCHES HOLD KEY FOR SEQ 1
      * 060921 BAH ADDED GP-AUTO-BANKRUPT-WINDOW TO AUTOMATICALLY OPEN THE
      *            BANKRUPT TRAILER WINDOW AFTER POSTING A "BK", WORLD PR# 493
      * 060928 BAH INS-TAX WAS GETTING INTO THE TP-INS-TAX-RB ON TRANSACTIONS
      *            THAT IT DIDNT BELONG BECAUSE OF THEY TYPED "CP" IN THE
      *            REFNO, FOUND A BAD "IF" STATEMENT WITHOUT PARENTHESIS
      *          (LP-TRCD = "RV" AND LP-REFNO = "RP" OR "CP")
      *            THE "OR" STATEMENT MUST BE INSIDE PARENTHESIS
      *          (LP-TRCD = "RV" AND (LP-REFNO = "RP" OR "CP"))
      *             LENDMARK PL# 553
      * 070130 BAH SET EXT-WI-CL-SALEFIN TO "F" WHEN CALLING CHBANK TO TRIGGER
      *            CHBANK THAT YOU CALLED IT FROM HERE, WORLD PR# 523
      *            WORLD WANTS TO STEP THRU FIELDS LIKE NEW RECORD
      * BAH 2007.0131 REGACC PR# 162 NEW DEF POLICY FOR 6 MONTHS PAID THRU
      *               ELAPSED BETWEEN DEFERMENTS, HAD TO ADD;
      *               LR-PX10-LAST-DEF-PDTH  LR-PX10-PREV-DEF-PDTH
      *  CS 070321 PER KEVIN MANUAL 'AL' MUST UPDATE THE TRIAD RECORD
      *            LR-CL-LAST-AL-DATE,LR-CL-LAST-AL-ASSESSMENT  PR#153 REGIONAL
      *  CS 070420 IF RV-LP-TRCD = 'SS' MOVE SPACES TO LS-X-SOLD-TO(1)
      *                                                       PR#168 REGACC
      * BLF 070425 NOTE - THERE ARE A BUNCH OF CHECKS IN HERE THAT SAY:
      *            IF (BATCH-REFCD NOT = " ") AND (LP-REFNO = BATCH-REFNO).
      *            THESE WERE CONFUSING CINDY AND ME, AND HERE'S WHAT I THINK:
      *            WHEN JOHN FIRST DID ALL THE BATCH REFNO CHANGES, HE WAS
      *            CHECKING THIS CONDITION TO PREVENT DOING BATCH REFNO LOGIC
      *            WHEN POSTING AND ENTERING REFNO OF SPACES.  BUT AT SOME
      *            POINT, HE CHANGED LONPF1 TO INITIALIZE BATCH-REFCD TO LOW
      *            VALUES, SO I DON'T THINK IT'S POSSIBLE TO GET TO LONPF2
      *            WITH A VALUE OF SPACES IN BATCH-REFCD.  BUT THESE CHECKS
      *            WILL STAY BECAUSE I WOULDN'T TOUCH THOSE "IF" STATEMENTS
      *            WITH A 10 FOOT POLE.   BARB
      * BAH 070430 REVERSAL OF A "PI" WAS FORCING LN-STATUSFG TO A "P", BUT
      *            IT MIGHT NEED TO BE A "2-5" INSTEAD, IT NEEDS TO CHECK
      *            LN-PLTYPE ON WHAT TO GO BACK AS...SECURITY PL# 587
      *  CS 070709 ADDED TESTS FOR SP-DEFFRMLA = 96 , ANY LP-APCUR SHOULD
      *            UPDATE NON-CONTRACTUAL MONIES PR#2477 MULLEN
      * BAH 070926 SET LN-SKIP-TRW TO "Y" FOR PL-POSTING AND CLEAR ON A
      *            REVERSAL, GP-I-AM-UNITED ONLY PR# 3058
      * BAH 080115 SET LN-FROZEN-FLAG TO "Y" FOR PL-POSTING AND CLEAR ON A
      *            REVERSAL, GP-I-AM-REGACC ONLY PR# 196
      *  CS 080313 REVERSAL OF "SP" WITH TEXT IN THE REFNO FIELD UPDATES JUNK
      *            TO LN-DLPOOL. CHANGED IF HOLD-LP-TRCD = "SP" AND LP-TRCD
      *            = "RV", SET THE POOLID TO ZERO & GIVE THE USER A MESSAGE
      *                                           SERVICE FINANCE PR#621
      *  CS 080410 ADDED TO UPDATE-TRIAD TO UPDATE NEW LR FIELDS, LR-PX10-LAST
      *            DEF-TRCD, LR-PX10-PREV-TRCD REGACC PR#202
      * BLM 080501 IF I-AM-WORLD, DON'T AUTOMATICALLY SET LN-ALLOTCD,
      *            PER JIM, WORLD PR# 573
      * BAH 080829 SET LN-PROMDATE2 WITH LP-TRDATE ON A PAYOFF AND CLEAR IT
      *            IF REVERSED, DO NOT SET LN-PROMDATE2 TO PROMISE DATE ON
      *            PAYOFF, THE TRDATE IS NEEDED FOR THE CREDIT BUREAU SO
      *            BACKDATED PAYOFFS ARE NOT SKIPPED, IT WILL TEST THE TRDATE.
      *            WORLD PR# 596
      * BAH 081007 DISPLAY A MESSAGE IF TP-LINE > 248 TO NOT POST ANYMORE
      *            TODAY FOR THAT ACCOUNT, FLAT IRON PR# 3213
      *  CS 081021 IF GP-I-AM-REGACC, POSTING DF WITH $ APPLIED TO PRINCIPAL
      *            UPDATE LN-TOTEXCPAYMNTD REGACC
      *  CS 081024 REGACC CHANGED MIND ABOUT APPLYING EXTRA DF TO PRINCIPAL
      * BAH 081119 ADDED IB DEFERMENT FORMULA 95 TO WORK LIKE 96, REGACC PR#3280
      *  CS 081119 CORRECTED TEST ON GP-INCL-OTH-IN-EARNED [N AND R]
      * BAH 090311 LN-PROMDATE2 WAS GETTING CLEARED ON ALL PAYMENTS, SHOULD HAVE
      *            ONLY BEEN GETTING CLEARED ON A REVERSED PAYOFF FROM THE
      *            080829 CHANGE ABOVE FOR WORLD PR# 596
      * BAH 090323 TP-LINE > 248 NEEDED TO FIRST CHECK FOR TP-CODE OF "F" OR "G"
      *            THEN HAVE TO TEST TPF-LINE > 248, REGACC
      * BLM 090507 IF I-AM-REGMGM, DON'T AUTOMATICALLY SET LN-ALLOTCD,
      *            ASSURANCE BATCH CLAIM PMTS, REGMGM PR# 3359
      * BAH 090527 ADDED SP-AUTO-SEND-TRCD/FMNO FOR REGACC PR# 245
      * BLM 100105 IF PROCESSING BATCH PAYMENTS (HOLD-BP-TRCD NOT = " "),
      *            DON'T PRINT LEDGER CARD, REGMGM PR# 3517
      * BLM 100309 UPDATE ESCROW COLLECTED, ADD ESCROW TO TOTPAYMNTD, MTD-RECDEL
      * BLM 100309 UPDATE ESCROW DISBURSED
      * BLM 100309 ADD UPDATE OF 'EP' TRANSACTION, ESCROW PREPAYMENT, CHANGE
      *            'DE' TRANSACTION TO TRCD 'ED', REGWANT PR# 3506
      * BLM 100309 UPDATE CASH DRAWER FOR 'EP' TRANSACTION, REGWAN PR# 3506
      * BLM 100309 CHECK FOR LN-ESCROW-FG OF "I" AS WELL AS "Y", REGWAN PR# 3506
      * BLM 100309 IF ESCROW FLAG = "I" (INACTIVE), CHECK IF THERE IS SCHEDULED       *            ESCROW OUTSTANDING (REVERSAL COULD CAUSE THIS), IF SO,
      *            CHANGE LN-ESCROW-FG BACK TO 'Y' AND SEND MESSAGE
      * BLM 100311 FIX ESCROW-BALANCE, DIDN'T HAVE CENTS! REGWAN PR# 3506
      * BAH 100326 SET LN-TRW-STATUS FOR CERTAIN LN-PLREASON CODES FOR
      *            UNITED ONLY PR# 3562
      * BLM 100329 NO CHANGE, JUST MAKING A NOTE.  CINDY & I WERE LOOKING AT
      *            THE VALUE OF LP-LCPDTH, THE LATE CHARGE PDTHRU APPEARS TO
      *            BE INCORRECT IN THE LPFILE & TRFILE ON A REVERSAL.  BUT IT
      *            IS CORRECT IN THE LNFILE, & LP-LCPDTH-DATE GETS FIXED AFTER THE
      *            NEXT PMT IS POSTED.  THE LCPDTH FOR THE LOAN GETS COMPUTED
      *            IN UPDATE-LN1-REVERSAL (IN COPY MEMBER LONPF.REV) - THIS
      *            GUY READS THE LPFILE PREVIOUS, THE ROUTINE IS NEAR THE
      *            END OF THE UPDATES SINCE IT ALTERS THE LP-REC.  THE ONLY
      *            WAY I CAN THINK TO FIX THE LP-LCPDTH-DATE IS TO ADD A RE-READ OF
      *            THE LP ON A REVERSAL AFTER UPDATE-LN1-REVERSAL & REWRITE IT
      *            WITH THE CORRECT LCPDTH.  THIS IS STILL SCARY TO ME, NOT
      *            SURE WHAT'S INVOLVED IF REVERSING A PO, OR HOW TO FIX TR.
      *            CINDY & I THINK THIS HAS BEEN WRONG FOREVER, SO NOT
      *            WORTH THE TIME TO TRY TO FIX RIGHT NOW.
      * BAH 100607 DO NOT SEND AUTO REQUEST FORM IF TRCD "DC" AND ACCOUNT
      *            IS BANKRUPT FOR GP-I-AM-REGACC ONLY, REGACC PR# 267
      *  CS 110322 MADE A CHANGE TO LIBLP/RVAPPU. THE OVER-RIDE ON SPECIAL
      *            PROGRAMS DID NOT UPDATE IN THE MANNER DISPLAY IN THE
      *            REVOLVING APPLY WINDOW   PR#728 REGENCY
      * BAH 110418 CHANGE FROM #3562 SET TRW-STATUS AND SHOULD HAVE SET
      *            LN-TRW-SPECIAL-CODE, PR# 3776 UNITED
      * MJD 110525 ADDED LOGIC FOR SP-BANKRULE = "F"           WORLD # 752
      * BAH 110805 ADDED TP-LP-SEQNO ONLY UPDATED FOR SPECIFIC CODES
      *            AND GP-I-AM-REGACC ONLY , REGACC PR# 295
      *  CS 111018 IF GP-USE-ACCRUAL-EARN-FILE (AEFILE) = "Y" CERTAIN LP-TRCDS
      *            WRITE TO THE FILE.  THIS IS A FILE THAT HAS THE NECESSARY
      *            FIELDS TO MIMIC THE UNEARNED ACCRUAL & IB ACCRUAL. ON IB
      *            ACCOUNTS, LPTRCD PO,PL,P2,P3,P4,P5, NEED TO CREATE A RECORD        *            THAT HOLDS THE PRIOR MONTH IB ACCRUAL. ALSO A 'PA' THAT
      *            PAYS OFF IB ACCT, ALSO "SX & SS" IF GP-IB-ACCRUE-EARN-ON-REPO
      *            NOT 'Y'. WHEN THE IB ACCRUAL IS RUN IT UPDATES THE STATS
      *            WITH A LUMP CLASS TOTAL FOR THE IB ACCRUAL. THE NEXT MONTH
      *            ACCRUAL REVERSES THIS AMOUNT. SO, WE ARE WRITING THE AEFILE
      *            ON THE IB ACCRUAL BUT WHEN THE ACCOUNT PAYS OFF OR HITS ANY
      *            OF THE ABOVE IT DOESNT GO THRU THE ACCRUAL & SO A AN ENTRY
      *            IS REQUIRED TO OFFSET THE ACCRUAL.
      *
      *                          LAST PAY ON ACCOUNT 123 IS 9/10
      *            FOR EXAMPLE:  IB ACCRUAL  9/30 ACCT 123  IS 30.00.
      *                          STATS ARE UPDATED BY 30.00
      *                          GL IS UPDATED FOR 30.00 INCOME.
      *                          ACCOUNT IS PAID OFF 10/03/11.
      *            THE PAYOFF COLLECTED INTEREST FROM LAST PAY 9/10 TO 10/03
      *            BUT WE ALSO TOOK INTEREST FROM 9/10 THRU 9/30 INTO INCOME
      *            ON THE ACCRUAL. THIS 'DOUBLE DIP' IS REVERSED OUT OF GL
      *            ON THE NEXT MONTH VIA THE STAT AMOUNT BUT THE ZERO BALANCE
      *            ACCOUNT DOES NOT GO THRU THE ACCRUAL AND THE AEFILE WOULD
      *            REFLECT THE 'DOUBLE DIP'.  REGACC PR#299
      *  CS 111121 ADDED TEST TO LONPF.REV  NORTH STATE PR#752
      *            WHEN REVERSING 'BD', LOAN STATUSFLAGS(?) WAS SET TO 'B', BUT
      *            IF NO LT-B RECORD, LN-BNKRPTDATE WAS ZEROS WHICH MISSES THE
      *            MOST PLACES WHERE WE TEST LN-BNKRPTDATE
      *            EX: 10/12/11  'BK'     <-----
      *                10/12/11  'BD'
      *                10/12/11  'BK'
      *                10/12/11  'RV'  REVERSE BK
      *                10/12/11  'RV'  REVERSE BD
      *            PER PR#752, LN-BNKRPTDATE SHOULD BE BACK TO ORIGINAL
      *  CS 120202 CHANGED THE UPDATE OF AE-INTPDTH-DATE TO MATCH AC1ERN,BULK2 &
      *            BULKG2  PR#299  REGACC
      *  CS 120807 ADDED UPDATE OF TP-PRIOR-DF-CODE/TP-PRIOR-DF-POSTDATE WHICH
      *            PASSED THRU LPPFBUF  PR#318 REGACC
      *  CS 121026 IF PAYOFF AND LP-REFNO = "ZIUI" OR "AUTO" OR "ZA&H" OR "LIFE
      *            MOVE "BP" TO LN-TRW-SPECIAL-CODE REGMGM PR#4135
      *  CS 121121 ADD LP-REFNO "NONF, "PROP" TO LP-REFNO THAT SHOULD SET 'BP'
      *            TO LN-TRW-SPECIAL-CODE REGMGM #4135
      *  CS 121126 ADD "NONF" "PROP" TO LP-REFNO TEST FOR REGMGM, FORGOT
      *            "NONF, PROP" SETTING UP THE REVERSAL PR#4135 REGMGM
      *  CS 130502 ADDED TESTS FOR NUMBER OF DF'S ALLOWED PER TERM BREAK (AFTER
      *            PASSES DEFPOL CHECKS). ALLOW THE 'DF' BUT WRITE A MEMO
      *            THAT ACCOUNT IS IN TDR1 STATUS (STATUS UPDATE TO LR-PX10-
      *            TDR1/TDR1-DATE.
      *            ALSO ADD TESTS FOR NUMBER OF DF'S USING A REFCD "UNE?" THAT
      *            PUT ACCT IN TDR2 STATUS (UPDATED TO LR-PX10-TDR2/DATE
      *            WRITE A SPECIAL ERRLOG FOR TDR2 CHANGES  REGACC PR#338
      * BAH 130503 ADDED SP-SHORT-PAY-THRESHOLD FOR NEWPORT PR# 4256
      *  CS 130506 ADDED ADDITIONAL TESTS FOR UPDATE TRIAD IF GP-I-AM-REGACC
      *            DIDNT REALIZE OTHER CUSTOMERS USE THIS REGACC PR#338
      * MJD 130603 ADDED LOGIC FOR SP-SCFRMLA = 54.  FUNCTIONS THE SAME AS 12
      *            BUT INCLUDES AN EXTRA 4% ADDED IN AT THE END BASED
      *            ON TOTAL NOTE                                     WORLD #0874
      * BAH 130717 REMOVED SP-SHORT-PAY-THRESHOLD FROM HERE AND PUT
      *            IN LONPFC TESTING AGAINST TODAY DUE, NEWPORT PR# 4334
      * BAH 130719 POPULATE CX ADDRESS WITH BORROWER ADDRESS ON "OV"
      *           (WILL ALSO DO FOR REBATE CHECKS, SAME SECTION) MIDATL PR#4337
      *  CS 130918 HOLD-TDR2-ERR WAS NOT ZERO ON PAYMENTS (PA) THRU BATCH (SET        *            TO ZERO IN LONPF1) AND WAS WRITING TDR-ERRLOG. SET
      *            HOLD-TDR2-ERR TO 0 IN LONPW9 AT READ-NEXT-BP. ALSO ONLY
      *            CHECK HOLD-TDR2-ERR IF YOU ARE POSTING A DEFERMENT
      *            TRANSACTION PR#815 REGACC
      *  CS 131206 ADDED NEW VALUE OF 'R' TO GP-USE-ACCRUAL-EARN-FILE. 'R' DOES
      *            THE SAME THING AS 'Y' BUT IN ADDITION GOES THRU A
      *            PREPROCESSOR PRIOR TO THE ACTUAL ACCRUAL RUN REGACC PR#347
      * BAH 140422 SET LS-X-EXTRACTED TO "N" IF "SV" POSTED, OR A "SX" REVERSAL
      *                                                         REGACC PR# 352
      *  CS 140609 IF THRIFT, IF ACCT IS IN PL, POSTING OF AN O2 SHOULD NOT
      *            UPDATE VOLUME. THRIFT PR#849
      * BAH 140812 CLEAR THE RECEIPT ANSWER, IT MESSES UP PAYOFF CODE IN A30
      *  CS 140625 ADDED AN END IF TO THRIFT TEST  PR849
      * BAH 140924 REMOVED AUTOMATIC SETTING OF LN-SKIP-TRW FOR UNITED, PR#4622
      * BLM 141013 REF CODE BATCH PROCESSING, WHEN READING CD-FILE TO
      *            SEE IF ALLOT OR LOCK BOX, IT WAS READING CD-CODE (3 LONG)
      *            INSTEAD OF CD-BR-REFCD(5 LONG), MESSED UP CHECK OF
      *            BRANCH PAYOFF OV FLAG, FLAG OF "M" WAS STILL PRODUCING
      *            A CHECK REQUEST.  SOAUTO PL# 862
      * BAH 150622 ADDED VALUE "L" TO GP-BK-FLAG-CONFIDENTIAL TO AUTOMATICALLY
      *            FLAG LOAN AS CONFIDENTIAL FOR THE "BK" STUFF, ALONG WITH
      *            FLAG LOAN AS CONFIDENTIAL IF LEGALDATE, NSA PR# 4780
      * BLM 151021 FIXED TRUNCATION FROM RENAME OF LP-WORKAMT2 TO 
      *            LP-PRORATED-INS-REB
      *  CS 151104 UPDATE ES-DISBURSED-CNT-TAXES IF REFNO = "CNT" COLTN PR#4867
      *  CS 151222 ADD SET OF LP-BRNO = LN-OWNBR
      *  BAH 160118 SPLIT OUT LTFILE, PD0003
      *
      *  KEC 2016.0205 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         FIXED KEYS & RECS FOR FD-REC.
      *         CHANGED FMNO/FORMNO/NEXTFM/SETFM FROM 3 TO 4 BYTES.
      *         ADDED NEW FDB-FILE; WAS IN FD-FILE.
      *  BAH 160209 SPLIT OUT LSFILE, PD0003
      *   CS 160216 ADD MOVE OF LN-OWNBR TO LX-BRNO
      *  BAH 160218 EXPANDED LM-REC ADDED LM-BRNO, PD0003
      *   CS 160222 REMOVE COPY LPWKLXE, ITS AN EARNINGS COPY MEMBER THAT IS
      *             PASSED IN LOAN PROCESSING VIA LP01WK USING WK-LX2-REC. 
      *             REPLACED WK-LX2-REC WITH WK-LXE-REC IN LP01WK 
      *             MOVED LPWKLXE TO LPWKLXE.NO
      *             SAVED VERSION LONPF2.160222
      *   CS 160223 CHANGED AE-YYMMDD TO AE-DATE
      *  BLM 160225 FIX FOR NEW TY-DATE FORMAT, YYYYMMDD INSTEAD OF YYYMMDD
      *  CS 160302 IF HOLD-ALT-PREPAY-FG = "Y" SET LN-LPO TO ALT WORLD PR#4110
      *  BAH 160308 FIX CA1-FILE
      *  BLM 160428 EXPAND, CONSOLIDATE DS-UNEARNED TABLE, FIX FOR NEW
      *             DS-DATE FORMAT, PD0003
      *  BAH 160415 CHANGED CH-OLD-CREDIT AND NEW-CREDIT TO USE 
      *             CH-ORG-DATE AND CH-NEW-DATE FOR BANKRUPT MEMO
      *             NEEDED ALL OTHER FIELDS TO BE CREATED IN MEMO, NOT
      *             JUST THAT, SO NEEDED TO FIX CHMEMO, WORLD PR#1150
      *  BLM 160429 UPDATE ADDITIONAL BANKRUPT TRAILER INFO FOR BATCH
      *             POSTING OF BK'S & BD'S, WORLD PR# 1151
      *  BLM 160510 CHANGE BANKRUPT ROUTINE TO CALL CRNOR2 INSTEAD OF
      *             PERFORMING CREATE NOTICE, WORLD PR# 1151
      *   CS 160513 ADD SET OF AE-BRNO 
      *   CS 160610 SET ORIG-LN-MTD-PAYS-RECDEL 9(7)V99
      *             FOUND-LN-LAST-PYPA-DATE,FOUND-LN-INTPDTH
      *             FOUND-LN-DATE-PAID-LAST, FOUND-LN-MIP-CLPDTH
      *             FOUND-LN-MIP-AHPDTH, FOUND-LN-AMT-PAID-LAST
      *             HOLD-BNKRPTDATE, CHG-BNKRPTDATE, HOLD-DUEDATE
      *             HOLD-PDTH-DATE, ORIG-LN-BNKRPTDATE TO PIC9(8)
      * MJD 160613 ADDED LOGIC TO UPDATE LXR-REB-AMT FOR GA EARLY PROVISION 
      *                                                           REGMGM PR#4915
      * BLM 160621 FIX REVOLVING TO READ TRAILER, REMOVE LN-SEQNO
      *  CS 160714 DELETE THE EP(ELECTRONIC PMT) RECORD WHEN ACCOUNT PAYS
      *            OFF SO IT NO LONGER APPEARS ON ELECTRONIC PAYMENT 
      *            EXTRACTION REPORT  CITIZEN FIN  PL 945
      * BLM 160811 IF POSTING BK IN BATCH, UPDATE LTB-WHO-FILED TO 
      *            DEFAULT OF "M" OR "B", WORLD PR# 1151A
      *  CS 160817 CORRECT PL945, CAN'T DELETE THE EP RECORD HERE BECAUSE
      *            IT NEVER GETS SENT. CHANGED TO DELETE IN EPEXTR
      *                                           CITIZENS PL947 
      *  CS 160830 CHANGED TEST ON SAVE-DT-SEQ < 9999 TO < 999, SAVE-DT-SEQ
      *            IS MOVED TO DT-SEQ WHICH IS ONLY 9(3), CHANGED SAVE-DT-SEQ
      *            FROM PIC 9(4) TO PIC 9(3)
      * BAH 2016.0830 ASK IF 3RD PARTY RECEIPT FOR WORLD ONLY; WORLD PR#1183
      *               MOVE "PRINT RECEIPT NOW (Y/N/3) ?" TO MESS
      * KEC 2016.0914 SET LR-BRNO USING LN-OWNBR.
      * KEC 2016.1025 RENAMED HOLD-TR1-MIP-KEY TO BE HOLD-TR1-KEY-MIP
      *               PIC X(27) FOR QUICKER VERIFICATION.
      * KEC 2016.1209 CHANGED AE-DATE AS ACTIVE CCYYMMDD.
      * BLM 2017.0103 MOVE X TO GETLTR-STAT IF REVOLVING, AND MOVE 
      *               LTR-REC TO GETLTR-REC AFTER CHANGING LTR FIELDS
      * KEC 2017.0105 CHANGED DS-DATE TO DS-DATE-CCYYMM FOR CONSISTENCY
      *               WITH THE DATE FIELDS IN BY & UD FILE.
      * KEC 2017.0119 CHANGED FD-SMARTPORT TO FD-OPTION [88 LEVELS].
      * BAH 2017.0615 ACTIVATE 8 DIGIT DATES, PD0006
      * KEC 2017.0726 ADDED 'LP' FILE PREFIX FOR WORKING STORAGE FIELDS;
      *               CHANGED HOLD-KEY TO BE SAVE1-LP1-KEY; 
      *               CHANGED HOLD-LP-KEY1 TO BE SAVE2-LP1-KEY;
      *               COULD NOT CHANGE IT TO HOLD-LP1-KEY SINCE IT WAS USED
      *               IN LIBLP/LPPFBUF.
      * BLM 2017.0607 PERFORM ADD CONDITION-SEND-MESS AND PERFORM THIS INSTEAD
      *               OF SEND-MESS TO SUPPRESS SCREEN OUTPUT IF
      *               ROUTE-BUF NOT = "00"  WORLD PR# 1246
      * BAH 2017.0914 RENAMED LN-PYMMYY-RECDEL TO LN-PY-YYYYMM-RECDEL AND FIXED
      *               LOGIC TO USE IT CORRECTLY
      * BAH 2017.1129 FIXED WK-LXE-REC
      * BAH 2018.0417 CHANGE FROM PR#4915 CAUSED GARBAGE IN THE TP-GLNO'S FOR
      *               AUTOMATIC REBATES FROM A PAYOFF/RENEWAL. THERE IS A WRITE
      *               OF LX1-FILE FOR NEW LXR-REB-AMT AND IT WIPES OUT THE
      *               LXG-GLNO AND LXG-GLAMT THAT WERE CLEARED FOR REBATES.
      *               ADDED CODE TO CLEAR THEM AGAIN AFTER THAT WRITE. #1315
      * BAH 2018.1008 GLOBAL FILES
      *  CS 2018.1197 MOVED AEFILE TO .NO, THE UPDATE OF THIS FILE IS CUSTOMIZED
      *               TO REGIONAL ACCEPT AND IS NOT USED BY WORLD.
      * BAH 2018.1115 GLOBAL FILES
      * BAH 2019.0116 GLOBAL LXFILE, SPLIT
      * KEC 2019.0219 A32 FFR - REMOVED REDEFINE FOR LN-LC-CODEX; UNUSED
      * BAH 2019.0308 MOVED LP-REFNO REDEFINITION TO LPWSLP COPY MEMBER
      * BAH 2019.0312 MOVED EDIT-FM-KEY TO LPWSFM-EDIT-FM-INITKEY TO REMOVE THE
      *               REDEFINE IN THE FM-REC
      *  CS 2019.0418 LATE CHARGE FRMLA 'S' WAS NOT INCLUDED IN THE 'IF' THAT
      *               MOVES HOLD-PARTIALS,HOLD-LCPAID TO LN-PARTIALS,HOLD-LCPAID
      *               SO WE WERE ASSESSING LATE CHARGES ON BAD AMOUNTS. CAN'T
      *               TAKE A LATE CHARGE ON MONIES PAID WITHIN GRACE DAYS OF
      *               DUE DAY   WORLD PR#1369
      *  CS 2019.0607 CHANGED TEST ON LXE-EARNING() TO INCLUDE ALL 7 LEVELS
      *               OF EARNINGS IN LXE. THESE ARE CLEARD IN LONPF1,THE
      *               FUTURE FIELDS ARE CLEARED IN LONPF1
      *  CS 2019.0611 CLEAR FUTURE FIELDS FOR LXG AND LXE
      * BAH 2019.0614 ADDED CLEAR-FM-FILE (LPFMCL) AND SET FM-USERID
      * BAH 2019.0628 REMOVED RT AND RL REVOLVING
      *  CS 2019.0628 KG CALLED, A BATCH REFCODE BEGAN WITH THE SAME 2 LETTERS
      *               AS CASH CODES SO THE CASH TENDER WINDOW POPPED
      *               ADDED TEST PRIOR TO POPPING THE TENDER WINDOW
      *               IF HOLD-BP-TRCD = " " POP THE WINDOW, OTHERWISE DONT
      * BAH 2019.0701 REMOVED AVAILABLE-CREDIT FROM LPPFBUF
      *  CS 2019.0701 TEST THE DISPLAYING OF THE CASH TENDER WINDOW
      *               WHEN RUNNING THRU BATCH
      * BAH 2019.0709 REMOVED GP-LR-TRAILER-TRIAD, PT0151 
      * BAH 2019.0711 CLEAR EXT-WI-CL-SALEFIN AFTER RUNNING CHBANK, THAT IS
      *               A TRIGGER FOR CHBANK TO KNOW YOU CAME FROM LONPF2 AND
      *               JUST POSTED A "BK" SO YOU WALK THRU A NEW RECORD FROM
      *               THE TOP. IF YOU THEN PRESSED F9 BANKRUPT FROM PAYMENT
      *               POSTING, IT WOULD MAKE YOU WALK THRU THE SCREEN AGAIN
      *               BECAUSE THIS FIELD WAS STILL "F" AS IT IS NOW AN
      *               EXTERNAL FIELD. NEEDS TO GET CLEARED. QA0043
      *  CS 2019.0726 REMOVED NF-FILE SAVED LONPF2.190725
      * BAH 2019.0731 WRITE ERROR 22 ON CH-FILE. CH-FILE NOT IN DECLARATIVES!
      *               CH-FILE WAS SEQUENTIAL IN A15 SO IT DIDNT HAVE
      *               CONCERNS ON DUPLICATE KEYS. ITS INDEXED IN A30 SO
      *               NEED TO MAKE SURE ITS IN DECLARATIVES SO WE CAN TEST
      *               FOR DUPLICATE KEY AND ADD TO A SEQ. QA0071
      * BAH 2019.0919 REMOVED ACCESS-CALL ON FMFILE
      *  CS 2020.0108 WHEN "BD", CLEAR THE LTB REAFF FIELDS. WORLD PR#1141
      *              LTB-REAFF-DATE,LTB-REAFF-SYSDATE, LTB-REAFF-BALANCE,
      *              LTB-REAFF-AYAMT,LTB-REAFF-NO-PAYS,LTB-INTRATE,
      *              LTB-RESCIND-DATE, LTB-PARTIAL-FULL PR#1411
      *  CS 2020.0119 CHANGED TO MOVE SPACES TO LTB-PARTIAL-FULL
      * BAH 2020.0702 REMOVED CLOSE-BR-FILE #TST001
      * BAH 2020.0925 SET LTB-GROSS-BAL FOR "BK", DO NOT CLEAR IT ON
      *               "BD" BECAUSE YOU CANT GET IT BACK, #1461
      * AMM 20210429 REMOVED FUTURE FIELDS
      * BLM 20210810 WILL NO LONGER WRITE TRP TYPES "F" AND "G" FOR
      *              DUPLICATE POOLID RECORD TYPES.  TP-CODE REMOVED
      *              FROM REC AND TP-POOLID MOVE TO RECORD, NOT KEY
      * BAH 20220422 UPDATE TP-ACTIONCD2, SECURITIZATION #1551
      * BAH 20220818 REMOVED GLOBRD, READ GB-FILE INSTEAD
      * BAH 20220823 HARD CODED START
      * BAH 2022.0912 UPDATE TP-LCDUE WITH LATE CHARGE ASSESSED, VERITEC #1570
      *              IS STILL ADDED IN TP-INTDUE
      * BAH 2023.0328 ADDED SP-LCFRMLA "T" WHICH IS UCCC, SAME AS "S" BUT
      *              ON TOTAL MONEY. CAN'T TAKE LATE CHARGE ON MONIES PAID
      *              WITHIN GRACE DAYS OF DUE DAY   #1597
      * BAH 2023.1019 CREATE XTRP AND XNO FOR EVERY TRANSACTION IN
      *              R1/FTP/OUT/PAYS, FOR REPAY #1629
      * BAH 2023.1218 CREATE XTRP AND XNO WITH OWNING BRANCH ONLY, IN THE PATH
      *              FILENAME AND ALSO INSIDE THE FILE. #1629A
      * BAH 2024.0130 CALL CRNOR2 AND WRITE NOTICE RECORD
      * BAH 2024.0209 UPDATE TP-REPAY-TRANS-ID FROM LP-REPAY-TRANS-ID FOR
      *              BATCH APIPAY, HOLD-BP-TRCD NOT = " " #1641
      * BAH 2024.0417 REMOVED CHBANKW, CALL INSTEAD OF WINDOW, NOTHING TO PASS
      * BAH 2025.0116 UPDATE TP-CLOSFEE-REB-AMT WITH THE 4% PORTION OF SERVICE
      *              CHARGE REBATE #1697 S35Q-157
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. 3B.
       OBJECT-COMPUTER. 3B.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
       COPY "LIBLP/LPFSWK.CPY".
       COPY "LIBLP/LPFSREPAYTRP.CPY".
       COPY "LIBLP/LPFSREPAYNO.CPY".

       I-O-CONTROL.

       DATA DIVISION.
       FILE SECTION.
       COPY "LIBLP/LPFDWK.CPY".
       COPY "LIBLP/LPFDREPAYTRP.CPY".
       COPY "LIBLP/LPFDREPAYNO.CPY".

       WORKING-STORAGE SECTION.
       77  SCCS-IDENTIFIER PIC X(41) VALUE
           "@(#)LP/LONPF2.CBL J35 12/21/23-09:10:54 >".
      **************************************************
      *     P R O G R A M   W O R K E R S              *
      **************************************************
       COPY "LIBGB/GB01BR.CPY".
       COPY "LIBGB/GB01BR_SQL.CPY".
       COPY "LIBGB/GBWSBR.CPY".
       COPY "LIBGB/GB01GB.CPY".
       COPY "LIBGB/GB01GB_SQL.CPY".
       COPY "LIBGB/GBWSGB.CPY".
       COPY "LIBLP/LP01CH.CPY".
       COPY "LIBLP/LP01CH_SQL.CPY".
       COPY "LIBLP/LPWSCH.CPY".
       COPY "LIBLP/LP01TRP.CPY".
       COPY "LIBLP/LP01TRP_SQL.CPY".
       COPY "LIBLP/LPWSTRP.CPY".
       COPY "LIBLP/LP01LC.CPY".
       COPY "LIBLP/LP01LC_SQL.CPY".
       COPY "LIBLP/LPWSLC.CPY".
       COPY "LIBLP/LP01LN.CPY".
       COPY "LIBLP/LP01LN_SQL.CPY".
       COPY "LIBLP/LPWSLN.CPY".
       COPY "LIBLP/LP01LP.CPY".
       COPY "LIBLP/LP01LP_SQL.CPY".
       COPY "LIBLP/LPWSLP.CPY".
       COPY "LIBLP/LP01LM.CPY".
       COPY "LIBLP/LP01LM_SQL.CPY".
       COPY "LIBLP/LPWSLM.CPY".
       COPY "LIBLP/LP01LX.CPY".
       COPY "LIBLP/LP01LX_SQL.CPY".
       COPY "LIBLP/LPWSLX.CPY".
       COPY "LIBLP/LP01LXE.CPY".
       COPY "LIBLP/LP01LXE_SQL.CPY".
       COPY "LIBLP/LPWSLXE.CPY".
       COPY "LIBLP/LP01LXG.CPY".
       COPY "LIBLP/LP01LXG_SQL.CPY".
       COPY "LIBLP/LPWSLXG.CPY".
       COPY "LIBLP/LP01LSP.CPY".
       COPY "LIBLP/LP01LSP_SQL.CPY".
       COPY "LIBLP/LPWSLSP.CPY".
       COPY "LIBLP/LP01LSX.CPY".
       COPY "LIBLP/LP01LSX_SQL.CPY".
       COPY "LIBLP/LPWSLSX.CPY".
       COPY "LIBLP/LP01SP.CPY".
       COPY "LIBLP/LP01SPA.CPY".
       COPY "LIBLP/LP01SPB.CPY".
       COPY "LIBLP/LP01SPC.CPY".
       COPY "LIBLP/LP01SP_SQL.CPY".
       COPY "LIBLP/LPWSSP.CPY".
       COPY "LIBLP/LP01BW.CPY".
       COPY "LIBLP/LP01BW_SQL.CPY".
       COPY "LIBLP/LPWSBW.CPY".
       COPY "LIBLP/LP01CA.CPY".
       COPY "LIBLP/LP01CA_SQL.CPY".
       COPY "LIBLP/LPWSCA.CPY".
       COPY "LIBLP/LP01TY.CPY".
       COPY "LIBLP/LP01TY_SQL.CPY".
       COPY "LIBLP/LPWSTY.CPY".
       COPY "LIBGL/GL01GL.CPY".
       COPY "LIBGL/GL01GL_SQL.CPY".
       COPY "LIBGL/GLWSGL.CPY".
       COPY "LIBLP/LP01DS.CPY".
       COPY "LIBLP/LP01DS_SQL.CPY".
       COPY "LIBLP/LPWSDS.CPY".
       COPY "LIBLP/LP01PD.CPY".
       COPY "LIBLP/LP01PD_SQL.CPY".
       COPY "LIBLP/LPWSPD.CPY".
       COPY "LIBLP/LP01DT.CPY".
       COPY "LIBLP/LP01DT_SQL.CPY".
       COPY "LIBLP/LPWSDT.CPY".
       COPY "LIBLP/LP01FM.CPY".
       COPY "LIBLP/LP01FM_SQL.CPY".
       COPY "LIBLP/LPWSFM.CPY".
       COPY "LIBLP/LP01NO.CPY".
       COPY "LIBLP/LP01NO_SQL.CPY".
       COPY "LIBLP/LPWSNO.CPY".
       COPY "LIBLP/LP01CX.CPY".
       COPY "LIBLP/LP01CX_SQL.CPY".
       COPY "LIBLP/LPWSCX.CPY".
       COPY "LIBLP/LP01FD.CPY".
       COPY "LIBLP/LP01FD_SQL.CPY".
       COPY "LIBLP/LPWSFD.CPY".
       COPY "LIBLP/LP01IC.CPY".
       COPY "LIBLP/LP01IC_SQL.CPY".
       COPY "LIBLP/LPWSIC.CPY".
       COPY "LIBLP/LP01LTB.CPY".
       COPY "LIBLP/LP01LTB_SQL.CPY".
       COPY "LIBLP/LPWSLTB.CPY".
       COPY "LIBLP/LP01LTI.CPY".
       COPY "LIBLP/LP01LTI_SQL.CPY".
       COPY "LIBLP/LPWSLTI.CPY".
       COPY "LIBLP/LP01LTP.CPY".
       COPY "LIBLP/LP01LTP_SQL.CPY".
       COPY "LIBLP/LPWSLTP.CPY".
       COPY "LIBLP/LP01CD.CPY".
       COPY "LIBLP/LP01CD_SQL.CPY".
       COPY "LIBLP/LPWSCD.CPY".
       COPY "LIBLP/LP01ES.CPY".
       COPY "LIBLP/LP01ES_SQL.CPY".
       COPY "LIBLP/LPWSES.CPY".
       COPY "LIBLP/LPWSREPAYTRP.CPY".
       COPY "LIBLP/LPWSREPAYNO.CPY".
       COPY "LIBEX/EX01XTRP.CPY".
       COPY "LIBEX/EX01XNO.CPY".


       01  HOLD-FM1-KEY        PIC X(28)   VALUE SPACES.
       01  WK-IFN              PIC X(2)    VALUE "WK".

       01  WK-KEY              PIC 99.
       01  WK-SUB              PIC 9.
       01  BW-SUB              PIC 9.
       01  HOLD-CH-SEQ         PIC 9(3).

      *********************************************************
      *   DATA PATH FROM GETENV ON "FIL"
      *********************************************************
       01  DATA-PATH             PIC X(35).
       01  FIL-PATH              REDEFINES DATA-PATH.
      * USR/DATA/R1/
           03  FIL-BASE         PIC X(12).

       01  WS-BRACCTNO.
           03  WS-BRNO     PIC 9(4).
           03  WS-NUMBER   PIC 9(6).

       01  FORM-NO-TABLE.
           03  FORM-NO         PIC 9(3) OCCURS 4.

       01  SAVE-PWA-POOL-CHANGE-SW         PIC X.
       01  PWA-POOL-CHANGE-SW              PIC X.
           88  PWA-POOL-HAS-BEEN-CHANGED   VALUE "C".
           88  PWA-POOL-PAYMENT-MADE       VALUE "P".
       01  PWA-POOLID                      PIC 9(5)  COMP.
       01  PWA-PRIOR-POOLID                PIC 9(5)  COMP.

       01  ORIG-LN-MTD-PAYS-RECDEL        PIC S9(7)V99 COMP VALUE 0.
       01  SAVE-LN-MTD-PAYS-RECDEL        PIC S9(7)V99 COMP VALUE 0.
       01  FOUND-LN-LCPDTH-DATE           PIC 9(8)          VALUE 0.
       01  FILLER                        REDEFINES FOUND-LN-LCPDTH-DATE.
           03  FILLER                     PIC 9(6).
           03  FOUND-LN-LCPDTH-DATE-DA    PIC 99.
       01  FOUND-LN-LAST-PYPA-DATE        PIC 9(8)      COMP VALUE 0.
       01  FOUND-LN-INTPDTH-DATE          PIC 9(8)      COMP VALUE 0.
       01  FOUND-LN-DATE-PAID-LAST        PIC 9(8)      COMP VALUE 0.

       01  FOUND-LN-AMT-PAID-LAST         PIC 9(7)V99   COMP VALUE 0.
       01  FOUND-LN-PY-YYYYMM-RECDEL      PIC 9(6)      COMP VALUE 0.
       01  FOUND-LN-PY-YYYYMM-RECDEL-WK   PIC 9(6)      COMP VALUE 0.
       01  FOUND-LN-REMAIN-INT-SINCE-LFP  PIC S9(7)V99  COMP VALUE 0.
       01  FOUND-LN-REMAIN-PRIN-SINCE-LFP PIC S9(7)V99  COMP VALUE 0.
       01  FOUND-LN-MIP-CLPDTH-DATE       PIC 9(8)      COMP VALUE 0.
       01  FOUND-LN-MIP-AHPDTH-DATE       PIC 9(8)      COMP VALUE 0.

       01  MSEL-LIST                     PIC X(5)     VALUE "MSEL.".
      *01  WSEL-LIST                     PIC X(5)     VALUE "WSEL.".
       01  RECEIPT-BUF.
           03  FILLER                    PIC X(5).
           03  RECEIPT-ANS               PIC X.

       01  HOLD-LSX-SEQNO                 PIC 99.
       01  HOLD-LSX-REC                   PIC X(LSX-SIZE).

      * NOTE: THIS IS USED IN CALL TO TENDER.C
       01  SAVE-LP-TRAMT            PIC S9(7)V99.

      *----------------------------------------------------------------
      * SAVE-LP-REFER : (ABOVE ^) USED WITH HOLD-BR-TENDER-CD (BELOW \/)
      *              TO COMPARE FIRST TWO CHARACTERS OF REFERENCE SO THAT
      *        CASH BACK WINDOW WILL OPEN IF OPERATORS INITIALS ARE ENTERED
      *        WITH CA AND PR.
      * HOLD-BR-TENDER-CD: USED TO BREAK DOWN BR-TENDER-CD SO THAT THE
      *        FIRST TWO CHARACTERS ONLY CAN BE COMPARED.
      *----------------------------------------------------------------
       01  HOLD-BR-TENDER-CDX   OCCURS 3.
           03  HOLD-BR-TENDER-CD    PIC X(2).
           03  FILLER               PIC X(3).

       01  SAVE-LP-REFNO            PIC X(5).
       01  SAVE-LP-REFNOX  REDEFINES SAVE-LP-REFNO.
           03  SAVE-LP-REFER        PIC X(2).
           03  FILLER               PIC X(3).

       01  SAVE-LP-APCUR            PIC S9(7)V99    COMP.
       01  SAVE-LP-TRCD             PIC X(2).
       01  HOLD-PL-OTH-AR           PIC S9(7)V99 COMP VALUE +0.
       01  HOLD-PATH                PIC X(35).

       01  HOLD-DLRVNO              PIC 99.
       01  HOLD-DLNO                PIC 9(4)V99.

       01  HOLD-BNKRPTDATE          PIC 9(8) COMP VALUE 0.
       01  CHG-BNKRPTDATE           PIC 9(8) COMP VALUE 0.
       01  BRNO-FOR-TY              PIC 9(4) COMP.
       01  HOLD-LN-DLRECOURSE       PIC X.
       01  HOLD-TP-OTHBR-FG         PIC X.
       01  HOLD-TP-POSTING-BR       PIC 9(4) COMP.
       01  HOLD-TP-BRNO             PIC 9(4) COMP.
       01  HOLD-ORIG-TP-BRNO        PIC 9(4) COMP.
       01  HOLD-ORIG-TP-POSTING-BR  PIC 9(4) COMP.
       01  HOLD-TP-LINE             PIC 9(3).
       01  HOLD-TPC-LINE            PIC 9(3).
       01  HOLD-TPG-LINE            PIC 9(3).
       01  HOLD-BW-ZIP              PIC X(10)    VALUE " ".
       01  SAVE1-LP1-KEY            PIC X(17)    VALUE " ".
       01  SAVE2-LP1-KEY            PIC X(17)    VALUE " ".
       01  HOLD-LP-SEQNO            PIC 9(5)     VALUE 0.
       01  HOLD-TRP1-KEY            PIC X(26)    VALUE SPACES.
       01  HOLD-TRP1-KEY-MIP        PIC X(26)    VALUE SPACES.
       01  HOLD-DUEDATE             PIC 9(8)     COMP VALUE 0.
       01  HOLD-PDTH-DATE           PIC 9(8)     COMP VALUE 0.

       01  HOLD-DF-MEMO.
           03  FILLER             PIC X(10).
           03  HOLD-DF-TEXT       PIC X(50).
       01  HOLD-DF-MEMO1 REDEFINES HOLD-DF-MEMO.
           03  DF-MEMO1           PIC X(30).
           03  DF-MEMO2           PIC X(30).
       01  HOLD-DF-MEMO2 REDEFINES HOLD-DF-MEMO.
           03  DF-MEMO3           PIC X(42).
           03  DF-MEMO4           PIC X(18).
       01  HOLD-MEMO-AMOUNT       PIC Z(5)99.99.
       01  HOLD-MEMO-DATE         PIC 99/99/99.

       01  HOLD-SS-SALE-MEMO.
           03  HOLD-SS-DATE      PIC 999999.
           03  FILLER            PIC X(1).
           03  HOLD-SS-SOLD-TO   PIC X(30).
           03  FILLER            PIC X(1).
           03  HOLD-SS-SOLD-AMT  PIC ZZZZ,ZZ9.99-.
           03  FILLER            PIC X(1).
           03  HOLD-SS-USERID    PIC X(09).

       01  ESCROW-MEMO.
           03  FILLER             PIC X(32) VALUE
               "ESCROW FLAG CHANGED FROM I TO Y,".
           03  FILLER             PIC X(1).
           03  ESCROW-MEMO-USERID PIC X(8).
           03  FILLER             PIC X(1).
           03  ESCROW-MEMO-DATE   PIC 99/99/99.
           03  FILLER             PIC X(1).
           03  ESCROW-MEMO-TIME   PIC X(8).
           03  FILLER             PIC X(1).

      *-------------------------------------------------------------
       01  HOLD-DS1-KEY              PIC X(19).
       01  ORIG-LN-REPOCD            PIC X        VALUE " ".
           88  ORIG-LN-IS-REPO-AR     VALUE "X" "S".
           88  ORIG-LN-REPO-ONHAND    VALUE "X".
           88  ORIG-LN-REPO-REDEEMED  VALUE "V".
           88  ORIG-LN-REPO-SOLD      VALUE "S".
       01  REPO-AR-SUB                PIC 9.
       01  REPO-PL-SUB                PIC 9.

       01  ORIG-LN-BNKRPTDATE        PIC 9(8)     VALUE 0.
           88  ORIG-LN-IS-NOT-BNKRPT  VALUE 0.
           88  ORIG-LN-IS-BNKRPT      VALUE 1 THROUGH 99999999.

       01  ORIG-LN-PLCD        PIC X        VALUE " ".
       01  ORIG-LN-PLTYPE      PIC X        VALUE " ".
       01  RV-LP-REFNO         PIC X(5)     VALUE " ".
       01  RV-LP-TRCD          PIC XX       VALUE " ".
           88  RV-PL-POSTING                VALUE "PL" "P2" "P3" "P4"
                                                  "P5".
           88  RV-DF-POSTING                VALUE "DF" "D2" "D3" "D4"
                                                  "D5" "D6" "D7" "D8"
                                                  "D9".
           88  RV-AD-POSTING                VALUE "AD" "A2" "A3" "A4"
                                                  "A5" "A6" "A7" "A8"
                                                  "A9".
       01  HOLD-LP-TRCD        PIC XX       VALUE " ".
           88  DF-POSTING                   VALUE "DF" "D2" "D3" "D4"
                                                  "D5" "D6" "D7" "D8"
                                                  "D9".
           88  PL-POSTING                   VALUE "PL" "P2" "P3" "P4"
                                                  "P5".
           88  AD-POSTING                   VALUE "AD" "A2" "A3" "A4"
                                                  "A5" "A6" "A7" "A8"
                                                  "A9".
       01  HOLD-LP-TRCDX       REDEFINES HOLD-LP-TRCD.
           03  FILLER          PIC X.
           03  TRCD-PLTYPE     PIC X.
           03  TRCD-NUM        REDEFINES TRCD-PLTYPE
                               PIC 9.

       01  TRCD-PLTYPE-NO      PIC 9.

       01  HOLD-LP-APCUR           PIC S9(7)V99 COMP.
       01  HOLD-LP-APOT2           PIC S9(7)V99 COMP.
       01  HOLD-LP-CURBAL          PIC S9(7)V99 COMP.
       01  HOLD-LP-OT2BAL          PIC S9(7)V99 COMP.

       01  DLRV-LP-REFNO            PIC X(5).
       01  DLRV-LP-REFNOX          REDEFINES DLRV-LP-REFNO.
           03  DLRV-LP-DLRVNO       PIC 9.
           03  FILLER               PIC X(4).
       01  DLRV-LP-P4P5-REFNOX     REDEFINES DLRV-LP-REFNO.
           03  DLRV-LP-P4P5-TRCD    PIC XX.
           03  DLRV-LP-P4P5-DLRVNO  PIC 9.
           03  FILLER               PIC X(2).

       01  DLRV-LP-DLNO             PIC 9(4)V99.
       01  P4P5-RSVAMT              PIC S9(7)V99 COMP.

       01  HOLD-CONTPDTH       PIC 999      COMP.
       01  DEF-NODEFACT        PIC S9       VALUE +0.
       01  AD-NOALDEL          PIC S9       VALUE +0.
       01  TEST-REB-AMOUNTS-FG PIC X        VALUE " ".

       01  TP-TRCD-TABLE          VALUE SPACES.
           03  TP-TRCD-TAB        OCCURS 13
                                  PIC XX.

       01  TP-REVSEQNO-TABLE      VALUE ZEROS.
           03  TP-REVSEQNO-TAB    OCCURS 13
                                  PIC 9(5).

       01  RV-LP-SEQNO            PIC 9(5)     VALUE 0.
       01  SAVE-LP-SEQNO          PIC 9(5)     VALUE 0.

       01  SAVE-CX1-KEY.
           03  SAVE-CX-BRNO    PIC 9(4).
           03  SAVE-CX-TYPE    PIC XX.
           03  SAVE-CX-SEQNO   PIC 9(4).

       01  INSPECT-W           PIC X(86).
       01  ADD-ON              PIC X(35).
       01  ADD-ON-TRCD         PIC XX.
       01  SAVE-DT-SEQ         PIC 9(3) COMP.

       01  PRIOR-RDSUB          PIC 99          COMP VALUE 0.
       01  PRIOR-CSUB           PIC 99          COMP VALUE 0.
       01  PRIOR-SAVE-OUTBAL    PIC S9(7)V99    COMP VALUE 0.

      *-----------------------------------------------------------------
      *    NET GAIN/LOSS ONLY
      *                   ____________________________________________________
      *    UNEARNED TABLE: 1 - INTEREST
      *                    2 - ADDON
      *                    3 - SERVICE CHARGE
      *                    4 - MAINTENANCE FEES
      *                    5 - DEALER DISCOUNT
      *                    6 - OTHER
      *    ------------------------------------------------------
       01  NET-UNEARNED.
           05  NET-UNEARNED-TYPE       OCCURS 6.
               07  NET-UNEARNED-AMT    PIC S9(8)V99 COMP.

       01  AFTER-RDSUB         PIC 99          COMP VALUE 0.
       01  AFTER-CSUB          PIC 99          COMP VALUE 0.
       01  AFTER-SAVE-OUTBAL   PIC S9(7)V99    COMP VALUE 0.

       01  WK-COMMISSION       PIC 9(8)V9(5) COMP.
       01  PART-RC-AMT         PIC S9(7)V99  COMP.
       01  TOTAL-REB-AMOUNTS   PIC S9(7)V99  COMP.
       01  TEST-AMT            PIC S9(7)V99  COMP  VALUE 0.
       01  ELE                 PIC 99        COMP  VALUE 0.
       01  ONE                 PIC S9        COMP.
       01  ONE-INS-RB-CAN      PIC S9        COMP.
       01  NO-RV-ONE           PIC S9        COMP.
       01  SUB                 PIC S9(5)     COMP  VALUE +0.
       01  MSUB                PIC S9(5)     COMP  VALUE +0.
       01  TRCD-PLSUB          PIC S9(5)     COMP  VALUE +0.
       01  ORIG-LN-PLSUB       PIC S9(5)     COMP  VALUE +0.
       01  DLRC                PIC 9.
       01  REC-EXISTS          PIC X         VALUE " ".
       01  NO1-EXISTS          PIC X         VALUE " ".

       01  WK-VARS.
           03  WK-REDEF          PIC X(24)     VALUE LOW-VALUES.
           03  FILLER          REDEFINES WK-REDEF.
               05  WK-TP-WORKAMT PIC S9(7)V99  COMP OCCURS 6.

       01  REBATE-DISP-TAB             PIC X(22) VALUE
           "RCRARPRIRSRMRDRER1R2R3".
       01  REBATE-DISP-RED REDEFINES  REBATE-DISP-TAB.
           03  REB-TYPE                PIC XX  OCCURS 11.

       01  HIGH-BUF                       VALUE " ".
           03  HIGH-CREDIT-X-BUF          PIC X(13).
           03  HIGH-CREDIT-BUF            PIC Z(6)B.
           03  AVAIL-SPACE.
               05  FILLER                 PIC X(11).
               05  AVAIL-BUF-RESTRICT-FG  PIC X.
           03  AVAIL-BUF                  REDEFINES AVAIL-SPACE
                                          PIC Z(7)9.99.

       01  AVA-BUF.
           03  AVAIL-X-BUF         PIC X(11).
       01  AVA-LIST.
           03  FILLER              PIC X(4)  VALUE "H24.".
       01  AVA-LIST-ATTR.
           03  FILLER              PIC X(7)  VALUE "H24:RF.".
       01  HIGH-LIST.
           03  FILLER              PIC X(12) VALUE "H22 H23 H25.".
       01  HIGH-LIST-ATTR.
           03  FILLER              PIC X(18) VALUE
               "H22:R H23:R H25:R.".

       01  WORKER              PIC S9(7)V99 COMP.

       01  UPD-LIST            PIC X(34) VALUE
           "H02 H04 H07 H071 H15 H17 H18 H181.".
       01  UPD-BUF             VALUE " ".
           03  D-1STPYDATE     PIC X(8).
           03  D-FINCHG        PIC ZZZZ9.99.
           03  D-H7            PIC ZZZZ9.99.
           03  D-H71           PIC X.
           03  D-LCHG          PIC ZZ9.99   BLANK ZERO.
           03  D-LCPDTH        PIC 9999     BLANK ZERO.
           03  D-DEFMNTS       PIC 99.
           03  D-ALDEL         PIC 99       BLANK ZERO.

       01  PROM-LIST           PIC X(4)     VALUE "H05.".
       01  PROM-DATE           PIC 99/99/99 BLANK ZERO.
       01  MIN-PROMISE-AMT     PIC 9(6)V99.
       01  SAVE-LN-PROMAMT     PIC 9(6)V99  COMP-3 VALUE 0.
       01  SAVE-LN-PROMDATE    PIC 9(8)     COMP-3 VALUE 0.
       01  SAVE-LN-PROMID      PIC X(3)     VALUE SPACES.
       01  SAVE-LN-PROMDAYS    PIC S9(3)    COMP-3 VALUE 0.

       01  D-LNNO-LIST         PIC X(13)  VALUE "LNNO SORTKEY.".
       01  D-LNNO-BUF.
           03  D-LOAN-NUM      PIC X(16).
           03  D-LCDESC        PIC X(16).

       01  ESCROW-WORK                 PIC S9(6)V99 COMP-3 VALUE 0.
       01  ESCROW-BALANCE              PIC S9(6)V99  COMP-3 VALUE 0.
       01  ESCROW-SUB                  PIC 99            VALUE 0.
       01  ESCROW-OUTSTANDING          PIC S9(7)V99 COMP-3 VALUE 0.
       01  CHANGE-ESCROW-FG            PIC X        VALUE "N".

      ******************************************************************
      *
      *    C O P Y - L I B R A R Y - W O R K E R S
      *
      ******************************************************************
       COPY "LIBLP/LPWKPATH.CPY".
       COPY "LIBGB/GETENVW.CPY".
       COPY "LIBGB/SPPDTHW.CPY".
       COPY "LIBGB/AGEINGW.CPY".
       COPY "LIBLP/LPUPWKW.CPY".
       COPY "LIBLP/LPUPERW.CPY".
       COPY "LIBGB/CONNECTW_SQL.CPY".
       COPY "LIBGB/FILEWK.CPY".
       COPY "LIBGB/MESSWK.CPY".
       COPY "LIBGB/DATERW.CPY".
       COPY "LIBGB/TIMEWK.CPY".
       COPY "LIBLP/LPIPBUF.CPY".
       COPY "LIBCL/CRNOR2W.CPY".
       COPY "LIBLP/LPDEFW.CPY".
       COPY "LIBLP/DEFPOLW.CPY".
       COPY "LIBLP/LPXDTEW.CPY".
       COPY "LIBLP/LPMDTEW.CPY".
       COPY "LIBLP/LPCDELW.CPY".
       COPY "LIBLP/LPCEPPW.CPY".
       COPY "LIBLP/LPMENUW.CPY".
       COPY "LIBLP/LPSETTYW.CPY".
       COPY "LIBLP/LPEARNW.CPY".
       COPY "LIBGB/GETPRW.CPY".
       COPY "LIBGB/DACCESSW.CPY".
       COPY "LIBGB/ACCESSW.CPY".
       COPY "LIBGB/SYSTEMW.CPY".
       COPY "LIBLP/LPDSCLW.CPY".
       COPY "LIBLP/LPSTATW.CPY".
       COPY "LIBLP/POSTDATEW.CPY".
       COPY "LIBLP/LPSRCDW.CPY".
       COPY "LIBGB/RBACTW.CPY".
       COPY "LIBGB/GPENVW.CPY".
       COPY "LIBLP/LPAVCRW.CPY".
       COPY "LIBLP/LPPOFFW.CPY".
       COPY "LIBLP/ADDONSPRW.CPY".
       COPY "LIBLP/LPAMTSW.CPY".
       COPY "LIBLP/LPIBPCW.CPY".
       COPY "LIBLP/LPRATEW.CPY".
       COPY "LIBGB/REBATEW.CPY".
       COPY "LIBLP/LPITRMW.CPY".
       COPY "LIBLP/LPSCHDW.CPY".
       COPY "LIBLP/LPLCAPW.CPY".
       COPY "LIBLP/LPLCHGW.CPY".
       COPY "LIBLP/LPLCASW.CPY".
       COPY "LIBLP/LPAPRSW.CPY".
       COPY "LIBLP/LPAPRZW.CPY".
       COPY "LIBLP/SETCTBLW.CPY".
       COPY "LIBLP/LPPDUEW.CPY".

       COPY "LIBGB/CONAME_EXT.CPY".
       COPY "LIBGB/SCREENW.CPY".
       COPY "LIBLP/LONPF_DEF.CPY".
       COPY "LIBLP/LONPF_WKS.CPY".
       COPY "LIBGB/HELPLINK.CPY".
       COPY "LIBGB/PRU_LNK.CPY".

       COPY "LIBCL/CLMENUW_EXT.CPY".

      **************************************************
      *   C O N T R O L   M O D U L E                  *
      **************************************************
       COPY "LIBGB/GETFMW.CPY".
       COPY "LIBLP/LPPFBUF.CPY".
       COPY "LIBLP/LPLOANW.CPY".

       SCREEN SECTION.
       COPY "LIBLP/LONPF_SCN.CPY".

       PROCEDURE DIVISION
           USING FORM-PATHNAME EXIT-PATHNAME PROG-BUF UPDATE-BUF.
       DECLARATIVES.
       DECLARE-ERROR SECTION.
           USE AFTER ERROR PROCEDURE ON
               WK-FILE REPAY-NO-FILE REPAY-TRP-FILE.
       COPY "LIBGB/DECLARE.CPY".
           PERFORM CLOSE-TY1-FILE.
           PERFORM CLOSE-TRP1-FILE.
           PERFORM CLOSE-SP1-FILE.
           PERFORM CLOSE-PD1-FILE.
           PERFORM CLOSE-NO1-FILE.
           PERFORM CLOSE-LXG1-FILE.
           PERFORM CLOSE-LXE1-FILE.
           PERFORM CLOSE-LX1-FILE.
           PERFORM CLOSE-LTP1-FILE.
           PERFORM CLOSE-LTI1-FILE.
           PERFORM CLOSE-LTB1-FILE.
           PERFORM CLOSE-LSX1-FILE.
           PERFORM CLOSE-LSP1-FILE.
           PERFORM CLOSE-LP1-FILE.
           PERFORM CLOSE-LN1-FILE.
           PERFORM CLOSE-LM1-FILE.
           PERFORM CLOSE-LC1-FILE.
           PERFORM CLOSE-IC1-FILE.
           PERFORM CLOSE-FM1-FILE.
           PERFORM CLOSE-FD1-FILE.
           PERFORM CLOSE-ES1-FILE.
           PERFORM CLOSE-DT1-FILE.
           PERFORM CLOSE-DS1-FILE.
           PERFORM CLOSE-CX1-FILE.
           PERFORM CLOSE-CH-FILE.
           PERFORM CLOSE-CD1-FILE.
           PERFORM CLOSE-CA1-FILE.
           PERFORM CLOSE-BW1-FILE.
           PERFORM CLOSE-BR-FILE.
           PERFORM CLOSE-GB-FILE.
           CLOSE WK-FILE.
           CLOSE REPAY-TRP-FILE REPAY-NO-FILE.
       COPY "LIBGB/DECLAR2.CPY".

      **************************************************
      *      P R O G R A M   C O N T R O L             *
      **************************************************
       MAIN-PROGRAM SECTION.

           PERFORM SQL-CONNECT.

      D    STOP MESS.
           MOVE FORM-PATHNAME TO FORM-PATH.
           MOVE " " TO VDU-WIMENU-SELECTION.
           MOVE "LONPF" TO VDU-FORM-NAME.

           PERFORM GET-GPENV.

           MOVE "FIL"           TO GETENV-BUF.
           PERFORM GETENV-CALL.
           MOVE GETENV-BUF      TO DATA-PATH.

           MOVE USER-PID TO TEMP-PID.

           MOVE 0 TO IO-FG.
           MOVE " " TO MESS.
           PERFORM RESTORE-SCREEN.

           PERFORM OPEN-LN1-FILE.
           PERFORM READ-LN1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

           IF LN-REC NOT = WK-SAVE-REC
      * IF ALLOTMENT PROCESSING (CALLED FROM LONPW?) THEN MOVE "M"
      * TO ERRCD AND EXIT
              IF OLD-FORM = "W"
                 MOVE "M" TO ERRCD
                 GO TO LOAN-UPDATE-EXIT
              END-IF
              MOVE "LOAN HAS BEEN CHANGED, RE-INPUT CHANGES" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO LOAN-CHANGED-EXIT.

           MOVE LN-PLCD TO ORIG-LN-PLCD.
           MOVE LN-PLTYPE TO ORIG-LN-PLTYPE.
           PERFORM GET-ORIG-LN-PLSUB.

      * WHEN THE LOAN HAS LN-REPODATE OR LN-SOLDDATE SET,
      * THE ACCOUNT 'AR' IS CARRIED UNDER REPO 'AR'
      * AND ORIG-LN-REPO-AR WILL BE SET.
      * -> ORIG-LN-REPOCD WILL IDENTIFY THE LOAN STATUS
      *    BEFORE THE TRANSACTION TOOK PLACE.

           MOVE LN-REPOCD TO ORIG-LN-REPOCD.

           IF LN-REPOCD = "X"
              MOVE 1 TO REPO-AR-SUB
           ELSE
              IF LN-REPOCD = "S"
                 MOVE 3 TO REPO-AR-SUB.

      * WHEN THE LOAN HAS LN-BNKRPTDATE SET AND THE ACCOUNT IS
      *  NOT REPO 'AR' AND THE ACCOUNT IS NOT P&L
      *
      * -> ORIG-LN-BNKRPTDATE WILL IDENTIFY THE LOAN STATUS
      *    BEFORE THE TRANSACTION TOOK PLACE.

           MOVE LN-BNKRPTDATE TO ORIG-LN-BNKRPTDATE.

           MOVE LP-APOT2  TO HOLD-LP-APOT2.
           MOVE LP-APCUR  TO HOLD-LP-APCUR.
           MOVE LP-OT2BAL TO HOLD-LP-OT2BAL.
           MOVE LP-CURBAL TO HOLD-LP-CURBAL.

           MOVE HOLD-SP1-KEY TO SP1-KEY.
           PERFORM OPEN-SP1-FILE.
      * MUST LEAVE SP1-FILE OPEN BECAUSE ADDONSPR READS IT
           PERFORM READ-SP1-FILE.
           IF IO-FG NOT = 0
              MOVE " INVALID STATE PARAMETER RECORD" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

      * LEAVE BRANCH FILE OPEN
           MOVE BRANCH TO BR-NO.
           PERFORM OPEN-BR-FILE.
           PERFORM READ-BR-FILE.
           IF IO-FG NOT = 0
              MOVE "INVALID BRANCH RECORD" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

      * NEED FOR LCAS ROUTINES (REPLACES GLOBRD)
           PERFORM OPEN-GB-FILE.
           MOVE GB-PATH-OWNBR TO GB-BRNO.
           MOVE 1             TO GB-NO.
           PERFORM READ-GB-FILE.
           PERFORM CLOSE-GB-FILE.
           IF IO-BAD
              MOVE "INVALID GLOBAL RECORD" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

           PERFORM GET-LC.

      * SET LP-REFNO TO EX. TPAY SO UPDATE ROUTINES MAKE TESTS
      * ON VALUE OF LP-REFNO WHEN REVERSED
           IF CONV-REV-FLAG NOT = "Y"
              IF HOLD-REV-LP-REFNO NOT = " "
                 IF LP-TRCD = "RV"
                    MOVE HOLD-REV-LP-REFNO TO LP-REFNO.

           PERFORM GET-CON-REC-PRIOR-LNUPD.
           PERFORM GET-UNEARN-STATS-PRIOR-LNUPD.

      * NEED TO SAVE THE PAYMENT DUE DATE BEFORE ITS POSTED FOR TP-DUEDATE
      * NEED TO SAVE CONTRACTUAL PAID THRU BEFORE ITS POSTED, FOR
      * TESTING TO CLEAR PROMISED FIELDS FOR REGACC
           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.
           PERFORM PAID-THRU-CALCULATION.
           MOVE PDTH-CUR-SCHD-DATE TO HOLD-DUEDATE.
           MOVE PDTH-DATE-FULL     TO HOLD-PDTH-DATE.


      **************************************************
      *  FILE UPDATE ROUTINES
      *
      *  EXAMPLE OF "PY" CODE:
      *
      *     IF NORMAL POSTING:
      *         SAVE-LP-TRCD = "PY"
      *         LP-TRCD      = "PY"
      *         HOLD-LP-TRCD = "PY"
      *         RV-LP-TRCD   = "  "
      *         RV-LP-REFNO  = "     "
      *         RV-LP-SEQNO  = 0000
      *         RV-RT-SEQNO  = 0000
      *
      *     IF REVERSAL:
      *         SAVE-LP-TRCD = "RV"
      *         LP-TRCD      = "RV"
      *         HOLD-LP-TRCD = "PY"
      *         RV-LP-TRCD   = "PY"
      *         RV-LP-REFNO  = LP-REFNO OF THE "PY"
      *         RV-LP-SEQNO  = LP-SEQNO OF THE "PY"
      *
      *     IF PAYOFF:
      *         ONE = -1
      *
      *     IF REVERSAL PAYOFF:
      *         ONE = +1
      *
      *     IF "OV" POSTING:
      *         ONE = 0
      *
      **************************************************

           MOVE 0 TO ONE.

           IF LP-CURBAL = 0
              IF LP-OTHBAL = 0
                 IF LP-OT2BAL = 0
                    IF LP-INTBAL = 0
                       IF LP-LCBAL = 0
                          MOVE -1 TO ONE.

           IF LN-CURBAL = 0
              IF LN-OTHBAL = 0
                 IF LN-OT2BAL = 0
                    IF LN-INTBAL = 0
                       IF LN-LCBAL = 0
                          MOVE 1 TO ONE.

           IF LP-TRCD = "RV"
              MOVE +1 TO ONE-INS-RB-CAN
              PERFORM UPDATE-LP-REVERSE
              IF NOT (HOLD-LP-TRCD = "PR" OR "PC" OR "PP"
                                          OR "P4" OR "P5")
                 MOVE LP-REFNO TO DLRV-LP-REFNO
              ELSE
                 NEXT SENTENCE
           ELSE
              MOVE -1 TO ONE-INS-RB-CAN
              MOVE LP-TRCD  TO HOLD-LP-TRCD
              MOVE LP-DLNO  TO DLRV-LP-DLNO
              MOVE LP-REFNO TO DLRV-LP-REFNO.

      *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
      *    ASSURE NO NUMBER OF ACCOUNTS IS AFFECTED IN UPDATES
      *    FOR 'OV' OVERPAID TRANSACTIONS
      *    OR 'DE' DISBURSE ESCROW TRANSACTIONS
      *------------------------------------------------------------------
           IF HOLD-LP-TRCD = "OV"
              MOVE 0 TO ONE.
           IF HOLD-LP-TRCD = "ED"
              MOVE 0 TO ONE.
           IF HOLD-LP-TRCD = "EP"
              MOVE 0 TO ONE.

      * CUSTOMERS CONVERTED FROM 50 DON'T HAVE DLRVNO IN 1ST
      * CHARACTER OF REFNO, SO FORCE 1
           IF HOLD-LP-TRCD = "PR"
              IF DLRV-LP-DLRVNO NOT NUMERIC
                 MOVE 1 TO DLRV-LP-DLRVNO.

           IF LP-TRCD = "RV"
              MOVE -1 TO NO-RV-ONE
           ELSE
              MOVE +1 TO NO-RV-ONE.

           IF HOLD-LP-TRCD = "PL"
              MOVE 1        TO TRCD-PLTYPE-NO
           ELSE
              MOVE TRCD-NUM TO TRCD-PLTYPE-NO.

           IF HOLD-LP-TRCD = "Z2"
              MOVE LP-APCUR TO LP-TRAMT.

      *    SAVED FOR CASH TENDER OPTION
           MOVE LP-TRAMT TO SAVE-LP-TRAMT.
           MOVE LP-REFNO TO SAVE-LP-REFNO.
           MOVE LP-TRCD  TO SAVE-LP-TRCD.

      *    SAVED FOR SP-ERNFRMLA = 15 & 16 UPDATE
           MOVE LP-APCUR TO SAVE-LP-APCUR.

           IF HOLD-LP-TRCD = "AP"
              COMPUTE LP-APCUR =
                     (LP-APINTOWE + LP-INTDUE + LP-LCPARTIALS) * -1
           ELSE
              IF HOLD-LP-TRCD = "O2"
                 COMPUTE LP-APCUR = (LP-APINTOWE) * -1
              ELSE
                 IF HOLD-LP-TRCD = "W2"
                    MOVE LP-APINTOWE TO LP-APCUR.

           COMPUTE TOTAL-REB-AMOUNTS =
                       REB-AMOUNT(1)  + REB-AMOUNT(2)
                     + REB-AMOUNT(3)  + REB-AMOUNT(4)
                     + REB-AMOUNT(5)  + REB-AMOUNT(6)
                     + REB-AMOUNT(7)  + REB-AMOUNT(8)
                     + REB-AMOUNT(9)  + REB-AMOUNT(10)
                     + REB-AMOUNT(11) + REB-AMOUNT(12)
                     + REB-AMOUNT(13).

           IF NOT (LP-TRCD = "JD" OR "PL" OR "P2" OR "P3"
                                  OR "P4" OR "P5" OR "PI"
                                  OR "SP" OR "DC" OR "ED")
              PERFORM UPDATE-BW1-FILE
              IF CONV-REV-FLAG = "Y"
                 IF NOT (LP-TRCD = "RV" AND HOLD-LP-REFNO = "NSF")
                    IF DF-POSTING
                          OR HOLD-LP-TRCD = "PY" OR "PE" OR "PO"
                                 OR "Z2" OR "SS" OR "AH" OR "OV"
                                 OR "IN"
                       PERFORM UPDATE-CA1-FILE
                    ELSE
                       NEXT SENTENCE
                 ELSE
                    NEXT SENTENCE
              ELSE
              IF NOT (LP-TRCD = "RV" AND LP-REFNO = "NSF")
                 IF DF-POSTING
                       OR HOLD-LP-TRCD = "PY" OR "PE" OR "PO"
                                      OR "Z2" OR "SS" OR "AH" OR "OV"
                                      OR "IN" OR "EP"
                    PERFORM UPDATE-CA1-FILE.

      * SIDE LOAN FOR LENDER PLACED INSURANCE, PR# 2728
      *    IF GP-I-AM-SOAUTO
      *        IF (LP-TRCD = "OT" AND LP-REFNO = "LPI  " )
      *             PERFORM CREATE-LPI-MEMO.

           IF HOLD-LP-TRCD = "SX" OR "ZX" OR "SV" OR "SS"
              PERFORM UPDATE-DS1-SXSVSS
           ELSE
              PERFORM UPDATE-DS1-FILE.

      *********************************************************
      *  UPDATE OTHER DEALER RESERVES:   "PR"  "PC"  "PP"
      *                                  "P4"  "P5"
      *
      *********************************************************
           IF HOLD-LP-TRCD = "PR" OR "PC" OR "PP"
                                  OR "P4" OR "P5"
              IF DLRV-LP-DLNO NOT = 0
                 PERFORM UPD-DS1-OTHER-DLRVBAL.


      * ONLY UPDATE IF NOT CALLING FROM AUTOMATIC RENEWAL (LONPQ1)
      * BEWARE: THAT HOLD-BP-TRCD IS ALSO USED FOR BATCH ALLOTMENT POSTING
           IF HOLD-BP-TRCD = " "
              IF (LP-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO")
                     OR PD1-EXISTS = "Y"
                 PERFORM UPDATE-PD1-FILE.

           IF HOLD-LP-TRCD = "SX" OR "ZX" OR "SV" OR "SS"
              PERFORM UPDATE-TY1-SXSVSS
              IF HOLD-LP-TRCD = "SS"
                 PERFORM UPDATE-TY1-SS
              ELSE
                 NEXT SENTENCE
           ELSE
              PERFORM UPDATE-TY1-FILE
              PERFORM UPDATE-TY1-FILE-DLR-RESV.

      *----------------------------------------------------------------
      *    UPDATE TY-REC OTHER DEALER RESERVES:   "PR"  "PC"  "PP"
      *                                           "P4"  "P5"
      *
           IF HOLD-LP-TRCD = "PR" OR "PC" OR "PP"
                                  OR "P4" OR "P5"
              IF DLRV-LP-DLNO NOT = 0
                 PERFORM UPD-TY1-OTHER-DLRVBAL.

      *----------------------------------------------------------------
      * UPDATE WITH POSTING BRANCH FOR NSF:
      *
           IF ( LP-REFNO = "NSF" ) OR
              ( CONV-REV-FLAG = "Y" AND HOLD-LP-REFNO = "NSF" )
              IF NOT ( (RV-LP-TRCD = "PA"               )
                       OR
                       (RV-LP-REFNO = "LBOX"  OR "TPAY"
                                   OR "TCOLL" OR "MGRAM")
                       OR
                       ( (BATCH-REFCD NOT = " "    ) AND
                         (RV-LP-REFNO = BATCH-REFCD)
                       )
                     )
                     IF BRANCH NOT = LN-OWNBR
                        PERFORM UPDATE-TY1-POST-BR.


           IF (LN-ESCROW-FG = "Y" OR LN-ESCROW-FG = "I")
              IF HOLD-LP-TRCD = "PY" OR "PA"
                 PERFORM UPDATE-ESCROW-COLLECTED
              ELSE IF HOLD-LP-TRCD = "ED"
                 PERFORM UPDATE-ESCROW-DISBURSED
              ELSE IF HOLD-LP-TRCD = "EP"
                 PERFORM UPDATE-ESCROW-PREPAID.

      *------------------------------------------------

           PERFORM UPDATE-LN1-FILE.

      *------------------------------------------------
      *    IF GP-USE-ACCRUAL-EARN-FILE = "Y" OR "R"
      *       IF (LP-TRCD = "PO" OR "PL" OR "P2" OR "P3"
      *                                  OR "P4" OR "P5") OR
      *          (LP-TRCD = "PA" AND LN-CURBAL = 0) OR
      *             (GP-IB-ACCRUE-EARN-ON-REPO NOT = "Y" AND
      *               LP-TRCD = "SS" OR "SX")
      *               PERFORM UPDATE-ACCRUAL-EARN-FILE.

      * UPDATE-LT:
           IF (HOLD-LP-TRCD = "RI" OR "RC" OR "RA" OR
                              "RP" OR "R1" OR "R2" OR "R3")
            OR (REB-AMOUNT(4) NOT = 0)
               IF LN-ADDON-FG = "Y"
                  PERFORM UPDATE-LT1-FILE.

      * LENDMARK - PAID THRU MODIFICATION (DEFERMENTS)
      *   TURN THE LS-P APPROVAL TRAILER INTO MEMO RECORDS AND DELETE
      *   THE TRAILER, PR# 2568
           IF GP-DEFERMENT-APPROVAL = "Y"
               IF DF-POSTING
                  PERFORM UPDATE-DEFERMENT-APPROVAL.

      *-----------------------------------------
      * UPDATE-CHECK-REQUESTS:

           IF LP-REFNO = "CHECK"
              IF LP-TRCD NOT = "RV"
                 IF LP-TRAMT > 0
                    PERFORM CHECK-UPDATE.


           MOVE 0 TO HOLD-LP-SEQNO.

      *-----------------------------------------
       UPDATE-TR1.

      *IF ANYBODY IS BRAVE ENOUGH TO FIX THIS!!! IF THERE IS A POOL ID ON
      *THE ACCOUNT, TP-LINE IS NOT SET CORRECT WHEN POSTING P/O. THE 'F'
      *RECORD NEEDS ITS OWN COUNTER LIKE HOLD-TPG-LINE & HOLD-TPC-LINE.ITS
      *USING HOLD-TP-LINE WHICH IS CAUSING THE 'P' LINE NUMBER TO SKIP A
      *NUMBER (1,3,5,) CAUSING THE REGISTER TO PRINT OUT OF ORDER.
      *APPEARS THIS HAS ALWAYS BEEN THIS WAY.

           MOVE 0 TO SUB HOLD-TP-LINE HOLD-TPC-LINE HOLD-TPG-LINE.
       UPDATE-TR1-OPEN.
           MOVE "UPDATING DAILY TRANSACTION FILE........." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           MOVE BRANCH   TO HOLD-TP-POSTING-BR.
           MOVE LN-OWNBR TO HOLD-TP-BRNO.
           MOVE " "      TO PWA-POOL-CHANGE-SW.

      * NEED TO KEEP ORIGINAL VALUES
           MOVE HOLD-TP-POSTING-BR TO HOLD-ORIG-TP-POSTING-BR.
           MOVE HOLD-TP-BRNO       TO HOLD-ORIG-TP-BRNO.

           IF HOLD-TP-POSTING-BR = HOLD-TP-BRNO
              MOVE " " TO HOLD-TP-OTHBR-FG
              PERFORM UPDATE-TR1-FILE
           ELSE
              IF RV-LP-TRCD NOT = "OV"
                 MOVE "G" TO HOLD-TP-OTHBR-FG
                 PERFORM UPDATE-TR1-FILE
              END-IF
              MOVE LN-OWNBR TO HOLD-TP-POSTING-BR
              MOVE BRANCH   TO HOLD-TP-BRNO
              MOVE "C"      TO HOLD-TP-OTHBR-FG
              PERFORM UPDATE-TR1-FILE.

           IF LN-MIP-FG = "Y"
              IF HOLD-LP-TRCD = "PY" OR "PA" OR "PE" OR "PR"
                             OR "PC" OR "PP" OR "SS" OR "IN"
                             OR "AH" OR "PX" OR "PN" OR "PZ"
                             OR "PO" OR "CC" OR "CA" OR "PB"
                             OR "RN" OR "SC" OR "RB" OR "RO"
                 MOVE TRP-PATH-SQL TO HOLD-PATH
                 PERFORM OPEN-TRP1-FILE
                 MOVE HOLD-TRP1-KEY-MIP TO TRP1-KEY
                 MOVE LN-OWNBR          TO TP-BRNO
                 PERFORM READ-TRP1-FILE
                 IF IO-GOOD
                    MOVE LN-MIP-FG           TO TP-MIP-FG
                    MOVE HOLD-LXM-MIP-CLPDTH TO TP-MIP-CLPDTH-DATE
                    MOVE HOLD-LXM-MIP-AHPDTH TO TP-MIP-AHPDTH-DATE
                    IF LN-INSPREM(1) NOT = 0
                       MOVE LN-INSCOMP(1) TO TP-INSCOMP
                    ELSE
                       MOVE LN-INSCOMP(2) TO TP-INSCOMP
                    END-IF
                    IF HOLD-LP-TRCD = "CC" OR "CA"
                       MOVE LN-INSPREM(1)    TO TP-MIP-CLPAID
                       MOVE LN-INSPREM(2)    TO TP-MIP-AHPAID
                    ELSE
                       IF NOT (TP-TRCD = "RC" OR "RA")
                          MOVE HOLD-LXM-MIP-CLPAID TO TP-MIP-CLPAID
                          COMPUTE TP-MIP-CLCOMM ROUNDED =
                                  TP-MIP-CLPAID * LN-INSCOMM(1)
                                                / LN-INSPREM(1)
                          MOVE HOLD-LXM-MIP-AHPAID TO TP-MIP-AHPAID
                          COMPUTE TP-MIP-AHCOMM ROUNDED =
                                  TP-MIP-AHPAID * LN-INSCOMM(2)
                                                / LN-INSPREM(2)
                       END-IF
                    END-IF
                    PERFORM REWRITE-TRP1-FILE
                 END-IF
                 PERFORM CLOSE-TRP1-FILE
                 MOVE HOLD-PATH TO TRP-PATH-SQL.

      *-----------------------------------------------------------
      * CLEAR THE LXG FIELDS AFTER THE FIRST TRP IS WRITTEN
      *   SO THE GLNO'S DONT GO INTO ALL THE REBATES
      * THEY WILL BE RESTORED TO WRITE THE LX RECORD BELOW
      *-----------------------------------------------------------
      *061019 NOT SURE IF THIS IS STILL NEEDED BECAUSE THE LXG
      *       AND LXE ARE SEPARATE FILES, BUT I LEFT IN IN HERE
           MOVE 0 TO LXG-GLNO(1)    LXG-GLNO(2)    LXG-GLNO(3)
                     LXG-GLAMT(1)   LXG-GLAMT(2)   LXG-GLAMT(3).

      *    MOVE 0 TO WK-LXE-EARN(1) WK-LXE-EARN(2) WK-LXE-EARN(3)
      *              WK-LXE-WORKER  WK-LXE-WORKER2.
           MOVE 0 TO LXE-EARN(1)    LXE-EARN(2)    LXE-EARN(3)
                     LXE-EARN(4)    LXE-EARN(5)    LXE-EARN(6)
                     LXE-EARN(7)    LXE-WORKER     LXE-WORKER2.

      *    08102021: WILL NO LONGER WRITE ADDITION TR RECORDS FOR
      *              POOLID.  TP-POOLID NO LONGER IN KEY.
      *    IF PWA-POOL-HAS-BEEN-CHANGED OR
      *        PWA-POOL-PAYMENT-MADE
      *       MOVE HOLD-ORIG-TP-POSTING-BR TO HOLD-TP-POSTING-BR
      *       MOVE HOLD-ORIG-TP-BRNO TO HOLD-TP-BRNO
      *       IF HOLD-TP-POSTING-BR = HOLD-TP-BRNO
      *          MOVE " " TO HOLD-TP-OTHBR-FG
      *          PERFORM UPDATE-TR1-FILE
      *       ELSE
      *          MOVE "G"      TO HOLD-TP-OTHBR-FG
      *          PERFORM UPDATE-TR1-FILE
      *          MOVE LN-OWNBR TO HOLD-TP-POSTING-BR
      *          MOVE BRANCH   TO HOLD-TP-BRNO
      *          MOVE "C"      TO HOLD-TP-OTHBR-FG
      *          PERFORM UPDATE-TR1-FILE.

           IF SUB NOT = 0
              GO TO NEXT-AVAIL-SEQ.

      *----------------------------
           MOVE "UPDATING LOAN PAYMENT FILE.............." TO MESS.
           PERFORM TEST-SEND-LEGEND.

      * SETUP-LP-SEQ:
           MOVE LN-OWNBR      TO LP-BRNO.
           MOVE LN-ACCTNO     TO LP-ACCTNO.
           MOVE 0             TO LP-SEQNO SUB.

           IF CONV-REV-FLAG NOT = "Y"
              IF LP-TRCD = "RV"
                 MOVE HOLD-LP-REFNO TO LP-REFNO.

           MOVE LP-REC TO WK-LP-REC.
           MOVE 99999  TO LP-SEQNO.
           PERFORM OPEN-LP1-FILE.

           MOVE LP-BRNO   TO QLP1-WBEG-BRNO
                             QLP1-WEND-BRNO.
           MOVE LP-ACCTNO TO QLP1-WBEG-ACCTNO
                             QLP1-WEND-ACCTNO.
           MOVE LP-SEQNO  TO QLP1-WEND-SEQNO.
           MOVE ALL "0"   TO QLP1-WBEG-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.
           PERFORM READ-LP1-FILE-PREVIOUS.
           PERFORM CLOSE-LP1-FILE.
           IF IO-FG NOT = 0 OR (LN-OWNBR NOT = LP-BRNO)
                             OR (LN-ACCTNO NOT = LP-ACCTNO)
              MOVE LN-OWNBR   TO LP-BRNO
              MOVE LN-ACCTNO  TO LP-ACCTNO
              MOVE 0          TO LP-SEQNO.

           PERFORM OPEN-LP1-FILE.
       NEXT-AVAIL-SEQ.
           ADD 1 TO LP-SEQNO.
           MOVE LP1-KEY TO SAVE1-LP1-KEY.
           PERFORM READ-LP1-FILE.
           IF IO-FG = 0
      *       UNLOCK LP-FILE
              GO TO NEXT-AVAIL-SEQ.

       UPDATE-LP1-REBATES.
           MOVE WK-LP-REC TO LP-REC.
           IF CONV-REV-FLAG = "Y"
              MOVE CONV-AMT-PAID-LAST  TO FOUND-LN-AMT-PAID-LAST
              MOVE CONV-DATE-PAID-LAST TO FOUND-LN-DATE-PAID-LAST
              MOVE LP-TRDATE TO LP-PAYDATE.
           MOVE SAVE1-LP1-KEY TO LP1-KEY.

           ADD 1 TO SUB.
           IF SUB NOT > 13
              PERFORM TEST-REB-AMOUNTS
              IF TEST-REB-AMOUNTS-FG NOT = "Y"
                 GO TO UPDATE-LP1-REBATES
              ELSE
                 COMPUTE LP-CURBAL = LN-CURBAL + LP-APCUR
                 + REB-AMOUNT(1)  + REB-AMOUNT(2)
                 + REB-AMOUNT(3)  + REB-AMOUNT(4)
                 + REB-AMOUNT(5)  + REB-AMOUNT(6)
                 + REB-AMOUNT(7)  + REB-AMOUNT(8)
                 + REB-AMOUNT(9)  + REB-AMOUNT(10)
                 + REB-AMOUNT(11) + REB-AMOUNT(12)
                 + REB-AMOUNT(13)
                 PERFORM SETUP-PAYOFF-REC
                 PERFORM TEST-SAVE-LP1-KEY
                 PERFORM WRITE-LP1-FILE
                 IF IO-FG NOT = 0
                    GO TO IO-ERROR
                 ELSE
                    PERFORM UPDATE-DT1-FILE
                    MOVE 0 TO REB-AMOUNT(SUB)
                    IF SUB = 4
                       MOVE 0 TO HOLD-DLRVCHGS-ADJ(1)
                                 HOLD-DLRVCHGS-ADJ(2)
                                 HOLD-DLRVCHGS-ADJ(3)
                                 HOLD-DLPARVHELD-ADJ
                                 HOLD-DLPARVPAID-ADJ
                       GO TO UPDATE-TR1-OPEN
                    ELSE
                       GO TO UPDATE-TR1-OPEN.

       UPDATE-LP1-FILE.
           IF HOLD-LP-TRCD = "AP"
              MOVE LP-APINTOWE TO LP-APOTH
              MOVE LP-INTDUE TO LP-APINT
              MOVE LP-LCPARTIALS TO LP-APLC
              COMPUTE LP-APCUR =
                 (LP-APOTH + LP-APINT + LP-APLC + LP-APOT2) * -1
           ELSE
           IF HOLD-LP-TRCD = "O2"
              MOVE LP-APINTOWE TO LP-APOT2
              COMPUTE LP-APCUR = (LP-APOT2) * -1
           ELSE
           IF HOLD-LP-TRCD = "W2"
              MOVE LP-APINTOWE TO LP-APOT2
              MOVE LP-APOT2 TO LP-APCUR.
      *    IF LP-TRCD = "SV"
      *       MOVE HOLD-LP-REPODATE TO LP-NEW1ST-PYDATE.

           IF CONV-REV-FLAG = "Y"
              MOVE HOLD-LP-REFNO TO LP-REFNO.
           IF CONV-REV-FLAG NOT = "Y"
              MOVE RV-LP-TRCD TO LP-REVTRCD
              MOVE RV-LP-SEQNO TO LP-REVSEQNO.
           PERFORM TEST-SAVE-LP1-KEY.

           PERFORM WRITE-LP1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

      * CREATE OVER PAYMENT "OV" LP-RECORD:
      
           IF ( BR-ALLOW-OV-TRCD = "Y" OR
                HOLD-BP-TRCD = "9A"    OR
                HOLD-BP-TRCD = "9X"    OR
                HOLD-BP-TRCD = "95"    OR
                HOLD-BP-TRCD = "96"    OR
                HOLD-BP-TRCD = "97"    OR
                HOLD-BP-TRCD = "99"
              )
              AND
              ( HOLD-OVPAID-CHECK NOT = 0 )
              MOVE LP-REC TO WK-LP-REC
              MOVE "OV"              TO LP-TRCD
              IF HOLD-BP-TRCD = "9A"
                 MOVE "ALLOT"                  TO LP-REFNO
              ELSE
                IF HOLD-BP-TRCD = "9X"
                   MOVE "LBOX"                 TO LP-REFNO
                ELSE
                  IF HOLD-BP-TRCD = "95"
                     MOVE "TPAY"               TO LP-REFNO
                  ELSE
                    IF HOLD-BP-TRCD = "96"
                       MOVE "TCOLL"            TO LP-REFNO
                    ELSE
                      IF HOLD-BP-TRCD = "97"
                         MOVE "MGRAM"          TO LP-REFNO
                      ELSE
                        IF HOLD-BP-TRCD = "99"
                           MOVE BATCH-REFCD    TO LP-REFNO
                        ELSE
                          IF NOT ( ( LP-REFNO = "ALLOT" OR "LBOX"
                                            OR "TCOLL" OR "TPAY"
                                            OR "MGRAM"
                                   )
                                   OR
                                   ( ( BATCH-REFCD NOT = " "  ) AND
                                     ( LP-REFNO = BATCH-REFCD )
                                   )
                                 )
                             MOVE "CHECK" TO LP-REFNO
                          END-IF
                        END-IF
                      END-IF
                    END-IF
                  END-IF
                END-IF
              END-IF
              MOVE HOLD-OVPAID-CHECK TO LP-TRAMT
              MOVE 0 TO LP-EARNED(1) LP-EARNED(2) LP-EARNED(3)
                        LP-DLRVCHGS-ADJ(1) LP-DLRVCHGS-ADJ(2)
                        LP-DLRVCHGS-ADJ(3)
                        LP-DLPARVHELD-ADJ LP-DLPARVPAID-ADJ
                        LP-APCUR LP-APLC LP-LCBAL LP-APOTH LP-APOT2
                        LP-APINT LP-OTHBAL LP-OT2BAL LP-INTBAL
                        LP-INTDUE LP-DLPROC LP-APINTOWE LP-INTPAID
                        LP-NEWSTAT-RATE LP-LCPARTIALS LP-LCPAID
                        LP-PREPAY-PENALTY LP-PRORATED-INS-REB
                        LP-OTHBAL LP-OT2BAL LP-LCBAL LP-INTBAL
                        LP-CURBAL
              ADD 1 TO LP-SEQNO
              PERFORM WRITE-LP1-FILE
              IF IO-FG NOT = 0
                 GO TO IO-ERROR
              END-IF

              PERFORM UPDATE-CA1-FILE
              PERFORM UPDATE-TR1-FILE

      * WHEN LN-DLPOOL IS SET THE FIRST UPDATE-TR1-FILE WROTE
      * A POOL (F) TR-REC AND NOT A TR-REC (P) FOR G/L UPDATE
      * SO GO CREATE ONE VIA UPDATE-TR1-FILE
      *
              IF LN-DLPOOL NOT = 0
                 MOVE PWA-POOL-CHANGE-SW TO SAVE-PWA-POOL-CHANGE-SW
                 MOVE " "                TO PWA-POOL-CHANGE-SW
                 PERFORM UPDATE-TR1-FILE
                 MOVE SAVE-PWA-POOL-CHANGE-SW TO PWA-POOL-CHANGE-SW
              END-IF
      * DO NOT CREATE CHECK REQUEST WHEN MERCURY OPTION 'M' IS SET
      * AND POSTING WAS DONE VIA BATCH POSTING
      * PL# 862, 10/13/14, FIXED OV FLAG OF "M" CREATED CXFILE
      
              IF ( ( BATCH-REFCD NOT = " "  ) AND
                   ( LP-REFNO = BATCH-REFCD )
                 )
                 PERFORM OPEN-CD1-FILE
                 MOVE "BR"        TO CD-TYPE
                 MOVE BATCH-REFCD TO CD-CODE
                 PERFORM READ-CD1-FILE
                 PERFORM CLOSE-CD1-FILE
                 IF IO-FG NOT = 0
                    MOVE "N" TO CD-BR-ALLOT-OPTION
                                CD-BR-LBOX-OPTION
                 END-IF
              END-IF

              IF NOT ( ( BR-BP-PAYOFF-OV = "M" AND
                         (HOLD-BP-TRCD = "9A" OR LP-REFNO = "ALLOT")
                       )
                       OR
                       ( BR-LBOX-PAYOFF-OV = "M" AND
                         ( (HOLD-BP-TRCD = "9X" OR "95"
                                        OR "96" OR "97")
                           OR
                           (LP-REFNO = "LBOX" OR "TCOLL"
                                    OR "TPAY" OR "MGRAM")
                         )
                       )
                       OR
                       ( ( ( BR-BP-PAYOFF-OV    = "M" AND
                             CD-BR-ALLOT-OPTION = "Y"      )
                           OR
                           ( BR-LBOX-PAYOFF-OV = "M"  AND
                             CD-BR-LBOX-OPTION = "Y"       )
                         )
                         AND
                         ( ( HOLD-BP-TRCD = "99" )
                           OR
                           ( ( BATCH-REFCD NOT = " "  ) AND
                             ( LP-REFNO = BATCH-REFCD )
                           )
                         )
                       )
                     )
                 PERFORM CHECK-UPDATE
              END-IF
              MOVE WK-LP-REC TO LP-REC.

           PERFORM CLOSE-LP1-FILE.
           MOVE LP-SEQNO TO SAVE-LP-SEQNO.

      * IF A REVERSAL OF AN "OV" TRANSACTION
      * REMOVE TEMPORARY CHECK REQUESTS
      
           IF RV-LP-TRCD = "OV"
              PERFORM REMOVE-TEMP-CHECKS.
      

      * CLEARED THE LXG FIELDS ABOVE BECAUSE THEY WERE
      *    GETTING WRITTEN IN EACH REBATE RECORD (TRP)

           MOVE WK-LXG-REC TO LXG-REC.

           IF NOT (LXG-GLAMT(1) = 0
                     AND LXG-GLAMT(2) = 0
                      AND LXG-GLAMT(3) = 0)
              MOVE LP-BRNO   TO LXG-BRNO 
              MOVE LP-ACCTNO TO LXG-ACCTNO
              MOVE LP-SEQNO  TO LXG-SEQNO
              PERFORM OPEN-LXG1-FILE
              PERFORM WRITE-LXG1-FILE
              PERFORM CLOSE-LXG1-FILE.

      * CLEARED THE LXE FIELDS ABOVE BECAUSE THEY WERE
      *    GETTING WRITTEN IN EACH REBATE RECORD (TRP)

              MOVE WK-LXE-REC TO LXE-REC.

              IF NOT (LXE-EARN(1) = 0
                     AND LXE-EARN(2) = 0
                     AND LXE-EARN(3) = 0
                     AND LXE-WORKER = 0
      *ALL 7 LEVELS OF LXE-EARN ARE CLEARED IN LONPF1
      *FUTURE FIELDS CLEARED IN LONPF1
                     AND LXE-EARN(4) = 0
                     AND LXE-EARN(5) = 0
                     AND LXE-EARN(6) = 0
                     AND LXE-EARN(7) = 0)
              MOVE LP-BRNO   TO LXE-BRNO 
              MOVE LP-ACCTNO TO LXE-ACCTNO
              MOVE LP-SEQNO  TO LXE-SEQNO
              PERFORM OPEN-LXE1-FILE
              PERFORM WRITE-LXE1-FILE
              PERFORM CLOSE-LXE1-FILE.

      * UPDATE-LX-FILE IF MORTGAGE INTEREST 'Z' AND PAYMENTS
           IF SP-CAL-RATETYPE(1) = "Z"
              IF HOLD-LP-TRCD = "PY"
                 MOVE LP-BRNO   TO LX-BRNO 
                 MOVE LP-ACCTNO TO LX-ACCTNO
                 MOVE LP-SEQNO  TO LX-SEQNO
                 PERFORM OPEN-LX1-FILE
                 PERFORM READ-LX1-FILE
                 IF IO-FG = 0
                    PERFORM MOVE-LXZ-FIELDS
                    PERFORM REWRITE-LX1-FILE
                    PERFORM CLOSE-LX1-FILE
                 ELSE
                    PERFORM CLEAR-LX-FILE
                    MOVE LP-BRNO   TO LX-BRNO 
                    MOVE LP-ACCTNO TO LX-ACCTNO
                    MOVE LP-SEQNO  TO LX-SEQNO
                    PERFORM MOVE-LXZ-FIELDS
                    PERFORM WRITE-LX1-FILE
                    PERFORM CLOSE-LX1-FILE.


      * UPDATE-LX-FILE IF MIP INSURANCE PAYMENTS
           IF LN-MIP-FG = "Y"
              IF HOLD-LP-TRCD = "PY" OR "PA" OR "PE" OR "PR"
                             OR "PC" OR "PP" OR "SS" OR "IN"
                             OR "AH" OR "PX" OR "PN" OR "PZ"
                             OR "PO" OR "CC" OR "CA" OR "PB"
                             OR "RN" OR "SC" OR "RB" OR "RO"
                 MOVE LP-BRNO   TO LX-BRNO 
                 MOVE LP-ACCTNO TO LX-ACCTNO
                 MOVE LP-SEQNO  TO LX-SEQNO
                 PERFORM OPEN-LX1-FILE
                 PERFORM READ-LX1-FILE
                 IF IO-FG = 0
                    PERFORM MOVE-LXM-FIELDS
                    PERFORM REWRITE-LX1-FILE
                    PERFORM CLOSE-LX1-FILE
                 ELSE
                    PERFORM CLEAR-LX-FILE
                    MOVE LP-BRNO   TO LX-BRNO 
                    MOVE LP-ACCTNO TO LX-ACCTNO
                    MOVE LP-SEQNO  TO LX-SEQNO
                    PERFORM MOVE-LXM-FIELDS
                    PERFORM WRITE-LX1-FILE
                    PERFORM CLOSE-LX1-FILE.


      * IF PAYOFF OR REBATE OF SVC CHG
      * THEN CHECK TO SEE IF THERE WAS A GEORGIA 4% CLOSING
      * FEE EARLY PROVISION, IF THERE IS THEN WRITE A TRAILER RECORD. 
      * CHECK FOR SPACES AND FOR DEF VALUE OF 5389762.88 IN CASE 
      * PROGRAMS GET COPIED IN WITHOUT THE FULL CHANGE.      
      *   IF HOLD-LP-TRCD = "PO" OR "PB" OR "RN" OR "SC" OR "RB" 
      *                          OR "RO" OR "RS"      
      * MANUAL "RS" POSTED
             IF HOLD-LP-TRCD = "RS"
                 IF ( HOLD-LXR-REB-AMT NOT = 0
                                   AND NOT = 2020202.02
                                   AND NOT = 0202020.20
                                   AND NOT = 5389762.88 )
                    MOVE LP-BRNO   TO LX-BRNO 
                    MOVE LP-ACCTNO TO LX-ACCTNO
                    MOVE LP-SEQNO  TO LX-SEQNO
                    PERFORM OPEN-LX1-FILE
                    PERFORM READ-LX1-FILE
                    IF IO-FG = 0
                       MOVE "R"              TO LXR-CODE
                       MOVE HOLD-LXR-REB-AMT TO LXR-REB-AMT
                       PERFORM REWRITE-LX1-FILE
                       PERFORM CLOSE-LX1-FILE
                    ELSE
                       PERFORM CLEAR-LX-FILE
                       MOVE LP-BRNO          TO LX-BRNO 
                       MOVE LP-ACCTNO        TO LX-ACCTNO
                       MOVE LP-SEQNO         TO LX-SEQNO
                       MOVE "R"              TO LXR-CODE
                       MOVE HOLD-LXR-REB-AMT TO LXR-REB-AMT
                       PERFORM WRITE-LX1-FILE
                       PERFORM CLOSE-LX1-FILE.


      * UPDATE-DT-FILE RECORDS
           PERFORM UPDATE-DT1-FILE.

      *-----------------------------------------
      *  UPDATE:  LN-DATE-PAID-LAST
      *           LN-INTPDTH-DATE
      *           LN-LCPDTH-DATE
           IF CONV-REV-FLAG = "Y"
              MOVE FOUND-LN-DATE-PAID-LAST TO FOUND-LN-INTPDTH-DATE
              MOVE CONV-LCPDTH-DATE TO FOUND-LN-LCPDTH-DATE.

      *<<<>>---------------------------------------------------------
      *       NOTE: AFTER UPDATE-LN1-REVERSAL IS PERFORMED
      *             THE LOAN PAYMENT RECORD WILL HAVE BEEN ALTERED
      *<<<>>---------------------------------------------------------
           IF LP-TRCD = "RV"
              PERFORM UPDATE-LN1-REVERSAL.

      *------------------------------------------------
      *  UPDATE:  TODAYS TOTALS & DEALER STATISTICS
      *           FOR AFTER TRAN UPDATED
      *------------------------------------------------
           IF (NOT (HOLD-LP-TRCD = "SX" OR "ZX" OR "SV" OR "SS"))
              IF NOT ORIG-LN-IS-REPO-AR
                 PERFORM GET-CON-REC-AFTER-LNUPD
                 PERFORM UPDATE-DS1-AFTER
                 PERFORM UPDATE-TY1-AFTER.

      *------------------------------------------------
      *  UPDATE:  NET CHANGE IN UNEARNED
      *           TODAYS TOTALS & DEALER STATISTICS
      *           FOR AFTER TRAN UPDATED
      *------------------------------------------------
           IF GP-UNEARNED-STATS = "Y"
              PERFORM GET-UNEARN-STATS-AFTER-LNUPD
              PERFORM UPDATE-DS1-UNEARN-AFTER
              PERFORM UPDATE-TY1-UNEARN-AFTER.

      * FTP/OUT/PAYS/NO.BRNO.NUMBER (DATA WAREHOUSE LAYOUT)
           IF GP-CREATE-PAY-XTRP-XNO = "Y"
              PERFORM UPDATE-REPAY-NO-FILE.

      *-----------------------------------------------
      *    SET UPDATED FIELDS TO THE SCREEN
      *-----------------------------------------------
           MOVE LN-1STPYDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO ALP-DATE-EDIT.
           MOVE LN-UNITPER-CD TO DATER-UNITPER-CD.
           MOVE LN-UNITPER-FREQ TO DATER-UNITPER-FREQ.
           PERFORM UNITPER-MASK.
           MOVE ALP-DATE-EDIT TO D-1STPYDATE.

           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.
           PERFORM PAID-THRU-CALCULATION.
           MOVE PDTH-CUR-SCHD-PAY TO D-H7.
           IF LN-PAY-SCHLD-FG = "Y"
              MOVE "S" TO D-H71.

           MOVE LN-SUM-FINCHG TO D-FINCHG.

           MOVE TRANS-DATE TO IBPC-DATE.
           PERFORM IBPC-TEST.
           IF ( IBPC-FG = "P" OR LN-LOANTYPE = "I" ) AND
              ( LN-ACCELDATE = 0                   ) AND
              ( ( SP-LCFRMLA NOT = " "            ) OR
                ( LN-LC-CODE NOT = ZEROES         )             
              )
              MOVE LN-LCPDTH-DATE TO LCHG-LCPDTH-DATE
              MOVE PDTH-CUR-SCHD-PAY TO LCHG-LATE
                                        LCHG-CURPAY
              PERFORM LATE-CHARGE-CALCULATION
              MOVE LCHG-CHARGE TO D-LCHG

              MOVE LN-LCPDTH-DATE TO NUM-DATE
              IF LN-UNITPER-CD-DAYS
                 MOVE NUM-DA TO NUM-YR
              END-IF
              MOVE NUM-MO TO NUM-DA
              MOVE NUM-DATE TO D-LCPDTH
           ELSE
              MOVE 0 TO D-LCHG D-LCPDTH.

           MOVE LN-TOTNODEF TO D-DEFMNTS.
           MOVE LN-TOTNOALDEL TO D-ALDEL.

           IF HOLD-BP-TRCD = " "
              MOVE UPD-LIST TO WR-LIST
              MOVE UPD-BUF  TO WR-BUF
              PERFORM CALL-WRFORM.

           IF BR-AVAIL-CREDIT = "Y"  AND
                  (LN-CREDITLIM NOT = 0) AND
                   (LN-BNKRPTDATE = 0)
              MOVE TRANS-DATE TO AVCR-PAYDATE
              MOVE MAKER-CD TO AVCR-MAKERCD
              PERFORM COMPUTE-AVAILABLE-CREDIT
              MOVE " HIGH CREDIT:" TO HIGH-CREDIT-X-BUF
              MOVE " AVAILABLE:" TO AVA-BUF
              MOVE LN-CREDITLIM TO HIGH-CREDIT-BUF
              MOVE AVCR-AVAILCREDIT TO AVAIL-BUF
              MOVE AVCR-RESTRICT-FG TO AVAIL-BUF-RESTRICT-FG
              IF HOLD-BP-TRCD = " "
                 MOVE HIGH-BUF TO WR-BUF
                 MOVE HIGH-LIST-ATTR TO WR-LIST
                 PERFORM CALL-WRFORM
                 MOVE AVA-BUF TO WR-BUF
                 MOVE AVA-LIST-ATTR TO WR-LIST
                 PERFORM CALL-WRFORM
              END-IF
           ELSE
           IF BR-AVAIL-CREDIT = "S"
              MOVE TRANS-DATE TO AVCR-PAYDATE
              MOVE MAKER-CD TO AVCR-MAKERCD
              PERFORM COMPUTE-AVAILABLE-CREDIT
              MOVE " CUR AVAIL:" TO HIGH-CREDIT-X-BUF
              MOVE " AVAILABLE:" TO AVAIL-X-BUF
      * SETTING CUR. AVAILABLE BY HIGH CREDIT IN LOAN RECORD
              MOVE AVCR-AVAILCREDIT TO HIGH-CREDIT-BUF
      * SETTING AVAILABLE BY A NEW PAYOFF
              MOVE AVCR-CURRENT-AVAIL TO AVAIL-BUF
              MOVE AVCR-RESTRICT-FG TO AVAIL-BUF-RESTRICT-FG
              IF HOLD-BP-TRCD = " "
                 MOVE HIGH-BUF TO WR-BUF
                 MOVE HIGH-LIST-ATTR TO WR-LIST
                 PERFORM CALL-WRFORM
                 MOVE AVA-BUF TO WR-BUF
                 MOVE AVA-LIST-ATTR TO WR-LIST
                 PERFORM CALL-WRFORM
              END-IF
           ELSE
              IF HOLD-BP-TRCD = " "
                 MOVE " " TO HIGH-BUF AVA-BUF
                 MOVE HIGH-BUF TO WR-BUF
                 MOVE HIGH-LIST TO WR-LIST
                 PERFORM CALL-WRFORM
                 MOVE AVA-BUF TO WR-BUF
                 MOVE AVA-LIST TO WR-LIST
                 PERFORM CALL-WRFORM.

      *******************************
      * TEST FOR CASH TENDERED ENTRY:
      *******************************
      *----------------------------------------------------------------
      * CHECK ONLY FIRST TWO CHARACTERS OF BR-TENDER-CD SO THAT
      * OPERATORS CAN ENTER THEIR INITIALS IN THE LAST 3 CHARACTER
      * POSITIONS OF THE REFERENCE FIELD.
      *----------------------------------------------------------------
           PERFORM VARYING MSUB FROM 1 BY 1 UNTIL MSUB > 3
              MOVE BR-TENDER-CD(MSUB) TO HOLD-BR-TENDER-CDX(MSUB)
           END-PERFORM.
           IF BR-TENDER-CD(1) NOT = " " AND
               BR-TENDER-CD(2) NOT = " " AND
                BR-TENDER-CD(3) NOT = " "
             IF SAVE-LP-REFER = HOLD-BR-TENDER-CD(1)
                             OR HOLD-BR-TENDER-CD(2)
                             OR HOLD-BR-TENDER-CD(3)
               IF DF-POSTING OR (SAVE-LP-TRCD = "PY" OR "PE" OR "PO"
                                        OR "SS" OR "Z2" OR "AH" OR "IN")
                   IF HOLD-BP-TRCD = SPACES
                      MOVE "CL/TENDER" TO FORM-NAM
                      CALL FORM-PROGX USING FORM-PATH SAVE-LP-TRAMT
                      CANCEL FORM-PROGX.

      ***********************************
      * SPR AUTOMATIC FORM REQUEST
      *    IF RV-LP-TRCD = "OV"
      ***********************************
           IF SP-REPO-TRCD(1) = HOLD-LP-TRCD OR
               SP-REPO-TRCD(2) = HOLD-LP-TRCD OR
                SP-REPO-TRCD(3) = HOLD-LP-TRCD
              PERFORM UPDATE-AUTO-FORM-REQUESTS.

      * ADDED 2 MORE AUTO REQUEST TRCD/FORM REQUESTS PR# 245
           IF SP-AUTO-SEND-TRCD(1) = HOLD-LP-TRCD OR
               SP-AUTO-SEND-TRCD(2) = HOLD-LP-TRCD
              PERFORM UPDATE-FORM-REQUESTS.

           IF GP-AUTO-BANKRUPT-WINDOW = "Y" AND SAVE-LP-TRCD = "BK"
              IF NOT (HOLD-BP-TRCD = "BK" OR "BD")
                 MOVE LN-OWNBR     TO EXT-WI-CL-OWNBR 
                 MOVE LN-ACCTNO    TO EXT-WI-CL-ACCTNO
      * USE THIS AS A TRIGGER TO CHBANK THAT LONPF2 CALLED IT
                 MOVE "F"          TO EXT-WI-CL-SALEFIN
                 MOVE "WI/CHBANK" TO FORM-NAM
                 CALL FORM-PROGX USING FORM-PATH EXIT-PATHNAME
                 CANCEL FORM-PROGX
                 MOVE " "          TO EXT-WI-CL-SALEFIN.


      **********************************
      *    RECEIPT PRINTING
      **********************************
           MOVE "U P D A T E    C O M P L E T E " TO MESS.

      * DONT MAKE THE SPR HAVE A "Y" IN PRINT FORM
      * BUT IF BRANCH HAS A "Y", MAKE SURE THERE IS A RECEIPT FORM NUMBER
           IF BR-IMMEDIATE-RECEIPT NOT = "Y"
              IF SP-PRFORM(4) = 0 OR SP-PRFLAG(4) NOT = "Y"
                 PERFORM TEST-SEND-LEGEND
                 GO TO LOAN-CHANGED-EXIT
              ELSE
                 NEXT SENTENCE
           ELSE
              IF SP-PRFORM(4) = 0
                 PERFORM TEST-SEND-LEGEND
                 GO TO LOAN-CHANGED-EXIT.

           IF NOT DF-POSTING
              IF NOT (HOLD-LP-TRCD = "PY" OR "PO" OR "RN" OR "SC"
                          OR "PB" OR "RB" OR "RO" OR "PA" OR "IN"
                          OR "Z2" OR "PE" OR "SS" OR "AH")
                 PERFORM TEST-SEND-LEGEND
                 GO TO LOAN-CHANGED-EXIT.

           PERFORM CREATE-FM-REC.
           MOVE LN-ACCTNO TO LOAN-KEY.

      * SPR RECEIPT OVERRIDE
           IF BR-IMMEDIATE-RECEIPT NOT = "Y"
              IF SP-IMED-REC NOT = "Y"
                 GO TO LOAN-CHANGED-EXIT.

      * BATCH ALLOTMENT PROCESSING
           IF HOLD-BP-TRCD NOT = " "
              GO TO LOAN-CHANGED-EXIT.

       PRINT-NOW.
           MOVE "PRINT RECEIPT NOW (Y/N/3) ?" TO MESS.
           PERFORM TEST-SEND-LEGEND.

           MOVE "E RA060SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS NOT = "00"
              GO TO PRINT-NOW.
           MOVE VDUBUF TO RECEIPT-BUF.
           IF RECEIPT-ANS = "N"
              GO TO LOAN-CHANGED-EXIT.
           IF RECEIPT-ANS NOT = "Y" AND NOT = "3"
              GO TO PRINT-NOW.

           MOVE "ENTER RECEIPT PRINTER #" TO MESS.
           PERFORM SEND-LEGEND.

           MOVE 0 TO Q-POS C-POS.
           MOVE LONPF-PRU-POS TO P-POS.
           MOVE "N" TO Q-BUF.
           MOVE "01" TO C-BUF.
       SETRP.
           MOVE "N" TO STAT.
           PERFORM PRU-IN.
           IF STAT = "10"
              GO TO LOAN-CHANGED-EXIT.
           IF STAT NOT = "00"
              GO TO SETRP.

           MOVE " " TO ROUTE-CD.
           MOVE "S" TO ERRCD.
           IF RECEIPT-ANS = "3"
              MOVE 6 TO IP-FMNO FD-FMNO
           ELSE
              MOVE SP-PRFORM(4) TO IP-FMNO FD-FMNO.
           PERFORM OPEN-FD1-FILE.
           PERFORM READ-FD1-FILE.
           PERFORM CLOSE-FD1-FILE.
           IF IO-FG NOT = 0
              MOVE "FORM DATA BASE NOT FOUND !" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO LOAN-CHANGED-EXIT.

           MOVE FD-PROG TO IP-PROG.
           IF FD-PRCONT = "Y"
              MOVE "1" TO CONT-PRINT
           ELSE
              MOVE "0" TO CONT-PRINT.

      *    CALL XFER USING STAT IP-LIST IP-BUF.
      *    IF STAT NOT = "00"
      *       GO TO IO-ERROR.
      *    CALL XFER USING STAT PROG-LIST PROG-BUF.
      *    IF STAT NOT = "00"
      *       GO TO IO-ERROR.

      *KC->MOVE IP-PROG TO PROG-WK-IP.
      *KC->MOVE PROG-WK TO FORM-NAM.
           PERFORM LPFRFD-FIND-PREFIX.
           MOVE LPWSFD-FORM-NAM TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PROG-BUF IP-BUF PRU-PATH
                                EXIT-PATHNAME.
           CANCEL FORM-PROGX.

           PERFORM PRU-OUT.

      *    CALL FLDVAL USING STAT IP-LIST IP-BUF.
      *    IF STAT NOT = "00"
      *       GO TO IO-ERROR.
      *    CALL FLDVAL USING STAT PROG-LIST PROG-BUF.
      *    IF STAT NOT = "00"
      *       GO TO IO-ERROR.

           IF ROUTE-CD = "R"
              GO TO END-ROUTINE.

       LOAN-CHANGED-EXIT.
      * CLEAR THE RECEIPT ANSWER, IT MESSES UP PAYOFF CODE IN A30
           IF HOLD-BP-TRCD = " "
              MOVE "S  A060SEL." TO VDU
              MOVE SPACES TO VDUBUF
              PERFORM SCREENIO.

           MOVE MENU-PROG-FORM(4) TO NEW-PROG-FORM.
           MOVE "P" TO ERRCD.

           PERFORM FULL-BRIEF-ROUTING.

       LOAN-UPDATE-EXIT.

           IF (HOLD-LP-TRCD = "PB" OR "RN" OR "SC" OR
                                 "PO" OR "RB" OR "RO" OR PL-POSTING)
                        OR (ONE = 1 OR -1)
              MOVE "UPDATING GLOBAL BORROWER INDEX..(BI)..." TO MESS
              PERFORM TEST-SEND-LEGEND
              MOVE 0 TO IO-FG
              MOVE "R" TO STAT
              PERFORM UPDATE-BI-FILE.

           PERFORM SAVE-SCREEN.

           GO TO END-ROUTINE.

      **************************************************
       UPDATE-LP-REVERSE SECTION.
      **************************************************
           IF CONV-REV-FLAG = "Y"
              GO TO UPDATE-LP-REV-EXIT.

           MOVE "REVERSING PAYMENT FILE.................." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM OPEN-LP1-FILE.
           MOVE LP1-KEY TO SAVE2-LP1-KEY.
       UPDATE-LP-REV.
      *    UNLOCK LP-FILE.
           MOVE SAVE2-LP1-KEY TO LP1-KEY.

           PERFORM READ-LP1-FILE.
           IF IO-FG NOT = 0
                  OR LP-REV = "Y"
              MOVE " PAYMENT REVERSAL ERROR" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO IO-ERROR.

           IF RV-LP-TRCD = " "
              MOVE LP-TRCD      TO RV-LP-TRCD
                                  HOLD-LP-TRCD
              MOVE LP-REFNO    TO RV-LP-REFNO
              MOVE LP-SEQNO    TO RV-LP-SEQNO

              MOVE LP-DLNO      TO DLRV-LP-DLNO
              MOVE LP-REFNO    TO DLRV-LP-REFNO.

           MOVE "Y" TO LP-REV.
           IF CONV-REV-FLAG NOT = "Y"
              PERFORM REWRITE-LP1-FILE.

           IF REV-REBATE NOT = "Y"
              GO TO UPDATE-LP-REV-EXIT.

           MOVE SAVE2-LP1-KEY TO LP1-KEY.

           MOVE LP-BRNO   TO QLP1-WBEG-BRNO
                             QLP1-WEND-BRNO.
           MOVE LP-ACCTNO TO QLP1-WBEG-ACCTNO
                             QLP1-WEND-ACCTNO.
           MOVE LP-SEQNO  TO QLP1-WEND-SEQNO.
           MOVE ALL "0"   TO QLP1-WBEG-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.
      * EXTRA READ-NEXT NEEDED BECAUSE START GETS REWRITTEN RECORD
           PERFORM READ-LP1-FILE-PREVIOUS.
      *    UNLOCK LP-FILE.
           PERFORM READ-LP1-FILE-PREVIOUS.
           IF IO-FG NOT = 0 OR (LP-PATH-OWNBR NOT = LP-BRNO)
              GO TO UPDATE-LP-REV-EXIT.

           MOVE LP1-KEY TO SAVE2-LP1-KEY.

           IF LP-MANUAL-RB = "Y"
              GO TO UPDATE-LP-REV-EXIT.

           IF LP-EARNED(1) NOT = 0 OR
               LP-EARNED(2) NOT = 0 OR
                LP-EARNED(3) NOT = 0 OR
                 LP-INTPAID NOT = 0
              GO TO UPDATE-LP-REV-EXIT.

           MOVE LP-BRNO   TO LXE-BRNO.
           MOVE LP-ACCTNO TO LXE-ACCTNO.
           MOVE LP-SEQNO  TO LXE-SEQNO.
           PERFORM OPEN-LXE1-FILE.
           PERFORM READ-LXE1-FILE.
           PERFORM CLOSE-LXE1-FILE.
           IF IO-FG = 0 AND (LXE-EARN(1) NOT = 0 OR
                             LXE-EARN(2) NOT = 0 OR
                             LXE-EARN(3) NOT = 0)
              GO TO UPDATE-LP-REV-EXIT.

      * CAPTURE REVERSED INS TAX REFUNDS ON A PAYOFF
      
           IF BR-FORCE-VALID-CITY-COUNTY = "Y"
              IF LP-TRCD = "RC" OR "CC"
                 COMPUTE HOLD-INS-TAX-RB(1) = 0 - LP-PRORATED-INS-REB
              END-IF
              IF LP-TRCD = "RA" OR "CA"
                 COMPUTE HOLD-INS-TAX-RB(2) = 0 - LP-PRORATED-INS-REB
              END-IF
              IF LP-TRCD = "RP" OR "CP"
                 COMPUTE HOLD-INS-TAX-RB(3) = 0 - LP-PRORATED-INS-REB
              END-IF
              IF LP-TRCD = "R1" OR "C1"
                 COMPUTE HOLD-INS-TAX-RB(4) = 0 - LP-PRORATED-INS-REB
              END-IF
              IF LP-TRCD = "R2" OR "C2"
                 COMPUTE HOLD-INS-TAX-RB(5) = 0 - LP-PRORATED-INS-REB
              END-IF
              IF LP-TRCD = "R3" OR "C3"
                 COMPUTE HOLD-INS-TAX-RB(6) = 0 - LP-PRORATED-INS-REB
              END-IF
              IF LP-TRCD = "R4" OR "C4"
                 COMPUTE HOLD-INS-TAX-RB(7) = 0 - LP-PRORATED-INS-REB
              END-IF
              IF LP-TRCD = "R5" OR "C5"
                 COMPUTE HOLD-INS-TAX-RB(8) = 0 - LP-PRORATED-INS-REB.

           IF LP-TRCD = "RC"
              IF TP-TRCD-TAB(1) = " "
                 MOVE LP-TRCD     TO TP-TRCD-TAB(1)
                 MOVE LP-SEQNO    TO TP-REVSEQNO-TAB(1)
                 GO TO UPDATE-LP-REV.
           IF LP-TRCD = "RA"
              IF TP-TRCD-TAB(2) = " "
                 MOVE LP-TRCD     TO TP-TRCD-TAB(2)
                 MOVE LP-SEQNO    TO TP-REVSEQNO-TAB(2)
                 GO TO UPDATE-LP-REV.
           IF LP-TRCD = "RP"
              IF TP-TRCD-TAB(3) = " "
                 MOVE LP-TRCD     TO TP-TRCD-TAB(3)
                 MOVE LP-SEQNO    TO TP-REVSEQNO-TAB(3)
                 GO TO UPDATE-LP-REV.
           IF LP-TRCD = "RI"
              IF TP-TRCD-TAB(4) = " "
                 MOVE LP-TRCD TO TP-TRCD-TAB(4)
                 MOVE LP-SEQNO TO TP-REVSEQNO-TAB(4)
                 GO TO UPDATE-LP-REV.
           IF LP-TRCD = "RS"
              IF TP-TRCD-TAB(5) = " "
                 MOVE LP-TRCD TO TP-TRCD-TAB(5)
                 MOVE LP-SEQNO TO TP-REVSEQNO-TAB(5)
                 GO TO UPDATE-LP-REV.
           IF LP-TRCD = "RM"
              IF TP-TRCD-TAB(6) = " "
                 MOVE LP-TRCD TO TP-TRCD-TAB(6)
                 MOVE LP-SEQNO TO TP-REVSEQNO-TAB(6)
                 GO TO UPDATE-LP-REV.
           IF LP-TRCD = "RD"
              IF TP-TRCD-TAB(7) = " "
                 MOVE LP-TRCD TO TP-TRCD-TAB(7)
                 MOVE LP-SEQNO TO TP-REVSEQNO-TAB(7)
                 GO TO UPDATE-LP-REV.
           IF LP-TRCD = "R1"
              IF TP-TRCD-TAB(9) = " "
                 MOVE LP-TRCD     TO TP-TRCD-TAB(9)
                 MOVE LP-SEQNO    TO TP-REVSEQNO-TAB(9)
                 GO TO UPDATE-LP-REV.
           IF LP-TRCD = "R2"
              IF TP-TRCD-TAB(10) = " "
                 MOVE LP-TRCD     TO TP-TRCD-TAB(10)
                 MOVE LP-SEQNO    TO TP-REVSEQNO-TAB(10)
                 GO TO UPDATE-LP-REV.
           IF LP-TRCD = "R3"
              IF TP-TRCD-TAB(11) = " "
                 MOVE LP-TRCD     TO TP-TRCD-TAB(11)
                 MOVE LP-SEQNO    TO TP-REVSEQNO-TAB(11)
                 GO TO UPDATE-LP-REV.

       UPDATE-LP-REV-EXIT.
           PERFORM CLOSE-LP1-FILE.
           MOVE "N" TO REV-REBATE.
           MOVE WK-LP-REC  TO LP-REC.
           MOVE WK-LX-REC  TO LX-REC.
           MOVE WK-LXE-REC TO LXE-REC.
           MOVE WK-LXG-REC TO LXG-REC.

      **********************************************
       UPDATE-BW1-FILE SECTION.
      **********************************************
           MOVE "UPDATING BORROWER FILE.................." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM GET-COLLATERAL.

           MOVE 0 TO SUB.
           PERFORM OPEN-BW1-FILE.
       UPDATE-BW1-CONT.
           ADD 1 TO SUB.
           IF SUB > 4
              PERFORM CLOSE-BW1-FILE
              GO TO EXIT-UPDATE-BW1-FILE.

           IF LN-SSNO(SUB) = 0
              GO TO UPDATE-BW1-CONT.

           MOVE LN-SSNO(SUB) TO BW-SSNO
           PERFORM READ-BW1-FILE
           IF IO-FG NOT = 0
              GO TO UPDATE-BW1-CONT.


           IF LN-SERVACCT = "Y"
              COMPUTE BW-LIAOTH = BW-LIAOTH
                            - LP-APCUR - TOTAL-REB-AMOUNTS
           ELSE
           IF LN-SMALLOAN = "Y"
              COMPUTE BW-LIASMLN = BW-LIASMLN
                            - LP-APCUR - TOTAL-REB-AMOUNTS
           ELSE
              COMPUTE BW-LIAOTH = BW-LIAOTH
                            - LP-APCUR - TOTAL-REB-AMOUNTS.

      * UPDATE THE BORROWER THAT MADE THE PAYMENT AND
      * SAVE THE SSNO (SUB) AND ZIP FOR THE FM RECEIPT RECOD:
           IF CONV-REV-FLAG="Y"
              MOVE BW-SSNO TO LP-SSNO.
           IF BW-SSNO = LP-SSNO
              MOVE SUB TO BW-SUB
              MOVE BW-ZIP TO HOLD-BW-ZIP
              IF CD-CO-SECURED = "R"
                 ADD LP-INTPAID TO BW-RE-INTYTD
              ELSE
                 ADD LP-INTPAID TO BW-INTYTD.

           IF ONE = -1
              MOVE LP-PAYDATE TO BW-LASTPODATE
           ELSE
              IF RV-LP-TRCD NOT = "OV"
                 MOVE 0 TO BW-LASTPODATE.

      **************************************************
      *    IF ACCT IS CLOSED (PAID OFF), ONE = -1
      *    IF THIS IS A  (REV PAID OFF), ONE = +1
      *    ELSE, NO EFFECT               ONE =  0
      **************************************************

           ADD ONE TO BW-LOANS.
           SUBTRACT ONE FROM BW-PRLOANS.

           PERFORM REWRITE-BW1-FILE.
           GO TO UPDATE-BW1-CONT.

       EXIT-UPDATE-BW1-FILE.
           EXIT.

      **********************************************
       UPDATE-CA1-FILE SECTION.
      **********************************************
           IF ( LP-REFNO =    "LBOX" OR "TCOLL" OR "TPAY"
                                     OR "MGRAM" OR "ALLOT" ) OR
              ( RV-LP-REFNO = "LBOX" OR "TCOLL" OR "TPAY"
                                     OR "MGRAM" OR "ALLOT" ) OR
              ( ( BATCH-REFCD NOT = " " ) AND
                ( ( LP-REFNO = BATCH-REFCD    ) OR
                  ( RV-LP-REFNO = BATCH-REFCD )
                )
              )
              GO TO UPDATE-CA1-FILE-EXIT.

           MOVE "UPDATING CASH DRAWER FILE..............." TO MESS.
           PERFORM TEST-SEND-LEGEND.

      * INTERBRANCH; LP/INTRBR PUTS YOU IN THE "OWNING" BRANCHES FILES, SO
      *              PATH-MACHINE IS THE "POSTING" BRANCH....
      *              LP/INTRBR SETS EXT-USE-EXT-FILPATHS TO "Y"

      * BUILD CA-PATH TO SAVE
           PERFORM LOAD-CA1-FILE.
           MOVE CA-PATH-SQL TO HOLD-PATH. 

           IF PATH-MACHINE NOT = " "
              MOVE EXT-FILPATH-BASE        TO CA-ALL-BASE
              MOVE PATH-MACHINE            TO CA-ALL-MACHINE
              MOVE PATH-DATA               TO CA-ALL-DATA
              MOVE CA-ALL-PATH             TO CA-PATH
              MOVE "Y"                     TO CA-PATH-OVERRIDE.

           PERFORM OPEN-CA1-FILE.
           MOVE LP-TILLNO TO CA-TILLNO.
           MOVE LP-TRDATE TO CA-DATE.
           MOVE BRANCH    TO CA-BRNO.
           PERFORM READ-CA1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

           ADD LP-TRAMT TO CA-RUNNING.

           PERFORM REWRITE-CA1-FILE.
           PERFORM CLOSE-CA1-FILE.
           MOVE HOLD-PATH TO CA-PATH-SQL.

           MOVE " " TO CA-PATH-OVERRIDE.

       UPDATE-CA1-FILE-EXIT.
           EXIT.


      ***************************************
       CREATE-SS-SALE-MEMO SECTION.
      ***************************************
           PERFORM OPEN-LM1-FILE.

           MOVE SPACES TO HOLD-SS-SALE-MEMO.
           MOVE LP-BRNO   TO LM-BRNO.
           MOVE LP-ACCTNO TO LM-ACCTNO.
           PERFORM SET-POSTDATE.
           MOVE POST-USERID        TO HOLD-SS-USERID.
           MOVE LP-ACCTNO TO LM-ACCTNO.
           SUBTRACT LP-TRDATE FROM 999999999 GIVING LM-DATE.
           MOVE LP-PAYDATE             TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY            TO HOLD-SS-DATE.
           MOVE LSX-SOLD-TO(1)         TO HOLD-SS-SOLD-TO.
           MOVE LSX-SOLD-TO-AMT        TO HOLD-SS-SOLD-AMT.
           MOVE HOLD-SS-SALE-MEMO      TO LM-MEMO.
           MOVE "9 "                   TO LM-MEMO-TYPE.
           MOVE 1 TO LM-SEQ.
       CREATE-SS-SALES-MEMO-AGAIN.
           PERFORM WRITE-LM1-FILE.
           IF IO-BAD
              IF LM-SEQ NOT = 999
                 ADD 1 TO LM-SEQ
                 GO TO CREATE-SS-SALES-MEMO-AGAIN.

           PERFORM CLOSE-LM1-FILE.
           MOVE SPACES TO HOLD-SS-SALE-MEMO.
       CREATE-SS-SALES-MEMO-EXIT.
           EXIT.


      ****************************
       CREATE-ESCROW-MEMO SECTION.
      ****************************
           PERFORM OPEN-LM1-FILE.

           PERFORM SET-POSTDATE.
           MOVE POST-USERID TO ESCROW-MEMO-USERID.
           MOVE POST-DATE   TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY   TO ESCROW-MEMO-DATE.
           PERFORM GET-TIME.
           MOVE TIME-EDIT   TO ESCROW-MEMO-TIME.
           MOVE LP-BRNO   TO LM-BRNO.
           MOVE LP-ACCTNO TO LM-ACCTNO.
           SUBTRACT LP-TRDATE FROM 999999999 GIVING LM-DATE.
           MOVE ESCROW-MEMO       TO LM-MEMO.
           MOVE 1 TO LM-SEQ.
       CREATE-ESCROW-MEMO-AGAIN.
           PERFORM WRITE-LM1-FILE.
           IF IO-BAD
              IF LM-SEQ NOT = 999
                 ADD 1 TO LM-SEQ
                 GO TO CREATE-ESCROW-MEMO-AGAIN.
           PERFORM CLOSE-LM1-FILE.
       CREATE-ESCROW-MEMO-EXIT.
           EXIT.

      ***********************************
       UPDATE-DEFERMENT-APPROVAL SECTION.
      ***********************************

           PERFORM OPEN-LM1-FILE.
           MOVE 0 TO LM-SEQ.

           PERFORM OPEN-LSP1-FILE.
           MOVE LN-OWNBR  TO LSP-BRNO.
           MOVE LN-ACCTNO TO LSP-ACCTNO.
           MOVE 1         TO LSP-SEQNO.
           PERFORM READ-LSP1-FILE.
           IF (IO-BAD)
              GO TO EXIT-UPDATE-DEFERMENT-APPROVAL.

           MOVE SPACES TO HOLD-DF-MEMO.
           STRING "REASON CODE: ",LSP-REASON-CODE DELIMITED
               BY "   " INTO DF-MEMO1.
           STRING "# OF MONTHS: ",LSP-PERIODS-TO-DEFER
               DELIMITED BY "   " INTO DF-MEMO2.
           PERFORM UPDATE-DF-MEMO.

           IF LSP-REASON-FOR-DEFER NOT = SPACES
              MOVE "REASON:" TO HOLD-DF-MEMO
              MOVE LSP-REASON-FOR-DEFER TO HOLD-DF-TEXT
              PERFORM UPDATE-DF-MEMO.

           STRING "MORTGAGE PAST DUE: ",LSP-MORTGAGE-PAST-DUE
                DELIMITED BY "   " INTO DF-MEMO1.
           MOVE LSP-MORTGAGE-BALANCE TO HOLD-MEMO-AMOUNT.
           STRING "MORTGAGE BALANCE: ",HOLD-MEMO-AMOUNT
               DELIMITED BY "      " INTO DF-MEMO2.
           PERFORM UPDATE-DF-MEMO.

           IF LSP-ATTEMPT-REFINANCE NOT = SPACES
              MOVE "ATTEMPT:" TO HOLD-DF-MEMO
              MOVE LSP-ATTEMPT-REFINANCE TO HOLD-DF-TEXT
              PERFORM UPDATE-DF-MEMO.

           STRING "WHO ENTERED INFO: ",LSP-INFO-USERID
                DELIMITED BY "   " INTO DF-MEMO1.
           MOVE LSP-INFO-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO HOLD-MEMO-DATE.
           STRING "DATE ENTERED INFO: ",HOLD-MEMO-DATE
               DELIMITED BY "  " INTO DF-MEMO2.
           PERFORM UPDATE-DF-MEMO.

           IF LSP-BR-MANAGER-COMMENTS NOT = SPACES
              MOVE "MGR COMM:" TO HOLD-DF-MEMO
              MOVE LSP-BR-MANAGER-COMMENTS TO HOLD-DF-TEXT
              PERFORM UPDATE-DF-MEMO.

           STRING "USERID MANAGER: ",LSP-BR-MANAGER-USERID
                DELIMITED BY "   " INTO DF-MEMO1.
           MOVE LSP-BR-MANAGER-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO HOLD-MEMO-DATE.
           STRING "DATE MANAGER: ",HOLD-MEMO-DATE
               DELIMITED BY "  " INTO DF-MEMO2.
           PERFORM UPDATE-DF-MEMO.

           IF LSP-AVP-COMMENTS NOT = SPACES
              MOVE "AVP COMM:" TO HOLD-DF-MEMO
              MOVE LSP-AVP-COMMENTS TO HOLD-DF-TEXT
              PERFORM UPDATE-DF-MEMO.

           STRING "AVP APPROVED: ",LSP-AVP-APPROVE,
                  " USERID AVP: ",LSP-AVP-USERID
                         DELIMITED BY "   " INTO DF-MEMO3.
           MOVE LSP-AVP-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO HOLD-MEMO-DATE.
           STRING "DATE AVP: ",HOLD-MEMO-DATE DELIMITED BY
                                        "  " INTO DF-MEMO4.
           PERFORM UPDATE-DF-MEMO.

           IF LSP-VP-COMMENTS NOT = SPACES
              MOVE "VP COMM:" TO HOLD-DF-MEMO
              MOVE LSP-VP-COMMENTS TO HOLD-DF-TEXT
              PERFORM UPDATE-DF-MEMO.

           STRING "VP APPROVED: ",LSP-VP-APPROVE,
                  " USERID VP: ",LSP-VP-USERID
                         DELIMITED BY "   " INTO DF-MEMO3.
           MOVE LSP-VP-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO HOLD-MEMO-DATE.
           STRING "DATE VP: ",HOLD-MEMO-DATE DELIMITED BY
                                       "  " INTO DF-MEMO4.
           PERFORM UPDATE-DF-MEMO.

      * REMOVE TRAILER RECORD AFTER CREATING ALL MEMOS
           PERFORM DELETE-LSP1-FILE.

       EXIT-UPDATE-DEFERMENT-APPROVAL.
           PERFORM CLOSE-LM1-FILE.
           PERFORM CLOSE-LSP1-FILE.

      *****************************************
       UPDATE-DF-MEMO SECTION.
      *****************************************
           MOVE LN-OWNBR  TO LM-BRNO.
           MOVE LN-ACCTNO TO LM-ACCTNO.
           SUBTRACT LP-TRDATE FROM 999999999 GIVING LM-DATE.

           MOVE HOLD-DF-MEMO TO LM-MEMO.
           ADD 1 TO LM-SEQ.
       CREATE-DF-MEMO-AGAIN.
           PERFORM WRITE-LM1-FILE.
           IF IO-BAD
              IF LM-SEQ NOT = 999
                 ADD 1 TO LM-SEQ
                 GO TO CREATE-DF-MEMO-AGAIN.

           MOVE SPACES TO HOLD-DF-MEMO.
       
      *****************************************
       UPDATE-DS1-FILE SECTION.
      *****************************************
           MOVE "UPDATING DEALER STATISTICS FILE........." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM OPEN-DS1-FILE.
           MOVE "N" TO REC-EXISTS.
       UPDATE-DS1-CHECK-EXISTS.
           MOVE TRANS-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.
           MOVE DATE-YYYYMM TO DS-DATE-CCYYMM.
           MOVE LN-OWNBR TO DS-BRANCH.
           MOVE LN-DLNO  TO DS-DLNO.
           MOVE LN-CLASS TO DS-CLASS.
           MOVE DS1-KEY  TO HOLD-DS1-KEY.
           PERFORM READ-DS1-FILE.
           IF IO-FG NOT = 0
              IF REC-EXISTS = "Y"
                 GO TO IO-ERROR
              ELSE
                 PERFORM DS1-CREATE-REC
                 GO TO UPDATE-DS1-CHECK-EXISTS.

           IF NOT ORIG-LN-IS-REPO-AR
              IF (HOLD-LP-TRCD = "BK" OR "BD")
                 IF (HOLD-LP-TRCD = "BK" AND SAVE-LP-TRCD = "RV") OR
                    (SAVE-LP-TRCD = "BD")
                    PERFORM UPDATE-DS1-PRIOR-BNKRPT
                 END-IF
              ELSE
                 PERFORM UPDATE-DS1-PRIOR.

           IF LN-DLRECOURSE = "F"
              MOVE 1 TO DLRC
           ELSE
              IF LN-DLRECOURSE = "P"
                 MOVE 2 TO DLRC
              ELSE
                 IF LN-DLRECOURSE = "N"
                    MOVE 3 TO DLRC
                 ELSE
                    MOVE 0 TO DLRC.

      * UPDATE AFP DUE DEALER MEMO:
           ADD HOLD-AFPDLLP TO DS-AFPDUEDL-MEMO.

           IF HOLD-LP-TRCD = "JD"
              IF RV-LP-TRCD = "JD"
                 MOVE 0 TO LN-JDDATE
                 ADD LP-INTDUE LP-APINTOWE TO DS-JDOSAMT(1)
                 SUBTRACT 1 FROM DS-JDOSUNIT(1)
              ELSE
                 ADD LP-INTDUE LP-APINTOWE TO DS-JDOSAMT(1)
                 ADD 1 TO DS-JDOSUNIT(1).

           IF PL-POSTING
              IF RV-PL-POSTING
                 MOVE " " TO LN-PLCD
                             LN-PLTYPE
                             LN-PLREASON
                 IF ORIG-LN-REPO-SOLD
                    ADD LP-INTDUE LP-APINTOWE TO DS-PLOSAMT(1)
                    SUBTRACT 1 FROM DS-PLOSUNIT(1)
                    SUBTRACT LP-INTDUE
                             LP-APINTOWE FROM DS-AMT-REPO(DSCUR DSNET 3)
                    ADD 1 TO DS-NO-REPO(DSCUR DSNET 3)
                    PERFORM DS1-PL-UPDATE-RV-AMOUNTS
                    ADD LP-INTDUE
                        LP-APINTOWE TO DS-AMT-REPO(DSCUR DSNET 5)
                                       DS-AMT-REPO(DSMTD DSVOL 5)
                                       DS-AMT-REPO(DSYTD DSVOL 5)
                    SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 5)
                                    DS-NO-REPO(DSMTD DSVOL 5)
                                    DS-NO-REPO(DSYTD DSVOL 5)
                    PERFORM DS1-PL-UPDATE-RV-AMOUNTS
                 ELSE IF ORIG-LN-REPO-ONHAND
                    ADD LP-INTDUE LP-APINTOWE TO DS-PLOSAMT(1)
                    SUBTRACT 1 FROM DS-PLOSUNIT(1)
                    SUBTRACT LP-INTDUE
                             LP-APINTOWE FROM DS-AMT-REPO(DSCUR DSNET 1)
                    ADD 1 TO DS-NO-REPO(DSCUR DSNET 1)
                    PERFORM DS1-PL-UPDATE-RV-AMOUNTS
                    ADD LP-INTDUE
                        LP-APINTOWE TO DS-AMT-REPO(DSCUR DSNET 4)
                                       DS-AMT-REPO(DSMTD DSVOL 4)
                                       DS-AMT-REPO(DSYTD DSVOL 4)
                    SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 4)
                                    DS-NO-REPO(DSMTD DSVOL 4)
                                    DS-NO-REPO(DSYTD DSVOL 4)
                    PERFORM DS1-PL-UPDATE-RV-AMOUNTS
                 ELSE
                    ADD LP-INTDUE LP-APINTOWE TO DS-PLOSAMT(1)
                    SUBTRACT 1 FROM DS-PLOSUNIT(1)
                    SUBTRACT LP-INTDUE LP-APINTOWE FROM DS-OUTSAMT(1)
                    ADD 1 TO DS-OUTSUNIT(1)
                    PERFORM DS1-PL-UPDATE-RV-AMOUNTS.
           IF PL-POSTING
              IF NOT RV-PL-POSTING
                 ADD LP-INTDUE LP-APINTOWE TO DS-PLOSAMT(1)
                 ADD 1 TO DS-PLOSUNIT(1)
                 PERFORM DS1-PL-UPDATE-AMOUNTS
                 IF ORIG-LN-REPO-SOLD
                    SUBTRACT LP-INTDUE
                             LP-APINTOWE FROM DS-AMT-REPO(DSCUR DSNET 3)
                    SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 3)
                    ADD LP-INTDUE
                        LP-APINTOWE TO DS-AMT-REPO(DSCUR DSNET 5)
                                       DS-AMT-REPO(DSMTD DSVOL 5)
                                       DS-AMT-REPO(DSYTD DSVOL 5)
                    ADD 1 TO DS-NO-REPO(DSCUR DSNET 5)
                             DS-NO-REPO(DSMTD DSVOL 5)
                             DS-NO-REPO(DSYTD DSVOL 5)
                 ELSE IF ORIG-LN-REPO-ONHAND
                    SUBTRACT LP-INTDUE
                             LP-APINTOWE FROM DS-AMT-REPO(DSCUR DSNET 1)
                    SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 1)
                    ADD LP-INTDUE
                        LP-APINTOWE TO DS-AMT-REPO(DSCUR DSNET 4)
                                       DS-AMT-REPO(DSMTD DSVOL 4)
                                       DS-AMT-REPO(DSYTD DSVOL 4)
                    ADD 1 TO DS-NO-REPO(DSCUR DSNET 4)
                             DS-NO-REPO(DSMTD DSVOL 4)
                             DS-NO-REPO(DSYTD DSVOL 4)
                 ELSE
                    SUBTRACT LP-INTDUE LP-APINTOWE FROM DS-OUTSAMT(1)
                    SUBTRACT 1 FROM DS-OUTSUNIT(1).

           IF RV-LP-TRCD = "PW"
              SUBTRACT LP-APCUR FROM DS-PLOSAMT(1)
              ADD 1 TO DS-PLOSUNIT(1).

           IF LP-TRCD = "PW"
              SUBTRACT LP-APCUR FROM DS-PLOSAMT(1)
              SUBTRACT 1 FROM DS-PLOSUNIT(1).

           IF HOLD-LP-TRCD NOT = "PW"
              IF LN-PLCD = " "
                 IF ORIG-LN-IS-REPO-AR
                    SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                         FROM DS-AMT-REPO(DSCUR DSNET REPO-AR-SUB)
                    ADD ONE TO DS-NO-REPO(DSCUR DSNET REPO-AR-SUB)
                 ELSE
                    SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                           FROM DS-OUTSAMT(1)
                    ADD ONE TO DS-OUTSUNIT(1).

      * UPDATE P&L RECOVERIES:
           IF LN-PLCD = "P"
              ADD ONE TO DS-RCPLUNIT(1)
      *       IF NOT (RV-LP-TRCD = "WL" OR "WI")
              IF NOT (HOLD-LP-TRCD = "WL" OR "WI")
                 ADD LP-APINT LP-APLC TO DS-RCPLAMT(1)
      * JTG STOPPED O2 FROM UPDATING PL RECOVERIES LIKE TY UPDATE:
      *          IF NOT (RV-LP-TRCD = "AP" OR "O2")
                 IF NOT (HOLD-LP-TRCD = "AP" OR "O2" OR "OP" OR "RE")

              IF NOT (HOLD-LP-TRCD = "AP" OR "O2" OR "OP" OR "RE"
                                  OR "RA" OR "RC" OR "RD"
                                  OR "RI" OR "RM" OR "RP"
                                  OR "RS" OR "R1" OR "R2" OR "R3"
                                  OR "CA" OR "CC" OR "CD"
                                  OR "CI" OR "CM" OR "CP" OR "CS"
                                  OR "C1" OR "C2" OR "C3" OR "AP"
                                  OR "O2" OR "W2" OR "PX")
                 ADD LP-APCUR TO DS-RCPLAMT(1).

      *?LP-APOTH? JTG  ADD LP-APCUR LP-APOTH TOTAL-REB-AMOUNTS
      *             ADD LP-APCUR TOTAL-REB-AMOUNTS
      *                                   TO DS-RCPLAMT(1).

      ********************************************************
      *    UPDATE PL OUTSTANDINGS
      *
           IF HOLD-LP-TRCD NOT = "PW"
              IF LN-PLCD NOT = " "
                 SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                        FROM DS-PLOSAMT(1)
                 ADD ONE TO DS-PLOSUNIT(1)
      * - ONHAND OR SOLD REPO IN P&L RECEIVABLES:
                 IF LN-REPOCD = "X"
                    SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                         FROM DS-AMT-REPO(DSCUR DSNET 4)
                    ADD ONE TO DS-NO-REPO(DSCUR DSNET 4)
                 ELSE IF LN-REPOCD = "S"
                    SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                         FROM DS-AMT-REPO(DSCUR DSNET 5)
                    ADD ONE TO DS-NO-REPO(DSCUR DSNET 5).

      ********************************************************
      *    UPDATE JD OUTSTANDINGS
      *
           IF LN-JDDATE NOT = 0
              SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                        FROM DS-JDOSAMT(1)
              ADD ONE TO DS-JDOSUNIT(1).

      ********************************************************
      *    UPDATE 'SC' SALES FINANCE UNITS:
      *
           IF HOLD-LP-TRCD = "SC"
              SUBTRACT ONE FROM DS-TODLUNIT(1) DS-TODLUNIT(2)
              ADD LP-TRAMT TO DS-TODLAMT(1) DS-TODLAMT(2).

      ********************************************************
      *    UPDATE RECOURSE BALANCES:
      *
           IF LN-SERVACCT NOT = "Y"
              IF LN-PLCD = " "
                 IF DLRC NOT = 0
                    ADD LP-APCUR TOTAL-REB-AMOUNTS
                                         GIVING PART-RC-AMT
                    ADD ONE TO DS-RCOURSE-UNITS(DLRC)
                    PERFORM DS1-COMPUTE-PART-RC-AMT
                    SUBTRACT PART-RC-AMT FROM DS-RCOURSE-AMT(DLRC).

      ********************************************************
      *    UPDATE PAID OFF LOANS:
      *
           COMPUTE DS-PAIDAMT(1) =
                         DS-PAIDAMT(1) - (LN-SUM-LNAMT * ONE).
           COMPUTE DS-PAIDAMT(2) =
                         DS-PAIDAMT(2) - (LN-SUM-LNAMT * ONE).
           SUBTRACT ONE FROM DS-PAIDUNIT(1)
                             DS-PAIDUNIT(2).

      ********************************************************
      *    UPDATE WEIGHTED AVERAGES:
      *
           IF (LN-PLCD = " ") 
              COMPUTE DS-SUMWGTTM = DS-SUMWGTTM + LN-ORGTERM * ONE
              COMPUTE DS-SUMWGTAV = DS-SUMWGTAV + LN-LNAMT * ONE
              COMPUTE DS-SUMWGTTA = DS-SUMWGTTA +
                                       LN-ORGTERM * LN-LNAMT * ONE.

      ********************************************************
      *    UPDATE DEALER RESERVES:   "PR"  "PC"  "PP"
      *                              "P4"  "P5"
      *
           IF DLRV-LP-DLNO = 0
              PERFORM DS1-UPDATE-RESERVE-BAL.

      ***************************************************************
      * FOR PC ACCOUNTS, NOT SERVICED
      *     ONLY 'CI' OR 'RI' MAY HAVE A VALUE.
      * FOR IB ACCOUNTS, NOT SERVICED
      *     ONLY 'PO' OR 'SC' MAY HAVE A VALUE.
      * FOR A PAYOFF WITH AN AUTO 'RI'
      *     THE HOLD FIELD MAY HAVE A VALUE.

           IF LN-SERVACCT NOT = "Y"
              IF LP-IBPC = "P"
                 IF HOLD-LP-TRCD = "CI" OR "RI"
                    SUBTRACT LP-DLRVCHGS-ADJ(1) FROM DS-DLRVCHGS(1)
                    SUBTRACT LP-DLRVCHGS-ADJ(2) FROM DS-DLRVCHGS(2)
                    SUBTRACT LP-DLRVCHGS-ADJ(3) FROM DS-DLRVCHGS(3)
                    SUBTRACT LP-DLPARVHELD-ADJ FROM DS-DLPARVHELD
      * JTG             IT IS CORRECT TO REDUCE HELD AND NOT PAID
                    SUBTRACT LP-DLPARVPAID-ADJ FROM DS-DLPARVHELD
                                                    DS-DLPARVPAID
                 ELSE
      *          AUTO REBATE
                 IF HOLD-LP-TRCD = "PO" OR "SC"
                    SUBTRACT HOLD-DLRVCHGS-ADJ(1) FROM DS-DLRVCHGS(1)
                    SUBTRACT HOLD-DLRVCHGS-ADJ(2) FROM DS-DLRVCHGS(2)
                    SUBTRACT HOLD-DLRVCHGS-ADJ(3) FROM DS-DLRVCHGS(3)
                    SUBTRACT HOLD-DLPARVHELD-ADJ FROM DS-DLPARVHELD
      * JTG             IT IS CORRECT TO REDUCE HELD AND NOT PAID
                    SUBTRACT HOLD-DLPARVPAID-ADJ FROM DS-DLPARVHELD
                                                      DS-DLPARVPAID.

           IF LN-SERVACCT NOT = "Y"
              IF LP-IBPC = "I"
                 IF HOLD-LP-TRCD = "PO" OR "SC"
                    SUBTRACT LP-DLRVCHGS-ADJ(1) FROM DS-DLRVCHGS(1)
                    SUBTRACT LP-DLRVCHGS-ADJ(2) FROM DS-DLRVCHGS(2)
                    SUBTRACT LP-DLRVCHGS-ADJ(3) FROM DS-DLRVCHGS(3)
                    SUBTRACT LP-DLPARVHELD-ADJ FROM DS-DLPARVHELD
      * JTG             IT IS CORRECT TO REDUCE HELD AND NOT PAID
                    SUBTRACT LP-DLPARVPAID-ADJ FROM DS-DLPARVHELD
                                                    DS-DLPARVPAID.

           IF LN-SERVACCT = "Y"
              IF LN-INSOURS(1) = "Y"
                 ADD REB-AMOUNT(1) TO DS-UNPAIDCK
                 IF HOLD-LP-TRCD = "CC" OR "RC"
                    ADD LP-TRAMT TO DS-UNPAIDCK
                 END-IF
              END-IF
              IF LN-INSOURS(2) = "Y"
                 ADD REB-AMOUNT(2) TO DS-UNPAIDCK
                 IF HOLD-LP-TRCD = "CA" OR "RA"
                    ADD LP-TRAMT TO DS-UNPAIDCK
                 END-IF
              END-IF
              IF LN-INSOURS(3) = "Y"
                 ADD REB-AMOUNT(3) TO DS-UNPAIDCK
                 IF HOLD-LP-TRCD = "CP" OR "RP"
                    ADD LP-TRAMT TO DS-UNPAIDCK
                 END-IF
              END-IF
              IF LN-INSOURS(4) = "Y"
                 ADD REB-AMOUNT(9) TO DS-UNPAIDCK
                 IF HOLD-LP-TRCD = "C1" OR "R1"
                    ADD LP-TRAMT TO DS-UNPAIDCK
                 END-IF
              END-IF
              IF LN-INSOURS(5) = "Y"
                 ADD REB-AMOUNT(10) TO DS-UNPAIDCK
                 IF HOLD-LP-TRCD = "C2" OR "R2"
                    ADD LP-TRAMT TO DS-UNPAIDCK
                 END-IF
              END-IF
              IF LN-INSOURS(6) = "Y"
                 ADD REB-AMOUNT(11) TO DS-UNPAIDCK
                 IF HOLD-LP-TRCD = "C3" OR "R3"
                    ADD LP-TRAMT TO DS-UNPAIDCK
                 END-IF
              END-IF.

           ADD LP-DLPROC TO DS-UNPAIDCK

      *  UPDATE PROCEEDS:
           IF GP-UNEARNED-STATS = "Y"
              ADD LP-DLPROC TO DS-PROCEEDS(1)
                               DS-PROCEEDS(2).

           PERFORM REWRITE-DS1-FILE.
           PERFORM CLOSE-DS1-FILE.

       EXIT-UPDATE-DS1-FILE.
           EXIT.

      ********************************************************
       UPD-DS1-OTHER-DLRVBAL SECTION.
      ********************************************************

      * RESERVES:   "PR"  "PC"  "PP"

           MOVE "UPDATING OTHER DEALER RESERVES......" TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM OPEN-DS1-FILE.
           MOVE "N" TO REC-EXISTS.
       UPD-DS1-OTHER-CHECK-EXISTS.
           MOVE TRANS-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.
           MOVE DATE-YYYYMM TO DS-DATE-CCYYMM.
           MOVE LN-OWNBR TO DS-BRANCH.
           MOVE DLRV-LP-DLNO TO DS-DLNO.
           MOVE LN-CLASS TO DS-CLASS.
           MOVE DS1-KEY TO HOLD-DS1-KEY.
           PERFORM READ-DS1-FILE.
           IF IO-FG NOT = 0
              IF REC-EXISTS = "Y"
                 GO TO IO-ERROR
              ELSE
                 PERFORM DS1-CREATE-REC
                 GO TO UPD-DS1-OTHER-CHECK-EXISTS.

           PERFORM DS1-UPDATE-RESERVE-BAL.

           PERFORM REWRITE-DS1-FILE.
           PERFORM CLOSE-DS1-FILE.

       UPD-DS1-OTHER-DLRVBAL-EXIT.
           EXIT.

      ********************************************************
       DS1-UPDATE-RESERVE-BAL SECTION.
      ********************************************************

      * RESERVES:   "PR"  "PC"  "PP"  "P4"  "P5"

      * PAYMENT OUT OF RESERVE FROM PRINCIPAL:
           IF HOLD-LP-TRCD = "PR"
              SUBTRACT LP-TRAMT FROM DS-DLRVPRIN(DLRV-LP-DLRVNO)
           ELSE
      * PAYMENT OUT OF RESERVE FROM CHARGES:
           IF HOLD-LP-TRCD = "PC"
              SUBTRACT LP-TRAMT FROM DS-DLRVCHGS(DLRV-LP-DLRVNO)
           ELSE
      * PAYMENT OUT OF RESERVE FROM PARTICIPATION:
           IF HOLD-LP-TRCD = "PP"
              SUBTRACT LP-TRAMT FROM DS-DLPARVHELD.

           IF NOT (HOLD-LP-TRCD = "P4" OR "P5")
              GO TO DS1-UPDATE-RESERVE-BAL-EXIT.

      * P4 AND P5 TRANSACTIONS:
      * PAYMENT OUT OF RESERVE TO COVER P&L EXPENSE:
           PERFORM GET-P4P5-RESERVE-AMT.
           IF DLRV-LP-P4P5-TRCD = "PR"
              SUBTRACT P4P5-RSVAMT
                              FROM DS-DLRVPRIN(DLRV-LP-P4P5-DLRVNO)
           ELSE
      * PAYMENT OUT OF RESERVE FROM CHARGES:
           IF DLRV-LP-P4P5-TRCD = "PC"
              SUBTRACT P4P5-RSVAMT
                              FROM DS-DLRVCHGS(DLRV-LP-P4P5-DLRVNO)
           ELSE
      * PAYMENT OUT OF RESERVE FROM PARTICIPATION:
           IF DLRV-LP-P4P5-TRCD = "PP"
              SUBTRACT P4P5-RSVAMT FROM DS-DLPARVHELD.

       DS1-UPDATE-RESERVE-BAL-EXIT.
           EXIT.

      ********************************************************
       DS1-PL-UPDATE-RV-AMOUNTS SECTION.
      ********************************************************
           IF LN-SERVACCT NOT = "Y"
              IF DLRC NOT = 0
                 MOVE LP-CURBAL TO PART-RC-AMT
                 IF DLRC = 2
                    IF LP-CURBAL NOT < LN-DLPARTRCAMT
                       MOVE LN-DLPARTRCAMT TO PART-RC-AMT
                    ELSE
                       MOVE LP-CURBAL TO PART-RC-AMT
                    END-IF
                 END-IF
                 ADD PART-RC-AMT TO DS-RCOURSE-AMT(DLRC)
                 ADD 1 TO DS-RCOURSE-UNITS(DLRC).

           COMPUTE DS-SUMWGTTM = DS-SUMWGTTM + LN-ORGTERM * 1.
           COMPUTE DS-SUMWGTAV = DS-SUMWGTAV + LN-LNAMT * 1.
           COMPUTE DS-SUMWGTTA = DS-SUMWGTTA +
                                 LN-ORGTERM * LN-LNAMT * 1.

      ********************************************************
       DS1-PL-UPDATE-AMOUNTS SECTION.
      ********************************************************
           IF LN-SERVACCT NOT = "Y"
              IF DLRC NOT = 0
                 MOVE LP-CURBAL TO PART-RC-AMT
                 IF DLRC = 2
                    IF LP-CURBAL NOT < LN-DLPARTRCAMT
                       MOVE LN-DLPARTRCAMT TO PART-RC-AMT
                    ELSE
                       MOVE LP-CURBAL TO PART-RC-AMT
                    END-IF
                 END-IF
                 SUBTRACT PART-RC-AMT FROM DS-RCOURSE-AMT(DLRC)
                 SUBTRACT 1 FROM DS-RCOURSE-UNITS(DLRC).

           COMPUTE DS-SUMWGTTM = DS-SUMWGTTM + LN-ORGTERM * -1.
           COMPUTE DS-SUMWGTAV = DS-SUMWGTAV + LN-LNAMT * -1.
           COMPUTE DS-SUMWGTTA = DS-SUMWGTTA +
                                 LN-ORGTERM * LN-LNAMT * -1.

      **********************************************************
       DS1-COMPUTE-PART-RC-AMT SECTION.
      **********************************************************
           IF DLRC = 2
              IF PART-RC-AMT > 0
                 IF LP-CURBAL NOT < LN-DLPARTRCAMT
                    MOVE 0 TO PART-RC-AMT
                 ELSE
                    COMPUTE TEST-AMT = LP-CURBAL + PART-RC-AMT
                    IF TEST-AMT > LN-DLPARTRCAMT
                       SUBTRACT LP-CURBAL FROM LN-DLPARTRCAMT
                                                  GIVING PART-RC-AMT
                    END-IF
                 END-IF
              ELSE
              IF PART-RC-AMT < 0
                 IF LP-CURBAL > LN-DLPARTRCAMT
                    COMPUTE TEST-AMT = LP-CURBAL + PART-RC-AMT
                    IF TEST-AMT NOT < LN-DLPARTRCAMT
                       MOVE 0 TO PART-RC-AMT
                    ELSE
                       COMPUTE PART-RC-AMT = TEST-AMT - LN-DLPARTRCAMT.

       DS1-COMPUTE-PART-RC-AMT-EXIT.
           EXIT.

      **********************************************************
       DS1-SS-COMPUTE-PART-RC-AMT SECTION.
      **********************************************************

      * COMPUTE FOR 'SS' DEALER PARTIAL RECOURSE AMOUNT

           IF DLRC = 2
              IF PART-RC-AMT > 0
                 IF HOLD-LP-CURBAL NOT < LN-DLPARTRCAMT
                    MOVE 0 TO PART-RC-AMT
                 ELSE
                    COMPUTE TEST-AMT = HOLD-LP-CURBAL + PART-RC-AMT
                    IF TEST-AMT > LN-DLPARTRCAMT
                       SUBTRACT HOLD-LP-CURBAL FROM LN-DLPARTRCAMT
                                                  GIVING PART-RC-AMT
                    END-IF
                 END-IF
              ELSE
              IF PART-RC-AMT < 0
                 IF HOLD-LP-CURBAL > LN-DLPARTRCAMT
                    COMPUTE TEST-AMT = HOLD-LP-CURBAL + PART-RC-AMT
                    IF TEST-AMT NOT < LN-DLPARTRCAMT
                       MOVE 0 TO PART-RC-AMT
                    ELSE
                       COMPUTE PART-RC-AMT = TEST-AMT - LN-DLPARTRCAMT.

       DS1-SS-COMPUTE-PART-RC-AMT-END.
           EXIT.

      **********************************************************
       DS1-CREATE-REC SECTION.
      **********************************************************
           MOVE "Y" TO REC-EXISTS.
           PERFORM CLEAR-DS-FILE.

           MOVE HOLD-DS1-KEY TO DS1-KEY.

           PERFORM WRITE-DS1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.


      ***********************************************************
       UPDATE-DS1-SXSVSS SECTION.
      ***********************************************************

      * UPDATE DS1-FILE FOR 'SX' AND 'ZX' AND 'SV' AND 'SS'

           MOVE "UPDATING DEALER STATS FILE...(REPO/PL)..." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM OPEN-DS1-FILE.
           MOVE "N" TO REC-EXISTS.
       UPD-DS1-SXSVSS-EXISTS.
           MOVE TRANS-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.
           MOVE DATE-YYYYMM TO DS-DATE-CCYYMM.
           MOVE LN-OWNBR TO DS-BRANCH.
           MOVE LN-DLNO TO DS-DLNO.
           MOVE LN-CLASS TO DS-CLASS.
           MOVE DS1-KEY TO HOLD-DS1-KEY.
           PERFORM READ-DS1-FILE.
           IF IO-FG NOT = 0
              IF REC-EXISTS = "Y"
                 GO TO IO-ERROR
              ELSE
                 PERFORM DS1-CREATE-REC
                 GO TO UPD-DS1-SXSVSS-EXISTS.

           IF ORIG-LN-PLCD NOT = " "
              GO TO DS1-UPDATE-REPO-ON-PL.

      *--------------------------------------------------------------
      *    (SX) (ZX) SET ACCOUNT INTO REPO ONHAND STATUS
      *              IT IS ASSUMED THAT RE: MERCURY
      *                 AN ACCOUNT MUST BE IN THE FOLLOW STATUS
      *                 TO ALLOW POSTING OF 'SX' OR 'ZX';
      *                    1. NOT IN P&L STATUS (NOTE: GET-SRCD-SUB)
      *                    2. IN IB STATUS
      *--------------------------------------------------------------
           IF HOLD-LP-TRCD = "SX" OR "ZX"
      *       --------------------------------------------------
      *        (SX) (ZX) REVERSAL
      *                  1. REMOVE FROM DS-REPO TABLE
      *                  2. PUT BACK INTO DS-ACTIVITY TABLE
      *                  3. PUT BACK INTO DS-DELINQUENCY TABLE
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SX" OR "ZX"
                 PERFORM GET-CON-REC-AFTER-LNUPD
                 PERFORM POST-DS1-AFTER-UPDATE
                 ADD HOLD-LP-CURBAL TO DS-OUTSAMT(1)
                 ADD 1 TO DS-OUTSUNIT(1)
                 SUBTRACT HOLD-LP-CURBAL
                                FROM DS-AMT-REPO(DSCUR DSNET 1)
                                     DS-AMT-REPO(DSMTD DSVOL 1)
                                     DS-AMT-REPO(DSYTD DSVOL 1)
                 SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 1)
                                 DS-NO-REPO(DSMTD DSVOL 1)
                                 DS-NO-REPO(DSYTD DSVOL 1)
              ELSE
      *       --------------------------------------------------
      *        (SX) (ZX) SET REPO ON HAND
      *                  1. ADD TO DS-REPO TABLE
      *                  2. TAKE OUT OF DS-ACTIVITY TABLE
      *                  3. TAKE OUT OF DS-DELINQUENCY TABLE
      *       --------------------------------------------------
                 PERFORM UPDATE-DS1-PRIOR
                 SUBTRACT HOLD-LP-CURBAL FROM DS-OUTSAMT(1)
                 SUBTRACT 1 FROM DS-OUTSUNIT(1)
                 ADD HOLD-LP-CURBAL TO DS-AMT-REPO(DSCUR DSNET 1)
                                        DS-AMT-REPO(DSMTD DSVOL 1)
                                        DS-AMT-REPO(DSYTD DSVOL 1)
                 ADD 1 TO DS-NO-REPO(DSCUR DSNET 1)
                          DS-NO-REPO(DSMTD DSVOL 1)
                          DS-NO-REPO(DSYTD DSVOL 1).

      *---------------------------------------------------------
      *    (SV) SET ACCOUNT INTO REDEEMED REPO STATUS
      *         IT IS ASSUMED THAT RE: MERCURY
      *            AN ACCOUNT MUST BE IN THE FOLLOW STATUS
      *            TO ALLOW POSTING OF 'SV';
      *               1. ACCOUNT IS IN 'SX' OR 'ZX' STATUS
      *               2. NOT IN P&L STATUS (NOTE: GET-SRCD-SUB)
      *---------------------------------------------------------
           IF HOLD-LP-TRCD = "SV"
      *       --------------------------------------------------
      *       (SV) REVERSAL
      *             1. PUT BACK INTO DS-REPO ONHAND
      *             2. REMOVE FROM  DS-REPO REDEEMED
      *             3. REMOVE FROM DS-ACTIVITY TABLE
      *             4. REMOVE FROM  DS-DELINQUENCY TABLE
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SV"
                 ADD HOLD-LP-CURBAL TO DS-AMT-REPO(DSCUR DSNET 1)
                 ADD 1 TO DS-NO-REPO(DSCUR DSNET 1)
                 SUBTRACT HOLD-LP-CURBAL
                             FROM DS-AMT-REPO(DSCUR DSNET 2)
                                  DS-AMT-REPO(DSMTD DSVOL 2)
                                  DS-AMT-REPO(DSYTD DSVOL 2)
                 SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 2)
                                 DS-NO-REPO(DSMTD DSVOL 2)
                                 DS-NO-REPO(DSYTD DSVOL 2)
                 PERFORM UPDATE-DS1-PRIOR
                 SUBTRACT HOLD-LP-CURBAL FROM DS-OUTSAMT(1)
                 SUBTRACT 1 FROM DS-OUTSUNIT(1)
              ELSE
      *       --------------------------------------------------
      *        SET (SV)
      *             1. REMOVE FROM DS-REPO ONHAND
      *             2. PUT BACK INTO DS-ACTIVITY TABLE
      *             3. PUT BACK INTO DS-DELINQUENCY TABLE
      *             4. PUT INTO DS-REPO REDEEMED
      *       --------------------------------------------------
                 SUBTRACT HOLD-LP-CURBAL
                                    FROM DS-AMT-REPO(DSCUR DSNET 1)
                 SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 1)
                 ADD HOLD-LP-CURBAL TO DS-AMT-REPO(DSCUR DSNET 2)
                                        DS-AMT-REPO(DSMTD DSVOL 2)
                                        DS-AMT-REPO(DSYTD DSVOL 2)
                 ADD 1 TO DS-NO-REPO(DSCUR DSNET 2)
                          DS-NO-REPO(DSMTD DSVOL 2)
                          DS-NO-REPO(DSYTD DSVOL 2)
                 PERFORM GET-CON-REC-AFTER-LNUPD
                 PERFORM POST-DS1-AFTER-UPDATE
                 ADD HOLD-LP-CURBAL TO DS-OUTSAMT(1)
                 ADD 1 TO DS-OUTSUNIT(1).

      *---------------------------------------------------------
      *    (SS) SET ACCOUNT INTO SOLD REPO STATUS
      *         IT IS ASSUMED THAT RE: MERCURY
      *            AN ACCOUNT MUST BE IN THE FOLLOW STATUS
      *            TO ALLOW POSTING OF 'SS';
      *               1. ACCOUNT IS IN 'SX' OR 'ZX' STATUS
      *               2. NOT IN P&L STATUS (NOTE: GET-SRCD-SUB)
      *---------------------------------------------------------

           IF HOLD-LP-TRCD = "SS"

      *      SET RECOURSE INDEX, DLRC:
              IF LN-DLRECOURSE = "F"
                 MOVE 1 TO DLRC
              ELSE
                 IF LN-DLRECOURSE = "P"
                    MOVE 2 TO DLRC
                 ELSE
                    IF LN-DLRECOURSE = "N"
                       MOVE 3 TO DLRC
                    ELSE
                       MOVE 0 TO DLRC
                    END-IF
                 END-IF
              END-IF

      *       --------------------------------------------------
      *        (SS) REVERSAL
      *             1. PUT BACK INTO DS-REPO ONHAND
      *             2. PUT BACK AMOUNT SOLD INTO DS-RCOURSE-AMT
      *             3. REMOVE FROM DS-REPO SOLD
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SS"
                 COMPUTE DS-AMT-REPO(DSCUR DSNET 1) =
                     DS-AMT-REPO(DSCUR DSNET 1) + HOLD-LP-CURBAL
                 ADD 1 TO DS-NO-REPO(DSCUR DSNET 1)

      *  PUT BACK AMOUNT SOLD INTO RECOURSE BALANCE:
                 IF LN-SERVACCT NOT = "Y"
                    IF DLRC NOT = 0
                       MOVE HOLD-LP-APCUR TO PART-RC-AMT
                       PERFORM DS1-SS-COMPUTE-PART-RC-AMT
                       SUBTRACT PART-RC-AMT FROM DS-RCOURSE-AMT(DLRC)
                    END-IF
                 END-IF

                 SUBTRACT HOLD-LP-APCUR HOLD-LP-CURBAL
                                   FROM DS-AMT-REPO(DSCUR DSNET 3)
                                        DS-AMT-REPO(DSMTD DSVOL 3)
                                        DS-AMT-REPO(DSYTD DSVOL 3)
                 SUBTRACT 1 FROM DS-NO-REPO(DSMTD DSVOL 3)
                                 DS-NO-REPO(DSYTD DSVOL 3)
                 IF HOLD-LP-CURBAL NOT = 0
                    SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 3)
                 END-IF
              ELSE
      *       --------------------------------------------------
      *        SET (SS)
      *             1. REMOVE FROM DS-REPO ONHAND
      *             2. REMOVE AMOUNT SOLD FROM DS-RCOURSE-AMT
      *             3. PUT INTO DS-REPO SOLD
      *       --------------------------------------------------
                 COMPUTE DS-AMT-REPO(DSCUR DSNET 1) =
                       DS-AMT-REPO(DSCUR DSNET 1)
                           - HOLD-LP-APCUR - HOLD-LP-CURBAL
                 SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 1)

      *  REDUCE RECOURSE BALANCE BY AMOUNT SOLD:
                 IF LN-SERVACCT NOT = "Y"
                    IF DLRC NOT = 0
                       MOVE HOLD-LP-APCUR TO PART-RC-AMT
                       PERFORM DS1-SS-COMPUTE-PART-RC-AMT
                       SUBTRACT PART-RC-AMT FROM DS-RCOURSE-AMT(DLRC)
                    END-IF
                 END-IF

                 ADD HOLD-LP-CURBAL TO DS-AMT-REPO(DSCUR DSNET 3)
                                       DS-AMT-REPO(DSMTD DSVOL 3)
                                       DS-AMT-REPO(DSYTD DSVOL 3)
                 ADD 1 TO DS-NO-REPO(DSMTD DSVOL 3)
                          DS-NO-REPO(DSYTD DSVOL 3)
                 IF HOLD-LP-CURBAL NOT = 0
                    ADD 1 TO DS-NO-REPO(DSCUR DSNET 3).

              GO TO UPDATE-DS1-SXSVSS-EXIT.

      **********************************************************
      *    UPDATE REPO TRANSACTION ON ACCT IN PL STATUS
      **********************************************************
       DS1-UPDATE-REPO-ON-PL.
      *---------------------------------------------------------
      *    (SX) (ZX) SET PL ACCOUNT INTO REPO ONHAND STATUS
      *    SINCE ACCT IS ALREADY IN PL RECEIVABLES & OUTSTANDING,
      *    WE WILL ONLY AFFECT ADD'L REPO BUCKETS:
      *    REPO BUCKET 4: REPOS ON HAND IN PL STATUS
      *    REPO BUCKET 5: REPOS SOLD IN PL STATUS
      *---------------------------------------------------------
           IF HOLD-LP-TRCD = "SX" OR "ZX"
      *       --------------------------------------------------
      *        (SX) (ZX) REVERSAL
      *                  1. SUBTRACT FROM VOLUME & OUTSTANDING DS-REPO
      *                     TABLE ELEMENT 4 (REPO ON-HAND IN PL STATUS)
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SX" OR "ZX"
                 SUBTRACT HOLD-LP-CURBAL
                                FROM DS-AMT-REPO(DSCUR DSNET 4)
                                     DS-AMT-REPO(DSMTD DSVOL 4)
                                     DS-AMT-REPO(DSYTD DSVOL 4)
                 SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 4)
                                 DS-NO-REPO(DSMTD DSVOL 4)
                                 DS-NO-REPO(DSYTD DSVOL 4)
              ELSE
      *       ---------------------------------------------------------
      *        (SX) (ZX) SET REPO ON HAND (ACCOUNT IN PL STATUS)
      *                  1. ADD TO VOLUME & OUTSTANDING DS-REPO TABLE
      *                     ELEMENT 4 (REPO ON-HAND IN PL STATUS)
      *       ---------------------------------------------------------
                 ADD HOLD-LP-CURBAL TO DS-AMT-REPO(DSCUR DSNET 4)
                                        DS-AMT-REPO(DSMTD DSVOL 4)
                                        DS-AMT-REPO(DSYTD DSVOL 4)
                 ADD 1 TO DS-NO-REPO(DSCUR DSNET 4)
                          DS-NO-REPO(DSMTD DSVOL 4)
                          DS-NO-REPO(DSYTD DSVOL 4).

      *---------------------------------------------------------
      *    (SV) SET PL ACCOUNT INTO REDEEMED REPO STATUS
      *               1. ACCOUNT IS IN 'SX' OR 'ZX' STATUS
      *               2. ACCOUNT IS IN P&L STATUS
      *---------------------------------------------------------
           IF HOLD-LP-TRCD = "SV"
      *       --------------------------------------------------
      *       (SV) REVERSAL ON PL ACCOUNT
      *             1. ADD TO VOLUME & OUTSTANDING DS-REPO TABLE
      *                ELEMENT 4 (REPO ON-HAND IN PL STATUS)
      *             2. REMOVE FROM   DS-REPO REDEEMED
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SV"
                 ADD HOLD-LP-CURBAL TO DS-AMT-REPO(DSCUR DSNET 4)
                 ADD 1 TO DS-NO-REPO(DSCUR DSNET 4)
                 SUBTRACT HOLD-LP-CURBAL
                             FROM DS-AMT-REPO(DSCUR DSNET 2)
                                  DS-AMT-REPO(DSMTD DSVOL 2)
                                  DS-AMT-REPO(DSYTD DSVOL 2)
                 SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 2)
                                 DS-NO-REPO(DSMTD DSVOL 2)
                                 DS-NO-REPO(DSYTD DSVOL 2)
              ELSE
      *       --------------------------------------------------
      *        SET (SV)
      *             1. SUBTRACT FROM VOLUME & OUTSTANDING DS-REPO
      *                TABLE ELEMENT 4 (REPO ON-HAND IN PL STATUS)
      *             2. PUT INTO DS-REPO REDEEMED
      *       --------------------------------------------------
                 SUBTRACT HOLD-LP-CURBAL
                                    FROM DS-AMT-REPO(DSCUR DSNET 4)
                 SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 4)
                 ADD HOLD-LP-CURBAL TO DS-AMT-REPO(DSCUR DSNET 2)
                                        DS-AMT-REPO(DSMTD DSVOL 2)
                                        DS-AMT-REPO(DSYTD DSVOL 2)
                 ADD 1 TO DS-NO-REPO(DSCUR DSNET 2)
                          DS-NO-REPO(DSMTD DSVOL 2)
                          DS-NO-REPO(DSYTD DSVOL 2).

      *---------------------------------------------------------
      *    (SS) SET PL ACCOUNT INTO SOLD REPO STATUS
      *               1. ACCOUNT IS IN 'SX' OR 'ZX' STATUS
      *               2. ACCOUNT IS IN P&L STATUS
      *---------------------------------------------------------

           IF HOLD-LP-TRCD = "SS"

      *       --------------------------------------------------
      *        (SS) REVERSAL
      *             1. INCREASE DS PL OUTSTANDING
      *             2. PUT BACK INTO DS-REPO PL ONHAND
      *             3. PUT BACK AMOUNT SOLD INTO DS-RCOURSE-AMT
      *             4. REMOVE FROM DS-REPO PL SOLD
      *             5. SUBTRACT FROM DS PL RECOVERIES
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SS"
                 SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                        FROM DS-PLOSAMT(1)
                 ADD ONE TO DS-PLOSUNIT(1)
                 COMPUTE DS-AMT-REPO(DSCUR DSNET 4) =
                     DS-AMT-REPO(DSCUR DSNET 4) + HOLD-LP-CURBAL
                 ADD 1 TO DS-NO-REPO(DSCUR DSNET 4)

                 SUBTRACT HOLD-LP-APCUR HOLD-LP-CURBAL
                                   FROM DS-AMT-REPO(DSCUR DSNET 5)
                                        DS-AMT-REPO(DSMTD DSVOL 5)
                                        DS-AMT-REPO(DSYTD DSVOL 5)
                 SUBTRACT 1 FROM DS-NO-REPO(DSMTD DSVOL 5)
                                 DS-NO-REPO(DSYTD DSVOL 5)
                 IF HOLD-LP-CURBAL NOT = 0
                    ADD 1 TO DS-NO-REPO(DSCUR DSNET 5)
                 END-IF
                 ADD ONE TO DS-RCPLUNIT(1)
                 ADD LP-APINT LP-APLC TO DS-RCPLAMT(1)
                 ADD LP-APCUR TOTAL-REB-AMOUNTS
                                       TO DS-RCPLAMT(1)
              ELSE
      *       --------------------------------------------------
      *        SET (SS)
      *             1. REDUCE DS PL OUTSTANDING
      *             2. REMOVE FROM DS-REPO PL ONHAND
      *             3. REMOVE AMOUNT SOLD FROM DS-RCOURSE-AMT
      *             4. PUT INTO DS-REPO PL SOLD
      *             5. ADD TO DS PL RECOVERIES
      *       --------------------------------------------------
                 SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                        FROM DS-PLOSAMT(1)
                 ADD ONE TO DS-PLOSUNIT(1)
                 COMPUTE DS-AMT-REPO(DSCUR DSNET 4) =
                     DS-AMT-REPO(DSCUR DSNET 4)
                         - HOLD-LP-APCUR - HOLD-LP-CURBAL
                 SUBTRACT 1 FROM DS-NO-REPO(DSCUR DSNET 4)

                 ADD HOLD-LP-CURBAL TO DS-AMT-REPO(DSCUR DSNET 5)
                                        DS-AMT-REPO(DSMTD DSVOL 5)
                                        DS-AMT-REPO(DSYTD DSVOL 5)
                 ADD 1 TO DS-NO-REPO(DSMTD DSVOL 5)
                          DS-NO-REPO(DSYTD DSVOL 5)
                 IF HOLD-LP-CURBAL NOT = 0
                    ADD 1 TO DS-NO-REPO(DSCUR DSNET 5)
                 END-IF
                 ADD ONE TO DS-RCPLUNIT(1)
                 ADD LP-APINT LP-APLC TO DS-RCPLAMT(1)
                 ADD LP-APCUR TOTAL-REB-AMOUNTS
                                       TO DS-RCPLAMT(1).

       UPDATE-DS1-SXSVSS-EXIT.
           PERFORM REWRITE-DS1-FILE.
           PERFORM CLOSE-DS1-FILE.

      *******************************************
       UPDATE-PD1-FILE SECTION.
      *******************************************

           MOVE "UPDATING SCRATCH PAD FILE..............." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM CLEAR-PD-FILE.

           MOVE "R"       TO PD-ID.
           MOVE BRANCH    TO PD-BRANCH.
           MOVE LN-ACCTNO TO PD-SOC-SEC.

           IF PD1-EXISTS = "Y"
              MOVE "N" TO PD1-EXISTS
              PERFORM OPEN-PD1-FILE
              PERFORM READ-PD1-FILE
              IF IO-FG NOT = 0
                 MOVE
              "SCRATCH RENEWAL PD-REC MISSING; UPDATE WILL CONTINUE"
                                                            TO MESS
                 PERFORM CONDITIONAL-SEND-MESS
                 PERFORM CLOSE-PD1-FILE
                 GO TO EXIT-UPDATE-PD1-FILE
              ELSE
                 PERFORM DELETE-PD1-FILE
                 PERFORM CLOSE-PD1-FILE
                 GO TO EXIT-UPDATE-PD1-FILE.

           MOVE LN-REC             TO PD-RECORD.

           MOVE LN-ACCTNO          TO PD-PRLNNO.
           MOVE HOLD-TP-POSTING-BR TO PD-POSTING-BR.
           MOVE HOLD-TP-OTHBR-FG   TO PD-OTHBR-FG.

           MOVE HOLD-LP-TRCD       TO PD-PO-TRCD.

      *  JTG 040501 ADDED LOGIC TO CAUSE THE UNEARNED LOAN COST TO ROLL TO
      *             THE NEW LOAN AFTER 'RENEWAL'. NOTE: THIS COST IS REFLECTIVE
      *             OF THE DISCOUNT WHEN PURCHASING LOAN PAPER NOT CARRIED AS
      *             SALES PAPER WITH DEALER DISCOUNT.
      *             ADDED SP-LNCOST-FRMLA = 'R'                    REGENCY #2287
      *       NOTE: LN-PRDLDISC-UNEARN WILL HOLD THE COST (DISCOUNT)
      *             FOR LOANS, EVEN THOUGH IT IS NOT TIED TO A DEALER.
      
           IF SP-LNCOST-FRMLA = "R"
              COMPUTE PD-PRDLDISC-UNEARN =
                  LN-ANTICERN(6) - LN-ACCERN(6)
           ELSE
              IF GP-RENEW-DISC-UNERN = "Y"
                 COMPUTE PD-PRDLDISC-UNEARN =
                     LN-ANTICERN(5) - LN-ACCERN(5).

           ADD PD-CURBAL PD-OTHBAL GIVING PD-PRBAL.
           IF LN-MIP-FG = "Y"
              IF HOLD-LP-TRCD = "PY" OR "PA" OR "PE" OR "PR"
                             OR "PC" OR "PP" OR "SS" OR "IN"
                             OR "AH" OR "PX" OR "PN" OR "PZ"
                             OR "PO" OR "PB" OR "RN" OR "SC"
                             OR "RB" OR "RO"
              ADD HOLD-LXM-MIP-CLPAID TO PD-PRBAL
              ADD HOLD-LXM-MIP-AHPAID TO PD-PRBAL.

           ADD LP-APINT LP-APLC GIVING PD-PRINTDUE.
           ADD REB-AMOUNT(1) REB-AMOUNT(2) REB-AMOUNT(3)
               REB-AMOUNT(9) REB-AMOUNT(10) REB-AMOUNT(11)
               REB-AMOUNT(12) REB-AMOUNT(13)
                                    GIVING PD-PRINSRB.
           ADD REB-AMOUNT(4) REB-AMOUNT(5) REB-AMOUNT(6)
               REB-AMOUNT(7) REB-AMOUNT(8) GIVING PD-PRFINCHGRB.

           MOVE HOLD-POCD        TO PD-PRPOCD.
           MOVE LP-PAYDATE       TO PD-PRPODATE.
           MOVE LN-CONPROFILE(1) TO PD-PRCONPROFILE.
           MOVE HOLD-PRDELINQAMT TO PD-PRDELINQAMT.

      * FOR (GA) SCFRMLA = 'F':
           IF HOLD-PRDELINQAMT > 0
              MOVE HOLD-PRDELINQAMT TO PD-PRPAID-AHEAD
           ELSE
              MOVE 0                TO PD-PRPAID-AHEAD.

           MOVE 0                TO PD-RESTRICT-ADJ.

           MOVE HOLD-PRPDUE-DAYS TO PD-PRPDUE-DAYS.
           MOVE LN-LNAMT         TO PD-PRLNAMT.

           MOVE SPACES           TO PD-APPROVAL-USERID
                                    PD-CRED-SCORE-USERID.
           MOVE 0                TO PD-APPROVAL-LIMIT.
           MOVE 9999             TO PD-MIN-CRED-SCORE.

           PERFORM OPEN-PD1-FILE.
           PERFORM WRITE-PD1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.
           PERFORM CLOSE-PD1-FILE.

       EXIT-UPDATE-PD1-FILE.
           EXIT.

      **************************************************************
       UPDATE-TY1-FILE SECTION.
      **************************************************************

      *  NOTE: DOSN'T INCLUDE 'SX' OR 'ZX' OR 'SV' OR 'SS' TRCD'S

           MOVE "UPDATING TODAY'S TOTAL FILE............." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           MOVE LN-OWNBR TO BRNO-FOR-TY.
           PERFORM GET-TY1-FILE.

       TY-UPDATE-REC.
           IF NOT ORIG-LN-IS-REPO-AR
              IF (HOLD-LP-TRCD = "BK" OR "BD")
                 IF (HOLD-LP-TRCD = "BK" AND SAVE-LP-TRCD = "RV") OR
                    (SAVE-LP-TRCD = "BD")
                    PERFORM UPDATE-TY1-PRIOR-BNKRPT
                 END-IF
              ELSE
                 PERFORM UPDATE-TY1-PRIOR.

      *-----------------------------------------------------------
      *    WEIGHTED AVERAGE FIELDS REFLECT NO'S AND AMOUNTS OF
      *    NEW LOANS BOOKED, THEREFORE AT PAYOUT OR GOING TO P&L
      *    REDUCE THESE FIELDS
      *-----------------------------------------------------------
           IF (LN-PLCD = " ") 
              COMPUTE TY-SUMWGTTM = TY-SUMWGTTM + LN-ORGTERM * ONE
              COMPUTE TY-SUMWGTAV = TY-SUMWGTAV + LN-LNAMT * ONE
              COMPUTE TY-SUMWGTTA = TY-SUMWGTTA +
                                       LN-ORGTERM * LN-LNAMT * ONE.

      *---------------------------------------------------------
      *    (PL, ETC) REVERSE ACCOUNT FROM PL STATUS
      *---------------------------------------------------------
           IF PL-POSTING
              PERFORM GET-TRCD-PLSUB
              IF RV-PL-POSTING
      *       ------------------------------------------------
      *          - ADD BACK TO SUM WEIGHTED AVERAGE FIELDS
      *          - REMOVE ACCOUNT FROM TY-PL-ACTIVITY TABLE
      *          - ADD BACK TO EITHER TY-REPO-ACTIVITY TABLE
      *                        OR THE TY-ACTIVITY TABLE
      *       --------------------------------------------------
                 COMPUTE TY-SUMWGTTM = TY-SUMWGTTM + LN-ORGTERM * 1
                 COMPUTE TY-SUMWGTAV = TY-SUMWGTAV + LN-LNAMT * 1
                 COMPUTE TY-SUMWGTTA = TY-SUMWGTTA +
                                          LN-ORGTERM * LN-LNAMT * 1
                 ADD LP-APINTOWE LP-INTDUE TO TY-AMT-PL(1 TRCD-PLSUB)
      *         OT2BAL IS POSITIVE
                 SUBTRACT LP-OT2BAL FROM TY-O2-PL(1 TRCD-PLSUB)
                 SUBTRACT 1 FROM TY-NO-PL(1 TRCD-PLSUB)
                 ADD LP-APINTOWE LP-INTDUE TO TY-AMT-PL(2 TRCD-PLSUB)
                 SUBTRACT LP-OT2BAL FROM TY-O2-PL(2 TRCD-PLSUB)
                 SUBTRACT 1 FROM TY-NO-PL(2 TRCD-PLSUB)
                 IF ORIG-LN-REPO-SOLD
                    SUBTRACT LP-APINTOWE LP-INTDUE
                                             FROM TY-AMT-REPO(1 3)
                    ADD LP-OT2BAL TO TY-O2-REPO(1 3)
                    ADD 1 TO TY-NO-REPO(1 3)
      *       ----- ADDED LOGIC BELOW FOR PR# 77, 7/12/00   ------
                    ADD LP-APINTOWE
                        LP-INTDUE TO TY-AMT-REPO(1 5)
                                     TY-AMT-REPO(2 5)
                    SUBTRACT LP-OT2BAL FROM TY-O2-REPO(1 5)
                                            TY-O2-REPO(2 5)
                    SUBTRACT 1 FROM TY-NO-REPO(1 5)
                                    TY-NO-REPO(2 5)
                 ELSE IF ORIG-LN-REPO-ONHAND
                    SUBTRACT LP-APINTOWE LP-INTDUE
                                             FROM TY-AMT-REPO(1 1)
                    ADD LP-OT2BAL TO TY-O2-REPO(1 1)
                    ADD 1 TO TY-NO-REPO(1 1)
                    ADD LP-APINTOWE LP-INTDUE TO TY-AMT-REPO(1 4)
                                                 TY-AMT-REPO(2 4)
                    SUBTRACT LP-OT2BAL FROM TY-O2-REPO(1 4)
                                            TY-O2-REPO(2 4)
                    SUBTRACT 1 FROM TY-NO-REPO(1 4)
                                    TY-NO-REPO(2 4)
      *       ----- ADDED LOGIC ABOVE FOR PR# 77, 7/12/00   ------
                 ELSE
                    PERFORM GET-SRCD-SUB
                    PERFORM ERROR-SRCD-IS-PL
                    SUBTRACT LP-APINTOWE LP-INTDUE FROM TY-AMT(1 SRCD)
                    ADD LP-OT2BAL TO TY-O2(1 SRCD)
                    ADD 1 TO TY-NO(1 SRCD).

      *---------------------------------------------------------
      *    (PL, ETC) SET ACCOUNT INTO PL STATUS
      *---------------------------------------------------------
           IF PL-POSTING
              PERFORM GET-TRCD-PLSUB
              IF NOT RV-PL-POSTING
      *       ------------------------------------------------
      *          - REMOVE FROM SUM WEIGHTED AVERAGE FIELDS
      *          - PUT ACCOUNT INTO TY-PL-ACTIVITY TABLE
      *          - REMOVE FROM EITHER TY-REPO-ACTIVITY TABLE
      *                       OR FROM TY-ACTIVITY TABLE
      *       --------------------------------------------------
                 COMPUTE TY-SUMWGTTM = TY-SUMWGTTM + LN-ORGTERM * -1
                 COMPUTE TY-SUMWGTAV = TY-SUMWGTAV + LN-LNAMT * -1
                 COMPUTE TY-SUMWGTTA = TY-SUMWGTTA +
                                          LN-ORGTERM * LN-LNAMT * -1
                 ADD LP-APINTOWE LP-INTDUE TO TY-AMT-PL(1 TRCD-PLSUB)
                 ADD LP-OT2BAL TO TY-O2-PL(1 TRCD-PLSUB)
                 ADD 1 TO TY-NO-PL(1 TRCD-PLSUB)
                 ADD LP-APINTOWE LP-INTDUE TO TY-AMT-PL(2 TRCD-PLSUB)
                 ADD LP-OT2BAL TO TY-O2-PL(2 TRCD-PLSUB)
                 ADD 1 TO TY-NO-PL(2 TRCD-PLSUB)
                 IF ORIG-LN-REPO-SOLD
                    SUBTRACT LP-APINTOWE LP-INTDUE
                                              FROM TY-AMT-REPO(1 3)
                    SUBTRACT LP-OT2BAL FROM TY-O2-REPO(1 3)
                    SUBTRACT 1 FROM TY-NO-REPO(1 3)
      *       ----- ADDED LOGIC BELOW FOR PR# 77, 7/12/00   ------
                    ADD LP-APINTOWE LP-INTDUE TO TY-AMT-REPO(1 5)
                                                 TY-AMT-REPO(2 5)
                    ADD LP-OT2BAL TO TY-O2-REPO(1 5)
                                     TY-O2-REPO(2 5)
                    ADD 1 TO TY-NO-REPO(1 5)
                             TY-NO-REPO(2 5)
                 ELSE IF ORIG-LN-REPO-ONHAND
                    SUBTRACT LP-APINTOWE LP-INTDUE
                                              FROM TY-AMT-REPO(1 1)
                    SUBTRACT LP-OT2BAL FROM TY-O2-REPO(1 1)
                    SUBTRACT 1 FROM TY-NO-REPO(1 1)
                    ADD LP-APINTOWE LP-INTDUE TO TY-AMT-REPO(1 4)
                                                 TY-AMT-REPO(2 4)
                    ADD LP-OT2BAL TO TY-O2-REPO(1 4)
                                  TY-O2-REPO(2 4)
                    ADD 1 TO TY-NO-REPO(1 4)
                             TY-NO-REPO(2 4)
      *       ----- ADDED LOGIC ABOVE FOR PR# 77, 7/12/00   ------
                 ELSE
                    PERFORM GET-SRCD-SUB
                    PERFORM ERROR-SRCD-IS-PL
                    SUBTRACT LP-APINTOWE LP-INTDUE FROM TY-AMT(1 SRCD)
                    SUBTRACT LP-OT2BAL FROM TY-O2(1 SRCD)
                    SUBTRACT 1 FROM TY-NO(1 SRCD).

      *---------------------------------------------------------
      *    (PI) REVERSE ACCOUNT FROM INACTIVE PL STATUS
      *         - REMOVE ACCOUNT FROM ACTIVE TY-PL-ACTIVITY TABLE
      *         - PUT ACCOUNT INTO INACTIVE TY-PL-ACTIVITY TABLE
      *---------------------------------------------------------
           IF RV-LP-TRCD = "PI"
              PERFORM GET-SRCD-SUB
      *        SRCD = INACTIVE P&L
              ADD LP-APINTOWE LP-INTDUE TO TY-AMT-PL(1 SRCD)
              SUBTRACT LP-OT2BAL FROM TY-O2-PL(1 SRCD)
              SUBTRACT 1 FROM TY-NO-PL(1 SRCD)
              ADD LP-APINTOWE LP-INTDUE TO TY-AMT-PL(2 SRCD)
              SUBTRACT LP-OT2BAL FROM TY-O2-PL(2 SRCD)
              SUBTRACT 1 FROM TY-NO-PL(2 SRCD)
              SUBTRACT 1 FROM SRCD
      *        SRCD = ACTIVE P&L
              SUBTRACT LP-APINTOWE LP-INTDUE FROM TY-AMT-PL(1 SRCD)
              ADD LP-OT2BAL TO TY-O2-PL(1 SRCD)
              ADD 1 TO TY-NO-PL(1 SRCD).

      *---------------------------------------------------------
      *    (PI) ACCOUNT INTO INACTIVE PL STATUS
      *          - REMOVE ACCOUNT FROM ACTIVE TY-PL-ACTIVITY TABLE
      *          - PUT ACCOUNT INTO INACTIVE TY-PL-ACTIVITY TABLE
      *---------------------------------------------------------
           IF LP-TRCD = "PI"
              PERFORM GET-SRCD-SUB
      *        SRCD = ACTIVE P&L
              SUBTRACT LP-APINTOWE LP-INTDUE FROM TY-AMT-PL(1 SRCD)
              SUBTRACT LP-OT2BAL FROM TY-O2-PL(1 SRCD)
              SUBTRACT 1 FROM TY-NO-PL(1 SRCD)
              ADD 1 TO SRCD
      *        SRCD = INACTIVE P&L
              ADD LP-APINTOWE LP-INTDUE TO TY-AMT-PL(1 SRCD)
              ADD LP-OT2BAL TO TY-O2-PL(1 SRCD)
              ADD 1 TO TY-NO-PL(1 SRCD)
              ADD LP-APINTOWE LP-INTDUE TO TY-AMT-PL(2 SRCD)
              ADD LP-OT2BAL TO TY-O2-PL(2 SRCD)
              ADD 1 TO TY-NO-PL(2 SRCD).

      *---------------------------------------------------------
      *    (PW) REVERSE ACCOUNT FROM WRITEOFF PL STATUS
      *         - PUT ACCOUNT BACK INTO INACTIVE TY-PL-ACTIVITY TABLE
      *---------------------------------------------------------
           IF RV-LP-TRCD = "PW"
              PERFORM GET-SRCD-SUB
              ADD 1 TO TY-NO-PL(1 SRCD)
              SUBTRACT LP-APCUR FROM TY-AMT-PL(1 SRCD)
              ADD LP-OT2BAL TO TY-O2-PL(1 SRCD)
              GO TO TY-UPDATE-INS.

      *---------------------------------------------------------
      *    (PW) PUT ACCOUNT INTO WRITEOFF PL STATUS
      *         - REMOVE ACCOUNT FROM INACTIVE TY-PL-ACTIVITY TABLE
      *---------------------------------------------------------
           IF LP-TRCD = "PW"
              PERFORM GET-SRCD-SUB
      *        SRCD = INACTIVE P&L
              SUBTRACT 1 FROM TY-NO-PL(1 SRCD)
              SUBTRACT LP-APCUR FROM TY-AMT-PL(1 SRCD)
              SUBTRACT LP-OT2BAL FROM TY-O2-PL(1 SRCD)
              GO TO TY-UPDATE-INS.

      *--------------------------------------------------------------
      *    REDUCE P&L ACTIVE BUCKET WITH NO. AND AMT OF TRANSACTION
      *--------------------------------------------------------------
           IF LN-PLCD = "P"
              PERFORM GET-SRCD-SUB
              ADD ONE TO TY-NO-PL(1 SRCD)
              SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                        FROM TY-AMT-PL(1 SRCD)
              IF HOLD-LP-TRCD = "Z2" OR "PB" OR "RN"
                             OR "SC" OR "RB" OR "RO"
                 SUBTRACT LP-APOT2 FROM TY-O2-PL(1 SRCD)
                 ADD LP-APOT2 TO TY-PL-O2COL(ORIG-LN-PLSUB)
              END-IF
              IF HOLD-LP-TRCD = "O2"
                 ADD LP-APINTOWE TO TY-O2-PL(1 SRCD)
                                    TY-O2-PL(2 SRCD)
                                    TY-AMT-PL(2 SRCD)
              END-IF
              IF HOLD-LP-TRCD = "W2"
                 SUBTRACT LP-APINTOWE FROM TY-O2-PL(1 SRCD)
              END-IF
      * - ONHAND OR SOLD REPO IN P&L RECEIVABLES:
              IF LN-REPOCD = "X" OR "S"
                 IF LN-REPOCD = "X"
                    MOVE 4 TO REPO-PL-SUB
                 ELSE
                    MOVE 5 TO REPO-PL-SUB
                 END-IF
                 ADD ONE TO TY-NO-REPO(1 REPO-PL-SUB)
                 SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                   FROM TY-AMT-REPO(1 REPO-PL-SUB)
                 IF HOLD-LP-TRCD = "Z2" OR "PB" OR "RN"
                             OR "SC" OR "RB" OR "RO"
                    SUBTRACT LP-APOT2 FROM TY-O2-REPO(1 REPO-PL-SUB)
                 END-IF
                 IF HOLD-LP-TRCD = "O2"
                    ADD LP-APINTOWE TO TY-O2-REPO(1 REPO-PL-SUB)
                                       TY-O2-REPO(2 REPO-PL-SUB)
                                       TY-AMT-REPO(2 REPO-PL-SUB)
                 END-IF
                 IF HOLD-LP-TRCD = "W2"
                    SUBTRACT LP-APINTOWE
                        FROM TY-O2-REPO(1 REPO-PL-SUB).

      *---------------------------------------------------------
      *    REDUCE NON P&L BUCKET WITH NO. AND AMT OF TRANSACTION
      *---------------------------------------------------------
           IF LN-PLCD NOT = "P"
              IF ORIG-LN-IS-REPO-AR
                 ADD ONE TO TY-NO-REPO(1 REPO-AR-SUB)
                 SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                      FROM TY-AMT-REPO(1 REPO-AR-SUB)
                 IF HOLD-LP-TRCD = "Z2" OR "PB" OR "RN"
                                OR "SC" OR "RB" OR "RO"
                    SUBTRACT LP-APOT2 FROM TY-O2-REPO(1 REPO-AR-SUB)
                    ADD LP-APOT2 TO TY-OT2COL
                 END-IF
                 IF HOLD-LP-TRCD = "O2"
                    ADD LP-APINTOWE TO TY-O2-REPO(1 REPO-AR-SUB)
                                       TY-O2-REPO(2 REPO-AR-SUB)
                                       TY-AMT-REPO(2 REPO-AR-SUB)
                 END-IF
                 IF HOLD-LP-TRCD = "W2"
                    SUBTRACT LP-APINTOWE FROM TY-O2-REPO(1 REPO-AR-SUB)
                 END-IF
              ELSE
                 PERFORM GET-SRCD-SUB
                 ADD ONE TO TY-NO(1 SRCD)
                 SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                           FROM TY-AMT(1 SRCD)
                 IF HOLD-LP-TRCD = "Z2" OR "PB" OR "RN"
                                OR "SC" OR "RB" OR "RO"
                    SUBTRACT LP-APOT2 FROM TY-O2(1 SRCD)
                    ADD LP-APOT2 TO TY-OT2COL
                 END-IF
                 IF HOLD-LP-TRCD = "O2"
                    ADD LP-APINTOWE TO TY-O2(1 SRCD)
                                       TY-O2(2 SRCD)
                                       TY-AMT(2 SRCD)
                 END-IF
                 IF HOLD-LP-TRCD = "W2"
                    SUBTRACT LP-APINTOWE FROM TY-O2(1 SRCD).

           ADD LP-APOTH TO TY-OTHCOL.

           IF NOT (HOLD-LP-TRCD = "WL" OR "WI" OR "WO"
                                        OR "W2" OR "AP")
              PERFORM UPDATE-TY-NO-COLLECTED
           ELSE
           IF HOLD-LP-TRCD = "WL"
              ADD NO-RV-ONE TO TY-LATE-NO-WAIVED
              ADD LP-APLC TO TY-LATE-AMT-WAIVED
           ELSE
              IF HOLD-LP-TRCD = "WI"
                 ADD NO-RV-ONE TO TY-INT-NO-WAIVED
                 ADD LP-APINT TO TY-INT-AMT-WAIVED
              ELSE
                 IF HOLD-LP-TRCD = "WO"
                    ADD NO-RV-ONE TO TY-OTH-NO-WAIVED
                    ADD LP-APOTH TO TY-OTH-AMT-WAIVED
                 ELSE
                    IF HOLD-LP-TRCD = "W2"
                       ADD NO-RV-ONE TO TY-OT2-NO-WAIVED
                       ADD LP-APINTOWE TO TY-OT2-AMT-WAIVED.

           PERFORM GET-SRCD-SUB.
           IF NOT (HOLD-LP-TRCD = "WL" OR "WI")
              IF SRCD-IS-PL
                 ADD LP-APINT TO TY-PL-INTCOL(ORIG-LN-PLSUB)
                 ADD LP-APLC TO TY-PL-LATECOL(ORIG-LN-PLSUB)
              ELSE
                 ADD LP-APLC TO TY-LATECOL
                 IF (DF-POSTING) AND (SP-DEFFRMLA NOT = 97 AND
                                      SP-DEFFRMLA NOT = 96 AND
                                      SP-DEFFRMLA NOT = 95)
                    ADD LP-APINT TO TY-DEFCOL
                 ELSE
                    ADD LP-APINT TO TY-INTCOL.
           IF SRCD-IS-PL
              IF NOT (HOLD-LP-TRCD = "AP" OR "O2" OR "OP" OR "RE"
                                  OR "RA" OR "RC" OR "RD"
                                  OR "RI" OR "RM" OR "RP"
                                  OR "RS" OR "R1" OR "R2" OR "R3"
                                  OR "CA" OR "CC" OR "CD"
                                  OR "CI" OR "CM" OR "CP" OR "CS"
                                  OR "C1" OR "C2" OR "C3" OR "AP"
                                  OR "O2" OR "W2" OR "PX")
                 ADD LP-APCUR TO TY-PL-PRINCOL(ORIG-LN-PLSUB).


           IF SRCD-NOT-PL
              IF NOT (
                      HOLD-LP-TRCD = "RN" OR "SC" OR "PB" OR "RB"
                                  OR "RO" OR "RA" OR "RC" OR "RD"
                                  OR "RI" OR "RM" OR "RP"
                                  OR "RS" OR "R1" OR "R2" OR "R3"
                                  OR "CA" OR "CC" OR "CD"
                                  OR "CI" OR "CM" OR "CP" OR "CS"
                                  OR "C1" OR "C2" OR "C3" OR "AP"
                                  OR "O2" OR "W2" OR "PX"
                                  OR "OP" OR "RE"
                     )
                 ADD LP-APCUR TO TY-PRINCOL.

           IF LP-REFNO = "LBOX" OR "TCOLL" OR "TPAY" OR "MGRAM"
              ADD LP-TRAMT TO TY-LOCKBOX
           ELSE
           IF LP-REFNO = "ALLOT"
              ADD LP-TRAMT TO TY-ALLOTMENTS
           ELSE
           IF RV-LP-REFNO = "LBOX" OR "TCOLL" OR "TPAY" OR "MGRAM"
              ADD LP-TRAMT TO TY-LOCKBOX
           ELSE
           IF RV-LP-REFNO = "ALLOT"
              ADD LP-TRAMT TO TY-ALLOTMENTS
           ELSE
           IF LP-TRCD = "PA" AND
              (NOT (LP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
                                       OR "TPAY" OR "MGRAM")
              )
              ADD LP-TRAMT TO TY-ALLOTMENTS
           ELSE
           IF RV-LP-TRCD = "PA" AND
              (NOT (RV-LP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
                                          OR "TPAY" OR "MGRAM")
              )
              ADD LP-TRAMT TO TY-ALLOTMENTS.

           IF HOLD-LP-TRCD = "PX"
              ADD LP-TRAMT TO TY-PART-CHGOFF.

       TY-UPDATE-INS.
           IF LN-INSURED = "M" OR "S"
              IF LN-INSTYPES-LL
                 IF HOLD-LP-TRCD = "RC" OR "CC"
                    ADD LP-TRAMT TO TY-CLREB3
                 ELSE
                    ADD REB-AMOUNT(1) TO TY-CLREB3
              ELSE
                 IF HOLD-LP-TRCD = "RC" OR "CC"
                    ADD LP-TRAMT TO TY-CLREB1
                 ELSE
                    ADD REB-AMOUNT(1) TO TY-CLREB1.

           IF LN-INSURED = "J"
              IF LN-INSTYPES-LL
                 IF HOLD-LP-TRCD = "RC" OR "CC"
                    ADD LP-TRAMT TO TY-CLREB4
                 ELSE
                    ADD REB-AMOUNT(1) TO TY-CLREB4
              ELSE
                 IF HOLD-LP-TRCD = "RC" OR "CC"
                    ADD LP-TRAMT TO TY-CLREB2
                 ELSE
                    ADD REB-AMOUNT(1) TO TY-CLREB2.

           IF HOLD-LP-TRCD = "RA" OR "CA"
              ADD LP-TRAMT TO TY-AHREB
           ELSE
              ADD REB-AMOUNT(2) TO TY-AHREB.

           IF HOLD-LP-TRCD = "RP" OR "CP"
              ADD LP-TRAMT TO TY-PPREB
           ELSE
              ADD REB-AMOUNT(3) TO TY-PPREB.

           IF HOLD-LP-TRCD = "R1" OR "C1"
              ADD LP-TRAMT TO TY-O1REB
           ELSE
              ADD REB-AMOUNT(9) TO TY-O1REB.

           IF HOLD-LP-TRCD = "R2" OR "C2"
              ADD LP-TRAMT TO TY-O2REB
           ELSE
              ADD REB-AMOUNT(10) TO TY-O2REB.

           IF HOLD-LP-TRCD = "R3" OR "C3"
              ADD LP-TRAMT TO TY-O3REB
           ELSE
              ADD REB-AMOUNT(11) TO TY-O3REB.

           IF HOLD-LP-TRCD = "RI" OR "CI"
              ADD LP-TRAMT TO TY-INTREB
           ELSE
              ADD REB-AMOUNT(4) TO TY-INTREB.

           IF HOLD-LP-TRCD = "RS" OR "CS"
              ADD LP-TRAMT TO TY-SCREB
           ELSE
              ADD REB-AMOUNT(5) TO TY-SCREB.

           IF HOLD-LP-TRCD = "RM" OR "CM"
              ADD LP-TRAMT TO TY-MFREB
           ELSE
              ADD REB-AMOUNT(6) TO TY-MFREB.

           IF HOLD-LP-TRCD = "RD" OR "CD"
              ADD LP-TRAMT TO TY-DFREB
           ELSE
              ADD REB-AMOUNT(7) TO TY-DFREB.

      * ADDED SUBTRACT OF O2 MONIES FOR NEW FEATURE TO RENEW O2
      *  MONIES (REQ 192)
           IF HOLD-LP-TRCD = "RN" OR "PB" OR "SC"
                                OR "RB" OR "RO"
              ADD LP-APCUR TO TY-RNPRIN
              SUBTRACT LP-APOT2 FROM TY-RNPRIN.

           IF ( LP-REFNO = "NSF" ) OR
              ( CONV-REV-FLAG = "Y" AND HOLD-LP-REFNO = "NSF" )
              IF NOT ( (RV-LP-TRCD = "PA") OR
                       (RV-LP-REFNO = "LBOX"  OR "TPAY"
                                   OR "TCOLL" OR "MGRAM")
                     )
                     IF BRANCH = LN-OWNBR
                        ADD LP-TRAMT TO TY-CKWRITTEN(5).

      * UPDATE TY PROCEEDS:
           IF GP-UNEARNED-STATS = "Y"
              ADD LP-DLPROC TO TY-PROCEEDS.

           PERFORM REWRITE-TY1-FILE.
           PERFORM CLOSE-TY1-FILE.

      **************************************************************
       UPDATE-TY-NO-COLLECTED SECTION.
      **************************************************************
           IF LP-APLC NOT = 0
              ADD NO-RV-ONE TO TY-LATE-NO-COL.
           IF LP-APINT NOT = 0
              ADD NO-RV-ONE TO TY-INT-NO-COL.
           IF LP-APOTH NOT = 0
              ADD NO-RV-ONE TO TY-OTH-NO-COL.
           IF LP-APOT2 NOT = 0
              ADD NO-RV-ONE TO TY-OT2-NO-COL.

      ********************************************
       GET-TY1-FILE SECTION.
      ********************************************
           PERFORM OPEN-TY1-FILE.

           MOVE "N" TO REC-EXISTS.
       GET-TY1-FILE-CHECK-EXISTS.
           PERFORM SET-TY-KEY.
           PERFORM READ-TY1-FILE.
           IF IO-FG = 0
              GO TO GET-TY1-FILE-EXIT.

           IF REC-EXISTS = "Y"
              GO TO IO-ERROR.

           MOVE "Y" TO REC-EXISTS.

           PERFORM CLEAR-TY-FILE.

           PERFORM SET-TY-KEY.

           PERFORM WRITE-TY1-FILE.
      * 2/28/96 BAH ADDED THE TEST ON E-CODE "22"
           IF IO-FG = 9 AND E-CODE NOT = "22"
              GO TO IO-ERROR.

           GO TO GET-TY1-FILE-CHECK-EXISTS.

       GET-TY1-FILE-EXIT.
           EXIT.

      ******************************************
       UPDATE-TY1-FILE-DLR-RESV SECTION.
      ******************************************
           MOVE "UPDATING TODAYS DEALER RESERVES........." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM GET-TY1-FILE.

      * UPDATE DEALER RESERVES:   "PR"  "PC"  "PP"
      *                           "P4"  "P5"
           IF DLRV-LP-DLNO = 0
              PERFORM TY1-UPDATE-RESERVE-BAL.

      * FOR PC ACCOUNTS, NOT SERVICED
      *     ONLY 'CI' OR 'RI' MAY HAVE A VALUE.
      * FOR IB ACCOUNTS, NOT SERVICED
      *     ONLY 'PO' OR 'SC' MAY HAVE A VALUE.
      * FOR A PAYOFF WITH AN AUTO 'RI'
      *     THE HOLD FIELD MAY HAVE A VALUE.

           IF LN-SERVACCT NOT = "Y"
              IF LP-IBPC = "P"
                 IF HOLD-LP-TRCD = "CI" OR "RI"
                    SUBTRACT LP-DLRVCHGS-ADJ(1) FROM TY-DLRVCHGS(1 1)
                    SUBTRACT LP-DLRVCHGS-ADJ(2) FROM TY-DLRVCHGS(1 2)
                    SUBTRACT LP-DLRVCHGS-ADJ(3) FROM TY-DLRVCHGS(1 3)
                    SUBTRACT LP-DLPARVHELD-ADJ FROM TY-DLPARVHELD(1)
      * IT IS CORRECT TO REDUCE HELD AND NOT PAID
                    SUBTRACT LP-DLPARVPAID-ADJ FROM TY-DLPARVHELD(1)
                 ELSE
      * AUTO REBATE
                 IF HOLD-LP-TRCD = "PO" OR "SC"
                    SUBTRACT HOLD-DLRVCHGS-ADJ(1) FROM TY-DLRVCHGS(1 1)
                    SUBTRACT HOLD-DLRVCHGS-ADJ(2) FROM TY-DLRVCHGS(1 2)
                    SUBTRACT HOLD-DLRVCHGS-ADJ(3) FROM TY-DLRVCHGS(1 3)
                    SUBTRACT HOLD-DLPARVHELD-ADJ FROM TY-DLPARVHELD(1)
      * IT IS CORRECT TO REDUCE HELD AND NOT PAID
                    SUBTRACT HOLD-DLPARVPAID-ADJ FROM TY-DLPARVHELD(1).

           IF LN-SERVACCT NOT = "Y"
              IF LP-IBPC = "I"
                 IF HOLD-LP-TRCD = "PO" OR "SC"
                    SUBTRACT LP-DLRVCHGS-ADJ(1) FROM TY-DLRVCHGS(1 1)
                    SUBTRACT LP-DLRVCHGS-ADJ(2) FROM TY-DLRVCHGS(1 2)
                    SUBTRACT LP-DLRVCHGS-ADJ(3) FROM TY-DLRVCHGS(1 3)
                    SUBTRACT LP-DLPARVHELD-ADJ FROM TY-DLPARVHELD(1)
      * IT IS CORRECT TO REDUCE HELD AND NOT PAID
                    SUBTRACT LP-DLPARVPAID-ADJ FROM TY-DLPARVHELD(1).

           PERFORM REWRITE-TY1-FILE.
           PERFORM CLOSE-TY1-FILE.

       EXIT-UPDATE-TY1-FILE-DLR-RESV.
           EXIT.

      ********************************************************
       UPD-TY1-OTHER-DLRVBAL SECTION.
      ********************************************************

      * RESERVES:   "PR"  "PC"  "PP"

           MOVE "UPDATING OTHER DEALER RESERVES......" TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM GET-TY1-FILE.

           PERFORM TY1-UPDATE-RESERVE-BAL.

           PERFORM REWRITE-TY1-FILE.
           PERFORM CLOSE-TY1-FILE.

       UPD-TY1-OTHER-DLRVBAL-EXIT.
           EXIT.

      ********************************************************
       TY1-UPDATE-RESERVE-BAL SECTION.
      ********************************************************

      * RESERVES:   "PR"  "PC"  "PP"  "P4"  "P5"

      * PAYMENT OUT OF RESERVE FROM PRINCIPAL:
           IF HOLD-LP-TRCD = "PR"
              SUBTRACT LP-TRAMT FROM TY-DLRVPRIN(1 DLRV-LP-DLRVNO)
           ELSE
      * PAYMENT OUT OF RESERVE FROM CHARGES:
           IF HOLD-LP-TRCD = "PC"
              SUBTRACT LP-TRAMT FROM TY-DLRVCHGS(1 DLRV-LP-DLRVNO)
           ELSE
      * PAYMENT OUT OF RESERVE FROM PARTICIPATION:
           IF HOLD-LP-TRCD = "PP"
              SUBTRACT LP-TRAMT FROM TY-DLPARVHELD(1).

           IF NOT (HOLD-LP-TRCD = "P4" OR "P5")
              GO TO TY1-UPDATE-RESERVE-BAL-EXIT.

      * P4 AND P5 TRANSACTIONS:
      * PAYMENT OUT OF RESERVE TO COVER P&L EXPENSE:
           PERFORM GET-P4P5-RESERVE-AMT.
           IF DLRV-LP-P4P5-TRCD = "PR"
              SUBTRACT P4P5-RSVAMT
                              FROM TY-DLRVPRIN(1 DLRV-LP-P4P5-DLRVNO)
           ELSE
      * PAYMENT OUT OF RESERVE FROM CHARGES:
           IF DLRV-LP-P4P5-TRCD = "PC"
              SUBTRACT P4P5-RSVAMT
                              FROM TY-DLRVCHGS(1 DLRV-LP-P4P5-DLRVNO)
           ELSE
      * PAYMENT OUT OF RESERVE FROM PARTICIPATION:
           IF DLRV-LP-P4P5-TRCD = "PP"
              SUBTRACT P4P5-RSVAMT FROM TY-DLPARVHELD(1).

       TY1-UPDATE-RESERVE-BAL-EXIT.
           EXIT.

      *******************************************
       UPDATE-TY1-POST-BR SECTION.
      *******************************************

      *  UPDATE POSTING BRANCH FOR NSF (TY-FILE)

           MOVE "UPDATING TODAY'S TOTAL FILE..(OTHER BR)." TO MESS.
           PERFORM TEST-SEND-LEGEND.

      * INTERBRANCH; LP/INTRBR PUTS YOU IN THE "OWNING" BRANCHES FILES, SO
      *              PATH-MACHINE IS THE "POSTING" BRANCH....

      * BUILD TY-PATH TO SAVE
           PERFORM LOAD-TY1-FILE.
           MOVE TY-PATH-SQL TO HOLD-PATH.

           IF PATH-MACHINE NOT = " "
              MOVE EXT-FILPATH-BASE        TO TY-ALL-BASE
              MOVE PATH-MACHINE            TO TY-ALL-MACHINE
              MOVE PATH-DATA               TO TY-ALL-DATA
              MOVE TY-ALL-PATH             TO TY-PATH
              MOVE "Y"                     TO TY-PATH-OVERRIDE.

           MOVE BRANCH TO BRNO-FOR-TY.
           PERFORM GET-TY1-FILE.

           ADD LP-TRAMT TO TY-CKWRITTEN(5).
           PERFORM REWRITE-TY1-FILE.
           PERFORM CLOSE-TY1-FILE.

           MOVE HOLD-PATH TO TY-PATH-SQL.

           MOVE " " TO TY-PATH-OVERRIDE.

       EXIT-UPDATE-TY1-POST-BR.
           EXIT.

      ******************************************************
       GET-UNEARN-STATS-PRIOR-LNUPD SECTION.
      ******************************************************

      * NET GAIN/LOSS ONLY
      * THIS IS PERFORMED FOR ALL TRANSACTIONS

           PERFORM COMPUTE-EARNINGS.

           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 6
               IF GP-UNEARNED-STATS = "Y"
                  MOVE EARN-UNEARN(SUB) TO NET-UNEARNED-AMT(SUB)
               END-IF
           END-PERFORM.

      ******************************************************
       GET-UNEARN-STATS-AFTER-LNUPD SECTION.
      ******************************************************

      * NET GAIN/LOSS ONLY
      * THIS IS PERFORMED FOR ALL TRANSACTIONS

           PERFORM COMPUTE-EARNINGS.

           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 6
               IF GP-UNEARNED-STATS = "Y"
                  SUBTRACT NET-UNEARNED-AMT(SUB) FROM EARN-UNEARN(SUB)
                                          GIVING NET-UNEARNED-AMT(SUB)
               END-IF
           END-PERFORM.

      ******************************************************
       GET-CON-REC-PRIOR-LNUPD SECTION.
      ******************************************************

      * GET CONTRACTUAL, RECENCY & SAVE-OUTBAL
      * FOR UPDATE OF TY & DS PRIOR TO LOAN UPDATE
      * THIS IS PERFORMED FOR ALL TRANSACTIONS

           MOVE TRANS-DATE TO AGEING-DATE.
           PERFORM COMPUTE-CONTRACTUAL.
           PERFORM COMPUTE-RECENCY.

           MOVE CSUB TO PRIOR-CSUB.
           MOVE RDSUB TO PRIOR-RDSUB.

      * SETUP OUTBAL WORKER FOR UPDATE OF STATS
           IF GP-DELINQ-WITH-O2 = "Y"
              MOVE LN-CURBAL TO PRIOR-SAVE-OUTBAL
           ELSE
              SUBTRACT LN-OT2BAL FROM LN-CURBAL
                         GIVING PRIOR-SAVE-OUTBAL.

      *******************************************
       UPDATE-TY1-PRIOR SECTION.
      *******************************************
           IF ORIG-LN-PLCD = " "
              IF ONE NOT = +1
                 SUBTRACT 1 FROM TY-UNITS(1 PRIOR-RDSUB)
                                 TY-UNITS(2 PRIOR-CSUB)
                 SUBTRACT PRIOR-SAVE-OUTBAL
                            FROM TY-OUTBAL(1 PRIOR-RDSUB)
                                 TY-OUTBAL(2 PRIOR-CSUB)
                 IF ORIG-LN-IS-BNKRPT
                    PERFORM UPDATE-TY1-PRIOR-BNKRPT.

       UPDATE-TY1-PRIOR-EXIT.
           EXIT.

      *******************************************
       UPDATE-TY1-PRIOR-BNKRPT SECTION.
      *******************************************

      * UPDATE BANKRUPT TODAYS TOTALS FOR PRIOR TO LOAN UPDATE

           IF ORIG-LN-PLCD = " "
              SUBTRACT 1 FROM TY-UNITS-BNKRPT(1 PRIOR-RDSUB)
                              TY-UNITS-BNKRPT(2 PRIOR-CSUB)
              SUBTRACT PRIOR-SAVE-OUTBAL
                      FROM TY-OUTBAL-BNKRPT(1 PRIOR-RDSUB)
                           TY-OUTBAL-BNKRPT(2 PRIOR-CSUB).

       UPDATE-TY1-PRIOR-BNKRPT-EXIT.
           EXIT.

      *******************************************
       UPDATE-DS1-PRIOR SECTION.
      *******************************************

      * UPDATE DEALER STATISTICS FOR PRIOR TO LOAN UPDATE

           IF ORIG-LN-PLCD = " "
              IF ONE NOT = +1
                 SUBTRACT 1 FROM DS-UNITS(DSNOW DSREC PRIOR-RDSUB)
                                 DS-UNITS(DSNOW DSCON PRIOR-CSUB)
                 SUBTRACT PRIOR-SAVE-OUTBAL
                            FROM DS-OUTBAL(DSNOW DSREC PRIOR-RDSUB)
                                 DS-OUTBAL(DSNOW DSCON PRIOR-CSUB)
                 IF ORIG-LN-IS-BNKRPT
                    PERFORM UPDATE-DS1-PRIOR-BNKRPT.

       UPDATE-DS1-PRIOR-EXIT.
           EXIT.

      *******************************************
       UPDATE-DS1-PRIOR-BNKRPT SECTION.
      *******************************************

      * UPDATE BANKRUPT DEALER STATISTICS FOR PRIOR TO LOAN UPDATE
           IF ORIG-LN-PLCD = " "
              SUBTRACT 1 FROM DS-UNITS-BNKRPT(DSNOW DSREC PRIOR-RDSUB)
                              DS-UNITS-BNKRPT(DSNOW DSCON PRIOR-CSUB)
              SUBTRACT PRIOR-SAVE-OUTBAL
                      FROM DS-OUTBAL-BNKRPT(DSNOW DSREC PRIOR-RDSUB)
                           DS-OUTBAL-BNKRPT(DSNOW DSCON PRIOR-CSUB).

       UPDATE-DS1-PRIOR-BNKRPT-EXIT.
           EXIT.

      ******************************************************
       GET-CON-REC-AFTER-LNUPD SECTION.
      ******************************************************

      * GET CONTRACTUAL, RECENCY & SAVE-OUTBAL
      * FOR UPDATE OF TY & DS AFTER LOAN UPDATE
           MOVE TRANS-DATE TO AGEING-DATE.
           PERFORM COMPUTE-CONTRACTUAL.
           PERFORM COMPUTE-RECENCY.

           MOVE CSUB TO AFTER-CSUB.
           MOVE RDSUB TO AFTER-RDSUB.

      * SETUP OUTBAL WORKER FOR UPDATE OF STATS
           IF GP-DELINQ-WITH-O2 = "Y"
              MOVE LN-CURBAL TO AFTER-SAVE-OUTBAL
           ELSE
              SUBTRACT LN-OT2BAL FROM LN-CURBAL
                         GIVING AFTER-SAVE-OUTBAL.

      *******************************************
       UPDATE-TY1-AFTER SECTION.
      *******************************************

      * UPDATE TODAYS TOTALS FOR AFTER LOAN UPDATE

           IF (ORIG-LN-PLCD = "I" OR "W")
                 OR (HOLD-LP-TRCD = "PI" OR "PW")
              GO TO UPDATE-TY1-AFTER-EXIT.

           MOVE "UPDATING TODAY'S DELINQ TOTAL FILE............."
                                                             TO MESS.
           PERFORM TEST-SEND-LEGEND.

           MOVE LN-OWNBR TO BRNO-FOR-TY.
           PERFORM GET-TY1-FILE.

           IF (HOLD-LP-TRCD = "BK" OR "BD")
              IF (HOLD-LP-TRCD = "BD" AND SAVE-LP-TRCD = "RV") OR
                 (SAVE-LP-TRCD = "BK")
                 PERFORM POST-TY1-AFTER-UPDATE-BNKRPT
              END-IF
           ELSE
              PERFORM POST-TY1-AFTER-UPDATE.

           PERFORM REWRITE-TY1-FILE.
           PERFORM CLOSE-TY1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

       UPDATE-TY1-AFTER-EXIT.
           EXIT.

      ********************************************
       POST-TY1-AFTER-UPDATE SECTION.
      ********************************************
           IF LN-PLCD = " "
              IF ONE NOT = -1
                 ADD 1 TO TY-UNITS(1 AFTER-RDSUB)
                          TY-UNITS(2 AFTER-CSUB)
                 ADD AFTER-SAVE-OUTBAL TO TY-OUTBAL(1 AFTER-RDSUB)
                                          TY-OUTBAL(2 AFTER-CSUB)
                 IF ORIG-LN-IS-BNKRPT
                    PERFORM POST-TY1-AFTER-UPDATE-BNKRPT.

      ********************************************
       POST-TY1-AFTER-UPDATE-BNKRPT SECTION.
      ********************************************
           IF LN-PLCD = " "
              ADD 1 TO TY-UNITS-BNKRPT(TYREC AFTER-RDSUB)
                       TY-UNITS-BNKRPT(TYCON AFTER-CSUB)
              ADD AFTER-SAVE-OUTBAL
                   TO TY-OUTBAL-BNKRPT(TYREC AFTER-RDSUB)
                      TY-OUTBAL-BNKRPT(TYCON AFTER-CSUB).

      *******************************************
       UPDATE-DS1-AFTER SECTION.
      *******************************************
           IF (ORIG-LN-PLCD = "I" OR "W")
                 OR (HOLD-LP-TRCD = "PI" OR "PW")
              GO TO UPDATE-DS1-AFTER-EXIT.

           MOVE "UPDATING DSFILE DELINQ TOTALS............."
                                                        TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM OPEN-DS1-FILE.
           MOVE "N" TO REC-EXISTS.
       UPDATE-DS1-AFTER-CHECK-EXISTS.
           MOVE TRANS-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.
           MOVE DATE-YYYYMM TO DS-DATE-CCYYMM.
           MOVE LN-OWNBR TO DS-BRANCH.
           MOVE LN-DLNO TO DS-DLNO.
           MOVE LN-CLASS TO DS-CLASS.
           MOVE DS1-KEY TO HOLD-DS1-KEY.
           PERFORM READ-DS1-FILE.
           IF IO-FG NOT = 0
              IF REC-EXISTS = "Y"
                 GO TO IO-ERROR
              ELSE
                 PERFORM DS1-CREATE-REC
                 GO TO UPDATE-DS1-AFTER-CHECK-EXISTS.

           IF (HOLD-LP-TRCD = "BK" OR "BD")
              IF (HOLD-LP-TRCD = "BD" AND SAVE-LP-TRCD = "RV") OR
                 (SAVE-LP-TRCD = "BK")
                 PERFORM POST-DS1-AFTER-UPDATE-BNKRPT
              END-IF
           ELSE
              PERFORM POST-DS1-AFTER-UPDATE.

           PERFORM REWRITE-DS1-FILE.
           PERFORM CLOSE-DS1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

       UPDATE-DS1-AFTER-EXIT.
           EXIT.

      ********************************************
       POST-DS1-AFTER-UPDATE SECTION.
      ********************************************
           IF LN-PLCD = " "
              IF ONE NOT = -1
                 ADD 1 TO DS-UNITS(DSNOW DSREC AFTER-RDSUB)
                          DS-UNITS(DSNOW DSCON AFTER-CSUB)
                 ADD AFTER-SAVE-OUTBAL
                       TO DS-OUTBAL(DSNOW DSREC AFTER-RDSUB)
                          DS-OUTBAL(DSNOW DSCON AFTER-CSUB)
                 IF ORIG-LN-IS-BNKRPT
                    PERFORM POST-DS1-AFTER-UPDATE-BNKRPT.

      ********************************************
       POST-DS1-AFTER-UPDATE-BNKRPT SECTION.
      ********************************************
           IF LN-PLCD = " "
              ADD 1 TO DS-UNITS-BNKRPT(DSNOW DSREC AFTER-RDSUB)
                       DS-UNITS-BNKRPT(DSNOW DSCON AFTER-CSUB)
              ADD AFTER-SAVE-OUTBAL
                   TO DS-OUTBAL-BNKRPT(DSNOW DSREC AFTER-RDSUB)
                      DS-OUTBAL-BNKRPT(DSNOW DSCON AFTER-CSUB).

      ***********************************************************
       UPDATE-TY1-SXSVSS SECTION.
      ***********************************************************

      * UPDATE TY1-FILE FOR 'SX' AND 'ZX' AND 'SV' AND 'SS'
           MOVE "UPDATING TODAY'S TOTAL FILE...(REPO)...." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           MOVE LN-OWNBR TO BRNO-FOR-TY.
           PERFORM GET-TY1-FILE.

           IF ORIG-LN-PLCD NOT = " "
              GO TO TY1-UPDATE-REPO-ON-PL.

      *------.---------------------------------------------------
      *    (SX) (ZX) SET ACCOUNT INTO REPO ONHAND STATUS
      *              IT IS ASSUMED THAT RE: MERCURY
      *                 AN ACCOUNT MUST BE IN THE FOLLOW STATUS
      *                 TO ALLOW POSTING OF 'SX';
      *                    1. NOT IN P&L STATUS (NOTE: GET-SRCD-SUB)
      *                    2. IN IB STATUS
      *--------------------------------------------------------------
           IF HOLD-LP-TRCD = "SX" OR "ZX"
      *       -.-------------------------------------------------
      *        (SX) (ZX) REVERSAL
      *                  1. REMOVE FROM TY-REPO TABLE
      *                  2. PUT BACK INTO TY-ACTIVITY TABLE
      *                  3. PUT BACK INTO TY-DELINQUENCY TABLE
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SX" OR "ZX"
                 PERFORM GET-CON-REC-AFTER-LNUPD
                 PERFORM POST-TY1-AFTER-UPDATE
                 PERFORM GET-SRCD-SUB
                 ADD HOLD-LP-CURBAL TO TY-AMT(1 SRCD)
                 ADD HOLD-LP-OT2BAL TO TY-O2(1 SRCD)
                 ADD 1 TO TY-NO(1 SRCD)
                 SUBTRACT HOLD-LP-CURBAL FROM TY-AMT-REPO(1 1)
                                               TY-AMT-REPO(2 1)
                 SUBTRACT HOLD-LP-OT2BAL FROM TY-O2-REPO(1 1)
                                               TY-O2-REPO(2 1)
                 SUBTRACT 1 FROM TY-NO-REPO(1 1)
                                 TY-NO-REPO(2 1)
              ELSE
      *       --------------------------------------------------
      *        (SX) (ZX) SET REPO ON HAND
      *                  1. ADD TO TY-REPO TABLE
      *                  2. TAKE OUT OF TY-ACTIVITY TABLE
      *                  3. TAKE OUT OF TY-DELINQUENCY TABLE
      *       --------------------------------------------------
                 PERFORM UPDATE-TY1-PRIOR
                 PERFORM GET-SRCD-SUB
                 SUBTRACT HOLD-LP-CURBAL FROM TY-AMT(1 SRCD)
                 SUBTRACT HOLD-LP-OT2BAL FROM TY-O2(1 SRCD)
                 SUBTRACT 1 FROM TY-NO(1 SRCD)
                 ADD HOLD-LP-CURBAL TO TY-AMT-REPO(1 1)
                                        TY-AMT-REPO(2 1)
                 ADD HOLD-LP-OT2BAL TO TY-O2-REPO(1 1)
                                        TY-O2-REPO(2 1)
                 ADD 1 TO TY-NO-REPO(1 1)
                          TY-NO-REPO(2 1).

      *---------------------------------------------------------
      *    (SV) SET ACCOUNT INTO REDEEMED REPO STATUS
      *         IT IS ASSUMED THAT RE: MERCURY
      *            AN ACCOUNT MUST BE IN THE FOLLOW STATUS
      *            TO ALLOW POSTING OF 'SV';
      *               1. ACCOUNT IS IN 'SX' OR 'ZX' STATUS
      *               2. NOT IN P&L STATUS (NOTE: GET-SRCD-SUB)
      *---------------------------------------------------------
           IF HOLD-LP-TRCD = "SV"
      *       --------------------------------------------------
      *       (SV) REVERSAL
      *             1. PUT BACK INTO TY-REPO ONHAND
      *             2. REMOVE FROM   TY-REPO REDEEMED
      *             3. REMOVE FROM   TY-ACTIVITY TABLE
      *             4. REMOVE FROM   TY-DELINQUENCY TABLE
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SV"
                 ADD HOLD-LP-OT2BAL TO TY-O2-REPO(1 1)
                 ADD HOLD-LP-CURBAL TO TY-AMT-REPO(1 1)
                 ADD 1 TO TY-NO-REPO(1 1)
                 SUBTRACT HOLD-LP-OT2BAL FROM TY-O2-REPO(1 2)
                                              TY-O2-REPO(2 2)
                 SUBTRACT HOLD-LP-CURBAL FROM TY-AMT-REPO(1 2)
                                               TY-AMT-REPO(2 2)
                 SUBTRACT 1 FROM TY-NO-REPO(1 2)
                                 TY-NO-REPO(2 2)
                 PERFORM UPDATE-TY1-PRIOR
                 PERFORM GET-SRCD-SUB
                 SUBTRACT HOLD-LP-OT2BAL FROM TY-O2(1 SRCD)
                 SUBTRACT HOLD-LP-CURBAL FROM TY-AMT(1 SRCD)
                 SUBTRACT 1 FROM TY-NO(1 SRCD)
              ELSE
      *       --------------------------------------------------
      *        SET (SV)
      *             1. REMOVE FROM TY-REPO ONHAND
      *             2. PUT BACK INTO TY-ACTIVITY TABLE
      *             3. PUT BACK INTO TY-DELINQUENCY TABLE
      *             4. PUT INTO TY-REPO REDEEMED
      *       --------------------------------------------------
                 SUBTRACT HOLD-LP-OT2BAL FROM TY-O2-REPO(1 1)
                 SUBTRACT HOLD-LP-CURBAL FROM TY-AMT-REPO(1 1)
                 SUBTRACT 1 FROM TY-NO-REPO(1 1)
                 ADD HOLD-LP-OT2BAL TO TY-O2-REPO(1 2)
                                        TY-O2-REPO(2 2)
                 ADD HOLD-LP-CURBAL TO TY-AMT-REPO(1 2)
                                        TY-AMT-REPO(2 2)
                 ADD 1 TO TY-NO-REPO(1 2)
                          TY-NO-REPO(2 2)
                 PERFORM GET-CON-REC-AFTER-LNUPD
                 PERFORM POST-TY1-AFTER-UPDATE
                 PERFORM GET-SRCD-SUB
                 ADD HOLD-LP-OT2BAL TO TY-O2(1 SRCD)
                 ADD HOLD-LP-CURBAL TO TY-AMT(1 SRCD)
                 ADD 1 TO TY-NO(1 SRCD).

      *---------------------------------------------------------
      *    (SS) SET ACCOUNT INTO SOLD REPO STATUS
      *         IT IS ASSUMED THAT RE: MERCURY
      *            AN ACCOUNT MUST BE IN THE FOLLOW STATUS
      *            TO ALLOW POSTING OF 'SS';
      *               1. ACCOUNT IS IN 'SX' OR 'ZX' STATUS
      *               2. NOT IN P&L STATUS (NOTE: GET-SRCD-SUB)
      *---------------------------------------------------------
           IF HOLD-LP-TRCD = "SS"
      *       --------------------------------------------------
      *        (SS) REVERSAL
      *             1. PUT BACK INTO TY-REPO ONHAND
      *             2. REMOVE FROM TY-REPO SOLD
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SS"
                 COMPUTE TY-O2-REPO(1 1) =
                     TY-O2-REPO(1 1) + HOLD-LP-OT2BAL
                 COMPUTE TY-AMT-REPO(1 1) =
                     TY-AMT-REPO(1 1) + HOLD-LP-CURBAL
                 ADD 1 TO TY-NO-REPO(1 1)
                 SUBTRACT HOLD-LP-APOT2 HOLD-LP-OT2BAL
                                           FROM TY-O2-REPO(1 3)
                                                TY-O2-REPO(2 3)
                 SUBTRACT HOLD-LP-APCUR HOLD-LP-CURBAL
                                           FROM TY-AMT-REPO(1 3)
                                                TY-AMT-REPO(2 3)
                 SUBTRACT 1 FROM TY-NO-REPO(2 3)
                 IF HOLD-LP-CURBAL NOT = 0
                    SUBTRACT 1 FROM TY-NO-REPO(1 3)
                 END-IF
              ELSE
      *       --------------------------------------------------
      *        SET (SS)
      *             1. REMOVE FROM TY-REPO ONHAND
      *             2. PUT INTO TY-REPO SOLD
      *       --------------------------------------------------
                 COMPUTE TY-O2-REPO(1 1) =
                     TY-O2-REPO(1 1) - HOLD-LP-APOT2
                                       - HOLD-LP-OT2BAL
                 COMPUTE TY-AMT-REPO(1 1) =
                     TY-AMT-REPO(1 1) - HOLD-LP-APCUR
                                       - HOLD-LP-CURBAL
                 SUBTRACT 1 FROM TY-NO-REPO(1 1)
                 ADD HOLD-LP-OT2BAL TO TY-O2-REPO(1 3)
                                       TY-O2-REPO(2 3)
                 ADD HOLD-LP-CURBAL TO TY-AMT-REPO(1 3)
                                        TY-AMT-REPO(2 3)
                 ADD 1 TO TY-NO-REPO(2 3)
                 IF HOLD-LP-CURBAL NOT = 0
                    ADD 1 TO TY-NO-REPO(1 3).

           GO TO UPDATE-TY1-SXSVSS-EXIT.

      **********************************************************
      *    UPDATE REPO TRANSACTION ON ACCT IN PL STATUS
      **********************************************************
       TY1-UPDATE-REPO-ON-PL.
      *    (SX) (ZX) SET PL ACCOUNT INTO REPO ONHAND STATUS
      *    SINCE ACCT IS ALREADY IN PL RECEIVABLES & OUTSTANDING,
      *    WE WILL ONLY AFFECT ADD'L REPO BUCKETS:
      *    REPO BUCKET 4: REPOS ON HAND IN PL STATUS
      *    REPO BUCKET 5: REPOS SOLD IN PL STATUS
      *---------------------------------------------------------
           IF HOLD-LP-TRCD = "SX" OR "ZX"
      *       ----------------------------------------------------------
      *        (SX) (ZX) REVERSAL (ACCOUNT IN PL STATUS)
      *                  1. SUBTRACT FROM VOLUME & OUTSTANDING TY-REPO
      *                     TABLE ELEMENT 4 (REPO ON-HAND IN PL STATUS)
      *       ----------------------------------------------------------
              IF RV-LP-TRCD = "SX" OR "ZX"
                 SUBTRACT HOLD-LP-CURBAL FROM TY-AMT-REPO(1 4)
                                              TY-AMT-REPO(2 4)
                 SUBTRACT HOLD-LP-OT2BAL FROM TY-O2-REPO(1 4)
                                              TY-O2-REPO(2 4)
                 SUBTRACT 1 FROM TY-NO-REPO(1 4)
                                 TY-NO-REPO(2 4)
              ELSE
      *       --------------------------------------------------
      *        (SX) (ZX) SET REPO ON HAND (ACCOUNT IN PL STATUS)
      *                  1. ADD TO VOLUME & OUTSTANDING TY-REPO TABLE
      *                     ELEMENT 4 (REPO ON-HAND IN PL STATUS)
      *       --------------------------------------------------
                 ADD HOLD-LP-CURBAL TO TY-AMT-REPO(1 4)
                                       TY-AMT-REPO(2 4)
                 ADD HOLD-LP-OT2BAL TO TY-O2-REPO(1 4)
                                       TY-O2-REPO(2 4)
                 ADD 1 TO TY-NO-REPO(1 4)
                          TY-NO-REPO(2 4).

      *---------------------------------------------------------
      *    (SV) SET PL ACCOUNT INTO REDEEMED REPO STATUS
      *---------------------------------------------------------
           IF HOLD-LP-TRCD = "SV"
      *       --------------------------------------------------
      *       (SV) REVERSAL
      *             1. ADD TO VOLUME & OUTSTANDING TY-REPO TABLE
      *                ELEMENT 4 (REPO ON-HAND IN PL STATUS)
      *             2. REMOVE FROM   TY-REPO REDEEMED
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SV"
                 ADD HOLD-LP-OT2BAL TO TY-O2-REPO(1 4)
                 ADD HOLD-LP-CURBAL TO TY-AMT-REPO(1 4)
                 ADD 1 TO TY-NO-REPO(1 4)
                 SUBTRACT HOLD-LP-OT2BAL FROM TY-O2-REPO(1 2)
                                              TY-O2-REPO(2 2)
                 SUBTRACT HOLD-LP-CURBAL FROM TY-AMT-REPO(1 2)
                                               TY-AMT-REPO(2 2)
                 SUBTRACT 1 FROM TY-NO-REPO(1 2)
                                 TY-NO-REPO(2 2)
              ELSE
      *       --------------------------------------------------
      *        SET (SV)
      *             1. SUBTRACT FROM VOLUME & OUTSTANDING TY-REPO
      *                TABLE ELEMENT 4 (REPO ON-HAND IN PL STATUS)
      *             2. PUT INTO TY-REPO REDEEMED
      *       --------------------------------------------------
                 SUBTRACT HOLD-LP-OT2BAL FROM TY-O2-REPO(1 4)
                 SUBTRACT HOLD-LP-CURBAL FROM TY-AMT-REPO(1 4)
                 SUBTRACT 1 FROM TY-NO-REPO(1 4)
                 ADD HOLD-LP-OT2BAL TO TY-O2-REPO(1 2)
                                        TY-O2-REPO(2 2)
                 ADD HOLD-LP-CURBAL TO TY-AMT-REPO(1 2)
                                        TY-AMT-REPO(2 2)
                 ADD 1 TO TY-NO-REPO(1 2)
                          TY-NO-REPO(2 2).

      *---------------------------------------------------------
      *    (SS) SET PL ACCOUNT INTO SOLD REPO STATUS
      *---------------------------------------------------------
           IF HOLD-LP-TRCD = "SS"
      *       --------------------------------------------------
      *        (SS) REVERSAL
      *             1. INCREASE PL OUTSTANDING
      *             2. PUT BACK INTO TY-REPO PL ONHAND
      *             3. REMOVE FROM TY-REPO PL SOLD
      *       --------------------------------------------------
              IF RV-LP-TRCD = "SS"
                 PERFORM GET-SRCD-SUB
                 SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                        FROM TY-AMT-PL(1 SRCD)
                 ADD ONE TO TY-NO-PL(1 SRCD)
                 COMPUTE TY-O2-REPO(1 4) =
                     TY-O2-REPO(1 4) + HOLD-LP-OT2BAL
                 COMPUTE TY-AMT-REPO(1 4) =
                     TY-AMT-REPO(1 4) + HOLD-LP-CURBAL
                 ADD 1 TO TY-NO-REPO(1 4)
                 SUBTRACT HOLD-LP-APOT2 HOLD-LP-OT2BAL
                                           FROM TY-O2-REPO(1 5)
                                                TY-O2-REPO(2 5)
                 SUBTRACT HOLD-LP-APCUR HOLD-LP-CURBAL
                                           FROM TY-AMT-REPO(1 5)
                                                TY-AMT-REPO(2 5)
                 SUBTRACT 1 FROM TY-NO-REPO(2 5)
                 IF HOLD-LP-CURBAL NOT = 0
                    SUBTRACT 1 FROM TY-NO-REPO(1 5)
                 END-IF
              ELSE
      *       --------------------------------------------------
      *        SET (SS)
      *             1. REDUCE PL OUTSTANDING
      *             2. REMOVE FROM TY-REPO PL ONHAND
      *             3. PUT INTO TY-REPO PL SOLD
      *       --------------------------------------------------
                 PERFORM GET-SRCD-SUB
                 SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                        FROM TY-AMT-PL(1 SRCD)
                 ADD ONE TO TY-NO-PL(1 SRCD)
                 COMPUTE TY-O2-REPO(1 4) =
                     TY-O2-REPO(1 4) - HOLD-LP-APOT2
                                       - HOLD-LP-OT2BAL
                 COMPUTE TY-AMT-REPO(1 4) =
                     TY-AMT-REPO(1 4) - HOLD-LP-APCUR
                                       - HOLD-LP-CURBAL
                 SUBTRACT 1 FROM TY-NO-REPO(1 4)
                 ADD HOLD-LP-OT2BAL TO TY-O2-REPO(1 5)
                                       TY-O2-REPO(2 5)
                 ADD HOLD-LP-CURBAL TO TY-AMT-REPO(1 5)
                                        TY-AMT-REPO(2 5)
                 ADD 1 TO TY-NO-REPO(2 5)
                 IF HOLD-LP-CURBAL NOT = 0
                    ADD 1 TO TY-NO-REPO(1 5).

       UPDATE-TY1-SXSVSS-EXIT.
           PERFORM REWRITE-TY1-FILE.
           PERFORM CLOSE-TY1-FILE.

      ***********************************************************
       UPDATE-TY1-SS SECTION.
      ***********************************************************
           MOVE "UPDATING TODAY'S TOTAL FILE....(SS)....." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           MOVE LN-OWNBR TO BRNO-FOR-TY.
           PERFORM GET-TY1-FILE.

           IF LN-PLCD NOT = " "
              ADD LP-APCUR TO TY-PL-PRINCOL(ORIG-LN-PLSUB)
              ADD LP-APOT2 TO TY-PL-O2COL(ORIG-LN-PLSUB)
              ADD LP-APLC TO TY-PL-LATECOL(ORIG-LN-PLSUB)
              ADD LP-APINT TO TY-PL-INTCOL(ORIG-LN-PLSUB)
              ADD LP-APOTH TO TY-OTHCOL
              GO TO EXIT-UPDATE-TY1-SS.

           ADD LP-APOTH TO TY-OTHCOL.
           ADD LP-APLC TO TY-LATECOL.
           ADD LP-APINT TO TY-INTCOL.

           IF LP-APLC NOT = 0
              ADD NO-RV-ONE TO TY-LATE-NO-COL.
           IF LP-APINT NOT = 0
              ADD NO-RV-ONE TO TY-INT-NO-COL.
           IF LP-APOTH NOT = 0
              ADD NO-RV-ONE TO TY-OTH-NO-COL.

           IF LP-REFNO = "NSF"
              IF BRANCH = LN-OWNBR
                 IF NOT ( (RV-LP-TRCD = "PA") OR
                          (RV-LP-REFNO = "LBOX"  OR "TPAY"
                                      OR "TCOLL" OR "MGRAM")
                        )
                        ADD LP-TRAMT TO TY-CKWRITTEN(5).

           ADD LP-APCUR TO TY-PRINCOL.

       EXIT-UPDATE-TY1-SS.
           PERFORM REWRITE-TY1-FILE.
           PERFORM CLOSE-TY1-FILE.

      ***********************************************************
       UPDATE-DS1-UNEARN-AFTER SECTION.
      ***********************************************************
           IF GP-UNEARNED-STATS NOT = "Y"
              GO TO UPDATE-DS1-UNEARN-AFTER-EXIT.

           MOVE "UPDATING DSFILE UNEARNED TOTALS............."
                                                        TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM OPEN-DS1-FILE.
           MOVE "N" TO REC-EXISTS.
       UPDATE-DS1-UNEARN-AFTER-EXISTS.
           MOVE TRANS-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.
           MOVE DATE-YYYYMM TO DS-DATE-CCYYMM.
           MOVE LN-OWNBR TO DS-BRANCH.
           MOVE LN-DLNO TO DS-DLNO.
           MOVE LN-CLASS TO DS-CLASS.
           MOVE DS1-KEY TO HOLD-DS1-KEY.
           PERFORM READ-DS1-FILE.
           IF IO-FG NOT = 0
              IF REC-EXISTS = "Y"
                 GO TO IO-ERROR
              ELSE
                 PERFORM DS1-CREATE-REC
                 GO TO UPDATE-DS1-UNEARN-AFTER-EXISTS.

           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 6
              ADD NET-UNEARNED-AMT(SUB) TO DS-UNEARNED-AMT(1 DSNET SUB)
           END-PERFORM.

           PERFORM REWRITE-DS1-FILE.
           PERFORM CLOSE-DS1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

       UPDATE-DS1-UNEARN-AFTER-EXIT.
           EXIT.

      ***********************************************************
       UPDATE-TY1-UNEARN-AFTER SECTION.
      ***********************************************************
           IF GP-UNEARNED-STATS NOT = "Y"
              GO TO UPDATE-TY1-UNEARN-AFTER-EXIT.

           MOVE "UPDATING TODAY'S UNEARNED TOTAL FILE............."
                                                             TO MESS.
           PERFORM TEST-SEND-LEGEND.

           MOVE LN-OWNBR TO BRNO-FOR-TY.
           PERFORM GET-TY1-FILE.

           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 6
              ADD NET-UNEARNED-AMT(SUB) TO TY-UNEARNED-AMT(TYNET SUB)
           END-PERFORM.

           PERFORM REWRITE-TY1-FILE.
           PERFORM CLOSE-TY1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

       UPDATE-TY1-UNEARN-AFTER-EXIT.
           EXIT.

      ***********************************************************
       UPDATE-LN1-FILE SECTION.
      ***********************************************************
           MOVE "UPDATING LOAN MASTER FILE..............." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM READ-LN1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

           IF LN-MIP-FG = "Y"
              IF LP-TRCD = "CC"
                 IF LP-REFNO = "CLRE"
                    MOVE " " TO LN-CL-REBATE
                    MOVE HOLD-LXM-MIP-CLPDTH TO LN-MIP-CLPDTH-DATE
                 ELSE
                    MOVE "Y" TO LN-CL-REBATE
                 END-IF
              END-IF
              IF LP-TRCD = "CA"
                 IF LP-REFNO = "AHRE"
                    MOVE " " TO LN-AH-REBATE
                    MOVE HOLD-LXM-MIP-AHPDTH TO LN-MIP-AHPDTH-DATE
                 ELSE
                    MOVE "Y" TO LN-AH-REBATE
                 END-IF
              END-IF
              IF RV-LP-TRCD = "CC"
                 IF RV-LP-REFNO = "CLRE"
                    MOVE "Y" TO LN-CL-REBATE
                 ELSE
                    MOVE " " TO LN-CL-REBATE
                 END-IF
              END-IF
              IF RV-LP-TRCD = "CA"
                 IF RV-LP-REFNO = "AHRE"
                    MOVE "Y" TO LN-AH-REBATE
                 ELSE
                    MOVE " " TO LN-AH-REBATE
                 END-IF
              END-IF
              IF HOLD-LP-TRCD = "CC" OR "CA"
                 PERFORM REWRITE-LN1-FILE
                 PERFORM UPDATE-NOTICE-FILE
                 PERFORM CLOSE-LN1-FILE
                 GO TO UPDATE-LN1-EXIT
              END-IF
           END-IF.

           MOVE LP-OTHBAL TO LN-OTHBAL.
           MOVE LP-OT2BAL TO LN-OT2BAL.
           MOVE LP-LCBAL  TO LN-LCBAL.
           MOVE LP-INTBAL TO LN-INTBAL.
           MOVE LP-CURBAL TO LN-CURBAL.

      *------------------------------------------------------------
      *    UPDATE REAL ESTATE AMORTIZED INTEREST FIELDS
      *    SP-CAL-RATETYPE (Z)

      * FOR BATCH APIPAY PAYMENTS, LP-EXTRA-PRIN-LFP IS REDEFINED
      * AS A TRANSACTION REPAY ID
           IF HOLD-BP-TRCD = " "
              ADD  LP-EXTRA-PRIN-LFP        TO LN-EXTRA-PRIN-LFP.
           MOVE LP-REMAIN-INT-SINCE-LFP  TO LN-REMAIN-INT-SINCE-LFP.
           MOVE LP-REMAIN-PRIN-SINCE-LFP TO LN-REMAIN-PRIN-SINCE-LFP.

      *------------------------------------------------------------
      *    UPDATE MIP INSURANCE FIELDS
    
           IF LN-MIP-FG = "Y"
              IF HOLD-LP-TRCD = "PY" OR "PA" OR "PE" OR "PR"
                             OR "PC" OR "PP" OR "SS" OR "IN"
                             OR "AH" OR "PX" OR "PN" OR "PZ"
                             OR "PO" OR "PB" OR "RN" OR "SC"
                             OR "RB" OR "RO"
              ADD HOLD-LXM-MIP-CLPAID HOLD-LXM-MIP-AHPAID
                                       TO LN-MIP-MTD-CLAHPAID
              ADD HOLD-LXM-MIP-CLPAID  TO LN-MIP-TOT-CLPAID
              ADD HOLD-LXM-MIP-AHPAID  TO LN-MIP-TOT-AHPAID
              IF HOLD-LXM-MIP-CLPDTH NOT = 0
                 MOVE HOLD-LXM-MIP-CLPDTH TO LN-MIP-CLPDTH-DATE
              END-IF
              IF HOLD-LXM-MIP-AHPDTH NOT = 0
                 MOVE HOLD-LXM-MIP-AHPDTH TO LN-MIP-AHPDTH-DATE
              END-IF.

      *------------------------------------------------------------

      *------------------------------------------------------------
      * TEST FOR PARTIAL CHARGE OFF TRANSACTION

           IF HOLD-LP-TRCD = "PX"
              ADD LP-TRAMT TO LN-TOT-PARTIAL-CHGOFF.

      *------------------------------------------------------------
      * TEST FOR REDUCTION IN PL NEWAR:

           MOVE 0 TO HOLD-PL-OTH-AR.
           IF (NOT (LN-PLTYPE = "2" OR "3" OR "4" OR "5"))
                     OR LN-STATE-WORKER = 0
                      OR HOLD-LP-TRCD = "AP"
              GO TO UPDATE-LN1-FILE-TEST-GA.

           IF LP-APCUR > 0
              IF LN-STATE-WORKER > LN-STATE-WORKER2
                 COMPUTE HOLD-PL-OTH-AR =
                     (LN-STATE-WORKER - LN-STATE-WORKER2)
                 IF HOLD-PL-OTH-AR > LP-APCUR
                    MOVE LP-APCUR TO HOLD-PL-OTH-AR.

           IF LP-APCUR < 0
              COMPUTE HOLD-PL-OTH-AR =
                  (LN-STATE-WORKER - LN-STATE-WORKER2)
              IF HOLD-PL-OTH-AR < 0
                 IF HOLD-PL-OTH-AR > LP-APCUR
                    SUBTRACT HOLD-PL-OTH-AR FROM LP-APCUR
                                          GIVING HOLD-PL-OTH-AR
                 ELSE
                    MOVE 0 TO HOLD-PL-OTH-AR
              ELSE
                 ADD LP-APCUR LN-STATE-WORKER2
                                          GIVING HOLD-PL-OTH-AR
                 IF HOLD-PL-OTH-AR < 0
                    SUBTRACT LN-STATE-WORKER2 FROM 0
                                          GIVING HOLD-PL-OTH-AR
                 ELSE
                    MOVE LP-APCUR TO HOLD-PL-OTH-AR.

           ADD LP-APCUR TO LN-STATE-WORKER2.

      ******************************************************
      * UPDATE PAID AHEAD FOR GA ON PAYOFFS:
      ******************************************************

       UPDATE-LN1-FILE-TEST-GA.

           IF SP-SCFRMLA = 12 OR 13 OR 54
              IF LN-CURBAL NOT = 0
                 MOVE 0 TO LN-STATE-WORKER2
              ELSE
                 IF HOLD-PRDELINQAMT > 0
                    MOVE HOLD-PRDELINQAMT TO LN-STATE-WORKER2.

           IF HOLD-LP-TRCD = "SP"
              MOVE LP-REFNO         TO LPWSLP-LP-REFNO
              MOVE LPWSLP-LP-POOLID TO PWA-POOLID
              IF LP-TRCD = "RV"
                 MOVE 0 TO LPWSLP-LP-POOLID PWA-POOLID
                 MOVE LPWSLP-LP-REFNO TO LP-REFNO
              END-IF
              MOVE LP-PRIOR-POOLID  TO PWA-PRIOR-POOLID
              MOVE LPWSLP-LP-POOLID TO LN-DLPOOL.

           IF HOLD-LP-TRCD = "DC"
              MOVE HOLD-NEW-1ST-DUE TO LN-1STPYDATE
           ELSE
              IF AD-POSTING
                 MOVE HOLD-NEW-1ST-DUE TO LN-TOTNOALDEL.

      ******************************************************
      *  DETERMINE THE NO OF ALLOWABLE DELINQUENCIES TAKEN:
      ******************************************************
           IF AD-POSTING
              IF HOLD-LP-TRCD = "AD"
                 MOVE 1 TO AD-NOALDEL
              ELSE
                 MOVE TRCD-NUM TO AD-NOALDEL.

           IF LP-TRCD = "RV"
              MULTIPLY -1 BY AD-NOALDEL.
           ADD AD-NOALDEL TO LN-YTDNOALDEL.

      * REDUCE PURBAL:
           IF LN-SERVACCT NOT = "Y"
              SUBTRACT LP-APCUR TOTAL-REB-AMOUNTS
                                            FROM LN-PURBAL.

           IF HOLD-LP-TRCD = "AP" OR "O2"
              MOVE 0 TO LP-APCUR.

           ADD LP-INTPAID TO LN-YTDINTPD LN-TOTINTPD.

           COMPUTE LN-NONACRERN = LN-NONACRERN
                       + (HOLD-LN-ACCERN(1) - LN-ACCERN(1))
                        + (HOLD-LN-ACCERN(2) - LN-ACCERN(2))
                         + (HOLD-LN-ACCERN(3) - LN-ACCERN(3))
                           + (HOLD-LN-ACCERN(5) - LN-ACCERN(5)).
           IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                         GP-INCL-OTH-IN-EARNED-R)
              COMPUTE LN-NONACRERN = LN-NONACRERN
                            + (HOLD-LN-ACCERN(6) - LN-ACCERN(6)).

           IF NOT (GP-INCL-OTH-IN-EARNED-R)
              COMPUTE LN-NONACRERN = LN-NONACRERN
                            + (HOLD-LN-ACCERN(4) - LN-ACCERN(4)).

           MOVE HOLD-LN-ACCERN(1) TO LN-ACCERN(1).
           MOVE HOLD-LN-ACCERN(2) TO LN-ACCERN(2).
           MOVE HOLD-LN-ACCERN(3) TO LN-ACCERN(3).
           MOVE HOLD-LN-ACCERN(4) TO LN-ACCERN(4).
           MOVE HOLD-LN-ACCERN(5) TO LN-ACCERN(5).
           MOVE HOLD-LN-ACCERN(6) TO LN-ACCERN(6).
           MOVE HOLD-LN-TOTERN TO LN-TOTERN.

           IF LP-TRCD = "JD"
              MOVE HOLD-LN-JDRATE TO LN-JDRATE
           ELSE
           IF LP-TRCD = "IR"
              MOVE HOLD-LN-JDRATE TO LN-REDURATE
           ELSE
           IF LP-TRCD = "AC"
              MOVE HOLD-LN-JDRATE TO LN-ACCRATE.

           MOVE HOLD-LN-TOTSERACCT TO LN-TOTSERACCT.
           MOVE HOLD-LN-TOTINT TO LN-TOTINT.
           MOVE HOLD-LN-TOTDFMNTS TO LN-TOTDEF.
           MOVE HOLD-LN-TOTLCHG TO LN-TOTLCHG.
           ADD LP-NOLCHG TO LN-TOTNOLCHG.

      **************************************************
      *    UPDATE PAYMENTS MTD
      **************************************************
           IF DF-POSTING OR
              (HOLD-LP-TRCD = "PY" OR "PO" OR "PA"
                           OR "PR" OR "PC" OR "PP" OR "IN"
                           OR "PE" OR "SS" OR "Z2"
                           OR "AH" OR "PN" OR "PZ")
              ADD LP-APCUR TO LN-MTD-PRIN
              ADD LP-APLC TO LN-MTD-LC
              ADD LP-APINT TO LN-MTD-INT
              ADD LP-APOTH TO LN-MTD-OT.
           IF HOLD-LP-TRCD = "PE" OR "SS" OR "Z2" OR "IN"
              ADD LP-TRAMT TO LN-MTD-EX.

      **************************************************
      *    UPDATE CONTRACTUAL PAYMENTS TODATE
      *              LN-TOTPAYMNTD
      *              LN-MTD-PAYS-RECDEL
      *              LN-PY-YYYYMM-RECDEL
      **************************************************
           MOVE LN-MTD-PAYS-RECDEL TO ORIG-LN-MTD-PAYS-RECDEL.
           IF ( DF-POSTING ) OR
              ( HOLD-LP-TRCD = "PY" OR "PO" OR "PA" OR "PR" OR "PC"
                                    OR "PP" OR "AH" OR "PN" OR "PZ"
              )
                   IF NOT (DF-POSTING AND
                          (SP-DEFFRMLA = 97 OR 96 OR 95 OR 99))
                   ADD LP-APCUR TO LN-TOTPAYMNTD
                   IF SP-CAL-RATETYPE(1) = "Z" AND HOLD-BP-TRCD = " "
                      SUBTRACT LP-EXTRA-PRIN-LFP FROM LN-TOTPAYMNTD
                   END-IF
                END-IF
                IF HOLD-LP-TRCD NOT = "PZ"
                   ADD LP-APCUR TO LN-MTD-PAYS-RECDEL
                END-IF
                IF (SP-CONTRFRMLA = "A") AND
                   (SP-CAL-RATETYPE(1) NOT = "Z")
                   ADD LP-APLC TO LN-TOTPAYMNTD
                END-IF
                IF (SP-BANKRULE = "D") OR
                   (SP-BANKRULE = "F") OR
                   (SP-RECPAYCD = "A")
                   IF HOLD-LP-TRCD NOT = "PZ"
                      ADD LP-APLC TO LN-MTD-PAYS-RECDEL.

           IF (LN-ESCROW-FG = "Y" OR LN-ESCROW-FG = "I")
              IF HOLD-LP-TRCD = "PY" OR "PA"
                 ADD LP-APPLIED-TO-ESCROW TO LN-TOTPAYMNTD
                                             LN-MTD-PAYS-RECDEL.

           IF HOLD-LP-TRCD = "PY" OR "PO" OR "PA" OR "PR" OR "PC"
                                  OR "PP" OR "AH" OR "PN" OR "PZ"
              ADD LP-APINT TO LN-TOTPAYMNTD
              IF HOLD-LP-TRCD NOT = "PZ"
                 ADD LP-APINT TO LN-MTD-PAYS-RECDEL.

      *-------------------------------------------------
      *    TEST FOR PAYMENT BEING MADE AFTER A PREVIOUS
      *    REVERSAL THIS MONTH, IF SO;
      *       WHEN THAT REVERSAL IS FULLY REAPPLIED,
      *       THIS MONTH ADVANCE LN-PY-YYYYMM-RECDEL
      *-------------------------------------------------
           IF ( ORIG-LN-MTD-PAYS-RECDEL < 0 ) AND
                (GP-RECDEL-REVERSAL-FG NOT = "N")
              IF NOT (LP-TRCD = "RV")
                 IF HOLD-LP-TRCD = "PY" OR "PO" OR "PA" OR "PR" OR "PC"
                                        OR "PP" OR "AH" OR "PN"
                    IF LN-MTD-PAYS-RECDEL NOT < 0
                       MOVE LP-REC TO WK-LP-REC
                       PERFORM RESET-FULLPY-YYYYMM-RV
                       MOVE WK-LP-REC TO LP-REC
                       MOVE FOUND-LN-PY-YYYYMM-RECDEL
                               TO LN-PY-YYYYMM-RECDEL.

      *-------------------------------------------------
      *    TEST FOR REVERSAL THIS MONTH, IF SO;
      *       CLEAR LN-PY-YYYYMM-RECDEL, WHICH WILL BE RESET
      *       TO ITS CORRECT VALUE AFTER LOAN IS UPDATED
      *-------------------------------------------------
           IF LP-TRCD = "RV"
              IF HOLD-LP-TRCD = "PY" OR "PO" OR "PA" OR "PR" OR "PC"
                                     OR "PP" OR "AH" OR "PN"
                 IF LN-MTD-PAYS-RECDEL < 0
                    MOVE 0 TO LN-PY-YYYYMM-RECDEL
                    IF GP-RECDEL-REVERSAL-FG = "N"
                       MOVE 0 TO LN-MTD-PAYS-RECDEL.


      **************************************************
      *    UPDATE NON CONTRACTUAL PAYMENTS TODATE:
      **************************************************
           IF HOLD-LP-TRCD = "PE" OR "SS" OR "Z2" OR "IN"
              ADD LP-TRAMT TO LN-TOTEXCPAYMNTD.
           IF (DF-POSTING AND (SP-DEFFRMLA = 97 OR 96 OR 95))
              ADD LP-APCUR TO LN-TOTEXCPAYMNTD.
      *    - - ADD REAL ESTATE "Z" EXTRA PRINCIPAL
           IF SP-CAL-RATETYPE(1) = "Z"
              IF HOLD-BP-TRCD = " "
                 ADD LP-EXTRA-PRIN-LFP TO LN-TOTEXCPAYMNTD.

      **************************************************
      *   SET PAYOFF INFO:
      **************************************************
           IF ONE = -1
              MOVE HOLD-POCD    TO LN-POCD
              MOVE LP-PAYDATE   TO LN-POFFDATE
              MOVE HOLD-LP-TRCD TO LN-PO-TRCD
              MOVE LP-TRDATE    TO LN-PROMDATE2
           ELSE
              IF RV-LP-TRCD NOT = "OV"
                 MOVE LN-POCD TO HOLD-POCD
                 MOVE " " TO LN-POCD
                             LN-PO-TRCD
                 MOVE 0 TO LN-POFFDATE
                 IF ONE = +1
                    MOVE 0 TO LN-PROMDATE2.

      **************************************************
      *    DETERMINE THE NO OF DEFERMENTS TAKEN:
      **************************************************
           IF DF-POSTING
              IF HOLD-LP-TRCD = "DF"
                 MOVE 1 TO DEF-NODEF DEF-NODEFACT
              ELSE
                 MOVE 1 TO DEF-NODEFACT
                 MOVE TRCD-NUM TO DEF-NODEF
           ELSE
              MOVE 0 TO DEF-NODEF.

           IF LP-TRCD = "RV"
              MOVE -1 TO SUB
              MULTIPLY -1 BY DEF-NODEF
              MULTIPLY -1 BY DEF-NODEFACT
           ELSE
              MOVE 1 TO SUB.

      * INCREMENT DEFERMENT COUNT AND EXPIRATION DATE:
           IF DF-POSTING
              ADD DEF-NODEF TO LN-TOTNODEF LN-YTDNODEF
              ADD DEF-NODEFACT TO LN-TOTNODEFACT LN-YTDNODEFACT
              PERFORM EXPIRATION-DATE-CALCULATION.

      **************************************************
      *    NOTE:
      *     CODES FOR LN-CL-REBATE   LN-O1-REBATE
      *               LN-AH-REBATE   LN-O2-REBATE
      *               LN-PP-REBATE   LN-O3-REBATE
      *
      *     SP - NO REBATE OR CANCEL
      *      Y - REBATE OR CANCEL
      *
      *     REBATE NOT ALLOWED AFTER CANCEL.
      *     CANCEL NOT ALLOWED AFTER REBATE.
      **************************************************
           IF RV-LP-TRCD = "RC" OR "CC"
                    OR (INS-RB-TBL(1) = "Y" AND RV-LP-TRCD NOT = " ")
              MOVE " " TO LN-CL-REBATE
           ELSE
           IF LP-TRCD = "RC" OR "CC"
                    OR (INS-RB-TBL(1) = "Y" AND RV-LP-TRCD = " ")
              MOVE "Y" TO LN-CL-REBATE.

           IF RV-LP-TRCD = "RA" OR "CA"
                    OR (INS-RB-TBL(2) = "Y" AND RV-LP-TRCD NOT = " ")
              MOVE " " TO LN-AH-REBATE
           ELSE
           IF LP-TRCD = "RA" OR "CA"
                    OR (INS-RB-TBL(2) = "Y" AND RV-LP-TRCD = " ")
              MOVE "Y" TO LN-AH-REBATE.

           IF RV-LP-TRCD = "RP" OR "CP"
                    OR (INS-RB-TBL(3) = "Y" AND RV-LP-TRCD NOT = " ")
              MOVE " " TO LN-PP-REBATE
           ELSE
           IF LP-TRCD = "RP" OR "CP"
                    OR (INS-RB-TBL(3) = "Y" AND RV-LP-TRCD = " ")
              MOVE "Y" TO LN-PP-REBATE.

           IF RV-LP-TRCD = "R1" OR "C1"
                    OR (INS-RB-TBL(4) = "Y" AND RV-LP-TRCD NOT = " ")
              MOVE " " TO LN-O1-REBATE
           ELSE
           IF LP-TRCD = "R1" OR "C1"
                    OR (INS-RB-TBL(4) = "Y" AND RV-LP-TRCD = " ")
              MOVE "Y" TO LN-O1-REBATE.

           IF RV-LP-TRCD = "R2" OR "C2"
                    OR (INS-RB-TBL(5) = "Y" AND RV-LP-TRCD NOT = " ")
              MOVE " " TO LN-O2-REBATE
           ELSE
           IF LP-TRCD = "R2" OR "C2"
                    OR (INS-RB-TBL(5) = "Y" AND RV-LP-TRCD = " ")
              MOVE "Y" TO LN-O2-REBATE.

           IF RV-LP-TRCD = "R3" OR "C3"
                    OR (INS-RB-TBL(6) = "Y" AND RV-LP-TRCD NOT = " ")
              MOVE " " TO LN-O3-REBATE
           ELSE
           IF LP-TRCD = "R3" OR "C3"
                    OR (INS-RB-TBL(6) = "Y" AND RV-LP-TRCD = " ")
              MOVE "Y" TO LN-O3-REBATE.

      ********************************************
      *    NOTE:
      *     CODES FOR LN-INT-REBATE
      *
      *     SP - NO REBATE OR CANCEL
      *      C - CANCEL
      *      Y - REBATE NO CANCEL
      *      R - REBATE AFTER CANCEL
      *
      *     REBATE ALLOWED AFTER CANCEL
      *     CANCEL NOT ALLOWED AFTER REBATE
      ********************************************
           IF LP-TRCD = "CI"
              MOVE "C" TO LN-INT-REBATE
           ELSE
              IF LP-TRCD = "RI" OR REB-AMOUNT(4) > 0
                 IF LN-INT-REBATE = " "
                    MOVE "Y" TO LN-INT-REBATE
                 ELSE
                    MOVE "R" TO LN-INT-REBATE.
           IF RV-LP-TRCD = "CI"
              MOVE " " TO LN-INT-REBATE
           ELSE
              IF RV-LP-TRCD = "RI" OR REB-AMOUNT(4) < 0
                 IF LN-INT-REBATE = "Y"
                    MOVE " " TO LN-INT-REBATE
                 ELSE
                    MOVE "C" TO LN-INT-REBATE.

           IF LP-TRCD = "CS"
              MOVE "C" TO LN-SC-REBATE
           ELSE
              IF LP-TRCD = "RS" OR REB-AMOUNT(5) > 0
                 IF LN-SC-REBATE = " "
                    MOVE "Y" TO LN-SC-REBATE
                 ELSE
                    MOVE "R" TO LN-SC-REBATE.
           IF RV-LP-TRCD = "CS"
              MOVE " " TO LN-SC-REBATE
           ELSE
              IF RV-LP-TRCD = "RS" OR REB-AMOUNT(5) < 0
                 IF LN-SC-REBATE = "Y"
                    MOVE " " TO LN-SC-REBATE
                 ELSE
                    MOVE "C" TO LN-SC-REBATE.

           IF LP-TRCD = "CM"
              MOVE "C" TO LN-MF-REBATE
           ELSE
              IF LP-TRCD = "RM" OR REB-AMOUNT(6) > 0
                 IF LN-MF-REBATE = " "
                    MOVE "Y" TO LN-MF-REBATE
                 ELSE
                    MOVE "R" TO LN-MF-REBATE.
           IF RV-LP-TRCD = "CM"
              MOVE " " TO LN-MF-REBATE
           ELSE
              IF RV-LP-TRCD = "RM" OR REB-AMOUNT(6) < 0
                 IF LN-MF-REBATE = "Y"
                    MOVE " " TO LN-MF-REBATE
                 ELSE
                    MOVE "C" TO LN-MF-REBATE.

           IF LP-TRCD = "CD"
              MOVE "C" TO LN-DF-REBATE
           ELSE
              IF LP-TRCD = "RD" OR REB-AMOUNT(7) > 0
                 IF LN-DF-REBATE = " "
                    MOVE "Y" TO LN-DF-REBATE
                 ELSE
                    MOVE "R" TO LN-DF-REBATE.
           IF RV-LP-TRCD = "CD"
              MOVE " " TO LN-DF-REBATE
           ELSE
              IF RV-LP-TRCD = "RD" OR REB-AMOUNT(7) < 0
                 IF LN-DF-REBATE = "Y"
                    MOVE " " TO LN-DF-REBATE
                 ELSE
                    MOVE "C" TO LN-DF-REBATE.


      ***********************************************************
      *    UPDATE LOAN STATUS FLAGS:
      ***********************************************************
           SET STFG TO 1.
           SEARCH LN-STATUSFLAGS
              AT END PERFORM PREPARE-TO-SHIFT
              WHEN (LN-STATUSFLAGS(STFG) = " " AND
                    (LP-TRCD = "SX" OR "ZX")
                   )
                    MOVE "X" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (LN-STATUSFLAGS(STFG) = "X" AND LP-TRCD = "SV")
                    MOVE "V" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (LN-STATUSFLAGS(STFG) = "X" AND LP-TRCD = "SS")
                    MOVE "S" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (LN-STATUSFLAGS(STFG) = " " AND LP-TRCD = "JD")
                    MOVE "J" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (LN-STATUSFLAGS(STFG) = " " AND LP-TRCD = "AC")
                    MOVE "A" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (LN-STATUSFLAGS(STFG) = " " AND LP-TRCD = "IR")
                    MOVE "R" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (LN-STATUSFLAGS(STFG) = " " AND LP-TRCD = "BK")
                    MOVE "B" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN ( (
                      (LN-STATUSFLAGS(STFG) = " ")
                       OR (LN-STATUSFLAGS(STFG) = "P" OR "2" OR "3"
                                                      OR "4" OR "5")
                        OR (LN-STATUSFLAGS(STFG) = "I")
                         OR (LN-STATUSFLAGS(STFG) = "W")
                     )
                      AND (LP-TRCD = "PL" OR "P2" OR "P3"
                                          OR "P4" OR "P5")
                   )
                    IF NOT (TRCD-PLTYPE = "2" OR "3" OR "4" OR "5")
                       MOVE "P" TO LN-STATUSFLAGS(STFG)
                       GO TO OUT-OF-SEARCH
                    ELSE
                       MOVE TRCD-PLTYPE TO LN-STATUSFLAGS(STFG)
                       GO TO OUT-OF-SEARCH
                    END-IF
              WHEN ( (
                      (LN-STATUSFLAGS(STFG) = " ")
                        OR (LN-STATUSFLAGS(STFG) = "P" OR "2" OR "3"
                                                        OR "4" OR "5")
                         OR (LN-STATUSFLAGS(STFG) = "I")
                          OR (LN-STATUSFLAGS(STFG) = "W")
                     )
                        AND (LP-TRCD = "PI")
                   )
                    MOVE "I" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN ( (
                       (LN-STATUSFLAGS(STFG) = " ")
                         OR (LN-STATUSFLAGS(STFG) = "P" OR "2" OR "3"
                                                        OR "4" OR "5")
                          OR (LN-STATUSFLAGS(STFG) = "I")
                           OR (LN-STATUSFLAGS(STFG) = "W")
                     )
                         AND (LP-TRCD = "PW")
                    )
                    MOVE "W" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (LN-STATUSFLAGS(STFG) = "V" AND RV-LP-TRCD = "SV")
                    MOVE "X" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (LN-STATUSFLAGS(STFG) = "S" AND RV-LP-TRCD = "SS")
                    MOVE "X" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (LN-STATUSFLAGS(STFG) = "J" AND RV-LP-TRCD = "JD") OR
                   (LN-STATUSFLAGS(STFG) = "R" AND RV-LP-TRCD = "IR") OR
                   (LN-STATUSFLAGS(STFG) = "X" AND
                    (RV-LP-TRCD = "SX" OR "ZX")                     ) OR
                   (LN-STATUSFLAGS(STFG) = "A" AND RV-LP-TRCD = "AC") OR
                   (LN-STATUSFLAGS(STFG) = "B" AND RV-LP-TRCD = "BK") OR
                   (LN-STATUSFLAGS(STFG) = "B" AND LP-TRCD = "BD")
                    MOVE " " TO LN-STATUSFLAGS(STFG)
                    GO TO SHIFT-STATUS
              WHEN (LN-STATUSFLAGS(STFG) = "I" AND RV-LP-TRCD = "PI")
                    MOVE "P" TO LN-STATUSFLAGS(STFG)
                    IF LN-PLTYPE = "2" OR "3" OR "4" OR "5"
                       MOVE LN-PLTYPE TO LN-STATUSFLAGS(STFG)
                    END-IF
                    GO TO OUT-OF-SEARCH
      * REVERSING A "BD" (REMOVE BANKRUPT), PUT BACK TO BANKRUPT
              WHEN (LN-STATUSFLAGS(STFG) = " " AND RV-LP-TRCD = "BD")
                    MOVE "B" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (LN-STATUSFLAGS(STFG) = "W" AND RV-LP-TRCD = "PW")
                    MOVE "I" TO LN-STATUSFLAGS(STFG)
                    GO TO OUT-OF-SEARCH
              WHEN (
                     (LN-STATUSFLAGS(STFG) = "P" OR "2" OR "3"
                                                 OR "4" OR "5")
                        AND (RV-PL-POSTING)
                    )
                    MOVE " " TO LN-STATUSFLAGS(STFG).

       SHIFT-STATUS.
           IF STFG < 10
              IF LN-STATUSFLAGS(STFG + 1) = " "
                 GO OUT-OF-SEARCH
              ELSE
                 MOVE LN-STATUSFLAGS(STFG + 1) TO LN-STATUSFLAGS(STFG)
                 MOVE " " TO LN-STATUSFLAGS(STFG + 1)
                 SET STFG UP BY 1
                 GO TO SHIFT-STATUS.

       OUT-OF-SEARCH.

      ****************************************************
      *    UPDATE PROMISED INFORMATION:
      *    UPDATE LAST PAYMENT INFORMATION:
      *    UPDATE INTEREST ASSESSED THRU:
      ****************************************************
           IF LP-TRCD = "PY" OR "PA" OR "PO" OR "PE" OR "RN"
                             OR "SC" OR "PB" OR "RB" OR "RO"
                             OR "DF" OR "D2" OR "D3" OR "D4"
                             OR "D5" OR "D6" OR "D7" OR "D8"
                             OR "D9" OR "AI" OR "CI" OR "IR"
                             OR "PR" OR "PC" OR "PP" OR "Z2"
                             OR "SS" OR "AH" OR "PN" OR "PZ"
                             OR "IN"
              PERFORM CHECK-FOR-EXPIRATION
              PERFORM UPDATE-PROMISED-INFO
              IF SP-CAL-RATETYPE(1) = "Z"
                 MOVE 0 TO LN-INTPDTH-DATE
              ELSE
      * 10/20/98 OR LN-INTPDTH-DATE = 0 (ON NEW LOANS)
                 IF (LP-PAYDATE > LN-INTPDTH-DATE) OR
                                        LN-INTPDTH-DATE = 0
                    MOVE LP-PAYDATE TO LN-INTPDTH-DATE
                 END-IF
              END-IF
              IF NOT (LP-TRCD = "AI" OR "CI" OR "IR" OR "PZ")
                 MOVE LP-PAYDATE TO LN-DATE-PAID-LAST
                 MOVE LP-TRAMT   TO LN-AMT-PAID-LAST.

           IF LP-TRCD = "PY" OR "PA"
              MOVE LP-PAYDATE TO LN-LAST-PYPA-DATE.

      ***************************************************
      *    UPDATE INSURANCE REBATES OR CANCELS:
      ***************************************************
           IF RV-LP-TRCD = "CC"
              PERFORM OPEN-IC1-FILE
              MOVE LN-INSCOMP(1) TO IC-CODE
              PERFORM READ-IC1-FILE
           ELSE
           IF RV-LP-TRCD = "CA"
              PERFORM OPEN-IC1-FILE
              MOVE LN-INSCOMP(2) TO IC-CODE
              PERFORM READ-IC1-FILE
           ELSE
           IF RV-LP-TRCD = "CP"
              PERFORM OPEN-IC1-FILE
              MOVE LN-INSCOMP(3) TO IC-CODE
              PERFORM READ-IC1-FILE
           ELSE
           IF RV-LP-TRCD = "C1"
              PERFORM OPEN-IC1-FILE
              MOVE LN-INSCOMP(4) TO IC-CODE
              PERFORM READ-IC1-FILE
           ELSE
           IF RV-LP-TRCD = "C2"
              PERFORM OPEN-IC1-FILE
              MOVE LN-INSCOMP(5) TO IC-CODE
              PERFORM READ-IC1-FILE
           ELSE
           IF RV-LP-TRCD = "C3"
              PERFORM OPEN-IC1-FILE
              MOVE LN-INSCOMP(6) TO IC-CODE
              PERFORM READ-IC1-FILE.

           IF (RV-LP-TRCD = "CC" OR "CA" OR "CP"
                               OR "C1" OR "C2" OR "C3")
                     AND IO-FG NOT = 0
               GO TO IO-ERROR.
           PERFORM CLOSE-IC1-FILE.

           IF RV-LP-TRCD = "CC"
              IF LN-INSPREM(1) = 0
                 COMPUTE LN-INSPREM(1) = LP-TRAMT * (-1)
                 IF (LN-INSURED = "S" OR "M") AND LN-INSTYPES-DL
                     IF IC-COMMRATE(1) >= 0
                        COMPUTE LN-INSCOMM(1) =
                            (LN-INSPREM(1) * IC-COMMRATE(1)) / 100
                     ELSE
                        COMPUTE LN-INSCOMM(1) = IC-COMMRATE(1) * -1
                     END-IF
                 ELSE
                 IF LN-INSURED = "J" AND LN-INSTYPES-DL
                    IF IC-COMMRATE(2) >= 0
                       COMPUTE LN-INSCOMM(1) =
                            (LN-INSPREM(1) * IC-COMMRATE(2)) / 100
                    ELSE
                       COMPUTE LN-INSCOMM(1) = IC-COMMRATE(2) * -1
                    END-IF
                 ELSE
                 IF (LN-INSURED = "S" OR "M") AND LN-INSTYPES-LL
                     IF IC-COMMRATE(3) >= 0
                        COMPUTE LN-INSCOMM(1) =
                            (LN-INSPREM(1) * IC-COMMRATE(3)) / 100
                     ELSE
                        COMPUTE LN-INSCOMM(1) = IC-COMMRATE(3) * -1
                     END-IF
                 ELSE
                 IF LN-INSURED = "J" AND LN-INSTYPES-LL
                    IF IC-COMMRATE(4) >= 0
                       COMPUTE LN-INSCOMM(1) =
                            (LN-INSPREM(1) * IC-COMMRATE(4)) / 100
                    ELSE
                       COMPUTE LN-INSCOMM(1) = IC-COMMRATE(4) * -1
                    END-IF
                 ELSE
                    NEXT SENTENCE
              ELSE
                 COMPUTE WK-COMMISSION =
                             (LN-INSCOMM(1) * 1000) / LN-INSPREM(1)
                 COMPUTE WK-COMMISSION = WK-COMMISSION * LP-TRAMT
                 COMPUTE LN-INSCOMM(1) =
                             (WK-COMMISSION / 1000) + LN-INSCOMM(1)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(1)
           ELSE
           IF HOLD-LP-TRCD = "CC"
              IF LP-TRAMT NOT < LN-INSPREM(1)
                 MOVE 0 TO LN-INSCOMM(1)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(1)
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LP-TRAMT * 1000) / LN-INSPREM(1)
                 COMPUTE WK-COMMISSION =
                            (1000 -  WK-COMMISSION) * LN-INSCOMM(1)
                 COMPUTE LN-INSCOMM(1) =  WK-COMMISSION / 1000
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(1).

           IF RV-LP-TRCD = "CA"
              IF LN-INSPREM(2) = 0
                 COMPUTE LN-INSPREM(2) = LP-TRAMT * (-1)
                 IF IC-COMMRATE(5) >= 0
                    COMPUTE LN-INSCOMM(2) =
                               (LN-INSPREM(2) * IC-COMMRATE(5)) / 100
                 ELSE
                    COMPUTE LN-INSCOMM(2) = IC-COMMRATE(5) * -1
                 END-IF
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LN-INSCOMM(2) * 1000) / LN-INSPREM(2)
                 COMPUTE WK-COMMISSION = WK-COMMISSION * LP-TRAMT
                 COMPUTE LN-INSCOMM(2) =
                            (WK-COMMISSION / 1000) + LN-INSCOMM(2)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(2)
           ELSE
           IF HOLD-LP-TRCD = "CA"
              IF LP-TRAMT NOT < LN-INSPREM(2)
                 MOVE 0 TO LN-INSCOMM(2)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(2)
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LP-TRAMT * 1000) / LN-INSPREM(2)
                 COMPUTE WK-COMMISSION =
                            (1000 -  WK-COMMISSION) * LN-INSCOMM(2)
                 COMPUTE LN-INSCOMM(2) =  WK-COMMISSION / 1000
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(2).

           IF RV-LP-TRCD = "CP"
              IF LN-INSPREM(3) = 0
                 COMPUTE LN-INSPREM(3) = LP-TRAMT * (-1)
                 IF LN-INSTYPES-PP2
                    IF IC-COMMRATE(7) >= 0
                       COMPUTE LN-INSCOMM(3) =
                               (LN-INSPREM(3) * IC-COMMRATE(7)) / 100
                    ELSE
                       COMPUTE LN-INSCOMM(3) = IC-COMMRATE(7) * -1
                    END-IF
                 ELSE
                    IF IC-COMMRATE(6) >= 0
                       COMPUTE LN-INSCOMM(3) =
                               (LN-INSPREM(3) * IC-COMMRATE(6)) / 100
                    ELSE
                       COMPUTE LN-INSCOMM(3) = IC-COMMRATE(6) * -1
                    END-IF
                 END-IF
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LN-INSCOMM(3) * 1000) / LN-INSPREM(3)
                 COMPUTE WK-COMMISSION = WK-COMMISSION * LP-TRAMT
                 COMPUTE LN-INSCOMM(3) =
                            (WK-COMMISSION / 1000) + LN-INSCOMM(3)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(3)
           ELSE
           IF HOLD-LP-TRCD = "CP"
              IF LP-TRAMT NOT < LN-INSPREM(3)
                 MOVE 0 TO LN-INSCOMM(3)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(3)
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LP-TRAMT * 1000) / LN-INSPREM(3)
                 COMPUTE WK-COMMISSION =
                            (1000 -  WK-COMMISSION) * LN-INSCOMM(3)
                 COMPUTE LN-INSCOMM(3) =  WK-COMMISSION / 1000
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(3).

           IF RV-LP-TRCD = "C1"
              IF LN-INSPREM(4) = 0
                 COMPUTE LN-INSPREM(4) = LP-TRAMT * (-1)
                 IF IC-COMMRATE(8) >= 0
                    COMPUTE LN-INSCOMM(4) =
                            (LN-INSPREM(4) * IC-COMMRATE(8)) / 100
                 ELSE
                    COMPUTE LN-INSCOMM(4) = IC-COMMRATE(8) * -1
                 END-IF
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LN-INSCOMM(4) * 1000) / LN-INSPREM(4)
                 COMPUTE WK-COMMISSION = WK-COMMISSION * LP-TRAMT
                 COMPUTE LN-INSCOMM(4) =
                            (WK-COMMISSION / 1000) + LN-INSCOMM(4)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(4)
           ELSE
           IF HOLD-LP-TRCD = "C1"
              IF LP-TRAMT NOT < LN-INSPREM(4)
                 MOVE 0 TO LN-INSCOMM(4)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(4)
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LP-TRAMT * 1000) / LN-INSPREM(4)
                 COMPUTE WK-COMMISSION =
                            (1000 -  WK-COMMISSION) * LN-INSCOMM(4)
                 COMPUTE LN-INSCOMM(4) =  WK-COMMISSION / 1000
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(4).

           IF RV-LP-TRCD = "C2"
              IF LN-INSPREM(5) = 0
                 COMPUTE LN-INSPREM(5) = LP-TRAMT * (-1)
                 IF IC-COMMRATE(9) >= 0
                    COMPUTE LN-INSCOMM(5) =
                               (LN-INSPREM(5) * IC-COMMRATE(9)) / 100
                 ELSE
                    COMPUTE LN-INSCOMM(5) = IC-COMMRATE(9) * -1
                 END-IF
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LN-INSCOMM(5) * 1000) / LN-INSPREM(5)
                 COMPUTE WK-COMMISSION = WK-COMMISSION * LP-TRAMT
                 COMPUTE LN-INSCOMM(5) =
                            (WK-COMMISSION / 1000) + LN-INSCOMM(5)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(5)
           ELSE
           IF HOLD-LP-TRCD = "C2"
              IF LP-TRAMT NOT < LN-INSPREM(5)
                 MOVE 0 TO LN-INSCOMM(5)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(5)
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LP-TRAMT * 1000) / LN-INSPREM(5)
                 COMPUTE WK-COMMISSION =
                            (1000 -  WK-COMMISSION) * LN-INSCOMM(5)
                 COMPUTE LN-INSCOMM(5) =  WK-COMMISSION / 1000
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(5).

           IF RV-LP-TRCD = "C3"
              IF LN-INSPREM(6) = 0
                 COMPUTE LN-INSPREM(6) = LP-TRAMT * (-1)
                 IF IC-COMMRATE(10) >= 0
                    COMPUTE LN-INSCOMM(6) =
                               (LN-INSPREM(6) * IC-COMMRATE(10)) / 100
                 ELSE
                    COMPUTE LN-INSCOMM(6) = IC-COMMRATE(10) * -1
                 END-IF
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LN-INSCOMM(6) * 1000) / LN-INSPREM(6)
                 COMPUTE WK-COMMISSION = WK-COMMISSION * LP-TRAMT
                 COMPUTE LN-INSCOMM(6) =
                            (WK-COMMISSION / 1000) + LN-INSCOMM(6)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(6)
           ELSE
           IF HOLD-LP-TRCD = "C3"
              IF LP-TRAMT NOT < LN-INSPREM(6)
                 MOVE 0 TO LN-INSCOMM(6)
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(6)
              ELSE
                 COMPUTE WK-COMMISSION =
                            (LP-TRAMT * 1000) / LN-INSPREM(6)
                 COMPUTE WK-COMMISSION =
                            (1000 -  WK-COMMISSION) * LN-INSCOMM(6)
                 COMPUTE LN-INSCOMM(6) =  WK-COMMISSION / 1000
                 SUBTRACT LP-TRAMT FROM LN-INSPREM(6).


           IF NOT (HOLD-LP-TRCD = "RI" OR "RS" OR "RM")
              IF REB-AMOUNT(4) = 0
                 IF REB-AMOUNT(5) = 0
                    IF REB-AMOUNT(6) = 0
                       GO TO UPDATE-LN1-DLPARVHELD.

      *********************************************************
      *    TEST FOR FINCHG REBATE FOR SERV ACCT AND/OR P&L
      *********************************************************
           IF LN-SERVACCT NOT = "Y"
              IF LN-PLCD = " "
                 GO TO UPDATE-LN1-OURS.

      *****************************************
      *    TEST FOR INTEREST REBATE
      *****************************************
           IF HOLD-LP-TRCD = "RI"
              SUBTRACT ADDON-INT-REBATE FROM LP-TRAMT
                                              GIVING WORKER
              SUBTRACT WORKER FROM LN-ANTICERN(1)
              ADD WORKER TO LN-ANTICADJ(1)
              SUBTRACT ADDON-INT-REBATE FROM LN-ANTICERN(2)
              ADD ADDON-INT-REBATE TO LN-ANTICADJ(2)
           ELSE
              IF REB-AMOUNT(4) NOT = 0
                 SUBTRACT REB-AMOUNT(4) FROM LN-ANTICERN(1)
                 ADD REB-AMOUNT(4) TO LN-ANTICADJ(1).

      *****************************************
      *    TEST FOR SERV CHG REBATE
      *****************************************
           IF HOLD-LP-TRCD = "RS"
              SUBTRACT LP-TRAMT FROM LN-ANTICERN(3)
              ADD LP-TRAMT TO LN-ANTICADJ(3)
           ELSE
              IF REB-AMOUNT(5) NOT = 0
                 SUBTRACT REB-AMOUNT(5) FROM LN-ANTICERN(3)
                 ADD REB-AMOUNT(5) TO LN-ANTICADJ(3).

      *****************************************
      *    TEST FOR MAINT. FEE REBATE
      *****************************************
           IF HOLD-LP-TRCD = "RM"
              SUBTRACT LP-TRAMT FROM LN-ANTICERN(4)
              ADD LP-TRAMT TO LN-ANTICADJ(4)
           ELSE
              IF REB-AMOUNT(6) NOT = 0
                 SUBTRACT REB-AMOUNT(6) FROM LN-ANTICERN(4)
                 ADD REB-AMOUNT(6) TO LN-ANTICADJ(4).

           GO TO UPDATE-LN1-DLPARVHELD.

      *********************************************************
      *    TEST FOR FINCHG REBATES ON OUR RECEIVABLES
      *********************************************************
      *------------------------------------------
      *    TEST FOR INTEREST, ETC  REBATES
      *------------------------------------------
       UPDATE-LN1-OURS.
           IF HOLD-LP-TRCD = "RI"
                        OR REB-AMOUNT(4) NOT = 0
              IF LP-TRCD NOT = "RV"
                 PERFORM GET-SPLIT-OF-EARNINGS
              ELSE
                 ADD LN-ANTICADJ(1) TO LN-ANTICERN(1)
                                       WK-TP-WORKAMT(1)
                 ADD LN-ANTICADJ(2) TO LN-ANTICERN(2)
                                       WK-TP-WORKAMT(2)
                 MULTIPLY -1 BY WK-TP-WORKAMT(1)
                 MULTIPLY -1 BY WK-TP-WORKAMT(2)
                 MOVE 0 TO LN-ANTICADJ(1) LN-ANTICADJ(2)
                 IF SP-RBFRMLA(7) = "D" OR "F"
                    ADD LN-ANTICADJ(3) TO LN-ANTICERN(3)
                                          WK-TP-WORKAMT(3)
                    MULTIPLY -1 BY WK-TP-WORKAMT(3)
                    MOVE 0 TO LN-ANTICADJ(3).

      *-----------------------------------------
      *    TEST FOR SERV CHG REBATE
      *-----------------------------------------
           IF HOLD-LP-TRCD = "RS"
              SUBTRACT LP-TRAMT FROM LN-ANTICERN(3)
              ADD LP-TRAMT TO LN-ANTICADJ(3) WK-TP-WORKAMT(3)
           ELSE
              IF REB-AMOUNT(5) NOT = 0
                 SUBTRACT REB-AMOUNT(5) FROM LN-ANTICERN(3)
                 ADD REB-AMOUNT(5) TO LN-ANTICADJ(3) WK-TP-WORKAMT(3).

      *-----------------------------------------
      *    TEST FOR MAINT. FEE REBATE
      *-----------------------------------------
           IF HOLD-LP-TRCD = "RM"
              SUBTRACT LP-TRAMT FROM LN-ANTICERN(4)
              ADD LP-TRAMT TO LN-ANTICADJ(4) WK-TP-WORKAMT(4)
           ELSE
              IF REB-AMOUNT(6) NOT = 0
                 SUBTRACT REB-AMOUNT(6) FROM LN-ANTICERN(4)
                 ADD REB-AMOUNT(6) TO LN-ANTICADJ(4) WK-TP-WORKAMT(4).

       UPDATE-LN1-DLPARVHELD.

      ***********************************************************
      *    UPDATE DEALER PARTICIPATION:
      *    FOR PC ACCOUNTS, NOT SERVICED
      *           ONLY 'CI' OR 'RI' MAY HAVE A VALUE.
      *    FOR IB ACCOUNTS, NOT SERVICED
      *           ONLY 'PO' OR 'SC' MAY HAVE A VALUE.
      *    FOR A PAYOFF WITH AN AUTO 'RI'
      *           THE HOLD FIELD MAY HAVE A VALUE.
      ***********************************************************
           IF LN-SERVACCT NOT = "Y"
                           AND LN-PLCD = " "
              IF LP-IBPC = "P"
                 IF HOLD-LP-TRCD = "CI" OR "RI"
                    SUBTRACT LP-DLRVCHGS-ADJ(1) FROM LN-DLRVCHGS(1)
                    SUBTRACT LP-DLRVCHGS-ADJ(2) FROM LN-DLRVCHGS(2)
                    SUBTRACT LP-DLRVCHGS-ADJ(3) FROM LN-DLRVCHGS(3)
                    SUBTRACT LP-DLPARVHELD-ADJ FROM LN-DLPARVHELD
                    SUBTRACT LP-DLPARVPAID-ADJ FROM LN-DLPARVPAID
                 ELSE
      * AUTO REBATE
                 IF HOLD-LP-TRCD = "PO" OR "SC"
                    SUBTRACT HOLD-DLRVCHGS-ADJ(1) FROM LN-DLRVCHGS(1)
                    SUBTRACT HOLD-DLRVCHGS-ADJ(2) FROM LN-DLRVCHGS(2)
                    SUBTRACT HOLD-DLRVCHGS-ADJ(3) FROM LN-DLRVCHGS(3)
                    SUBTRACT HOLD-DLPARVHELD-ADJ FROM LN-DLPARVHELD
                    SUBTRACT HOLD-DLPARVPAID-ADJ FROM LN-DLPARVPAID.

           IF LN-SERVACCT NOT = "Y"
                           AND LN-PLCD = " "
              IF LP-IBPC = "I"
                 IF HOLD-LP-TRCD = "PO" OR "SC"
                    SUBTRACT LP-DLRVCHGS-ADJ(1) FROM LN-DLRVCHGS(1)
                    SUBTRACT LP-DLRVCHGS-ADJ(2) FROM LN-DLRVCHGS(2)
                    SUBTRACT LP-DLRVCHGS-ADJ(3) FROM LN-DLRVCHGS(3)
                    SUBTRACT LP-DLPARVHELD-ADJ FROM LN-DLPARVHELD
                    SUBTRACT LP-DLPARVPAID-ADJ FROM LN-DLPARVPAID.

      * UPDATE LATE  CHARGE PAID  THRU:
           MOVE LP-LCPDTH-DATE TO LN-LCPDTH-DATE.

      * UPDATE JUDGEMENT FIELDS:
           IF LP-TRCD = "JD"
              MOVE "J" TO LN-STATUSFG
              MOVE LP-PAYDATE TO LN-JDDATE
           ELSE
              IF RV-LP-TRCD = "JD"
                 MOVE LP-STATUSFG TO LN-STATUSFG
                 MOVE 0 TO LN-JDDATE.

      * UPDATE ACCCELERATION FIELDS:
           IF LP-TRCD = "AC"
              MOVE LP-PAYDATE TO LN-ACCELDATE
              MOVE "A" TO LN-STATUSFG
           ELSE
              IF RV-LP-TRCD = "AC"
                 MOVE LP-STATUSFG TO LN-STATUSFG
                 MOVE 0 TO LN-ACCELDATE.

      * UPDATE INTEREST RATE CHANGED FIELDS:
           IF LP-TRCD = "IR"
              MOVE LP-PAYDATE TO LN-REDUDATE
              MOVE "R" TO LN-STATUSFG
           ELSE
              IF RV-LP-TRCD = "IR"
                 MOVE LP-STATUSFG TO LN-STATUSFG
                 MOVE 0 TO LN-REDUDATE.

           IF PL-POSTING
              IF RV-PL-POSTING
                 MOVE " " TO LN-PLCD
                             LN-PLTYPE
                             LN-PLREASON
                 MOVE 0 TO LN-PLDATE
                           LN-PLAMT
              ELSE
                 MOVE "P" TO LN-PLCD
                             LN-PLTYPE
                 MOVE HOLD-PLREASON TO LN-PLREASON
                 MOVE LP-PAYDATE TO LN-PLDATE
                 MOVE LN-CURBAL TO LN-PLAMT
                 IF TRCD-PLTYPE NOT = "L"
                    MOVE TRCD-PLTYPE TO LN-PLTYPE
                    MOVE 0 TO LN-STATE-WORKER
                              LN-STATE-WORKER2.

      * TEST FOR UNSET OF BANKRUPT:
           IF RV-LP-TRCD = "BK" OR LP-TRCD = "BD"
              MOVE LN-BNKRPTDATE TO HOLD-BNKRPTDATE
              MOVE 0 TO LN-BNKRPTDATE CHG-BNKRPTDATE
              MOVE 0 TO LN-BNKRPT-CHAPTER
              PERFORM CHECK-GP-BK-FLAG-UNSET
              IF LP-TRCD = "BD"
                 MOVE LP-PAYDATE TO LN-BNKRPT-DISMISS-DATE
                 PERFORM FIND-BNKRPT-TRAILER
              END-IF
      * DOES NOT DELETE THE TRAILER IF "BD"
              PERFORM DELETE-BNKRPT-TRAILER
              PERFORM CREATE-CHANGE-REC
           ELSE
      * TEST FOR SET OF BANKRUPT:
           IF LP-TRCD = "BK"
              MOVE LP-PAYDATE TO LN-BNKRPTDATE CHG-BNKRPTDATE
              MOVE LP-REFNO         TO LPWSLP-LP-REFNO
              MOVE LPWSLP-LP-POOLID TO LN-BNKRPT-CHAPTER
              MOVE 0 TO LN-BNKRPT-DISMISS-DATE
              IF GP-BK-FLAG-CONFIDENTIAL = "Y" OR "L"
                 MOVE "Y" TO LN-CONFIDENTCD
              END-IF
              PERFORM UPDATE-BNKRPT-TRAILER
              MOVE 0 TO HOLD-BNKRPTDATE
              PERFORM CREATE-CHANGE-REC
           ELSE
      * PUT BACK INTO BANKRUPT STATUS
           IF RV-LP-TRCD = "BD"
              PERFORM FIND-BNKRPT-TRAILER
              IF IO-FG = 0
                 MOVE LTB-FILEDATE TO LN-BNKRPTDATE CHG-BNKRPTDATE
                 MOVE LTB-CHAPTER  TO LN-BNKRPT-CHAPTER
                 MOVE 0            TO LN-BNKRPT-DISMISS-DATE
                 MOVE 0            TO HOLD-BNKRPTDATE
                 IF GP-BK-FLAG-CONFIDENTIAL = "Y" OR "L"
                    MOVE "Y" TO LN-CONFIDENTCD
                 END-IF
                 PERFORM CREATE-CHANGE-REC.

      * TEST FOR SET REPO:
           IF RV-LP-TRCD = "SX" OR "ZX"
              MOVE " " TO LN-REPOCD
              MOVE "Y" TO LN-INTERIM-TRW
              MOVE 0 TO LN-REPODATE
              PERFORM UPDATE-REPO-TRAILER
           ELSE
           IF LP-TRCD = "SX" OR "ZX"
              MOVE "X" TO LN-REPOCD
              MOVE "Y" TO LN-INTERIM-TRW
              MOVE LP-TRDATE TO LN-REPODATE
              PERFORM UPDATE-REPO-TRAILER
              IF GP-REPODATE-PAYDATE = "Y"
                 MOVE LP-PAYDATE TO LN-REPODATE.

      * TEST FOR SET REDEEMED REPO:
           IF RV-LP-TRCD = "SV"
              PERFORM UPDATE-REPO-TRAILER
              MOVE "X" TO LN-REPOCD
              MOVE "Y" TO LN-INTERIM-TRW
              MOVE 0 TO LN-REDEEMDATE
           ELSE
           IF LP-TRCD = "SV"
              PERFORM UPDATE-REPO-TRAILER
              MOVE "V" TO LN-REPOCD
              MOVE "Y" TO LN-INTERIM-TRW
              MOVE LP-TRDATE TO LN-REDEEMDATE
              IF GP-REPODATE-PAYDATE = "Y"
                 MOVE LP-PAYDATE TO LN-REDEEMDATE.

      * TEST FOR SET REPO SOLD:
           IF RV-LP-TRCD = "SS"
              MOVE "X" TO LN-REPOCD
              MOVE 0 TO LN-SOLDDATE
              PERFORM UPDATE-REPO-TRAILER
           ELSE
           IF LP-TRCD = "SS"
              MOVE "S" TO LN-REPOCD
              MOVE LP-TRDATE TO LN-SOLDDATE
              PERFORM UPDATE-REPO-TRAILER
              IF GP-REPODATE-PAYDATE = "Y"
                 MOVE LP-PAYDATE TO LN-SOLDDATE.

           IF HOLD-LP-TRCD = "RE"
              PERFORM UPDATE-REPO-TRAILER.

           IF LN-REPO-ONHAND OR LN-REPO-SOLD
              IF HOLD-LP-TRCD = "RC" OR "RA" OR "RP" OR "R1" OR "R2" OR
                  "R3" OR "RI" OR "RS" OR "RM" OR "RD" OR "PE"
                        OR "IN"
                 PERFORM UPDATE-REPO-TRAILER.

           IF HOLD-LP-TRCD = "SE"
              ADD LP-TRAMT TO LN-STATE-WORKER.

           IF LP-TRCD = "PI"
              MOVE "I" TO LN-PLCD
            ELSE
              IF RV-LP-TRCD = "PI"
                 MOVE "P" TO LN-PLCD.

           IF LP-TRCD = "PW"
              MOVE "W" TO LN-PLCD
            ELSE
              IF RV-LP-TRCD = "PW"
                 MOVE "I" TO LN-PLCD.

      *    UPDATE LATE CHARGE WAIVERS IF 'WL'
      *
           IF HOLD-LP-TRCD = "WL"
              ADD LP-APLC TO LN-LCWAIVERS.
           IF HOLD-LP-TRCD = "WI"
              ADD LP-APINT TO LN-INTWAIVERS.


           IF DF-POSTING OR
              (
               NOT (HOLD-LP-TRCD = "PY" OR "PA" OR "AL"
                                OR "PO" OR "PB" OR "SC"
                                OR "RN" OR "RB" OR "RO"
                                OR "PE" OR "Z2" OR "PR"
                                OR "PC" OR "PP" OR "SS"
                                OR "AH" OR "PN" OR "PZ"
                                OR "IN"
                   )
              )
              GO TO UPDATE-LN1-CONT.

      **************************************************************

      * IF LATE CHARGE FORMULA 'A', UPDATE LN-LCPARTIALS FROM
      *    CALCULATION IN LONPF(N).
      * USE LP-LCPARTIALS TO HOLD ORIGINAL LOAN VALUE IN CASE OF REVERSE:

           IF SP-LCFRMLA ="A"
              IF LP-TRCD NOT = "RV"
                 MOVE LN-LCPARTIALS TO LP-LCPARTIALS
                 MOVE HOLD-PARTIALS TO LN-LCPARTIALS
              ELSE
      * LONPF8 MULTIPLIES LP-LCPARTIALS BY -1 , NEEDS TO BE +:
      *          COMPUTE LN-LCPARTIALS = LP-LCPARTIALS * -1.
      * NOTE: LP-LCPARTIALS IS POSITIVE, DON'T NEED TO CHANGE SIGN
                 MOVE LP-LCPARTIALS TO LN-LCPARTIALS.

      **************************************************************
      * IF LATE CHARGE FORMULA 'J' OR 'K', UPDATE LATE CHARGES PAID
      * WHEN THE ACCOUNT IS DELINQUENT, OTHERWISE CLEAR LN-LCPAID:

           IF SP-LCFRMLA = "J" OR "K"
              IF LP-TRCD = "RV"
                 MOVE HOLD-LCPAID TO LN-LCPAID
              ELSE
                 MOVE LN-1STPYDATE TO CEPP1-DATE
                 MOVE LP-PAYDATE TO CEPP2-DATE
                 MOVE SP-CONTPDTH TO HOLD-CONTPDTH
                 MOVE 100 TO SP-CONTPDTH
                 PERFORM CONTRACTUAL-DELINQUENCY
                 MOVE HOLD-CONTPDTH TO SP-CONTPDTH
                 MOVE LN-LCPAID TO LP-LCPAID
                 IF CDEL-ARREARAGE NOT < 0
                    MOVE 0 TO LN-LCPAID
                 ELSE
                    ADD LP-APLC TO LN-LCPAID.

      **************************************************************
      *    UPDATE CURRENT PAYMENT DUE AMOUNT    ( LCPARTIALS )
      *      "    CURRENT PAYMENT DATE MMDD.YY  ( LCPAID     )
      *    SAVE ORIGINAL LCPARTIALS INTO LP-LCPARTIALS
      *      "  ORIGINAL LCPAID INTO LP-LCPAID
      **************************************************************

      * UCCC
      * CAN'T TAKE LATE CHARGE ON MONIES PAID WITHIN GRACE DAYS OF DUE DAY

           IF SP-LCFRMLA = "F" OR "H" OR "I" OR "L" OR "M" OR "S" OR "T"
              IF LP-TRCD NOT = "RV"
                 MOVE LN-LCPARTIALS TO LP-LCPARTIALS
                 MOVE LN-LCPAID TO LP-LCPAID
                 MOVE HOLD-PARTIALS TO LN-LCPARTIALS
                 MOVE HOLD-LCPAID TO LN-LCPAID
              ELSE
                 MOVE HOLD-PARTIALS TO LN-LCPARTIALS
                 MOVE HOLD-LCPAID TO LN-LCPAID.

       UPDATE-LN1-CONT.
           MOVE LN-DLRECOURSE TO HOLD-LN-DLRECOURSE.
           IF LN-SERVACCT NOT = "Y"
              IF NOT PL-POSTING
                 IF LN-PLCD = " "
                   IF ONE = 0
                     IF LN-DLPARTRCAMT NOT = 0
      * DL-RECOURSE-FRMLA = "A" FAIRCO
                       IF NOT (LN-DLRECOURSE = "P" OR " ")
                          MOVE LN-1STPYDATE TO PDTH-DATE-WORK
                          PERFORM PAID-THRU-CALCULATION
                          IF PDTH-PAYMENTS < LN-DLPARTRCAMT
                             MOVE "F" TO LN-DLRECOURSE
                          ELSE
                             MOVE "N" TO LN-DLRECOURSE.

           IF RV-LP-TRCD = " "
              IF SP-ERNFRMLA(1) = 15
                 PERFORM SET-ERNFRMLA-15-EARN
              ELSE
                 IF SP-ERNFRMLA(5) = 16
                    PERFORM SET-ERNFRMLA-16-EARN.

           IF CHANGE-ESCROW-FG = "Y"
              IF LN-ESCROW-FG = "I"
                 MOVE
                 "THERE IS ESCROW SCHEDULED; ESCROW FLAG CHANGED TO 'Y'"
                      TO MESS
                 PERFORM CONDITIONAL-SEND-MESS
                 MOVE "Y" TO LN-ESCROW-FG
                 PERFORM CREATE-ESCROW-MEMO.

           IF HOLD-ALT-PREPAY-FG = "Y"
              MOVE "ALT" TO LN-LPO 
           ELSE
           IF HOLD-ALT-PREPAY-FG = "R"
              MOVE SPACES TO LN-LPO.
              
           MOVE " " TO LN-BI-FG.

           PERFORM REWRITE-LN1-FILE.
           PERFORM CLOSE-LN1-FILE.

           PERFORM UPDATE-NOTICE-FILE.

           IF HOLD-LN-DLRECOURSE = LN-DLRECOURSE
              GO TO UPDATE-LN1-EXIT.

           PERFORM OPEN-DS1-FILE.
           MOVE "N" TO REC-EXISTS.

       UPDATE-DS-LN1-EXISTS.
           MOVE TRANS-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.
           MOVE DATE-YYYYMM TO DS-DATE-CCYYMM.
           MOVE LN-OWNBR    TO DS-BRANCH.
           MOVE LN-DLNO     TO DS-DLNO.
           MOVE LN-CLASS    TO DS-CLASS.
           MOVE DS1-KEY TO HOLD-DS1-KEY.
           PERFORM READ-DS1-FILE.
           IF IO-FG NOT = 0
              IF REC-EXISTS = "Y"
                 GO TO IO-ERROR
              ELSE
                 PERFORM DS1-CREATE-REC
                 GO TO UPDATE-DS-LN1-EXISTS.

           IF HOLD-LN-DLRECOURSE = "F"
              SUBTRACT 1 FROM DS-RCOURSE-UNITS(1)
              SUBTRACT LN-CURBAL FROM DS-RCOURSE-AMT(1)
              ADD 1 TO DS-RCOURSE-UNITS(3)
              ADD LN-CURBAL TO DS-RCOURSE-AMT(3)
           ELSE
              ADD 1 TO DS-RCOURSE-UNITS(1)
              ADD LN-CURBAL TO DS-RCOURSE-AMT(1)
              SUBTRACT 1 FROM DS-RCOURSE-UNITS(3)
              SUBTRACT LN-CURBAL FROM DS-RCOURSE-AMT(3).
           PERFORM REWRITE-DS1-FILE.
           PERFORM CLOSE-DS1-FILE.

       UPDATE-LN1-EXIT.
           EXIT.

      ************************************
       CREATE-FM-REC SECTION.
      ************************************

           PERFORM OPEN-FM1-FILE.

           MOVE SPACES             TO LPWSFM-EDIT-FM-INITKEY.
           MOVE LN-ACCTNO          TO LPWSFM-EDIT-FM-ACCTNO.
           MOVE SP-PRFORM(4)       TO LPWSFM-EDIT-FM-FORMNO.

           MOVE FM-PATH-OWNBR          TO FM-BRNO.
           MOVE LPWSFM-EDIT-FM-INITKEY TO FM-INITKEY.
           MOVE SP-PRFORM(4)           TO FM-FMNO.

           MOVE FM1-KEY TO HOLD-FM1-KEY.

           PERFORM READ-FM1-FILE.

      * EXISTS ? RESET ZIP, PRINT, BRNO; NO ? CREATE.

           PERFORM CLEAR-FM-FILE.

           MOVE HOLD-FM1-KEY  TO FM1-KEY.

           MOVE HOLD-BW-ZIP        TO FM-ZIP.
           MOVE " "                TO FM-PRINT.
      * USE FM-STMT-COUNTER TO HOLD THE SUB OF WHICH BORROWER MADE
      * THE PAYMENT FOR THE RECEIPT PRINT
           MOVE BW-SUB             TO FM-STMT-COUNTER.
           MOVE TRANS-DATE         TO FM-TRDATE.
           MOVE EXT-CONAME-USER-ID TO FM-USERID.

           IF IO-FG = 0
              PERFORM REWRITE-FM1-FILE
           ELSE
              MOVE HOLD-FM1-KEY TO FM1-KEY
              PERFORM WRITE-FM1-FILE
              IF IO-FG NOT = 0
                 GO TO IO-ERROR.

           PERFORM CLOSE-FM1-FILE.

      ******************************************************
       SET-ERNFRMLA-15-EARN SECTION.
      ******************************************************

      * SET ERNFRMLA 15 EARN FIELDS
      * WORKERS ARE NOT ADJUSTED ON PAYOFFS
           IF ONE = 0
              IF HOLD-LP-TRCD = "PY" OR "PA" OR "PR" OR "PC" OR "PP"
                                     OR "PE" OR "SS" OR "Z2" OR "IN"
                                     OR "RT" OR "ET" OR "LP"
                                     OR "NP" OR "ST" OR "AH"
                                     OR "PN" OR "PZ"
                 MOVE LP-PAYDATE TO LN-ERN-IB-PDTH-DATE
                 COMPUTE LN-ERN-IB-PRINBAL = LN-ERN-IB-PRINBAL
                              - (SAVE-LP-APCUR - HOLD-EARNINGS-IB)
                 MOVE HOLD-EARNINGS-IB-OWING TO LN-ERN-IB-INTOWE.

      ******************************************************
       SET-ERNFRMLA-16-EARN SECTION.
      ******************************************************

      * SET ERNFRMLA 16 EARN FIELDS
      * WORKERS ARE NOT ADJUSTED ON PAYOFFS

           IF ONE = 0
              IF HOLD-LP-TRCD = "PY" OR "PA" OR "PR" OR "PC" OR "PP"
                                     OR "PE" OR "SS" OR "Z2" OR "IN"
                                     OR "RT" OR "ET" OR "LP"
                                     OR "NP" OR "ST" OR "AH"
                                     OR "PN" OR "PZ"
                 MOVE LP-PAYDATE TO LN-ERN-IB-PDTH-DATE
                 MOVE HOLD-EARNINGS-IB-OWING TO LN-ERN-IB-INTOWE
                 IF HOLD-EARNINGS-IB-OWING = 0
                    COMPUTE LN-ERN-IB-PRINBAL = LN-ERN-IB-PRINBAL
                       - (SAVE-LP-APCUR - HOLD-EARNINGS-IB-ERNINT).

      ******************************************************
       UPDATE-NEXT-REV-MMYY SECTION.
      ******************************************************
           IF LN-PY-YYYYMM-RECDEL = 0
              IF ( (GP-RECDEL-REVERSAL-FG = "N")
                    AND (LN-MTD-PAYS-RECDEL = 0) )
                   OR
                 ( (GP-RECDEL-REVERSAL-FG NOT = "N")
                    AND (LN-MTD-PAYS-RECDEL < 0) )
                 IF ( LP-TRCD = "PY" OR "PO" OR "PA" OR "PR" OR "PC"
                                     OR "PP" OR "AH" OR "PN"
                    )
                      OR
                    ( LP-TRCD = "BF" AND LP-REFNO = "BAL F" )
                      PERFORM TEST-FULLPY-YYYYMM-SET.

      ******************************************************
       TEST-FULLPY-YYYYMM-SET SECTION.
      ******************************************************
           IF FOUND-LN-PY-YYYYMM-RECDEL NOT = 0
              GO TO TEST-FULLPY-YYYYMM-SET-EXIT.

           MOVE LP-TRDATE TO NDTE-DATE.

           IF SP-BANKRULE = "D" OR SP-BANKRULE = "F"
              IF LP-TRDATE < 19970101
                 IF NDTE-DD NOT < 26
                    MOVE 1 TO NDTE-HOLD
                    PERFORM INCREMENT-MONTHS.

           MOVE NDTE-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.

           IF DATE-YYYYMM NOT = FOUND-LN-PY-YYYYMM-RECDEL-WK
              MOVE DATE-YYYYMM TO FOUND-LN-PY-YYYYMM-RECDEL-WK
              MOVE 0 TO SAVE-LN-MTD-PAYS-RECDEL.

           ADD LP-APCUR LP-APINT TO SAVE-LN-MTD-PAYS-RECDEL.
           IF (SP-BANKRULE = "D") OR
              (SP-BANKRULE = "F") OR
              (SP-RECPAYCD = "A")
              ADD LP-APLC TO SAVE-LN-MTD-PAYS-RECDEL.

           IF NOT SP-RECFRMLA-PERCNT-PMT
              MOVE LN-REGPYAMT TO AGEING-WORK
           ELSE
              IF SP-RECPDTH = 0
                 MOVE .01 TO AGEING-WORK
              ELSE
                 COMPUTE AGEING-WORK ROUNDED =
                      LN-REGPYAMT * SP-RECPDTH * .01.

           IF SAVE-LN-MTD-PAYS-RECDEL >= AGEING-WORK
              MOVE FOUND-LN-PY-YYYYMM-RECDEL-WK
                       TO FOUND-LN-PY-YYYYMM-RECDEL.

       TEST-FULLPY-YYYYMM-SET-EXIT.
           EXIT.

      **************************************************************
       RESET-FULLPY-YYYYMM-RV SECTION.
      **************************************************************

      * RESET LAST MONTH OF A FULL PAYMENT  (LN-PYMMYY-RECDEL)
      * WHEN A PAYMENT IS APPLIED AFTER
      * A REVERSAL THIS MONTH
           PERFORM OPEN-LP1-FILE.

           MOVE LP-PATH-OWNBR TO LP-BRNO
                                 QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO.
           MOVE LN-ACCTNO     TO LP-ACCTNO
                                 QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           MOVE 99999         TO LP-SEQNO
                                 QLP1-WEND-SEQNO.
           MOVE ALL "0"       TO QLP1-WBEG-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.
       RESET-FULLPY-YYYYMM-RV-NEXT.
           PERFORM READ-LP1-FILE-PREVIOUS.
           IF IO-FG NOT = 0 OR (LP-BRNO NOT = LP-PATH-OWNBR)
                             OR (LP-ACCTNO NOT = LN-ACCTNO)
      * SHOULD NEVER,NEVER HAPPEN; WILL ALWAYS FIND A SEQNO = 1
      *  ON FOLLOWING STATEMENT
              GO TO END-RESET-FULLPYMMYY-RV.

           IF NOT (
                    (LP-TRCD = "PY" OR "PO" OR "PA" OR "PR" OR "PC"
                                    OR "PP" OR "AH" OR "PN")
                         OR
                           (LP-TRCD = "BF" AND LP-REFNO = "BAL F")
                  )
      *       UNLOCK LP-FILE
              GO TO RESET-FULLPY-YYYYMM-RV-NEXT.

      * SKIP TRANSACTIONS POSTED THIS MONTH:

           MOVE LP-TRDATE TO NDTE-DATE.

           IF SP-BANKRULE = "D" OR SP-BANKRULE = "F"
              IF LP-TRDATE < 19970101
                 IF NDTE-DD NOT < 26
                    MOVE 1 TO NDTE-HOLD
                    PERFORM INCREMENT-MONTHS.
           MOVE 1 TO NDTE-DD.
           MOVE NDTE-DATE TO NUM-DATE.

           MOVE TRANS-DATE TO NDTE-DATE.
           MOVE 1          TO NDTE-DD.

           IF NDTE-DATE = NUM-DATE
      *       UNLOCK LP-FILE
              GO TO RESET-FULLPY-YYYYMM-RV-NEXT.
      * -------------------------------------------------

           PERFORM TEST-FULLPY-YYYYMM-SET.
           IF FOUND-LN-PY-YYYYMM-RECDEL = 0
                         OR LP-SEQNO = 1
      *       UNLOCK LP-FILE
              GO TO RESET-FULLPY-YYYYMM-RV-NEXT.

       END-RESET-FULLPYMMYY-RV.
           PERFORM CLOSE-LP1-FILE.


      *************************************************
       SETUP-PAYOFF-REC SECTION.
      *************************************************
           IF LP-TRCD = "RV"
              MOVE REB-TYPE(SUB) TO LP-REFNO
           ELSE
              MOVE REB-TYPE(SUB) TO LP-TRCD.
           IF CONV-REV-FLAG NOT = "Y"
              MOVE TP-TRCD-TAB(SUB) TO LP-REVTRCD
              MOVE TP-REVSEQNO-TAB(SUB) TO LP-REVSEQNO.
           MOVE REB-AMOUNT(SUB) TO LP-TRAMT LP-APCUR.
           MOVE 0 TO LP-EARNED(1) LP-EARNED(2) LP-EARNED(3)
                     LP-DLRVCHGS-ADJ(1) LP-DLRVCHGS-ADJ(2)
                     LP-DLRVCHGS-ADJ(3)
                     LP-DLPARVHELD-ADJ LP-DLPARVPAID-ADJ
                     LP-APLC LP-LCBAL LP-APOTH LP-APOT2
                     LP-APINT LP-OTHBAL LP-OT2BAL LP-INTBAL
                     LP-INTDUE LP-DLPROC LP-APINTOWE LP-INTPAID
                     LP-NEWSTAT-RATE LP-LCPARTIALS LP-LCPAID
                     LP-PREPAY-PENALTY.
           SUBTRACT LP-APCUR FROM LP-CURBAL.
           MOVE " " TO LP-REV.
           IF REB-TYPE(SUB) = "RI"
              MOVE HOLD-DLRVCHGS-ADJ(1) TO LP-DLRVCHGS-ADJ(1)
              MOVE HOLD-DLRVCHGS-ADJ(2) TO LP-DLRVCHGS-ADJ(2)
              MOVE HOLD-DLRVCHGS-ADJ(3) TO LP-DLRVCHGS-ADJ(3)
              MOVE HOLD-DLPARVHELD-ADJ TO LP-DLPARVHELD-ADJ
              MOVE HOLD-DLPARVPAID-ADJ TO LP-DLPARVPAID-ADJ
              IF SP-RBREDUC(7) = 9999.01
      * MOVE MS-PENALTY TO LPPFBUF
      *          CALL FLDVAL USING STAT MS-LIST MS-BUF
                 MOVE MS-PENALTY TO LP-LCPAID.
                 
      *    IF PAYOFF OR REBATE OF SVC CHG
      *    THEN CHECK TO SEE IF THERE WAS A GEORGIA 4% CLOSING
      *    FEE EARLY PROVISION, IF THERE IS THEN WRITE A TRAILER RECORD. 
      *    CHECK FOR SPACES AND FOR DEF VALUE OF 5389762.88 IN CASE 
      *    PROGRAMS GET COPIED IN WITHOUT THE FULL CHANGE.      
             IF REB-TYPE(SUB) = "RS"
                 IF ( HOLD-LXR-REB-AMT NOT = 0
                                   AND NOT = 2020202.02
                                   AND NOT = 0202020.20
                                   AND NOT = 5389762.88 )
                    MOVE LP-BRNO   TO LX-BRNO 
                    MOVE LP-ACCTNO TO LX-ACCTNO
                    MOVE LP-SEQNO  TO LX-SEQNO
                    PERFORM OPEN-LX1-FILE
                    PERFORM READ-LX1-FILE
                    IF IO-FG = 0
                       MOVE "R"              TO LXR-CODE
                       MOVE HOLD-LXR-REB-AMT TO LXR-REB-AMT
                       PERFORM REWRITE-LX1-FILE
                       PERFORM CLOSE-LX1-FILE
                    ELSE
                       PERFORM CLEAR-LX-FILE
                       MOVE LP-BRNO          TO LX-BRNO 
                       MOVE LP-ACCTNO        TO LX-ACCTNO
                       MOVE LP-SEQNO         TO LX-SEQNO
                       MOVE "R"              TO LXR-CODE
                       MOVE HOLD-LXR-REB-AMT TO LXR-REB-AMT
                       PERFORM WRITE-LX1-FILE
                       PERFORM CLOSE-LX1-FILE.

      * UPDATE INSURANCE SALES TAX REBATE
      
           IF BR-FORCE-VALID-CITY-COUNTY NOT = "Y"
              MOVE 0 TO LP-PRORATED-INS-REB
           ELSE
              IF (LP-TRCD = "RC" OR "CC") OR
                 (LP-TRCD = "RV" AND (LP-REFNO = "RC" OR "CC"))
                 MOVE HOLD-INS-TAX-RB(1) TO LP-PRORATED-INS-REB
              ELSE
              IF (LP-TRCD = "RA" OR "CA") OR
                 (LP-TRCD = "RV" AND (LP-REFNO = "RA" OR "CA"))
                 MOVE HOLD-INS-TAX-RB(2) TO LP-PRORATED-INS-REB
              ELSE
              IF (LP-TRCD = "RP" OR "CP") OR
                 (LP-TRCD = "RV" AND (LP-REFNO = "RP" OR "CP"))
                 MOVE HOLD-INS-TAX-RB(3) TO LP-PRORATED-INS-REB
              ELSE
              IF (LP-TRCD = "R1" OR "C1") OR
                 (LP-TRCD = "RV" AND (LP-REFNO = "R1" OR "C1"))
                 MOVE HOLD-INS-TAX-RB(4) TO LP-PRORATED-INS-REB
              ELSE
              IF (LP-TRCD = "R2" OR "C2") OR
                 (LP-TRCD = "RV" AND (LP-REFNO = "R2" OR "C2"))
                 MOVE HOLD-INS-TAX-RB(5) TO LP-PRORATED-INS-REB
              ELSE
              IF (LP-TRCD = "R3" OR "C3") OR
                 (LP-TRCD = "RV" AND (LP-REFNO = "R3" OR "C3"))
                 MOVE HOLD-INS-TAX-RB(6) TO LP-PRORATED-INS-REB
              ELSE
              IF (LP-TRCD = "R4" OR "C4") OR
                 (LP-TRCD = "RV" AND (LP-REFNO = "R4" OR "C4"))
                 MOVE HOLD-INS-TAX-RB(7) TO LP-PRORATED-INS-REB
              ELSE
              IF (LP-TRCD = "R5" OR "C5") OR
                 (LP-TRCD = "RV" AND (LP-REFNO = "R5" OR "C5"))
                 MOVE HOLD-INS-TAX-RB(8) TO LP-PRORATED-INS-REB.

      *************************************
       UPDATE-TR1-FILE SECTION.
      *************************************

           MOVE TRP-PATH-SQL TO HOLD-PATH.

      * 02/12/02 BAH THE "OV" NEEDS TO GO INTO THE POSTING BRANCH
      * CAUSE INTERBRANCH MOVES YOU INTO THE OWNING BRANCH, SO WE HAVE
      * TO PUT THE PATH BACK TO THE POSTING BRANCH...
           IF HOLD-TP-OTHBR-FG = "C"
              MOVE EXT-FILPATH-BASE        TO TRP-ALL-BASE
              MOVE PATH-MACHINE            TO TRP-ALL-MACHINE
              MOVE PATH-DATA               TO TRP-ALL-DATA
              MOVE TRP-ALL-PATH            TO TRP-PATH
              MOVE "Y"                     TO TRP-PATH-OVERRIDE.

           PERFORM OPEN-TRP1-FILE.

      * FOR "OV" , THIS WILL BE THE POSTING BRANCH
           MOVE HOLD-TP-BRNO  TO TP-BRNO.
           MOVE TRANS-DATE    TO TP-DATE.

           MOVE LN-CLASS     TO TP-CLASS.
           MOVE LN-ACCTNO    TO TP-ACCTNO.

       TR-CHECK-EXISTS.

           IF HOLD-TP-POSTING-BR = HOLD-TP-BRNO
              ADD 1 TO HOLD-TP-LINE
              MOVE HOLD-TP-LINE TO TP-LINE
           ELSE
              IF HOLD-TP-OTHBR-FG = "G"
                 ADD 1 TO HOLD-TPG-LINE
                 MOVE HOLD-TPG-LINE TO TP-LINE
              ELSE
                 IF HOLD-TP-OTHBR-FG = "C"
                    ADD 1 TO HOLD-TPC-LINE
                    MOVE HOLD-TPC-LINE TO TP-LINE.

           MOVE TRP1-KEY TO HOLD-TRP1-KEY.
           PERFORM READ-TRP1-FILE.
           IF IO-FG = 0
      *       UNLOCK TRP-FILE
              GO TO TR-CHECK-EXISTS.

           PERFORM CLEAR-TRP-FILE.

           MOVE HOLD-TRP1-KEY TO TRP1-KEY.

      * "C" IS THE POSTING BRANCH AND FOR THE RE-READ OF THE MIP TR RECORD,
      * YOU MUST HAVE THE OWNING BRANCH HOLD KEY...
      * EXAMPLE, THE OWNING BRANCH HAD ALREADY POSTED 3 PAYMENTS TO AN
      * ACCOUNT AND ALL HAD CORRECT MIP INFO SET
      * THEN AN INTERBRANCH PAYMENT TOOK PLACE, AND IT WIPED OUT THE FIRST
      * TP RECORDS MIP INFO WHEN IT SHOULD HAVE BEEN REWRITING THE 4TH ONE
      * IT HAD THE POSTING BRANCHES HOLD KEY FOR SEQ 1
           IF HOLD-TP-OTHBR-FG NOT = "C"
              MOVE TRP1-KEY TO HOLD-TRP1-KEY-MIP.

           IF LP-TRCD = "OV" OR RV-LP-TRCD = "OV"
              MOVE BRANCH                TO TP-POSTING-BR
              IF ( LP-REFNO =    "LBOX" OR "TCOLL" OR "TPAY"
                                        OR "MGRAM" OR "ALLOT") OR
                 ( RV-LP-REFNO = "LBOX" OR "TCOLL" OR "TPAY"
                                        OR "MGRAM" OR "ALLOT") OR
                 ( ( BATCH-REFCD NOT = " ") AND
                   ( ( LP-REFNO = BATCH-REFCD    ) OR
                     ( RV-LP-REFNO = BATCH-REFCD )
                   )
                 )
                 MOVE "G"                TO TP-OTHBR-FG
              ELSE
                 MOVE HOLD-TP-OTHBR-FG   TO TP-OTHBR-FG
              END-IF
           ELSE
              MOVE HOLD-TP-POSTING-BR    TO TP-POSTING-BR
              MOVE HOLD-TP-OTHBR-FG      TO TP-OTHBR-FG.

           IF BR-FORCE-VALID-CITY-COUNTY = "Y"
              PERFORM GET-LXX-TAX
              MOVE LXX-INS-TAX-COUNTY-CD TO TP-INS-TAX-COUNTY-CD
              MOVE LXX-INS-TAX-CITY-CD   TO TP-INS-TAX-CITY-CD
              IF SUB = 0
                 MOVE WK-LX-REC TO LX-REC
              ELSE
                 MOVE 0 TO LXG-GLNO(1)    LXG-GLNO(2)    LXG-GLNO(3)
                           LXG-GLAMT(1)   LXG-GLAMT(2)   LXG-GLAMT(3).

           MOVE LN-LAWCODE         TO TP-LAWCODE.
           MOVE LN-SPRCLASS        TO TP-SPRCLASS.
           MOVE ORIG-LN-PLCD       TO TP-PLCD.
           MOVE ORIG-LN-PLTYPE     TO TP-PLTYPE.
           IF LN-JDDATE NOT = 0
              MOVE "J" TO TP-JDCD.
           MOVE LP-SSNO            TO TP-SSNO.
           MOVE MAKER-CD           TO TP-MAKER.
           MOVE LP-IBPC            TO TP-IBPC.
           MOVE LP-TRCD            TO TP-TRCD.
           IF LP-TRCD = "RV"
              MOVE "Y" TO TP-REV
              IF SUB = 0
                 MOVE RV-LP-TRCD TO TP-TRCD
              ELSE
                 MOVE TP-TRCD-TAB(SUB) TO TP-TRCD.

           IF CONV-REV-FLAG="Y"
              MOVE HOLD-LP-REFNO TO TP-REFNO
           ELSE
           IF ( RV-LP-REFNO = "LBOX" OR "TCOLL" OR "TPAY"
                                     OR "MGRAM" OR "ALLOT" )
              OR
              ( ( BATCH-REFCD NOT = " "     ) AND
                ( RV-LP-REFNO = BATCH-REFCD )
              )
              MOVE RV-LP-REFNO TO TP-REFNO
           ELSE
           IF SUB = 0
              MOVE DLRV-LP-REFNO TO TP-REFNO
              IF HOLD-LP-TRCD = "P4" OR "P5"
                  MOVE DLRV-LP-P4P5-TRCD   TO TP-P4P5-TRANCD
                  MOVE DLRV-LP-P4P5-DLRVNO TO TP-P4P5-DLRVNUM
              END-IF
           ELSE
              MOVE LP-REFNO TO TP-REFNO.


           MOVE LP-PAYDATE TO TP-PAYDATE.
           MOVE HOLD-DUEDATE TO TP-DUEDATE.

           IF HOLD-LP-TRCD = "SE"
              MOVE LP-TRAMT TO TP-PL-OTH-AR
           ELSE
              MOVE HOLD-PL-OTH-AR TO TP-PL-OTH-AR.

           IF HOLD-LP-TRCD = "Z2"
              ADD LP-APCUR TO TP-TRAMT
           ELSE
              ADD LP-TRAMT TO TP-TRAMT.
      * CHANGED THE FOLLOWING IF FROM LP-APINTOWE + LP-INTDUE TO PRINBAL
      * BECAUSE INTDUE TRUNCATED THE NUMBER TO 9(5)V99.
           IF HOLD-LP-TRCD = "JD" OR "PI"
                        OR PL-POSTING
              IF LP-TRCD = "RV"
                 SUBTRACT LP-CURBAL FROM TP-TRAMT
              ELSE
                 ADD LP-CURBAL TO TP-TRAMT.

           IF PL-POSTING
              PERFORM GET-TP-WORKAMT
           ELSE
           IF (LP-TRCD = "PO" OR "RN" OR "SC" OR "PB" OR "RB" OR "RO")
                   OR (
                        (LP-TRCD = "PA" OR "PE" OR "SS" OR "IN"
                                OR "PR" OR "PC" OR "PP")
                             AND (LN-CURBAL = 0)
                      )
              IF LN-SERVACCT NOT = "Y"
                 IF LN-PLCD = " "
                    MOVE 0 TO WK-SUB
                    PERFORM COMPUTE-TP-WORKAMT 6 TIMES.

      *  JTG 040517 ADDED GL CONTROL FIELDS FOR:
      *                 - UNEARNED INTEREST REPO
      *                 - UNEARNED ADDON INTEREST REPO
      *             THE UNEARNED WILL MOVE TO THESE ACCOUNTS POSTING
      *             A 'SX' OR 'ZX' AND REVERSING A 'SV'
      *             THE UNEARNED WILL MOVE (BACK) FROM THESE ACCOUNTS POSTING
      *             A 'SV' AND REVERSING A 'SX'                    REGACC #0049
      *
      *    CAPTURE HERE THE UNEARNED FOR ANTIC INTEREST AND ANTIC ADDON
      
           IF GP-NEW-REPO-UNEARNED-ACCTS = "Y"
              IF HOLD-LP-TRCD = "SX" OR "ZX" OR "SV"
                 SUBTRACT LN-ACCERN(1) FROM LN-ANTICERN(1)
                                      GIVING WK-TP-WORKAMT(1)
                 SUBTRACT LN-ACCERN(2) FROM LN-ANTICERN(2)
                                      GIVING WK-TP-WORKAMT(2).

           MOVE WK-TP-WORKAMT(1) TO TP-WORKAMT(1).
           MOVE WK-TP-WORKAMT(2) TO TP-WORKAMT(2).
           MOVE WK-TP-WORKAMT(3) TO TP-WORKAMT(3).
           MOVE WK-TP-WORKAMT(4) TO TP-WORKAMT(4).
           MOVE WK-TP-WORKAMT(5) TO TP-WORKAMT(5).
           MOVE WK-TP-WORKAMT(6) TO TP-WORKAMT(6).

      *  JTG 010914 'RE' ON 'IB' WILL ACT LIKE 'OT' TRANSACTION   REGACC PR#1575
           IF NOT (HOLD-LP-TRCD  =  "OT" OR "O2" OR "WO"
                                 OR "W2" OR "AP" OR "JD"
                                 OR "PI" OR "PL" OR "P2"
                                 OR "P3" OR "P4" OR "P5")
              IF NOT (HOLD-LP-TRCD = "RE" AND LN-LOANTYPE = "I")
                 ADD LP-APINTOWE LP-INTDUE TO TP-INTDUE
                 ADD LP-APINTOWE           TO TP-LCDUE.
           ADD LP-APOTH        TO TP-APOTH.
           ADD LP-APOT2        TO TP-APOT2.
           ADD LP-APINT        TO TP-APINT.
           ADD LP-APLC         TO TP-APLC.
           ADD LP-APCUR        TO TP-APCUR.
           ADD LP-PREPAY-PENALTY     TO TP-PENALTY-INT.

           IF HOLD-LP-TRCD = "O2"
              MOVE LP-APINTOWE TO TP-APOT2
              COMPUTE TP-APCUR = (LP-APINTOWE) * -1.
           IF HOLD-LP-TRCD = "W2"
              MOVE LP-APINTOWE TO TP-APOT2
              MOVE LP-APINTOWE TO TP-APCUR.

      *  JTG 010914 'RE' ON 'IB' WILL ACT LIKE 'OT' TRANSACTION   REGACC PR#1575
           IF (HOLD-LP-TRCD = "OT") OR
              (HOLD-LP-TRCD = "RE" AND LN-LOANTYPE = "I")
              ADD LP-INTDUE    TO TP-INTDUE.

           IF HOLD-LP-TRCD = "AP"
              ADD LP-APINTOWE  TO TP-APOTH
              ADD LP-INTDUE    TO TP-APINT
              ADD LP-LCPARTIALS   TO TP-APLC
              COMPUTE TP-APCUR =
                (LP-APINTOWE + LP-INTDUE + LP-LCPARTIALS) * -1.

      * THESE WILL NOT HAVE A VALUE FOR REBATE RECORDS. THEY
      *   ARE CLEARED IN THE UPDATE-TR1-OPEN
           MOVE LXG-GLNO(1)     TO TP-GLNO(1).
           MOVE LXG-GLNO(2)     TO TP-GLNO(2).
           MOVE LXG-GLNO(3)     TO TP-GLNO(3).

           ADD LXG-GLAMT(1)     TO TP-GLAMT(1).
           ADD LXG-GLAMT(2)     TO TP-GLAMT(2).
           ADD LXG-GLAMT(3)     TO TP-GLAMT(3).

           IF LN-SERVACCT NOT = "Y"
              PERFORM SET-TP-EARNINGS

      * RE: DL-DISC-CODE-NO-PL-EXP
      *     NORMALLY WHEN A P&L IS POSTED TO AN ACCOUNT THE REMAINING
      *     UNEARNED IS CLOSED OUT AND NO EARNINGS ARE TAKEN.
      *     HOWEVER WHEN DL-DISC-CODE-NO-PL-EXP ALL UNEARNED
      *     DEALER DISCOUNT IS EARNED. IN THE ROUTINE GET-TP-WORKAMT,
      *     WHICH WAS PERFORMED PRIOR TO SET-TP-EARNINGS, ON A REVERSAL
      *     THE ROUTINE ATTEMPTS TO REVERSE THE MONEY COMING OUT
      *     UNEARNED (ACCERN - ANTICERN), SO IF TP-EARNINGS(5)
      *     HAS A VALUE IT IS BECOUSE OF DL-DISC-CODE-NO-PL-EXP
      *     AND TP-WORKAMT MUST BE CLEARED.    JTG 000217 ACE #980

              IF RV-PL-POSTING
                 IF TP-EARNINGS(5) NOT = 0
                    MOVE 0 TO TP-WORKAMT(5)
                 END-IF
              END-IF
           ELSE
              MOVE LP-EARNED(1) TO TP-EARNINGS(1)
              MOVE LP-EARNED(2) TO TP-EARNINGS(2)
              MOVE LP-EARNED(3) TO TP-EARNINGS(3)
              MOVE 0 TO TP-EARNINGS(4) TP-EARNINGS(5) TP-EARNINGS(6).

           ADD LP-OTHBAL TO TP-OTHBAL.
           ADD LP-OT2BAL TO TP-OT2BAL.
           ADD LP-INTBAL TO TP-INTBAL.
           ADD LP-LCBAL  TO TP-LCBAL.
           ADD LP-CURBAL TO TP-CURBAL.

      * THE LP RECORD IS NOT SET AT THIS POINT !!! (BAH, 7/9/96)
           IF CONV-REV-FLAG NOT = "Y"
              MOVE RV-LP-TRCD TO TP-REVTRCD
              MOVE RV-LP-SEQNO TO TP-REVSEQNO.

           MOVE LP-PDTH-DATE TO TP-PDTH-DATE.
           MOVE LP-TILLNO TO TP-TILLNO.
           MOVE LP-LCPDTH-DATE TO TP-LCPDTH-DATE.
           MOVE LN-DLNO TO TP-DLNO.
           MOVE DLRV-LP-DLNO TO TP-LP-DLNO.
  

           MOVE LP-DLPROC TO TP-DLPROC.
           MOVE LP-INTPAID TO TP-INTPAID.
      * UP ABOVE, IF ITS NOT A PAYOFF, WE SAVE THE ORIGINAL LN-POCD
      * IN HOLD-POCD FOR REVERSALS OF PAYOFFS  10-17-88 BAH
           IF SUB = 0
              MOVE LN-POCD TO TP-POCD
              MOVE LN-POFFDATE TO TP-PODATE
              IF LP-TRCD = "RV"
                 MOVE HOLD-POCD TO TP-POCD.
           IF PWA-POOL-HAS-BEEN-CHANGED
                    OR PWA-POOL-PAYMENT-MADE
              MOVE PWA-PRIOR-POOLID TO TP-PRIOR-POOLID.
      * FOR PC ACCOUNTS, NOT SERVICED, ONLY 'RI' OR 'CI' MAY
      *   HAVE A VALUE.  FOR IB ACCOUNTS, NOT SERVICED, ONLY
      *   'PO' OR 'SC' MAY HAVE A VALUE.
           IF LN-SERVACCT NOT = "Y"
              IF TP-TRCD = "RI" OR "CI" OR "PO" OR "SC"
                 ADD LP-DLRVCHGS-ADJ(1) TO TP-DLRVCHGS-ADJ(1)
                 ADD LP-DLRVCHGS-ADJ(2) TO TP-DLRVCHGS-ADJ(2)
                 ADD LP-DLRVCHGS-ADJ(3) TO TP-DLRVCHGS-ADJ(3)
                 ADD LP-DLPARVHELD-ADJ TO TP-DLPARVHELD-ADJ
                 ADD LP-DLPARVPAID-ADJ TO TP-DLPARVPAID-ADJ.
           MOVE HOLD-DL-RVCHGS-CODE(1) TO TP-DL-RVCHGS-CODE(1).
           MOVE HOLD-DL-RVCHGS-CODE(2) TO TP-DL-RVCHGS-CODE(2).
           MOVE HOLD-DL-RVCHGS-CODE(3) TO TP-DL-RVCHGS-CODE(3).
           MOVE HOLD-DL-PARVHELD-CODE TO TP-DL-PARVHELD-CODE.
           MOVE HOLD-DL-PARVPAID-CODE TO TP-DL-PARVPAID-CODE.

           MOVE LP-NEWSTAT-RATE TO TP-NEWSTAT-RATE.

           MOVE LN-SERVACCT  TO TP-SERVACCT.
           MOVE LN-SALEFIN   TO TP-SALEFIN.
           MOVE LN-LOANTYPE  TO TP-LOANTYPE.

      * TEST FOR REVERSED PO REFUNDS OF INSURANCE
      *      IF SO, ORIGINAL INS TAX REFUNDS HAVE BEEN STORED
      *      IN HOLD-INS-TAX-RB TABLE
      
           IF BR-FORCE-VALID-CITY-COUNTY = "Y"
              IF (TP-REV = "Y") AND (RV-LP-TRCD NOT = TP-TRCD)
                 IF TP-TRCD = "CC" OR "RC"
                    MOVE HOLD-INS-TAX-RB(1) TO TP-INS-TAX-RB
                 ELSE
                    IF TP-TRCD = "CA" OR "RA"
                       MOVE HOLD-INS-TAX-RB(2) TO TP-INS-TAX-RB
                    ELSE
                       IF TP-TRCD = "CP" OR "RP"
                          MOVE HOLD-INS-TAX-RB(3) TO TP-INS-TAX-RB
                       ELSE
                          IF TP-TRCD = "C1" OR "R1"
                             MOVE HOLD-INS-TAX-RB(4) TO TP-INS-TAX-RB
                          ELSE
                          IF TP-TRCD = "C2" OR "R2"
                             MOVE HOLD-INS-TAX-RB(5) TO TP-INS-TAX-RB
                          ELSE
                          IF TP-TRCD = "C3" OR "R3"
                             MOVE HOLD-INS-TAX-RB(6) TO TP-INS-TAX-RB
                          ELSE
                          IF TP-TRCD = "C4" OR "R4"
                             MOVE HOLD-INS-TAX-RB(7) TO TP-INS-TAX-RB
                          ELSE
                          IF TP-TRCD = "C5" OR "R5"
                             MOVE HOLD-INS-TAX-RB(8) TO TP-INS-TAX-RB
                          END-IF
                          END-IF
                          END-IF
                          END-IF
                          END-IF
                       END-IF
                    END-IF
                 END-IF
              ELSE
                 MOVE LP-PRORATED-INS-REB        TO TP-INS-TAX-RB.

           MOVE LN-INSURED TO TP-INSURED.
           MOVE LN-INSTYPES TO TP-INSTYPES.
           IF SUB > 0 AND < 7
              MOVE LN-INSCOMP(SUB) TO TP-INSCOMP
              MOVE LN-INSOURS(SUB) TO TP-INSOURS
              COMPUTE TP-INSCOMM ROUNDED =
                 (TP-TRAMT - TP-INS-TAX-RB)
                       * LN-INSCOMM(SUB) / LN-INSPREM(SUB)
           ELSE
           IF TP-TRCD = "CC" OR "RC"
              MOVE LN-INSOURS(1) TO TP-INSOURS
              MOVE LN-INSCOMP(1) TO TP-INSCOMP
              COMPUTE TP-INSCOMM ROUNDED =
                 (TP-TRAMT - TP-INS-TAX-RB)
                       * LN-INSCOMM(1) / LN-INSPREM(1)
           ELSE
           IF TP-TRCD = "CA" OR "RA"
              MOVE LN-INSOURS(2) TO TP-INSOURS
              MOVE LN-INSCOMP(2) TO TP-INSCOMP
              COMPUTE TP-INSCOMM ROUNDED =
                 (TP-TRAMT - TP-INS-TAX-RB)
                       * LN-INSCOMM(2) / LN-INSPREM(2)
           ELSE
           IF TP-TRCD = "CP" OR "RP"
              MOVE LN-INSOURS(3) TO TP-INSOURS
              MOVE LN-INSCOMP(3) TO TP-INSCOMP
              COMPUTE TP-INSCOMM ROUNDED =
                 (TP-TRAMT - TP-INS-TAX-RB)
                       * LN-INSCOMM(3) / LN-INSPREM(3)
           ELSE
           IF TP-TRCD = "C1" OR "R1"
              MOVE LN-INSOURS(4) TO TP-INSOURS
              MOVE LN-INSCOMP(4) TO TP-INSCOMP
              COMPUTE TP-INSCOMM ROUNDED =
                 (TP-TRAMT - TP-INS-TAX-RB)
                       * LN-INSCOMM(4) / LN-INSPREM(4)
           ELSE
           IF TP-TRCD = "C2" OR "R2"
              MOVE LN-INSOURS(5) TO TP-INSOURS
              MOVE LN-INSCOMP(5) TO TP-INSCOMP
              COMPUTE TP-INSCOMM ROUNDED =
                 (TP-TRAMT - TP-INS-TAX-RB)
                       * LN-INSCOMM(5) / LN-INSPREM(5)
           ELSE
           IF TP-TRCD = "C3" OR "R3"
              MOVE LN-INSOURS(6) TO TP-INSOURS
              MOVE LN-INSCOMP(6) TO TP-INSCOMP
              COMPUTE TP-INSCOMM ROUNDED =
                 (TP-TRAMT - TP-INS-TAX-RB)
                       * LN-INSCOMM(6) / LN-INSPREM(6).

      * MOVED THESE 4 STATEMENTS OUTSIDE OF THE IF LP-TRCD = "DC" BELOW
           COMPUTE TP-TOTNODEF = LN-TOTNODEF + LN-TOTNOALDEL.
           MOVE LN-SUM-LNAMT TO TP-LNAMT.
           MOVE LN-ORIG-1STPYDATE TO TP-ORIG-1STPYDATE.
           MOVE LN-SUM-ORGTERM TO TP-ORGTERM.

           IF LP-TRCD = "DC" OR RV-LP-TRCD = "DC"
              MOVE HOLD-NEW-1ST-DUE TO TP-1STPYDATE
              MOVE LP-OLD1ST-PYDATE TO TP-OLD1ST-PYDATE.

           MOVE ORIG-LN-REPOCD TO TP-REPOCD.

           IF HOLD-LP-TRCD = "RC" OR "RA" OR "RP" OR "R1"
                                  OR "R2" OR "R3" OR "RI"
                                  OR "RS" OR "RM" OR "RD"
              MOVE LP-MANUAL-RB TO TP-MANUAL-RB.

           MOVE MAX-DEFER-FG TO TP-MAX-DEFER-FG.

      *-------------------------------------------------------------

           PERFORM SET-POSTDATE.
           MOVE POST-USERID TO TP-USERID.
           MOVE POST-TIME   TO TP-POSTTIME.
           MOVE POST-DATE   TO TP-POSTDATE.

           MOVE LN-UNITPER-CD   TO TP-UNITPER-CD.
           MOVE LN-UNITPER-FREQ TO TP-UNITPER-FREQ.
           MOVE LN-COLLECTOR    TO TP-COLLECTOR.

           IF NOT (TP-TRCD = "RC" OR "RA" OR "RP" OR
                              "RI" OR "RS" OR "RM" OR
                               "RD" OR "R1" OR
                                "R2" OR "R3")
              MOVE SAVE-LN-PROMDATE TO TP-PROMDATE
              MOVE SAVE-LN-PROMAMT  TO TP-PROMAMT
              MOVE SAVE-LN-PROMDAYS TO TP-PROMDAYS-PASTDUE
              MOVE SAVE-LN-PROMID   TO TP-PROMID.

           MOVE SP-DEFFRMLA TO TP-SP-DEFFRMLA.
           IF (LN-ESCROW-FG = "Y" OR LN-ESCROW-FG = "I")
              IF TP-TRCD = "PY" OR "PA"
                 MOVE LP-APPLIED-TO-ESCROW TO TP-APPLIED-TO-ESCROW
              ELSE IF TP-TRCD = "ED"
                 MOVE LP-TRAMT TO TP-TRAMT TP-ESCROW-DISBURSED
              ELSE IF TP-TRCD = "EP"
                 MOVE LP-TRAMT TO TP-TRAMT TP-ESCROW-PREPAID.

           MOVE HOLD-PRIOR-DF-CODE TO TP-PRIOR-DF-CODE.
           MOVE HOLD-PRIOR-DF-POSTDATE TO TP-PRIOR-DF-POSTDATE.

      *    08102021: WILL NO LONGER WRITE ADDITION TR RECORDS FOR
      *              POOLID BUT STILL NEED TO UPDATE TP-POOLID
      * IF TRCD = 'SP' THEN DLPOOL IS ALREADY SET, IF IT WASNT
      * A 'SP' THEN THE DLPOOL ALREADY EXISTED AND ITS ACTIVITY
      * PWA-POOLID AND PWA-PRIOR-POOLID IS SET WITH LN-DLPOOL

           IF HOLD-LP-TRCD = "SP"
              MOVE "C" TO PWA-POOL-CHANGE-SW
           ELSE
              IF LN-DLPOOL NOT = ZERO
                 MOVE "P"       TO PWA-POOL-CHANGE-SW
                 MOVE LN-DLPOOL TO PWA-POOLID
                 MOVE 0         TO PWA-PRIOR-POOLID
              ELSE
                 MOVE " " TO PWA-POOL-CHANGE-SW.

           IF PWA-POOL-HAS-BEEN-CHANGED
              MOVE PWA-POOLID TO TP-POOLID
           ELSE
              IF PWA-POOL-PAYMENT-MADE
                 MOVE PWA-POOLID TO TP-POOLID
              ELSE
                 MOVE 0       TO TP-POOLID.
               
           MOVE HOLD-LP-SEQNO TO TP-LP-SEQNO.

      * OTHBR-FG "G" - OWNING BRANCH
      *          "C" - POSTING BRANCH
      *          " " - IN BRANCH PAYMENT
      * ONLY UPDATE OWNING BRANCH PAYMENT IF INTERBRANCH OR A REGULAR PAYMENT
           IF HOLD-TP-OTHBR-FG NOT = "C"
              MOVE LN-ACTIONCD2 TO TP-ACTIONCD2.

           IF HOLD-BP-TRCD NOT = " "
              MOVE LP-REPAY-TRANS-ID TO TP-REPAY-TRANS-ID.

           IF LP-TRCD = "RS" OR LP-REVTRCD = "RS"
              IF ( HOLD-LXR-REB-AMT NOT = 0
                                AND NOT = 2020202.02
                                AND NOT = 0202020.20
                                AND NOT = 5389762.88 )
                 MOVE HOLD-LXR-REB-AMT TO TP-CLOSFEE-REB-AMT.

           PERFORM WRITE-TRP1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           IF TP-LINE > 248
              MOVE "NO MORE POSTING TO THIS ACCOUNT TODAY !!!!" TO MESS
              PERFORM CONDITIONAL-SEND-MESS.

       UPDATE-TR1-FILE-END.

           PERFORM CLOSE-TRP1-FILE.

           MOVE HOLD-PATH TO TRP-PATH-SQL.
           MOVE " "       TO TRP-PATH-OVERRIDE.

           MOVE ZEROES    TO WK-TP-WORKAMT(1) WK-TP-WORKAMT(2)
                             WK-TP-WORKAMT(3) WK-TP-WORKAMT(4)
                             WK-TP-WORKAMT(5) WK-TP-WORKAMT(6).

      * ONLY CREATE XTRP FOR OWNING BRANCH

      * INTERBRANCH OWNING BRANCH (OTHBR-FG "G")
      * INTERBRANCH POSTING BRANCH (OTHBR-FG "C")
      * OWNING BRANCH POSTING FOR ITSELF (OTHBR-FG = " ")

      * FTP/OUT/PAYS/TRP.BRNO.NUMBER.SEQ (DATA WAREHOUSE LAYOUT)

           IF GP-CREATE-PAY-XTRP-XNO = "Y" AND
                                      HOLD-TP-OTHBR-FG NOT = "C"
              PERFORM UPDATE-REPAY-TRP-FILE.

       UPDATE-TR1-FILE-EXIT.
           EXIT.

      **********************************************
       UPDATE-DT1-FILE SECTION.
      **********************************************
           IF TP-SERVACCT NOT = "Y"
              IF NOT (HOLD-LP-TRCD  = "PR" OR "PC" OR "PP"
                                           OR "P4" OR "P5")
                 IF LP-DLRVCHGS-ADJ(1) = 0
                  IF LP-DLRVCHGS-ADJ(2) = 0
                   IF LP-DLRVCHGS-ADJ(3) = 0
                    IF LP-DLPARVHELD-ADJ = 0
                     IF LP-DLPARVPAID-ADJ = 0
                        GO TO EXIT-UPDATE-DT1.
           MOVE "UPDATING DEALER TRANSACTION FILE........" TO MESS.
           PERFORM TEST-SEND-LEGEND.
           PERFORM OPEN-DT1-FILE.
           MOVE 1 TO SAVE-DT-SEQ.
       NEXT-DT-SEQ.
           PERFORM CLEAR-DT-FILE.
           MOVE LN-OWNBR TO DT-BRNO.
           IF DLRV-LP-DLNO = 0
              MOVE LN-DLNO TO DT-DLNO
           ELSE
              MOVE DLRV-LP-DLNO TO DT-DLNO.

      * GLB 07/02/01
           MOVE DT-DLNO  TO HOLD-DLNO.

           MOVE LN-CLASS TO DT-CLASS.
           MOVE LP-ACCTNO TO DT-ACCTNO.
           MOVE LP-TRDATE TO DT-DATE.
           MOVE SAVE-DT-SEQ TO DT-SEQ.
           IF LN-SERVACCT = "Y"
              MOVE "S" TO DT-TYPE
           ELSE
              MOVE "P" TO DT-TYPE.
           MOVE LP-SEQNO TO DT-LPSEQNO.
           MOVE LP-TRCD TO DT-TRCD.

      *--------------------------------------------------------------
      * JTG 082297
      *  CHANGED THIS TO CORRECTLY STORE THE TRUE TRANSACTION CODE
      *  BEING REVERSED. WHEN REVERSING A PAYOFF, DT RECORDS ARE
      *  CREATED FOR EACH 'REBATE' BESIDES THE PAYOFF RECORD.
      *
      *  AT THIS POINT IN THE UPDATE:
      *
      *     RV-LP-TRCD = 'PO' OR 'PB' OR 'SC' OR 'RN'
      *         AND
      *     LP-REVTRCD = 'RI', 'RC', 'RA' ETC
      *
      *    MOVE RV-LP-TRCD TO DT-REVERSE-TRCD.    BAH RE: A50 LOGIC
      *--------------------------------------------------------------
           MOVE LP-REVTRCD TO DT-REVERSE-TRCD.
      *--------------------------------------------------------------

           IF HOLD-LP-TRCD = "PR"
              SUBTRACT LP-TRAMT FROM DT-DLRVPRIN(DLRV-LP-DLRVNO)
           ELSE
           IF HOLD-LP-TRCD = "PC"
              SUBTRACT LP-TRAMT FROM DT-DLRVCHGS(DLRV-LP-DLRVNO)
           ELSE
           IF HOLD-LP-TRCD = "PP"
              SUBTRACT LP-TRAMT FROM DT-DLPARVHELD.

      * P4 AND P5 TRANSACTIONS:
      * PAYMENT OUT OF RESERVE TO COVER P&L EXPENSE:
           IF HOLD-LP-TRCD = "P4" OR "P5"
              PERFORM GET-P4P5-RESERVE-AMT
              IF DLRV-LP-P4P5-TRCD = "PR"
                 SUBTRACT P4P5-RSVAMT
                              FROM DT-DLRVPRIN(DLRV-LP-P4P5-DLRVNO)
              ELSE
              IF DLRV-LP-P4P5-TRCD = "PC"
                 SUBTRACT P4P5-RSVAMT
                              FROM DT-DLRVCHGS(DLRV-LP-P4P5-DLRVNO)
              ELSE
              IF DLRV-LP-P4P5-TRCD = "PP"
                 SUBTRACT P4P5-RSVAMT FROM DT-DLPARVHELD.


      * FOR PC ACCOUNTS, NOT SERVICED, ONLY 'RI' OR 'CI' MAY
      *   HAVE A VALUE.  FOR IB ACCOUNTS, NOT SERVICED, ONLY
      *   'PO' OR 'SC' MAY HAVE A VALUE.
           IF LN-SERVACCT NOT = "Y"
              IF HOLD-LP-TRCD = "RI" OR "CI" OR "PO" OR "SC"
                 SUBTRACT LP-DLRVCHGS-ADJ(1) FROM DT-DLRVCHGS(1)
                 SUBTRACT LP-DLRVCHGS-ADJ(2) FROM DT-DLRVCHGS(2)
                 SUBTRACT LP-DLRVCHGS-ADJ(3) FROM DT-DLRVCHGS(3)
                 SUBTRACT LP-DLPARVHELD-ADJ FROM DT-DLPARVHELD
                 SUBTRACT LP-DLPARVPAID-ADJ FROM DT-DLPARVPAID.

           MOVE LP-APCUR TO DT-APCUR.
           MOVE LP-DLPROC TO DT-PROCEEDS.

           IF LN-SERVACCT = "Y"
              IF LN-INSOURS(1) = "Y"
                 IF (LP-TRCD = "CC" OR "RC")
                         OR (LP-REVTRCD = "CC" OR "RC")
                    ADD LP-TRAMT TO DT-PROCEEDS
                 END-IF
              END-IF
              IF LN-INSOURS(2) = "Y"
                 IF (LP-TRCD = "CA" OR "RA")
                         OR (LP-REVTRCD = "CA" OR "RA")
                    ADD LP-TRAMT TO DT-PROCEEDS
                 END-IF
              END-IF
              IF LN-INSOURS(3) = "Y"
                 IF (LP-TRCD = "CP" OR "RP")
                         OR (LP-REVTRCD = "CP" OR "RP")
                    ADD LP-TRAMT TO DT-PROCEEDS
                 END-IF
              END-IF
              IF LN-INSOURS(4) = "Y"
                 IF (LP-TRCD = "C1" OR "R1")
                         OR (LP-REVTRCD = "C1" OR "R1")
                    ADD LP-TRAMT TO DT-PROCEEDS
                 END-IF
              END-IF
              IF LN-INSOURS(5) = "Y"
                 IF (LP-TRCD = "C2" OR "R2")
                         OR (LP-REVTRCD = "C2" OR "R2")
                    ADD LP-TRAMT TO DT-PROCEEDS
                 END-IF
              END-IF
              IF LN-INSOURS(6) = "Y"
                 IF (LP-TRCD = "C3" OR "R3")
                         OR (LP-REVTRCD = "C3" OR "R3")
                    ADD LP-TRAMT TO DT-PROCEEDS
                 END-IF
              END-IF.

           IF HOLD-LP-TRCD = "PR" OR "PC" OR "PP"
              MOVE DLRV-LP-DLRVNO TO DT-DLRVNO
           ELSE
              IF HOLD-LP-TRCD = "P4" OR "P5"
                 MOVE DLRV-LP-P4P5-TRCD   TO DT-P4P5-TRCD
                 MOVE DLRV-LP-P4P5-DLRVNO TO DT-DLRVNO.
           MOVE "B" TO DT-PAID.

           PERFORM WRITE-DT1-FILE.
           IF IO-FG = 0
              GO TO FINISH-UPDATE-DT1.
           IF SAVE-DT-SEQ < 999
              ADD 1 TO SAVE-DT-SEQ
              GO TO NEXT-DT-SEQ.
           MOVE "DEALER TRANSACTION = 9999, REC NOT CREATED !" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.

       FINISH-UPDATE-DT1.
           IF HOLD-LP-TRCD = "PR" OR "PC" OR "PP"
              MOVE DLRV-LP-DLRVNO TO HOLD-DLRVNO
              PERFORM UPDATE-DT-NOBATCH.

           PERFORM CLOSE-DT1-FILE.
       EXIT-UPDATE-DT1.
           EXIT.

      *****************************************************************
       UPDATE-DT-NOBATCH SECTION.
      *****************************************************************

           MOVE "UPDATING ORIGINAL PROCEEDS ........" TO MESS.
           PERFORM SEND-LEGEND.

           MOVE DT-PATH-OWNBR TO DT-BRNO
                                 QDT1-WBEG-BRNO
                                 QDT1-WEND-BRNO.
           MOVE HOLD-DLNO     TO DT-DLNO.
           MOVE DT-NUM        TO QDT1-WBEG-NUM
                                 QDT1-WEND-NUM.
           MOVE LN-CLASS      TO DT-CLASS
                                 QDT1-WBEG-CLASS
                                 QDT1-WEND-CLASS.
           MOVE LP-ACCTNO     TO DT-ACCTNO
                                 QDT1-WBEG-ACCTNO
                                 QDT1-WEND-ACCTNO.
           MOVE 19000101      TO DT-DATE SQL-DATE-YYYYMMDD
           PERFORM SQL-SET-DATE.
           MOVE SQL-DATE-YYYY-MM-DD TO QDT1-WBEG-DATE.
           MOVE EXT-JULIAN-END TO SQL-DATE-YYYYMMDD.
           PERFORM SQL-SET-DATE.
           MOVE SQL-DATE-YYYY-MM-DD TO QDT1-WEND-DATE.
           MOVE 0             TO DT-SEQ
                                 QDT1-WBEG-SEQ.
           MOVE ALL "9"       TO QDT1-WEND-SEQ.

           PERFORM START-DT1-FILE.
       UPDATE-DT-NOBATCH-NEXT.
           PERFORM READ-DT1-FILE-NEXT.
           IF (IO-FG = 9) OR (DT-BRNO NOT = DT-PATH-OWNBR)
              GO TO EXIT-UPDATE-DT-NOBATCH.

           IF DT-DLNO NOT = HOLD-DLNO
              GO TO EXIT-UPDATE-DT-NOBATCH.

           IF DT-ACCTNO NOT = LP-ACCTNO
              GO TO UPDATE-DT-NOBATCH-NEXT.

           IF DT-TRCD NOT = "NW"
              IF DT-TRCD NOT = "AV"
                 IF DT-TRCD NOT = "PU"
                    GO TO UPDATE-DT-NOBATCH-NEXT.

           IF HOLD-LP-TRCD = "PR"
              ADD LP-TRAMT TO DT-DLRVPRIN-PAY.
           IF HOLD-LP-TRCD = "PC"
              ADD LP-TRAMT TO DT-DLRVCHGS-PAY.
           IF HOLD-LP-TRCD = "PP"
              ADD LP-TRAMT TO DT-DLPARVHELD-PAY.

           PERFORM REWRITE-DT1-FILE.
       EXIT-UPDATE-DT-NOBATCH.
           EXIT.

      ************************************************
       CHECK-UPDATE SECTION.
      ************************************************

      * CREATE CHECK REQUESTS FOR LP-REFNO = "CHECK" AND NOT REVERSAL
      * OR "OV" OVERPAYMENT

           MOVE "UPDATING CHECK RECORDS..............." TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM OPEN-BW1-FILE.

      * WAS TOLD TO ALWAYS MAKE CHECK OUT TO THE PRIMARY MAKER ON THE
      * ACCOUNT, EVEN IF THE COMAKER MADE THE PAYMENT. THEY CAN CHANGE
      * THE BORROWER INFO IN CHECK WRITING

           MOVE LN-SSNO(1) TO BW-SSNO.
           PERFORM READ-BW1-FILE.
           IF IO-FG NOT = 0
              MOVE "INVALID BORROWER" TO BW-LNAME BW-FNAME.
           PERFORM CLOSE-BW1-FILE.

      * INTERBRANCH; LP/INTRBR PUTS YOU IN THE "OWNING" BRANCHES FILES, SO
      *              PATH-MACHINE IS THE "POSTING" BRANCH....
           IF PATH-MACHINE NOT = " "
              IF LP-TRCD = "OV"
                 MOVE EXT-FILPATH-BASE     TO CX-ALL-BASE
                 MOVE PATH-MACHINE         TO CX-ALL-MACHINE
                 MOVE PATH-DATA            TO CX-ALL-DATA
                 MOVE CX-ALL-PATH          TO CX-PATH
                 MOVE "Y"                  TO CX-PATH-OVERRIDE.
           PERFORM OPEN-CX1-FILE.
           MOVE BRANCH    TO SAVE-CX-BRNO.
           MOVE "LN"      TO SAVE-CX-TYPE.
           MOVE 1         TO SAVE-CX-SEQNO.

           PERFORM CLEAR-CX-FILE.

           MOVE LN-CLASS  TO CX-CLASS.
           MOVE LP-TRAMT  TO CX-AMT.
           PERFORM APPEND-BW-NAMES.
           MOVE INSPECT-W TO CX-PAYEE.
           MOVE BW-ADR1   TO CX-ADR1.
           MOVE BW-ADR2   TO CX-ADR2.
           MOVE BW-CITY   TO CX-CITY.
           MOVE BW-STATE  TO CX-STATE.
           MOVE BW-ZIP    TO CX-ZIP.
           MOVE LN-ACCTNO TO CX-REF.
           IF LP-TRCD = "OV"
              MOVE "OVER PAID CHECK 'ZZ': XXXXXXXXXXXXXXXXXXXXXXXXX"
                                                     TO INSPECT-W
           ELSE
              MOVE "REBATE CHECK 'ZZ': XXXXXXXXXXXXXXXXXXXXXXXXX"
                                                     TO INSPECT-W.
           MOVE LP-TRCD TO ADD-ON-TRCD.
           INSPECT INSPECT-W REPLACING FIRST "ZZ" BY ADD-ON-TRCD.
           MOVE BW-LNAME TO ADD-ON.
           INSPECT INSPECT-W REPLACING FIRST
                 "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" BY ADD-ON.
           MOVE INSPECT-W TO CX-REASON.
           MOVE LN-ACCTNO TO CX-ACCTNO.
           MOVE "S"       TO CX-PAID.
           MOVE "F2"      TO CX-PGM.
           MOVE LP-TRDATE TO CX-DATE.
           MOVE BW-SSNO TO CX-SSNO.
       WRITE-CX-TEMP.
           MOVE SAVE-CX1-KEY TO CX1-KEY.
           PERFORM WRITE-CX1-FILE.
           IF IO-FG = 0
              GO TO CREATE-FORM-REQUEST.

           IF SAVE-CX-SEQNO < 9999
              ADD 1 TO SAVE-CX-SEQNO
              GO TO WRITE-CX-TEMP.

           MOVE "REQUEST # = 9999.  REQUEST NOT CREATED!" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
           GO TO EXIT-CHECK-UPDATE.

       CREATE-FORM-REQUEST.
           PERFORM CLOSE-CX1-FILE.
           MOVE " " TO CX-PATH-OVERRIDE.

           PERFORM OPEN-FD1-FILE.
           MOVE SP-PRFORM(2) TO FD-FMNO.
           PERFORM READ-FD1-FILE.
           IF IO-FG NOT = 0
              PERFORM CLOSE-FD1-FILE
              MOVE "FORM REQUEST RECORD NOT CREATED !" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO EXIT-CHECK-UPDATE.
           PERFORM CLOSE-FD1-FILE.


      * INTERBRANCH; LP/INTRBR PUTS YOU IN THE "OWNING" BRANCHES FILES, SO
      *              PATH-MACHINE IS THE "POSTING" BRANCH....
           IF PATH-MACHINE NOT = " "
              IF LP-TRCD = "OV"
                 MOVE EXT-FILPATH-BASE     TO FM-ALL-BASE
                 MOVE PATH-MACHINE         TO FM-ALL-MACHINE
                 MOVE PATH-DATA            TO FM-ALL-DATA
                 MOVE FM-ALL-PATH          TO FM-PATH
                 MOVE "Y"                  TO FM-PATH-OVERRIDE.

           PERFORM OPEN-FM1-FILE.


           MOVE SPACES                    TO LPWSFM-EDIT-FM-INITKEY.
           MOVE CX-BRNO                   TO LPWSFM-EDIT-FM-BRNO.
           MOVE CX-TYPE                   TO LPWSFM-EDIT-FM-TYPE.
           MOVE CX-SEQNO                  TO LPWSFM-EDIT-FM-SEQNO.
           MOVE FD-FMNO                   TO LPWSFM-EDIT-FM-CKFMNO.

           MOVE FM-PATH-OWNBR             TO FM-BRNO.
           MOVE LPWSFM-EDIT-FM-INITKEY    TO FM-INITKEY.
           MOVE FD-FMNO                   TO FM-FMNO.

           MOVE FM1-KEY                   TO HOLD-FM1-KEY.

           PERFORM READ-FM1-FILE.

           PERFORM CLEAR-FM-FILE.

           MOVE HOLD-FM1-KEY       TO FM1-KEY.
           MOVE CX-ZIP             TO FM-ZIP.
           MOVE " "                TO FM-PRINT.
           MOVE 0                  TO FM-STMT-COUNTER.
           MOVE TRANS-DATE         TO FM-TRDATE.
           MOVE EXT-CONAME-USER-ID TO FM-USERID.

           IF IO-FG = 0
              PERFORM REWRITE-FM1-FILE
              GO TO EXIT-CHECK-UPDATE.

           IF FM-FMNO NOT = 0
              PERFORM WRITE-FM1-FILE
              IF IO-FG = 9
                 GO TO IO-ERROR.

       EXIT-CHECK-UPDATE.
           PERFORM CLOSE-FM1-FILE.
           MOVE " " TO FM-PATH-OVERRIDE.

      ***********************************************************
       GET-P4P5-RESERVE-AMT SECTION.
      ***********************************************************

      * P4 AND P5 TRANSACTIONS
      * GET PAYMENT OUT OF RESERVE TO COVER P&L EXPENSE

           PERFORM GET-TP-WORKAMT.

      * ADDED DL-DISC-CODE-NO-PL-EXP,      ACE #980
      * WHEN SET THE REMAINING DEALER DISCOUNT UNEARNED
      * WILL BE TAKEN INTO INCOME AND NOT REDUCE THE P&L EXPENSE

           MOVE LN-EARN-ORDER(5) TO WK-SUB.
           IF WK-SUB > 3
              IF LXE-EARN(WK-SUB - 3) NOT = 0
                 MOVE 0 TO WK-TP-WORKAMT(5)
              END-IF
           ELSE
              IF LP-EARNED(WK-SUB) NOT = 0
                 MOVE 0 TO WK-TP-WORKAMT(5).

           IF LP-TRCD = "RV"
              COMPUTE P4P5-RSVAMT =
                 ( WK-TP-WORKAMT(1) + WK-TP-WORKAMT(2)
                      + WK-TP-WORKAMT(3) + WK-TP-WORKAMT(4)
                       + WK-TP-WORKAMT(5) + WK-TP-WORKAMT(6)
                        + LN-CURBAL
                 ) * -1
           ELSE
              COMPUTE P4P5-RSVAMT =
                LN-CURBAL
                    - WK-TP-WORKAMT(1) - WK-TP-WORKAMT(2)
                       - WK-TP-WORKAMT(3) - WK-TP-WORKAMT(4)
                        - WK-TP-WORKAMT(5) - WK-TP-WORKAMT(6).

      *************************************
       SAVE-SCREEN SECTION.
      *************************************
           MOVE 3 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           MOVE ELE     TO WK-ELE.
           MOVE LN-REC  TO WK-SAVE-RECORD.
           MOVE LP-REC  TO WK-LP-REC.
           MOVE LX-REC  TO WK-LX-REC.
           MOVE LXE-REC TO WK-LXE-REC.
           MOVE LXG-REC TO WK-LXG-REC.

           PERFORM REWRITE-WK-FILE.
       EXIT-SAVE-SCREEN.
           PERFORM CLOSE-WK-FILE.

      *************************************
       RESTORE-SCREEN SECTION.
      *************************************
           MOVE 3 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF NEW-FORM NOT = OLD-FORM
              MOVE OLD-PROG-FORM TO WK-OLD-PROG-FORM
              MOVE NEW-PROG-FORM TO OLD-PROG-FORM.
           IF IO-FG = 0
              GO TO RESTORE-CLEAR.

           MOVE SPACES TO WK-SAVE-RECORD.
           MOVE 0      TO WK-ELE.
           PERFORM WRITE-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           GO TO EXIT-RESTORE-SCREEN.
       RESTORE-CLEAR.
           MOVE WK-SAVE-RECORD TO LN-REC.
           MOVE WK-LP-REC      TO LP-REC.
           MOVE WK-LX-REC      TO LX-REC.
           MOVE WK-LXE-REC     TO LXE-REC.
           MOVE WK-LXG-REC     TO LXG-REC.
           MOVE 0              TO WK-ELE.
           IF CONV-REV-FLAG = "Y"
              MOVE HOLD-LP-REFNO TO LP-REFNO
              MOVE LP-REVTRCD TO RV-LP-TRCD HOLD-LP-TRCD.

           PERFORM REWRITE-WK-FILE.
       EXIT-RESTORE-SCREEN.
           PERFORM CLOSE-WK-FILE.

      **************************************************
       TEST-REB-AMOUNTS SECTION.
      **************************************************

           MOVE " " TO TEST-REB-AMOUNTS-FG.
           IF REB-AMOUNT(SUB) NOT = 0
              MOVE "Y" TO TEST-REB-AMOUNTS-FG
              GO TO END-TEST-REB-AMOUNTS.

           IF SUB < 4
              IF INS-RB-TBL(SUB) = "Y"
                 MOVE "Y" TO TEST-REB-AMOUNTS-FG
              END-IF
           ELSE
           IF SUB = 9
              IF INS-RB-TBL(4) = "Y"
                 MOVE "Y" TO TEST-REB-AMOUNTS-FG
              END-IF
           ELSE
           IF SUB = 10
              IF INS-RB-TBL(5) = "Y"
                 MOVE "Y" TO TEST-REB-AMOUNTS-FG
              END-IF
           ELSE
           IF SUB = 11
              IF INS-RB-TBL(6) = "Y"
                 MOVE "Y" TO TEST-REB-AMOUNTS-FG.

       END-TEST-REB-AMOUNTS.
           EXIT.


      *****************************************************************
      *   DESC: GET-TRCD-PLSUB
      *         BASED ON TRCD-PLTYPE THIS ROUTINE WILL
      *         RETURN THE INDEX TO TY-PL-ACTIVITY
      *
      *   IN  : TRCD-PLTYPE   REDEFINITION OF TRCD
      *   OUT : TRCD-PLSUB         1 - PL ACTIVE
      *                       3 - P2 ACTIVE
      *                       5 - P3 ACTIVE
      *                       7 - P4 ACTIVE
      *                       9 - P5 ACTIVE
      *****************************************************************
       GET-TRCD-PLSUB   SECTION.
      *****************************************************************
           IF TRCD-PLTYPE = "L"
              MOVE 1 TO TRCD-PLSUB
           ELSE
              COMPUTE TRCD-PLSUB = TRCD-PLTYPE-NO * 2 - 1.

      *****************************************************************
      *   DESC: GET-ORIG-LN-PLSUB
      *         BASED ON ORIG-LN-PLTYPE THIS ROUTINE WILL
      *         RETURN THE INDEX TO TY-PL-RECOVERED TABLE
      *
      *   IN  : ORIG-LN-PLTYPE
      *   OUT : ORIG-LN-PLSUB    1 - PL
      *                          2 - P2
      *                          3 - P3
      *                          4 - P4
      *                          5 - P5
      *****************************************************************
       GET-ORIG-LN-PLSUB   SECTION.
      *****************************************************************
           MOVE 1 TO ORIG-LN-PLSUB.
           IF ORIG-LN-PLTYPE = "2"      MOVE 2 TO ORIG-LN-PLSUB
           ELSE IF ORIG-LN-PLTYPE = "3" MOVE 3 TO ORIG-LN-PLSUB
           ELSE IF ORIG-LN-PLTYPE = "4" MOVE 4 TO ORIG-LN-PLSUB
           ELSE IF ORIG-LN-PLTYPE = "5" MOVE 5 TO ORIG-LN-PLSUB.


      **********************************
       UPDATE-FORM-REQUESTS SECTION.
      **********************************

           MOVE 1 TO SUB.
       UPDATE-NEXT-FORM.
           IF SUB > 2
              GO TO EXIT-UPDATE-FORM.

           IF SP-AUTO-SEND-TRCD(SUB) = HOLD-LP-TRCD
              MOVE SP-AUTO-SEND-FMNO(SUB,1) TO FORM-NO(1)
              MOVE SP-AUTO-SEND-FMNO(SUB,2) TO FORM-NO(2)
              MOVE SP-AUTO-SEND-FMNO(SUB,3) TO FORM-NO(3)
              MOVE SP-AUTO-SEND-FMNO(SUB,4) TO FORM-NO(4)
              IF RV-LP-TRCD NOT = "  "
                 PERFORM REMOVE-AUTO-FORM-REQUESTS
              ELSE
                 PERFORM UPDATE-AUTO-FM-NO.

           ADD 1 TO SUB.
           GO TO UPDATE-NEXT-FORM.

       EXIT-UPDATE-FORM.
           EXIT.

      *****************************************
       UPDATE-AUTO-FORM-REQUESTS SECTION.
      *****************************************

           MOVE 1 TO SUB.
       UPDATE-NEXT-AUTO-FORM.
           IF SUB > 3
              GO TO EXIT-UPDATE-AUTO-FORM.

           IF SP-REPO-TRCD(SUB) = HOLD-LP-TRCD
              MOVE SP-REPO-FMNO(SUB,1) TO FORM-NO(1)
              MOVE SP-REPO-FMNO(SUB,2) TO FORM-NO(2)
              MOVE SP-REPO-FMNO(SUB,3) TO FORM-NO(3)
              MOVE SP-REPO-FMNO(SUB,4) TO FORM-NO(4)
              IF RV-LP-TRCD NOT = "  "
                 PERFORM REMOVE-AUTO-FORM-REQUESTS
              ELSE
                 PERFORM UPDATE-AUTO-FM-NO.

           ADD 1 TO SUB.
           GO TO UPDATE-NEXT-AUTO-FORM.

       EXIT-UPDATE-AUTO-FORM.
           EXIT.

      ******************************
       UPDATE-AUTO-FM-NO SECTION.
      ******************************
           PERFORM OPEN-FD1-FILE.

           MOVE 0 TO MSUB.
       UPDATE-AUTO-FM-NO-NEXT.
           ADD 1 TO MSUB.
           IF MSUB > 4
              GO TO EXIT-UPDATE-AUTO-FM-NO.

           IF FORM-NO(MSUB) = 0
              GO TO UPDATE-AUTO-FM-NO-NEXT.
           IF LN-SSNO(MSUB) = 0
              GO TO UPDATE-AUTO-FM-NO-NEXT.

           MOVE FORM-NO(MSUB) TO FD-FMNO.
           PERFORM READ-FD1-FILE.
           IF IO-FG NOT = 0
              GO TO UPDATE-AUTO-FM-NO-NEXT.

      * NEED TO RESET FM-PATH-OVERIDE BECAUSE FD-OPTION MAY
      *  CHANGE MULTIPLE TIMES.

           MOVE SPACES                     TO FM-PATH-OVERRIDE.
           IF ( FD-OPTION-EXTRACTION )
              PERFORM GET-FM-PATH.

           PERFORM OPEN-FM1-FILE.

           PERFORM GET-BORROWER.

           PERFORM CLEAR-FM-FILE.

           MOVE SPACES             TO LPWSFM-EDIT-FM-INITKEY.
           MOVE LN-ACCTNO          TO LPWSFM-EDIT-FM-ACCTNO.
           MOVE FORM-NO(MSUB)      TO LPWSFM-EDIT-FM-FORMNO.
           IF ( FD-OPTION-EXTRACTION )
               MOVE LN-OWNBR       TO LPWSFM-EDIT-FM-BRNO2.

           MOVE FM-PATH-OWNBR          TO FM-BRNO.
           MOVE LPWSFM-EDIT-FM-INITKEY TO FM-INITKEY.
           MOVE FORM-NO(MSUB)          TO FM-FMNO.

           MOVE FM1-KEY       TO HOLD-FM1-KEY.
           PERFORM READ-FM1-FILE.

           MOVE BW-ZIP             TO FM-ZIP.
           MOVE SPACES             TO FM-PRINT.
           MOVE 0                  TO FM-STMT-COUNTER.
           MOVE TRANS-DATE         TO FM-TRDATE.
           MOVE EXT-CONAME-USER-ID TO FM-USERID.

           IF IO-FG = 0
              PERFORM REWRITE-FM1-FILE
           ELSE
              MOVE HOLD-FM1-KEY TO FM1-KEY
              PERFORM WRITE-FM1-FILE.

           PERFORM CLOSE-FM1-FILE.

           GO TO UPDATE-AUTO-FM-NO-NEXT.

       EXIT-UPDATE-AUTO-FM-NO.
           PERFORM CLOSE-FD1-FILE.

      * IF CORPORATE FORM PRINTING, MUST SET FM-PATH BACK TO ORIGINAL
      * POSTING BRANCH, SO RECEIPT WILL GO IN THE RIGHT PLACE.
           IF ( FD-OPTION-EXTRACTION )
              IF GP-CORP-BRNO NOT = 0
                 PERFORM LOAD-FM1-FILE.

      *************************************
       REMOVE-AUTO-FORM-REQUESTS SECTION.
      *************************************

           PERFORM OPEN-FD1-FILE.

           MOVE 0 TO MSUB.
       REMOVE-AUTO-FORM-NEXT.
           ADD 1 TO MSUB.
           IF MSUB > 4
              GO TO EXIT-REMOVE-AUTO-FORM.

           PERFORM GET-BORROWER.

           MOVE FORM-NO(MSUB) TO FD-FMNO.
           PERFORM READ-FD1-FILE.
           IF IO-FG NOT = 0
              GO TO REMOVE-AUTO-FORM-NEXT.

           MOVE SPACES                     TO FM-PATH-OVERRIDE.
           IF ( FD-OPTION-EXTRACTION )
              PERFORM GET-FM-PATH.

           PERFORM OPEN-FM1-FILE.

           MOVE SPACES TO FM-REC LPWSFM-EDIT-FM-INITKEY.

           MOVE FM-PATH-OWNBR      TO FM-BRNO.

           MOVE LN-ACCTNO          TO LPWSFM-EDIT-FM-ACCTNO.
           MOVE FORM-NO(MSUB)      TO LPWSFM-EDIT-FM-FORMNO.
           IF ( FD-OPTION-EXTRACTION )
              MOVE LN-OWNBR        TO LPWSFM-EDIT-FM-BRNO2.
           MOVE LPWSFM-EDIT-FM-INITKEY TO FM-INITKEY.
           MOVE FORM-NO(MSUB)      TO FM-FMNO.

           PERFORM READ-FM1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-FM1-FILE.
      *    ELSE
      *       UNLOCK FM-FILE.

           GO TO REMOVE-AUTO-FORM-NEXT.

       EXIT-REMOVE-AUTO-FORM.
           PERFORM CLOSE-FM1-FILE.
           PERFORM CLOSE-FD1-FILE.

      ***************************************************
       GET-FM-PATH SECTION.
      ***************************************************

      * IF FORM IS AN "E" EXTRACTION TYPE FORM (FD-OPTION), THEN
      * PUT THE CORPORATE BRNO PATH IN THE FM-PATH, SO ALL FORM REQUESTS
      * ARE CREATED IN THE HOME OFFICE, THEN WHEN THEY GO "PRINT" THEM ALL
      * IT WILL CREATE AN ASCII FILE

           IF GP-CORP-BRNO = 0
              GO TO EXIT-GET-FM-PATH.

           MOVE GP-CORP-BRNO TO BR-NO.
           PERFORM READ-BR-FILE.
           IF IO-FG = 9
              GO TO END-GET-FM-PATH.

           MOVE EXT-FILPATH-BASE           TO FM-ALL-BASE.
           MOVE BR-MACHINE                 TO FM-ALL-MACHINE.
           MOVE BR-DATA-PATH               TO FM-ALL-DATA.
           MOVE FM-ALL-PATH                TO FM-PATH.
           MOVE "Y"                        TO FM-PATH-OVERRIDE.

       END-GET-FM-PATH.
      * GET ORIGINAL BRANCH BACK
           MOVE BRANCH TO BR-NO.
           PERFORM READ-BR-FILE.

       EXIT-GET-FM-PATH.
           EXIT.

      *********************************
       REMOVE-TEMP-CHECKS SECTION.
      *********************************
           PERFORM OPEN-CX1-FILE.

           MOVE BRANCH TO CX-BRNO.
           MOVE SPACES TO CX-TYPE.
           MOVE 0      TO CX-SEQNO.

           PERFORM START-CX1-FILE.
       NEXT-TEMP-CHECK.
           PERFORM READ-CX1-FILE-NEXT.
           IF IO-FG = 9 OR (CX-BRNO NOT = BRANCH)
              GO TO EXIT-REMOVE-TEMP-CHECKS.

           IF CX-REF NOT = LN-ACCTNO
              GO TO NEXT-TEMP-CHECK.
           IF CX-PGM NOT = "F2"
              GO TO NEXT-TEMP-CHECK.
           PERFORM REMOVE-CHECK-FORM-REQ.
           PERFORM DELETE-CX1-FILE.
           GO TO NEXT-TEMP-CHECK.
       EXIT-REMOVE-TEMP-CHECKS.
           PERFORM CLOSE-CX1-FILE.

      *****************************************
       REMOVE-CHECK-FORM-REQ SECTION.
      *****************************************
           MOVE "REMOVING CHECK FORM REQUEST........." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-FM1-FILE.

           MOVE FM-PATH-OWNBR TO FM-BRNO.

           MOVE SPACES                 TO LPWSFM-EDIT-FM-INITKEY.
           MOVE CX-BRNO                TO LPWSFM-EDIT-FM-BRNO.
           MOVE CX-TYPE                TO LPWSFM-EDIT-FM-TYPE
           MOVE CX-SEQNO               TO LPWSFM-EDIT-FM-SEQNO.
           MOVE 0                      TO LPWSFM-EDIT-FM-CKFMNO FM-FMNO.
           MOVE LPWSFM-EDIT-FM-INITKEY TO FM-INITKEY.


           PERFORM START-FM1-FILE.
       REMOVE-NEXT-CHECK-REQUEST.
           PERFORM READ-FM1-FILE-NEXT.
           MOVE FM-INITKEY TO LPWSFM-EDIT-FM-INITKEY.
           IF IO-FG = 0
              IF (LPWSFM-EDIT-FM-BRNO NOT = CX-BRNO) OR
                  (LPWSFM-EDIT-FM-TYPE NOT = CX-TYPE)
                 MOVE 9 TO IO-FG.

           IF IO-FG NOT = 0 OR (FM-BRNO NOT = FM-PATH-OWNBR)
              GO TO EXIT-REMOVE-FM1.

           IF LPWSFM-EDIT-FM-SEQNO NOT = CX-SEQNO
      *       UNLOCK FM-FILE
              GO TO REMOVE-NEXT-CHECK-REQUEST.

           PERFORM DELETE-FM1-FILE.

       EXIT-REMOVE-FM1.
           PERFORM CLOSE-FM1-FILE.

      ********************************
       UPDATE-PROMISED-INFO SECTION.
      ********************************

           IF GP-PROM-AMT-MIN-PCT = X"202020"
              MOVE 0 TO GP-PROM-AMT-MIN-PCT.
           IF GP-PROM-AMT-MIN-PCT > 0
              COMPUTE MIN-PROMISE-AMT ROUNDED =
                 (GP-PROM-AMT-MIN-PCT * LN-PROMAMT / 100)
              IF LP-TRAMT < MIN-PROMISE-AMT
                 GO TO EXIT-UPDATE-PROMISED-INFO.

           MOVE LN-PROMDATE TO SAVE-LN-PROMDATE.
           MOVE LN-PROMAMT TO SAVE-LN-PROMAMT.
           MOVE LN-PROMID TO SAVE-LN-PROMID.
           MOVE LN-PROMDAYS-PASTDUE TO SAVE-LN-PROMDAYS.

           IF GP-CLEAR-PROM-PDTH = "Y"
              IF LP-PDTH-DATE NOT > HOLD-PDTH-DATE
                 GO TO EXIT-UPDATE-PROMISED-INFO.

           MOVE 0 TO LN-PROMDATE LN-PROMAMT PROM-DATE.
           MOVE SPACES TO LN-PROMID.
           MOVE 0 TO LN-PROMDAYS-PASTDUE.

           IF HOLD-BP-TRCD = " "
              MOVE PROM-DATE TO WR-BUF
              MOVE PROM-LIST TO WR-LIST
              PERFORM CALL-WRFORM.

           IF BR-SECOND-PROMISE = "Y"
              IF (LN-PROMDATE2 NOT = 0 AND LN-CURBAL NOT = 0)
                 MOVE LN-PROMDATE2 TO LN-PROMDATE DATE-YYYYMMDD
                 PERFORM CONVERT-YYYYMMDD-TO-MMDDYY
                 MOVE DATE-MMDDYY TO PROM-DATE
                 MOVE SAVE-LN-PROMID TO LN-PROMID
                 MOVE SAVE-LN-PROMDAYS TO LN-PROMDAYS-PASTDUE
                 MOVE 0 TO LN-PROMDATE2
                 IF HOLD-BP-TRCD = " "
                    MOVE PROM-DATE TO WR-BUF
                    MOVE PROM-LIST TO WR-LIST
                    PERFORM CALL-WRFORM.

       EXIT-UPDATE-PROMISED-INFO.
            EXIT.

      **************************************************
       UPDATE-LN1-REVERSAL SECTION.
      **************************************************

           MOVE 0 TO FOUND-LN-INTPDTH-DATE
                     FOUND-LN-LAST-PYPA-DATE
                     FOUND-LN-DATE-PAID-LAST
                     FOUND-LN-AMT-PAID-LAST
                     FOUND-LN-PY-YYYYMM-RECDEL
                     FOUND-LN-PY-YYYYMM-RECDEL-WK
                     FOUND-LN-REMAIN-INT-SINCE-LFP
                     FOUND-LN-REMAIN-PRIN-SINCE-LFP
                     FOUND-LN-MIP-CLPDTH-DATE
                     FOUND-LN-MIP-AHPDTH-DATE.

           PERFORM OPEN-LP1-FILE.

           MOVE LN-OWNBR  TO LP-BRNO
                             QLP1-WBEG-BRNO
                             QLP1-WEND-BRNO.
           MOVE LN-ACCTNO TO LP-ACCTNO
                             QLP1-WBEG-ACCTNO
                             QLP1-WEND-ACCTNO.
           MOVE 99999     TO LP-SEQNO
                             QLP1-WEND-SEQNO.
           MOVE ALL "0"   TO QLP1-WBEG-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.
       UPDATE-NEXT-REVERSAL.
           PERFORM READ-LP1-FILE-PREVIOUS.
           IF ( IO-FG NOT = 0) OR (LP-BRNO NOT = LN-OWNBR) OR
                                   (LP-ACCTNO NOT = LN-ACCTNO)
      * SHOULD NEVER,NEVER HAPPEN; WILL ALWAYS FIND A SEQNO = 1
      * ON FOLLOWING STATEMENT
              GO TO END-UPDATE-LN1-REVERSAL.

           IF LP-SEQNO = 1
              IF FOUND-LN-REMAIN-INT-SINCE-LFP  = 0 AND
                 FOUND-LN-REMAIN-PRIN-SINCE-LFP = 0
                 MOVE LP-REMAIN-INT-SINCE-LFP
                         TO FOUND-LN-REMAIN-INT-SINCE-LFP
                 MOVE LP-REMAIN-PRIN-SINCE-LFP
                         TO FOUND-LN-REMAIN-PRIN-SINCE-LFP
              END-IF
              IF LN-MIP-FG = "Y"
                 IF FOUND-LN-MIP-CLPDTH-DATE = 0 AND
                    FOUND-LN-MIP-AHPDTH-DATE = 0
                    PERFORM UPDATE-LN1-REVERSAL-GET-LXM
                 END-IF
              END-IF
              PERFORM UPDATE-LN1-REVERSAL-TEST-BF
              GO TO END-UPDATE-LN1-REVERSAL.

           IF LP-TRCD = "RV" OR LP-REV = "Y"
      *       UNLOCK LP-FILE
              GO TO UPDATE-NEXT-REVERSAL.

           IF LP-TRCD = "ES"
      *       UNLOCK LP-FILE
              GO TO UPDATE-NEXT-REVERSAL.

      * HERE IS A GOOD PAYMENT FOR TEST ON LAST FULL PAYMENT
              PERFORM UPDATE-NEXT-REV-MMYY.

      * HERE IS A GOOD PAYMENT FOR LATE CHARGE PDTH
           IF FOUND-LN-LCPDTH-DATE = 0
              MOVE LP-LCPDTH-DATE TO FOUND-LN-LCPDTH-DATE
      * TEST FOR CONVERTED HISTORY, IF SO DEFAULT TO CURRENT DUE DAY:
              IF LP-SSNO = 999999999
                 MOVE LN-1STPYDA TO FOUND-LN-LCPDTH-DATE-DA.

      * NOW, TEST IF IT IS A GOOD PAYMENT FOR:
      *      -  LN-MIP-CLPDTH-DATE
      *      -  LN-MIP-AHPDTH-DATE
      
           IF LN-MIP-FG = "Y"
              IF FOUND-LN-MIP-CLPDTH-DATE = 0 AND
                 FOUND-LN-MIP-AHPDTH-DATE = 0
                 IF LP-TRCD = "PY" OR "PA" OR "PE" OR "PR"
                           OR "PC" OR "PP" OR "SS" OR "IN"
                           OR "AH" OR "PX" OR "PN" OR "PZ"
                    PERFORM UPDATE-LN1-REVERSAL-GET-LXM.

      * NOW, TEST IF IT IS A GOOD PAYMENT FOR:
      *      -  INTEREST ASSESSED THRU
      *      -  LAST PAYMENT DATE
      *      -  LFP FIELDS
      
           IF LP-TRCD = "PY" OR "PA" OR "PO" OR "PE" OR "SS"
                             OR "RN" OR "SC" OR "PB" OR "RB"
                             OR "RO" OR "DF" OR "D2" OR "D3"
                             OR "D4" OR "D5" OR "D6"
                             OR "D7" OR "D8" OR "D9"
                             OR "AI" OR "CI" OR "IR" OR "IN"
                             OR "RT" OR "ET" OR "LP" OR "NP"
                             OR "ST" OR "PR" OR "PC" OR "PP"
                             OR "Z2" OR "AH" OR "PN" OR "PZ"
      * HAD TO ADD FOR CONVERSIONS
                             OR "BF"
              NEXT SENTENCE
           ELSE
      *       UNLOCK LP-FILE
              GO TO UPDATE-NEXT-REVERSAL.

      * UPDATE LFP FIELDS:
           IF FOUND-LN-REMAIN-INT-SINCE-LFP  = 0 AND
              FOUND-LN-REMAIN-PRIN-SINCE-LFP = 0
              MOVE LP-REMAIN-INT-SINCE-LFP
                      TO FOUND-LN-REMAIN-INT-SINCE-LFP
              MOVE LP-REMAIN-PRIN-SINCE-LFP
                      TO FOUND-LN-REMAIN-PRIN-SINCE-LFP.

      * YES, IT IS A GOOD PAYMENT FOR INTEREST ASSESSED THRU
           IF FOUND-LN-INTPDTH-DATE = 0
              IF LP-TRCD = "RT" OR "ET" OR "LP" OR "NP" OR "ST"
                 MOVE LP-TRDATE  TO FOUND-LN-INTPDTH-DATE
              ELSE
                 MOVE LP-PAYDATE TO FOUND-LN-INTPDTH-DATE.

      * NOW, TEST IF IT IS A GOOD PAYMENT FOR LAST PAYMENT DATE
      
           IF LP-TRCD = "AI" OR "CI" OR "IR" OR "PZ" OR
                        "RT" OR "ET" OR "LP" OR "NP" OR "ST"
              GO TO UPDATE-NEXT-REVERSAL.

      * YES, IT IS A GOOD PAYMENT FOR LAST PAYMENT DATE
      *      SO WE ARE DONE, FALL INTO END
      
           IF FOUND-LN-DATE-PAID-LAST = 0
              MOVE LP-TRAMT   TO FOUND-LN-AMT-PAID-LAST
              MOVE LP-PAYDATE TO FOUND-LN-DATE-PAID-LAST.

           IF FOUND-LN-LAST-PYPA-DATE = 0
              IF LP-TRCD = "PY" OR "PA"
                 MOVE LP-PAYDATE TO FOUND-LN-LAST-PYPA-DATE.

           IF FOUND-LN-PY-YYYYMM-RECDEL = 0
      *       UNLOCK LP-FILE
              GO TO UPDATE-NEXT-REVERSAL.

       END-UPDATE-LN1-REVERSAL.
           PERFORM CLOSE-LP1-FILE.

           PERFORM OPEN-LN1-FILE.
           PERFORM READ-LN1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

      * SET MIP FIELDS
      *   -  LN-MIP-CLPDTH-DATE
      *   -  LN-MIP-AHPDTH-DATE
      
           IF LN-MIP-FG = "Y"
              IF FOUND-LN-MIP-CLPDTH-DATE NOT = 0
                 MOVE FOUND-LN-MIP-CLPDTH-DATE TO LN-MIP-CLPDTH-DATE
                 MOVE FOUND-LN-MIP-AHPDTH-DATE TO LN-MIP-AHPDTH-DATE.

      * SET LFP FIELDS:
      
           IF SP-CAL-RATETYPE(1) = "Z"
              MOVE FOUND-LN-REMAIN-INT-SINCE-LFP
                      TO LN-REMAIN-INT-SINCE-LFP
              MOVE FOUND-LN-REMAIN-PRIN-SINCE-LFP
                      TO LN-REMAIN-PRIN-SINCE-LFP.

           IF HOLD-LP-TRCD NOT = "PZ"
              MOVE FOUND-LN-DATE-PAID-LAST TO LN-DATE-PAID-LAST
              MOVE FOUND-LN-AMT-PAID-LAST  TO LN-AMT-PAID-LAST.

           MOVE FOUND-LN-LAST-PYPA-DATE TO LN-LAST-PYPA-DATE.

           IF SP-CAL-RATETYPE(1) NOT = "Z"
              MOVE FOUND-LN-INTPDTH-DATE TO LN-INTPDTH-DATE.

           MOVE FOUND-LN-LCPDTH-DATE TO LN-LCPDTH-DATE.
           IF LN-PY-YYYYMM-RECDEL = 0
              IF (GP-RECDEL-REVERSAL-FG = "N")
                 IF LN-MTD-PAYS-RECDEL = 0
                    MOVE FOUND-LN-PY-YYYYMM-RECDEL TO
                               LN-PY-YYYYMM-RECDEL
                 END-IF
              ELSE
                 IF LN-MTD-PAYS-RECDEL < 0
                   MOVE FOUND-LN-PY-YYYYMM-RECDEL TO
                              LN-PY-YYYYMM-RECDEL.

           IF SP-ERNFRMLA(1) = 15
              PERFORM SET-ERNFRMLA-15-EARN-RV
           ELSE
              IF SP-ERNFRMLA(5) = 16
                 PERFORM SET-ERNFRMLA-16-EARN-RV.

           PERFORM CHECK-FOR-REV-OVER-EXP.

           PERFORM CHECK-BNKRPTDATE.

           MOVE " " TO LN-BI-FG.

           PERFORM REWRITE-LN1-FILE.

           PERFORM UPDATE-NOTICE-FILE.

       EXIT-UPDATE-LN1-REVERSAL.
           PERFORM CLOSE-LN1-FILE.

      ***********************************************
       UPDATE-LN1-REVERSAL-TEST-BF SECTION.
      ***********************************************
           IF FOUND-LN-LCPDTH-DATE = 0
              MOVE LP-LCPDTH-DATE TO FOUND-LN-LCPDTH-DATE.
           IF LP-TRCD = "BF" AND FOUND-LN-INTPDTH-DATE = 0
              MOVE LP-PAYDATE TO FOUND-LN-INTPDTH-DATE.
           IF LP-TRCD = "BF" AND FOUND-LN-DATE-PAID-LAST = 0
              MOVE LP-TRAMT TO FOUND-LN-AMT-PAID-LAST
              MOVE LP-PAYDATE TO FOUND-LN-DATE-PAID-LAST.

      ******************************************************
       UPDATE-LN1-REVERSAL-GET-LXM SECTION.
      ******************************************************
           MOVE LP-BRNO   TO LX-BRNO.
           MOVE LP-ACCTNO TO LX-ACCTNO.
           MOVE LP-SEQNO  TO LX-SEQNO.
           PERFORM OPEN-LX1-FILE.
           PERFORM READ-LX1-FILE.
           PERFORM CLOSE-LX1-FILE.
           IF IO-GOOD
              MOVE LXM-MIP-CLPDTH-DATE TO FOUND-LN-MIP-CLPDTH-DATE
              MOVE LXM-MIP-AHPDTH-DATE TO FOUND-LN-MIP-AHPDTH-DATE.

      *******************************************************
       CHECK-FOR-EXPIRATION SECTION.
      *******************************************************
           PERFORM EXPIRATION-DATE-CALCULATION.
           IF LP-TRCD  = "RV"
              GO TO EXIT-CHECK-FOR-EXPIRATION.
           SET STFG TO 1.
           SEARCH LN-STATUSFLAGS
              AT END GO TO AT-END-SKIP
              WHEN LN-STATUSFLAGS(STFG) = "E"
              GO TO EXIT-CHECK-FOR-EXPIRATION.
       AT-END-SKIP.
           MOVE XDTE-DATE TO NUM-DATE.
           MOVE LP-PAYDATE TO SYS-DATE.
           PERFORM TIM.
           MOVE LN-DATE-PAID-LAST TO NUM-DATE.
           IF LN-DATE-PAID-LAST = 0
              MOVE LN-INTDATE TO NUM-DATE.
           IF ELAPSED-DAYS NOT < 0
              MOVE XDTE-DATE TO SYS-DATE
              PERFORM TIM
              IF ELAPSED-DAYS NOT < 0
                 SET STFG TO 1
                 SEARCH LN-STATUSFLAGS
                 AT END PERFORM PREPARE-TO-SHIFT
                 WHEN LN-STATUSFLAGS(STFG) = " "
                    MOVE "E" TO LN-STATUSFLAGS(STFG).

       EXIT-CHECK-FOR-EXPIRATION.
           EXIT.

      *******************************************************
       CHECK-FOR-REV-OVER-EXP SECTION.
      *******************************************************
           PERFORM EXPIRATION-DATE-CALCULATION.
           MOVE XDTE-DATE TO NUM-DATE.
           MOVE LN-DATE-PAID-LAST TO SYS-DATE.
           PERFORM TIM.
           MOVE LP-PAYDATE TO NUM-DATE.
      *CS CHANGED TO ELAPSED DAYS NOT > 0 WAS ELAPSED DAYS NOT < 0. WHEN
      *   ELAPSED DAYS WOULD BE NEGATIVE IF NOT EXPIRED.
           IF ELAPSED-DAYS NOT > 0
              MOVE XDTE-DATE TO SYS-DATE
              PERFORM TIM
              IF ELAPSED-DAYS > 0
                 SET STFG TO 1
                 SEARCH LN-STATUSFLAGS
                    AT END  GO TO EXIT-CHECK-FOR-REV-OVER-EXP
                 WHEN LN-STATUSFLAGS(STFG) = "E"
                    MOVE " " TO LN-STATUSFLAGS(STFG).

       EXIT-CHECK-FOR-REV-OVER-EXP.
           EXIT.


      *******************************************************
       CHECK-BNKRPTDATE SECTION.
      *******************************************************
           IF RV-LP-TRCD NOT = "BD"
              GO TO EXIT-CHECK-BNKRPTDATE.

           SET STFG TO 1.
           SEARCH LN-STATUSFLAGS
              AT END  GO TO EXIT-CHECK-BNKRPTDATE
              WHEN LN-STATUSFLAGS(STFG) = "B"
                 IF LN-BNKRPTDATE = ZEROS
                    PERFORM FIND-BNKRPTDATE
                 END-IF.
       EXIT-CHECK-BNKRPTDATE.
           EXIT.


      *******************************************************
       FIND-BNKRPTDATE SECTION.
      *******************************************************
           PERFORM OPEN-LP1-FILE.

           MOVE LN-OWNBR  TO LP-BRNO
                             QLP1-WBEG-BRNO
                             QLP1-WEND-BRNO.
           MOVE LN-ACCTNO TO LP-ACCTNO
                             QLP1-WBEG-ACCTNO
                             QLP1-WEND-ACCTNO.
           MOVE 99999     TO LP-SEQNO
                             QLP1-WEND-SEQNO.
           MOVE ALL "0"   TO QLP1-WBEG-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.
       FIND-NEXT-BK.
           PERFORM READ-LP1-FILE-PREVIOUS.
           IF IO-FG NOT = 0
              GO TO FIND-BNKRPTDATE-END.

           IF (LP-BRNO NOT = LN-OWNBR) OR (LP-ACCTNO NOT = LN-ACCTNO)
              GO TO FIND-BNKRPTDATE-END.

           IF NOT( LP-TRCD = "BK" AND LP-REV = " ")
              GO TO FIND-NEXT-BK.
           MOVE LP-PAYDATE TO LN-BNKRPTDATE.
       FIND-BNKRPTDATE-END.
           PERFORM CLOSE-LP1-FILE.
       FIND-BNKRPTDATE-EXIT.
           EXIT.


      ******************************************************
       SET-ERNFRMLA-15-EARN-RV SECTION.
      ******************************************************

      * SET ERNFRMLA 15 EARN FIELDS (REVERSAL)
      *  WORKERS ARE NOT ADJUSTED ON PAYOFFS
           IF ONE = 0
              IF HOLD-LP-TRCD = "PY" OR "PA" OR "PR" OR "PC" OR "PP"
                                     OR "PE" OR "SS" OR "Z2" OR "IN"
                                     OR "RT" OR "ET" OR "LP"
                                     OR "NP" OR "ST" OR "AH"
                                     OR "PN" OR "PZ"
                 MOVE FOUND-LN-INTPDTH-DATE TO LN-ERN-IB-PDTH-DATE
                 COMPUTE LN-ERN-IB-PRINBAL = LN-ERN-IB-PRINBAL
                              - (SAVE-LP-APCUR - HOLD-EARNINGS-IB)
                 MULTIPLY -1 BY LXE-WORKER GIVING LN-ERN-IB-INTOWE.

      ******************************************************
       SET-ERNFRMLA-16-EARN-RV SECTION.
      ******************************************************

      * SET ERNFRMLA 16 EARN FIELDS (REVERSAL)
      * WORKERS ARE NOT ADJUSTED ON PAYOFFS

           IF ONE = 0
              IF HOLD-LP-TRCD = "PY" OR "PA" OR "PR" OR "PC" OR "PP"
                                     OR "PE" OR "SS" OR "Z2" OR "IN"
                                     OR "RT" OR "ET" OR "LP"
                                     OR "NP" OR "ST" OR "AH"
                                     OR "PN" OR "PZ"
                 MOVE FOUND-LN-INTPDTH-DATE TO LN-ERN-IB-PDTH-DATE
                 COMPUTE LN-ERN-IB-PRINBAL = LN-ERN-IB-PRINBAL
                              - (SAVE-LP-APCUR - LXE-WORKER2)
                 MULTIPLY -1 BY LXE-WORKER GIVING LN-ERN-IB-INTOWE.

      ***********************************************
       UPDATE-NOTICE-FILE SECTION.
      ***********************************************
           PERFORM OPEN-NO1-FILE.
           MOVE LN-OWNBR  TO NO-BRNO.
           MOVE LN-ACCTNO TO NO-ACCTNO.
           PERFORM READ-NO1-FILE.

           MOVE TRANS-DATE    TO CRNOR2-SYSDATE.
      * THIS GETS PERFORMED IN UPDATE-BNKRPT-TRAILER WITH 
      * LN-BNKRPTDATE, NEED TO PERFORM AGAIN WITH TODAY AND WRITE IT
           MOVE " "           TO CRNOR2-LPREC-FG.
           PERFORM CREATE-NOTICE-RECORD.

           MOVE LN-OWNBR  TO NO-BRNO.
           MOVE LN-ACCTNO TO NO-ACCTNO.
           IF IO-FG = 0
              PERFORM REWRITE-NO1-FILE
           ELSE
              PERFORM WRITE-NO1-FILE.

           PERFORM CLOSE-NO1-FILE.
       EXIT-UPDATE-NOTICE-FILE.
           EXIT.

      **************************************************************
       PREPARE-TO-SHIFT SECTION.
      **************************************************************

           IF NOT (LP-TRCD = "JD" OR "AC" OR "IR" OR "PL"
                                  OR "P2" OR "P3" OR "P4"
                                  OR "P5" OR "PI" OR "PW")
                   GO TO EXIT-PREPARE-TO-SHIFT.

           SET STFG TO 1.
       SHIFT-LOOP.
           MOVE LN-STATUSFLAGS(STFG + 1) TO LN-STATUSFLAGS(STFG).
           SET STFG UP BY 1.
           IF STFG < 10
              GO TO SHIFT-LOOP.
           IF LP-TRCD = "JD"
              MOVE "J" TO LN-STATUSFLAGS(STFG)
           ELSE
           IF LP-TRCD = "AC"
              MOVE "A" TO LN-STATUSFLAGS(STFG)
           ELSE
           IF LP-TRCD = "IR"
              MOVE "R" TO LN-STATUSFLAGS(STFG)
           ELSE
           IF PL-POSTING
              IF NOT (TRCD-PLTYPE = "2" OR "3" OR "4" OR "5")
                 MOVE "P" TO LN-STATUSFLAGS(STFG)
              ELSE
                 MOVE TRCD-PLTYPE TO LN-STATUSFLAGS(STFG)
           ELSE
           IF LP-TRCD = "PI"
              MOVE "I" TO LN-STATUSFLAGS(STFG)
           ELSE
           IF LP-TRCD = "PW"
              MOVE "W" TO LN-STATUSFLAGS(STFG).

       EXIT-PREPARE-TO-SHIFT.
           EXIT.

       COPY "LIBLP/UPDATEREPAYTRP.CPY".
       COPY "LIBLP/UPDATEREPAYNO.CPY".
       COPY "LIBLP/DEFPOL.CPY".
       COPY "LIBLP/LPXDTE.CPY".
       COPY "LIBLP/LPMDTE.CPY".
       COPY "LIBLP/LPCDEL.CPY".
       COPY "LIBLP/LPCEPP.CPY".
       COPY "LIBGB/SPPDTH.CPY".
       COPY "LIBGB/AGEING.CPY".
       COPY "LIBLP/LPUPWK.CPY".
       COPY "LIBLP/LPUPER.CPY".
       COPY "LIBGB/DATER.CPY".
       COPY "LIBGB/SCREEN.CPY".
       COPY "LIBLP/LPSTAT.CPY".
       COPY "LIBLP/LPEARN.CPY".
       COPY "LIBLP/POSTDATE.CPY".
       COPY "LIBLP/LPSRCD.CPY".
       COPY "LIBGB/RBACT.CPY".
       COPY "LIBLP/LPAVCR.CPY".
       COPY "LIBLP/LPPOFF.CPY".
       COPY "LIBLP/LPPOF2.CPY".
       COPY "LIBLP/LPAMTS.CPY".
       COPY "LIBLP/LPIBPC.CPY".
       COPY "LIBLP/LPRATE.CPY".
       COPY "LIBGB/REBATE.CPY".
       COPY "LIBGB/GPENV.CPY".
       COPY "LIBLP/LPTDEL.CPY".
       COPY "LIBLP/LPITRM.CPY".
       COPY "LIBLP/LPLCAP.CPY".
       COPY "LIBLP/LPLCHG.CPY".
       COPY "LIBLP/LPLCAS.CPY".
       COPY "LIBLP/LPAPRS.CPY".
       COPY "LIBLP/LPAPRZ.CPY".
       COPY "LIBLP/LPSCHD.CPY".
       COPY "LIBLP/SETCTBL.CPY".
       COPY "LIBLP/ADDONSPR.CPY".
       COPY "LIBLP/LPPDUE.CPY".
       COPY "LIBLP/LPFRFD.CPY".
       COPY "LIBGB/TIMEIO.CPY".


      **************************************************************************
       SETUP-LINK-INFO SECTION.
      **************************************************************************
           MOVE LONPF-HELP--FILE TO HELP-LINK-FILE.
           MOVE LONPF-HELP--DIR TO HELP-LINK-DIR.

      **************************************************************************
       VDU-CONVERT-FIELD SECTION.
      **************************************************************************
           MOVE "00" TO STAT.
           MOVE VDU-FIELD-TO-CONVERT TO VDU-ALP-FIELD.
           EVALUATE TRUE
              COPY "LIBLP/LONPF_EVA.CPY".
              WHEN OTHER       MOVE   "2A" TO STAT
           END-EVALUATE.

      *************************************
       MISCELLANEOUS-ROUTINES SECTION.
      *************************************
       COPY "LIBGB/GETPR.CPY".
       COPY "LIBGB/GETENV.CPY".
       COPY "LIBGB/DACCESS.CPY".
       COPY "LIBGB/ACCESS.CPY".
       COPY "LIBGB/SYSTEM.CPY".
       FORM-RESET.
       MOVE-LXZ-FIELDS.
           MOVE "Z"                      TO LXZ-CODE.
           MOVE HOLD-LXZ-POST-REGPY      TO LXZ-POST-REGPY.
           MOVE HOLD-LXZ-POST-EXTRA-PRIN TO LXZ-POST-EXTRA-PRIN.
           MOVE HOLD-LXZ-POST-OTH        TO LXZ-POST-OTH.
           MOVE HOLD-LXZ-POST-LCHG       TO LXZ-POST-LCHG.
           MOVE HOLD-LXZ-PDUE-APINT      TO LXZ-PDUE-APINT.
           MOVE HOLD-LXZ-PDUE-APPRIN     TO LXZ-PDUE-APPRIN.
           MOVE HOLD-LXZ-CUR-APINT       TO LXZ-CUR-APINT.
           MOVE HOLD-LXZ-CUR-APPRIN      TO LXZ-CUR-APPRIN.

       MOVE-LXM-FIELDS.
           MOVE "M"       TO LXM-CODE.
           MOVE 0         TO LXM-MIP-CLPAID
                             LXM-MIP-AHPAID
                             LXM-MIP-CLPDTH-DATE
                             LXM-MIP-AHPDTH-DATE.
           IF HOLD-LP-TRCD = "CC"
              MOVE HOLD-LXM-MIP-CLPDTH TO LXM-MIP-CLPDTH-DATE
           ELSE
              IF HOLD-LP-TRCD = "CA"
                 MOVE HOLD-LXM-MIP-AHPDTH TO LXM-MIP-AHPDTH-DATE
              ELSE
                 MOVE HOLD-LXM-MIP-CLPAID TO LXM-MIP-CLPAID
                 MOVE HOLD-LXM-MIP-AHPAID TO LXM-MIP-AHPAID
                 MOVE HOLD-LXM-MIP-CLPDTH TO LXM-MIP-CLPDTH-DATE
                 MOVE HOLD-LXM-MIP-AHPDTH TO LXM-MIP-AHPDTH-DATE.

       CREATE-NOTICE-RECORD.
           MOVE LN-ACCTNO          TO CRNOR2-ACCTNO.
           MOVE "PO"               TO CRNOR2-LPTRCD.
           MOVE "Y"                TO CRNOR2-RECAST-FG.
           MOVE "CL/CRNOR2" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CRNOR2-LINK
                                 NO-REC POFF-WORKERS LN-REC.
           CANCEL FORM-PROGX.
       CONDITIONAL-SEND-MESS.
           IF EXT-ROUTE-BUF = "00"
              PERFORM SEND-MESS.
       CHECK-GP-BK-FLAG-UNSET.
           IF GP-BK-FLAG-CONFIDENTIAL = "Y"
              MOVE "N" TO LN-CONFIDENTCD
           ELSE
      * GP-BK-FLAG-CONFIDENTIAL OF "L" TEST FOR BANKRUPT AND LEGAL
      * TOGETHER, SO BOTH MUST BE 0 TO CLEAR CONFIDENTIAL FLAG
      * IF FLAG = "L", MUST CHECK IF LEGAL IS STILL SET
              IF GP-BK-FLAG-CONFIDENTIAL = "L"
                 IF LN-LEGALDATE = 0
                    MOVE "N" TO LN-CONFIDENTCD.
       GET-BORROWER.
           PERFORM OPEN-BW1-FILE.
           MOVE LN-SSNO(MSUB) TO BW-SSNO.
           PERFORM READ-BW1-FILE.
           IF IO-BAD
              MOVE SPACES TO BW-ZIP.
           PERFORM CLOSE-BW1-FILE.
      *------------------------------------------------
       GET-LXX-TAX.
           PERFORM OPEN-LX1-FILE.
           MOVE LX-PATH-OWNBR TO LX-BRNO.
           MOVE LN-ACCTNO     TO LX-ACCTNO.
           MOVE 1             TO LX-SEQNO.
           PERFORM READ-LX1-FILE.
           IF IO-BAD
              PERFORM CLEAR-LX-FILE
              MOVE LX-PATH-OWNBR TO LX-BRNO
              MOVE LN-ACCTNO     TO LX-ACCTNO
              MOVE 1             TO LX-SEQNO
              MOVE "X"           TO LXX-CODE
              MOVE SPACES        TO LXX-INS-TAX-COUNTY-CD
              MOVE SPACES        TO LXX-INS-TAX-CITY-CD.
           PERFORM CLOSE-LX1-FILE.

       ERROR-SRCD-IS-PL.
           IF SRCD-IS-PL
              MOVE "INTERNAL ERROR: SHOULD NOT BE PL" TO MESS
              PERFORM SEND-MESS.
       ERROR-SRCD-NOT-PL.
           IF SRCD-NOT-PL
              MOVE "INTERNAL ERROR: SHOULD BE PL" TO MESS
              PERFORM SEND-MESS.
       GET-LC.
           MOVE LN-CLASS TO LC-CODE.
           PERFORM OPEN-LC1-FILE.
           PERFORM READ-LC1-FILE.
           PERFORM CLOSE-LC1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
       GET-COLLATERAL.
           PERFORM OPEN-CD1-FILE.
           MOVE LN-COLLCD TO CD-CODE.
           MOVE "CO"      TO CD-TYPE.
           PERFORM READ-CD1-FILE.
           IF IO-FG NOT = 0
              MOVE " " TO CD-CO-SECURED.
           PERFORM CLOSE-CD1-FILE.

       GET-SPLIT-OF-EARNINGS.
           MOVE 1 TO SUB.
           PERFORM SET-ANTIC-AND-ADJ.

           MOVE 2 TO SUB.
           PERFORM SET-ANTIC-AND-ADJ.

           IF SP-RBFRMLA(7) = "D" OR "F"
              MOVE 3 TO SUB
              PERFORM SET-ANTIC-AND-ADJ.
       SET-ANTIC-AND-ADJ.
           COMPUTE LN-ANTICADJ(SUB) = LN-ANTICADJ(SUB) +
                                      LN-ANTICERN(SUB) - LN-ACCERN(SUB).
           COMPUTE LN-ANTICERN(SUB) = LN-ANTICERN(SUB) -
                                      LN-ANTICADJ(SUB).
           MOVE LN-ANTICADJ(SUB) TO WK-TP-WORKAMT(SUB).
       SET-TP-EARNINGS.
           MOVE LN-EARN-ORDER(1) TO WK-SUB.
           IF WK-SUB NOT = 0
              IF WK-SUB > 3
                 MOVE LXE-EARN(WK-SUB - 3) TO TP-EARNINGS(1)
              ELSE
                 MOVE LP-EARNED(WK-SUB) TO TP-EARNINGS(1).

           MOVE LN-EARN-ORDER(2) TO WK-SUB.
           IF WK-SUB NOT = 0
              IF WK-SUB > 3
                 MOVE LXE-EARN(WK-SUB - 3) TO TP-EARNINGS(2)
              ELSE
                 MOVE LP-EARNED(WK-SUB) TO TP-EARNINGS(2).

           MOVE LN-EARN-ORDER(3) TO WK-SUB.
           IF WK-SUB NOT = 0
              IF WK-SUB > 3
                 MOVE LXE-EARN(WK-SUB - 3) TO TP-EARNINGS(3)
              ELSE
                 MOVE LP-EARNED(WK-SUB) TO TP-EARNINGS(3).

           MOVE LN-EARN-ORDER(4) TO WK-SUB.
           IF WK-SUB NOT = 0
              IF WK-SUB > 3
                 MOVE LXE-EARN(WK-SUB - 3) TO TP-EARNINGS(4)
              ELSE
                 MOVE LP-EARNED(WK-SUB) TO TP-EARNINGS(4).

           MOVE LN-EARN-ORDER(5) TO WK-SUB.
           IF WK-SUB NOT = 0
              IF WK-SUB > 3
                 MOVE LXE-EARN(WK-SUB - 3) TO TP-EARNINGS(5)
              ELSE
                 MOVE LP-EARNED(WK-SUB) TO TP-EARNINGS(5).

           MOVE LN-EARN-ORDER(6) TO WK-SUB.
           IF WK-SUB NOT = 0
              IF WK-SUB > 3
                 MOVE LXE-EARN(WK-SUB - 3) TO TP-EARNINGS(6)
              ELSE
                 MOVE LP-EARNED(WK-SUB) TO TP-EARNINGS(6).
       APPEND-BW-NAMES.
           MOVE BW-FNAME TO INSPECT-W.
           MOVE BW-LNAME TO ADD-ON.
           PERFORM ADD-IT.
       ADD-IT.
           INSPECT INSPECT-W REPLACING FIRST "  " BY " +".
           INSPECT INSPECT-W REPLACING FIRST
              "+                                  " BY ADD-ON.
       TEST-SEND-LEGEND.
           IF HOLD-BP-TRCD = " "
              PERFORM SEND-LEGEND.
       SEND-LEGEND.
           MOVE MESS TO WR-BUF.
           MOVE MSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       FULL-BRIEF-ROUTING.
           IF FULL-DISPLAY = "B"
              MOVE 0 TO NEW-PROG-SUB
              MOVE 2 TO ROUTE-CD
            ELSE
              MOVE 1 TO NEW-PROG-SUB
              PERFORM SET-NEW-LOAN-NO
              IF HOLD-BP-TRCD = " "
                 MOVE D-LNNO-BUF TO WR-BUF
                 MOVE D-LNNO-LIST TO WR-LIST
                 PERFORM CALL-WRFORM.
       SET-NEW-LOAN-NO.
           MOVE " " TO D-LNNO-BUF.
           MOVE LN-SSNO(1) TO BW-SSNO.
           PERFORM OPEN-BW1-FILE.
           PERFORM READ-BW1-FILE.
           PERFORM CLOSE-BW1-FILE.
           PERFORM LPSTAT-DISPLAY.
           MOVE LPS-DISPLAY-LNNO TO D-LOAN-NUM.
           MOVE LC-DESC TO D-LCDESC.
       TEST-SAVE-LP1-KEY.
           PERFORM SET-POSTDATE.
           MOVE POST-USERID TO LP-USERID.
           MOVE POST-TIME TO LP-POSTTIME.
           MOVE POST-DATE TO LP-POSTDATE.
           MOVE BRANCH    TO LP-POSTING-BR.
           MOVE LN-COLLECTOR TO LP-COLLECTOR.
           MOVE HOLD-ALT-PREPAY-FG TO LP-ALT-PREPAY-FG.
       SET-TY-KEY.
           MOVE BRNO-FOR-TY TO TY-BRNO.
           MOVE TRANS-DATE  TO TY-DATE.
           MOVE LN-CLASS    TO TY-CLASS.
      *************************************************************
      *   020289  SLC
      *     TP-WORKAMT CONTAINS THE AMOUNT OF EACH COMPONENT THAT
      *  WAS NOT YET EARNED AT THE TIME THE LOAN WENT TO P&L.
      *  LPEOD5 HAS TO BE CHANGED TO DEAL WITH THIS, AS WELL AS
      *  INCLUDING IB LOANS.
      *************************************************************
       GET-TP-WORKAMT.
           IF LN-INT-REBATE = " " OR "C"
              MOVE 0 TO WK-SUB
              PERFORM COMPUTE-TP-WORKAMT.

           IF LN-EX-REBATE = " " OR "C"
              MOVE 1 TO WK-SUB
              PERFORM COMPUTE-TP-WORKAMT.

           IF LN-SC-REBATE = " " OR "C"
              MOVE 2 TO WK-SUB
              PERFORM COMPUTE-TP-WORKAMT.

           IF LN-MF-REBATE = " " OR "C"
              MOVE 3 TO WK-SUB
              PERFORM COMPUTE-TP-WORKAMT.

           MOVE 4 TO WK-SUB.
           PERFORM COMPUTE-TP-WORKAMT.

           MOVE 5 TO WK-SUB.
           PERFORM COMPUTE-TP-WORKAMT.

       COMPUTE-TP-WORKAMT.
           ADD 1 TO WK-SUB.
           IF LN-ANTICERN(WK-SUB) > LN-ACCERN(WK-SUB)
              IF LP-TRCD = "RV"
                 SUBTRACT LN-ANTICERN(WK-SUB) FROM LN-ACCERN(WK-SUB)
                                      GIVING WK-TP-WORKAMT(WK-SUB)
               ELSE
                 SUBTRACT LN-ACCERN(WK-SUB) FROM LN-ANTICERN(WK-SUB)
                                      GIVING WK-TP-WORKAMT(WK-SUB).


      ******************************
       UPDATE-REPO-TRAILER SECTION.
      ******************************
           IF GP-REPO-CODE NOT = "A"
              GO TO EXIT-UPDATE-REPO-TRAILER.

           PERFORM OPEN-LSX1-FILE.

      * REPO REDEEM, MOVE SEQ 1 TO NEXT AVAIL SEQ, AND REMOVE SEQ 1
           IF LP-TRCD = "SV"
              PERFORM UPDATE-REPO-REDEEM-TRAILER
              GO TO EXIT-UPDATE-REPO-TRAILER
           ELSE
              IF RV-LP-TRCD = "SV"
                 PERFORM REVERSE-REPO-REDEEM-TRAILER
                 GO TO EXIT-UPDATE-REPO-TRAILER.

           MOVE LN-OWNBR  TO LSX-BRNO.
           MOVE LN-ACCTNO TO LSX-ACCTNO.
           MOVE 1         TO LSX-SEQNO.
           PERFORM READ-LSX1-FILE.
           IF IO-BAD
              GO TO EXIT-UPDATE-REPO-TRAILER.

           IF RV-LP-TRCD = "SX" OR "ZX"
              MOVE 0 TO LSX-10DAY-COST
      * CLEAR EXTRACT FLAG ON SX REVERSAL, #352
              MOVE "N" TO LSX-EXTRACTED
           ELSE
              IF LP-TRCD = "SX" OR "ZX"
                 MOVE "N" TO LSX-EXTRACTED
                 MOVE LP-PAYDATE TO POFF-PAYDATE
                 MOVE "M" TO POFF-MAKERCD
                 MOVE "N" TO POFF-DEF-STOP
                 MOVE "PO" TO POFF-LPTRCD
                 MOVE " " TO POFF-RECAST-FG
                 PERFORM PAYOFF-LOAN-ROUTINE
                 MOVE POFF-NETDUE TO LSX-10DAY-COST.

           IF RV-LP-TRCD = "SS"
              MOVE 0 TO LSX-SOLD-TO-AMT LSX-AUCTION-EXPENSE
              MOVE SPACES TO LSX-SOLD-TO(1)
           ELSE
              IF LP-TRCD = "SS"
                 MOVE HOLD-REPO-AUCTION-EXP TO LSX-AUCTION-EXPENSE
                 COMPUTE LSX-SOLD-TO-AMT = LP-TRAMT
                                          + LSX-AUCTION-EXPENSE.

           IF LP-TRCD = "SS"
              IF BATCH-REFCD = LP-REFNO
                 IF HOLD-REPO-AUCTION-NAME NOT = SPACES
                    MOVE HOLD-REPO-AUCTION-NAME TO LSX-SOLD-TO(1).

      * THESE WILL NOT BE FOUND ON A PAYOFF !! REGACC DID NOT CARE.
      * REVERSALS WILL SUBTRACT (THEY ARE NEGATIVE)
           IF HOLD-LP-TRCD = "RC" OR "RA" OR "RP" OR "R1" OR "R2" OR
                     "R3" OR "RI" OR "RS" OR "RM" OR "RD" OR "PE" OR
                     "IN"
              ADD LP-TRAMT TO LSX-RB-AMT.

      * AMOUNT IS NEGATIVE WHEN POSTING AN INCREASE
      * AMOUNT IS POSITIVE WHEN POSTING A DECREASE
      * JTG 010914 'RE' ON 'IB' WILL ACT LIKE 'OT' TRANSACTION   REGACC PR#1575
           IF RV-LP-TRCD = "RE"
              IF LN-LOANTYPE = "I"
                 ADD LP-INTDUE TO LSX-OTH-EXP-CKAMT(1)
              ELSE
                 COMPUTE LSX-OTH-EXP-CKAMT(1) =
                         LSX-OTH-EXP-CKAMT(1) - LP-APCUR
              END-IF
           ELSE
           IF LP-TRCD = "RE"
              IF LN-LOANTYPE = "I"
                 ADD LP-INTDUE TO LSX-OTH-EXP-CKAMT(1)
              ELSE
                 COMPUTE LSX-OTH-EXP-CKAMT(1) =
                         LSX-OTH-EXP-CKAMT(1) + (LP-APCUR * -1)
              END-IF.

           PERFORM REWRITE-LSX1-FILE.
           PERFORM CLOSE-LSX1-FILE.

           IF LP-TRCD = "SS"
              IF BATCH-REFCD = LP-REFNO
                 PERFORM CREATE-SS-SALE-MEMO.

       EXIT-UPDATE-REPO-TRAILER.
           EXIT.

      ************************************
       UPDATE-REPO-REDEEM-TRAILER SECTION.
      ************************************

      * FIRST FIND NEXT AVAIL SEQ
           MOVE 0 TO HOLD-LSX-SEQNO.

           MOVE LN-OWNBR  TO LSX-BRNO.
           MOVE LN-ACCTNO TO LSX-ACCTNO.
           MOVE 2         TO LSX-SEQNO.
       NEXT-REPO-REDEEM.
           PERFORM READ-LSX1-FILE.
           IF IO-GOOD
              IF LSX-SEQNO NOT > 9
                 ADD 1 TO LSX-SEQNO
                 GO TO NEXT-REPO-REDEEM
              ELSE
                 GO TO EXIT-UPDATE-REPO-REDEEM-TRAILER.

      * FOUND NEXT AVAIL SEQ, NOW MOVE SEQ 1 TO THIS NEW SEQ
           MOVE LSX-SEQNO TO HOLD-LSX-SEQNO.

      * NOW READ IN SEQ 1 TO MOVE TO THIS SEQNO
           MOVE LN-OWNBR  TO LSX-BRNO.
           MOVE LN-ACCTNO TO LSX-ACCTNO.
           MOVE 1         TO LSX-SEQNO.
           PERFORM READ-LSX1-FILE.
           IF IO-BAD
              GO TO EXIT-UPDATE-REPO-REDEEM-TRAILER.

           MOVE LSX-REC TO HOLD-LSX-REC.
      * REMOVE SEQNO 1
           PERFORM DELETE-LSX1-FILE.

      * WRITE NEW NEXT AVAIL SEQNO
           MOVE HOLD-LSX-REC TO LSX-REC.

      * CLEAR EXTRACTED FLAG ON A "SV" AND ALSO ON A "SX" REVERSAL, #352
           MOVE "N" TO LSX-EXTRACTED.

           MOVE HOLD-LSX-SEQNO TO LSX-SEQNO.
           PERFORM WRITE-LSX1-FILE.

       EXIT-UPDATE-REPO-REDEEM-TRAILER.
           EXIT.

      ************************************
       REVERSE-REPO-REDEEM-TRAILER SECTION.
      ************************************
      * FIRST FIND LAST SEQ
           MOVE 0 TO HOLD-LSX-SEQNO.

           MOVE LN-OWNBR  TO LSX-BRNO
                             QLSX1-WBEG-BRNO
                             QLSX1-WEND-BRNO.
           MOVE LN-ACCTNO TO LSX-ACCTNO
                             QLSX1-WBEG-ACCTNO
                             QLSX1-WEND-ACCTNO.
           MOVE 9         TO LSX-SEQNO
                             QLSX1-WEND-SEQNO.
           MOVE ALL "0"   TO QLSX1-WBEG-SEQNO.

           PERFORM START-LSX1-FILE-NOT-GREATER.
           PERFORM READ-LSX1-FILE-PREVIOUS.
           IF IO-BAD
              GO TO EXIT-REVERSE-REPO-REDEEM-TRAILER.

      * DID NOT FIND ANY
           IF (LSX-ACCTNO NOT = LN-ACCTNO) OR
                    (LSX-SEQNO = 1)
              GO TO EXIT-REVERSE-REPO-REDEEM-TRAILER.

      * FOUND LAST SEQ, NOW SAVE IT
           MOVE LSX-REC TO HOLD-LSX-REC.

      * REMOVE LAST SEQ
           PERFORM DELETE-LSX1-FILE.

      * NOW WRITE BACK SEQ 1
           MOVE HOLD-LSX-REC TO LSX-REC.
           MOVE 1            TO LSX-SEQNO.
           PERFORM WRITE-LSX1-FILE.
           IF IO-BAD
              PERFORM REWRITE-LSX1-FILE.

       EXIT-REVERSE-REPO-REDEEM-TRAILER.
           EXIT.

      ************************************
       FIND-BNKRPT-TRAILER SECTION.
      ************************************

      * POSTING "BD" AND REVERSE OF "BD"

           PERFORM OPEN-LTB1-FILE.

           MOVE LN-OWNBR  TO LTB-BRNO.
           MOVE LN-ACCTNO TO LTB-ACCTNO.
           MOVE 1         TO LTB-SEQNO.
           PERFORM READ-LTB1-FILE.
           IF IO-FG NOT = 0
              GO TO EXIT-FIND-BNKRPT-TRAILER.

      * IF LP-TRCD = "BD", ZERO REAFF FIELDS.
      *                    DO NOT CLEAR GROSS-BAL, CANT GET IT BACK
      * IF 'BD' IS REVERSED, ZERO BDDATE.
           IF LP-TRCD = "BD"
               MOVE 0      TO LTB-REAFF-DATE    LTB-REAFF-SYSDATE
                              LTB-REAFF-BALANCE LTB-REAFF-PAYAMT
                              LTB-REAFF-NO-PAYS LTB-INTRATE
                              LTB-RESCIND-DATE  
               MOVE SPACES TO LTB-PARTIAL-FULL
           ELSE
      * ZERO OUT BNKRPT DISMISSAL DATE IF "BD" IS REVERSED
              MOVE 0 TO LTB-BDDATE.

           PERFORM REWRITE-LTB1-FILE.

       EXIT-FIND-BNKRPT-TRAILER.
           PERFORM CLOSE-LTB1-FILE.

      ******************************
       DELETE-BNKRPT-TRAILER SECTION.
      ******************************

      * FOR RV-LP-TRCD = "BK" OR LP-TRCD = "BD"

           PERFORM OPEN-LTB1-FILE.

           MOVE LN-OWNBR  TO LTB-BRNO.
           MOVE LN-ACCTNO TO LTB-ACCTNO.
           MOVE 1         TO LTB-SEQNO.
           PERFORM READ-LTB1-FILE.
           IF IO-FG NOT = 0
              GO TO EXIT-DELETE-BNKRPT-TRAILER.

      * THE "BD" DOES NOT DELETE THE BANKRUPT TRAILER FOR ANYONE
           IF (LP-TRCD = "BD") 
              MOVE LP-PAYDATE TO LTB-BDDATE
              PERFORM REWRITE-LTB1-FILE
              GO TO EXIT-DELETE-BNKRPT-TRAILER.

           PERFORM DELETE-LTB1-FILE.

       EXIT-DELETE-BNKRPT-TRAILER.
           PERFORM CLOSE-LTB1-FILE.

      *******************************
       UPDATE-BNKRPT-TRAILER SECTION.
      *******************************

      * THIS IS ONLY PERFORMCED ONCE WHEN POSTING "BK"

           MOVE "UPDATING BANKRUPT TRAILER RECORDS......" TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM OPEN-LTB1-FILE.
           MOVE LN-OWNBR  TO LTB-BRNO.
           MOVE LN-ACCTNO TO LTB-ACCTNO.
           MOVE 1         TO LTB-SEQNO.
           PERFORM READ-LTB1-FILE.
           IF IO-FG = 0
              MOVE LN-BNKRPTDATE     TO LTB-FILEDATE
              MOVE LN-BNKRPT-CHAPTER TO LTB-CHAPTER
              MOVE 0                 TO LTB-BDDATE
              MOVE LP-CURBAL         TO LTB-GROSS-BAL
              IF HOLD-BP-TRCD = "BK"
                 PERFORM UPDATE-BNKRPT-CLAIM-AMTS
                 IF LTB-WHO-FILED = " "
                    IF LN-SSNO(2) = 0
                       MOVE "M" TO LTB-WHO-FILED
                    ELSE
                       MOVE "B" TO LTB-WHO-FILED
                    END-IF
                 END-IF
              END-IF
              PERFORM REWRITE-LTB1-FILE
           ELSE
              PERFORM CLEAR-LTB-FILE
              MOVE LN-OWNBR  TO LTB-BRNO
              MOVE LN-ACCTNO TO LTB-ACCTNO
              MOVE 1         TO LTB-SEQNO
              MOVE LN-BNKRPTDATE     TO LTB-FILEDATE
              MOVE LN-BNKRPT-CHAPTER TO LTB-CHAPTER
              MOVE 0                 TO LTB-BDDATE
              MOVE LP-CURBAL         TO LTB-GROSS-BAL
              IF HOLD-BP-TRCD = "BK"
                 PERFORM UPDATE-BNKRPT-CLAIM-AMTS
                 IF LN-SSNO(2) = 0
                    MOVE "M" TO LTB-WHO-FILED
                 ELSE
                    MOVE "B" TO LTB-WHO-FILED
                 END-IF
              END-IF
              PERFORM WRITE-LTB1-FILE.

           PERFORM CLOSE-LTB1-FILE.

       EXIT-UPDATE-BNKRPT-TRAILER.
           EXIT.

      ***************************************************
       CREATE-CHANGE-REC SECTION.
      ***************************************************

           PERFORM OPEN-CH-FILE.

           MOVE 1                  TO HOLD-CH-SEQ.
       CREATE-CHANGE-REC-AGAIN.

           PERFORM CLEAR-CH-FILE.

           MOVE BRANCH             TO CH-BRNO.
           MOVE TRANS-DATE         TO CH-DATE.
           MOVE "B"                TO CH-CODE.
           PERFORM SET-POSTDATE.
           MOVE POST-USERID        TO CH-USERID.
           PERFORM GET-TIME.
           MOVE HH-MM-SS           TO CH-TIME.
           MOVE HOLD-CH-SEQ        TO CH-SEQ.

           MOVE "BANKRUPT DATE"    TO CH-DESCRIPT.
           MOVE LN-ACCTNO          TO CH-ACCTNO.

           MOVE HOLD-BNKRPTDATE    TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY        TO CH-ORG-DATE.
           MOVE CHG-BNKRPTDATE     TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY        TO CH-NEW-DATE.

           PERFORM WRITE-CH-FILE.
      * IF DUPLICATE KEY, TRY ANOTHER SEQ
           IF (IO-FG NOT = 0 AND E-CODE = "22")
              IF HOLD-CH-SEQ < 999
                 ADD 1 TO HOLD-CH-SEQ
                 GO TO CREATE-CHANGE-REC-AGAIN.

           PERFORM CLOSE-CH-FILE.

           IF BR-CHANGE-MEMO = "Y"
              MOVE "CL/CHMEMO" TO FORM-NAM
              CALL FORM-PROGX USING FORM-PATH CH-REC
              CANCEL FORM-PROGX.


       END-CREATE-CH-REC.
           EXIT.

      *********************************************************
       UPDATE-LT1-FILE SECTION.
      *********************************************************

      * COMPUTE REFUNDS FOR ADDON INS. FIN CHG

           MOVE "UPDATING INSURANCE TRAILER RECORDS......" TO MESS.
           PERFORM TEST-SEND-LEGEND.

           PERFORM OPEN-LTI1-FILE.

           MOVE LTI-PATH-OWNBR  TO LTI-BRNO
                                   QLTI1-WBEG-BRNO
                                   QLTI1-WEND-BRNO.
           MOVE LN-ACCTNO       TO LTI-ACCTNO
                                   QLTI1-WBEG-ACCTNO
                                   QLTI1-WEND-ACCTNO.
           MOVE 0               TO LTI-SEQNO
                                   QLTI1-WBEG-SEQNO.
           MOVE ALL "9"         TO QLTI1-WEND-SEQNO.

           PERFORM START-LTI1-FILE.
       UPDATE-LT1-FILE-NEXT.
           PERFORM READ-LTI1-FILE-NEXT.
           IF IO-FG NOT = 0
              GO TO END-UPDATE-LT1-FILE.

           IF (LTI-BRNO NOT = LTI-PATH-OWNBR) OR
               (LTI-ACCTNO NOT = LN-ACCTNO)
              GO TO END-UPDATE-LT1-FILE.

      *********************************************************
      *    LT INSURANCE REFUNDS:
      *********************************************************

           IF LTI-INS-TYPE = 1
            IF (LTI-INSEFF-DATE = LN-INSEFF-DATE(1) AND
                 LTI-INSEXP-DATE = LN-INSEXP-DATE(1))
               IF (RV-LP-TRCD = "RC") OR
                      (INS-RB-TBL(1) = "Y" AND RV-LP-TRCD NOT = " ")
                  MOVE " " TO LTI-INS-REBATE
               ELSE
                  IF LP-TRCD = "RC" OR
                     (INS-RB-TBL(1) = "Y" AND RV-LP-TRCD = " ")
                     MOVE "R" TO LTI-INS-REBATE.

           IF LTI-INS-TYPE = 2
            IF (LTI-INSEFF-DATE = LN-INSEFF-DATE(2) AND
                 LTI-INSEXP-DATE = LN-INSEXP-DATE(2))
               IF (RV-LP-TRCD = "RA") OR
                  (INS-RB-TBL(2) = "Y" AND RV-LP-TRCD NOT = " ")
                  MOVE " " TO LTI-INS-REBATE
               ELSE
                  IF LP-TRCD = "RA" OR
                     (INS-RB-TBL(2) = "Y" AND RV-LP-TRCD = " ")
                     MOVE "R" TO LTI-INS-REBATE.

           IF LTI-INS-TYPE = 3
            IF (LTI-INSEFF-DATE = LN-INSEFF-DATE(3) AND
                 LTI-INSEXP-DATE = LN-INSEXP-DATE(3))
               IF (RV-LP-TRCD = "RP") OR
                  (INS-RB-TBL(3) = "Y" AND RV-LP-TRCD NOT = " ")
                  MOVE " " TO LTI-INS-REBATE
               ELSE
                  IF LP-TRCD = "RP" OR
                     (INS-RB-TBL(3) = "Y" AND RV-LP-TRCD = " ")
                     MOVE "R" TO LTI-INS-REBATE.

           IF LTI-INS-TYPE = 4
            IF (LTI-INSEFF-DATE = LN-INSEFF-DATE(4) AND
                 LTI-INSEXP-DATE = LN-INSEXP-DATE(4))
              IF (RV-LP-TRCD = "R1") OR
                 (INS-RB-TBL(4) = "Y" AND RV-LP-TRCD NOT = " ")
                 MOVE " " TO LTI-INS-REBATE
              ELSE
                 IF LP-TRCD = "R1" OR
                    (INS-RB-TBL(4) = "Y" AND RV-LP-TRCD = " ")
                    MOVE "R" TO LTI-INS-REBATE.

           IF LTI-INS-TYPE = 5
            IF (LTI-INSEFF-DATE = LN-INSEFF-DATE(5) AND
                 LTI-INSEXP-DATE = LN-INSEXP-DATE(5))
              IF (RV-LP-TRCD = "R2") OR
                 (INS-RB-TBL(5) = "Y" AND RV-LP-TRCD NOT = " ")
                 MOVE " " TO LTI-INS-REBATE
              ELSE
                 IF LP-TRCD = "R2" OR
                    (INS-RB-TBL(5) = "Y" AND RV-LP-TRCD = " ")
                    MOVE "R" TO LTI-INS-REBATE.

           IF LTI-INS-TYPE = 6
            IF (LTI-INSEFF-DATE = LN-INSEFF-DATE(6) AND
                 LTI-INSEXP-DATE = LN-INSEXP-DATE(6))
              IF (RV-LP-TRCD = "R3") OR
                 (INS-RB-TBL(6) = "Y" AND RV-LP-TRCD NOT = " ")
                 MOVE " " TO LTI-INS-REBATE
              ELSE
                 IF LP-TRCD = "R3" OR
                    (INS-RB-TBL(6) = "Y" AND RV-LP-TRCD = " ")
                    MOVE "R" TO LTI-INS-REBATE.

      *********************************************************
      *    LT FINCHG REFUNDS:
      *********************************************************

           IF LP-TRCD = "RI" OR REB-AMOUNT(4) > 0
              IF LTI-INT-REBATE = " "
                 MOVE "Y" TO LTI-INT-REBATE
              ELSE
                 MOVE "R" TO LTI-INT-REBATE.
           IF RV-LP-TRCD = "RI" OR REB-AMOUNT(4) < 0
              IF LTI-INT-REBATE = "Y"
                 MOVE " " TO LTI-INT-REBATE
              ELSE
                 MOVE "C" TO LTI-INT-REBATE.

      * TEST FOR FINCHG REBATE FOR SERV ACCT AND/OR P&L:
           IF LN-SERVACCT NOT = "Y"
              IF LN-PLCD = " "
                 GO TO UPDATE-LT1-FILE-OURS.

           IF LP-TRCD = "RI" OR REB-AMOUNT(4) > 0
              SUBTRACT LTI-RB-WORKER FROM LTI-ANTICERN(1)
              ADD LTI-RB-WORKER TO LTI-ANTICADJ(1)
           ELSE
              IF RV-LP-TRCD = "RI" OR REB-AMOUNT(4) < 0
                 ADD LTI-ANTICADJ(1) TO LTI-ANTICERN(1)
                 MOVE 0 TO LTI-ANTICADJ(1).

           GO TO UPDATE-LT1-FILE-REWRITE.

      * FINCHG REBATES ON OUR RECEIVABLES:
       UPDATE-LT1-FILE-OURS.
           IF LP-TRCD = "RI" OR REB-AMOUNT(4) > 0
              COMPUTE LTI-INT-LAST-EARNED = LTI-ANTICERN(1)
                               - LTI-ACCERN(1) - LTI-RB-WORKER
              ADD LTI-INT-LAST-EARNED TO LTI-ACCERN(1)
              SUBTRACT LTI-RB-WORKER FROM LTI-ANTICERN(1)
              MOVE LTI-RB-WORKER TO LTI-ANTICADJ(1)
           ELSE
              IF RV-LP-TRCD = "RI" OR REB-AMOUNT(4) < 0
                 SUBTRACT LTI-INT-LAST-EARNED FROM LTI-ACCERN(1)
                 ADD LTI-ANTICADJ(1) TO LTI-ANTICERN(1)
                 MOVE 0 TO LTI-ANTICADJ(1).

       UPDATE-LT1-FILE-REWRITE.
           PERFORM REWRITE-LTI1-FILE.
           GO TO UPDATE-LT1-FILE-NEXT.

       END-UPDATE-LT1-FILE.
           PERFORM CLOSE-LTI1-FILE.

      **************************************************
       UPDATE-ESCROW-COLLECTED SECTION.
      **************************************************
           IF LP-APPLIED-TO-ESCROW = 0
              GO TO EXIT-UPDATE-ESCROW.

           MOVE LN-ACCTNO TO ES-ACCTNO.
           PERFORM OPEN-ES1-FILE.
           PERFORM READ-ES1-FILE.
           IF IO-BAD
              MOVE "ERROR: ESCROW RECORD NOT FOUND FOR ACCOUNT!"
                 TO MESS
              PERFORM SEND-MESS
              GO TO EXIT-UPDATE-ESCROW.

           IF LP-TRCD = "RV"
              GO TO REVERSE-ESCROW.

           ADD LP-APPLIED-TO-ESCROW TO ES-BALANCE.
           ADD LP-APPLIED-TO-ESCROW TO ES-COLLECTED(1)
                                       ES-COLLECTED(3).
           MOVE LP-APPLIED-TO-ESCROW TO ESCROW-WORK.
           MOVE 0 TO ESCROW-SUB.
       ESCROW-LOOP.
           ADD 1 TO ESCROW-SUB.
           IF ESCROW-SUB > 40
              GO TO EXIT-ESCROW-LOOP.
           COMPUTE ESCROW-BALANCE =
              ES-SCHD-ESCROW(ESCROW-SUB) -
              ES-SCHD-COLLECTED(ESCROW-SUB).
           IF ESCROW-BALANCE = 0
              GO TO ESCROW-LOOP.
           IF ESCROW-BALANCE NOT < ESCROW-WORK
              ADD ESCROW-WORK TO ES-SCHD-COLLECTED(ESCROW-SUB)
              GO TO EXIT-ESCROW-LOOP.
           ADD ESCROW-BALANCE TO ES-SCHD-COLLECTED(ESCROW-SUB).
           SUBTRACT ESCROW-BALANCE FROM ESCROW-WORK.
           GO TO ESCROW-LOOP.
       REVERSE-ESCROW.
           ADD LP-APPLIED-TO-ESCROW TO ES-BALANCE.
           ADD LP-APPLIED-TO-ESCROW TO ES-COLLECTED(1)
                                       ES-COLLECTED(3).
           MULTIPLY LP-APPLIED-TO-ESCROW BY -1 GIVING ESCROW-WORK.
           MOVE 41 TO ESCROW-SUB.
       REVERSE-ESCROW-LOOP.
           SUBTRACT 1 FROM ESCROW-SUB.
           IF ESCROW-SUB < 1
              GO TO EXIT-ESCROW-LOOP.
           IF ES-SCHD-COLLECTED(ESCROW-SUB) = 0
              GO TO REVERSE-ESCROW-LOOP.
           IF ES-SCHD-COLLECTED(ESCROW-SUB) NOT < ESCROW-WORK
              SUBTRACT ESCROW-WORK FROM
                 ES-SCHD-COLLECTED(ESCROW-SUB)
              GO TO EXIT-ESCROW-LOOP.
           SUBTRACT ES-SCHD-COLLECTED(ESCROW-SUB) FROM ESCROW-WORK.
           MOVE 0 TO ES-SCHD-COLLECTED(ESCROW-SUB).
           GO TO REVERSE-ESCROW-LOOP.
       EXIT-ESCROW-LOOP.
           PERFORM REWRITE-ES1-FILE.
           PERFORM CLOSE-ES1-FILE.
           IF LN-ESCROW-FG = "I"
              MOVE 0 TO ESCROW-OUTSTANDING
              PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 40
                 COMPUTE ESCROW-OUTSTANDING = ESCROW-OUTSTANDING +
                    ES-SCHD-ESCROW(SUB) - ES-SCHD-COLLECTED(SUB)
              END-PERFORM
              IF ESCROW-OUTSTANDING > 0
                 MOVE "Y" TO CHANGE-ESCROW-FG.
       EXIT-UPDATE-ESCROW.
           EXIT.

      **************************************************
       UPDATE-ESCROW-DISBURSED SECTION.
      **************************************************
           IF LP-TRAMT = 0
              GO TO EXIT-ESCROW-DISBURSED.

           MOVE LN-ACCTNO TO ES-ACCTNO.
           PERFORM OPEN-ES1-FILE.
           PERFORM READ-ES1-FILE.
           IF IO-BAD
              MOVE "ERROR: ESCROW RECORD NOT FOUND FOR ACCOUNT!"
                 TO MESS
              PERFORM SEND-MESS
              PERFORM CLOSE-ES1-FILE
              GO TO EXIT-ESCROW-DISBURSED.

           IF LP-TRCD = "RV"
              GO TO REVERSE-ESCROW-DISBURSED.

           IF LP-REFNO = "TAX"
              ADD LP-TRAMT TO ES-DISBURSED-TAXES(1)
                                         ES-DISBURSED-TAXES(3)
           ELSE IF LP-REFNO = "INS"
              ADD LP-TRAMT TO ES-DISBURSED-INS(1)
                              ES-DISBURSED-INS(3)
           ELSE IF LP-REFNO = "PMI"
              ADD LP-TRAMT TO ES-DISBURSED-PMI(1)
                              ES-DISBURSED-PMI(3)
           ELSE IF LP-REFNO = "OTH"
              ADD LP-TRAMT TO ES-DISBURSED-OTHER(1)
                              ES-DISBURSED-OTHER(3)
           ELSE IF LP-REFNO = "REF"
              ADD LP-TRAMT TO ES-DISBURSED-REF(1)
                              ES-DISBURSED-REF(3) 
           ELSE IF LP-REFNO = "CNT"
              ADD LP-TRAMT TO ES-DISBURSED-CNT-TAXES(1)
                              ES-DISBURSED-CNT-TAXES(3). 
           SUBTRACT LP-TRAMT FROM ES-BALANCE.
           GO TO REWRITE-ESCROW-DISBURSED.
       REVERSE-ESCROW-DISBURSED.
           IF RV-LP-REFNO = "TAX"
              ADD LP-TRAMT TO ES-DISBURSED-TAXES(1)
                              ES-DISBURSED-TAXES(3)
           ELSE IF RV-LP-REFNO = "INS"
              ADD LP-TRAMT TO ES-DISBURSED-INS(1)
                              ES-DISBURSED-INS(3)
           ELSE IF RV-LP-REFNO = "PMI"
              ADD LP-TRAMT TO ES-DISBURSED-PMI(1)
                              ES-DISBURSED-PMI(3)
           ELSE IF RV-LP-REFNO = "OTH"
              ADD LP-TRAMT TO ES-DISBURSED-OTHER(1)
                              ES-DISBURSED-OTHER(3)
           ELSE IF RV-LP-REFNO = "REF"
              ADD LP-TRAMT TO ES-DISBURSED-REF(1)
                              ES-DISBURSED-REF(3) 
           ELSE IF RV-LP-REFNO = "CNT"
              ADD LP-TRAMT TO ES-DISBURSED-CNT-TAXES(1)
                              ES-DISBURSED-CNT-TAXES(3).

           SUBTRACT LP-TRAMT FROM ES-BALANCE.
       REWRITE-ESCROW-DISBURSED.
           PERFORM REWRITE-ES1-FILE.
           PERFORM CLOSE-ES1-FILE.
       EXIT-ESCROW-DISBURSED.
           EXIT.

      **************************************************
       UPDATE-ESCROW-PREPAID SECTION.
      **************************************************
           IF LP-TRAMT = 0
              GO TO EXIT-ESCROW-PREPAID.

           MOVE LN-ACCTNO TO ES-ACCTNO.
           PERFORM OPEN-ES1-FILE.
           PERFORM READ-ES1-FILE.
           IF IO-BAD
              MOVE "ERROR: ESCROW RECORD NOT FOUND FOR ACCOUNT!"
                 TO MESS
              PERFORM SEND-MESS
              PERFORM CLOSE-ES1-FILE
              GO TO EXIT-ESCROW-PREPAID.

           ADD LP-TRAMT TO ES-BALANCE
                           ES-COLLECTED(1) ES-COLLECTED(3)
                           ES-PREPAID(1)   ES-PREPAID(3).

           PERFORM REWRITE-ES1-FILE.
           PERFORM CLOSE-ES1-FILE.
       EXIT-ESCROW-PREPAID.
           EXIT.

      *********************************************************
       UPDATE-BNKRPT-CLAIM-AMTS SECTION.
      *********************************************************
           MOVE HOLD-BNKRPT-CASE-NO TO LTB-CASE-NO.
           MOVE HOLD-BNKRPT-STATUS TO LTB-ACTIVE-INACTIVE.
           MOVE LN-OTHBAL TO LTB-OTH-DUE.

           MOVE LN-BNKRPTDATE      TO CRNOR2-SYSDATE.
           MOVE "N"                TO CRNOR2-LPREC-FG.
           PERFORM CREATE-NOTICE-RECORD.

           COMPUTE LTB-CLAIM-AMT = POFF-NETDUE + 
                            POFF-REBATE(1)  + POFF-REBATE(2)
                          + POFF-REBATE(3)  + POFF-REBATE(9)
                          + POFF-REBATE(10) + POFF-REBATE(11)
                          + POFF-REBATE(12) + POFF-REBATE(13).
           ADD POFF-INTDUE POFF-LCDUE GIVING LTB-INT-LC-DUE.

           MOVE NO-TDUEAMT         TO LTB-TDUEAMT.

       COPY "LIBLP/LPFMCL.CPY".
       COPY "LIBLP/LPCXCL.CPY".
       COPY "LIBLP/LPTRPCL.CPY".
       COPY "LIBLP/LPDTCL.CPY".
       COPY "LIBLP/LPDSCL.CPY".
       COPY "LIBLP/LPTYCL.CPY".
       COPY "LIBLP/LPLXCL.CPY".
       COPY "LIBLP/LPCHCL.CPY".
       COPY "LIBLP/LPLTBCL.CPY".
       COPY "LIBLP/LPPDCL.CPY".

      ************************************************
       IO-ROUTINES SECTION.
      ************************************************
       COPY "LIBGB/CONNECT_SQL.CPY".
       COPY "LIBLP/LPTYGS_SQL.CPY".
       COPY "LIBLP/LPTRPGS_SQL.CPY".
       COPY "LIBLP/LPSPGS_SQL.CPY".
       COPY "LIBLP/LPPDGS_SQL.CPY".
       COPY "LIBLP/LPNOGS_SQL.CPY".
       COPY "LIBLP/LPLXGGS_SQL.CPY".
       COPY "LIBLP/LPLXEGS_SQL.CPY".
       COPY "LIBLP/LPLXGS_SQL.CPY".
       COPY "LIBLP/LPLTPGS_SQL.CPY".
       COPY "LIBLP/LPLTIGS_SQL.CPY".
       COPY "LIBLP/LPLTBGS_SQL.CPY".
       COPY "LIBLP/LPLSXGS_SQL.CPY".
       COPY "LIBLP/LPLSPGS_SQL.CPY".
       COPY "LIBLP/LPLCGS_SQL.CPY".
       COPY "LIBLP/LPLPGS_SQL.CPY".
       COPY "LIBLP/LPLNGS_SQL.CPY".
       COPY "LIBLP/LPLMGS_SQL.CPY".
       COPY "LIBLP/LPICGS_SQL.CPY".
       COPY "LIBLP/LPFMGS_SQL.CPY".
       COPY "LIBLP/LPFDGS_SQL.CPY".
       COPY "LIBLP/LPESGS_SQL.CPY".
       COPY "LIBLP/LPDTGS_SQL.CPY".
       COPY "LIBLP/LPDSGS_SQL.CPY".
       COPY "LIBLP/LPCXGS_SQL.CPY".
       COPY "LIBLP/LPCHGS_SQL.CPY".
       COPY "LIBLP/LPCDGS_SQL.CPY".
       COPY "LIBLP/LPCAGS_SQL.CPY".
       COPY "LIBLP/LPBWGS_SQL.CPY".
       COPY "LIBGL/GLGLGS_SQL.CPY".
       COPY "LIBGB/GBBRGS_SQL.CPY".
       COPY "LIBGB/GBGBGS_SQL.CPY".
       COPY "LIBGB/GBBRRN.CPY".
       COPY "LIBGB/GBGBRN.CPY".
       COPY "LIBLP/LPLC1RN.CPY".
       COPY "LIBLP/LPLN1IN.CPY".
       COPY "LIBLP/LPLP1IN.CPY".
       COPY "LIBLP/LPLM1IN.CPY".
       COPY "LIBLP/LPLX1IN.CPY".
       COPY "LIBLP/LPLXE1IN.CPY".
       COPY "LIBLP/LPLXG1IN.CPY".
       COPY "LIBLP/LPLSP1IN.CPY".
       COPY "LIBLP/LPLSX1IN.CPY".
       COPY "LIBLP/LPSP1RN.CPY".
       COPY "LIBLP/LPBW1IN.CPY".
       COPY "LIBLP/LPCA1IN.CPY".
       COPY "LIBLP/LPTY1IN.CPY".
       COPY "LIBLP/LPDS1IN.CPY".
       COPY "LIBLP/LPPD1IN.CPY".
       COPY "LIBLP/LPWKI.CPY".
       COPY "LIBLP/LPDT1IN.CPY".
       COPY "LIBLP/LPFM1IN.CPY".
       COPY "LIBLP/LPNO1IN.CPY".
       COPY "LIBLP/LPFD1RN.CPY".
       COPY "LIBLP/LPCX1IN.CPY".
       COPY "LIBLP/LPTRP1IN.CPY".
       COPY "LIBLP/LPCHIN.CPY".
       COPY "LIBLP/LPIC1RN.CPY".
       COPY "LIBLP/LPLTI1IN.CPY".
       COPY "LIBLP/LPLTB1IN.CPY".
       COPY "LIBLP/LPLTP1RN.CPY".
       COPY "LIBLP/LPCD1RN.CPY".
       COPY "LIBLP/LPES1IN.CPY".
       COPY "LIBLP/LPREPAYTRPI.CPY".
       COPY "LIBLP/LPREPAYNOI.CPY".

       COPY "LIBGB/FERRORS.CPY".
           MOVE "E" TO ERRCD.

       END-ROUTINE.
           PERFORM CLOSE-FILES.
       EXIT-PROG.
       STOP-RUN.
           EXIT PROGRAM.

