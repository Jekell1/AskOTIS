       IDENTIFICATION DIVISION.
       PROGRAM-ID.      LONPC2.
       DATE-WRITTEN.    012484.
      ******************************************************************
      *                 (LP)
      *  DESCRIPTION:   DIRECT LOANS (NON-SALES FINANCE)
      *                 CONTRACT UPDATE
      * * * * * * * * * * *
      *  NOTE ::::
      *           YOU MUST UPDATE LONPQ1 (RESCISSION UPDATE)
      *       ::::
      *
      * * * * * * * * * * *
      *
      * !!!! HEY   !!!! THIS PROGRAM HAS BEEN ALTERED SO IT CAN BE CALLED
      * !!!!!!!!!!!!!!! FROM WORLD LIVE CHECK PROGRAM (LNCRE2) TO CREATE LOANS  
      * !!!!!!!!!!!!!!! I HAD TO CHANGE
      * !!!!!!!!!!!!!!! ALL OCCURANCES OF PERFORM SEND-MESS TO
      * !!!!!!!!!!!!!!! PERFORM CONDITIONAL-SEND-MESS SO ERRORS
      * !!!!!!!!!!!!!!! MIGHT NOT GO TO THE SCREEN, SO PLEASE DON'T
      * !!!!!!!!!!!!!!! PERFORM SEND-MESS, PERFORM CONDITIONAL-SEND-MESS
      *
      *  ORDER OF UPDATE:  LN-FILE
      *                    IF PRLNNO NOT = 0, LT1-BNKRPT, LM1-BNKRPT
      *                    IF REVOLVING TRF, OTHERWISE LT-FILE
      *                    LT-FEE-FILE
      *                    LP-FILE
      *                    LX-FILE
      *                    LXM (IF MONTHLY INSURANCE)
      *                    LXX (INS TAX TRAILER) IF USING TAX CODES
      *                    MA-FILE
      *                    AM-FILE
      *                    RX-FILE IF IN RESCISSION
      *                    LM-FILE IF RENEWAL
      *                    LT-FILE
      *                    TR-FILE
      *                    BW-FILE
      *                    DS-FILE
      *                    TY-FILE
      *                    FM-FILE
      *                    LM-FILE (IF GIFTNET & DIFFERENT SHIP-TO)
      *                    LM-FILE (IF APPROVAL)
      *                    LE-FILE
      *                    IF RENEWAL, DELETE PD, PC
      *                    BI-FILE
      *
      * REV:
      *  JTG 033195 REMOVED REF: NO ODD PAYMENTS
      *  MJD 062895 ADDED COPY MEMBERS LIBLP/POSTDATE AND POSTDATEW.
      *             SET TC-USERID, POSTTIME, AND POSTDATE.
      *  JTG 071995 ADDED SET OF LN-PRLNAMT & LN-PDPDUE-DAYS
      *  JTG 072195 ADDED LPSRCD LOGIC
      *  MJD 081195 ADDED GP-FILE INFO FOR LIBLP/LPSRCD :
      *                   GP-THE-ONLY-SF-SRCD.
      *  MJD 081695 ADDED GP-THE-ONLY-SF-SRCD LOGIC FOR DS UPDATE.
      *  KEC 083195 ADDED LIBLP/LPNOCL
      *  BLL 091195 IF LOAN-RENEWAL CREATED FROM SAVED LOAN, DELETE
      *             SAVED LOAN FROM PD, SINCE RENEWAL PD WILL BE GONE
      *  MJD 091895 ADDED DS-DATE LOGIC
      *  JTG 110895 ADDED LOGIC FOR TY-(DELIQ TABLE) UPDATE AND
      *             SKIPPED NEW VOLUME UPDATE
      *  KEC 011696 CHANGED "IF SUB NOT > 5" TO
      *                     "IF SUB NOT > 6" TO HANDLE OTHER 3 INS.
      *  MJD 012496 ADDED LOGIC FOR SEPARATE PL TABLE.
      *  MJD 020296 ADDED UPDATE OF TY-DLRVPRIN TY-DLRVCHGS AND TY-DLPARVHELD
      *  MJD 020896 ADDED UPDATE OF DEALER RESERVE FIELDS IN TY-REC.
      *  MJD 021396 ADDED UPDATE OF P&L TABLE.
      *  MJD 022896 ADDED UPDATE-BA1-FILE SECTION. IF A BA-REC EXISTS FOR
      *             BORROWER, THEN IT IS DELETED.
      *  MJD 031196 ADDED LOGIC TO STOP 0 AS ACCOUNT NUMBER.
      *  JTG 041896 ADDED LOGIC TO STOP AND ASK IF CURRENT ACCOUNT NO.
      *             SHOULD BE RETAINED
      *  JTG 061896 ADDED MA-RECORD LOGIC TO CHECK FOR LOAN APPLICATION
      *  MJD 071096 CHANGED TO USE PDTH-DATE-FULL INSTEAD OF PDTH-DATE.
      *  MJD 071696 ADDED LIBLP/LPUPWK FOR CHANGES IN LIBLP/AGEING
      *  JTG 093096 ADDED UPDATE OF DSFILE (DELINQUENCY)
      *  JTG 100396 CHANGED TO UPDATE BI-FILE LAST
      *  JTG 101196 ADDED 'LXE-WORKER' & 'LXE-WORKER2' FOR LPCERN-- A50 VERSION
      *                   SP-ERNFRMLA 15 & 16, REAL INTEREST BEARINGING METHOD
      *                                            - INSTANT AUTO, KY
      *  JTG 102896 STOPPED DELETE OF BA-RECORDS
      *  JTG 112196 CORRECTED BUG WITH WRONG SUBSCRIPT ON COMPUTE OF COMMISSION
      *             NEW COPY MEMBERS LIBLP/LPIEXP/W
      *             (IEXP-SUB/SUB1 --> IEXP-LN/IC)
      *  BAH 112596 ADDED RESCISSION, ADVANCE MTG (#401)
      *  JTG 121296 ADDED RESCISSION, SET LP-REFNO = "RESCI"
      *  MJD 012297 CHANGED TO INCLUDE LN-INSTBL(7-8)
      *  KEC 012397 REVISED ACCESSING MA-FILE: NEW FORMAT FOR MA-FILE.
      *  KEC 022397 REVISED ACCESSING BA-FILE: NEW FORMAT FOR BA-FILE.
      *  KEC 040897 REVISED TO PROPERLY ACCESS NEW APPLICATION MODULE.
      *  KEC 043097 REVISED FOR LOAN APPLICATIONS: ADDED UPDATE TO
      *             APPLICATION MEMOS.
      *  GLF 050797 ADDED COPY MEMBERS: SETCTBLW AND SETCTBL
      *  MJD 051597 ADDED LPPOF2 COPY MEMBER (PREVIOUSLY WAS PART OF LPPOFF)
      *  BLV 051997 UPDATE DS & TY WITH APPLICATIONS MADE
      *  MJD 070297 ADDED DS-DLDISC-VOL AND TY-DLDISC.
      *  JTG 071897 CORRECTED ADJUSTED OVERIDE RATE ON SINGLE PAY LOANS
      *             MADE ON 091091 FOR (PACESETTER)
      *             ROUTINE WAS ADJUSTING LN-OVRDRATE WHEN = 999.999
      *             ALSO MADE ROUTINE AN OPTION RE: SP-PACESETTER-FG
      *  JTG 072897 ADDED LPWDEL/W  MERCURY #E135
      *  JTG 081497 ADDED UPDATE OF TL-GIFTNET  & TL-APR WORLD A90
      *  GLF 090497 REPLACED 'IO' ON GP-FILE WITH GET 'GPENV'
      *  MJD 091797 REMOVED REFERENCE TO DELSUB, ADDED LPPDUE(W)
      *  GLF 091897 REPLACED ANY PROMPT THAT DISPLAYS WORD 'GIFTNET' W/'WCBC'
      *  GLF 091997 ADDED LOGIC FOR BW-PRIOR-RN-FOR-10 AND BW-LAST-RN-FOR10
      *  JTG 102097 STOPPED PERFORM CNV48T60 WHEN COMING FROM ZONPC0.C BALLOON
      *  JTG 103197 ADDED LOGIC TO FORCE ONE CALENDAR MONTH TO FIRST PAYMENT
      *             WHILE IN THE CALCULATOR CALCZ3.C & LONPZL.C, THIS PROGRAM
      *             RECOMPUTES THE APR AND EFFECTIVE RATE USING TRUE FIRST
      *             PAYMENT DATE
      *  JTG 111797 ADDED LOGIC FOR LIBLP/DEFPOL RE: BR-NODEF-1ST-X-MONTHS #167
      *  MJD 112197 EXPANDED LN-REC TO 1800 BYTES
      *  BLV 122297 CHECK AD&D & ROADGARD INSURANCE FOR TY-INS-NO-WROTE(WORLD)
      *  JTG 020498 REMOVED I-AM-WORLD RESTRICTION AND RESTRICTED THIS TO ONLY
      *             CAN LOANS, RE: LOGIC TO FORCE ONE CALENDAR MONTH TO FIRST
      *             PAYMENT, SEE ABOVE JTG 103197
      *  BLV 020698 CHANGE LN-SALEFIN TO LN-GIFTNET IN BICREA CALL
      *  BLV 020698 ADDED LN-SALEFIN BACK TO BICREA CALL
      *  MJD 030398 ADDED LN-PLCD AND LN-CONVERCD TO BICREA CALL
      *  BLV 030498 MOVE UPDATE-LM TO BEFORE UPDATE-LE WHEN LOAN FIELDS
      *             INTACT; ADDED REDEFINE TO LM FOR GIFTNET SHIPTO INFO
      *   CS 031798 DONT UPDATE APP STATS IF BR-APP-REQUIRED-FOR-INPUT = Y
      *             BUT LC-APP-REQ-FOR-LOAN = N
      *  MJD 032098 ADDED GETENV(W) FOR USE IN LIBLP/POSTDATE
      *   CS 042898 ADDED "RB" AND "RO" RENEWAL CODES
      *  JTG 043098 ADDED LOGIC TO BRING OVER BANKRUPT LT & LM RECORDS
      *             FROM PRIOR RENEWAL LOAN
      *  KEC 051498 ADDED 'SET-TRACK-STATUS'.  WAS NOT UPDATING THE
      *              MA-STATUS-TRACK.
      *  JTG 061598 ADDED LOGIC TO UPDATE BANKRUPT DELINQUENT STATISTICS
      *  JTG 062998 CHANGED DS-CNVT.... TO DS-RNEW....
      *                     DS-SVOS.... TO DS-TODL....
      *  JTG 063098 EXPANDED DS-APP-TYPE-TBL TO 3 LEVELS
      *  KEC 071698 FIXED A PROBLEM FROM 'JTG 063098' FOR NOT CORRECTLY
      *              ACCESSING A '88' LEVEL (MA-EXISTS/MA-EXISTS-YES).
      *  JTG 081898 ALLOWED 'PB' ON BANKRUPT ACCOUNTS IF GP-I-AM-WORLD <JGW
      *  GLF 110998 MADE APPLICATION AND LOAN MEMO DATE 2000 COMPATIBLE
      *  JTG 121498 FIXED ERROR IN UPDATE OF BANKRUPT ACCOUNTS  INTO STAT'S
      *  JTG 990112 ADDED SP-LOANCOST-FRMLA AND SP-LOANCOST-AMT, REGENCY #006
      *  JTG 990126 STOPPED SETTING LOAN COSTS FOR REVOLVING
      *  JTG 990322 ADDED UPDATE OF TL-SP-LNCOST-FRMLA RE: TFC #008
      *  BAH 990331 FIXED RENEWAL BANKRUPT MEMO LOGIC LOOPING, WAS GOING TO
      *             START AGAIN INSTEAD OF READ-NEXT...REGENCY
      *  MJD 990420 CHANGED TO INCLUDE/EXCLUDE O2 IN DELINQ BASED
      *             ON GP-DELINQ-WITH-O2
      *  JTG 990525 FIXED BUG IN UPDATE SECTION, WAS ALTERING PD-PROCEEDS WITH
      *             RENEWAL MONIES WHICH WAS READJUSTED IN LONPC2.C, MULTIPLE
      *             ADJUSTEMENTS OCCURED WHEN LNVERI.C FOUND AN ERROR FORCING
      *             OPERATOR TO DO ANOTHER 'U' UPDATE
      *  JTG 990611 ADDED LOGIC FOR UPDATE OF REVOLVING LOAN CONTRACTS, REGENCY
      *  JTG 990720 STOPPED UPDATE OF BWFILE RE: LN-ACTIVE-FG      REVOLVING #45
      *  JTG 990726 ADDED LOGIC FOR UPDATE OF REVOLVING LOAN APPLICATION STATS
      *  MJD 990910 CHANGED TO SKIP INSURANCE BUCKETS 7 & 8 (O4 & O5) WHEN
      *             UPDATING TY. CHANGED TO UPDATE INS-ELIG FOR O1 IF
      *             APPLICABLE. ADDED LOGIC TO UPDATE INS-NOT-WRITTEN (9 & 10)
      *             IF AD&D OR ROADGARD ARE NOT WRITTEN (WORLD ONLY)
      *             (WORLD PR# AS PER JOHN)
      *  MJD 991005 ADDED LN-LAST-RN-FOR10-DATE AND LN-PRIOR-RN-FOR10-DATE
      *  JTG 991116 ADDED TEST FOR ENV VARIABLE 'REVOL_CONV_ACCTNO'
      *             TO DETERMINE IF REVOLVING ACCOUNTS ARE BEING INPUT FOR
      *             MANUAL CONVERSION AND ACCOUNT NO. WILL BE INPUT
      * KEC 1999.1217 {PR#0000} WAS A PROBLEM THAT THE MA-TRACK-STATUS
      *                WAS NOT BEING PROPERLY SETUP.
      *                CHANGED THE FOLLOWING:
      *                  1.  ORIGINAL-TRACK-STATUS WAS X(1) NOT X(6).
      *                  2.  WAS MOVING MA-STATUS NOT MA-TRACK-STATUS
      *                       TO ORIGINAL-TRACK-STATUS.
      *  BLV 000313 UPDATE LN-CREDITLIM IF LC-CALC-HI-CREDIT = "W",
      *             WORLD PR# 225
      *  JTG 000323 MODIFIED TO UPDATE UNEARNED STATISTICS, MERCURY #223
      *  MJD 000406 ADDED UPDATE OF TY-PROCEEDS AND DS-PROCEEDS (MERC PR#223)
      *  BAH 001013 COMMENTED OUT MOVE " " TO BW-REPCODE IF GIFTNET, WORLD
      *             WILL NOW USE BW-REPCODE FOR TAX PRE REGISTRATION, IT
      *             WILL BE EITHER "YES" OR "NO", PR# 240
      *  JTG 010112 ADDED NEW 88 SP-CAL-SET-SMPRATE-OVRRIDE VALUE 4 MERC PR#J016
      *  BAH 010214 SAVE-NO-REC WAS 141, SHOULD BE 176, FIELDS WERE 202020
      *             FINMGM
      *  JTG 010227 ADDED SET OF LN-EXTRA-PRIN-LFP LN-REMAIN-INT-SINCE-LFP
      *             LN-REMAIN-PRIN-SINCE-LFP      (LFP=LAST-FULL-PAYMENT)
      *             LENDMARK, PR#1045 & PR#1380
      *  CS  010316 SET LC-POOLID TO LN-DLPOOL
      *  JTG 010808 ADDED SP-LNCOST-FRMLA-VALID 'P' AMORTIZED
      *             PARTICIPATION EXPENSE                         REGACC PR#1559
      *  CS  010904 UPDATE OF AM-DATE WAS IN YYMMDD FORMAT INSTEAD OF YYYYMMDD
      *  JTG 011221 CHANGED RECALCULATE OF LN-APRATE FOR CAN LOANS TO USE
      *             DISCLOSED-FINAMT RE: IB ACCOUNTS WITH SERVICE CHARGES
      *             APR CALCULATION CAN'T HAVE SC INCLUDED IN APR-FINANCED
      *                                                          WORLD (MO IB'S)
      *  BAH 020424 SET LN-LBOX FLAG TO "Y" SO BATCH PAYMENTS FIRST PAYMENT
      *             WILL HANDLE LATE CHARGES CORRECTLY, REGACC KEVIN
      *  JTG 020619 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *  CS  021121 UPDATE THE INSURANCE TAX TRAILER (LXX) WITH THE INSURANCE
      *             TAX CODES [FROM THE BORROWER RECORD]    (WORLD)
      *  BLV 030225 CREATE LOAN MEMO TO DOCUMENT USER WHO APPROVED LOAN IF OVER
      *             LIMIT IF GP-APPROVAL-MEMO = Y, WORLD PR# 315
      *  JTG 030430 CREATED FORMULA 12 LIKE 2 BUT SPREADS EXTENSION CHARGE
      *             OVER PAYMENTS  88  SP-PYEXFRMLA-SAME2-SPREAD VALUE 12.
      *                                                           CITIZENS #2006
      *  JTG 030617 CORRECTED LOGIC FOR FORMULA 12 LIKE 2 BYPASSED LOGIC
      *             WHEN NOT SP-PYEXFRMLA-SAME2-SPREAD            CITIZENS #2006
      *  JTG 030620 ADDED LOGIC FOR IB SALES FINANCE AMORTIZATED PARTICIPATION
      *             RESERVE PAID EXPENSE, DIFFERENCE BETWEEN A BUY RATE
      *             AND THE CONTRACT RATE                WISCONSIN FINANCE #2049
      *
      *  KEC 030819 {PR#00000} PARADATA <A15> [KEN CISZEWSKI]
      *                ADDED NEW ROUTINE TO CREATE LOAN APPLICATION
      *                STATUS CHANGE MEMO (LIBLA/MEMOSTATUS)
      *  JTG 030929 MODIFIED SCFRMLA 13 TO ONLY TAKE THE DUAL LOAN
      *             ADJUSTMENT INTO ACCOUNT WHEN THE LOANS'S CLASSES
      *             ARE THE SAME                               LENDMARK#2149
      *  BAH 030930 WAS NOT CREATING INITIAL KEY OR FORM REQEUST FOR
      *             FORMS 11 - 20, PAGE 2 OF FORMS SETUP IN SPR, NSA LAURA
      *  JTG 031001 CREATED 01  SCHG-WORKERS-2 FOR PASS FOR SCFRMLA 13
      *                                                       LENDMARK #2149
      *  BAH 031120 ADDED GP-NON-FILE-FEECODE TO UPDATE TY/BY FILE WITH
      *             NON FILE INSURANCE FOR WORLD SMITH REPLACEMENT
      *  BAH 040107 ADDED NEW TRAILER UPDATE, LT-CODE "F" FOR FEECODE
      *             PAYABLE AMOUNT (COMMISSION) FOR WORLD PR# 331
      *  JTG 040501 ADDED LOGIC TO CAUSE THE UNEARNED LOAN COST TO ROLL TO
      *             THE NEW LOAN AFTER 'RENEWAL'. NOTE: THIS COST IS REFLECTIVE
      *             OF THE DISCOUNT WHEN PURCHASING LOAN PAPER NOT CARRIED AS
      *             SALES PAPER WITH DEALER DISCOUNT.
      *             ADDED SP-LNCOST-FRMLA = 'R'                    REGENCY #2287
      *  JTG 040730 FIX FOR                                     WORLD JGJR #2287
      *   CS 050425 IF INSURANCE PREMIUM = ZERO, ZERO THE INSCOMP,INSCOMM,
      *             EFFDATE,EXPDATE, AND OUR FLAG... WE WERE COMPUTING A
      *             COMMISSION ON A ZERO PREMIUM [PR#479 NSA]
      * JTG 050620 ADDED CHANGES FOR REPORTING AND TAKING FEE CODE EARNINGS
      *            CREATED CD-FEE-EARNINGS-FG                     LENDMARK #2542
      * JTG 050706 NO CHANGE NEEDED FOR DIRECT LOANS SINCE ADD FEES ARE OURS
      *            BY DEFAULT,
      *            ADDED TEST FOR LN-FEEOURS = "Y" WHEN ADDING TO FEE-UNEARN
      *              "   CHANGES FOR REPORTING AND TAKING FEE CODE EARNINGS
      *            CREATED CD-FEE-EARNINGS-FG                     LENDMARK #2542
      *  BAH 060411 ADDED CORPORATE FORM PRINTING, MUST SET FM-PATH AND OPEN
      *             AND CLOSE IT INSIDE SP-PRFORM LOOP, LENDMARK, PR# 2763
      *
      * KEC 2006.0720 {PR#00127} REGIONAL ACCEPT. <A15> [KEVIN MULLEN]
      *               CREATED A ROUTINE (UPDATE-LT1-A-FILE) TO CREATE
      *               LT-RECS (A) FROM THE PC-FILE {FROM CMSI UPLOAD}.
      *
      *  JTG 060804 CORRECTED PROBLEM WITH LN-EFFRATE AND LN-OVRRATE GOING
      *             AWAY AFTER LOAN BOOKING  LITIGANT LOANS       LENDMARK #J053
      *  BAH 061205 MOVE BR-COUPON-STATEMENT TO LN-COUPON-STATEMENT,
      *             REGACC PR# 158
      *   CS 070404 IF SP-LNCOST-FRMLA = 'M' DONT PERFORM COMPUTE-LOANCOST, IT
      *             WAS ENTERED IN XONPC0 PR#2942 COLTN
      *  BLF 070801 STARRED OFF "IF I-AM-WORLD" SO ROADGARD, AD&D & NONFILE
      *             INSURANCE WILL UPDATE TO STATS IF CODES ARE SET UP IN
      *             BRANCH OR GLOBAL PARAMTER RECORDS, CONSUMER PR# 3025
      *  BLF 070816 IF GP-PURGE-TO-ARCHIVE = "Y", CHECK TO SEE IF ACCT #
      *             ALREADY EXISTS IN ARCHIVED LOAN FILE; IF SO, SKIP TO
      *             NEXT NUMBER, WORLD PR# 547
      *  BLF 070924 IF GP-PURGE-TO-ARCHIVE = "Y", PROGRAM WAS GIVING MESSAGE
      *             ARCHIVED LOAN PATH NOT FOUND - DON'T GIVE MESSAGE, JUST
      *             SET FLAG OFF, WORLD PR# 547
      *   CS 080626 IF GP-BRING-AUTO-INS-ON-RENEWAL = "Y", BRING FORWARD THE
      *             AUTO INS INFO FROM THE PRIOR LOAN IF A RENEWAL & THE
      *             COLLATERAL CODE IS NOT UNSECURED OR " " CITIZ FIN PR#3177
      *  BAH 100201 WORLD WCBC DEFER THE GROSS PROFIT AND EARN THAT AMOUNT,
      *                                               WORLD PR# 672
      *   CS 100225 LN-YTDINT SHOULD ONLY BE INTEREST COMPONENT ON UPFRONT
      *             EARNINGS IF 1098 DISCLOSURE 'B' OR " " PL#671
      *  BLM 110208 IF I-AM-WORLD, CREATE CUSTOMER INFORMATION REC IF NEEDED
      *             (CIFILE), INFO PASSED IN WKFILE RECORD # 5, WORLD PR# 739
      *  BLM 110216 CHECK GP-CUST-INFO-FG TO SEE WHEHTER TO UPDATE CIFILE,
      *             WORLD PR# 739
      *  BAH 120618 ADDED OFAC-WINDOW FOR REGENCY, PR# 4054
      *  BAH 120905 ADDED LT-VIN-CHG-DATE FOR REGACC PR# 319
      *  KEC 130205 {PR#04196} REGENCY <A15> [LORI MCBEE]
      *             MADE CHANGES TO LOAN APPS - ADDED MX-FILE.
      *  MJD 130603 ADDED LOGIC FOR SP-SCFRMLA = 54.  FUNCTIONS THE SAME AS 12
      *             BUT INCLUDES AN EXTRA 4% ADDED IN AT THE END BASED
      *             ON TOTAL NOTE                                    WORLD #0874
      *  KEC 130625 {PR#04285} SOUTHERN AUTO <A15> [DAVID SINCLAIR]
      *             ADDED NEW UPDATE ROUTINE FOR SOAU IN NOT UPDATING
      *             THE MA-STATUS INFO FIELDS (KEEPS THE 'A' ITEMS).
      * BAH 130801 ADDED SET OF TL-POINTS FOR EMLNRG, WORLD PR# 898
      * MJD 130820 ADDED LOGIC TO REMOVE MAINT FEES FROM PAYMENT AMOUNT
      *            WHEN RECALCULATING APR.   THIS WAS DONE IN THE
      *            CALCULATORS BUT MISSED HERE.                     WORLD PR#811
      * BAH 130923 ALLOW GP-I-AM-WDT TO USE LT SEQ 5 FOR A 3RD HHGS PR#4095
      * KEC 140213 {PR#00967} WORLD <A15> [JIM ROSENAUER]
      *            ADDED LOGIC FOR WORLD TO DO LOAN APPS.
      *            ADDED UPDATE-BX1-FILE SECTION.
      *
      * BAH 141008 ADDED GP-DEFAULT-SKIP-TRW, COSMO PR# 4629
      * BAH 141010 FIXED BUG WITH LN-REP-CD, WAS GETTING SET WITH USERID
      *            FOR EVERYONE IF THERE WAS AN APP, SHOULD HAVE ONLY BEEN
      *            FOR SOAUTO, PL#861 MAPLE/LORI
      *  CS 151222 SET LP-BRO FROM LN-OWNBR
      *  BAH 160118 SPLIT OUT LTFILE, PD0003
      *
      * KEC 2016.0217 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         FIXED KEYS & RECS FOR FD-REC.
      *         CHANGED FMNO/FORMNO/NEXTFM/SETFM FROM 3 TO 4 BYTES.
      *
      * BAH 160218 EXPANDED LM-REC ADDED LM-BRNO, PD0003
      * BLM 160225 FIX FOR NEW TY-DATE FORMAT, YYYYMMDD INSTEAD OF YYYMMDD
      * KEC 2016.0309 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED CD-GROUP, CD-SECURED & CD-TRW TO BE
      *         CD-CO-GROUP, CD-CO-SECURED & CD-CO-TRW.
      * KEC 2016.0315 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED CD-FEE???? TO CD-GC-????.
      * BLM 160428 FIX FOR NEW DS-DATE FORMAT, YYYYMMDD INSTEAD OF 
      *            YYYMMDD, AND CHANGES TO DS-UNEARNED TABLE, PD0003
      *
      * KEC 2016.0505 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED MA-APPNO TO MA-APP-NUMBER TO MATCH MA1-KEY.
      *         CHANGED MEMOSTATUS-APPNO TO MEMOSTATUS-APP-NUMBER
      *          AND INCREASE FROM 6 TO 9 BYTES.
      *         CHANGED MEMOSTATUS-NUMBER TO MEMOSTATUS-ACCTNO 
      *          AND INCREASE FROM 6 TO 8 BYTES.
      *         CHANGED MEMOSTATUS-STATUS-DATE FROM 6 TO 8 BYTES.
      *         CHANGED MA-STATUS-CD TO MA-STATUS-REASON.
      * CS 160509 REMOVED REDEF OF LE-FLAG/LE-SSNO AND MADE SEPARATE FIELDS
      *           CHANGED LE-FLAG FROM PIC X(4) TO PIC X.
      * CS 160513 MOVE LN-OWNBR TO LE-BRNO
      * KEC 2016.0524 CHANGED USE OF MA-APPDATE & MA-STATUS-DATE
      *               TO USE CCYYMMDD.
      * KEC 2016.0525 CHANGED USE OF MA-TRACK-STATUS TO BE X(10).
      * MJD 160608 ADDED CONDITIONAL-SEND-MESS AND LNCRE2 LOGIC WORLD PR#1133
      * KEC 2016.0621 REMOVED USE OF THE MX-FILE [LIBLA/LAFDMX].
      *               REMOVED USE OF OLD STATUS ROUTINES [LIBLA/MASTATUS(W)].
      *               ADDED USE OF NEW MA-STATUS-INFO FIELDS; AS WELL AS
      *               ADDED USE OF NEW ROUTINES [LIBLA/LAFRMA & LAWSMA].
      * BLM 160726 IF GP-I-AM-WORLD & CD-GC-COMM-PERCENT = 99.99, FORCE THE
      *            PAYABLE PERCENT TO 100, FOR LIVE CHECKS, WORLD PR# 1170
      * MJD 160726 CHANGED TO NOT PERFORM SEND-LEGEND IF CALLED FROM LNCRE2.
      *            WRFORM WITHOUT LIST ONLY WAS WAS DISPLAYING GARBAGE IN THE
      *            SYSDATE/CONAME FIELD                            61000 PR#1148
      * MJD 160818 ADDED AN GET-LIVECHECK-FEES TO CALCULATE THE AMOUNT OF FEES
      *            FROM LIVE CHECKS THAT NEED TO BE INCLUDED IN 
      *            HIGH-CREDIT/LN-CREDITLIM                           61000/1180
      * KEC 2016.0818 REMOVED USE OF THE BA-FILE [LIBLA/LAFDMX].
      *               REVISED LA-REC LAYOUT.
      * MJD 160830 ADDED LOGIC TO SKIP THE CLEAR/DESCTROY OF SCREEN OF
      *            CALLED FROM LNCRE2.  IT WAS CLEARING THE WINDOW
      *            OPENED FROM EOINIT AND CAUSING PROBLEMS WITH THE REPORT
      *            OFF OF THE MENU AND IN BATCH.
      * KEC 2017.0105 CHANGED DS-DATE TO DS-DATE-CCYYMM FOR CONSISTENCY
      *               WITH THE DATE FIELDS IN BY & UD FILE.
      * KEC 2017.0119 CHANGED FD-SMARTPORT TO FD-OPTION [88 LEVELS].
      * BLM 170418 REMOVED SOME OLD GIFTNET LOGIC, WRITING OF SHIP-TO
      *            LOAN MEMO, SOME UNEARNINGS STUFF WITH CTFILE
      * BLM 170418 ACTIVATE 8 DIGIT DATES
      * KEC 2017.0425 FIXED 'LE' FILE TO HAVE SUB-PREFIX OF 'E' OR 'R'.
      *  CS 170608 ADDED UPDATE-LTR1-FILE(CYCLE DATE, MEMBERSHIP,
      *            CHARGE LATE,INT. ADDED LTR FILE
      * BAH 171204 UPDATE LN-GIFTNET WITH "X" IF SP-NON-LOAN-FLAG = "Y"
      *            FOR WORLD TAX ADVANCE LAONS TO NOT BE CONSIDERED DUAL
      *            LOANS, AND IF SP-SKIP-TRW = "Y", SET LN-SKIP-TRW TO "Y"
      *                                            WORLD PR#1288
      * BAH 171212 ADDED MISSING LIVE CHECK CHANGES
      * BLM 180228 FIX UPDATE OF NONFILE, AD&D & ROADGARD TO TY-FEE-TYPE
      *            TABLE INSTEAD OF TY-INS TABLE
      * BAH 181115 GLOBAL FMFILE
      * BAH 181128 GLOBAL LMFILE
      * BAH 181210 GLOBAL LNFILE
      * BAH 181227 GLOBAL LPFILE
      * BAH 190111 GLOBAL PDFILE
      * BAH 190116 GLOBAL LXFILE, SPLIT
      * BAH 190131 REMOVED CT-FILE
      * BAH 190131 SPLIT CDFILE
      * BAH 190312 MOVED FM-BRNO2 INTO LPWSFM-EDIT-FM-INITKEY TO REMOVE THE
      *            REDEFINE IN THE FM-REC
      * BAH 190318 MOVED LN-FEECODE-CH1 TO LPAMTSW-FEECODE-CH1
      * BAH 190322 REMOVED TRF REVOLVING, CHANGED TRLFILE
      *  CS 190607 CHANGE PERFORM CLEAR-EARNING-WK TO 10 TIMES. EARNING-WK
      *            POPULATED BY MOVE OF LN-ANTICERN(1-6), WITH THE CLEAR
      *            EARNING-WK TO 10, WILL MOVE THESE OCCURANCES WITH 0
      *            TO LXE-EARN(7-10). CLEAR FUTURE FIELDS PRIOR TO WRITE
      * BAH 20190613 ADDED CLEAR-FM-FILE (LPFMCL) AND SET FM-USERID
      * BAH 20190625 REMOVED GB-NEXT-SF-REVOL GB-NEXT-LN-REVOL PT0153
      * BAH 20190625 REMOVED LN-REVOLVING, PT0153
      * BAH 20190719 ADDED CLEAR-LTF-FILE (LPLTFCL) FUTURE FIELDS NOT SET
      * BAH 20190719 ADDED CLEAR-LTA-FILE (LPLTACL) FUTURE FIELDS NOT SET
      * BAH 20190920 REMOVED ACCESS-CALL ON FMFILE
      * BAH 20200617 CHANGED PC-LT-RECORD TO PC-LTA-RECORD
      * BAH 20200615 ADDED OPEN-IC1-FILE AND CLOSE-IC1-FILE, REMOVED FROM
      *              LPIEXP COPY MEMBER #TST001
      * BLM 20210920 MOVE BX-PATH-OWNBR TO BX-BRNO BEFORE WRITING BX
      * BAH 20220422 UPDATE TL-ACTIONCD2, SECURITIZATION #1551
      * BAH 20220823 HARD CODED START
      * BAH 20220830 ADDED UPDATE FOR ECOMPLISH NEW LOANS SO AUTO PAY
      *              CAN BE SET UP IMMEDIATELY. WAC WILL SCAN THIS FOLDER
      *              FOR ANY FILES AND SEND TO ECOMPLISH INSTANTLY. #1569
      * BAH 20220913 CHANGED DIRECTORY FOR ECOMPLISH NEW LOANS AS TEST WAS
      *              GOING INTO SAME DIRECTORY, MOVED UNDER DATA/R1/FTP #1569A
      * BAH 20221128 ADDED UPDATE FOR REPAY NEW LOANS SO AUTO PAY CAN BE
      *              SET UP IMMEDIATELY. WAC WILL SCAN DATA/R1/FTP FOLDER
      *              FOR ANY FILES AND SEND TO REPAY INSTANTLY. #1579
      * BAH 20230510 REMOVED ECOMPLISH, ONLY USING REPAY NOW. #1603
      * BAH 20230712 COMMENT OUT 3RD AND 4TH BORROWER TESTS, LN6 AND LN7
      * BAH 20240109 ADDED UPDATE OF SECOND BENEFICIARY TO LS MISC FILE #1637
      * BAH 2024.0130 CALL CRNOR2 AND WRITE NOTICE RECORD
      * BAH 2024.0206 REMOVED CREATE OF LEFILE "E" RECORDS PER KEVIN
      * BAH 20240221 REMOVED UPDATE FOR REPAY NEW LOANS, MOVED TO LONPD0 AS
      *              IT NOW NEEDS FUND TO DEBIT AMOUNT #1646
      * BAH 2025.0106 ADDED BW-UMC-EXPIRE-DATE AND BW-UMC-PR-EXPIRE-DATE #1687
      *                                                           S35Q-146
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. 3B.
       OBJECT-COMPUTER. 3B.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
       COPY "LIBLP/LPFSWK.CPY".

       I-O-CONTROL.
       DATA DIVISION.
       FILE SECTION.

       COPY "LIBLP/LPFDWK.CPY".

       WORKING-STORAGE SECTION.
       77  SCCS-IDENTIFIER PIC X(37) VALUE
           "@(#)LP/LONPC2 S35 05/24/24-11:03:27 >".
      **********************************
      *       F I L E   I F N          *
      **********************************
       COPY "LIBGB/GB01GB.CPY".
       COPY "LIBGB/GB01GB_SQL.CPY".
       COPY "LIBGB/GBWSGB.CPY".
       COPY "LIBGB/GB01BR.CPY".
       COPY "LIBGB/GB01BR_SQL.CPY".
       COPY "LIBGB/GBWSBR.CPY".
       COPY "LIBLP/LP01LX.CPY".
       COPY "LIBLP/LP01LX_SQL.CPY".
       COPY "LIBLP/LPWSLX.CPY".
       COPY "LIBLP/LP01LXE.CPY".
       COPY "LIBLP/LP01LXE_SQL.CPY".
       COPY "LIBLP/LPWSLXE.CPY".
       COPY "LIBLP/LP01LC.CPY".
       COPY "LIBLP/LP01LC_SQL.CPY".
       COPY "LIBLP/LPWSLC.CPY".
       COPY "LIBLP/LP01LN.CPY".
       COPY "LIBLP/LP01LN_SQL.CPY".
       COPY "LIBLP/LPWSLN.CPY".
       COPY "LIBLP/LP01LM.CPY".
       COPY "LIBLP/LP01LM_SQL.CPY".
       COPY "LIBLP/LPWSLM.CPY".
       COPY "LIBLP/LP01LP.CPY".
       COPY "LIBLP/LP01LP_SQL.CPY".
       COPY "LIBLP/LPWSLP.CPY".
       COPY "LIBLP/LP01SP.CPY".
       COPY "LIBLP/LP01SPA.CPY".
       COPY "LIBLP/LP01SPB.CPY".
       COPY "LIBLP/LP01SPC.CPY".
       COPY "LIBLP/LP01SP_SQL.CPY".
       COPY "LIBLP/LPWSSP.CPY".
       COPY "LIBLP/LP01BW.CPY".
       COPY "LIBLP/LP01BW_SQL.CPY".
       COPY "LIBLP/LPWSBW.CPY".
       COPY "LIBLP/LP01TY.CPY".
       COPY "LIBLP/LP01TY_SQL.CPY".
       COPY "LIBLP/LPWSTY.CPY".
       COPY "LIBLP/LP01DS.CPY".
       COPY "LIBLP/LP01DS_SQL.CPY".
       COPY "LIBLP/LPWSDS.CPY".
       COPY "LIBLP/LP01PD.CPY".
       COPY "LIBLP/LP01PD_SQL.CPY".
       COPY "LIBLP/LPWSPD.CPY".
       COPY "LIBLP/LP01PC.CPY".
       COPY "LIBLP/LP01PC_SQL.CPY".
       COPY "LIBLP/LPWSPC.CPY".
       COPY "LIBLP/LP01FD.CPY".
       COPY "LIBLP/LP01FD_SQL.CPY".
       COPY "LIBLP/LPWSFD.CPY".
       COPY "LIBLP/LP01FM.CPY".
       COPY "LIBLP/LP01FM_SQL.CPY".
       COPY "LIBLP/LPWSFM.CPY".
       COPY "LIBLP/LP01NO.CPY".
       COPY "LIBLP/LP01NO_SQL.CPY".
       COPY "LIBLP/LPWSNO.CPY".
       COPY "LIBLP/LP01IC.CPY".
       COPY "LIBLP/LP01IC_SQL.CPY".
       COPY "LIBLP/LPWSIC.CPY".
       COPY "LIBLP/LP01CD.CPY".
       COPY "LIBLP/LP01CD_SQL.CPY".
       COPY "LIBLP/LPWSCD.CPY".
       COPY "LIBLP/LP01CDB.CPY".
       COPY "LIBLP/LP01CDB_SQL.CPY".
       COPY "LIBLP/LPWSCDB.CPY".
       COPY "LIBLP/LP01LSM.CPY".
       COPY "LIBLP/LP01LSM_SQL.CPY".
       COPY "LIBLP/LPWSLSM.CPY".
       COPY "LIBLP/LP01LTF.CPY".
       COPY "LIBLP/LP01LTF_SQL.CPY".
       COPY "LIBLP/LPWSLTF.CPY".
       COPY "LIBLP/LP01LTA.CPY".
       COPY "LIBLP/LP01LTA_SQL.CPY".
       COPY "LIBLP/LPWSLTA.CPY".
       COPY "LIBLP/LP01LTC.CPY".
       COPY "LIBLP/LP01LTC_SQL.CPY".
       COPY "LIBLP/LPWSLTC.CPY".
       COPY "LIBLP/LP01LTB.CPY".
       COPY "LIBLP/LP01LTB_SQL.CPY".
       COPY "LIBLP/LPWSLTB.CPY".
       COPY "LIBLP/LP01LTD.CPY".
       COPY "LIBLP/LP01LTD_SQL.CPY".
       COPY "LIBLP/LPWSLTD.CPY".
       COPY "LIBLP/LP01LTP.CPY".
       COPY "LIBLP/LP01LTP_SQL.CPY".
       COPY "LIBLP/LPWSLTP.CPY".
       COPY "LIBLP/LP01LTI.CPY".
       COPY "LIBLP/LP01LTI_SQL.CPY".
       COPY "LIBLP/LPWSLTI.CPY".
       COPY "LIBLP/LP01CI.CPY".
       COPY "LIBLP/LP01CI_SQL.CPY".
       COPY "LIBLP/LPWSCI.CPY".
       COPY "LIBLP/LP01BX.CPY".
       COPY "LIBLP/LP01BX_SQL.CPY".
       COPY "LIBLP/LPWSBX.CPY".
       COPY "LIBLP/LP01TRL.CPY".
       COPY "LIBLP/LP01TRL_SQL.CPY".
       COPY "LIBLP/LPWSTRL.CPY".


       01  WK-IFN          PIC X(2) VALUE "WK".
       01  WK-KEY          PIC 9(2).


      *********************************************************
      *   LNFILE ARCHIVE PATH WORKERS
      *********************************************************
      *01  LN-ARCHIVE-PATH.
      *    03  FILLER                     PIC X     VALUE "/".
      *    03  LN-ARCHIVE-PATH1.
      *        05  LN-ARCHIVE-DIR1        PIC X(3).
      *        05  FILLER                 PIC X     VALUE "/".
      *        05  LN-ARCHIVE-DIRECTORY   PIC X(4).
      *        05  FILLER                 PIC X     VALUE "/".
      *        05  LN-ARCHIVE-MACHINE     PIC XX.
      *        05  FILLER                 PIC X     VALUE "/".
      *        05  LN-ARCHIVE-DATA        PIC X(6).
      *    03  FILLER                     PIC X(10) VALUE
      *        "/LP/LNFILE".


       01  EARNING-WK-TAB.
           03  EARNING-WK  OCCURS 10 TIMES
                           PIC S9(7)V99 COMP-3.

       01  GA-SCHG-PATH.
           03  FILLER         PIC X(7)     VALUE "CL/GASC".
           03  GA-SCHG-NO     PIC 99.


       01  WS-SECOND-BEN-NAME    PIC X(32) VALUE SPACES.
       01  WS-SECOND-BEN-ADR     PIC X(32) VALUE SPACES.
       01  WS-SECOND-BEN-CITY    PIC X(16) VALUE SPACES.
       01  WS-SECOND-BEN-STATE   PIC X(2) VALUE SPACES.
       01  WS-SECOND-BEN-ZIP     PIC X(10) VALUE SPACES.
       01  WS-SECOND-BEN-PHONE   PIC 9(10) VALUE 0.
       01  WS-SECOND-BEN-RELATION PIC X(15) VALUE SPACES.

       01  UMC-TERM               PIC 9(3)V99.
       01  UMC-TERMX REDEFINES UMC-TERM.
           03  UMC-WHOLE          PIC 9(3).
           03  UMC-DEC1           PIC 9.
           03  UMC-DEC2           PIC 9.
       01  FEE-SUB             PIC 9(6) COMP-3.

       01  WSEL-LIST          PIC X(5)    VALUE "WSEL.".
       01  MSEL-LIST          PIC X(5)     VALUE "MSEL.".
       01  NO-CREATE-FG       PIC 9.
       01  SAVE-NO-REC        PIC X(NO-SIZE).
       01  SUB-LT             PIC 9(6) COMP-3.
       01  WRITE-THE-LT       PIC X.
       01  FM-SUB             PIC 9(6) COMP-3.
       01  SUB                PIC 9(6) COMP-3.
       01  E-SUB              PIC 9(6) COMP-3.
       01  B-SUB              PIC 9(6) COMP-3.
       01  WK-OVRDRATE        PIC 9(7)V999 COMP-3.
       01  REC-EXISTS         PIC X        VALUE "N".
       01  LOAN-RENEWAL       PIC X        VALUE "N".
       01  FEE-UNEARN         PIC S9(7)V99 VALUE 0.

       01  MISC-INS-WORKERS.
           03  ADD-WRITTEN         PIC X(01)   VALUE "N".
           03  ROADGARD-WRITTEN    PIC X(01)   VALUE "N".
           03  NON-FILE-WRITTEN    PIC X(01)   VALUE "N".

       01  SAVE-PRLNNO        PIC 9(10).

       01  HOLD-FM1-KEY       PIC X(28)     VALUE SPACES.
       01  HOLD-LM1-KEY       PIC X(23).
       01  HOLD-LM-SEQ        PIC 9(3)    VALUE 0.
       01  HOLD-BW-ZIP        PIC X(10).
       01  HOLD-LN-ACCTNO     PIC 9(8)    COMP-3.
       01  HOLD-LN-LNAMT      PIC 9(6)V99 COMP-3.
       01  HOLD-LN-LOANDATE   PIC 9(8)    COMP-3.
       01  HOLD-LN-SSNOS.
           03  HOLD-LN-SSNO   PIC 9(10)   COMP-3  OCCURS 2.
      *    03  HOLD-LN-SSNO   PIC 9(10)   COMP-3  OCCURS 4.
       01  SAVE-OUTBAL          PIC S9(7)V99 COMP   VALUE 0.

       01  M-LE-MSG.
           03  FILLER        PIC X(32)   VALUE
           "ENDORSER RECORD EXISTS !, KEY = ".
           03  M-LE-ACCTNO   PIC 9(8).
           03  FILLER        PIC X       VALUE " ".
           03  M-LE-SSNO     PIC 9(9).
           03  FILLER        PIC X       VALUE " ".
           03  M-LE-OSACCTNO PIC 9(8).

       01  SAVE-LP1-KEY.
           03  SAVE-LP-BRNO   PIC 9(4).
           03  SAVE-LP-ACCTNO PIC 9(8).
           03  SAVE-LP-SEQNO  PIC 9(5).

       01  SAVE-TL-LINE       PIC 9(3).

       01  W-DL            PIC 9(4)V99.
       01  FILLER          REDEFINES W-DL.
           03  W-DL-NO     PIC 9(4).
           03  W-DL-BR     PIC 9(4).
       01  W-DLNO          REDEFINES W-DL
                           PIC 9(6).

       01  WKS-NPR-PPY               PIC 9(2).
       01  WKS-NPR-R                 PIC 9(3)V9(4).
       01  WKS-ROUNDV999             PIC S9999V999  COMP.

       01  PRIOR-BNKRPTDATE      PIC 9(8)    COMP  VALUE 0.
       01  PRIOR-CONFIDENTCD     PIC X.
       01  PRIOR-DLDISC-UNEARN   PIC S9(7)V99 COMP VALUE 0.
       01  WS-MEMO-APPROVAL.
           03  WS-MEMO-APPROVAL-LIMIT  PIC $$$$$$9.
           03  FILLER                  PIC X(13) VALUE
               " APPROVED BY ".
           03  WS-MEMO-APPROVAL-USERID PIC X(10).
       01  HOLD-COMM-PERCENT     PIC 999V99 VALUE 0.

       COPY "LIBGB/ACCESSW.CPY".
       COPY "LIBCL/GASCHGW.CPY".
       COPY "LIBLP/LPWKPATH.CPY".
       COPY "LIBGB/CONNECTW_SQL.CPY".
       COPY "LIBGB/FILEWK.CPY".
       COPY "LIBGB/MESSWK.CPY".
       COPY "LIBCL/CREAIXW.CPY".
       COPY "LIBCL/CREARXW.CPY".
       COPY "LIBGB/DATERW.CPY".
       COPY "LIBLP/SETCTBLW.CPY".
       COPY "LIBGB/SPPDTHW.CPY".
       COPY "LIBLP/LPXDTEW.CPY".
       COPY "LIBGB/REBATEW.CPY".
       COPY "LIBGB/AGEINGW.CPY".
       COPY "LIBLP/LPUPWKW.CPY".
       COPY "LIBLP/LPAMTSW.CPY".
       COPY "LIBLP/LPMDTEW.CPY".
       COPY "LIBLP/LPCEPPW.CPY".
       COPY "LIBLP/LPPOFFW.CPY".
       COPY "LIBLP/LPITRMW.CPY".
       COPY "LIBCL/CRNOR2W.CPY".
       COPY "LIBLP/LPRATEW.CPY".
       COPY "LIBLP/LPIBPCW.CPY".
       COPY "LIBLP/LPUERNW.CPY".
       COPY "LIBLP/LPEARNW.CPY".
       COPY "LIBLP/LPCERNW.CPY".
       COPY "LIBLP/LPEADJW.CPY".
       COPY "LIBLP/LPMENUW.CPY".
       COPY "LIBLP/LPAPRSW.CPY".
       COPY "LIBLP/LPAPRZW.CPY".
       COPY "LIBLP/LPUPERW.CPY".
       COPY "LIBLP/LPSETTYW.CPY".
       COPY "LIBLP/LPDSCLW.CPY".
       COPY "LIBLP/POSTDATEW.CPY".
       COPY "LIBGB/GETENVW.CPY".
       COPY "LIBLP/LPSRCDW.CPY".
       COPY "LIBGB/RBACTW.CPY".
       COPY "LIBGB/GPENVW.CPY".
       COPY "LIBLP/LPREGZW.CPY".
       COPY "LIBLP/LPIEXPW.CPY".
       COPY "LIBGB/PHON400.CPY".
       COPY "LIBLP/LPPDUEW.CPY".
       COPY "LIBLP/LNCOSTW.CPY".
       COPY "LIBLP/RNFOR10W.CPY".
       COPY "LIBWI/W12EQ2W.CPY".

       COPY "LIBGB/SCREENW.CPY".
       COPY "LIBLP/XONPC_DEF.CPY".
       COPY "LIBGB/CONAME_EXT.CPY".
       COPY "LIBLP/XONPC_WKS.CPY".
       COPY "LIBGB/HELPLINK.CPY".

       COPY "LIBGB/GETFMW.CPY".
       COPY "LIBLP/LPLOANW.CPY".
       COPY "LIBLP/LPPFBUF.CPY".

       SCREEN SECTION.
       COPY "LIBLP/XONPC_SCN.CPY".

       PROCEDURE DIVISION
             USING FORM-PATHNAME EXIT-PATHNAME PROG-BUF UPDATE-BUF.
       DECLARATIVES.
       DECLARE-ERROR SECTION.
           USE AFTER ERROR PROCEDURE ON
               WK-FILE.
       COPY "LIBGB/DECLARE.CPY".
           PERFORM CLOSE-TY1-FILE.
           PERFORM CLOSE-TRL1-FILE.
           PERFORM CLOSE-SP1-FILE.
           PERFORM CLOSE-PD1-FILE.
           PERFORM CLOSE-PC1-FILE.
           PERFORM CLOSE-NO1-FILE.
           PERFORM CLOSE-LXE1-FILE.
           PERFORM CLOSE-LX1-FILE.
           PERFORM CLOSE-LTP1-FILE.
           PERFORM CLOSE-LTI1-FILE.
           PERFORM CLOSE-LTF1-FILE.
           PERFORM CLOSE-LSM1-FILE.
           PERFORM CLOSE-LTC1-FILE.
           PERFORM CLOSE-LTB1-FILE.
           PERFORM CLOSE-LTD1-FILE.
           PERFORM CLOSE-LTA1-FILE.
           PERFORM CLOSE-LP1-FILE.
      *    PERFORM CLOSE-LN7-FILE.
      *    PERFORM CLOSE-LN6-FILE.
           PERFORM CLOSE-LN5-FILE.
           PERFORM CLOSE-LN4-FILE.
           PERFORM CLOSE-LN1-FILE.
           PERFORM CLOSE-LM1-FILE.
           PERFORM CLOSE-LC1-FILE.
           PERFORM CLOSE-IC1-FILE.
           PERFORM CLOSE-FM1-FILE.
           PERFORM CLOSE-FD1-FILE.
           PERFORM CLOSE-DS1-FILE.
           PERFORM CLOSE-CI1-FILE.
           PERFORM CLOSE-CDB1-FILE.
           PERFORM CLOSE-CD1-FILE.
           PERFORM CLOSE-BX1-FILE.
           PERFORM CLOSE-BW1-FILE.
           PERFORM CLOSE-GB-FILE.
           PERFORM CLOSE-BR-FILE.
           CLOSE WK-FILE.
       COPY "LIBGB/DECLAR2.CPY".

      /**********************************
      *   C O N T R O L   M O D U L E   *
      ***********************************
       MAIN-PROGRAM SECTION.

           PERFORM SQL-CONNECT.

      D    STOP MESS.
           MOVE FORM-PATHNAME TO FORM-PATH.

           IF LPLOAN-CALLED-FROM = "LNCRE2"
              PERFORM SETUP-LOCAL-PATHS.

           MOVE USER-PID TO TEMP-PID.

      *    MOVE TRANS-MONTH TO TRANS-PATH-MONTH.
      *    MOVE TRANS-YEAR TO TRANS-PATH-YEAR.
           MOVE " " TO ROUTE-CD.
           MOVE " " TO ERRCD.

           PERFORM OPEN-BR-FILE.

           IF LPLOAN-CALLED-FROM = "LNCRE2"
              PERFORM LOAD-TRL1-FILE.

           MOVE 1 TO SUB.
      *    PERFORM CLEAR-EARNING-WK 6 TIMES.
           PERFORM CLEAR-EARNING-WK 10 TIMES.

           MOVE "UPDATING LOAN MASTER...................." TO MESS.
           PERFORM SEND-LEGEND.

           MOVE 2 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           MOVE WK-SAVE-REC TO LN-REC.
           MOVE WK-SECOND-BEN-NAME     TO WS-SECOND-BEN-NAME.
           MOVE WK-SECOND-BEN-ADR       TO WS-SECOND-BEN-ADR.
           MOVE WK-SECOND-BEN-CITY      TO WS-SECOND-BEN-CITY.
           MOVE WK-SECOND-BEN-STATE     TO WS-SECOND-BEN-STATE.
           MOVE WK-SECOND-BEN-ZIP       TO WS-SECOND-BEN-ZIP.
           MOVE WK-SECOND-BEN-PHONE     TO WS-SECOND-BEN-PHONE.
           MOVE WK-SECOND-BEN-RELATION  TO WS-SECOND-BEN-RELATION.

      * BECAUSE OTHER LOAN RECORDS MAY GET READ
           MOVE WK-SAVE-REC TO HOLD-LN-REC.

           MOVE WK-APPROVAL-LIMIT  TO WS-MEMO-APPROVAL-LIMIT.
           MOVE WK-APPROVAL-USERID TO WS-MEMO-APPROVAL-USERID.

           MOVE LN-OWNBR TO BR-NO.
           PERFORM READ-BR-FILE.

           PERFORM GET-GPENV.

      * GET LOAN CLASS RECORD:
           MOVE LN-CLASS TO LC-CODE.
           PERFORM OPEN-LC1-FILE.
           PERFORM READ-LC1-FILE.
           PERFORM CLOSE-LC1-FILE.

      * GET SPR RECORD:
           MOVE LN-SPRCLASS TO SP-SPRCLASS.
           MOVE LN-SUBCLASS TO SP-SUBCLASS.
           MOVE LN-LAWCODE TO SP-LAWCODE.
           MOVE LN-ORGST TO SP-ORGST.
           PERFORM OPEN-SP1-FILE.
           PERFORM READ-SP1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           PERFORM CLOSE-SP1-FILE.

      * WORLD PR#1288 12/04/2017
      *  LN-GIFTNET "X" WILL SET BI-GIFTNET TO "X" WHICH WILL NOT
      *  CONSIDER THESE AS DUAL LOANS, WORLD USING THIS FOR TAX ADVANCE
      *  LOANS
           IF SP-NON-LOAN-FLAG = "Y"
              MOVE "X" TO LN-GIFTNET.

      * PRLNNO NOT AN INPUT FIELD:
           MOVE 0 TO PRIOR-BNKRPTDATE.
           IF LN-PRLNNO NOT = 0
              IF (LN-SRCD = "RN" OR "PB" OR "SC" OR "RB" OR "RO")
                       AND (NOT LN-POCD-INRESCISSION)
                 MOVE "Y" TO LOAN-RENEWAL
                 MOVE LN-PRLNNO TO SAVE-PRLNNO
                 PERFORM SET-PD1-KEY
                 PERFORM OPEN-PD1-FILE
                 PERFORM READ-PD1-FILE
                 PERFORM CLOSE-PD1-FILE
                 IF IO-FG = 0
                    MOVE PD-BNKRPTDATE      TO PRIOR-BNKRPTDATE
                    MOVE PD-CONFIDENTCD     TO PRIOR-CONFIDENTCD
                    MOVE PD-PRDLDISC-UNEARN TO PRIOR-DLDISC-UNEARN
                 ELSE
                    MOVE "RENEWAL RECORD DELETED !" TO MESS
                    PERFORM CONDITIONAL-SEND-MESS
                    GO TO IO-ERROR.
          

           PERFORM UPDATE-LN1-FILE.

      * SETUP DISPLAY LOAN NUMBER:

           IF LN-PRLNNO NOT = 0
              PERFORM UPDATE-LT1-BNKRPT
              PERFORM UPDATE-LM1-BNKRPT.

           PERFORM SET-DELINQUENCY.
           PERFORM UPDATE-LTC1-FILE
           PERFORM UPDATE-LT1-A-FILE.

      *ABOVE UPDATE-LT1-A-FILE IS FOR CMSI, PC RECORD EXITS!

           IF GP-BRING-AUTO-INS-ON-RENEWAL = "Y"
              IF LN-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
                PERFORM GET-COLLATERAL
                IF NOT (CD-CO-SECURED = "U" OR SPACES)
                   PERFORM UPDATE-LT-A-AUTO-INS.

           PERFORM UPDATE-LT1-FEE-FILE.

           PERFORM TEST-FOR-GEORGIA-SCHG.

           PERFORM UPDATE-LP1-FILE.

           PERFORM UPDATE-LXE-FILE.
           IF LN-MIP-FG = "Y"
              PERFORM UPDATE-LXM-FILE.

      * UPDATE THE INSURANCE TAX TRAILER ONLY IF BRANCH FLAG SET
      * TAX CODES IN BORROWER FILE
           IF BR-FORCE-VALID-CITY-COUNTY = "Y"
              PERFORM GET-BW1
              IF BW-COUNTY NOT = SPACES OR BW-CITY NOT = SPACES
                 PERFORM UPDATE-LXX-FILE.

      * LN-POCD = "*I"
           IF LN-POCD-INRESCISSION
              MOVE "W" TO CREARX-ACTION
              PERFORM CREATE-RX1-RECORD
              GO TO UPDATE-CONTINUE.

           PERFORM UPDATE-TR1-FILE.

           PERFORM UPDATE-NOTICE-FILE.

           PERFORM UPDATE-BW1-FILE.

      * NOTE: UPDATE-MA-FILE MUST BE DONE BEFORE DS & TY UPDATE:
           PERFORM UPDATE-DS1-FILE.
           PERFORM UPDATE-TY1-FILE.

           PERFORM UPDATE-FM1-FILE.

      * CREATE MEMO TO DOCUMENT WHO APPROVED LOAN & CREDIT LIMIT
           IF GP-APPROVAL-MEMO = "Y"
              PERFORM UPDATE-LM-APPROVAL.

           IF BR-ALLOW-F3-ALL-DOCS = "Y" AND LN-INSPREM(1) NOT = 0
              IF WS-SECOND-BEN-NAME NOT = SPACES OR
                  WS-SECOND-BEN-PHONE NOT = 0 OR
                   WS-SECOND-BEN-RELATION NOT = SPACES
                 PERFORM UPDATE-LS-MISC-FILE.

           IF GP-CUST-INFO-FG = "Y"
              PERFORM UPDATE-CI1-FILE.

       UPDATE-CONTINUE.
           IF LOAN-RENEWAL NOT = "Y"
              GO TO UPDATES-COMPLETE.

      * REMOVE SCRATCH PAD RECORD:
           PERFORM OPEN-PD1-FILE.
           PERFORM SET-PD1-KEY.
           PERFORM READ-PD1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PD1-FILE
           ELSE
              MOVE "SCRATCH PAD RECORD NOT FOUND" TO MESS
              PERFORM CONDITIONAL-SEND-MESS.

           MOVE "L"        TO PD-ID.
           MOVE BRANCH     TO PD-BRANCH.
           MOVE LN-SSNO(1) TO PD-SOC-SEC.
           PERFORM READ-PD1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PD1-FILE.
           PERFORM CLOSE-PD1-FILE.

      * REMOVE SCRATCH COLLATERAL RECORD:
           PERFORM OPEN-PC1-FILE.
           MOVE "C" TO PC-ID.
           MOVE BRANCH TO PC-BRANCH.
           MOVE LN-SSNO(1) TO PC-SOC-SEC.
           PERFORM READ-PC1-FILE.
           IF IO-FG = 0
              PERFORM DELETE-PC1-FILE.
           PERFORM CLOSE-PC1-FILE.

       UPDATES-COMPLETE.
           MOVE HOLD-LN-REC TO LN-REC.
           MOVE LOAN-KEY    TO LN-ACCTNO.
           MOVE TRANS-DATE  TO LN-ENTDATE.

           IF LN-POCD-INRESCISSION
      * THIS MUST BE HERE, AFTER ALL LN FIELDS ARE DONE BEING USED,
      * BECAUSE THIS READS THE LN FOR THE PRIOR LOAN
              IF LN-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
                 PERFORM UPDATE-PRLOAN-RESCISSION.

           MOVE " " TO WK-SAVE-REC.
           MOVE 0 TO WK-ELE.
           MOVE 2 TO WK-KEY.
           PERFORM REWRITE-WK-FILE.

           MOVE "D0D" TO NEW-PROG-FORM.

           GO TO END-ROUTINE.

      ************************
       UPDATE-LN1-FILE SECTION.
      ************************
           PERFORM OPEN-LN1-FILE.

      *    IF GP-PURGE-TO-ARCHIVE-FG = "Y"
      *       PERFORM SETUP-LN-ARCHIVE-PATH.

           PERFORM GET-ACCOUNT-NUMBER.

      *SET DEFAULT POOLID FROM CLASS FILE MERC(03/16/01)
           IF NOT (LC-POOLID = 20202 OR 02020)
              MOVE LC-POOLID TO LN-DLPOOL.

      * SET LN-LBOX FLAG SO FIRST PAYMENT FOLLOWS CORRECT LATE
      * CHARGE RULES FOR BATCH PAYMENTS
      *    IF GP-I-AM-REGACC
      *       MOVE "Y" TO LN-LBOX.

           MOVE TRANS-DATE TO LN-ENTDATE.
           MOVE LN-LNAMT TO LN-CURBAL.
           MOVE SP-JUDGRATE TO LN-JDRATE.

      *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *-
      *    IF NOT COMING FROM ZONPC0.C, MUST
      *  CONVERT A48 PAY SCHEDULE TO A60, BEFORE ANY CALCUATIONS:
      *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *-
           IF (LN-ORGTERM = 1 AND LN-NOREGPY = 1)
                    OR (LN-ORGTERM > 1 AND LN-LASTPYAMT = 0)
              PERFORM CNV48T60
           ELSE
              MOVE 0 TO LN-SELLPR.
      *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *- *-

      ***************************************************
      *    UPDATE INSURANCE EFF & EXP DATES & COMMISSION
      ***************************************************
           PERFORM OPEN-IC1-FILE.

           PERFORM VARYING IEXP-LN FROM 1 BY 1 UNTIL IEXP-LN > 8
              PERFORM IEXP-INS-CALCULATIONS
              MOVE IEXP-EFFDATE TO LN-INSEFF-DATE(IEXP-LN)
              MOVE IEXP-EXPDATE TO LN-INSEXP-DATE(IEXP-LN)
              MOVE IEXP-INSCOMM TO LN-INSCOMM(IEXP-LN)

      *- WHEN INSURANCE PREMIMUS ARE ZERO SET ALL FIELDS TO SPACES AND ZEROS
              IF LN-INSPREM(IEXP-LN) = ZEROS
                 MOVE ZEROS TO LN-INSCOMP(IEXP-LN)
                               LN-INSEFF-DATE(IEXP-LN)
                               LN-INSEXP-DATE(IEXP-LN)
                               LN-INSCOVR(IEXP-LN)
                               LN-INSPREM(IEXP-LN)
                               LN-INSCOMM(IEXP-LN)
                 MOVE SPACES TO LN-INSOURS(IEXP-LN)
              END-IF
           END-PERFORM.

           PERFORM CLOSE-IC1-FILE.


      *******************************************************
      *    SET MIP INFO (MONTHLY INSURANCE PREMIUMS)
      *    NOTE:
      *         THIS MUST BE DONE AFTER SET OF LN-INSCOMM
      *         AND BEFORE LOAN CALCULATIONS
      *******************************************************
           IF SP-INS-MIP(1) OR SP-INS-MIP(2) OR
              SP-INS-MIP(3) OR SP-INS-MIP(4)
              IF LN-INSTYPES-LL OR LN-INSTYPES-DL
                 MOVE LN-1STPYDATE TO PDTH-DATE-WORK
                 PERFORM PAID-THRU-CALCULATION
                 MOVE "Y" TO LN-MIP-FG
                 MOVE PDTH-DATE-FULL TO LN-MIP-CLPDTH-DATE
                 MOVE "M" TO LN-INSOURS(1).
           IF SP-INS-MIP(5) AND LN-INSTYPES-AH
              MOVE "Y" TO LN-MIP-FG
              MOVE PDTH-DATE-FULL TO LN-MIP-AHPDTH-DATE
              MOVE "M" TO LN-INSOURS(2).

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    SET RECOMPUTED PAYMENT AMOUNTS AFTER SPREADING THE
      *    EXTENSION CHARGE VIA: FORMULA 12
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF SP-PYEXFRMLA-SAME2-SPREAD
              MOVE LN-ORGTERM         TO W12EQ2-ORGTERM
              MOVE LN-EXTCHG          TO W12EQ2-EXTCHG
              MOVE LN-1STPYAMT        TO W12EQ2-1STPYAMT
              MOVE LN-REGPYAMT        TO W12EQ2-REGPYAMT
              MOVE LN-LASTPYAMT       TO W12EQ2-LASTPYAMT
              PERFORM GET-W12EQ2-NEW-PAYMENTS
              MOVE W12EQ2-1STPYAMT    TO LN-1STPYAMT
              MOVE W12EQ2-REGPYAMT    TO LN-REGPYAMT
              MOVE W12EQ2-LASTPYAMT   TO LN-LASTPYAMT.
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

      * TOTAL-REPAY TOTAL-NOTE PRINCIPLE
           PERFORM LOAN-CALCULATIONS.

      ********************************************************
      *    COMPUTE LOAN COST 
      ********************************************************
           IF SP-LNCOST-FRMLA NOT = " "
              IF SP-LNCOST-FRMLA NOT = "D"
                 IF SP-LNCOST-FRMLA NOT = "M"
                   MOVE LN-LNAMT      TO LNCOST-LNAMT
                   MOVE LN-DLPARVHELD TO LNCOST-DLPARVHELD
                   MOVE LN-DLPARVPAID TO LNCOST-DLPARVPAID
                   PERFORM COMPUTE-LOANCOST
                   MOVE LNCOST-LOANCOST TO LN-ANTICERN(6).

      ********************************************************
      *    TAKE EARNINGS UP FRONT
      *    SET UP EARN ORDER FORM SPR'S
      ********************************************************
           MOVE 0 TO UERN.
           PERFORM COMPUTE-UERNINGS.
           MOVE 1 TO SUB.
           PERFORM SET-EARNINGS 6 TIMES.

           PERFORM COMPUTE-EARNINGS.
           MOVE EARN-TOT-ACCERN TO LN-TOTERN LN-NONACRERN.

      **************************************************
      *    UPDATE INTEREST PAID
      *    NEED TO TAKE UPFRONT SERVICE CHARGE FOR IB'S
      **************************************************
      * PL#671  INTEREST PAID TO BE ONLY INTEREST COMPONENT
      *    IF SP-1098FRMLA = "B" OR " "
      *       COMPUTE LN-YTDINTPD = LN-ACCERN(1) + LN-ACCERN(2)
      *                           + LN-ACCERN(3) + LN-ACCERN(4)
      *       MOVE LN-YTDINTPD TO LN-TOTINTPD.
      * PL#671  INTEREST PAID TO BE ONLY INTEREST COMPONENT
           IF SP-1098FRMLA = "B" OR " "
              COMPUTE LN-YTDINTPD = LN-ACCERN(1)
              MOVE LN-YTDINTPD TO LN-TOTINTPD.


      **************************************************
      *    SET LATE CHARGE PAID THRU
      **************************************************
           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.
           PERFORM PAID-THRU-CALCULATION.
           MOVE PDTH-DATE-FULL TO LN-LCPDTH-DATE.

      **************************************************
      *    UPDATE PRIOR LOAN INFO
      **************************************************
           IF LOAN-RENEWAL = "Y"
              MOVE PD-PRBAL TO LN-PRBAL
              MOVE PD-PRINTDUE TO LN-PRINTDUE
              MOVE PD-PRFINCHGRB TO LN-PRFINCHGRB
              MOVE PD-PRINSRB TO LN-PRINSRB
              MOVE PD-PRPOCD TO LN-PRPOCD
              MOVE PD-PRPODATE TO LN-PRPODATE
              MOVE PD-PRCONPROFILE TO LN-PRCONPROFILE
              MOVE PD-PRDELINQAMT TO LN-PRDELINQAMT
              MOVE PD-PRLNAMT TO LN-PRLNAMT
              MOVE PD-PRPDUE-DAYS TO LN-PRPDUE-DAYS

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  JTG 040501 ADDED LOGIC TO CAUSE THE UNEARNED LOAN COST TO ROLL TO
      *             THE NEW LOAN AFTER 'RENEWAL'. NOTE: THIS COST IS REFLECTIVE
      *             OF THE DISCOUNT WHEN PURCHASING LOAN PAPER NOT CARRIED AS
      *             SALES PAPER WITH DEALER DISCOUNT.
      *             ADDED SP-LNCOST-FRMLA = 'R'                    REGENCY #2287
      *       NOTE: LN-PRDLDISC-UNEARN WILL HOLD THE COST (DISCOUNT)
      *             FOR DIRECT LOANS, EVEN THOUGH IT IS NOT TIED TO A DEALER.
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * CARRY OVER UNEARN DEALER DISCOUNT AND ADD TO LN-ANTICERN(6):
              IF SP-LNCOST-FRMLA = "R"
                 MOVE PRIOR-DLDISC-UNEARN TO LN-PRDLDISC-UNEARN
                 ADD PRIOR-DLDISC-UNEARN  TO LN-ANTICERN(6)
              END-IF
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * RETAIN CONFIDENTIAL STATUS:
              MOVE PRIOR-CONFIDENTCD TO LN-CONFIDENTCD
      * RETAIN EXISTING BANKRUPT STATUS:
              IF PRIOR-BNKRPTDATE NOT = 0
                 MOVE PRIOR-BNKRPTDATE TO LN-BNKRPTDATE
                 MOVE "B" TO LN-STATUSFLAGS(1).

      * UPDATE CD-GC-FEE-EARNINGS-FG FEES INTO ANTIC/UNEARNED INTO
      * LOAN ADDON ANTICIPATED:
           PERFORM UPDATE-LN1-FEEUNERN.
           MOVE FEE-UNEARN TO LN-ANTICERN(2).

      * RECOMPUTE LN-APRATE
           IF ( LN-CAN-LOAN-NO NOT = " "  ) OR
              ( SP-PYEXFRMLA-SAME2-SPREAD )
              PERFORM LOAN-CALCULATIONS
              MOVE DISCLOSED-FINAMT TO APR-FINANCED

      * ADDED 'IF' TO STOP LOANS WITH ZERO FINANCE CHARGES,
      * ODD FIRST OR LAST PAYMENTS AND DISCLOSURE FORMULA 'B'
      * FROM RETURNING .0XX APRS:
              IF APR-FINANCED = (LN-1STPYAMT
                                    + (LN-NOREGPY * LN-REGPYAMT)
                                     + LN-LASTPYAMT
                                )
                 MOVE 0 TO APR-APR

              ELSE
                 MOVE LN-ORGTERM      TO APR-ORGTERM
                 MOVE LN-1STPYAMT     TO APR-1STPYAMT
                 MOVE LN-REGPYAMT     TO APR-REGPYAMT
                 MOVE LN-LASTPYAMT    TO APR-LASTPYAMT
                 MOVE LN-INTDATE      TO APR-INTDATE
                 MOVE LN-1STPYDATE    TO APR-1STPYDATE
                 MOVE LN-UNITPER-CD   TO APR-UNITPER-CD
                 MOVE LN-UNITPER-FREQ TO APR-UNITPER-FREQ
                 MOVE SP-DISFRMLA     TO APR-DISFRMLA
                 PERFORM MFFRMLA05-PMT-ADJ
                 PERFORM APR-REGZ
                 PERFORM MX-ADJUSTED-APR
              END-IF
              MOVE APR-APR TO LN-APRATE.

      * GET SIMPLE AND EFFECTIVE RATES
           PERFORM APRS-RATE.
           IF NOT ( SP-CAL-ONEPAY-GT-1YR(APRS-CTBL) AND
                    LN-ORGTERM = 1 )
              MOVE APRS-SMPRATE TO LN-SMPRATE
              MOVE APRS-EFFRATE TO LN-EFFRATE.

      * 080989 ADDED FOR WAGNER NC
           IF SP-CAL-SET-EFFECTIVE(APRS-CTBL)
              MOVE LN-EFFRATE TO LN-OVRDRATE.

      * JTG 010112 ADDED NEW 88  SP-CAL-SET-SMPRATE-OVRRIDE VALUE 4 MERC 
           IF SP-CAL-SET-SMPRATE-OVRRIDE(APRS-CTBL)
              MOVE LN-SMPRATE TO LN-OVRDRATE.

      * 091091
      * ADJUST OVERIDE RATE ON SINGLE PAY SIMPLE
      * IF RUNTIME INTEREST IS CALCULATED ON AN
      * ORDINARY METHOD:
      * 071897
      * ADDED TEST FOR SP-PACESETTER-FG AND 999.999
           IF SP-PACESETTER-FG = "Y"
              IF LN-OVRDRATE NOT = 999.999
                 IF LN-LOANTYPE = "I"
                        AND LN-ORGTERM = 1
                         AND SP-CAL-SIMPLE(CTBL)
                          AND SP-YEARTYPE = 360
                    MOVE LN-INTDATE TO NUM-DATE
                    MOVE LN-1STPYDATE TO SYS-DATE
                    PERFORM TIM365
                    COMPUTE WK-OVRDRATE = LN-OVRDRATE * ELAPSED-DAYS
                    MOVE LN-INTDATE TO NUM-DATE
                    MOVE LN-1STPYDATE TO SYS-DATE
                    PERFORM TIM360
                    COMPUTE LN-OVRDRATE ROUNDED =
                                    WK-OVRDRATE / ELAPSED-DAYS.

      * ESTABLISH CREDIT LIMIT
           IF BR-AVAIL-CREDIT = "Y" OR "S"
              IF LC-CALC-HI-CREDIT = "C" OR SPACE OR "W" 
                 MOVE HIGH-CREDIT TO LN-CREDITLIM
              ELSE
                 IF LC-CALC-HI-CREDIT = "L"
                    PERFORM GET-LIVECHECK-FEES
                    COMPUTE LN-CREDITLIM = 
                               HIGH-CREDIT + LIVE-CHECK-FEES.

      * GET IB EARNINGS FIELDS SP-ERNFRMLA = 15 & 16
           IF 15 = SP-ERNFRMLA(1) OR SP-ERNFRMLA(5)
              SUBTRACT LN-DLDISC FROM LN-LNAMT GIVING LN-ERN-IB-PRINBAL
              IF LN-LOANTYPE = "P"
                 SUBTRACT LN-INTCHG LN-EXTCHG FROM LN-ERN-IB-PRINBAL.

           IF SP-ERNFRMLA(5) = 16
              MOVE LN-LNAMT TO LN-ERN-IB-PRINBAL
              IF LN-LOANTYPE = "P"
                 SUBTRACT LN-INTCHG LN-EXTCHG FROM LN-ERN-IB-PRINBAL.

      * SET LAST RENEWAL DATE FOR RENEWALS LESS THAN 10%:
           IF GP-RN-FOR10-LN = "Y"
              PERFORM COMPUTE-RNFOR10
              IF RNFOR10-FG = "Y"
                 MOVE LN-LAST-RN-FOR10-DATE TO LN-PRIOR-RN-FOR10-DATE
                 MOVE LN-LOANDATE TO LN-LAST-RN-FOR10-DATE.

      * IF SPR'S INDICATE AMORTIZED INTEREST;
           IF SP-CAL-AMORTIZED(CTBL-INDEX)
              PERFORM SET-INITIAL-AMORT-LFP.

      * REGACC PR# 158
           MOVE BR-COUPON-STATEMENT TO LN-COUPON-STATEMENT.

           IF GP-DEFAULT-SKIP-TRW = "Y"
              MOVE GP-DEFAULT-SKIP-TRW TO LN-SKIP-TRW.
           IF SP-SKIP-TRW = "Y"
              MOVE SP-SKIP-TRW TO LN-SKIP-TRW.

       WRITE-LOAN-REC.

           PERFORM WRITE-LN1-FILE.
           IF IO-FG = 0
              GO TO EXIT-UPDATE-LN1.

       FIND-NEXT-ACCOUNT-NUMBER.

      * ASSIGN TO NEXT AVAILABLE ACCOUNT NUMBER:
      *          RANGE NEEDED TO PROTECT LONPM2:

           IF LN-SMALLOAN = "Y" AND GB-NEXT-SMALL < 989999
              PERFORM GET-ACCOUNT-NUMBER
              GO TO WRITE-LOAN-REC.

           IF LN-SMALLOAN = "N" AND GB-NEXT-OTHER < 989999
              PERFORM GET-ACCOUNT-NUMBER
              GO TO WRITE-LOAN-REC.

           MOVE "GLOBAL LOAN COUNTER NOT < 990000 !" TO MESS
           PERFORM CONDITIONAL-SEND-MESS
           GO TO IO-ERROR.

       EXIT-UPDATE-LN1.
           PERFORM CLOSE-LN1-FILE.
           MOVE LN-ACCTNO TO LOAN-KEY.      

      *********************************************************
       UPDATE-LN1-FEEUNERN SECTION.
      *********************************************************

      * READ FEES TALLYING ALL FEES FLAGGED AS EARNING TYPE
      * THAT OUR THE FINANCE COMPANIES FEES

           PERFORM OPEN-CDB1-FILE.

           MOVE 0 TO FEE-UNEARN.

           PERFORM VARYING SUB-LT FROM 1 BY 1 UNTIL SUB-LT > 10
              IF LN-FEECODE(SUB-LT) NOT = 0
                 MOVE "GC"               TO CDB-TYPE
                 MOVE LN-OWNBR           TO CDB-BRANCH
                 MOVE LN-FEECODE(SUB-LT) TO CDB-CODE
                 PERFORM READ-CDB1-FILE
                 IF ( IO-GOOD                     ) AND
                    ( CDB-GC-FEE-EARNINGS-FG = "Y" )
                    ADD LN-FEEAMT(SUB-LT) TO FEE-UNEARN
                 END-IF
              END-IF
           END-PERFORM.

       EXIT-UPDATE-LN1-FEEUNERN.
           PERFORM CLOSE-CDB1-FILE.

      *****************************************
       UPDATE-LT1-FEE-FILE SECTION.
      *****************************************
           PERFORM OPEN-LTF1-FILE.
           PERFORM OPEN-CDB1-FILE.

           MOVE "N" TO WRITE-THE-LT.

           PERFORM CLEAR-LTF-FILE.

           MOVE LN-OWNBR  TO LTF-BRNO.
           MOVE LN-ACCTNO TO LTF-ACCTNO.
           MOVE 1         TO LTF-SEQNO.

           PERFORM VARYING SUB-LT FROM 1 BY 1 UNTIL SUB-LT > 10
              MOVE 0 TO LTF-FEECODE-PAYABLE(SUB-LT)
           END-PERFORM.

           MOVE 0 TO SUB-LT.
       UPDATE-LT1-FEE-NEXT.
           ADD 1 TO SUB-LT.
           IF SUB-LT > 10
              GO TO END-UPDATE-LT1-FEE-FILE.

           IF LN-FEEAMT(SUB-LT) = 0
              GO TO UPDATE-LT1-FEE-NEXT.

           MOVE "GC"               TO CDB-TYPE.
           MOVE LN-OWNBR           TO CDB-BRANCH.
           MOVE LN-FEECODE(SUB-LT) TO CDB-CODE.
           PERFORM READ-CDB1-FILE.
           IF IO-FG NOT = 0
              GO TO UPDATE-LT1-FEE-NEXT.

           IF (CDB-GC-COMM-PERCENT = 99.99)
              MOVE 100 TO HOLD-COMM-PERCENT
           ELSE
              MOVE CDB-GC-COMM-PERCENT TO HOLD-COMM-PERCENT.
           IF HOLD-COMM-PERCENT NOT = 0 AND
                               NOT = 20.20
              COMPUTE LTF-FEECODE-PAYABLE(SUB-LT) ROUNDED =
                        HOLD-COMM-PERCENT / 100 * LN-FEEAMT(SUB-LT)
              MOVE LN-FEECODE(SUB-LT) TO LTF-FEECODE(SUB-LT)
              MOVE "Y" TO WRITE-THE-LT.

           GO TO UPDATE-LT1-FEE-NEXT.

       END-UPDATE-LT1-FEE-FILE.
           IF WRITE-THE-LT = "Y"
              PERFORM WRITE-LTF1-FILE.

       EXIT-UPDATE-LT1-FEE-FILE.
           PERFORM CLOSE-LTF1-FILE.
           PERFORM CLOSE-CDB1-FILE.

      *****************************************
       UPDATE-LTC1-FILE SECTION.
      *****************************************
           MOVE 6 TO WK-KEY.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9 OR WK-SAVE-RECORD = SPACES
              GO TO EXIT-UPDATE-LTC.

           PERFORM CLEAR-LTC-FILE.
           PERFORM OPEN-LTC1-FILE.

           IF WK-DESC-1 NOT = SPACES OR
                WK-DESC-2 NOT = SPACES OR
                 WK-HHGS-1 NOT = SPACES OR
                  WK-HHGS-2 NOT = SPACES OR
                   WK-HHGS-3 NOT = SPACES
              MOVE LN-OWNBR      TO LTC-BRNO
              MOVE LN-ACCTNO     TO LTC-ACCTNO
              MOVE 1             TO LTC-SEQNO
              MOVE WK-DESC-1     TO LTC-DESC(1)
              MOVE WK-MAKE-1     TO LTC-MAKE(1)
              MOVE WK-MODEL-1    TO LTC-MODEL(1)
              MOVE WK-YEAR-1     TO LTC-YEAR(1)
              MOVE WK-STYLE-1    TO LTC-STYLE(1)
              MOVE WK-CLASS-1    TO LTC-CLASS(1)
              MOVE WK-VIN-1      TO LTC-VIN(1)
              MOVE WK-TITLE-NO-1 TO LTC-TITLE-NO(1)
              MOVE WK-MILEAGE-1  TO LTC-MILEAGE(1)
              MOVE WK-VALUE-1    TO LTC-VALUE(1)
              MOVE WK-SELLPR-1   TO LTC-SELLPR(1)
              MOVE WK-MISC-AMT-1 TO LTC-MISC-AMT(1)
              MOVE WK-SENT-FLAG-1 TO LTC-SENT-FLAG(1)
              MOVE 0              TO LTC-VIN-CHG-DATE(1)

              MOVE WK-DESC-2     TO LTC-DESC(2)
              MOVE WK-MAKE-2     TO LTC-MAKE(2)
              MOVE WK-MODEL-2    TO LTC-MODEL(2)
              MOVE WK-YEAR-2     TO LTC-YEAR(2)
              MOVE WK-STYLE-2    TO LTC-STYLE(2)
              MOVE WK-CLASS-2    TO LTC-CLASS(2)
              MOVE WK-VIN-2      TO LTC-VIN(2)
              MOVE WK-TITLE-NO-2 TO LTC-TITLE-NO(2)
              MOVE WK-MILEAGE-2  TO LTC-MILEAGE(2)
              MOVE WK-VALUE-2    TO LTC-VALUE(2)
              MOVE WK-SELLPR-2   TO LTC-SELLPR(2)
              MOVE WK-MISC-AMT-2 TO LTC-MISC-AMT(2)
              MOVE WK-SENT-FLAG-2 TO LTC-SENT-FLAG(2)
              MOVE 0              TO LTC-VIN-CHG-DATE(2)

              MOVE WK-HHGS-1 TO LTC-HHGS(1)
              MOVE WK-HHGS-2 TO LTC-HHGS(2)
              MOVE WK-HHGS-3 TO LTC-HHGS(3)
              PERFORM WRITE-LTC1-FILE.

           PERFORM CLOSE-LTC1-FILE.
       EXIT-UPDATE-LTC.
           EXIT.

      *****************************************
       UPDATE-LT-A-AUTO-INS SECTION.
      *****************************************

           PERFORM OPEN-LTA1-FILE.

           MOVE LN-OWNBR  TO LTA-BRNO.
           MOVE LN-PRLNNO TO LTA-ACCTNO.
           MOVE 1         TO LTA-SEQNO.
           PERFORM READ-LTA1-FILE.
           IF IO-FG = 0
              MOVE LN-OWNBR  TO LTA-BRNO
              MOVE LN-ACCTNO TO LTA-ACCTNO
              MOVE 1         TO LTA-SEQNO
              PERFORM WRITE-LTA1-FILE.

           PERFORM CLOSE-LTA1-FILE.


      ******************************************************************
      *
      *    U P D A T E - L T 1 - A - F I L E
      *
      *=================================================================
      *    IN  :  LN-REC
      *           BRANCH
      *           SAVE-PRLNNO
      *
      *    OUT :  NOTHING
      *
      *    DESC:  CREATE 'LT' RECORDS FOR AUTO INSURANCE.
      *           - CODE : A
      *           - SEQNO: 1, 2 & 3
      *
      ******************************************************************
       UPDATE-LT1-A-FILE SECTION.
           PERFORM OPEN-PC1-FILE.
           PERFORM OPEN-LTA1-FILE.

           MOVE "A"                        TO PC-ID.
           MOVE BRANCH                     TO PC-BRANCH.
           MOVE LN-SSNO(1)                 TO PC-SOC-SEC.

           PERFORM READ-PC1-FILE.
           IF ( IO-BAD )
              GO TO UPDATE-LT1-A-FILE-END.

           MOVE PC-LTA-AUTO-RECORD         TO WK-LTA-RECORD.

           PERFORM CLEAR-LTA-FILE.

           MOVE LN-OWNBR                   TO LTA-BRNO.
           MOVE LN-ACCTNO                  TO LTA-ACCTNO.
           MOVE 1                          TO LTA-SEQNO.

           MOVE WK-LTA-DLR-REQ            TO LTA-DLR-REQ.
           MOVE WK-LTA-INS-TYPE           TO LTA-INS-TYPE.
           MOVE WK-LTA-INS-CO             TO LTA-INS-CO.
           MOVE WK-LTA-POLICY-NO          TO LTA-POLICY-NO.
           MOVE WK-LTA-AGENCY             TO LTA-AGENCY.
           MOVE WK-LTA-AGENT              TO LTA-AGENT.

           MOVE WK-LTA-ADR1               TO LTA-ADR1.
           MOVE WK-LTA-ADR2               TO LTA-ADR2.
           MOVE WK-LTA-CITY               TO LTA-CITY.
           MOVE WK-LTA-STATE              TO LTA-STATE.
           MOVE WK-LTA-ZIP                TO LTA-ZIP.
           MOVE WK-LTA-PHONE              TO LTA-PHONE.
           MOVE WK-LTA-EFF-DATE           TO LTA-EFF-DATE.
           MOVE WK-LTA-EXP-DATE           TO LTA-EXP-DATE.
           MOVE WK-LTA-CAN-DATE           TO LTA-CAN-DATE.
           MOVE WK-LTA-CONF-DATE          TO LTA-CONF-DATE.
           MOVE WK-LTA-LAST-FORM          TO LTA-LAST-FORM.

           MOVE WK-LTA-COV-TYPE           TO LTA-COV-TYPE.
           MOVE WK-LTA-BIL-COV            TO LTA-BIL-COV.
           MOVE WK-LTA-PDL-COV            TO LTA-PDL-COV.
           MOVE WK-LTA-PIP-COV            TO LTA-PIP-COV.
           MOVE WK-LTA-UMB-COV            TO LTA-UMB-COV.
           MOVE WK-LTA-COL-COV            TO LTA-COL-COV.
           MOVE WK-LTA-LOSS-PAYEE         TO LTA-LOSS-PAYEE.
           MOVE WK-LTA-COM-COV            TO LTA-COM-COV.

           PERFORM WRITE-LTA1-FILE.

           PERFORM DELETE-PC1-FILE.

       UPDATE-LT1-A-FILE-END.
           PERFORM CLOSE-LTA1-FILE.
           PERFORM CLOSE-PC1-FILE.

       UPDATE-LT1-A-FILE-EXIT.
           EXIT.

      *****************************************
       UPDATE-LS-MISC-FILE SECTION.
      *****************************************
           PERFORM OPEN-LSM1-FILE.
           MOVE LN-OWNBR     TO LSM-BRNO.
           MOVE LN-ACCTNO    TO LSM-ACCTNO.
           MOVE 1            TO LSM-SEQNO.
           PERFORM READ-LSM1-FILE.
           IF IO-FG = 0
              MOVE WS-SECOND-BEN-NAME     TO LSM-SECOND-BEN-NAME
              MOVE WS-SECOND-BEN-ADR      TO LSM-SECOND-BEN-ADR
              MOVE WS-SECOND-BEN-CITY     TO LSM-SECOND-BEN-CITY
              MOVE WS-SECOND-BEN-STATE    TO LSM-SECOND-BEN-STATE
              MOVE WS-SECOND-BEN-ZIP      TO LSM-SECOND-BEN-ZIP
              MOVE WS-SECOND-BEN-PHONE    TO LSM-SECOND-BEN-PHONE
              MOVE WS-SECOND-BEN-RELATION TO LSM-SECOND-BEN-RELATION
              PERFORM REWRITE-LSM1-FILE
              GO TO EXIT-UPDATE-LS-MISC-FILE.

           PERFORM CLEAR-LSM-FILE.
           MOVE LN-OWNBR     TO LSM-BRNO.
           MOVE LN-ACCTNO    TO LSM-ACCTNO.
           MOVE 1            TO LSM-SEQNO.

           MOVE WS-SECOND-BEN-NAME     TO LSM-SECOND-BEN-NAME.
           MOVE WS-SECOND-BEN-ADR      TO LSM-SECOND-BEN-ADR.
           MOVE WS-SECOND-BEN-CITY     TO LSM-SECOND-BEN-CITY.
           MOVE WS-SECOND-BEN-STATE    TO LSM-SECOND-BEN-STATE.
           MOVE WS-SECOND-BEN-ZIP      TO LSM-SECOND-BEN-ZIP.
           MOVE WS-SECOND-BEN-PHONE    TO LSM-SECOND-BEN-PHONE.
           MOVE WS-SECOND-BEN-RELATION TO LSM-SECOND-BEN-RELATION.

           PERFORM WRITE-LSM1-FILE.
           IF IO-BAD
              GO TO IO-ERROR.

       EXIT-UPDATE-LS-MISC-FILE.
           PERFORM CLOSE-LSM1-FILE.

      *****************************************
      *    UPDATE LT1 BANKRUPT RECORDS
      *****************************************
       UPDATE-LT1-BNKRPT SECTION.
           PERFORM OPEN-LTB1-FILE.

           MOVE LN-OWNBR  TO LTB-BRNO.
           MOVE LN-PRLNNO TO LTB-ACCTNO.
           MOVE 1         TO LTB-SEQNO.
           PERFORM READ-LTB1-FILE.
           IF IO-FG = 0
              MOVE LN-OWNBR  TO LTB-BRNO
              MOVE LN-ACCTNO TO LTB-ACCTNO
              MOVE 1         TO LTB-SEQNO
              PERFORM WRITE-LTB1-FILE.

           PERFORM CLOSE-LTB1-FILE.

      *****************************************
      *    UPDATE LM1 BANKRUPT RECORDS
      *****************************************
       UPDATE-LM1-BNKRPT SECTION.
           PERFORM OPEN-LM1-FILE.

           MOVE LM-PATH-OWNBR TO LM-BRNO
                                 QLM1-WBEG-BRNO
                                 QLM1-WEND-BRNO.
           MOVE LN-PRLNNO     TO LM-ACCTNO
                                 QLM1-WBEG-ACCTNO
                                 QLM1-WEND-ACCTNO.
           MOVE 0             TO LM-DATE
                                 QLM1-WBEG-DATE-REV.
           MOVE 0             TO LM-SEQ
                                 QLM1-WBEG-SEQ.
           MOVE ALL "9"       TO QLM1-WEND-DATE-REV
                                 QLM1-WEND-SEQ.

           COMPUTE QLM1-WSBEG-DATE-REV = LM-DATE-REVERSED + 1.

           MOVE LM1-KEY       TO HOLD-LM1-KEY.

           PERFORM START-LM1-FILE.

       UPDATE-LM1-BNKRPT-NEXT.
           PERFORM READ-LM1-FILE-NEXT.
           IF (IO-FG = 9) OR (LM-BRNO NOT = LM-PATH-OWNBR) 
                           OR (LM-ACCTNO NOT = LN-PRLNNO)
              GO TO UPDATE-LM1-BNKRPT-EXIT.

           IF (LM1-KEY = HOLD-LM1-KEY) OR (LM-MEMO-TYPE NOT = "B")
              GO TO UPDATE-LM1-BNKRPT-NEXT.

           MOVE LM1-KEY TO HOLD-LM1-KEY.

      * TAKE AN EXISTING MEMO RECORD AND REWRITE IT WITH A NEW ACCOUNT NO.
      * BRANCH WILL NOT CHANGE
           MOVE LN-ACCTNO TO LM-ACCTNO.
           PERFORM WRITE-LM1-FILE.

           GO TO UPDATE-LM1-BNKRPT-NEXT.

       UPDATE-LM1-BNKRPT-EXIT.
           PERFORM CLOSE-LM1-FILE.

      *****************************************
       UPDATE-BW-UMC-EXPIRE SECTION.
      *****************************************
           MOVE 0 TO UMC-TERM.

           IF LN-FEECODE(FEE-SUB) = BR-ROAD-G-SGL-FEECODE
              COMPUTE UMC-TERM = LN-FEEAMT(FEE-SUB) / 8
           ELSE
              IF LN-FEECODE(FEE-SUB) = BR-ROAD-G-FAM-FEECODE
                 COMPUTE UMC-TERM = LN-FEEAMT(FEE-SUB) / 10.

           IF UMC-TERM = 0
              GO TO EXIT-UPDATE-BW-UMC.

      * IF REMAINDER, BUMP UP 1 MONTH
           IF NOT ( UMC-DEC1 = 0 AND UMC-DEC2 = 0 )
              ADD 1 TO UMC-TERM.

      * WE ARE KEEPING BW-UMC-PR-EXPIRE-DATE FOR VOIDS OF ACCOUNTS THAT
      * WERE BOOKED IN A PB CHAIN AFTER ONE OF THEM EXPIRED. IT THEN USES
      * THE LOANDATE FOR A NEW TERM AND YOU LOSE THE LAST EXPIRED DATE
           MOVE BW-UMC-EXPIRE-DATE TO BW-UMC-PR-EXPIRE-DATE.

           IF BW-UMC-EXPIRE-DATE = 0
              MOVE LN-LOANDATE TO NDTE-DATE
           ELSE
              MOVE BW-UMC-EXPIRE-DATE TO NDTE-DATE
              IF LN-LOANDATE > BW-UMC-EXPIRE-DATE
                 MOVE LN-LOANDATE TO NDTE-DATE.

           MOVE UMC-TERM           TO NDTE-HOLD.
           PERFORM INCREMENT-MONTHS.
           MOVE NDTE-DATE TO BW-UMC-EXPIRE-DATE.
           
       EXIT-UPDATE-BW-UMC.
           EXIT.

      ************************
       UPDATE-TR1-FILE SECTION.
      ************************
           MOVE "UPDATING LOAN TRANSACTION FILE.........." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-TRL1-FILE.
           MOVE 1 TO SAVE-TL-LINE.
       UPDATE-NEXT-TR1.
           PERFORM CLEAR-TRL-FILE.

           MOVE TRANS-DATE   TO TL-DATE.
           MOVE BRANCH       TO TL-BRNO.
           MOVE LN-CLASS     TO TL-CLASS.
           MOVE LN-ACCTNO    TO TL-ACCTNO.
           MOVE LN-LAWCODE   TO TL-LAWCODE.
           MOVE SAVE-TL-LINE TO TL-LINE.

           MOVE LN-LOANTYPE TO TL-LOANTYPE.
           MOVE LN-LOANDATE TO TL-LOANDATE.
           MOVE LN-INTDATE  TO TL-INTDATE.
           MOVE LN-PURCD    TO TL-PURCD.
           MOVE LN-SRCD     TO TL-SRCD.
           MOVE LN-COLLCD   TO TL-COLLCD.
           MOVE LN-ORGTERM  TO TL-ORGTERM.
           MOVE LN-PROCEEDS TO TL-PROCEEDS.
           MOVE LN-LNAMT    TO TL-LNAMT.
           MOVE LN-FINCHG   TO TL-FINCHG.
           MOVE LN-NOREGPY  TO TL-NOREGPY.
           MOVE LN-REGPYAMT TO TL-REGPYAMT.
           MOVE LN-1STPYAMT TO TL-1STPYAMT.
           MOVE LN-LASTPYAMT TO TL-LASTPYAMT.
           MOVE LN-APRATE   TO TL-APR.
           MOVE LN-INSURED  TO TL-INSURED.

      * CARRY OVER UNEARN DEALER DISCOUNT:
           IF SP-LNCOST-FRMLA = "R"
               MOVE PRIOR-DLDISC-UNEARN TO TL-PRDLDISC-UNEARN.

           MOVE LN-DLNO       TO TL-DLNO.
           MOVE LN-PRLNNO     TO TL-PRLNNO.
           MOVE LN-PRBAL      TO TL-PRBAL.
           MOVE LN-PRINTDUE   TO TL-PRINTDUE.
           MOVE LN-PRFINCHGRB TO TL-PRFINCHGRB.
           MOVE LN-PRINSRB    TO TL-PRINSRB.
           MOVE LN-SERVACCT   TO TL-SERVACCT.
           MOVE LN-GIFTNET    TO TL-GIFTNET.

      * THESE 3 FIELDS ARE SET IN LONPD0 FOR MISSISSIPPI 90 DAY RBEARLY 3
      *    MOVE 0 TO TL-PROCASH TL-TILLNO TL-STATE-WORKER
      *              TL-RESTRICTD-ACCTNO.

      * NEED STATE-WORKER FOR 'GA', D0 WILL OVERWRITE IT FOR 'MS'
           MOVE LN-STATE-WORKER TO TL-STATE-WORKER.

      * CLOSING FEE FOR NEW SERCHG "GA"
           IF LN-ORGST = "GA"
              MOVE LN-POINTS TO TL-POINTS.

           MOVE LN-ANTICERN(1) TO TL-ANTICERN(1).
           MOVE LN-ANTICERN(2) TO TL-ANTICERN(2).
           MOVE LN-ANTICERN(3) TO TL-ANTICERN(3).
           MOVE LN-ANTICERN(4) TO TL-ANTICERN(4).
           MOVE LN-ANTICERN(5) TO TL-ANTICERN(5).
           MOVE LN-ANTICERN(6) TO TL-ANTICERN(6).
           MOVE LN-ACCERN(1) TO TL-EARNINGS(1).
           MOVE LN-ACCERN(2) TO TL-EARNINGS(2).
           MOVE LN-ACCERN(3) TO TL-EARNINGS(3).
           MOVE LN-ACCERN(4) TO TL-EARNINGS(4).
           MOVE LN-ACCERN(5) TO TL-EARNINGS(5).
           MOVE LN-ACCERN(6) TO TL-EARNINGS(6).

           MOVE LN-MAINTFEE    TO TL-MAINTFEE.
           MOVE LN-SERCHG      TO TL-SERCHG.
           MOVE LN-EXTCHG      TO TL-EXTCHG.
           MOVE LN-INSTYPES    TO TL-INSTYPES.
           MOVE LN-INSELIGIBLE TO TL-INSELIGIBLE.
           MOVE LN-INTCHG      TO TL-INTCHG.

           MOVE SP-LNCOST-FRMLA TO TL-SP-LNCOST-FRMLA.

           MOVE 1 TO SUB.
       NEXT-TL-BORRTBL.
           IF SUB NOT > 4
              MOVE LN-SSNO(SUB) TO TL-SSNO(SUB)
              MOVE LN-MAKERCD(SUB) TO TL-MAKERCD(SUB).
           IF SUB NOT > 8
              MOVE LN-INSCOMP(SUB) TO TL-INSCOMP(SUB)
              MOVE LN-INSOURS(SUB) TO TL-INSOURS(SUB)
              MOVE LN-INSEFF-DATE(SUB) TO TL-INSEFF-DATE(SUB)
              MOVE LN-INSEXP-DATE(SUB) TO TL-INSEXP-DATE(SUB)
              MOVE LN-INSPREM(SUB) TO TL-INSPREM(SUB)
              MOVE LN-INSCOMM(SUB) TO TL-INSCOMM(SUB).
           IF SUB NOT > 10
              MOVE LN-FEECODE(SUB) TO TL-FEECODE(SUB)
              MOVE LN-FEEAMT(SUB)  TO TL-FEEAMT(SUB).
           IF SUB < 10
              ADD 1 TO SUB
              GO TO NEXT-TL-BORRTBL.

           PERFORM SET-POSTDATE.
           IF LPLOAN-CALLED-FROM = "LNCRE2"
              MOVE "BATCH" TO TL-USERID
           ELSE
              MOVE POST-USERID TO TL-USERID.
           MOVE POST-TIME   TO TL-POSTTIME.
           MOVE POST-DATE   TO TL-POSTDATE.

           MOVE LN-MIP-FG TO TL-MIP-FG.
      *UPDATE THE INSURANCE TAX CODE FIELDS [WORLD PR#288]
           IF BR-FORCE-VALID-CITY-COUNTY = "Y"
              PERFORM GET-LXX-TAX
              MOVE LXX-INS-TAX-COUNTY-CD TO TL-INS-TAX-COUNTY-CD
              MOVE LXX-INS-TAX-CITY-CD TO TL-INS-TAX-CITY-CD.

           MOVE LN-ACTIONCD2 TO TL-ACTIONCD2.

           PERFORM WRITE-TRL1-FILE.
           IF IO-FG = 0
              GO TO SAVE-TL-KEY.

           IF SAVE-TL-LINE < 999
              ADD 1 TO SAVE-TL-LINE
              GO TO UPDATE-NEXT-TR1.

           MOVE "TRANSACTION SEQ = 999, REC NOT CREATED !" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.

       SAVE-TL-KEY.
           MOVE 4          TO WK-KEY.
           MOVE TL-BRNO    TO WK-TR-BRNO.
           MOVE TL-DATE    TO WK-TR-DATE.
           MOVE TL-CLASS   TO WK-TR-CLASS.
           MOVE TL-ACCTNO  TO WK-TR-ACCTNO.
           MOVE TL-LAWCODE TO WK-TR-LAWCODE.
           MOVE TL-LINE    TO WK-TR-LINE.
           PERFORM WRITE-WK-FILE.
           IF IO-FG = 9
             PERFORM REWRITE-WK-FILE.

           PERFORM CLOSE-TRL1-FILE.


      ************************
       UPDATE-LP1-FILE SECTION.
      ************************
           MOVE "UPDATING LOAN PAYMENT FILE.............." TO MESS.
           PERFORM SEND-LEGEND.

      * GET ACCUMULATED EARNINGS FOR PAYMENT RECORDS:
           MOVE 1 TO SUB.
           PERFORM UPDATE-ACCERN UNTIL SUB > 6.

           PERFORM OPEN-LP1-FILE.
           MOVE LP-PATH-OWNBR TO SAVE-LP-BRNO.
           MOVE LOAN-KEY      TO SAVE-LP-ACCTNO.
           MOVE 1             TO SAVE-LP-SEQNO.
       CREATE-LP-REC.
           PERFORM CLEAR-LP-FILE.

           MOVE SAVE-LP1-KEY TO LP1-KEY.

      * "NOT#1" INDICATES AN ERRONEOUS SITUATION WHERE
      * SEQNO 1 WAS POSTED PRIOR TO THIS LOAN'S CREATION
           IF LP-SEQNO NOT = 1
              MOVE "NOT#1" TO LP-REFNO.

           MOVE TRANS-DATE TO LP-TRDATE.
           MOVE LN-INTDATE TO LP-PAYDATE.
      * LN-POCD = "*I"
           IF LN-POCD-INRESCISSION
              MOVE "RESCI"   TO LP-REFNO.
           MOVE LN-SRCD      TO LP-TRCD.
           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.
           PERFORM PAID-THRU-CALCULATION.
           MOVE PDTH-DATE-FULL TO LP-PDTH-DATE.
           MOVE LN-LCPDTH-DATE TO LP-LCPDTH-DATE.
           MOVE EARNING-WK(1) TO LP-EARNED(1).
           MOVE EARNING-WK(2) TO LP-EARNED(2).
           MOVE EARNING-WK(3) TO LP-EARNED(3).
           MOVE LN-LNAMT TO LP-CURBAL.

           MOVE LN-EXTRA-PRIN-LFP         TO LP-EXTRA-PRIN-LFP.
           MOVE LN-REMAIN-INT-SINCE-LFP   TO LP-REMAIN-INT-SINCE-LFP.
           MOVE LN-REMAIN-PRIN-SINCE-LFP  TO LP-REMAIN-PRIN-SINCE-LFP.

           PERFORM SET-POSTDATE.
           IF LPLOAN-CALLED-FROM = "LNCRE2"
              MOVE "BATCH" TO LP-USERID
           ELSE
              MOVE POST-USERID TO LP-USERID.
           MOVE POST-TIME TO LP-POSTTIME.
           MOVE POST-DATE TO LP-POSTDATE.

           PERFORM WRITE-LP1-FILE.
           IF IO-FG = 0
              GO TO EXIT-UPDATE-LP1.

           IF SAVE-LP-SEQNO < 99999
              ADD 1 TO SAVE-LP-SEQNO
              GO TO CREATE-LP-REC.

           MOVE "LOAN PMT = 99999, PMT REC NOT CREATED !" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       EXIT-UPDATE-LP1.
           PERFORM CLOSE-LP1-FILE.

      ***********************
       UPDATE-LXE-FILE SECTION.
      ***********************
           IF EARNING-WK(4) = 0
              IF EARNING-WK(5) = 0
                 IF EARNING-WK(6) = 0
                    GO TO EXIT-UPDATE-LXE.

           MOVE "UPDATING LX TRAILER RECORD.............." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-LXE1-FILE.

           PERFORM CLEAR-LXE-FILE.

           MOVE LP-BRNO       TO LXE-BRNO.
           MOVE LP-ACCTNO     TO LXE-ACCTNO.
           MOVE LP-SEQNO      TO LXE-SEQNO.

           MOVE EARNING-WK(4) TO LXE-EARN(1).
           MOVE EARNING-WK(5) TO LXE-EARN(2).
           MOVE EARNING-WK(6) TO LXE-EARN(3).
           MOVE EARNING-WK(7) TO LXE-EARN(4).
           MOVE EARNING-WK(8) TO LXE-EARN(5).
           MOVE EARNING-WK(9) TO LXE-EARN(6).
           MOVE EARNING-WK(10) TO LXE-EARN(7).

           PERFORM WRITE-LXE1-FILE.
           PERFORM CLOSE-LXE1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

       EXIT-UPDATE-LXE.
           EXIT.

      *****************************
       UPDATE-LXM-FILE SECTION.
      *****************************
           MOVE "UPDATING LXM TRAILER RECORD.............." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-LX1-FILE.
           MOVE LP-BRNO   TO LX-BRNO.
           MOVE LP-ACCTNO TO LX-ACCTNO.
           MOVE LP-SEQNO  TO LX-SEQNO.
           PERFORM READ-LX1-FILE.
           IF IO-FG = 0
              PERFORM MOVE-LXM-FIELDS
              PERFORM REWRITE-LX1-FILE
              PERFORM CLOSE-LX1-FILE
           ELSE
              PERFORM CLEAR-LX-FILE
              MOVE LP-BRNO   TO LX-BRNO
              MOVE LP-ACCTNO TO LX-ACCTNO
              MOVE LP-SEQNO  TO LX-SEQNO
              PERFORM MOVE-LXM-FIELDS
              PERFORM WRITE-LX1-FILE
              PERFORM CLOSE-LX1-FILE.

           IF IO-FG NOT = 0
              GO TO IO-ERROR.

       EXIT-UPDATE-LXM.
           EXIT.

      ***************************************************
       UPDATE-LXX-FILE SECTION.
      ***************************************************
           MOVE "UPDATING LXX TRAILER RECORD ............" TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-LX1-FILE.
           MOVE LP-BRNO   TO LX-BRNO.
           MOVE LP-ACCTNO TO LX-ACCTNO.
           MOVE LP-SEQNO  TO LX-SEQNO.
           PERFORM READ-LX1-FILE.
           IF IO-FG = 0
              PERFORM MOVE-LXX-FIELDS
              PERFORM REWRITE-LX1-FILE
              PERFORM CLOSE-LX1-FILE
           ELSE
              PERFORM CLEAR-LX-FILE
              MOVE LP-BRNO   TO LX-BRNO
              MOVE LP-ACCTNO TO LX-ACCTNO
              MOVE LP-SEQNO  TO LX-SEQNO
              PERFORM MOVE-LXX-FIELDS
              PERFORM WRITE-LX1-FILE
              PERFORM CLOSE-LX1-FILE.

           IF IO-FG NOT = 0
              GO TO IO-ERROR.

       EXIT-UPDATE-LXX.
           EXIT.


      ************************
       UPDATE-BW1-FILE SECTION.
      ************************
           MOVE "UPDATING BORROWER FILE.................." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM GET-COLLATERAL.
           MOVE 1 TO SUB.
           PERFORM OPEN-BW1-FILE.
       UPDATE-NEXT-BW.
           MOVE LN-SSNO(SUB) TO BW-SSNO.
           PERFORM READ-BW1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           IF SUB = 1
              MOVE BW-ZIP TO HOLD-BW-ZIP.
           ADD 1 TO BW-LOANS.
           IF SUB = 1
              IF CD-CO-SECURED = "R"
                 ADD LN-YTDINTPD TO BW-RE-INTYTD
              ELSE
                 ADD LN-YTDINTPD TO BW-INTYTD.
           IF LN-SMALLOAN = "Y"
              ADD LN-LNAMT TO BW-LIASMLN
            ELSE
              ADD LN-LNAMT TO BW-LIAOTH.
      * COMMENTED OUT 10/4/00 BAH, WORLD NOW USING REPCODE FOR TAX PRE
      * REGISTRATION, WILL BE EITHER "YES" OR "NO"
      *    IF LN-GIFTNET = "Y"
      *       MOVE " " TO BW-REPCODE.

      * SET LAST RENEWAL DATE FOR RENEWALS LESS THAN 10%:
           IF NOT ( GP-RN-FOR10-LN = "Y" )
              PERFORM COMPUTE-RNFOR10
              IF RNFOR10-FG = "Y"
                 MOVE BW-LAST-RN-FOR10-DATE TO BW-PRIOR-RN-FOR10-DATE
                 MOVE LN-LOANDATE TO BW-LAST-RN-FOR10-DATE.

      * UPDATE UMC EXPIRATION DATE, IF WRITTEN (MAKER ONLY)
            IF SUB = 1
               PERFORM VARYING FEE-SUB FROM 1 BY 1 UNTIL FEE-SUB > 10
               IF (LN-FEECODE(FEE-SUB) = BR-ROAD-G-SGL-FEECODE AND
                  BR-ROAD-G-SGL-FEECODE NOT = SPACES) OR
                     (LN-FEECODE(FEE-SUB) = BR-ROAD-G-FAM-FEECODE AND
                       BR-ROAD-G-FAM-FEECODE NOT = SPACES)
                  PERFORM UPDATE-BW-UMC-EXPIRE.

           PERFORM REWRITE-BW1-FILE.
      *    IF SUB = 4
           IF SUB = 2
              GO TO EXIT-UPDATE-BW1.

           ADD 1 TO SUB.
           IF LN-SSNO(SUB) NOT = 0
              GO TO UPDATE-NEXT-BW.

       EXIT-UPDATE-BW1.
           PERFORM CLOSE-BW1-FILE.

      ******************************************************************
      * WRITE MEMO TO DOCUMENT USER ID OF WHO APPROVED LOAN
      ******************************************************************
       UPDATE-LM-APPROVAL SECTION.
       BEGIN-UPDATE-LM-APPROVAL.

           IF WS-MEMO-APPROVAL-USERID = SPACES
              GO TO EXIT-UPDATE-LM-APPROVAL.

           MOVE "UPDATING APPROVAL TO LOAN MEMO FILE...." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-LM1-FILE.
           MOVE WS-MEMO-APPROVAL TO LM-MEMO.
           PERFORM WRITE-MEMO-LINE.
           PERFORM CLOSE-LM1-FILE.

      *=================================================================
       EXIT-UPDATE-LM-APPROVAL.
           EXIT.

      ************************
       UPDATE-DS1-FILE SECTION.
      ************************
           MOVE "UPDATING DEALER STATISTICS FILE........." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-DS1-FILE.
           MOVE "N" TO REC-EXISTS.
       UPDATE-DS1-FILE-CHECK.
           PERFORM SET-DS1-KEY.
           PERFORM READ-DS1-FILE.
           IF IO-FG = 0
              MOVE "Y" TO REC-EXISTS
              GO TO UPDATE-DS1-FILE-UPD-REC.
           PERFORM CLEAR-DS-FILE.
           PERFORM SET-DS1-KEY.

      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
       UPDATE-DS1-FILE-UPD-REC.


           IF LN-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
              ADD 1 TO DS-RNEWUNIT(1) DS-RNEWUNIT(2)
              ADD LN-LNAMT TO DS-RNEWAMT(1) DS-RNEWAMT(2)
           ELSE
           IF LN-SRCD = "NB"
              ADD 1 TO DS-NPURUNIT(1) DS-NPURUNIT(2)
              ADD LN-LNAMT TO DS-NPURAMT(1) DS-NPURAMT(2)
           ELSE
              ADD 1 TO DS-OPURUNIT(1) DS-OPURUNIT(2)
              ADD LN-LNAMT TO DS-OPURAMT(1) DS-OPURAMT(2). 

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    UPDATE UNEARNED STATISTICS NET AND VOLUME
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF GP-UNEARNED-STATS = "Y"
              PERFORM VARYING DSSUB3 FROM 1 BY 1 UNTIL DSSUB3 > 6
                        AFTER DSSUB2 FROM 1 BY 1 UNTIL DSSUB2 > 2
                  IF DSSUB2 = 1
                     ADD EARN-UNEARN(DSSUB3) TO
                                 DS-UNEARNED-AMT(1 DSSUB2 DSSUB3)
                  ELSE
                     IF (DSSUB3 < 6) OR
                        (DSSUB3 = 6 AND NOT GP-INCL-OTH-IN-EARNED-N)
                        ADD LN-ANTICERN(DSSUB3)
                                 TO DS-UNEARNED-AMT(1 DSSUB2 DSSUB3)
                                    DS-UNEARNED-AMT(2 DSSUB2 DSSUB3)
                     END-IF
                  END-IF
              END-PERFORM
      *       ----------------------------------------------------------
      *       UPDATE PROCEEDS: WE DO NOT CARE ABOUT ACCOUNT STATUS.
      *       ----------------------------------------------------------
              ADD LN-PROCEEDS TO DS-PROCEEDS(1)
                                 DS-PROCEEDS(2).
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

           ADD LN-ORGTERM TO DS-SUMWGTTM.
           ADD LN-LNAMT TO DS-SUMWGTAV.
           COMPUTE DS-SUMWGTTA =
              DS-SUMWGTTA + (LN-ORGTERM * LN-LNAMT).

           IF LN-SERVACCT NOT = "Y"
              ADD LN-DLDISC TO DS-DLDISC
                               DS-DLDISC-VOL(1)
                               DS-DLDISC-VOL(2)
              ADD LN-DLRVPRIN(1) TO DS-DLRVPRIN(1)
              ADD LN-DLRVPRIN(2) TO DS-DLRVPRIN(2)
              ADD LN-DLPARVHELD TO DS-DLPARVHELD.

           ADD 1 TO DS-OUTSUNIT(1).
           ADD LN-LNAMT TO DS-OUTSAMT(1).


      * UPDATE DELINQUENCY NORMAL:
      *    -------------------------------------------------------------
      *    SETUP OUTBAL WORKER FOR UPDATE OF STATS
      *    -------------------------------------------------------------
           IF GP-DELINQ-WITH-O2 = "Y"
              MOVE LN-CURBAL TO SAVE-OUTBAL
           ELSE
              SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL.


           ADD 1 TO DS-UNITS(DSNOW DSREC RDSUB)
                    DS-UNITS(DSNOW DSCON CSUB).
           ADD SAVE-OUTBAL TO DS-OUTBAL(DSNOW DSREC RDSUB)
                              DS-OUTBAL(DSNOW DSCON CSUB).
      * UPDATE DELINQUENCY BANKRUPT:
      *JGW IF LN-SRCD = "RB"
           IF PRIOR-BNKRPTDATE NOT = 0
              ADD 1 TO DS-UNITS-BNKRPT(DSNOW DSREC RDSUB)
                       DS-UNITS-BNKRPT(DSNOW DSCON CSUB)
              ADD SAVE-OUTBAL TO DS-OUTBAL-BNKRPT(DSNOW DSREC RDSUB)
                                 DS-OUTBAL-BNKRPT(DSNOW DSCON CSUB).
       UPDATE-DS1-FILE-EXIT.
           IF REC-EXISTS = "Y"
              PERFORM REWRITE-DS1-FILE
           ELSE
              PERFORM WRITE-DS1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.
           PERFORM CLOSE-DS1-FILE.

      ************************
       UPDATE-TY1-FILE SECTION.
      ************************
           MOVE "UPDATING TODAY'S TOTAL FILE............." TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM OPEN-TY1-FILE.
           MOVE "N" TO REC-EXISTS.
       UPDATE-TY1-FILE-CHECK.
           PERFORM SET-TY-KEY.
           PERFORM READ-TY1-FILE.
           IF IO-FG = 0
              GO TO UPDATE-TY1-FILE-UPD-REC.
           IF REC-EXISTS = "Y"
              GO TO IO-ERROR.

           MOVE "Y" TO REC-EXISTS.
           PERFORM CLEAR-TY-FILE.
           PERFORM SET-TY-KEY.
           PERFORM WRITE-TY1-FILE.
           IF IO-FG = 9 AND E-CODE NOT = "22"
              GO TO IO-ERROR.
           GO TO UPDATE-TY1-FILE-CHECK.

      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
       UPDATE-TY1-FILE-UPD-REC.

           PERFORM GET-SRCD-SUB.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    UPDATE UNEARNED STATISTICS NET AND VOLUME
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF GP-UNEARNED-STATS = "Y"
              PERFORM VARYING TYSUB3 FROM 1 BY 1 UNTIL TYSUB3 > 6
                        AFTER TYSUB2 FROM 1 BY 1 UNTIL TYSUB2 > 2
                  IF TYSUB2 = 1
                     ADD EARN-UNEARN(TYSUB3) TO
                                 TY-UNEARNED-AMT(TYSUB2 TYSUB3)
                  ELSE
                     IF (TYSUB3 < 6) OR
                        (TYSUB3 = 6 AND NOT GP-INCL-OTH-IN-EARNED-N)
                        ADD LN-ANTICERN(TYSUB3)
                                   TO TY-UNEARNED-AMT(TYSUB2 TYSUB3)
                     END-IF
                  END-IF
              END-PERFORM
      * UPDATE PROCEEDS: WE DO NOT CARE ABOUT ACCOUNT STATUS.
              ADD LN-PROCEEDS TO TY-PROCEEDS.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

           ADD LN-ORGTERM TO TY-SUMWGTTM.
           ADD LN-LNAMT TO TY-SUMWGTAV.
           COMPUTE TY-SUMWGTTA =
              TY-SUMWGTTA + (LN-ORGTERM * LN-LNAMT).

           IF SRCD-NOT-PL
              ADD 1 TO TY-NO(1 SRCD)
                       TY-NO(2 SRCD)
              ADD LN-LNAMT TO TY-AMT(1 SRCD)
                              TY-AMT(2 SRCD)
              ADD LN-OT2BAL TO TY-O2(1 SRCD)
                               TY-O2(2 SRCD)
              ADD LN-INTCHG TO TY-INT(1 SRCD)
                               TY-INT(2 SRCD).

      * UPDATE DELINQUENCY NORMAL:
      *    -------------------------------------------------------------
      *    SETUP OUTBAL WORKER FOR UPDATE OF STATS
      *    -------------------------------------------------------------
           IF GP-DELINQ-WITH-O2 = "Y"
              MOVE LN-CURBAL TO SAVE-OUTBAL
           ELSE
              SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL.

           ADD 1 TO TY-UNITS(1 RDSUB)
                    TY-UNITS(2 CSUB).
           ADD SAVE-OUTBAL TO TY-OUTBAL(1 RDSUB)
                              TY-OUTBAL(2 CSUB).
      * UPDATE DELINQUENCY BANKRUPT:
      *JGW IF LN-SRCD = "RB"
           IF PRIOR-BNKRPTDATE NOT = 0
              ADD 1 TO TY-UNITS-BNKRPT(TYREC RDSUB)
                       TY-UNITS-BNKRPT(TYCON CSUB)
              ADD SAVE-OUTBAL TO TY-OUTBAL-BNKRPT(TYREC RDSUB)
                                 TY-OUTBAL-BNKRPT(TYCON CSUB).

      ***************************************
      * UPDATE INSURANCES
      ***************************************
           PERFORM UPDATE-TY1-FILE-INS
              VARYING SUB FROM 1 BY 1
                            UNTIL SUB > 6.
      *  DO NOT INCLUDE 7&8 HERE THEY ARE NOT BEING USED YET
      *  AND WE DO NOT WANT TO COUND THEN AS NOT WRITTEN IN STATS
      *                                         (MJD 09/10/1999).
      *-------------------->UNTIL SUB > 8.

           IF LN-INSELIGIBLE-DL
                           OR LN-INSELIGIBLE-LL
              ADD 1 TO TY-INS-NO-ELIG(1).

           IF LN-INSELIGIBLE-AH
              ADD 1 TO TY-INS-NO-ELIG(2).

           IF LN-INSELIGIBLE-PP
                           OR LN-INSELIGIBLE-PP2
              ADD 1 TO TY-INS-NO-ELIG(3).

           IF LN-INSELIGIBLE-O1
              ADD 1 TO TY-INS-NO-ELIG(4).

      * TEST FOR ROADGARD INSURANCE AND AD&D (WORLD)
           MOVE "N" TO ROADGARD-WRITTEN ADD-WRITTEN NON-FILE-WRITTEN.
           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 10
              IF LN-FEECODE(SUB) NOT = SPACES
                 IF LN-FEECODE(SUB) = GP-NON-FILE-FEECODE
                    ADD 1 TO TY-FEE-NO-WROTE(1)
                    ADD LN-FEEAMT(SUB) TO TY-FEE-AMT-WROTE(1)
                    MOVE "Y" TO NON-FILE-WRITTEN
                 END-IF
                 IF LN-FEECODE(SUB) = BR-ADD-INS-FEECODE
                    ADD 1 TO TY-FEE-NO-WROTE(2)
                    ADD LN-FEEAMT(SUB) TO TY-FEE-AMT-WROTE(2)
                    MOVE "Y" TO ADD-WRITTEN
                 END-IF
                 IF LN-FEECODE(SUB) = BR-ROAD-G-SGL-FEECODE OR
                    LN-FEECODE(SUB) = BR-ROAD-G-FAM-FEECODE
                    ADD 1 TO TY-FEE-NO-WROTE(3)
                    ADD LN-FEEAMT(SUB) TO TY-FEE-AMT-WROTE(3)
                    MOVE "Y" TO ROADGARD-WRITTEN
                 END-IF
              END-IF
           END-PERFORM.

           IF NON-FILE-WRITTEN = "N"
              ADD 1 TO TY-FEE-NO-NOTWROTE(1).
           IF ADD-WRITTEN = "N"
              ADD 1 TO TY-FEE-NO-NOTWROTE(2).
           IF ROADGARD-WRITTEN = "N"
              ADD 1 TO TY-FEE-NO-NOTWROTE(3).

      * UPDATE DEALER RESERVES:

           IF LN-SERVACCT NOT = "Y"
              ADD LN-DLDISC TO TY-DLDISC
              ADD LN-DLRVPRIN(1) TO TY-DLRVPRIN(1 1)
                                    TY-DLRVPRIN(2 1)
              ADD LN-DLRVPRIN(2) TO TY-DLRVPRIN(1 2)
                                    TY-DLRVPRIN(2 2)
              ADD LN-DLPARVHELD TO TY-DLPARVHELD(1)
                                   TY-DLPARVHELD(2).

       UPDATE-TY1-FILE-EXIT.
           PERFORM REWRITE-TY1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.
           PERFORM CLOSE-TY1-FILE.

       UPDATE-TY1-FILE-INS SECTION.
           IF LN-INSPREM(SUB) NOT = 0
              ADD 1 TO TY-INS-NO-WROTE(SUB)
              ADD LN-INSPREM(SUB) TO TY-INS-AMT-WROTE(SUB)
           ELSE
              ADD 1 TO TY-INS-NO-NOTWROTE(SUB).

      ************************
       UPDATE-FM1-FILE SECTION.
      ************************
           MOVE "UPDATING FORM REQUESTS.................." TO MESS.
           PERFORM SEND-LEGEND.

           MOVE 0 TO FM-SUB NO-CREATE-FG.
           PERFORM OPEN-FD1-FILE.

       CREATE-FM.
           ADD 1 TO FM-SUB.
      * KEEP GOING TILL END OF TABLE
           IF FM-SUB > 20
              GO TO EXIT-UPDATE-FM1.

           IF SP-PRFORM(FM-SUB) = 0
              GO TO CREATE-FM.
           IF SP-PRFLAG(FM-SUB) NOT = "Y"
              GO TO CREATE-FM.
           IF FM-SUB = 2 OR 4
              GO TO CREATE-FM.

           MOVE SP-PRFORM(FM-SUB) TO FD-FMNO.
           PERFORM READ-FD1-FILE.
           IF IO-FG NOT = 0
              GO TO CREATE-FM.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    CORPORATE FORM PRINTING, EACH FORM COULD BE DIFFERENT
      *    NEED TO RESET FM-PATH-OVERIDE BECAUSE HOLD-SMARTPORT MAY
      *    CHANGE MULTIPLE TIMES.
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE SPACES                 TO FM-PATH-OVERRIDE.
           IF ( FD-OPTION-EXTRACTION )
              PERFORM GET-FM-PATH.

           PERFORM OPEN-FM1-FILE.

           PERFORM CLEAR-FM-FILE.
           MOVE SPACES TO LPWSFM-EDIT-FM-INITKEY.


           MOVE LOAN-KEY           TO LPWSFM-EDIT-FM-ACCTNO.
           MOVE FD-FMNO            TO LPWSFM-EDIT-FM-FORMNO.
           IF ( FD-OPTION-EXTRACTION )
              MOVE LN-OWNBR        TO LPWSFM-EDIT-FM-BRNO2.

           MOVE FM-PATH-OWNBR          TO FM-BRNO.
           MOVE LPWSFM-EDIT-FM-INITKEY TO FM-INITKEY.
           MOVE FD-FMNO                TO FM-FMNO.

           MOVE FM1-KEY       TO HOLD-FM1-KEY.
           PERFORM READ-FM1-FILE.

           MOVE HOLD-BW-ZIP        TO FM-ZIP.
           MOVE SPACES             TO FM-PRINT.
           MOVE 0                  TO FM-STMT-COUNTER.
           MOVE TRANS-DATE         TO FM-TRDATE.
           MOVE EXT-CONAME-USER-ID TO FM-USERID.
           IF IO-FG = 0
              PERFORM REWRITE-FM1-FILE
           ELSE
              MOVE HOLD-FM1-KEY TO FM1-KEY
              PERFORM WRITE-FM1-FILE
              IF IO-FG NOT = 0
                 GO TO IO-ERROR.

           PERFORM CLOSE-FM1-FILE.

           GO TO CREATE-FM.

       EXIT-UPDATE-FM1.
           PERFORM CLOSE-FD1-FILE.

      ********************************************************
      * IF FORM IS AN "E" EXTRACTION TYPE FORM (FD-OPTION), THEN
      * PUT THE CORPORATE BRNO PATH IN THE FM-PATH, SO ALL FORM REQUESTS
      * ARE CREATED IN THE HOME OFFICE, THEN WHEN THEY GO "PRINT" THEM ALL
      * IT WILL CREATE AN ASCII FILE
      ********************************************************
       GET-FM-PATH SECTION.
      ************************

           IF GP-CORP-BRNO = 0
              GO TO EXIT-GET-FM-PATH.

           MOVE GP-CORP-BRNO TO BR-NO.
           PERFORM READ-BR-FILE.
           IF IO-FG = 9
              GO TO END-GET-FM-PATH.

           MOVE EXT-FILPATH-BASE           TO FM-ALL-BASE.
           MOVE BR-MACHINE                 TO FM-ALL-MACHINE.
           MOVE BR-DATA-PATH               TO FM-ALL-DATA.
           MOVE FM-ALL-PATH                TO FM-PATH.
           MOVE "Y"                        TO FM-PATH-OVERRIDE.

       END-GET-FM-PATH.
      * GET ORIGINAL BRANCH BACK
           MOVE LN-OWNBR TO BR-NO.
           PERFORM READ-BR-FILE.

       EXIT-GET-FM-PATH.
           EXIT.

      *****************************************
       UPDATE-CI1-FILE SECTION.
      *****************************************
           MOVE 5 TO WK-KEY.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9 OR WK-SAVE-RECORD = SPACES
              GO TO EXIT-UPDATE-CI.

           PERFORM OPEN-CI1-FILE.
           MOVE WK-SAVE-RECORD TO CI-REC.
           MOVE BRANCH   TO CI-BRNO.
           MOVE LOAN-KEY TO CI-ACCTNO.
           PERFORM WRITE-CI1-FILE.
           PERFORM CLOSE-CI1-FILE.
           MOVE SPACES TO WK-SAVE-RECORD.
           PERFORM REWRITE-WK-FILE.

       UPDATE-LAST-BX-DATE.
           PERFORM OPEN-BX1-FILE.
           MOVE LN-SSNO(1) TO BX-SSNO.
           PERFORM READ-BX1-FILE.
           IF IO-BAD
              PERFORM CLEAR-BX-FILE
              MOVE LN-SSNO(1) TO BX-SSNO
              MOVE BX-PATH-OWNBR TO BX-BRNO
              PERFORM WRITE-BX1-FILE.

           MOVE TRANS-DATE TO BX-KYC-LAST-VERDATE.

           PERFORM REWRITE-BX1-FILE.
           PERFORM CLOSE-BX1-FILE.
       EXIT-UPDATE-CI.
           EXIT.

      ***********************************************
       UPDATE-NOTICE-FILE SECTION.
      ***********************************************
           PERFORM OPEN-NO1-FILE.

           MOVE LN-OWNBR  TO NO-BRNO.
           MOVE LN-ACCTNO TO NO-ACCTNO CRNOR2-ACCTNO.
           PERFORM READ-NO1-FILE.

           MOVE TRANS-DATE     TO CRNOR2-SYSDATE.
           MOVE "PO"           TO CRNOR2-LPTRCD.
           MOVE "CL/CRNOR2"    TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CRNOR2-LINK NO-REC
                                 POFF-WORKERS LN-REC.
           CANCEL FORM-PROGX.

           MOVE LN-OWNBR  TO NO-BRNO.
           MOVE LN-ACCTNO TO NO-ACCTNO.
           IF IO-FG = 0
              PERFORM REWRITE-NO1-FILE
           ELSE
              PERFORM WRITE-NO1-FILE.

           PERFORM CLOSE-NO1-FILE.

       EXIT-UPDATE-NOTICE-FILE.
           EXIT.

      * RESCISSION TRAILER
      ****************************************************
       CREATE-RX1-RECORD SECTION.
      ****************************************************
           MOVE LN-OWNBR   TO CREARX-RX-BRNO.
           MOVE LN-ACCTNO  TO CREARX-RX-ACCTNO.
           MOVE LN-DLNO    TO CREARX-RX-DLNO.
           MOVE LN-INTDATE TO CREARX-RX-INTDATE.
           PERFORM OPEN-BW1-FILE.
           MOVE LN-SSNO(1) TO BW-SSNO.
           PERFORM READ-BW1-FILE.
           PERFORM CLOSE-BW1-FILE.
           MOVE BW-LNAME   TO CREARX-RX-LNAME.
           MOVE BW-FNAME   TO CREARX-RX-FNAME.

           MOVE LN-LOANDATE TO CREARX-RX-LOANDATE.
           MOVE LN-LNAMT    TO CREARX-RX-LOANAMT.
           MOVE LN-PROCEEDS TO CREARX-RX-PROCEEDS.
           MOVE "I"         TO CREARX-RX-STATUS.
           MOVE "CL/CREARX" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CREARX-AREA.
           CANCEL FORM-PROGX.
           IF CREARX-ERRCD NOT = " "
              MOVE "ERROR UPDATING RESCISSION TRAILER (RX)" TO MESS
              PERFORM CONDITIONAL-SEND-MESS.

      ********************************************
       UPDATE-PRLOAN-RESCISSION SECTION.
      ********************************************
      * MUST FLAG THE PRIOR LOAN THATS IN RESCISSION, SO YOU CANT POST
      * ANYTHING TO IT OR VOID IT, BECAUSE THE NET PAYOFF IS PART OF THE
      * NEW LOAN IN RESCISSION .... BAH
           MOVE LN-PRLNNO TO LN-ACCTNO.
           PERFORM OPEN-LN1-FILE.
           PERFORM READ-LN1-FILE.
           IF IO-FG = 0
              MOVE "*P" TO LN-POCD
              PERFORM REWRITE-LN1-FILE.
           PERFORM CLOSE-LN1-FILE.

       TEST-FOR-GEORGIA-SCHG SECTION.
           IF NOT (SP-SCFRMLA = 12 OR 13 OR 54)
              GO TO END-TEST-FOR-GEORGIA-SCHG.
           MOVE "Y" TO SCHG-UPDATE-FG.
           MOVE LN-ACCTNO TO SCHG-NEW-ACCTNO.
           MOVE LN-SSNO(1) TO SCHG-LN-SSNO(1).
           MOVE LN-SSNO(2) TO SCHG-LN-SSNO(2).
           MOVE LN-SSNO(3) TO SCHG-LN-SSNO(3).
           MOVE LN-SSNO(4) TO SCHG-LN-SSNO(4).
           MOVE TRANS-DATE TO SCHG-TRANS-DATE.
           IF LN-SRCD = "PB" OR "RN" OR "RB" OR "RO"
              MOVE LN-PRLNNO TO SCHG-PRIOR-ACCTNO
              COMPUTE SCHG-PRIOR-NET-BALANCE =
                 LN-PRBAL + LN-PRINTDUE - LN-PRFINCHGRB
                               - LN-PRINSRB
              MOVE PD-LOANDATE TO SCHG-PRIOR-LOANDATE
           ELSE
              MOVE 0 TO SCHG-PRIOR-ACCTNO.
           IF PRLOAN-RESTRICTED = "Y"
              COMPUTE SCHG-PRIOR-RESTRICT = LN-PRBAL
                         + LN-PRINTDUE - LN-PRFINCHGRB
                               - LN-PRINSRB + PD-PRPAID-AHEAD
           ELSE
              MOVE 0 TO SCHG-PRIOR-RESTRICT.
           MOVE LN-ORGST TO SCHG-ORGST.
           MOVE LN-CLASS TO SCHG-LN-CLASS.
           MOVE SP-SCFRMLA TO GA-SCHG-NO.
           MOVE GA-SCHG-PATH TO FORM-NAM.
           IF GA-SCHG-NO = 13
              CALL FORM-PROGX USING FORM-PATH SCHG-WORKERS
                                             SCHG-WORKERS-2
           ELSE
              CALL FORM-PROGX USING FORM-PATH SCHG-WORKERS.
           CANCEL FORM-PROGX.

       END-TEST-FOR-GEORGIA-SCHG.
           EXIT.

      ******************************************
      *    GET NEXT LOAN ACCOUNT NUMBER
      ******************************************
       GET-ACCOUNT-NUMBER SECTION.

           PERFORM OPEN-GB-FILE.
           MOVE LN-OWNBR TO GB-BRNO.
           MOVE 1        TO GB-NO.
           PERFORM READ-GB-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           IF LN-SMALLOAN = "Y"
              IF GB-NEXT-SMALL = 0
                 ADD 1 TO GB-NEXT-SMALL
              END-IF
              MOVE GB-NEXT-SMALL TO LN-ACCTNO
              ADD 1 TO GB-NEXT-SMALL
           ELSE
              IF GB-NEXT-OTHER = 0
                 ADD 1 TO GB-NEXT-OTHER
              END-IF
              MOVE GB-NEXT-OTHER TO LN-ACCTNO
              ADD 1 TO GB-NEXT-OTHER.

           PERFORM REWRITE-GB-FILE.
           PERFORM CLOSE-GB-FILE.

       GET-ACCOUNT-NUMBER-EXIT.
           EXIT.

      ************************************************
       SET-DELINQUENCY SECTION.
      ************************************************
      * SET DELINQUENCY FOR 'TY' & 'DS'
           MOVE TRANS-DATE TO AGEING-DATE.
           PERFORM COMPUTE-CONTRACTUAL.
           PERFORM COMPUTE-RECENCY.

      ********************************************************
       WRITE-MEMO-LINE SECTION.
      ********************************************************
           MOVE LM-PATH-OWNBR TO LM-BRNO.
           MOVE LN-ACCTNO     TO LM-ACCTNO.
           SUBTRACT TRANS-DATE FROM 99999999 GIVING LM-DATE.
           ADD 1              TO HOLD-LM-SEQ.
       WRITE-MEMO-AGAIN.
           MOVE HOLD-LM-SEQ TO LM-SEQ.
           PERFORM WRITE-LM1-FILE.
           IF IO-FG NOT = 0
              IF LM-SEQ NOT = 999
                 ADD 1 TO HOLD-LM-SEQ
                 GO TO WRITE-MEMO-AGAIN
              ELSE
                 MOVE "MAXIMUM LINES FOR DAY ALREADY CREATED"
                                               TO MESS
                 PERFORM CONDITIONAL-SEND-MESS.

      ***************************************************
      *****************************************************************
      * MEXICO ADJUSTED APR.  (PR#811)
      * 1. COMPUTE THE NOMINAL PERIODIC RATE (NPR) BY FIRST COMPUTING
      *           THE APR AS USUAL (WITHOUT THE VAT INCLUDED)
      * 2. TAKE THE CALCULATED APR (INDECIMAL FORM I.E. APR /100)
      *           AND DIVIDE BY THE NUMBER OF PAYS PER YEAR.
      * 3. NEXT RECOMPUTE THE APR USING    (1 + NPR)^PPY - 1
      *               WHERE NPR = NOMINAL PERIODIC RATE
      *                     PPY = PAY PERIODS PER YEAR.
      * EVERYTHING ELSE ON THE LOAN IS CALCULATED AS IT ALWAYS HAS BEEN.
      *****************************************************************
       MX-ADJUSTED-APR SECTION.
            IF NOT SP-MFFRMLA-05
               GO TO MX-ADJUSTED-APR-EXIT.

           MOVE 12 TO WKS-NPR-PPY.

           COMPUTE WKS-NPR-R = (APR-APR / WKS-NPR-PPY) / 100.
           COMPUTE APR-APR = ((1 + WKS-NPR-R)**WKS-NPR-PPY - 1)*100.
           ADD 0 APR-APR GIVING WKS-ROUNDV999 ROUNDED.
           MOVE WKS-ROUNDV999 TO APR-APR.

        MX-ADJUSTED-APR-EXIT.
           EXIT.

      **************************************************************
      *          CONVERT A48 PAY SCHEDULE TO A60 == A50
      *   NAME: CNV48T60
      *
      *   DESC: THIS ROUTINE SHOULD BE PERFORMED IN THE FOLLOWING
      *         PROGRAMS, TO ADJUST PAYMENT SCHEDULES FROM A48
      *         FORMAT TO A60 FORMAT.
      *
      *   A60 PAY SCHEDULE:
      *                       TERM = 1     TERM = 2     TERM = 6
      *                     -----------  -----------  -----------
      *   LN-1STPYAMT    :  $100.00      $100.00      $100.00
      *   LN-REGPYAMT    :  $100.00 X 0  $120.00 X 0  $120.00 X 4
      *   LN-LASTPYAMT   :  $  0.00      $120.00      $130.00
      *                      ------       ------       ------
      *      TOTAL REPAY :  $100.00      $220.00      $710.00
      * REV:
      **************************************************************
       CNV48T60 SECTION.
           IF LN-ORGTERM = 1
              MOVE 0 TO LN-NOREGPY
              IF LN-1STPYAMT = 0
                 MOVE LN-REGPYAMT TO LN-1STPYAMT
              ELSE
                 NEXT SENTENCE
           ELSE
              IF LN-ORGTERM = 2
                 MOVE 0 TO LN-NOREGPY
                 IF LN-1STPYAMT = 0
                    MOVE LN-REGPYAMT TO LN-1STPYAMT
                                        LN-LASTPYAMT
                 ELSE
                    MOVE LN-REGPYAMT TO LN-LASTPYAMT
              ELSE
                 MOVE LN-REGPYAMT TO LN-LASTPYAMT
                 SUBTRACT 2 FROM LN-ORGTERM GIVING LN-NOREGPY
                 IF LN-1STPYAMT = 0
                    MOVE LN-REGPYAMT TO LN-1STPYAMT.

       COPY "LIBLP/LPLSMCL.CPY".
       COPY "LIBLP/LPLTCCL.CPY".
       COPY "LIBLP/LPLTFCL.CPY".
       COPY "LIBLP/LPLTACL.CPY".
       COPY "LIBLP/LPFMCL.CPY".
       COPY "LIBLP/LPIEXP.CPY".
       COPY "LIBLP/LPLPCL.CPY".
       COPY "LIBLP/LPLXECL.CPY".
       COPY "LIBLP/LPEADJ.CPY".
       COPY "LIBGB/SCREEN.CPY".
       COPY "LIBLP/LPITRM.CPY".
       COPY "LIBLP/LPRATE.CPY".
       COPY "LIBLP/LPIBPC.CPY".
       COPY "LIBLP/LPUERN.CPY".
       COPY "LIBLP/LPEARN.CPY".
       COPY "LIBLP/LPCERN.CPY".
       COPY "LIBGB/REBATE.CPY".
       COPY "LIBGB/SPPDTH.CPY".
       COPY "LIBLP/LPAMTS.CPY".
       COPY "LIBLP/LPXDTE.CPY".
       COPY "LIBGB/DATER.CPY".
       COPY "LIBLP/SETCTBL.CPY".
       COPY "LIBLP/LPMDTE.CPY".
       COPY "LIBGB/AGEING.CPY".
       COPY "LIBLP/LPUPWK.CPY".
       COPY "LIBLP/LPCEPP.CPY".
       COPY "LIBLP/LPAPRS.CPY".
       COPY "LIBLP/LPAPRZ.CPY".
       COPY "LIBLP/LPUPER.CPY".
       COPY "LIBLP/POSTDATE.CPY".
       COPY "LIBLP/LPSRCD.CPY".
       COPY "LIBGB/RBACT.CPY".
       COPY "LIBGB/GPENV.CPY".
       COPY "LIBLP/LPREGZ.CPY".
       COPY "LIBLP/LPPDUE.CPY".
       COPY "LIBLP/LNCOST.CPY".
       COPY "LIBLP/RNFOR10LN.CPY".
       COPY "LIBLP/SETINITLFP.CPY".
       COPY "LIBWI/W12EQ2PMT.CPY".
       COPY "LIBLP/LPBXCL.CPY".


      **********************************
       FORM-RESET SECTION.
      **********************************
           MOVE LPLOAN-SYSDATE TO XONPC-SYSDATE.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DISPLAY XONPC-SCREEN UPON TCLP-MAIN-WINDOW-HANDLE.
           MOVE XONPC-FORM-FIELDS TO WR-BUF.
           MOVE XONPC-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.
           
       FORM-RESET-EXIT.
           EXIT.

      **********************************
       SETUP-LINK-INFO SECTION.
      **********************************
           MOVE XONPC-HELP--FILE TO HELP-LINK-FILE.
           MOVE XONPC-HELP--DIR TO HELP-LINK-DIR.

      **********************************
       VDU-CONVERT-FIELD SECTION.
      **********************************
           MOVE "00" TO STAT.
           MOVE VDU-FIELD-TO-CONVERT TO VDU-ALP-FIELD.
           EVALUATE TRUE
              COPY "LIBLP/XONPC_EVA.CPY".
              WHEN OTHER       MOVE   "2A" TO STAT
           END-EVALUATE.


      ********************************************************
       SETUP-LOCAL-PATHS SECTION.
      ********************************************************
           PERFORM OPEN-BR-FILE.
           MOVE BRANCH TO BR-NO.
           PERFORM READ-BR-FILE.
           PERFORM CLOSE-BR-FILE.
           IF IO-BAD   
              GO TO IO-ERROR.

           MOVE EXT-FILPATH-BASE           TO FILPATH-BASE.
           MOVE BR-MACHINE                 TO FILPATH-MACHINE.
           MOVE BR-DATA-PATH               TO FILPATH-DATA.

           MOVE "B" TO GB-PATH-OVERRIDE
                       LX-PATH-OVERRIDE
                       LXE-PATH-OVERRIDE
                       LN-PATH-OVERRIDE
                       LM-PATH-OVERRIDE
                       LP-PATH-OVERRIDE
                       BW-PATH-OVERRIDE
                       BX-PATH-OVERRIDE
                       TY-PATH-OVERRIDE
                       DS-PATH-OVERRIDE
                       PD-PATH-OVERRIDE
                       PC-PATH-OVERRIDE
                       TRL-PATH-OVERRIDE
                       FM-PATH-OVERRIDE
                       NO-PATH-OVERRIDE
                       IC-PATH-OVERRIDE
                       LTF-PATH-OVERRIDE
                       LTA-PATH-OVERRIDE
                       LTC-PATH-OVERRIDE
                       LTB-PATH-OVERRIDE
                       LTD-PATH-OVERRIDE
                       LTP-PATH-OVERRIDE
                       LTI-PATH-OVERRIDE
                       CI-PATH-OVERRIDE.

      *    MOVE TRANS-MONTH TO TR-ALL-MONTH.
      *    MOVE TRANS-YEAR TO TR-ALL-YEAR.
      *    PERFORM LOAD-TR1-FILE.

      ************************************************
       GET-LIVECHECK-FEES SECTION.
      ************************************************
      * CALCULATE THE NON-MEMO FEES ASSOCIATED WITH LIVE CHECKS.
      * LPAMTS INCORRECTLY SUBTRACTS THEM FROM HIGH-CREDIT
      * SO WE NEED AT ADD THEM BACK IN.
      * DONE HERE SO LPAMTS DOES NOT HAVE TO BE RESENT AFFECTING 643
      * PROGRAMS. 61000/1180
           MOVE 0 TO LIVE-CHECK-FEES.
           PERFORM VARYING LPAMTS-SUB FROM 1 BY 1
                                   UNTIL LPAMTS-SUB > 10
              IF LN-FEEOURS(LPAMTS-SUB) NOT = "M"
                 MOVE LN-FEECODE(LPAMTS-SUB) TO LPAMTSW-FEECODE
                 IF NOT (LPAMTSW-FEECODE-CH1-NUMERIC)
                    ADD LN-FEEAMT(LPAMTS-SUB) TO LIVE-CHECK-FEES
                 END-IF
              END-IF
           END-PERFORM.


      *********************************
       MISC-PARAGRAPHS SECTION.
      *********************************
       COPY "LIBGB/ACCESS.CPY".
       COPY "LIBGB/GETENV.CPY".
       MOVE-LXM-FIELDS.
           MOVE "M"                TO LXM-CODE.
           MOVE 0                  TO LXM-MIP-CLPAID
                                      LXM-MIP-AHPAID.
           MOVE LN-MIP-CLPDTH-DATE TO LXM-MIP-CLPDTH-DATE.
           MOVE LN-MIP-AHPDTH-DATE TO LXM-MIP-AHPDTH-DATE.
       MOVE-LXX-FIELDS.
           MOVE "X"            TO LXX-CODE.
           MOVE BW-COUNTY      TO LXX-INS-TAX-COUNTY-CD.
           MOVE BW-CITY-TAX-CD TO LXX-INS-TAX-CITY-CD.
       MFFRMLA05-PMT-ADJ.
            IF SP-MFFRMLA-05
               IF APR-1STPYAMT NOT = 0
                  SUBTRACT LN-MAINTFEE FROM APR-1STPYAMT
               END-IF
               IF APR-REGPYAMT NOT = 0
                  SUBTRACT LN-MAINTFEE FROM APR-REGPYAMT
               END-IF
               IF APR-LASTPYAMT NOT = 0
                  SUBTRACT LN-MAINTFEE FROM APR-LASTPYAMT
               END-IF
            END-IF.
       SEND-WSEL-LEGEND.
           MOVE MESS TO WR-BUF.
           MOVE WSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
      *=================================================================
       GET-LXX-TAX.
           PERFORM OPEN-LX1-FILE.
           MOVE LN-OWNBR  TO LX-BRNO.
           MOVE LN-ACCTNO TO LX-ACCTNO.
           MOVE 1         TO LX-SEQNO.
           PERFORM READ-LX1-FILE.
           IF IO-BAD
              MOVE SPACES TO LXX-INS-TAX-COUNTY-CD
              MOVE SPACES TO LXX-INS-TAX-CITY-CD.
           PERFORM CLOSE-LX1-FILE.
      *-----------------------------------------------------------------
       GET-COLLATERAL.
           PERFORM OPEN-CD1-FILE.
           MOVE "CO"      TO CD-TYPE.
           MOVE LN-COLLCD TO CD-CODE.
           PERFORM READ-CD1-FILE.
           IF IO-FG NOT = 0
              MOVE " " TO CD-CO-SECURED.
           PERFORM CLOSE-CD1-FILE.
       CLEAR-EARNING-WK.
           MOVE 0 TO EARNING-WK(SUB).
           ADD 1 TO SUB.
       SET-EARNINGS.
           MOVE UERN-EARNINGS(SUB) TO LN-UFERN(SUB) LN-ACCERN(SUB).
           MOVE SP-EARN-ORDER(SUB) TO LN-EARN-ORDER(SUB).
           ADD 1 TO SUB.
       UPDATE-ACCERN.
           IF LN-ACCERN(SUB) NOT = 0
              MOVE LN-EARN-ORDER(SUB) TO E-SUB
              IF E-SUB > 0 AND < 7
                 MOVE LN-ACCERN(SUB) TO EARNING-WK(E-SUB).
           ADD 1 TO SUB.
       SET-PD1-KEY.
           MOVE "R"         TO PD-ID.
           MOVE BRANCH      TO PD-BRANCH.
           MOVE SAVE-PRLNNO TO PD-SOC-SEC.
       SET-DS1-KEY.
           MOVE TRANS-DATE-YYYYMM TO DS-DATE-CCYYMM.
           MOVE LN-OWNBR          TO DS-BRANCH.
           MOVE LN-DLNO TO W-DL.
           MOVE W-DLNO            TO DS-NUM.
           MOVE LN-CLASS          TO DS-CLASS.
       SET-TY-KEY.
           MOVE LN-OWNBR   TO TY-BRNO.
           MOVE TRANS-DATE TO TY-DATE.
           MOVE LN-CLASS   TO TY-CLASS.
       GET-BW1.
           PERFORM OPEN-BW1-FILE.
           MOVE LN-SSNO(1)  TO BW-SSNO.
           PERFORM READ-BW1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           PERFORM CLOSE-BW1-FILE.

       SEND-LEGEND.
           IF LPLOAN-CALLED-FROM NOT = "LNCRE2"
              MOVE MESS TO WR-BUF
              MOVE MSEL-LIST TO WR-LIST
              PERFORM CALL-WRFORM.
       CONDITIONAL-SEND-MESS.
           IF LPLOAN-CALLED-FROM NOT = "LNCRE2"
              PERFORM SEND-MESS
           ELSE
              IF LPLOAN-RETURN-ERR-BUF = SPACES
                 MOVE MESS TO LPLOAN-RETURN-ERR-BUF.

      *********************************
      *      F I L E   I / O          *
      *********************************
       COPY "LIBLP/LPDSCL.CPY".
       COPY "LIBLP/LPTYCL.CPY".
       COPY "LIBLP/LPTRLCL.CPY".
       COPY "LIBLP/LPLXCL.CPY".

      ***********************************
       IO-ROUTINE SECTION.
      ***********************************
       COPY "LIBGB/CONNECT_SQL.CPY".
       COPY "LIBLP/LPTYGS_SQL.CPY".
       COPY "LIBLP/LPTRLGS_SQL.CPY".
       COPY "LIBLP/LPSPGS_SQL.CPY".
       COPY "LIBLP/LPPDGS_SQL.CPY".
       COPY "LIBLP/LPPCGS_SQL.CPY".
       COPY "LIBLP/LPNOGS_SQL.CPY".
       COPY "LIBLP/LPLXEGS_SQL.CPY".
       COPY "LIBLP/LPLXGS_SQL.CPY".
       COPY "LIBLP/LPLTPGS_SQL.CPY".
       COPY "LIBLP/LPLTIGS_SQL.CPY".
       COPY "LIBLP/LPLSMGS_SQL.CPY".
       COPY "LIBLP/LPLTFGS_SQL.CPY".
       COPY "LIBLP/LPLTCGS_SQL.CPY".
       COPY "LIBLP/LPLTBGS_SQL.CPY".
       COPY "LIBLP/LPLTDGS_SQL.CPY".
       COPY "LIBLP/LPLTAGS_SQL.CPY".
       COPY "LIBLP/LPLPGS_SQL.CPY".
       COPY "LIBLP/LPLNGS_SQL.CPY".
       COPY "LIBLP/LPLMGS_SQL.CPY".
       COPY "LIBLP/LPLCGS_SQL.CPY".
       COPY "LIBLP/LPICGS_SQL.CPY".
       COPY "LIBLP/LPFMGS_SQL.CPY".
       COPY "LIBLP/LPFDGS_SQL.CPY".
       COPY "LIBLP/LPDSGS_SQL.CPY".
       COPY "LIBLP/LPCIGS_SQL.CPY".
       COPY "LIBLP/LPCDBGS_SQL.CPY".
       COPY "LIBLP/LPCDGS_SQL.CPY".
       COPY "LIBLP/LPBXGS_SQL.CPY".
       COPY "LIBLP/LPBWGS_SQL.CPY".
       COPY "LIBGB/GBGBGS_SQL.CPY".
       COPY "LIBGB/GBBRGS_SQL.CPY".
       COPY "LIBGB/GBGBIN.CPY".
       COPY "LIBGB/GBBRRN.CPY".
       COPY "LIBLP/LPLC1RN.CPY".
       COPY "LIBLP/LPSP1RN.CPY".
       COPY "LIBLP/LPLX1IN.CPY".
       COPY "LIBLP/LPLXE1IN.CPY".
       COPY "LIBLP/LPLM1IN.CPY".

       COPY "LIBLP/LPLN1IN.CPY".
       COPY "LIBLP/LPLN4RN.CPY".
       COPY "LIBLP/LPLN5RN.CPY".
      *COPY "LIBLP/LPLN6RN.CPY".
      *COPY "LIBLP/LPLN7RN.CPY".
       COPY "LIBLP/LPLP1IN.CPY".
       COPY "LIBLP/LPBW1IN.CPY".
       COPY "LIBLP/LPTY1IN.CPY".
       COPY "LIBLP/LPDS1IN.CPY".
       COPY "LIBLP/LPPD1IN.CPY".
       COPY "LIBLP/LPPC1IN.CPY".
       COPY "LIBLP/LPWKI.CPY".
       COPY "LIBLP/LPTRL1IN.CPY".
       COPY "LIBLP/LPFD1RN.CPY".
       COPY "LIBLP/LPFM1IN.CPY".
       COPY "LIBLP/LPNO1IN.CPY".
       COPY "LIBLP/LPLTC1IN.CPY".
       COPY "LIBLP/LPLTA1IN.CPY".
       COPY "LIBLP/LPLTB1IN.CPY".
       COPY "LIBLP/LPLTD1RN.CPY".
       COPY "LIBLP/LPLTP1RN.CPY".
       COPY "LIBLP/LPLSM1IN.CPY".
       COPY "LIBLP/LPLTF1IN.CPY".
       COPY "LIBLP/LPLTI1RN.CPY".
       COPY "LIBLP/LPIC1RN.CPY".
       COPY "LIBLP/LPCD1RN.CPY".
       COPY "LIBLP/LPCDB1RN.CPY".
       COPY "LIBLP/LPCI1IN.CPY".
       COPY "LIBLP/LPBX1IN.CPY".

      **************************************************************
      *   ARCHIVED LNFILE IO
      **************************************************************
      *OPEN-ARCH-LN1-FILE.
      *    PERFORM OPEN-IT.
      *    MOVE LN-ARCHIVE-PATH TO E-FILE.
      *    OPEN INPUT ARCH-LN-FILE.
      *    IF IO-FG = 8
      *      GO TO OPEN-ARCH-LN1-FILE.
      *    IF IO-FG = 7
      *      CLOSE ARCH-LN-FILE
      *      GO TO OPEN-ARCH-LN1-FILE.
      *    UNLOCK ARCH-LN-FILE.
      *READ-ARCH-LN1-FILE.
      *    PERFORM READ-IT.
      *    MOVE LN-ARCHIVE-PATH TO E-FILE.
      *    MOVE ARCH-LN1-KEY TO E-KEYX.
      *    READ ARCH-LN-FILE.
      *    IF IO-FG = 8
      *      GO TO READ-ARCH-LN1-FILE.
      *CLOSE-ARCH-LN1-FILE.
      *    PERFORM CLOSE-IT.
      *    CLOSE ARCH-LN-FILE.
       COPY "LIBGB/FERRORS.CPY".
           MOVE "E" TO ERRCD.

       END-ROUTINE SECTION.
           PERFORM CLOSE-FILES.
           IF NOT (LPLOAN-CALLED-FROM = "LNCRE2")
              DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN
              DESTROY ALL.
       EXIT-PROG.
       STOP-RUN.
           EXIT PROGRAM.
