       IDENTIFICATION DIVISION.
       PROGRAM-ID.      LONIF1.
       DATE-WRITTEN. 021784.
      **************************************************************************
      *                    (LP)
      *  DESCRIPTION:  LOAN PROCESSING
      *                BALANCE FORWARD
      *                PROGRAM 1 - ENTRY BAR
      * REV:
      *  JTG 033195 REMOVED REF: NO ODD PAYMENTS
      *  053095 SLC COMBINED OTHBAL AND OT2BAL IN L-090
      *  061495 MJD SET UP LP-USERID, LP-POSTDATE AND LP-POSTTIME.
      *  062895 MJD ADDED COPY MEMBERS LIBLP/POSTDATE AND POSTDATEW.
      *  070795 JTG ADDED TEST FOR SP-LCFRMLA = "L", MERCURY 'UCCC' 'IN'
      *  082595 JTG ADDED TEST FOR SP-LCFRMLA = "M", MERCURY 'LA'
      *  112995 JTG ADDED SP-LCFRMLA TO NOT ALLOW LCPDTH TO BE GREATER
      *             THAN 1 MONTH FROM PDTH
      *  071096 JTG CHANGED DISPLAY OF PDTH. IF MONTHLY: MMYY OR MM/DD/YY.
      *             IF WEEKLY: MMDD OR MM/DDWYY
      *  101696 MJD ADDED LIBLP/LPREGZ(W).
      *  JTG 101196 ADDED 'LXE-WORKER' & 'LXE-WORKER2' FOR LPCERN-- A50 VERSION
      *                   SP-ERNFRMLA 15 & 16, REAL INTEREST BEARINGING METHOD
      *  MJD 101896 ADDED WINDOWS TO ENTER OTHBAL/OT2BAL/INTBAL/LCBAL.
      *             OTHER FIELD NOW DISPLAYS OTHBAL + OT2BAL.
      *  MJD 103196 ADDED UPDATE OF TYFILE AND DSFILE.
      *  MJD 111196 ADDED TRK-FILE UPDATE.
      *  JFF 112596 ADDED PASSWORD PROTECTION FOR OTHBAL.
      *  JTG 120296 CORRECTED UPDATE OF DSFILE TO STOP PL'S
      *             FROM UPDATING RECOURSE
      *  JTG 010697 CORRECTED IBPC-TEST TO BE DONE AFTER SET OF
      *             LN-DATE-PAID-LAST TO CATCH ACCOUNTS IN EXPIRATION STATUS
      *  JTG 011497 ADDED CLEAR OF LN-TOTEXCPAYMNTD IN DELETE ROUTINE
      *  BAH 030397 1STPYDATE 3/29/97 WAS CALCING LCPDTH 2/28/97, BUT YOU
      *             COULD NOT RETURN THRU IT, BECAUSE OF ELAPSED-UNITPER-REM
      *             SO SKIP THE TEST IF YOU JUST PRESSED ENTER
      *  BAH 030797 ADDED LOGIC FOR DL-RECOURSE-FRMLA = 'A' FAIRCO
      *  JTG 040397 CHANGED TO TEST FOR ACCOUNTS WITH NO PRIOR PAYMENTS
      *             AND SET LN-INTPDTH-DATE = 0
      *  JTG 051297 ADDED USE OF 'SETCTBL' AND 'SETCTBLW'
      *  GLF 090897 REPLACED 'IO' ON GP-FILE WITH GET 'GPENV'
      *  MJD 091797 REMOVED DELSUB-SET LOGIC; ADDED LPPDUE(W) COPY MEMBERS
      *  MJD 112597 EXPANDED LX-REC TO 73 BYTES (ADDED 10)
      *  BAH 010698 ADDON PAY SCHEDULE WAS COMMENTED OUT, UNCOMMENT
      *             PL# 165
      *  MJD 032098 ADDED GETENV(W) FOR USE IN LIBLP/POSTDATE
      *  BAH 032398 WHEN UNCOMMENTED ABOVE TO GET PAY SCHEDULE TO WORK, THE
      *             ADDON-LIST GOT MESSED UP..
      *  JTG 032798 ADDED CERN-TRCD SET, RE: ERNFRMLA = 6, PREMIER FINANCE
      *             TO STOP TAKING INCOME ON "SS" TRANSACTION
      *  MJD 060498 EXPANDED LP-REC TO 239 BYTES
      *  JTG 061598 ADDED LOGIC TO UPDATE BANKRUPT DELINQUENT STATISTICS
      *  MJD 083398 ADDED ENV VARIABLE TO DETERMINE WHETHER OR NOT
      *             TO DISPLAY BALANCES ON REVERSALS. FIXED DISPLAY TO INDICATE
      *             INCLUDED O2 BAL WITH "SC" "RN" "PB" "RB" "RO" TRANSACTIONS
      *  BAH 090498 HAD TO EXPAND H16 (TOTINT) TO Z(5).99 FOR NATION FUNDING
      *  JTG 101298 ALLOWED DISPLAY OF NEGATIVE CURBAL REVOL REGENCY
      *  JTG 990326 ADDED AERN-LAST-ACCRUAL-DATE AERN-NEW-LAST-ACCRUAL-DATE
      *              RE: SP-ERNDELQFRMLA 'C' TFC #005
      *  MJD 990416 CHANGED TO INCL/EXCL O2 FROM DELINQ BASED ON
      *             GP-DELINQ-WITH-O2
      *  CS  990616 ***IN PROGRESS*** TFC CHANGE TO ENTER ANTICIPATED EARN
      *  MJD 990803 ADDED GP-INCL-OTH-IN-EARNED FLAG. IF "Y" THEN INCLUDE
      *             EARNINGS BUCKET 6 (OTHER) IN ACCUMULATED TOTALS
      *             OTHERWISE EXCLUDE BUCKET 6.
      *  BLV 990820 FIXED TO UPDATE REPO BUCKETS 4 & 5 FOR REPOS IN P&L
      *             RECEIVABLES, TFC PR#20, GSUB PR#809
      *   CS 991020 FIXED DELETE OF BF LINE, WAS NOT UPDATING DEALER STATS,
      *             TODAYS TOTALS, OR GL IF YOU DID THE DELETE IMMEDIATELY
      *             AFTER ACCEPTING THE BF LINE WITHOUT REFRESHING THE
      *             ACCOUNT NUMBER.
      *   CS 991104 CHANGED BULK-PURCHASE-FG TO TEST FOR 'B' NOT 'Y' STATS
      *             NOT UPDATING CORRECTLY
      *   CS 991115 CHANGED IPF-WINDOW TO DISPLAY TOTAL UNEARNED UPON
      *             ENTERING WINDOW INSTEAD OF AT THE ANTIC INTEREST ENTRY.
      *   CS 991124 DONT UPDATE THEY INTEREST IN THE TY TO PARALLEL A TP
      *             TRANSACTION
      *  BLV 000112 FIX Y2K BUG, CHECK ON PAYMENT DATE BEING = OR > LOAN DATE
      *             WAS COMPARING YYMM & DIDN'T WORK AFTER 1/1/00 - PROBLEM
      *             ON LAST FULL PMT MMYY, ONLY BANKRULE D OR RECFRMLA P
      *  JTG 000208 ADDED SP-LOANCOST-FRMLA,  REGENCY #006 & #063
      *  BLV 000313 ADD ENTRY OF WCBC-CREDITLIM IF LC-CALC-HI-CREDIT = W,
      *             WORLD PR# 225
      *  MJD 000406 ADDED UPDATE OF TY-PROCEEDS (MERC PR#223)
      *  JTG 000410 MODIFIED TO UPDATE UNEARNED STATISTICS, MERCURY #223
      *  JTG 000417 CORRECTED UPDATE UNEARNED STATISTICS, MERCURY #223
      *  JTG 000613 CHANGED UPDATE TEST ON GP-LOAN-CONVERSION-UPD-FG
      *             TO ALWAYS CREATE A TRK TRANSACTION RECORD         #1203
      *  JTG 000616 CORRECTED CONVERSION PROBLEM WITH INCORRECT AMOUNTS FOR
      *             LN-ANTICERN, LN-ANTICADJ & LN-ACCERN WHEN REFUNDS ARE
      *             SET VIA WI/LNSTAT.C                             #1203
      *  BLV 000713 FIXED TO UPDATE REPO BUCKETS 4 & 5 FOR REPOS IN P&L
      *             REGARDLESS OF REPO DATE OR PL DATE, TFC PR# 77
      *  JTG 001011 WHEN THE CONVERSION LINE WAS INPUTED, IF
      *             (LN-CURBAL - LN-OT2BAL) = LN-LNAMT THE LOGIC ASSUMED
      *             LP-PAYDATE = LN-LOANDATE AND MOVED 0 TO LN-INTPDTH-DATE
      *             THIS CAUSED A PROBLEM IN THE IB ACCRUAL SINCE THE
      *             ASSESSMENT ROUTINE 'LPRATE' TESTS IF LN-INTPDTH-DATE = 0
      *             AND LN-DATE-PAID-LAST NOT = LN-LOANDATE IF TRUE
      *             ASSESSES ARE FROM LN-DATE-PAID-LAST            REGENCY #J013
      *  JTG 010522 ADDED CERN-APINT, CERN-APLC, CERN-APOTH, CERN-APOT2
      *             NEW CODE '23' FOR SP-ERNFRMLA                 PAACO PR#1469
      *  JTG 010625 CREATED LCAP-X (BAD LOGIC) BY PUTTING BACK THE OLD LOGIC
      *             FOR LCAP-E                                     IDEAL PR#1509
      *  JTG 010808 ADDED SP-LNCOST-FRMLA-VALID 'P' AMORTIZED
      *             PARTICIPATION EXPENSE                         REGACC PR#1559
      *  JTG 030528 ADDED SP-LCFRMLA = 'P' LIKE 'I'                  PACE #408
      *  JTG 030630 ACCOUNTS BYPASS LATE CHARGE ASSESS ROUTINE WHEN
      *             SP-LCFRMLA = ' ' BUT ACCOUNT IS SETUP FOR DEALER LATE
      *             CHARGE FORMULA                               MIDATL #J027
      *
      *     N       THE FOLLOWING TESTS ON LN-LC-CODEX NOT NECESSARY FOR
      *     O       CONVERSION SINCE CONVERSION DOSN'T ALLOW IT'S ENTRY
      *     T       IF ( SP-LCFRMLA NOT = " "            ) OR
      *     E          ( NOT (LN-LC-CODEX = "00" OR " ") )
      *     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *  JTG 041209 ADDED A TEST FOR F7-EXIT WHEN ENTERING DEALER RECOURSE CODE
      *             AT IPF-DLR-RECOURSE
      *  JTG 050628 ADDED CHANGES FOR REPORTING AND TAKING FEE CODE EARNINGS
      *             CREATED CD-GC-FEE-EARNINGS-FG                    LENDMARK #2542
      *   CS 060921 ALLOWED BF SEQUENCE > 1, BECAUSE WE NOW ALLOW CONVERSION
      *             HISTORY MAINTENANCE PAYMENTS(WI/PMMAKE) CREATING 'XX'
      *             PAYMENT RECORDS PR#2659
      *   CS 061005 WAS ALLOWING MULTIPLE 'BF' LINES PR#2659
      * BLF &
      * CS  061214 UNSTARRED LINE TO RESTORE LN-ORIGPURAMT TO
      *            ORIG-LN-ORIGPURAMT...THIS CAUSED THE EARNINGS TO BE
      *            0 IF YOU ENTERED BF LINE & HIT F1 AT THE ACCEPT
      *            AT THE END OF THE LINE.  NOTE, IF YOU DID THIS,
      *            THE LN-ORIGPURAMT WAS SET TO ZERO, SO ALL
      *            SUBSEQUENT ATTEMPTS TO POST CORRECTLY WILL NOT
      *            WORK, WORLD PR# 510
      * BLF &
      * CS  061214 ADDED A DISPLAY OF ANTICIPATED...THIS FIELD GETS
      *            DISPLAYED BY LONIF0 BUT RESETS TO 0 IF YOU DELETE
      *            "BF" LINE - THIS DIDN'T CAUSE AMTS TO BE BAD, JUST
      *            DISPLAY.
      * BLF &
      * CS  061214 STOPPED USER FROM HITTING F1 AT THE DATE FIELD ON
      *            THE LINE. BUG: BF LINE EXISTS, YOU CALL UP, HIT F6
      *            TO POST, THEN HIT F1 FROM THE DATE, THEN F6 DELETE;
      *            AT THIS POINT THE F1 RESET THE LN-CURBAL TO 0, SO
      *            NO TR CREATED FOR THE REVERSAL, WORLD PR# 510
      * BLF 061215 STILL PROBLEMS WITH HITTING F1 & THEN DELETING BF LINE,
      *            AND TR NOT GETTING WRITTEN.  UNSTARRED LINE TO SAVE
      *            LN-CURBAL IN ORIG-LN-CURBAL, WORLD PR#510
      * BLF &
      * CS  061218 STARRED OFF THE LINES IN IPF-RESET WHICH WAS
      *            GETTING PERFORMED THROUGHOUT PROGRAM WHENEVER F1
      *            GOT HIT.  EXAMPLE OF PROBLEM:  COME IN WITH LOAN
      *            BAL OF 0, GETS SAVED TO ORIG-LN-CURBAL.  POST BF,
      *            HIT F6 (POST), HIT F6 (DELETE), HIT F1 AT END OF
      *            LINE (MOVES ORIG-LN-CURBAL OF 0 TO LN-CURBAL),
      *            HIT F6 TO DELETE, "D" AT END OF LINE.  DOESN'T
      *            WRITE TR FOR REVERSAL SINCE LN-CURBAL = 0,
      *            WORLD PR# 510
      * BLF &
      * CS  070613 ADDED SEVERAL UNLOCKS ON LPFILE - ANDRIA WAS LOCKING UP
      *            AT GL FINANCIAL
      * JTG 080129 CHANGED FOR JUDY/CS/JOHN TO ALLOW BULK-CONVERSION-FG
      *            TO TAKE UPFRONT EARNINGS                   FINAUTO     #3141
      * BAH 080131 ENTER LN-MTD-PAYS-RECDEL INSTEAD OF LN-TOTEXCPAYMNTD FOR
      *            GP-I-AM-WORLD ONLY, WORLD PR# 566
      * BAH 080228 FIXED AN 'IF' STATEMENT FOR #3141, CAUSING JUNK IN THE
      *            LOAN EARNINGS FIELDS FOR ANYONE OTHER THAN FINAUTO
      *  CS 080417 THE F3-MESSAGE DIDNT UPDATE, THIS WAS BECAUSE THE FILES
      *            WERE ALREADY UPDATED PRIOR TO ENTERING A MESSAGE, ADDED
      *            A REWRITE OF THE LNFILE PR#625 SUPPORT
      * BAH 080731 ADDED TSTDAT AFTER THE DATE ENTRY, WAS ALLOWING TOTALLY
      *            INVALID DATES ! JUDY/UNITED, PL# 634
      *  CS 081010 WHEN ENTERING PARTIAL RECOURSE IN IPF-WINDOW WAS COMPARING
      *            RECOURSE AMOUNT TO LN-CURBAL(STILL ZERO) GIVING MESSAGE THAT
      *            'RECOURSE CAN NOT BE HIGHER THAN BALANCE' CHANGED TO TEST
      *            AGAINS LP-CURBAL   WHITESTONE PL# 641
      *  CS 081112 ADD TEST ON GP-INCL-OTH-IN-EARNED = 'R'. IF 'R' EXCLUDE
      *            OTHER(ANTIC (6) AND MAINTFEE(ANTIC (4) FROM EARNED/UNEARNED
      *            REGACC USES MAINTFEE TO AMORTIZE PARTIC EXPENSE REGACC PR#210
      *  CS 090804 IF GP-I-AM-WORLD, IF SP-DLDISC-CONV-BF-PCNT NOT = 0, COMPUTE
      *            A RESERVE THAT IS UPDATED TO LN-ANTICERN(5) TO BE
      *            AMORTIZED. THE REVERSAL SETS LN-ANTICERN(5) TO ZERO. PR#648
      *                                                     WORLD
      *  CS 090806 REMOVED UPDATE OF 'TRK' FOR UPFRONT EARNINGS, ALSO REMOVED
      *            FROM CREATE-TRK-REV THE COMPUTE OF TK-EARNED = HOLD-RV-ACCERN      *            * -1.  THESE 2 ITEMS CAUSED UPFRONT EARNINGS TO HIT GL BUT
      *            THE REVERSAL REVERSED ALL EARNINGS CAUSING EARNINGS AND
      *            CONVERSION GL ACCOUNTS TO NOT NET TO ZERO. FOUND  WHILE I
      *            WAS TESTING ABOVE CHANGE.  PR#648 WORLD
      *  CS 090810 MAKE SURE THERE IS AN EARNINGS FORMULA IN SP-ERNFRMLA(5)
      *            IF WORLD BEFORE COMPUTING CURBAL * SP-DLDISC-CONV-BF-PCNT
      *  CS 090810 IF GP-I-AM-WORLD DONT COMPUTE LN-ANTICERN(5) IF ACCOUNT IS
      *            P&L OR ACCELERATED WORLD PR#648
      * BAH 100812 IF GP-I-AM-UNITED, DISPLAY "IS THIS DATE CORRECT" FOR ALL
      *            DATES NOT PRIOR TO LOAN DATE, UNITED PR# 3636
      *  CS 110824 IF SP-BANKRULE 'F', DO THE SAME AS SP-BANKRULE 'D' (LAST
      *            FULL PAYMENT   WORLD PR#752
      * MJD 140625 REPLACED DESTROY LONIF-SCREEN WITH DISPLAY ALL CONTROLS.
      *            THE DESTROY SCREEN WAS NOT CLEARING THE SCREEN AND I DO
      *            NOT KNOW WHY AT THIS TIME.    
      *  CS 141121 FIXED PURFLD OPEN-WINDOW DISPLAY, WINDOW WAS NOT BIG ENOUGH
      *            AND GETTING MISSING FIELD ERRORS
      *  CS 150316 WHEN BULK-CONVERSION-G = B, WITHIN INPUT PURCHASE FIELDS
      *            SECTION, (ENTER DLR-RECOURSE) AND F7 WAS DOING A GOTO TO
      *            THE MIDDLE OF THE SELECTION-MODULE SECTION.
      * BAH 151217 EXPANDED HOLD-LN-INSTBL FROM 24 TO 46 TO MATCH LOAN REC
      *            CUSTOMER WAS GETTING 20202 IN UNEARNED FIELDS, SUPPORT 913
      *  CS 151222 SET LP-BRNO FROM LN-OWNBR, CHANGED HOLD-LP1-KEY TO HOLD-LP-
      *            KEY, CHANGED HOLD-LP-KEY TO X(13)
      *  BAH 160118 SPLIT OUT LTFILE, PD0003
      *   CS 160216 ADD MOVE OF LN-OWNBR TO LX-BRNO
      *  BLM 160225 FIX FOR NEW TY-DATE FORMAT, YYYYMMDD INSTEAD OF YYYMMDD
      * KEC 2016.0309 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED CD-GROUP, CD-SECURED & CD-TRW TO BE
      *         CD-CO-GROUP, CD-CO-SECURED & CD-CO-TRW.
      *  BLM 160512 FIX FOR NEW DS-DATE FORMAT, FIX DS-UNEARNED, PD0003
      *
      * KEC 2016.1025 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         REMOVED USING HOLD-TR1-KEY.
      *         ADDED LIBLP/LPWSTR (NEW) FOR LPWSTR-TR1-KEY (HOLD/SAVE).
      *  CS 161128 CHANGED DISPLAY-ENTRY-LINE WHERE IT DISPLAYS HOLD-LCPDTH-
      *            DATE, CHANGED FROM  MOVE "S  A060H21." TO VDU.
      *            MOVE HOLD-LP-LCPDTH-DATE TO VDUBUF TO MOVE "SNNN060H21." 
      *            TO VDU.  MOVE HOLD-LP-LCPDTH-DATE TO VDUNUM0. LATE CHARGE
      *            PAID THRU IS 122816 BUT DISPLAYED AS 001228.
      *  CS 161229 UNCOMMENT THESE 2 LINES, SAVE-MONTH-DATE NOT SET WAS
      *            GARBAGE & CAUSED SUBSCRIPT ERRORS IN DATE ROUTINES
      *            MOVE MONTH-DATE TO SAVE-DATE SAVE-MONTH-DATE.
      * 
      * KEC 2017.0105 {PR#00000} PARADATA <A30> [JAY CISZEWSKI]
      *          CHANGED DS-DATE TO DS-DATE-CCYYMM FOR CONSISTENCY
      *          WITH THE DATE FIELDS IN BY & UD FILE.
      *
      * BAH 170609 ACTIVATE 8 DIGIT DATES, PD0006
      *
      * KEC 2017.0727 {PR#00000} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED HOLD-LP-KEY TO SAVE-LP1-KEY; COULD NOT RENAME TO
      *         HOLD-LP1-KEY SINCE ALREADY USED.
      *
      * BAH 170914 RENAMED LN-PYMMYY-RECDEL TO LN-PY-YYYYMM-RECDEL AND FIXED
      *             LOGIC TO WORK
      *  
      * BAH 180613 FIXED DISPLAY OF D-PDTHRU
      * BAH 181210 GLOBAL LNFILE
      * BAH 181221 GLOBAL LPFILE
      *  CS 190103 GLOBAL LTIFILE
      * BAH 190116 GLOBAL LXFILE
      *  CS 190418 ADDED 'S' TO THE 'IF' TEST OF SP-LCFRMLA IN ENTER-
      *            LCPAID-OR-PRIINT.
      *            IF SP-LCFRMLA = "F" OR "H" OR "I" OR "L" OR
      *                     "M" OR "P"
      *            ALSO ADDED SP-LCFRMLA 'S' WHERE 'F' WAS TESTED AS
      *            THEY ARE SAME EXCEPT AT MATURITY  WORLD #1369
      *  CS 190516 WAS NOT SETTING LC-PAID-CORRECTLY, WAS MOVING 0 TO MONTH
      *            THIS CODE IS AT THE END OF SET-LCFRMLA-FHILM-INFO WHICH
      *            PERFORMS LCAP-S-CURRENT-PERIOD(ALSO THE OTHER UUUC LC
      *            FORMULAS.
      *            SO I TRIED  MOVE LCAP-CURDUE TO HOLD-LN-LCPARTIALS.
      *            LCAP-CURDUE9(7)V99, HOLD-LN-LCPARTIALS S9(7)V99 AND
      *            THE DATE THAT SHOULD HAVE BEEN THERE 904.17(LONPF2 SETS)
      *            WAS ACTUALLY 90417.00. SO, AT THE END OF SET-LCFRMLA-FHILM
      *            INFO MULTIPLY HOLD-LN-LCAP BY .01
      *                                          WORLD PR#1369A
      *  CS 190607 UPDATE-LXE,CLEAR LXE-EARN(4-7) AND FUTURE FIELDS ON WRITE
      *            CHANGED EARNING-WK OCCURANCES TO 10.EARNING-WK POPULATED BY
      *            MOVE OF LN-ANTICERN().  THE CLEAR OF THE LOAN SET LN-ANTICERN
      *            (7-10) TO 0. STILL MUST CLEAR FUTURE FIELDS BEFORE WRITE.
      *            INSTEAD OF MOVING 0 TO LXE-EARN(7-10), MOVING EARN-WK(7-10)
      *            SHOULD BE 0 NOW, BUT WHEN WE ADD ADDITIONAL EARNINGS
      *            COMPONENTS SHOULD BE SET UP CORRECTLY
      *            CHANGED EARNING-WK TO S9(7)V99 FROM S9(5) TO MATCH LXE
      * BAH 20220103 IF BALANCE FORWARD IS DONE FOR ZERO BALANCE, FORCE DATE
      *              OF BF TO PAYOFF DATE WITH A PAYOFF CODE OF "PO" AND
      *              PAYOFF TRANSACTION CODE OF "PO". #1531
      * BAH 2022.0803 HARD CODED START
      * BAH 2022.0812 CHANGED HOLD-EARN-ORDER TO PIC 99 FROM PIC 9
      *               AND HOLD-LN-INSTBL FROM 46 TO LN-INSTBL-SIZE, NUMERIC
      *               VALUE OUT OF RANGE, INSEARN-ORDER WAS SPACES, CUT OFF
      *               IN THE HOLD
      * BAH 2022.0818 REMOVED GLOBRD, READ GB-FILE INSTEAD
      * JKC 2022.0930 CHANGED TO USE START-LP1-FILE-SCAN INSTEAD OF
      *               START-LP1-FILE; NEED TO USE START-LP1-FILE-SCAN WHEN
      *               START-LP1-FILE-NOT-GREATER IS USED FIRST; NEEDED FOR
      *               FOR DISPLAYING MULTIPLE PAGES IN AN UP & DOWN FUNCTION;
      *               NEED TO ADD ONE TO LP-SEQNO (IN WBEG) IN ORDER TO GET 
      *               THE DISPLAY TO WORK LIKE WITH VISION FILES.
      * BAH 2023.0328 ADDED SP-LCFRMLA "T" FOR "WI" UCCC LATE CHARGE #1597
      * BAH 2024.0130 CALL CRNOR2 AND WRITE NOTICE RECORD
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. 3B.
       OBJECT-COMPUTER. 3B.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
       COPY "LIBLP/LPFSWK.CPY".
       I-O-CONTROL.

       DATA DIVISION.
       FILE SECTION.
       COPY "LIBLP/LPFDWK.CPY".

       WORKING-STORAGE SECTION.
       77  SCCS-IDENTIFIER PIC X(41) VALUE
           "@(#)LP/LONIF1.CBL S35 09/30/22-15:24:02 >".
      ************************************************
      *     P R O G R A M   W O R K E R S            *
      ************************************************
       COPY "LIBLP/LP01DL.CPY".
       COPY "LIBLP/LP01DL_SQL.CPY".
       COPY "LIBLP/LPWSDL.CPY".
       COPY "LIBLP/LP01LXE.CPY".
       COPY "LIBLP/LP01LXE_SQL.CPY".
       COPY "LIBLP/LPWSLXE.CPY".
       COPY "LIBLP/LP01LC.CPY".
       COPY "LIBLP/LP01LC_SQL.CPY".
       COPY "LIBLP/LPWSLC.CPY".
       COPY "LIBLP/LP01LN.CPY".
       COPY "LIBLP/LP01LN_SQL.CPY".
       COPY "LIBLP/LPWSLN.CPY".
       COPY "LIBLP/LP01NO.CPY".
       COPY "LIBLP/LP01NO_SQL.CPY".
       COPY "LIBLP/LPWSNO.CPY".
       COPY "LIBLP/LP01LP.CPY".
       COPY "LIBLP/LP01LP_SQL.CPY".
       COPY "LIBLP/LPWSLP.CPY".
       COPY "LIBLP/LP01LTI.CPY".
       COPY "LIBLP/LP01LTI_SQL.CPY".
       COPY "LIBLP/LPWSLTI.CPY".
       COPY "LIBLP/LP01LTP.CPY".
       COPY "LIBLP/LP01LTP_SQL.CPY".
       COPY "LIBLP/LPWSLTP.CPY".
       COPY "LIBLP/LP01SP.CPY".
       COPY "LIBLP/LP01SPA.CPY".
       COPY "LIBLP/LP01SPB.CPY".
       COPY "LIBLP/LP01SPC.CPY".
       COPY "LIBLP/LP01SP_SQL.CPY".
       COPY "LIBLP/LPWSSP.CPY".
       COPY "LIBLP/LP01BW.CPY".
       COPY "LIBLP/LP01BW_SQL.CPY".
       COPY "LIBLP/LPWSBW.CPY".
       COPY "LIBLP/LP01TY.CPY".
       COPY "LIBLP/LP01TY_SQL.CPY".
       COPY "LIBLP/LPWSTY.CPY".
       COPY "LIBLP/LP01DS.CPY".
       COPY "LIBLP/LP01DS_SQL.CPY".
       COPY "LIBLP/LPWSDS.CPY".
       COPY "LIBGB/GB01BR.CPY".
       COPY "LIBGB/GB01BR_SQL.CPY".
       COPY "LIBGB/GBWSBR.CPY".
       COPY "LIBGB/GB01GB.CPY".
       COPY "LIBGB/GB01GB_SQL.CPY".
       COPY "LIBGB/GBWSGB.CPY".
       COPY "LIBLP/LP01CD.CPY".
       COPY "LIBLP/LP01CD_SQL.CPY".
       COPY "LIBLP/LPWSCD.CPY".
       COPY "LIBLP/LP01TRK.CPY".
       COPY "LIBLP/LP01TRK_SQL.CPY".
       COPY "LIBLP/LPWSTRK.CPY".
       COPY "LIBLP/LPWKPATH.CPY".

       01  WK-IFN               PIC X(2)     VALUE "WK".
       01  WK-KEY               PIC 9(6)     VALUE 0.

       01  SAVE-LP1-KEY.
           03  SAVE-LP-BRNO             PIC  9(4).
           03  SAVE-LP-ACCTNO           PIC  9(8).
           03  SAVE-LP-SEQNO            PIC  9(5).

       01  HOLD-LP-PAYDATE              PIC  9(8)     COMP-3.

       78  MTD                               VALUE 1.
       78  YTD                               VALUE 2.
       78  LYR                               VALUE 3.

       01  DISP-REV-BAL         PIC X        VALUE "Y".
       01  LEGEND               PIC X(70).
       01  LEGEND-LIST          PIC X(5)     VALUE "MSEL.".
       01  LEGEND-1.
           03  FILLER           PIC X(50)    VALUE
           "F1, F6-DELETE, F7, ENTER DATE OF LAST INTEREST ASS".
           03  FILLER           PIC X(13)    VALUE
           "ESSMENT:     ".
       01  LEGEND-2.
           03  FILLER           PIC X(50)    VALUE
           "ENTER: TOTAL EXCEPTION PAYMENTS (NON CONTRACTUAL) ".
           03  FILLER           PIC X(20)    VALUE
           "NOT APPLIED TO OT/O2".
       01  LEGEND-2-WORLD.
           03  FILLER           PIC X(70)    VALUE
           "ENTER: RECENCY MONTH-TO-DATE DOLLARS".

       01  NEXT-NEW-LP-SEQNO    PIC 9(5)     VALUE ZEROS.
       01  BF-EXISTS-FG         PIC X        VALUE SPACES.

       01  HOLD-TK-LINE            PIC 999.
       01  ERR-FG                  PIC X        VALUE " ".
       01  HOLD-LP-REC             PIC X(LP-SIZE)   VALUE SPACES.
       01  HOLD1-KEY-DOWN          PIC X(17)    VALUE SPACES.
       01  HOLD2-KEY-UP            PIC X(17)    VALUE SPACES.

       01  HOLD-ACCERN-01.
           03  HOLD-ACCERN         PIC S9(7)V99  COMP OCCURS 6.
           03  HOLD-RV-ACCERN      PIC S9(7)V99  COMP OCCURS 6.
           03  HOLD-RV-UNEARN      PIC S9(7)V99  COMP OCCURS 6.

       01  HOLD-UFERN-01.
           03  HOLD-UFERN          PIC S9(7)V99  COMP OCCURS 6.
       01  HOLD-EARN-ORDER-01.
           03  HOLD-EARN-ORDER     PIC 99        COMP OCCURS 6.
       01  ORIG-LN-ANTICERN-COMP.
           03  ORIG-LN-ANTICERN        PIC S9(7)V99 COMP OCCURS 6
                                                  VALUE ZERO.
       01  ORIG-LN-RESERVES-COMP.
           03  ORIG-LN-DLRVPRIN        PIC 9(6)V99 OCCURS 2.

       01  ORIG-LN-DLPARTRCAMT         PIC 9(6)V99.
       01  ORIG-LN-ORGTERM             PIC 999.
       01  ORIG-LN-MIDSTREAM           PIC X.
       01  ORIG-LN-CURBAL              PIC 9(6)V99.
       01  ORIG-LN-ORIGPURAMT          PIC 9(6)V99.
       01  ORIG-LN-DLDISC              PIC 9(6)V99.

       01  HOLD-LN-RESERVES.
           03 HOLD-LN-DLRVPRIN         PIC 9(6)V99 OCCURS 2.

       01  HOLD-LN-DLPARTRCAMT         PIC 9(6)V99.
       01  HOLD-LN-PROCEEDS            PIC S9(6)V99 VALUE 0.
       01  HOLD-LN-TOT-ANTIC           PIC 9(6)V99 VALUE 0.
       01  HOLD-LN-ANTICTERM           PIC 999.
       01  HOLD-LN-ORIGPURAMT          PIC 9(6)V99.
       01  HOLD-LN-DLDISC              PIC 9(6)V99.
       01  HOLD-LN-MIDSTREAM           PIC X.
       01  IPF-INTEREST-REBATE         PIC 9(6)V99 VALUE 0.
       01  IPF-SERCHG-REBATE           PIC 9(6)V99 VALUE 0.
       01  IPF-MAINTFEE-REBATE         PIC 9(6)V99 VALUE 0.
       01  IPF-FIRST-TIME              PIC X       VALUE "Y".
       01  IPF-CHECK-CURBAL            PIC 9(6)V99 VALUE 0.

       01  SET-EXPIRATION-FG   PIC X        VALUE " ".
       01  SAVE-ERNDELQFRMLA   PIC X.
       01  ELE                 PIC 99       VALUE 0.
       01  ONE                 PIC S9.
       01  FIRST-ELE           PIC 99       VALUE 0.
       01  NEW-FLAG            PIC 9        VALUE 0.
       01  ENTRY-FLAG          PIC 9        VALUE 0.
       01  LN-WK               PIC 99       VALUE 0.
       01  SUB                 PIC 99       VALUE 0.
       01  REC-EXISTS          PIC X        VALUE "N".
       01  SAVE-OUTBAL         PIC S9(8)V99.
       01  E-SUB               PIC 99       VALUE 0.
       01  FULL-PAGE           PIC X        VALUE SPACES.

       01  HOLD-YYYYMM         PIC 9(6)     VALUE 0.
       01  HOLD-YYYYMMX        REDEFINES HOLD-YYYYMM.
           03  HOLD-CC         PIC 99.
           03  HOLD-YY         PIC 99.
           03  HOLD-MM         PIC 99.

      *-----------------------------------------------------------------
      * MSCBAL WINDOW WORKERS:
      *-----------------------------------------------------------------
       01  MSCBAL-WORKERS.
           03  MSCBAL-TYPE           PIC X.
           03  MSCBAL-NUM1           PIC S9(5)V99.
           03  MSCBAL-NUM2           PIC S9(5)V99.
           03  MSCBAL-NUM3           PIC S9(6)V99.
           03  MSCBAL-STATUS         PIC XX.
           03  MSCBAL-TITLE1         PIC X(19) VALUE
               "  OTHER  BALANCES  ".
           03  MSCBAL-OTH-PROMPT     PIC X(16) VALUE
               "OTHER BAL      :".
           03  MSCBAL-OT2-PROMPT     PIC X(16) VALUE
               "OTHER 2 BAL    :".
           03  MSCBAL-TITLE2         PIC X(19) VALUE
               " INT / LC BALANCES ".
           03  MSCBAL-INT-PROMPT     PIC X(16) VALUE
               "INTEREST BAL   :".
           03  MSCBAL-LC-PROMPT      PIC X(16) VALUE
               "LATE CHRG BAL  :".
       01 MSCBAL-BUF.
          03  MSCBAL-BUF-TITLE          PIC X(19).
          03  MSCBAL-PROMPT1        PIC X(16).
          03  MSCBAL-BAL-1          PIC ZZ,ZZ9.99-.
          03  MSCBAL-PROMPT2        PIC X(16).
          03  MSCBAL-BAL-2          PIC ZZ,ZZ9.99-.
          03  MSCBAL-BUF-TOTAL          PIC ZZZ,ZZ9.99-.
       01 MSCBAL-LIST               PIC X(32) VALUE
           "TITLE 010:P 011 020:P 021 TOTAL.".

       01  ADDON-EARNINGS      PIC S9(7)V99.

       01  EARNING-WK-TAB      VALUE ZEROS.
           03  EARNING-WK      OCCURS 10 TIMES
                               PIC S9(7)V99.
       01  REVERSE-FLAG               PIC X             VALUE " ".
       01  PRIN-WORKER                PIC S9(6)V99 COMP VALUE 0.
       01  HOLD-LN-ERNDELQ-STOP       PIC X             VALUE " ".
       01  HOLD-LN-LAST-ACCRUAL-DATE  PIC 9(8)     COMP VALUE 0.
       01  HOLD-LN-DLRECOURSE         PIC X.
       01  HOLD-LN-CREDITLIM          PIC 9(6)          VALUE 0.
       01  HOLD-LN-WCBC-CREDITLIM     PIC 9(6)          VALUE 0.
       01  HOLD-LN-TOTDEF             PIC 9(6)V99  COMP VALUE 0.

       01  HOLD-LN-YTDINTPD    PIC S9(6)V99 COMP VALUE 0.
       01  HOLD-LN-LYRINTPD    PIC S9(6)V99 COMP VALUE 0.
       01  HOLD-PRIINTPD       PIC S9(6)V99 COMP VALUE 0.

       01  HOLD-LN-TOTINT      PIC 9(6)V99  COMP VALUE 0.
       01  HOLD-LN-TOTLCHG     PIC 9(6)V99  COMP VALUE 0.
       01  HOLD-LN-ACCERN      PIC S9(7)V99 COMP VALUE 0.
       01  HOLD-LN-TOTNODEF    PIC 99       COMP VALUE 0.
       01  HOLD-LN-TOTNOALDEL  PIC 99       COMP VALUE 0.
       01  HOLD-LN-REBINT      PIC 9(4)V99  COMP VALUE 0.
       01  HOLD-LN-MESSAGE     PIC X(30)         VALUE SPACES.
       01  HOLD-LN-LCPAID      PIC S9(8)V99 COMP VALUE 0.
       01  HOLD-LN-LCPARTIALS  PIC S9(7)V99 COMP VALUE 0.
       01  HOLD-LN-TOTPAYMNTD  PIC S9(9)V99 COMP VALUE 0.
       01  HOLD-LN-TOTEXCPAYMNTD    PIC S9(7)V99 COMP VALUE 0.
       01  HOLD-LN-MTD-PAYS-RECDEL  PIC S9(7)V99 COMP VALUE 0.
       01  HOLD-LN-PY-YYYYMM-RECDEL PIC 9(6)    COMP VALUE 0.
       01  D-PDTHRU                 PIC 9(4).
       01  CALCD-LP-LCPDTH-DATE    PIC 9(8).
       01  HOLD-LP-LCPDTH-DATE     PIC 9(8).
       01  HOLD-TRCD               PIC XX           VALUE SPACES.

       01  HOLD-LN-SUM-ORGTERM     PIC 9(3)     COMP.
       01  HOLD-LN-SUM-LNAMT       PIC S9(7)V99 COMP.
       01  HOLD-LN-SUM-FINCHG      PIC S9(7)V99 COMP.
       01  HOLD-LN-SUM-INTCHG      PIC S9(7)V99 COMP.
       01  HOLD-LN-SUM-SERCHG      PIC S9(7)V99 COMP.
       01  HOLD-LN-SUM-EXTCHG      PIC S9(7)V99 COMP.
       01  HOLD-LN-SUM-REGPYAMT    PIC S9(7)V99 COMP.
       01  HOLD-LN-SUM-ORIGPURAMT  PIC S9(7)V99 COMP.
       01  HOLD-LN-SUM-MAINTFEE    PIC S9(7)V99 COMP.
       01  HOLD-LN-ANTICERN        PIC S9(7)V99 COMP    OCCURS 6 TIMES.
       01  HOLD-LN-ANTICADJ        PIC S9(7)V99 COMP.
       01  HOLD-LN-UFERN           PIC S9(7)V99 COMP.
       01  HOLD-LN-ADDON-FG        PIC X.
       01  HOLD-LN-PAY-SCHLD-FG    PIC X.
       01  HOLD-LN-REBATE-TAB      PIC X(10)    VALUE " ".
       01  HOLD-LN-INSURANCE.
           03  HOLD-LN-INSTBL      OCCURS 5 TIMES
                                    PIC X(LN-INSTBL-SIZE).
       01  HOLD-LN-ERN-IB-PDTH-DATE PIC 9(8)     COMP.
       01  HOLD-LN-ERN-IB-PRINBAL   PIC S9(7)V99 COMP.
       01  HOLD-LN-ERN-IB-INTOWE    PIC S9(7)V99 COMP.


       01  MAKER-CD            PIC X        VALUE SPACES.
       01  FIRST-TIME          PIC X        VALUE SPACES.

       01  FST-TIME            PIC X        VALUE "Y".

      *****************************************
      *         ORDER LINE BUFFER             *
      *****************************************
       01  LN-BUF              VALUE SPACES.
           03  L-010           PIC 9(6).
           03  FILLER          PIC X.
           03  L-020           PIC XX.
           03  FILLER          PIC X.
           03  L-030           PIC X(5).
           03  L-040           PIC Z(5).99- BLANK ZERO.
           03  L-040RATE       REDEFINES L-040
                               PIC ZZZZ.999-.
           03  L-050           PIC Z(4).99- BLANK ZERO.
           03  L-060           PIC Z(4).99- BLANK ZERO.
           03  L-070           PIC Z(5).99- BLANK ZERO.
           03  L-080           PIC 9(4)     BLANK ZERO.
           03  L-090           PIC Z(5).99- BLANK ZERO.
           03  L-100           PIC Z(4).99- BLANK ZERO.
           03  L-110           PIC Z(5)9.99-.
           03  FILLER         REDEFINES L-110.
               05  FILLER      PIC X(9).
               05  L-120       PIC X.

       01  LINE-BUFFER         VALUE SPACES.
           03  D-LINE          OCCURS 6 TIMES
                               PIC X(80).

       01  LINE-LIST           PIC X(24)    VALUE
           "LN1 LN2 LN3 LN4 LN5 LN6.".

       01  ENTRY-BUF           VALUE SPACES.
           03  EB-010          PIC 9(6).
           03  EB-020          PIC XX.
           03  EB-030          PIC X(5).
           03  EB-040          PIC Z(5).99- BLANK ZERO.
           03  EB-040RATE      REDEFINES EB-040
                               PIC ZZZZ.999-.
           03  EB-050          PIC Z(4).99- BLANK ZERO.
           03  EB-060          PIC Z(4).99- BLANK ZERO.
           03  EB-070          PIC Z(5).99- BLANK ZERO.
           03  EB-080          PIC 9(4)     BLANK ZERO.
           03  EB-090          PIC Z(5).99- BLANK ZERO.
           03  EB-100          PIC Z(4).99- BLANK ZERO.
           03  EB-110          PIC Z(5)9.99-.
           03  FILLER         REDEFINES EB-110.
               05  FILLER      PIC X(9).
               05  EB-120      PIC X.

       01  ENTRY-LINE-LIST     PIC X(48)    VALUE
           "010 020 030 040 050 060 070 080 090 100 110 120.".

       01  TOP-LIST            PIC X(55)    VALUE
           "H11 H12 H13 H14 H15 H151 H152 H16 H17 H18 H19 H20 H21.".

      *--{CS}----------------
       01  DISPLAY-IPF-LIST.
           03  FILLER          PIC X(42) VALUE
           "RECOURSE PARTIALAMT PRIN1 PRIN2 ANTIC-INT ".
           03  FILLER          PIC X(28) VALUE
           "ANTIC-DISC SERCHG MAINTFEE.".

       01  DISPLAY-IPF-BUF       VALUE SPACES.
           03  D-IPF-LN-DL-RECOURSE  PIC X.
           03  D-IPF-LN-DLPARTRCAMT  PIC ZZZZZ9.99.
           03  D-IPF-LN-DLRVPRIN1    PIC ZZZZZ9.99.
           03  D-IPF-LN-DLRVPRIN2    PIC ZZZZZ9.99.
           03  D-IPF-LN-ANTICERN1    PIC ZZZZZ9.99.
           03  D-IPF-LN-ANTICERN5    PIC ZZZZZ9.99.
           03  D-IPF-LN-ANTICERN3    PIC ZZZZZ9.99 BLANK WHEN ZERO.
           03  D-IPF-LN-ANTICERN4    PIC ZZZZZ9.99 BLANK WHEN ZERO.

       01  ADDON-BUFFER        VALUE SPACES.
           03  D-TERM          PIC ZZZ.
           03  D-LNAMT         PIC ZZZZZZ.ZZ.
           03  D-FINCHG        PIC ZZZZZZ.ZZ.
           03  D-NEW-ANTIC     PIC ZZZZZZ.ZZ.
       01  ADDON-LIST          PIC X(13)    VALUE
           "H4 H6 H7 H18.".

       01  SAVE-MONTH-DATE     PIC 9(8) COMP.

       COPY "LIBWI/PFSWINDOWSW.CPY".
       COPY "LIBGB/CONNECTW_SQL.CPY".
       COPY "LIBGB/FILEWK.CPY".
       COPY "LIBGB/MESSWK.CPY".
       COPY "LIBGB/DATERW.CPY".
       COPY "LIBGB/TIMEWK.CPY".
       COPY "LIBLP/LPMNUIW.CPY".
       COPY "LIBLP/LPPOFFW.CPY".
       COPY "LIBCL/CRNOR2W.CPY".
       COPY "LIBGB/SPPDTHW.CPY".
       COPY "LIBWI/PMMAKEW.CPY".
       COPY "LIBGB/REBATEW.CPY".
       COPY "LIBLP/LPSCHDW.CPY".
       COPY "LIBLP/LPITRMW.CPY".
       COPY "LIBLP/LPAPRZW.CPY".
       COPY "LIBLP/LPUPERW.CPY".
       COPY "LIBLP/LPUPWKW.CPY".
       COPY "LIBLP/LPAPRSW.CPY".
       COPY "LIBLP/SETCTBLW.CPY".
       COPY "LIBLP/LPUERNW.CPY".
       COPY "LIBLP/LPAERNW.CPY".
       COPY "LIBLP/LPEADJW.CPY".
       COPY "LIBLP/LPAMTSW.CPY".
       COPY "LIBLP/LPCERNW.CPY".
       COPY "LIBLP/LPLCAPW.CPY".
       COPY "LIBLP/LPLCASW.CPY".
       COPY "LIBLP/LPLCHGW.CPY".
       COPY "LIBLP/LPCEPPW.CPY".
       COPY "LIBGB/AGEINGW.CPY".
       COPY "LIBLP/LPMDTEW.CPY".
       COPY "LIBLP/LPXDTEW.CPY".
       COPY "LIBLP/LPIBPCW.CPY".
       COPY "LIBLP/LPEARNW.CPY".
       COPY "LIBGB/ACCESSW.CPY".
       COPY "LIBLP/POSTDATEW.CPY".
       COPY "LIBGB/GETENVW.CPY".
       COPY "LIBGB/RBACTW.CPY".
       COPY "LIBGB/GPENVW.CPY".
       COPY "LIBLP/LPREGZW.CPY".
       COPY "LIBLP/LPSRCDW.CPY".
       COPY "LIBLP/LPPDUEW.CPY".
       COPY "LIBLP/LPSETTYW.CPY".
       COPY "LIBLP/LPDSCLW.CPY".
       COPY "LIBGB/PASSWDW.CPY".
       01  OT-SEQ               PIC 9        VALUE 0.
       COPY "LIBGB/HELPLINK.CPY".
       COPY "LIBGB/CONAME_EXT.CPY".
       COPY "LIBGB/SCREENW.CPY".
       COPY "LIBLP/LONIF_DEF.CPY".
       COPY "LIBLP/LPCMNU_DEF.CPY".
       COPY "LIBWI/EARN15_DEF.CPY".
       COPY "LIBWI/EARN16_DEF.CPY".
       COPY "LIBWI/PURFLD_DEF.CPY".
       COPY "LIBWI/MSCBAL_DEF.CPY".
       COPY "LIBLP/LONIF_WKS.CPY".
       COPY "LIBLP/LPCMNU_WKS.CPY".
       COPY "LIBWI/EARN15_WKS.CPY".
       COPY "LIBWI/EARN16_WKS.CPY".
       COPY "LIBWI/PURFLD_WKS.CPY".
       COPY "LIBWI/MSCBAL_WKS.CPY".

       COPY "LIBGB/GETFMW.CPY".
       COPY "LIBLP/LPLONIW.CPY".

       SCREEN SECTION.
       COPY "LIBLP/LONIF_SCN.CPY".
       COPY "LIBLP/LPCMNU_SCN.CPY".
       COPY "LIBWI/EARN15_SCN.CPY".
       COPY "LIBWI/EARN16_SCN.CPY".
       COPY "LIBWI/PURFLD_SCN.CPY".
       COPY "LIBWI/MSCBAL_SCN.CPY".

       PROCEDURE DIVISION
             USING FORM-PATHNAME EXIT-PATHNAME PROG-BUF.
       DECLARATIVES.
       DECLARE-ERROR SECTION.
           USE AFTER ERROR PROCEDURE ON 
                WK-FILE.
       COPY "LIBGB/DECLARE.CPY".
           PERFORM CLOSE-TY1-FILE.
           PERFORM CLOSE-TRK1-FILE.
           PERFORM CLOSE-SP1-FILE.
           PERFORM CLOSE-LXE1-FILE.
           PERFORM CLOSE-LTP1-FILE.
           PERFORM CLOSE-LTI1-FILE.
           PERFORM CLOSE-LP1-FILE.
           PERFORM CLOSE-LN1-FILE.
           PERFORM CLOSE-NO1-FILE.
           PERFORM CLOSE-LC1-FILE.
           PERFORM CLOSE-DS1-FILE.
           PERFORM CLOSE-DL1-FILE.
           PERFORM CLOSE-CD1-FILE.
           PERFORM CLOSE-BW1-FILE.
           PERFORM CLOSE-BR-FILE.
           PERFORM CLOSE-GB-FILE.
           CLOSE  WK-FILE.
       COPY "LIBGB/DECLAR2.CPY".

      ********************************************
      *      P R O G R A M   C O N T R O L       *
      ********************************************
       MAIN-PROGRAM SECTION.

           PERFORM SQL-CONNECT.

      D    STOP MESS.
           MOVE FORM-PATHNAME TO FORM-PATH.
           MOVE "LONIF" TO VDU-FORM-NAME.

           MOVE USER-PID TO TEMP-PID.

      * TEST ENVIRONMENT VARIABLE "RVLINES" TO DETERMINE WHETHER
      * OR NOT TO DISPLAY BALANCES ON REVERSALS.

           MOVE "RVLINES" TO GETENV-BUF.
           PERFORM GETENV-CALL.
           IF STAT = "00"
              MOVE "N" TO DISP-REV-BAL
           ELSE
              MOVE "Y" TO DISP-REV-BAL.

      * INITIALIZE-LN-REC:
           MOVE 0 TO IO-FG.
           MOVE SPACES TO ERRCD ROUTE-CD.

           PERFORM RESTORE-SCREEN.
           MOVE MENU-PROG-FORM(4) TO OLD-PROG-FORM.
           MOVE WK-SAVE-REC TO LN-REC.

           MOVE LN-MESSAGE TO HOLD-LN-MESSAGE.


      *-{CS}- - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    MOVING TO 'ORIG' FOR THE PURPOSE OF WHEN F1-RESET, NEED TO
      *     RESTORE ORIGINAL VALUES THAT MAY HAVE CHANGED IN THE
      *      'INPUT-PURCHASE-FIELDS' WINDOW.
      * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE LN-ANTICERN(1)  TO ORIG-LN-ANTICERN(1).
           MOVE LN-ANTICERN(3)  TO ORIG-LN-ANTICERN(3).
           MOVE LN-ANTICERN(4)  TO ORIG-LN-ANTICERN(4).
           MOVE LN-ANTICERN(5)  TO ORIG-LN-ANTICERN(5).
           MOVE LN-DLRVPRIN(1)  TO ORIG-LN-DLRVPRIN(1).
           MOVE LN-DLRVPRIN(2)  TO ORIG-LN-DLRVPRIN(2).
           MOVE LN-DLPARTRCAMT  TO ORIG-LN-DLPARTRCAMT.
           MOVE LN-ORGTERM      TO ORIG-LN-ORGTERM.
           MOVE LN-MIDSTREAM    TO ORIG-LN-MIDSTREAM.
           MOVE LN-DLDISC       TO ORIG-LN-DLDISC.

      *????DO I NEED TO SAVE THESE ????? ALTERED IN IPF-ACCEPT-F7
      * 12/14/06 & 12/14/06- UNSTARRED THESE LINES, CINDY & BARB:
           MOVE LN-ORIGPURAMT   TO ORIG-LN-ORIGPURAMT.
           MOVE LN-CURBAL       TO ORIG-LN-CURBAL.

           MOVE LN-ORGST    TO SP-ORGST.
           MOVE LN-SPRCLASS TO SP-SPRCLASS.
           MOVE LN-SUBCLASS TO SP-SUBCLASS.
           MOVE LN-LAWCODE  TO SP-LAWCODE.
           PERFORM GET-SP.
           IF IO-FG NOT = 0
              MOVE " INVALID STATE PARAMETER RECORD" TO MESS
              PERFORM SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.
           MOVE SP-ERNDELQFRMLA TO SAVE-ERNDELQFRMLA.

           MOVE LN-CLASS TO LC-CODE.
           PERFORM GET-LC.
           IF IO-FG NOT = 0
              MOVE " INVALID LOAN CLASS RECORD" TO MESS
              PERFORM SEND-MESS
              GO TO END-ROUTINE.

           MOVE LN-OWNBR TO BR-NO.
           PERFORM GET-BR.
           IF IO-FG NOT = 0
              MOVE " INVALID BRANCH RECORD" TO MESS
              GO TO END-ROUTINE.

           PERFORM GET-GPENV.
           IF IO-FG NOT = 0
              MOVE " NO GLOBAL PARAMETER RECORD FOUND" TO MESS
              PERFORM SEND-MESS
              GO TO END-ROUTINE.

      * NEED FOR LCAS ROUTINES (REPLACES GLOBRD)
           PERFORM OPEN-GB-FILE.
           MOVE GB-PATH-OWNBR TO GB-BRNO.
           MOVE 1             TO GB-NO.
           PERFORM READ-GB-FILE.
           PERFORM CLOSE-GB-FILE.
           IF IO-BAD
              MOVE " NO GLOBAL RECORD " TO MESS
              PERFORM SEND-MESS
              GO TO END-ROUTINE.

      * INITIALIZE-MAKER-CD:
           MOVE "M" TO MAKER-CD.
           IF BORROWER-KEY = LN-SSNO(1)
              MOVE LN-MAKERCD(1) TO MAKER-CD
           ELSE
           IF BORROWER-KEY = LN-SSNO(2)
              MOVE LN-MAKERCD(2) TO MAKER-CD
           ELSE
           IF BORROWER-KEY = LN-SSNO(3)
              MOVE LN-MAKERCD(3) TO MAKER-CD
           ELSE
           IF BORROWER-KEY = LN-SSNO(4)
              MOVE LN-MAKERCD(4) TO MAKER-CD.

      * DISPLAY-LP-RECORDS:
           MOVE " "       TO HOLD1-KEY-DOWN.
           MOVE "Y"       TO FULL-PAGE.

      * MUST BE THIS BECAUSE LP-PATH-OWNBR IS NOT SET YET
           MOVE LN-OWNBR  TO LP-BRNO.
           MOVE LN-ACCTNO TO LP-ACCTNO.
           MOVE 99999     TO LP-SEQNO.
           MOVE LP1-KEY   TO HOLD2-KEY-UP.

           PERFORM DISPLAY-ENTRY-UP.

           MOVE "Y" TO FIRST-TIME.

           PERFORM SELECTION-MODULE.

           GO TO END-ROUTINE.

      ******************************************
       SELECTION-MODULE SECTION.
      ******************************************
           IF FIRST-TIME = "Y"
              MOVE "N" TO FIRST-TIME
              GO TO BAR-ENTRY-HOLD.

      * ENTRY AT BOTTOM OF SCREEN, SEL:
           MOVE "F1-LNNO, F3-MSG, F6-POST, F7-MENU :" TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "E RA060SEL." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "10"
              MOVE MENU-PROG-FORM(4) TO NEW-PROG-FORM
              MOVE 0 TO NEW-PROG-SUB
              MOVE "P" TO ERRCD
              MOVE "2" TO ROUTE-CD
              PERFORM SAVE-SCREEN
              GO TO END-ROUTINE.
           IF VDUSTATUS = "1>"
              DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN 
      *       DESTROY LONIF-SCREEN
              DESTROY ALL CONTROLS
              PERFORM MENU-SELECTION
              MOVE 0 TO ELE
              PERFORM SAVE-SCREEN
              IF MENU-FG = 99
                 GO TO SELECTION-MODULE
              ELSE
                 GO TO SELECTION-MODULE-EXIT.
           IF VDUSTATUS = "16"
              PERFORM ENTER-MESSAGE-ROUTINE.
           IF VDUSTATUS = "1<"
              GO TO BAR-ENTRY-HOLD.

           GO TO SELECTION-MODULE.

      *************************************************
      *    ENTRY BAR ROUTINE
      *************************************************
       BAR-ENTRY-HOLD.
           MOVE LN-ACCERN(1) TO HOLD-RV-ACCERN(1).
           MOVE LN-ACCERN(2) TO HOLD-RV-ACCERN(2).
           MOVE LN-ACCERN(3) TO HOLD-RV-ACCERN(3).
           MOVE LN-ACCERN(4) TO HOLD-RV-ACCERN(4).
           MOVE LN-ACCERN(5) TO HOLD-RV-ACCERN(5).
           MOVE LN-ACCERN(6) TO HOLD-RV-ACCERN(6).

       BAR-ENTRY-ROUTINE.
           MOVE SAVE-ERNDELQFRMLA TO SP-ERNDELQFRMLA.

           MOVE MONTH-DATE TO SAVE-MONTH-DATE.

           PERFORM RESET-ENTRY-LINE.

      *--{CS}---
           MOVE "Y" TO IPF-FIRST-TIME.


      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * JTG
      * THIS COMPUTE AND STORE OF UNEARNED NUMBERS IS DONE FOR
      *      REVERSAL OF BALANCE FORWARD ON NORMAL CONVERSIONS
      *      WILL BE USED IN NORMAL-CONV-DS-UPD-REV
      *      AND NORMAL-CONV-TY-UPD-REV
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           PERFORM COMPUTE-EARNINGS.
           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 6
               MOVE EARN-UNEARN(SUB) TO HOLD-RV-UNEARN(SUB)
           END-PERFORM.
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

           MOVE 0 TO LN-ACCERN(1) LN-ACCERN(2) LN-ACCERN(3)
                     LN-ACCERN(4) LN-ACCERN(5) LN-ACCERN(6).
           MOVE 0 TO HOLD-LN-ERN-IB-PDTH-DATE
                     HOLD-LN-ERN-IB-PRINBAL
                     HOLD-LN-ERN-IB-INTOWE.
           MOVE LN-ANTICADJ(1) TO HOLD-LN-REBINT.


           IF LN-MESSAGE NOT = HOLD-LN-MESSAGE
              MOVE LN-MESSAGE TO HOLD-LN-MESSAGE
              MOVE "S  A300MESSAGE." TO VDU
              MOVE LN-MESSAGE TO VDUBUF
              PERFORM SCREENIO.

      *-----------------------------------
      *    BAR DATE ENTRY
      *-----------------------------------
       BAR-DATE-ENTRY.
           MOVE " " TO REVERSE-FLAG.

           IF IBPC-FG = "I"
              PERFORM ALARM
              PERFORM ALARM
              MOVE LEGEND-1 TO LEGEND
           ELSE
              IF GP-POST-XX-BF-PAYMENTS = "Y"
                 MOVE
           "F4, F6-DELETE,F7-NEW LOAN #,ENTER DATE OF LAST PAYMENT:"
                                                    TO LEGEND
              ELSE
                 MOVE
           "F6-DELETE,F7-NEW LOAN #,ENTER DATE OF LAST PAYMENT:"
                                                    TO LEGEND.


           PERFORM SEND-LEGEND.
           MOVE "EN N060010." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "18"
              IF GP-POST-XX-BF-PAYMENTS = "Y"
                 PERFORM FIND-NEXT-PAYMENT-SEQNO
                 IF NOT( NEXT-NEW-LP-SEQNO = 1 AND BF-EXISTS-FG = "Y")
                    PERFORM CALL-PMMAKE-ROUTINE
                    GO TO BAR-DATE-ENTRY.

           IF VDUSTATUS = "1<"
              MOVE "S  A020020." TO VDU
              MOVE "DL" TO LP-TRCD HOLD-TRCD
              PERFORM SCREENIO
              GO TO REVERSAL-ROUTINE.

           IF VDUSTATUS = "1>"
      *       CALL FRESET USING STAT
              MOVE MENU-PROG-FORM(4) TO NEW-PROG-FORM
              MOVE 0 TO NEW-PROG-SUB
              MOVE "P" TO ERRCD
              MOVE "2" TO ROUTE-CD
              PERFORM SAVE-SCREEN
              GO TO END-ROUTINE.

           IF VDUSTATUS NOT = "00"
              GO TO BAR-DATE-ENTRY.

           MOVE VDUNUM0 TO DATE-MMDDYY.
           PERFORM CONVERT-MMDDYY-TO-YYYYMMDD.
           MOVE DATE-YYYYMMDD TO HOLD-LP-PAYDATE NUM-DATE.

           IF HOLD-LP-PAYDATE = 0
              GO TO BAR-DATE-ENTRY.

           PERFORM TSTDAT.
           IF ( NUM-DATE = 0 )
              GO TO BAR-DATE-ENTRY.

           IF HOLD-LP-PAYDATE < LN-LOANDATE
              MOVE " INVALID, PRIOR TO LOAN DATE" TO MESS
              PERFORM SEND-MESS
              GO TO BAR-ENTRY-ROUTINE.

        VERIFY-LP1-RECORD.
      *10/03/06 WE NOW ALLOW CONVERSION HISTORY TO BE ENTERED PRIOR TO
      *BF... FIND NEXT GETS THE NEXT PAYMENT SEQUENCE TO BE USED
           PERFORM FIND-NEXT-PAYMENT-SEQNO.
           IF BF-EXISTS-FG NOT = SPACES
              MOVE "BF ALREADY EXISTS ON ACCOUNT" TO MESS
              PERFORM SEND-MESS
              GO TO BAR-ENTRY-ROUTINE.

           MOVE SAVE-LP1-KEY    TO LP1-KEY.
           MOVE HOLD-LP-PAYDATE TO LP-PAYDATE.

           IF GP-POST-XX-BF-PAYMENTS NOT = "Y"
              IF LP-SEQNO NOT = 1
                 MOVE "BALANCE FORWARD RECORD ALREADY EXISTS!" TO MESS
                 PERFORM SEND-MESS
                 GO TO BAR-ENTRY-ROUTINE.


      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    NOTE:
      *          AT THIS POINT IN THE INPUT SCHEME LP-PAYDATE
      *          MAY NOT BE A DATE-PAID-LAST, THE ACCOUNT COULD
      *          BE A NEW ACCOUNT WITH LN-CURBAL = LN-LNAMT
      *          AND SINCE LN-CURBAL INPUT HAS NOT OCCURED YET
      *          IT IS UNKNOWN.
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * SET IBPC STATUS:
           MOVE LP-PAYDATE TO LN-DATE-PAID-LAST.
           MOVE TRANS-DATE TO IBPC-DATE.
           PERFORM IBPC-TEST.

      *********************************************
      *    THE CONVERSION PROGRAM WILL ONLY ALLOW
      *    A BALANCE FORWARD LINE (BF)
      *********************************************
           MOVE "S  A020020." TO VDU.
           MOVE "BF" TO VDUBUF
                        LP-TRCD
                        HOLD-TRCD.
           PERFORM SCREENIO.

           IF LN-CURBAL = 0
              IF BR-INS-ADDON = "Y" OR "O"
                 PERFORM UPDATE-ADDON-FIELDS
                 PERFORM UPDATE-PAYSCH-FIELDS
                 MOVE LN-SUM-ORGTERM TO D-TERM
                 MOVE LN-SUM-LNAMT   TO D-LNAMT
                 MOVE LN-SUM-FINCHG  TO D-FINCHG
                 IF GP-INCL-OTH-IN-EARNED-N
                    ADD LN-ANTICERN(1) LN-ANTICERN(2) LN-ANTICERN(3)
                        LN-ANTICERN(4) LN-ANTICERN(5)
                                                  GIVING D-NEW-ANTIC
                 ELSE
                 IF (GP-INCL-OTH-IN-EARNED-R)
                    ADD LN-ANTICERN(1) LN-ANTICERN(2) LN-ANTICERN(3)
                        LN-ANTICERN(5)
                                                  GIVING D-NEW-ANTIC
                 ELSE
                    ADD LN-ANTICERN(1) LN-ANTICERN(2) LN-ANTICERN(3)
                        LN-ANTICERN(4) LN-ANTICERN(5) LN-ANTICERN(6)
                                                  GIVING D-NEW-ANTIC
                 END-IF

                 MOVE ADDON-BUFFER TO WR-BUF
                 MOVE ADDON-LIST TO WR-LIST
                 PERFORM CALL-WRFORM.

      *-----------------------------------
      *    BAR REFNO ENTRY
      *-----------------------------------
       BAR-REF-ENTRY.
           MOVE "F1, ENTER LAST PAYMENT REFERENCE, EX. CK:" TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "E  A050030." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO BAR-DATE-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO BAR-REF-ENTRY.
           MOVE VDUBUF TO LP-REFNO.

      *-----------------------------------
      *    BAR AMT ENTRY
      *-----------------------------------
       BAR-AMT-ENTRY.
           MOVE "SN S052040." TO VDU.
           MOVE LN-REGPYAMT TO VDUNUM2.
           PERFORM SCREENIO.

           MOVE "F1, ENTER AMOUNT OF LAST PAYMENT BY BORROWER:"
                                                        TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNS052040." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO BAR-REF-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO BAR-AMT-ENTRY.
           MOVE VDUNUM2 TO LP-TRAMT.
           IF LP-TRAMT < 0
              GO TO BAR-AMT-ENTRY.
           GO TO BAR-INT-ENTRY.

      *-----------------------------------------
      *    BAR OTH ENTRY
      *-----------------------------------------
       BAR-OTH-ENTRY.
           MOVE "F1, ENTER AMOUNT APPLIED TO OTHER CHARGES, MEMO ONLY:"
                                                            TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNS042050." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO BAR-AMT-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO BAR-OTH-ENTRY.
           MOVE VDUNUM2 TO LP-APOTH.

      *-----------------------------------------
      *    BAR INT ENTRY
      *-----------------------------------------
       BAR-INT-ENTRY.
           MOVE "F1, ENTER AMT APPLIED TO INT. AND/OR LCHG, MEMO ONLY:"
                                                            TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNS042060." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO BAR-OTH-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO BAR-INT-ENTRY.
           IF IBPC-FG = "P"
              MOVE VDUNUM2 TO LP-APLC
           ELSE
              MOVE VDUNUM2 TO LP-APINT.

      *-----------------------------------------
      *    BAR PRIN ENTRY
      *-----------------------------------------
       BAR-PRIN-ENTRY.
           MOVE "F1, ENTER AMT APPLIED TO PRINCIPAL, MEMO ONLY:"
                                                            TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNS052070." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO BAR-INT-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO BAR-PRIN-ENTRY.
           MOVE VDUNUM2 TO LP-APCUR.
           IF LP-APCUR = 0
              COMPUTE LP-APCUR =
                  LP-TRAMT - LP-APOTH - LP-APOT2 - LP-APINT - LP-APLC
              MOVE "SN S052070." TO VDU
              MOVE LP-APCUR TO VDUNUM2
              PERFORM SCREENIO.

      * VERIFY APPLIED TO PRIN:
           COMPUTE PRIN-WORKER =
                   LP-TRAMT - LP-APOTH - LP-APLC - LP-APINT.
           IF PRIN-WORKER NOT = LP-APCUR
              MOVE " OUT-OF-BALANCE ENTRY" TO MESS
              PERFORM SEND-MESS
              GO TO BAR-PRIN-ENTRY.

           GO TO BAR-PRINBAL-ENTRY.

      *-----------------------------------------
      *    BAR OTH/OT2 BALANCE ENTRY
      *-----------------------------------------
       BAR-OTHBAL-OT2BAL-ENTRY.
           MOVE LP-OTHBAL TO MSCBAL-NUM1.
           MOVE LP-OT2BAL TO MSCBAL-NUM2.
           MOVE "O" TO MSCBAL-TYPE.
           PERFORM MSCBAL-WINDOW.
           MOVE MSCBAL-NUM1 TO LP-OTHBAL.
           MOVE MSCBAL-NUM2 TO LP-OT2BAL.
      * OTHBAL + OT2BAL IS DISPLAYED
           MOVE "SNNS052090." TO VDU.
           MOVE MSCBAL-NUM3 TO VDUNUM2.
           PERFORM SCREENIO.
           IF MSCBAL-STATUS = "1U"
              GO TO BAR-PRIN-ENTRY.

      *-----------------------------------------
      *    BAR INT/LC BALANCE ENTRY
      *-----------------------------------------
       BAR-INTBAL-LCBAL-ENTRY.
           MOVE LP-INTBAL TO MSCBAL-NUM1.
           MOVE LP-LCBAL TO MSCBAL-NUM2.
           MOVE "I" TO MSCBAL-TYPE.
           PERFORM MSCBAL-WINDOW.
           MOVE MSCBAL-NUM1 TO LP-INTBAL.
           MOVE MSCBAL-NUM2 TO LP-LCBAL.
      * INTBAL + LCBAL IS DISPLAYED
           MOVE "SNNS042100." TO VDU.
           MOVE MSCBAL-NUM3 TO VDUNUM2.
           PERFORM SCREENIO.
           IF MSCBAL-STATUS = "1U"
              GO TO BAR-OTHBAL-OT2BAL-ENTRY.

      *-----------------------------------------
      *    BAR PRINCIPAL BALANCE ENTRY
      *-----------------------------------------
       BAR-PRINBAL-ENTRY.
           MOVE "F1, ENTER THE PRINCIPAL BALANCE:" TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNN062110." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO BAR-INTBAL-LCBAL-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO BAR-PRINBAL-ENTRY.
           MOVE VDUNUM2 TO LP-CURBAL.
           IF LP-CURBAL = 0
              MOVE "ARE YOU SURE THE LOAN IS PAID OFF????" TO MESS
              PERFORM SEND-MESS.

           IF LP-CURBAL > (LN-SUM-LNAMT + LP-OT2BAL)
              MOVE "PRIN BALANCE CAN'T BE GREATER THAN LOAN AMOUNT"
                                                          TO MESS
              PERFORM SEND-MESS
              GO TO BAR-PRINBAL-ENTRY.
           IF LP-OT2BAL NOT = 0
              IF LP-CURBAL < (LP-OT2BAL + 0.01)
                 MOVE
                 "PRIN BALANCE MUST BE GREATER THAN OTHER 2 BALANCE"
                                                          TO MESS
                 PERFORM SEND-MESS
                 GO TO BAR-PRINBAL-ENTRY.

           IF LN-SERVACCT = "Y"
              GO TO ENTER-TOTEXCPAYMNTD.

      * BAH 090198  COMMENTED OUT FOLLOWING IF , BIG APPLE LOGIC
      * FREEDOM ACCT 1823  ADDON 378.54  ORIG LNAMT 5048.10 CURBAL 335.03
      *   AT THIS POINT LN-PURBAL = 5048.10 (ORIG LNAMT)
      *   SO THE NEXT IF STOPS ME...  LN-SUM-LNAMT = 5048.10 + 378.54
      *                                 - 335.03 = 5091.61 WHICH IS
      *                               GREATER THAN LN-PURBAL
      * I DONT GET IT !!!!!!!
      *
      *    COMPUTE PRIN-WORKER = LN-SUM-LNAMT - LP-CURBAL.
      *    IF LN-PURBAL < PRIN-WORKER
      *       MOVE "CAN'T POST, ACCOUNT WILL BE BELOW PURCHASE BAL"
      *                                                       TO MESS
      *       PERFORM SEND-MESS
      *       GO TO BAR-PRINBAL-ENTRY.

      *-----------------------------------------
      *    LAST ACCRUED DATE ENTRY
      *-----------------------------------------
       ENTER-LAST-ACCRUED-DATE.
           IF SP-ERNDELQFRMLA = " "
              IF VDUSTATUS = "1U"
                 GO TO BAR-PRINBAL-ENTRY
              ELSE
                 GO TO ENTER-TOTEXCPAYMNTD.

           MOVE SP-ERNDELQFRMLA TO SAVE-ERNDELQFRMLA.
           MOVE " " TO SP-ERNDELQFRMLA.

           MOVE "ENTER LAST DATE EARNINGS WERE TAKEN (MONTH END)"
                                                          TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "S  A100MEND-P:S." TO VDU.
           MOVE "LAST EARN:" TO VDUBUF.
           PERFORM SCREENIO.

           MOVE "ERNM060MONTHEND." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              MOVE SAVE-ERNDELQFRMLA TO SP-ERNDELQFRMLA
              GO TO BAR-PRINBAL-ENTRY.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              MOVE SAVE-ERNDELQFRMLA TO SP-ERNDELQFRMLA
              GO TO ENTER-LAST-ACCRUED-DATE.
           IF VDUNUM0 = 0
              MOVE SAVE-ERNDELQFRMLA TO SP-ERNDELQFRMLA
              GO TO ENTER-LAST-ACCRUED-DATE.
           MOVE VDU-DATE-YYYYMMDD TO SAVE-MONTH-DATE
                                     NUM-DATE
                                     NDTE-DATE.
      * MOVE 33 TO GET LAST DAY OF MONTH
           MOVE 33 TO NDTE-DD.
           PERFORM NEW-DATE-CALCULATION.
           MOVE NDTE-DATE TO NUM-DATE SAVE-MONTH-DATE.
           MOVE "S  8080MONTHEND." TO VDU.
           MOVE SAVE-MONTH-DATE TO VDU-DATE-YYYYMMDD.
           PERFORM SCREENIO.

      *----------------------------------------------
      *    TOTAL EXCEPTION PAYMENTS ENTRY
      *----------------------------------------------
       ENTER-TOTEXCPAYMNTD.
           MOVE LEGEND-2-WORLD TO LEGEND.
           PERFORM SEND-LEGEND.

           MOVE "ENNN062H99." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO ENTER-LAST-ACCRUED-DATE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-TOTEXCPAYMNTD.
           MOVE VDUNUM2 TO HOLD-LN-MTD-PAYS-RECDEL.

      *----------------------------------------------
      *    LCPAID OR PRIINT (PRIOR INTEREST) ENTRY
      *----------------------------------------------
       ENTER-LCPAID-OR-PRIINT.
           IF SP-LCFRMLA = "F" OR "H" OR "I" OR "L" OR "M" OR "P"
                           OR "S" OR "T"
              MOVE 0 TO HOLD-LN-LCPAID
                        HOLD-LN-LCPARTIALS
                        HOLD-PRIINTPD
              PERFORM SET-LCFRMLA-FHILM-INFO
              GO TO ENTER-INT-PRIOR-OR-LYR.

           IF IBPC-FG = "I" AND SP-LCFRMLA = " "
              MOVE "ENTER: PRIOR YEARS (1098 ONLY) INTEREST PAID"
                                                         TO LEGEND
           ELSE
           IF SP-LCFRMLA NOT = "A"
              MOVE
              "ENTER: LATE CHARGES PAID, SINCE CONTRACTUALLY CURRENT"
                                                      TO LEGEND
           ELSE
              MOVE "ENTER: PARTIAL LATE CHARGES PAID" TO LEGEND.
           PERFORM SEND-LEGEND.

           MOVE "ENNS052H11." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              MOVE SAVE-ERNDELQFRMLA TO SP-ERNDELQFRMLA
              GO TO ENTER-TOTEXCPAYMNTD.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-LCPAID-OR-PRIINT.
           IF IBPC-FG = "I" AND SP-LCFRMLA = " "
              MOVE 0 TO HOLD-LN-LCPAID
                        HOLD-LN-LCPARTIALS
              MOVE VDUNUM2 TO HOLD-PRIINTPD
           ELSE
              IF SP-LCFRMLA NOT = "A"
                 MOVE 0 TO HOLD-PRIINTPD
                           HOLD-LN-LCPARTIALS
                 MOVE VDUNUM2 TO HOLD-LN-LCPAID LP-LCPAID
              ELSE
                 MOVE 0 TO HOLD-PRIINTPD
                           HOLD-LN-LCPAID
                 MOVE VDUNUM2 TO HOLD-LN-LCPARTIALS.

      *-----------------------------------------
      *    INTEREST PAID PRIOR OR LAST YEAR ENTRY
      *-----------------------------------------
       ENTER-INT-PRIOR-OR-LYR.
           IF IBPC-FG = "I" AND SP-LCFRMLA = " "
              MOVE
              "ENTER: PRIOR (1098 ONLY) INTEREST PAID BY BORROWER"
                                                    TO LEGEND
           ELSE
              MOVE
              "ENTER: LAST YEAR (1098 ONLY) INTEREST PAID BY BORROWER"
                                                    TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNS052H12." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              IF NOT (SP-LCFRMLA = "F" OR "H" OR "I"
                                OR "L" OR "M" OR "P" OR "S" OR "T")
                 GO TO ENTER-LCPAID-OR-PRIINT
              ELSE
                 MOVE SAVE-ERNDELQFRMLA TO SP-ERNDELQFRMLA
                 GO TO ENTER-TOTEXCPAYMNTD.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-INT-PRIOR-OR-LYR.

           IF IBPC-FG = "I" AND SP-LCFRMLA = " "
              MOVE VDUNUM2 TO HOLD-PRIINTPD
              MOVE 0 TO HOLD-LN-LYRINTPD
           ELSE
              MOVE VDUNUM2 TO HOLD-LN-LYRINTPD.

      *-----------------------------------------
      *    THIS YEAR INTEREST PAID ENTRY
      *-----------------------------------------
       ENTER-INT-THIS-YR.
           MOVE
           "ENTER: THIS YEAR (1098 ONLY) INTEREST PAID BY BORROWER"
                                                           TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNS052H13." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO ENTER-INT-PRIOR-OR-LYR.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-INT-THIS-YR.
           MOVE VDUNUM2 TO HOLD-LN-YTDINTPD.

      *-----------------------------------------
      *    TODATE $ DEFERMENTS ENTRY
      *-----------------------------------------
        ENTER-TOTDFMNTS.
           MOVE "ENTER: $ AMOUNT OF DEFERMENTS COLLECTED TODATE"
                                                          TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNN062H14." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO ENTER-INT-THIS-YR.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-TOTDFMNTS.
           MOVE VDUNUM2 TO HOLD-LN-TOTDEF.

      *-----------------------------------------
      *    TODATE # DEFERMENTS ENTRY
      *-----------------------------------------
       ENTER-DEFMNTS.
           MOVE "ENTER: # OF DEFERMENTS GRANTED TODATE" TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNN020H15." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO ENTER-TOTDFMNTS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-DEFMNTS.
           MOVE VDUNUM0 TO HOLD-LN-TOTNODEF.

      *-----------------------------------------
      *    TODATE # ALLOWABLE DELINQUENCY ENTRY
      *-----------------------------------------
       ENTER-ALDEL.
           IF BR-ALDEL-FLAG NOT = "Y"
              GO TO ENTER-LAST-FULL-PMT-MMYY.
           MOVE "ENTER: # OF ALLOWABLE DELINQUENCY GRANTED TODATE"
                                                            TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNN020H151." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              GO TO ENTER-DEFMNTS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-ALDEL.
           MOVE VDUNUM0 TO HOLD-LN-TOTNOALDEL.

       ENTER-LAST-FULL-PMT-MMYY.
           IF SP-BANKRULE NOT = "D" AND SP-BANKRULE NOT = "F"
              GO TO ENTER-TOTINT-COLLECTED.

           MOVE "ENTER: LAST FULL PMT MONTH-YEAR" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "ENNN040H152." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              IF BR-ALDEL-FLAG = "Y"
                 GO TO ENTER-ALDEL
              ELSE
                 GO TO ENTER-DEFMNTS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-LAST-FULL-PMT-MMYY.

           MOVE VDUNUM0 TO DATE-MMYY.
           PERFORM CONVERT-MMYY-TO-MMDDYY.
           PERFORM CONVERT-MMDDYY-TO-YYYYMM.
           MOVE DATE-YYYYMM TO LN-PY-YYYYMM-RECDEL HOLD-YYYYMM.

           IF DATE-MMYY = 0
              GO TO ENTER-TOTINT-COLLECTED.

           MOVE HOLD-YYYYMM TO DATE-YYYYMM.
           MOVE DATE-YYYYMM-MM   TO DATE-YYYYMMDD-MM.
           MOVE ZEROES           TO DATE-YYYYMMDD-DD.
           MOVE DATE-YYYYMM-YYYY TO DATE-YYYYMMDD-YYYY.
           IF DATE-YYYYMMDD < LN-LOANDATE
              MOVE "PAYMENT DATE MUST BE = OR GREATER THAN LOAN DATE"
                                                              TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-LAST-FULL-PMT-MMYY.

           IF HOLD-MM = 0 OR HOLD-MM > 12
              MOVE "PLEASE ENTER VALID MONTH/YEAR OR 0 FOR NONE"
                                                         TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-LAST-FULL-PMT-MMYY.

      *-----------------------------------------
      *    IB INTEREST COLLECTED ENTRY
      *-----------------------------------------
       ENTER-TOTINT-COLLECTED.
           MOVE 0 TO HOLD-LN-TOTLCHG
                     HOLD-LN-TOTINT.
           IF IBPC-FG = "P"
              IF SP-LCFRMLA = " "
                 GO TO COMPUTE-TOTPAYMNTD
              ELSE
                 GO TO ENTER-TOTLCHG.

           MOVE "S  A000B3:S." TO VDU.
           MOVE "IB-INT-COLL" TO VDUBUF.
           PERFORM SCREENIO.

           MOVE
           "ENTER: TOTAL IB INTEREST COLLECTED (EXCLUDING DEFERMENTS)"
                                                             TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNN052H16." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              IF SP-BANKRULE = "D"
                 GO TO ENTER-LAST-FULL-PMT-MMYY
              ELSE
              IF BR-ALDEL-FLAG = "Y"
                 GO TO ENTER-ALDEL
              ELSE
                 GO TO ENTER-DEFMNTS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-TOTINT-COLLECTED.
           MOVE VDUNUM2 TO HOLD-LN-TOTINT.
           IF SP-LCFRMLA = " "
              GO TO COMPUTE-TOTPAYMNTD.

      *-----------------------------------------
      *    TOTAL LATE CHARGES ENTRY
      *-----------------------------------------
       ENTER-TOTLCHG.
           MOVE "ENTER: TOTAL LATE CHARGES COLLECTED " TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNN062H17." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              IF IBPC-FG NOT = "P"
                 GO TO ENTER-TOTINT-COLLECTED
              ELSE
              IF SP-BANKRULE = "D"
                 GO TO ENTER-LAST-FULL-PMT-MMYY
              ELSE
              IF BR-ALDEL-FLAG = "Y"
                 GO TO ENTER-ALDEL
              ELSE
                 GO TO ENTER-DEFMNTS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-TOTLCHG.
           MOVE VDUNUM2 TO HOLD-LN-TOTLCHG.

      *-----------------------------------------
      *    COMPUTE TOTPAYMNTD
      *-----------------------------------------
       COMPUTE-TOTPAYMNTD.
           COMPUTE HOLD-LN-TOTPAYMNTD =
                          LN-SUM-LNAMT - LP-CURBAL + LP-OT2BAL.
      * ALWAYS ADD INTEREST
           ADD HOLD-LN-TOTINT TO HOLD-LN-TOTPAYMNTD.
           SUBTRACT HOLD-LN-REBINT FROM HOLD-LN-TOTPAYMNTD.

      * SUBTRACT EXCEPTION PAYMENTS:
           SUBTRACT HOLD-LN-TOTEXCPAYMNTD
                                       FROM HOLD-LN-TOTPAYMNTD.

      * CHECK CONTRACTUAL FORMULA FOR LATE CHARGES
           IF SP-CONTRFRMLA = "A"
              ADD HOLD-LN-TOTLCHG TO HOLD-LN-TOTPAYMNTD.
           MOVE HOLD-LN-TOTPAYMNTD TO LN-TOTPAYMNTD.
           MOVE "SNNS052H10." TO VDU.
           MOVE HOLD-LN-TOTPAYMNTD TO VDUNUM2.
           PERFORM SCREENIO.

           IF HOLD-LN-TOTPAYMNTD < 0
              PERFORM NEGATIVE-HOLD-LN-TOTPAYMNTD.

      *-{CS}---------------------------------------------
           IF BULK-CONVERSION-FG = "B"
      *-NEED TO MAKE WORK FOR DIRECT LOAN
              IF LN-SALEFIN NOT = "N"
                 IF LP-CURBAL NOT = 0
                    IF LN-SERVACCT NOT = "Y"
                       PERFORM INPUT-PURCHASE-FIELDS.
      *--{CS}-------------------------------------------------------

      *---------------------------------------------------
      *    COMPUTE LOAN COSTS FOR AMORTIZATION
      *    NOTE:
      *          THIS HAS BEEN STARRED OUT SINCE ASSOCIATED
      *          COSTS FROM A PURCHASE ARE REALIZED
      *          DIFFERENTLY
      *                         PER JIM R.
      *---------------------------------------------------
      *    COMPUTE LOAN COST EXCEPT FOR SP-LNCOST-FRMLA (D)
      *-------------------------------------------------------------
      *    IF SP-LNCOST-FRMLA NOT = "D"
      *       MOVE LN-LNAMT      TO LNCOST-LNAMT
      *       MOVE LN-DLPARVHELD TO LNCOST-DLPARVHELD
      *       PERFORM COMPUTE-LOANCOST
      *       MOVE LNCOST-LOANCOST TO LN-ANTICERN(6).
      *-------------------------------------------------------------
           IF SP-ERNFRMLA(5) NOT = 0
              IF SP-DLDISC-CONV-BF-PCNT NOT = 0
                IF (LN-PLDATE = 0 AND LN-ACCELDATE = 0)
                COMPUTE LN-ANTICERN(5)  ROUNDED =
                   LP-CURBAL * SP-DLDISC-CONV-BF-PCNT / 100.

      *-----------------------------------------
      *    COMPUTE LN-UFERN AND LN-ACCERN
      *-----------------------------------------
      *--{CS} IF USING THE BULK-PURCHASE OPTION NO UPFRONT EARNINGS ARE TAKEN
      * TO REMAIN CONSISTANT WITH THE TP TRANSACTIONS
           IF BULK-CONVERSION-FG = "B"
      *       IF GP-I-AM-FINAUTO
      *          PERFORM COMPUTE-UERNINGS
      *       ELSE
                 PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 6
                     MOVE 0 TO UERN-EARNINGS(SUB)
                 END-PERFORM
           ELSE
              PERFORM COMPUTE-UERNINGS.

           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 6
              IF UERN-EARNINGS(SUB) < 0
                 MOVE 0 TO UERN-EARNINGS(SUB)
              END-IF
              MOVE UERN-EARNINGS(SUB) TO LN-UFERN(SUB)
                                         LN-ACCERN(SUB)
              MOVE SP-EARN-ORDER(SUB) TO LN-EARN-ORDER(SUB)
              MOVE 0 TO AERN-EARNINGS(SUB)
                        CERN-EARNINGS(SUB)
           END-PERFORM.

           MOVE LN-ERNDELQ-STOP      TO HOLD-LN-ERNDELQ-STOP.
           MOVE LN-LAST-ACCRUAL-DATE TO HOLD-LN-LAST-ACCRUAL-DATE.

           IF LN-SERVACCT = "Y"
              GO TO ENTER-CREDIT.

           IF ( (LN-JDDATE NOT = 0)    AND SP-ERNJD-CD = " "    ) OR
              ( (LN-ACCELDATE NOT = 0) AND SP-ERNACCEL-CD = " " )
      * CLOSE OUT ALL EARNINGS:
              PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 6
                 MOVE LN-ANTICERN(SUB) TO LN-ACCERN(SUB)
              END-PERFORM
              SUBTRACT HOLD-LN-REBINT FROM LN-ACCERN(1)
           ELSE
      * TEST FOR REBATED COMPONENT
              IF LN-INT-REBATE NOT = " "
                 COMPUTE LN-ANTICERN(1) =
                     LN-ANTICERN(1) - LN-ANTICADJ(1)
                 MOVE LN-ANTICERN(1) TO LN-ACCERN(1)
              END-IF
              IF LN-SC-REBATE NOT = " "
                 COMPUTE LN-ANTICERN(3) =
                     LN-ANTICERN(3) - LN-ANTICADJ(3)
                 MOVE LN-ANTICERN(3) TO LN-ACCERN(3)
              END-IF
              IF LN-MF-REBATE NOT = " "
                 COMPUTE LN-ANTICERN(4) =
                     LN-ANTICERN(4) - LN-ANTICADJ(4)
                 MOVE LN-ANTICERN(4) TO LN-ACCERN(4)
              END-IF
              MOVE 0 TO HOLD-LN-ACCERN
              IF BULK-CONVERSION-FG NOT = "B"
                 MOVE 1 TO CERN AERN
                 PERFORM WHICH-METHOD 6 TIMES
                 IF SP-ERNFRMLA(1) = 15
                    PERFORM EARN15-INPUT
                 END-IF
                 IF SP-ERNFRMLA(5) = 16
                    PERFORM EARN16-INPUT.

           MOVE SAVE-ERNDELQFRMLA TO SP-ERNDELQFRMLA.
           MOVE LN-ERNDELQ-STOP   TO AERN-ERNDELQ-STOP.
           IF MONTH-DATE > SAVE-MONTH-DATE
              MOVE "Y" TO AERN-ERNDELQ-STOP
           ELSE
              MOVE " " TO AERN-ERNDELQ-STOP.

           IF GP-INCL-OTH-IN-EARNED-N
              ADD LN-ANTICERN(1) LN-ANTICERN(2) LN-ANTICERN(3)
                  LN-ANTICERN(4) LN-ANTICERN(5)
                                     GIVING HOLD-LN-TOT-ANTIC
           ELSE
           IF GP-INCL-OTH-IN-EARNED-R
              ADD LN-ANTICERN(1) LN-ANTICERN(2) LN-ANTICERN(3)
              LN-ANTICERN(5)
                                     GIVING HOLD-LN-TOT-ANTIC
           ELSE
              ADD LN-ANTICERN(1) LN-ANTICERN(2) LN-ANTICERN(3)
                  LN-ANTICERN(4) LN-ANTICERN(5) LN-ANTICERN(6)
                                     GIVING HOLD-LN-TOT-ANTIC.

           MOVE "SN N062H18." TO VDU.
           MOVE HOLD-LN-TOT-ANTIC TO VDUNUM2.
           PERFORM SCREENIO.

           ADD LN-ACCERN(1) LN-ACCERN(2) LN-ACCERN(3)
               LN-ACCERN(5) GIVING HOLD-LN-ACCERN.

           IF NOT(GP-INCL-OTH-IN-EARNED-N OR GP-INCL-OTH-IN-EARNED-R)
              ADD LN-ACCERN(6) TO HOLD-LN-ACCERN.

           IF NOT (GP-INCL-OTH-IN-EARNED-R)
              ADD LN-ACCERN(4) TO HOLD-LN-ACCERN.

           MOVE "SN N062H19." TO VDU.
           MOVE HOLD-LN-ACCERN TO VDUNUM2.
           PERFORM SCREENIO.
           GO TO ENTER-CREDIT.

       ENTER-ACCERN.

       ENTER-CREDIT.
      ****************************************
      *    ESTABLISH CREDIT LIMIT
      ****************************************
      * PASSED FROM LONIF0

           MOVE LN-CREDITLIM TO HOLD-LN-CREDITLIM.
           MOVE LN-WCBC-CREDITLIM TO HOLD-LN-WCBC-CREDITLIM.
      * IF OPTION IS NOT ACTIVE, DO NOT ENTER FIELD
           IF NOT (BRAVAIL-BUF = "Y" OR "S")
              GO TO DISPLAY-ENTRY-LINE.

      * FLAG OF "W" SAYS ENTER LN-WCBC-CREDITLIM & CALC LN-CREDITLIM
           IF LC-CALC-HI-CREDIT NOT = "W"
              MOVE 0 TO HOLD-LN-WCBC-CREDITLIM
              GO TO SKIP-WCBC-CREDITLIM.

       ENTER-WCBC-CREDITLIM.
           MOVE "ENTER: CUSTOMER WCBC CREDIT LIMIT" TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNN060H20." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              IF SP-LCFRMLA NOT = " "
                 GO TO ENTER-TOTLCHG
              ELSE
              IF IBPC-FG NOT = "P"
                 GO TO ENTER-TOTINT-COLLECTED
              ELSE
              IF SP-BANKRULE = "D" OR SP-RECFRMLA = "P"
                 GO TO ENTER-LAST-FULL-PMT-MMYY
              ELSE
              IF BR-ALDEL-FLAG = "Y"
                 GO TO ENTER-ALDEL
              ELSE
                 GO TO ENTER-DEFMNTS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-WCBC-CREDITLIM.
           MOVE VDUNUM0 TO HOLD-LN-WCBC-CREDITLIM.

           GO TO DISPLAY-ENTRY-LINE.

       SKIP-WCBC-CREDITLIM.
      * IF CALCULATE OPTION, IT WAS COMPUTED IN LONIN0, SO KEEP IT
      * AND DO NOT ENTER FIELD
           IF LC-CALC-HI-CREDIT NOT = "I"
              GO TO DISPLAY-ENTRY-LINE.

           MOVE "ENTER: CUSTOMER CREDIT LIMIT" TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNN060H20." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              IF SP-LCFRMLA NOT = " "
                 GO TO ENTER-TOTLCHG
              ELSE
              IF IBPC-FG NOT = "P"
                 GO TO ENTER-TOTINT-COLLECTED
              ELSE
              IF SP-BANKRULE = "D"
                 GO TO ENTER-LAST-FULL-PMT-MMYY
              ELSE
              IF BR-ALDEL-FLAG = "Y"
                 GO TO ENTER-ALDEL
              ELSE
                 GO TO ENTER-DEFMNTS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO SKIP-WCBC-CREDITLIM.
           MOVE VDUNUM0 TO HOLD-LN-CREDITLIM.

      *-----------------------------------------
           GO TO DISPLAY-ENTRY-LINE.
      *-----------------------------------------

      *********************************************
      *  PAYMENT REVERSAL ROUTINE
      *  (F6 FROM PAYDATE)
      *********************************************
       REVERSAL-ROUTINE.
           MOVE LP-TRCD TO HOLD-TRCD.

           PERFORM OPEN-LP1-FILE.

           MOVE LP-PATH-OWNBR TO LP-BRNO
                                 QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO.
           MOVE LN-ACCTNO     TO LP-ACCTNO
                                 QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           MOVE ALL "9"       TO LP-SEQNO
                                 QLP1-WEND-SEQNO.
           MOVE ALL "0"       TO QLP1-WBEG-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.
       REVERSAL-RTN-CONT.
           PERFORM READ-LP1-FILE-PREVIOUS.
      *    UNLOCK LP-FILE.
           IF IO-BAD OR (LP-BRNO NOT = LP-PATH-OWNBR)
                      OR (LP-ACCTNO NOT = LN-ACCTNO)
              PERFORM NO-RECORDS
              GO TO BAR-ENTRY-ROUTINE.

           IF GP-POST-XX-BF-PAYMENTS NOT = "Y"
              IF LP-SEQNO NOT = 1 OR LP-TRCD NOT = "BF"
                 MOVE "YOU CAN ONLY DELETE A BALANCE FORWARD LINE"
                      TO MESS
              PERFORM SEND-MESS
              GO TO BAR-ENTRY-ROUTINE
              END-IF
           ELSE
              IF LP-TRCD NOT = "BF"
                 MOVE "YOU CAN ONLY DELETE A BALANCE FORWARD LINE"
                      TO MESS
              PERFORM SEND-MESS
              GO TO BAR-ENTRY-ROUTINE.

           MOVE "Y" TO REVERSE-FLAG.
           PERFORM CLOSE-LP1-FILE.

           MOVE LN-LNAMT      TO LN-SUM-LNAMT.
           MOVE LN-FINCHG     TO LN-SUM-FINCHG.
           MOVE LN-INTCHG     TO LN-SUM-INTCHG.
           MOVE LN-SERCHG     TO LN-SUM-SERCHG.
           MOVE LN-EXTCHG     TO LN-SUM-EXTCHG.
           MOVE LN-REGPYAMT   TO LN-SUM-REGPYAMT.
           MOVE LN-ORIGPURAMT TO LN-SUM-ORIGPURAMT.
           COMPUTE LN-SUM-MAINTFEE = LN-MAINTFEE * LN-ORGTERM.
           MOVE " " TO LN-ADDON-FG.
           MOVE 0 TO LN-ANTICERN(2) LN-ANTICADJ(2)
                     LN-UFERN(2)    LN-ACCERN(2).
           MOVE LN-ORGTERM TO LN-SUM-ORGTERM.
           MOVE " " TO LN-PAY-SCHLD-FG.

      *--------------------------------------------
      *    DISPLAY ENTRY LINE
      *--------------------------------------------
       DISPLAY-ENTRY-LINE.
           ADD HOLD-LN-TOTNODEF   TO LN-TOTNODEF.
           ADD HOLD-LN-TOTNOALDEL TO LN-TOTNOALDEL.

           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.
           PERFORM PAID-THRU-CALCULATION.
           MOVE PDTH-DATE-FULL TO LP-PDTH-DATE
                                  HOLD-LP-LCPDTH-DATE
                                  CALCD-LP-LCPDTH-DATE.

           SUBTRACT HOLD-LN-TOTNODEF   FROM LN-TOTNODEF.
           SUBTRACT HOLD-LN-TOTNOALDEL FROM LN-TOTNOALDEL.

           MOVE "SNNN040080." TO VDU.
           MOVE LP-PDTH-DATE TO NUM-DATE.
           IF LN-UNITPER-CD = "D" OR "W" OR "S"
      * DAILY/WEEKLY/SEMI    20180501 DISPLAY 0501 (MMDD)
              MOVE 0 TO NUM-CCYY
              MOVE NUM-DATE TO D-PDTHRU
           ELSE
      * MONTHLY 20180501 DISPLAY 0518 (MMYY)
              MOVE NUM-YR TO NUM-DA
              MOVE 0      TO NUM-CCYY
              MOVE NUM-DATE TO D-PDTHRU.
           MOVE D-PDTHRU TO VDUNUM0.
           PERFORM SCREENIO.

           IF SP-LCFRMLA = " "
              GO TO BYPASS-LCPDTH.

           MOVE "SNNN060H21." TO VDU.
           MOVE HOLD-LP-LCPDTH-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO VDUNUM0.
           PERFORM SCREENIO.

           IF REVERSE-FLAG = "Y"
              GO TO BYPASS-LCPDTH.

      *------------------------------------------
      *    ENTER LATE CHARGE PAID THRU
      *------------------------------------------
       ENTER-LCPDTH.
           MOVE "ENTER LATE CHARGES PAID THRU " TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "ENNN060H21." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF VDUSTATUS = "1U"
              IF (BRAVAIL-BUF = "Y" OR "S")
                             AND (LC-CALC-HI-CREDIT = "I")
                 GO TO ENTER-CREDIT
              ELSE
              IF SP-LCFRMLA NOT = " "
                 GO TO ENTER-TOTLCHG
              ELSE
              IF IBPC-FG NOT = "P"
                 GO TO ENTER-TOTINT-COLLECTED
              ELSE
              IF SP-BANKRULE = "D"
                 GO TO ENTER-LAST-FULL-PMT-MMYY
              ELSE
              IF BR-ALDEL-FLAG = "Y"
                 GO TO ENTER-ALDEL
              ELSE
                 GO TO ENTER-DEFMNTS.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-LCPDTH.
           MOVE VDUNUM0 TO DATE-MMDDYY.
           PERFORM CONVERT-MMDDYY-TO-YYYYMMDD.
           MOVE DATE-YYYYMMDD TO HOLD-LP-LCPDTH-DATE
                                 NUM-DATE.
           PERFORM TSTDAT.
           IF NUM-DATE = 0
              GO TO ENTER-LCPDTH.

      * BAH ADDED 3/3/97, 1STPYDATE OF 3/29/97 WAS CALCING LCPDTH 2/28/97
      * BUT YOU COULD NOT RETURN THRU IT, BECAUSE OF ELAPSED-UNITPER-REM
      * SO SKIP THE TEST, IF YOU JUST PRESSED ENTER
           IF HOLD-LP-LCPDTH-DATE = CALCD-LP-LCPDTH-DATE
              GO TO BYPASS-LCPDTH.

           MOVE LN-UNITPER-CD   TO DATER-UNITPER-CD.
           MOVE LN-UNITPER-FREQ TO DATER-UNITPER-FREQ.
           MOVE LN-1STPYDATE        TO NUM-DATE.
           MOVE HOLD-LP-LCPDTH-DATE TO SYS-DATE.
           PERFORM TIMUPER.
           IF ELAPSED-UNITPER-REM NOT = 0
              MOVE "DATE IS NOT ON A PAY PERIOD CYCLE DATE!!!!"
                                                     TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-LCPDTH.

           IF LP-PDTH-DATE = HOLD-LP-LCPDTH-DATE
              GO TO BYPASS-LCPDTH.

           MOVE LP-PDTH-DATE TO NDTE-DATE.
           MOVE HOLD-LP-LCPDTH-DATE TO SYS-DATE.
           IF SP-LCFRMLA = "D" OR "F" OR "G" OR "K" OR "I" OR
                           "L" OR "M" OR "P" OR "S" OR "T"
              MOVE SYS-DATE TO NUM-DATE
              GO TO ENTER-LCPDTH-TEST-MATURITY.
           IF SP-LCFRMLA = "B" OR "E" OR "J" OR "X"
               MOVE 1 TO NDTE-HOLD
           ELSE
               MOVE -1 TO NDTE-HOLD.
           MOVE LN-UNITPER-CD   TO DATER-UNITPER-CD.
           MOVE LN-UNITPER-FREQ TO DATER-UNITPER-FREQ.
           PERFORM INCREMENT-UNITPER.
      * LEAVE THIS MOVE HERE, NUM-DATE IS USED FURTHER DOWN!!
           MOVE NDTE-DATE TO NUM-DATE.
           IF SYS-DATE = NUM-DATE
              GO TO ENTER-LCPDTH-TEST-MATURITY.

           IF SP-LCFRMLA = "B" OR "J" OR "N"
             MOVE "MUST BE = OR 1 PAYPERIOD AFTER THAN PAID THRU"
                                                         TO MESS
           ELSE
             MOVE "MUST BE = OR 1 PAYPERIOD PRIOR TO PAID THRU"
                                                         TO MESS.
           PERFORM SEND-MESS.
           GO TO ENTER-LCPDTH.

       ENTER-LCPDTH-TEST-MATURITY.
      * MATURITY DATE NEEDS DEFERMENTS...MUST ADD IN
           ADD HOLD-LN-TOTNODEF TO LN-TOTNODEF.
           PERFORM MATURITY-DATE-CALCULATION.
           SUBTRACT HOLD-LN-TOTNODEF FROM LN-TOTNODEF.
           MOVE MDTE-DATE TO SYS-DATE.
           IF SYS-DATE < NUM-DATE
              MOVE "GREATER THAN MATURITY DATE" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-LCPDTH.

      *-----------------------------------------------------
       BYPASS-LCPDTH.
           MOVE SPACES TO LEGEND.
           PERFORM SEND-LEGEND.

           MOVE HOLD-TRCD TO LP-TRCD.
           PERFORM SETUP-LINE.
           PERFORM SEND-ENTRY-LINE.
           IF REVERSE-FLAG = "Y"
              GO TO ACCEPT-ENTRY.

      *-----------------------------------------------------
      *    CHECK IF ACCOUNT IS IN EXPIRATION STATUS
      *-----------------------------------------------------
           PERFORM EXPIRATION-DATE-CALCULATION.
           IF LP-PAYDATE NOT < XDTE-DATE
              MOVE "NOTE: LOAN WILL BE SET AS EXPIRED!" TO MESS
              PERFORM SEND-MESS
              MOVE "Y" TO SET-EXPIRATION-FG
           ELSE
              MOVE "N" TO SET-EXPIRATION-FG.

      *-----------------------------------------------------
      *    ACCEPT ENTRY
      *-----------------------------------------------------
       ACCEPT-ENTRY.
           IF LP-TRCD = "BF"
             MOVE "F1-CANCEL, ^-BACK, 'A'-ACCEPT" TO LEGEND
           ELSE
             MOVE "F1-CANCEL, 'D'-DELETE" TO LEGEND.
           PERFORM SEND-LEGEND.
           MOVE "S  A010120." TO VDU.
           MOVE " " TO VDUBUF.
           PERFORM SCREENIO.

           MOVE "E  A010120." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM IPF-RESET-ORIG-LN
              GO TO BAR-ENTRY-ROUTINE.
           IF LP-TRCD = "BF"
              IF VDUSTATUS = "1U"
                 IF SP-LCFRMLA NOT = " "
                    GO TO ENTER-LCPDTH
                 ELSE
                 IF (BRAVAIL-BUF = "Y" OR "S")
                             AND (LC-CALC-HI-CREDIT = "I")
                    GO TO ENTER-CREDIT
                 ELSE
                 IF IBPC-FG NOT = "P"
                    GO TO ENTER-TOTINT-COLLECTED
                 ELSE
                 IF BR-ALDEL-FLAG = "Y"
                    GO TO ENTER-ALDEL
                 ELSE
                    GO TO ENTER-DEFMNTS.
           IF VDUSTATUS NOT = "00"
              GO TO ACCEPT-ENTRY.

           IF LP-TRCD = "BF"
              IF VDUBUF NOT = "A"
                 MOVE "ENTER: F1, ^-BACK OR 'A'-ACCEPT ONLY" TO MESS
                 PERFORM SEND-MESS
                 GO TO ACCEPT-ENTRY
              ELSE
                 IF HOLD-LN-TOTPAYMNTD < 0
                    PERFORM NEGATIVE-HOLD-LN-TOTPAYMNTD
                    GO TO ACCEPT-ENTRY
                 END-IF
                 MOVE HOLD-LP-LCPDTH-DATE TO LP-LCPDTH-DATE
                 GO TO UPDATE-FILES.

           IF VDUBUF NOT = "D"
              MOVE "ENTER: F1, OR 'D-DELETE' ONLY" TO MESS
              PERFORM SEND-MESS
              GO TO ACCEPT-ENTRY
           ELSE
              GO TO UPDATE-FILES-REVERSE.

           GO TO ACCEPT-ENTRY.

      *********************************************
      *    FILE UPDATE ROUTINES
      *********************************************
       UPDATE-FILES.

           MOVE "UPDATING LOAN PAYMENT FILE............" TO MESS.
           PERFORM SEND-LEGEND.

      * GET ACCUMULATED EARNINGS FOR PAYMENT RECORDS:
           MOVE 1 TO SUB.
           PERFORM UPDATE-ACCERN UNTIL SUB > 6.

           MOVE LP-PATH-OWNBR     TO LP-BRNO.
           MOVE LN-ACCTNO         TO LP-ACCTNO.
           MOVE NEXT-NEW-LP-SEQNO TO LP-SEQNO.

           MOVE TRANS-DATE TO LP-TRDATE.
           MOVE BORROWER-KEY TO LP-SSNO.
           MOVE EARNING-WK(1) TO LP-EARNED(1).
           MOVE EARNING-WK(2) TO LP-EARNED(2).
           MOVE EARNING-WK(3) TO LP-EARNED(3).

           PERFORM SET-POSTDATE.
           MOVE POST-USERID TO LP-USERID.
           MOVE POST-TIME   TO LP-POSTTIME.
           MOVE POST-DATE   TO LP-POSTDATE.

           PERFORM WRITE-LP1-FILE.
           IF IO-FG = 9
               GO TO IO-ERROR.

       UPDATE-LX.
           IF EARNING-WK(4) = 0
              IF EARNING-WK(5) = 0
                 IF EARNING-WK(6) = 0
                  IF EARNING-WK(7) = 0
                   IF EARNING-WK(8) = 0
                    IF EARNING-WK(9) = 0
                     IF EARNING-WK(10) = 0
                    GO TO UPDATE-BW1-FILE.

           MOVE "UPDATING LX TRAILER RECORD........" TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-LXE1-FILE.

           PERFORM CLEAR-LXE-FILE.

           MOVE LP-BRNO   TO LXE-BRNO.
           MOVE LP-ACCTNO TO LXE-ACCTNO.
           MOVE LP-SEQNO  TO LXE-SEQNO.

           MOVE EARNING-WK(4) TO LXE-EARN(1).
           MOVE EARNING-WK(5) TO LXE-EARN(2).
           MOVE EARNING-WK(6) TO LXE-EARN(3).
           MOVE EARNING-WK(7) TO LXE-EARN(4).

      *06/06/2019 AS OF THIS DATE, THE EARNING-WK IS POPULATED BY THE MOVE
      *OF LN-ACRERN(1-6) TO EARNING-WK(). UPDATE-ACCRERN
      *THE EARNIN-WK TABLE WHICH NOW OCCURS 10 TIMES IS INITIALLY SET TO 0
      *SO EARNING-WK(7-10) WILL BE 0 SO WE HAVE A GOOD SETUP WHEN WE ADD
      *ADDITIONAL EARNING COMPONENTS, ALSO ZERO FUTURE FIELDS

           MOVE EARNING-WK(8) TO LXE-EARN(5).
           MOVE EARNING-WK(9) TO LXE-EARN(6).
           MOVE EARNING-WK(10) TO LXE-EARN(7).

           PERFORM WRITE-LXE1-FILE.
           IF IO-FG NOT = 0
              PERFORM REWRITE-LXE1-FILE
              IF IO-FG NOT = 0
                 GO TO IO-ERROR.

           PERFORM CLOSE-LXE1-FILE.

       UPDATE-BW1-FILE.
           MOVE "UPDATING BORROWER FILE................" TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM GET-COLLATERAL.
           MOVE 1 TO SUB.
           PERFORM OPEN-BW1-FILE.
       UPDATE-NEXT-BW.
           MOVE LN-SSNO(SUB) TO BW-SSNO.
           PERFORM READ-BW1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           IF LP-CURBAL = 0
              ADD 1 TO BW-PRLOANS
           ELSE
              ADD 1 TO BW-LOANS.
           IF LN-SERVACCT = "Y"
              ADD LP-CURBAL TO BW-LIAOTH
           ELSE
              IF LN-SMALLOAN = "Y"
                 ADD LP-CURBAL TO BW-LIASMLN
              ELSE
                 ADD LP-CURBAL TO BW-LIAOTH.
           IF SUB = 1
              IF CD-CO-SECURED = "R"
                 COMPUTE BW-RE-INTYTD = BW-RE-INTYTD + HOLD-LN-YTDINTPD
                 COMPUTE BW-RE-INTLYR = BW-RE-INTLYR + HOLD-LN-LYRINTPD
              ELSE
                 COMPUTE BW-INTYTD = BW-INTYTD + HOLD-LN-YTDINTPD
                 COMPUTE BW-INTLYR = BW-INTLYR + HOLD-LN-LYRINTPD.
           PERFORM REWRITE-BW1-FILE.
           IF SUB NOT = 4
              ADD 1 TO SUB
              IF LN-SSNO(SUB) NOT = 0
                 GO TO UPDATE-NEXT-BW.
           PERFORM CLOSE-BW1-FILE.

      *-----------------------------------------
      *    UPDATE LOAN FILE
      *-----------------------------------------
           MOVE "UPDATING LOAN MASTER FILE.........." TO MESS.
           PERFORM SEND-LEGEND.

           MOVE LN-ANTICERN(1)    TO HOLD-LN-ANTICERN(1)
           MOVE LN-ANTICERN(2)    TO HOLD-LN-ANTICERN(2)
           MOVE LN-ANTICERN(3)    TO HOLD-LN-ANTICERN(3).
           MOVE LN-ANTICERN(4)    TO HOLD-LN-ANTICERN(4).

           MOVE LN-ANTICERN(5)    TO HOLD-LN-ANTICERN(5).
           MOVE LN-ANTICERN(6)    TO HOLD-LN-ANTICERN(6).
           MOVE LN-DLRVPRIN(1)    TO HOLD-LN-DLRVPRIN(1).
           MOVE LN-DLRVPRIN(2)    TO HOLD-LN-DLRVPRIN(2).
           MOVE LN-DLPARTRCAMT    TO HOLD-LN-DLPARTRCAMT.
           MOVE LN-ANTICTERM      TO HOLD-LN-ANTICTERM.
           MOVE LN-ORIGPURAMT     TO HOLD-LN-ORIGPURAMT
                                     HOLD-LN-SUM-ORIGPURAMT.
           MOVE LN-DLDISC         TO HOLD-LN-DLDISC.
           MOVE LN-MIDSTREAM      TO HOLD-LN-MIDSTREAM.
      *    MOVE LN-PROCEEDS       TO HOLD-LN-PROCEEDS.

           MOVE LN-ACCERN(1)      TO HOLD-ACCERN(1).
           MOVE LN-ACCERN(2)      TO HOLD-ACCERN(2).
           MOVE LN-ACCERN(3)      TO HOLD-ACCERN(3).
           MOVE LN-ACCERN(4)      TO HOLD-ACCERN(4).
           MOVE LN-ACCERN(5)      TO HOLD-ACCERN(5).
           MOVE LN-ACCERN(6)      TO HOLD-ACCERN(6).
           MOVE LN-UFERN(1)       TO HOLD-UFERN(1).
           MOVE LN-UFERN(2)       TO HOLD-UFERN(2).
           MOVE LN-UFERN(3)       TO HOLD-UFERN(3).
           MOVE LN-UFERN(4)       TO HOLD-UFERN(4).
           MOVE LN-UFERN(5)       TO HOLD-UFERN(5).
           MOVE LN-UFERN(6)       TO HOLD-UFERN(6).
           MOVE LN-EARN-ORDER(1)  TO HOLD-EARN-ORDER(1).
           MOVE LN-EARN-ORDER(2)  TO HOLD-EARN-ORDER(2).
           MOVE LN-EARN-ORDER(3)  TO HOLD-EARN-ORDER(3).
           MOVE LN-EARN-ORDER(4)  TO HOLD-EARN-ORDER(4).
           MOVE LN-EARN-ORDER(5)  TO HOLD-EARN-ORDER(5).
           MOVE LN-EARN-ORDER(6)  TO HOLD-EARN-ORDER(6).

           MOVE LN-SUM-LNAMT      TO HOLD-LN-SUM-LNAMT.
           MOVE LN-SUM-FINCHG     TO HOLD-LN-SUM-FINCHG.
           MOVE LN-SUM-INTCHG     TO HOLD-LN-SUM-INTCHG.
           MOVE LN-SUM-SERCHG     TO HOLD-LN-SUM-SERCHG.
           MOVE LN-SUM-EXTCHG     TO HOLD-LN-SUM-EXTCHG.
           MOVE LN-SUM-REGPYAMT   TO HOLD-LN-SUM-REGPYAMT.
           MOVE LN-SUM-ORIGPURAMT TO HOLD-LN-SUM-ORIGPURAMT.
           MOVE LN-SUM-MAINTFEE   TO HOLD-LN-SUM-MAINTFEE.
           MOVE LN-SUM-ORGTERM    TO HOLD-LN-SUM-ORGTERM.
           MOVE LN-ADDON-FG       TO HOLD-LN-ADDON-FG.
           MOVE LN-PAY-SCHLD-FG   TO HOLD-LN-PAY-SCHLD-FG .
      *KC->MOVE LN-ANTICERN(2)    TO HOLD-LN-ANTICERN.
           MOVE LN-ANTICADJ(2)    TO HOLD-LN-ANTICADJ.
           MOVE LN-UFERN(2)       TO HOLD-LN-UFERN.

           MOVE LN-REBATE-TAB     TO HOLD-LN-REBATE-TAB.
           MOVE LN-INSTBL(1)      TO HOLD-LN-INSTBL(1).
           MOVE LN-INSTBL(2)      TO HOLD-LN-INSTBL(2).
           MOVE LN-INSTBL(3)      TO HOLD-LN-INSTBL(3).
           MOVE LN-INSTBL(4)      TO HOLD-LN-INSTBL(4).
           MOVE LN-INSTBL(5)      TO HOLD-LN-INSTBL(5).

           MOVE LN-DLRECOURSE TO HOLD-LN-DLRECOURSE.
           IF DL-RECOURSE-FRMLA = "A"
              IF LN-DLRECOURSE NOT = "P"
                 IF LN-DLPARTRCAMT NOT = 0
                    MOVE LN-1STPYDATE TO PDTH-DATE-WORK
                    PERFORM PAID-THRU-CALCULATION
                    IF PDTH-PAYMENTS < LN-DLPARTRCAMT
                       MOVE "F" TO HOLD-LN-DLRECOURSE
                    ELSE
                       MOVE "N" TO HOLD-LN-DLRECOURSE.

           MOVE LN-PY-YYYYMM-RECDEL TO HOLD-LN-PY-YYYYMM-RECDEL.

           PERFORM OPEN-LN1-FILE.
           PERFORM READ-LN1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

           MOVE HOLD-LN-ANTICERN(1)    TO LN-ANTICERN(1).
           MOVE HOLD-LN-ANTICERN(2)    TO LN-ANTICERN(2).
           MOVE HOLD-LN-ANTICERN(3)    TO LN-ANTICERN(3).
           MOVE HOLD-LN-ANTICERN(4)    TO LN-ANTICERN(4).
           MOVE HOLD-LN-ANTICERN(5)    TO LN-ANTICERN(5).
           MOVE HOLD-LN-ANTICERN(6)    TO LN-ANTICERN(6).
           MOVE HOLD-LN-DLRVPRIN(1)    TO LN-DLRVPRIN(1).
           MOVE HOLD-LN-DLRVPRIN(2)    TO LN-DLRVPRIN(2).
           MOVE HOLD-LN-DLPARTRCAMT    TO LN-DLPARTRCAMT.
           MOVE HOLD-LN-ANTICTERM      TO LN-ANTICTERM.
           MOVE HOLD-LN-ORIGPURAMT     TO LN-ORIGPURAMT.
           MOVE HOLD-LN-DLDISC         TO LN-DLDISC.
           MOVE HOLD-LN-SUM-ORIGPURAMT TO LN-SUM-ORIGPURAMT.
           MOVE HOLD-LN-MIDSTREAM      TO LN-MIDSTREAM.
           MOVE HOLD-LN-PROCEEDS       TO LN-PROCEEDS.
      
           MOVE HOLD-ACCERN(1)         TO LN-ACCERN(1).
           MOVE HOLD-ACCERN(2)         TO LN-ACCERN(2).
           MOVE HOLD-ACCERN(3)         TO LN-ACCERN(3).
           MOVE HOLD-ACCERN(4)         TO LN-ACCERN(4).
           MOVE HOLD-ACCERN(5)         TO LN-ACCERN(5).
           MOVE HOLD-ACCERN(6)         TO LN-ACCERN(6).
           MOVE HOLD-UFERN(1)          TO LN-UFERN(1).
           MOVE HOLD-UFERN(2)          TO LN-UFERN(2).
           MOVE HOLD-UFERN(3)          TO LN-UFERN(3).
           MOVE HOLD-UFERN(4)          TO LN-UFERN(4).
           MOVE HOLD-UFERN(5)          TO LN-UFERN(5).
           MOVE HOLD-UFERN(6)          TO LN-UFERN(6).
           MOVE HOLD-EARN-ORDER(1)     TO LN-EARN-ORDER(1).
           MOVE HOLD-EARN-ORDER(2)     TO LN-EARN-ORDER(2).
      
           MOVE HOLD-LN-SUM-LNAMT      TO LN-SUM-LNAMT.
           MOVE HOLD-LN-SUM-FINCHG     TO LN-SUM-FINCHG.
           MOVE HOLD-LN-SUM-INTCHG     TO LN-SUM-INTCHG.
           MOVE HOLD-LN-SUM-SERCHG     TO LN-SUM-SERCHG.
           MOVE HOLD-LN-SUM-EXTCHG     TO LN-SUM-EXTCHG.
           MOVE HOLD-LN-SUM-REGPYAMT   TO LN-SUM-REGPYAMT.
           MOVE HOLD-LN-SUM-ORIGPURAMT TO LN-SUM-ORIGPURAMT.
           MOVE HOLD-LN-SUM-MAINTFEE   TO LN-SUM-MAINTFEE.
           MOVE HOLD-LN-SUM-ORGTERM    TO LN-SUM-ORGTERM.
           MOVE HOLD-LN-ADDON-FG       TO LN-ADDON-FG.
           MOVE HOLD-LN-PAY-SCHLD-FG   TO LN-PAY-SCHLD-FG .
      *KC->MOVE HOLD-LN-ANTICERN       TO LN-ANTICERN(2).
           MOVE HOLD-LN-ANTICADJ       TO LN-ANTICADJ(2).
           MOVE HOLD-LN-UFERN          TO LN-UFERN(2).

           MOVE HOLD-LN-REBATE-TAB TO LN-REBATE-TAB.
           MOVE HOLD-LN-INSTBL(1)  TO LN-INSTBL(1).
           MOVE HOLD-LN-INSTBL(2)  TO LN-INSTBL(2).
           MOVE HOLD-LN-INSTBL(3)  TO LN-INSTBL(3).
           MOVE HOLD-LN-INSTBL(4)  TO LN-INSTBL(4).
           MOVE HOLD-LN-INSTBL(5)  TO LN-INSTBL(5).
      
           MOVE HOLD-EARN-ORDER(3) TO LN-EARN-ORDER(3).
           MOVE HOLD-EARN-ORDER(4) TO LN-EARN-ORDER(4).
           MOVE HOLD-EARN-ORDER(5) TO LN-EARN-ORDER(5).
           MOVE HOLD-EARN-ORDER(6) TO LN-EARN-ORDER(6).

           MOVE LP-OTHBAL          TO LN-OTHBAL.
           MOVE LP-OT2BAL          TO LN-OT2BAL.
           MOVE LP-INTBAL          TO LN-INTBAL.
           MOVE LP-LCBAL           TO LN-LCBAL.
           MOVE LP-CURBAL          TO LN-CURBAL.

           MOVE HOLD-LN-TOTPAYMNTD    TO LN-TOTPAYMNTD.
           MOVE HOLD-LN-TOTEXCPAYMNTD TO LN-TOTEXCPAYMNTD.
           MOVE HOLD-LN-MTD-PAYS-RECDEL TO LN-MTD-PAYS-RECDEL.
           MOVE HOLD-LN-LYRINTPD      TO LN-LYRINTPD.
           MOVE HOLD-LN-YTDINTPD      TO LN-YTDINTPD.
           COMPUTE LN-TOTINTPD =
              HOLD-PRIINTPD + HOLD-LN-LYRINTPD + HOLD-LN-YTDINTPD.
           MOVE HOLD-LN-LCPAID        TO LN-LCPAID.
           MOVE HOLD-LN-LCPARTIALS    TO LN-LCPARTIALS.
           MOVE HOLD-LN-MESSAGE       TO LN-MESSAGE.
           MOVE LP-PAYDATE            TO LN-DATE-PAID-LAST.
      *-------------------------------------------------------
      * JTG 040397 CHANGED TO TEST FOR ACCOUNTS WITH NO PRIOR
      *            PAYMENTS POSTED AND TO SET 'LN-INTPDTH
      *            INTEREST ASSESSED THRU DATE' TO 0,
      *            WHICH IS WHAT LONPC2.C & LONPB2.C DO.
      *
      *            WHEN CALCULATING IB INTEREST DUE, THE SYSTEM
      *            WILL USES LN-INTDATE AS THE THE LAST ASSESS
      *            DATE WHEN LN-INTPDTH-DATE = 0.
      *            -------------------------------------------
      * JTG 001011 WHEN THE CONVERSION LINE WAS INPUTED, IF
      *            (LN-CURBAL - LN-OT2BAL) = LN-LNAMT THE LOGIC ASSUMED
      *            LP-PAYDATE = LN-LOANDATE AND MOVED 0 TO LN-INTPDTH-DATE
      *            THIS CAUSED A PROBLEM IN THE IB ACCRUAL SINCE THE
      *            ASSESSMENT ROUTINE 'LPRATE' TESTS IF LN-INTPDTH-DATE = 0
      *            AND LN-DATE-PAID-LAST NOT = LN-LOANDATE IF TRUE
      *            ASSESSES ARE FROM LN-DATE-PAID-LAST            REGENCY #J013
      *            -------------------------------------------

           IF ( LN-LNAMT = (LN-CURBAL - LN-OT2BAL) ) AND
              ( LP-PAYDATE = LN-LOANDATE )
              MOVE 0 TO LN-INTPDTH-DATE
           ELSE
              MOVE LP-PAYDATE TO LN-INTPDTH-DATE.
      
           MOVE LP-TRAMT           TO LN-AMT-PAID-LAST.
           MOVE LP-LCPDTH-DATE     TO LN-LCPDTH-DATE.
           MOVE HOLD-LN-TOTNODEF   TO LN-TOTNODEF.
           MOVE HOLD-LN-TOTNOALDEL TO LN-TOTNOALDEL.
           IF LN-SERVACCT = "Y"
              MOVE 0               TO LN-PURBAL
           ELSE
              MOVE LN-CURBAL       TO LN-PURBAL.
           MOVE HOLD-LN-TOTDEF     TO LN-TOTDEF.
           MOVE HOLD-LN-TOTNODEF   TO LN-YTDNODEF.
           MOVE HOLD-LN-TOTINT     TO LN-TOTINT.
           MOVE HOLD-LN-TOTLCHG    TO LN-TOTLCHG.
      * SET CREDIT LIMIT:
           MOVE HOLD-LN-CREDITLIM  TO LN-CREDITLIM.
           MOVE HOLD-LN-WCBC-CREDITLIM  TO LN-WCBC-CREDITLIM.
      * SET TOTAL EARNINGS:
           COMPUTE LN-TOTERN = LN-TOTINT    + LN-TOTSERACCT
                             + LN-TOTLCHG   + LN-TOTDEF
                             + LN-ACCERN(1) + LN-ACCERN(2)
                             + LN-ACCERN(3) + LN-ACCERN(5).

           IF NOT (GP-INCL-OTH-IN-EARNED-N OR GP-INCL-OTH-IN-EARNED-R)
              ADD LN-ACCERN(6) TO LN-TOTERN.

           IF NOT (GP-INCL-OTH-IN-EARNED-R)
              ADD LN-ACCERN(4) TO LN-TOTERN.

           MOVE HOLD-LN-ERNDELQ-STOP      TO LN-ERNDELQ-STOP.
           MOVE HOLD-LN-LAST-ACCRUAL-DATE TO LN-LAST-ACCRUAL-DATE.
           MOVE HOLD-LN-PY-YYYYMM-RECDEL  TO LN-PY-YYYYMM-RECDEL.

           PERFORM COMPUTE-EARNINGS.
           MOVE EARN-TOT-UNEARN            TO LN-PRIOR-UNEARNED.

           MOVE HOLD-LN-DLRECOURSE         TO LN-DLRECOURSE.
           MOVE HOLD-LN-ERN-IB-PDTH-DATE   TO LN-ERN-IB-PDTH-DATE.
           MOVE HOLD-LN-ERN-IB-PRINBAL     TO LN-ERN-IB-PRINBAL.
           MOVE HOLD-LN-ERN-IB-INTOWE      TO LN-ERN-IB-INTOWE.

           IF SET-EXPIRATION-FG = "Y"
              PERFORM SET-EXPIRATION.

           IF LN-CURBAL = 0
              MOVE LP-PAYDATE TO LN-POFFDATE
              MOVE "PO"      TO LN-POCD LN-PO-TRCD.

      D    STOP MESS.
           PERFORM REWRITE-LN1-FILE.
           PERFORM CLOSE-LN1-FILE.

           PERFORM UPDATE-NOTICE-FILE.

      *-------------------------------------------------------
      * UPDATE-TY1-DS1:
           IF GP-LOAN-CONVERSION-UPD-FG = "Y" OR "S"
              PERFORM UPDATE-TY1-FILE
              PERFORM UPDATE-DS1-FILE.
      * UPDATE-TRK IN ALL CASES:                 JTG 000613
           PERFORM CREATE-TRK-FILE.

           MOVE "Y" TO FULL-PAGE.
           MOVE 99999   TO LP-SEQNO.
           MOVE LP1-KEY TO HOLD2-KEY-UP.
           PERFORM DISPLAY-ENTRY-UP.

           PERFORM RESET-ENTRY-LINE.

           GO TO SELECTION-MODULE.

      ***********************************
      *   DELETE BALANCE FORWARD LINE
      ***********************************
       UPDATE-FILES-REVERSE.
           MOVE LP-REC TO HOLD-LP-REC.

           PERFORM OPEN-LP1-FILE.
       UPDATE-LP1-REV.
           PERFORM READ-LP1-FILE.
           IF IO-FG = 0
              IF LP-TRCD = "BF"
                 IF LP-ACCTNO = LN-ACCTNO 
                    PERFORM DELETE-LP1-FILE
                    PERFORM CLOSE-LP1-FILE
                    MOVE LP-BRNO   TO LXE-BRNO
                    MOVE LP-ACCTNO TO LXE-ACCTNO
                    MOVE LP-SEQNO  TO LXE-SEQNO
                    GO TO UPDATE-LX1-REVERSE.

           PERFORM DEL-ERROR.
           GO TO BAR-ENTRY-ROUTINE.

       UPDATE-LX1-REVERSE.
           PERFORM OPEN-LXE1-FILE.
       UPDATE-LX1-REV.
           PERFORM READ-LXE1-FILE.
           IF IO-FG = 0
              IF LP-TRCD = "BF"
                 IF LXE-ACCTNO = LN-ACCTNO
                    PERFORM DELETE-LXE1-FILE
                    PERFORM CLOSE-LXE1-FILE
                    GO TO UPDATE-BW1-REVERSE.

       UPDATE-BW1-REVERSE.
           PERFORM GET-COLLATERAL.
           MOVE 1 TO SUB.
           PERFORM OPEN-BW1-FILE.
       UPDATE-BW1-REV-NEXT.
           MOVE LN-SSNO(SUB) TO BW-SSNO.
           PERFORM READ-BW1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           IF LP-CURBAL = 0
              SUBTRACT 1 FROM BW-PRLOANS
           ELSE
              SUBTRACT 1 FROM BW-LOANS.

           IF LN-SERVACCT = "Y"
              SUBTRACT LP-CURBAL FROM BW-LIAOTH
           ELSE
              IF LN-SMALLOAN = "Y"
                 SUBTRACT LP-CURBAL FROM BW-LIASMLN
               ELSE
                 SUBTRACT LP-CURBAL FROM BW-LIAOTH.
           IF SUB = 1
              IF CD-CO-SECURED = "R"
                 SUBTRACT LN-YTDINTPD FROM BW-RE-INTYTD
                 SUBTRACT LN-LYRINTPD FROM BW-RE-INTLYR
              ELSE
                 SUBTRACT LN-YTDINTPD FROM BW-INTYTD
                 SUBTRACT LN-LYRINTPD FROM BW-INTLYR.
           PERFORM REWRITE-BW1-FILE.
           IF SUB = 4
              GO TO UPDATE-BW1-REV-CLOSE.
           ADD 1 TO SUB.
           IF LN-SSNO(SUB) NOT = 0
              GO TO UPDATE-BW1-REV-NEXT.
       UPDATE-BW1-REV-CLOSE.
           PERFORM CLOSE-BW1-FILE.

      * UPDATE-TY1-DS1-REVERSE:
           IF GP-LOAN-CONVERSION-UPD-FG = "Y" OR "S"
              PERFORM UPDATE-TY1-FILE-REV
              PERFORM UPDATE-DS1-FILE-REV.
      * UPDATE-TRK-REVERSE IN ALL CASES:                  JTG 000613
           PERFORM CREATE-TRK-FILE-REV.

       UPDATE-LN1-REVERSE.
           PERFORM OPEN-LN1-FILE.
           PERFORM READ-LN1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

           PERFORM UNSET-EXPIRATION.

           COMPUTE TOTAL-REPAY =
               LN-1STPYAMT
                    + LN-NOREGPY * LN-REGPYAMT + LN-LASTPYAMT.
           COMPUTE TOTAL-NOTE = TOTAL-REPAY - LN-EXTCHG
                              - (LN-ORGTERM * LN-MAINTFEE).

           MOVE LN-ORIGPURAMT TO LN-PURBAL.

           IF LN-SERVACCT = "Y"
              MOVE 0 TO LN-PURBAL.

           MOVE 0 TO LN-OTHBAL LN-OT2BAL LN-INTBAL LN-CURBAL
                     LN-ACCERN(1) LN-ACCERN(2) LN-ACCERN(3)
                     LN-ACCERN(4) LN-ACCERN(5) LN-ACCERN(6)
                     LN-TOTPAYMNTD LN-DATE-PAID-LAST
                     LN-TOTEXCPAYMNTD 
                     LN-PRIOR-UNEARNED LN-LAST-ACCRUAL-DATE
                     LN-AMT-PAID-LAST LN-TOTINTPD LN-YTDINTPD
                     LN-LYRINTPD LN-LCPAID LN-LCPDTH-DATE LN-TOTNODEF
                     LN-TOTDEF LN-TOTNOALDEL LN-TOTERN LN-TOTINT
                     LN-TOTLCHG LN-CREDITLIM LN-YTDNODEF
                     LN-LCPARTIALS LN-LCBAL LN-INTPDTH-DATE
                     LN-MTD-PAYS-RECDEL LN-PY-YYYYMM-RECDEL
                     LN-POFFDATE.
           MOVE HOLD-LN-MESSAGE TO LN-MESSAGE.
           MOVE " "             TO LN-ERNDELQ-STOP LN-POCD LN-PO-TRCD.

           MOVE LN-LNAMT      TO LN-SUM-LNAMT.
           MOVE LN-FINCHG     TO LN-SUM-FINCHG.
           MOVE LN-INTCHG     TO LN-SUM-INTCHG.
           MOVE LN-SERCHG     TO LN-SUM-SERCHG.
           MOVE LN-EXTCHG     TO LN-SUM-EXTCHG.
           MOVE LN-REGPYAMT   TO LN-SUM-REGPYAMT.
           MOVE LN-ORIGPURAMT TO LN-SUM-ORIGPURAMT.
           COMPUTE LN-SUM-MAINTFEE = LN-MAINTFEE * LN-ORGTERM.
           MOVE " " TO LN-ADDON-FG LN-PAY-SCHLD-FG.
           MOVE 0 TO LN-ANTICERN(2) LN-ANTICADJ(2)
                     LN-UFERN(2)    LN-ACCERN(2).
           MOVE LN-ORGTERM TO LN-SUM-ORGTERM.

           IF SP-DLDISC-CONV-BF-PCNT NOT = 0
              MOVE 0 TO LN-ANTICERN(5)
                        LN-ANTICADJ(5)
                        LN-UFERN(5)
                        LN-ACCERN(5).

      * IF USING THE BULK PURCHASE (IPF WINDOW) RESET THE FOLLOWING
           IF BULK-CONVERSION-FG NOT = "B"
              GO TO UPDATE-LN1-REV-CONT.

           MOVE " "          TO LN-MIDSTREAM.
           MOVE 0            TO LN-DLRVPRIN(1)
                                LN-DLRVPRIN(2)
                                LN-DLDISC
                                LN-DLPARTRCAMT.
           MOVE LN-LNAMT     TO LN-ORIGPURAMT
                                LN-PURBAL
                                LN-SUM-ORIGPURAMT.
           MOVE LN-ORGTERM   TO LN-ANTICTERM.
           IF LN-LOANTYPE = "P"
              MOVE LN-INTCHG TO LN-ANTICERN(1)
           ELSE
              MOVE 0         TO LN-ANTICERN(1).
           MOVE LN-SERCHG    TO LN-ANTICERN(3).
           MOVE LN-MAINTFEE  TO LN-ANTICERN(4).
           MOVE 0            TO LN-ANTICERN(5).

           COMPUTE LN-PROCEEDS =
                LN-LNAMT - ( LN-DLRVPRIN(1)   + LN-DLRVPRIN(2)
                             + LN-ANTICERN(1) + LN-ANTICERN(2)
                             + LN-ANTICERN(3) + LN-ANTICERN(4)
                           )
                         + LN-ANTICERN(5).

       UPDATE-LN1-REV-CONT.

           PERFORM REWRITE-LN1-FILE.
           PERFORM CLOSE-LN1-FILE.

           PERFORM UPDATE-NOTICE-FILE.

           MOVE "Y" TO FULL-PAGE.
           MOVE 99999 TO LP-SEQNO.
           MOVE LP1-KEY TO HOLD2-KEY-UP.
           PERFORM DISPLAY-ENTRY-UP.

           MOVE TOP-LIST TO MESS.
           PERFORM RESET-LIST.
           PERFORM RESET-ENTRY-LINE.
           GO TO SELECTION-MODULE.

       SELECTION-MODULE-EXIT.
           EXIT.

      ******************************************
       ENTER-MESSAGE-ROUTINE SECTION.
      ******************************************
           MOVE "E  A300MESSAGE." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              GO TO MESSAGE-ROUTINE-EXIT.
           IF VDUSTATUS NOT = "00"
              GO TO ENTER-MESSAGE-ROUTINE.
           MOVE VDUBUF TO HOLD-LN-MESSAGE.
           PERFORM OPEN-LN1-FILE.
           PERFORM READ-LN1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

           PERFORM OPEN-LN1-FILE.
           PERFORM READ-LN1-FILE.
           MOVE HOLD-LN-MESSAGE TO LN-MESSAGE.
           PERFORM REWRITE-LN1-FILE.
           PERFORM CLOSE-LN1-FILE.

       MESSAGE-ROUTINE-EXIT.
           EXIT.

      ***********************************************
       UPDATE-NOTICE-FILE SECTION.
      ***********************************************
           PERFORM OPEN-NO1-FILE.
           MOVE LN-OWNBR  TO NO-BRNO.
           MOVE LN-ACCTNO TO NO-ACCTNO CRNOR2-ACCTNO.
           PERFORM READ-NO1-FILE.

           MOVE TRANS-DATE     TO CRNOR2-SYSDATE.
           MOVE "CL/CRNOR2"    TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CRNOR2-LINK NO-REC
                                 POFF-WORKERS LN-REC.
           CANCEL FORM-PROGX.

           MOVE LN-OWNBR  TO NO-BRNO.
           MOVE LN-ACCTNO TO NO-ACCTNO.
           IF IO-FG = 0
              PERFORM REWRITE-NO1-FILE
           ELSE
              PERFORM WRITE-NO1-FILE.

           PERFORM CLOSE-NO1-FILE.

       EXIT-UPDATE-NOTICE-FILE.
           EXIT.

      **************************************
       CALL-PMMAKE-ROUTINE SECTION.
      **************************************
      *    UNLOCK LP-FILE.
           MOVE LN-OWNBR         TO PMMAKE-OWNBR.
           MOVE LN-ACCTNO        TO PMMAKE-ACCTNO.
           MOVE "WI/PMMAKE" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PMMAKE-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.

           MOVE " "       TO HOLD1-KEY-DOWN.
           MOVE "Y"       TO FULL-PAGE.

           MOVE LN-OWNBR  TO LP-BRNO.
           MOVE LN-ACCTNO TO LP-ACCTNO.
           MOVE 99999     TO LP-SEQNO.
           MOVE LP1-KEY   TO HOLD2-KEY-UP.

           PERFORM DISPLAY-ENTRY-UP.

       CALL-PMMAKE-ROUTINE-EXIT.
           EXIT.


      ************************************************
      *    LOAN PAYMENT RECORD DISPLAY
      ************************************************
       DISPLAY-ENTRY-DOWN SECTION.
           MOVE SPACES TO LINE-BUFFER LN-BUF.
           MOVE 0 TO LN-WK.
           MOVE HOLD1-KEY-DOWN TO LP1-KEY.
           IF LP-SEQNO = 99999
              MOVE 9 TO IO-FG
              GO TO DISPLAY-DOWN-EXIT.

           MOVE LP1-KEY TO HOLD2-KEY-UP.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * ***NOTE*** 'START-LP1-FILE-SCAN' MUST BE USED WHEN FIRST USING
      * 'START-LP1-FILE-NOT-GREATER'; USED WHEN DISPLAYING MULTIPLE
      * PAGES IN AN UP & DOWN FUNCTION; YOU NEED TO ADD ONE TO 
      * LP-SEQNO (IN WBEG) IN ORDER TO GET THE DISPLAY TO WORK
      * LIKE VISION FILES.
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           PERFORM OPEN-LP1-FILE.
           PERFORM READ-LP1-FILE.
      *    UNLOCK LP-FILE.
           IF IO-FG NOT = 0
              MOVE LP-PATH-OWNBR TO QLP1-WBEG-BRNO
                                    QLP1-WEND-BRNO
              MOVE LP-ACCTNO     TO QLP1-WBEG-ACCTNO
                                    QLP1-WEND-ACCTNO
              COMPUTE QLP1-WBEG-SEQNO = LP-SEQNO + 1
              MOVE ALL "9"       TO QLP1-WEND-SEQNO
      *-   -   -{ ADD ONE TO WHERE SCAN BEG FIELDS }
              IF ( LP-BRNO = 9999 )
                 MOVE LP-BRNO    TO QLP1-WSBEG-BRNO
              ELSE
                 COMPUTE QLP1-WSBEG-BRNO = LP-BRNO + 1
              END-IF
   
              IF ( LP-ACCTNO = 99999999 )
                 MOVE LP-ACCTNO  TO QLP1-WSBEG-ACCTNO
              ELSE
                 COMPUTE QLP1-WSBEG-ACCTNO = LP-ACCTNO + 1
              END-IF

              PERFORM START-LP1-FILE-SCAN.

           MOVE 0 TO ENTRY-FLAG.
       READ-LPFILE1-NEXT.
           IF ENTRY-FLAG = 2
              MOVE 9 TO IO-FG
              GO TO BYPASS-LPFILE1-READ.

           PERFORM READ-LP1-FILE-NEXT.
      *    UNLOCK LP-FILE.
           IF (LP-ACCTNO NOT = LN-ACCTNO) OR
               (LP-BRNO NOT = LP-PATH-OWNBR)
              IF IO-FG = 0
                 ADD 1 TO ENTRY-FLAG
                 GO TO READ-LPFILE1-NEXT.

       BYPASS-LPFILE1-READ.
           ADD 1 TO LN-WK.
           IF IO-FG = 0
              PERFORM SETUP-LINE.
           MOVE LN-BUF TO D-LINE(LN-WK).
           MOVE SPACES TO LN-BUF.
           IF LN-WK = 6
              GO TO DISPLAY-XFER-DOWN.
           IF IO-FG = 0
              GO TO READ-LPFILE1-NEXT.
           IF FULL-PAGE = "Y"
              MOVE "N" TO FULL-PAGE
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 99999     TO LP-SEQNO
              MOVE LP1-KEY TO HOLD2-KEY-UP
              PERFORM DISPLAY-ENTRY-UP
              GO TO DISPLAY-DOWN-EXIT.
       DISPLAY-XFER-DOWN.
           PERFORM DISPLAY-ALL-LINES.
       DISPLAY-DOWN-EXIT.
           IF IO-FG = 0
              MOVE "Y" TO FULL-PAGE
              MOVE LP1-KEY TO HOLD1-KEY-DOWN
           ELSE
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 99999     TO LP-SEQNO
              MOVE LP1-KEY TO HOLD1-KEY-DOWN.
           PERFORM CLOSE-LP1-FILE.

       DISPLAY-ENTRY-UP SECTION.
           MOVE SPACES TO LINE-BUFFER LN-BUF.
           MOVE 7 TO LN-WK.
           MOVE HOLD2-KEY-UP TO LP1-KEY.
           IF LP-SEQNO = 0
              MOVE 9 TO IO-FG
              GO TO DISPLAY-UP-EXIT.

           MOVE LP1-KEY TO HOLD1-KEY-DOWN.
           PERFORM OPEN-LP1-FILE.

           MOVE LP-BRNO   TO QLP1-WBEG-BRNO
                             QLP1-WEND-BRNO.
           MOVE LP-ACCTNO TO QLP1-WBEG-ACCTNO
                             QLP1-WEND-ACCTNO.
           MOVE ALL "0"   TO QLP1-WBEG-SEQNO.
           MOVE LP-SEQNO  TO QLP1-WEND-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.
           MOVE 0 TO ENTRY-FLAG.
       READ-LPFILE2-NEXT.
           IF ENTRY-FLAG = 2
              MOVE 9 TO IO-FG
              GO TO BYPASS-LPFILE2-READ.

           PERFORM READ-LP1-FILE-PREVIOUS.
      *    UNLOCK LP-FILE.
           IF LP-ACCTNO NOT = LN-ACCTNO OR
                            (LP-BRNO NOT = LP-PATH-OWNBR)
              IF IO-FG = 0
                 ADD 1 TO ENTRY-FLAG
                 GO TO READ-LPFILE2-NEXT.

       BYPASS-LPFILE2-READ.
           SUBTRACT 1 FROM LN-WK.
            IF LN-WK < 1
              MOVE "Y" TO FULL-PAGE
              GO TO DISPLAY-XFER-UP.
           IF IO-FG = 0
              PERFORM SETUP-LINE.
           MOVE LN-BUF TO D-LINE(LN-WK).
           MOVE SPACES TO LN-BUF.
           IF IO-FG = 0
              GO TO READ-LPFILE2-NEXT.
           IF FULL-PAGE = "Y"
              MOVE "N" TO FULL-PAGE
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 0         TO LP-SEQNO
              MOVE LP1-KEY TO HOLD1-KEY-DOWN
              PERFORM DISPLAY-ENTRY-DOWN
              GO TO DISPLAY-UP-EXIT.
       DISPLAY-XFER-UP.
           PERFORM DISPLAY-ALL-LINES.
       DISPLAY-UP-EXIT.
           IF IO-FG = 0
              MOVE "Y" TO FULL-PAGE
              MOVE LP1-KEY TO HOLD2-KEY-UP
           ELSE
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 0         TO LP-SEQNO
              MOVE LP1-KEY TO HOLD2-KEY-UP.
           PERFORM CLOSE-LP1-FILE.

      ********************************************
       FIND-NEXT-PAYMENT-SEQNO SECTION.
      ********************************************
           MOVE 0 TO NEXT-NEW-LP-SEQNO.
           MOVE SPACES TO BF-EXISTS-FG.

      * FIND LAST "XX" PAYMENT 

           PERFORM OPEN-LP1-FILE.

           MOVE LP-PATH-OWNBR TO LP-BRNO
                                 QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO.
           MOVE LN-ACCTNO     TO LP-ACCTNO
                                 QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           MOVE ALL "9"       TO LP-SEQNO
                                 QLP1-WEND-SEQNO.
           MOVE ALL "0"       TO QLP1-WBEG-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.
       FIND-NEXT-SEQNO.
           PERFORM READ-LP1-FILE-PREVIOUS.
      *    UNLOCK LP-FILE.
           IF IO-BAD OR (LP-BRNO NOT = LP-PATH-OWNBR)
                      OR (LP-ACCTNO NOT = LN-ACCTNO)
              GO TO FIND-NEXT-PAYMENT-SEQNO-END.

           IF LP-TRCD NOT = "XX"
              MOVE "Y" TO BF-EXISTS-FG
              GO TO FIND-NEXT-SEQNO.

           IF ( NEXT-NEW-LP-SEQNO < LP-SEQNO )
              COMPUTE NEXT-NEW-LP-SEQNO = LP-SEQNO + 1.

           GO TO FIND-NEXT-SEQNO.

       FIND-NEXT-PAYMENT-SEQNO-END.
           IF NEXT-NEW-LP-SEQNO = 0
              MOVE 1 TO NEXT-NEW-LP-SEQNO.

           PERFORM CLEAR-LP-FILE.

           MOVE LP-PATH-OWNBR     TO SAVE-LP-BRNO.
           MOVE LN-ACCTNO         TO SAVE-LP-ACCTNO.
           MOVE NEXT-NEW-LP-SEQNO TO SAVE-LP-SEQNO.

      *-----------------------------------------------------
       FIND-NEXT-PAYMENT-SEQNO-EXIT.
           EXIT.


      /************************************
      *   S A V E   /   R E S T O R E     *
      *   S C R E E N   &   R E C O R D   *
      *   REVISED 03-30-84                *
      *************************************
       SAVE-SCREEN SECTION.
           MOVE 3 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           IF VDUSTATUS = "16"
              IF WK-OLD-PROG-FORM = "  "
                 MOVE 99 TO MENU-FG
                 GO TO EXIT-SAVE-SCREEN
              ELSE
                 MOVE WK-OLD-PROG-FORM TO NEW-PROG-FORM OLD-PROG-FORM
                 MOVE " " TO WK-OLD-PROG-FORM.
           MOVE ELE TO WK-ELE.
           MOVE LN-REC TO WK-SAVE-RECORD.
           PERFORM REWRITE-WK-FILE.
       EXIT-SAVE-SCREEN.
           PERFORM CLOSE-WK-FILE.

      ****************************************************
      *    SET EXPIRATION FLAG
      ****************************************************
       SET-EXPIRATION SECTION.
           SET STFG TO 1.
           SEARCH LN-STATUSFLAGS
              AT END GO TO SET-EXPIRATION-EXIT
              WHEN LN-STATUSFLAGS(STFG) = " "
                   MOVE "E" TO LN-STATUSFLAGS(STFG).

       SET-EXPIRATION-EXIT.
           EXIT.

      ****************************************************
      *    UNSET EXPIRATION FLAG
      ****************************************************
       UNSET-EXPIRATION SECTION.
           SET STFG TO 1.
           SEARCH LN-STATUSFLAGS
              AT END GO TO UNSET-EXPIRATION-EXIT
              WHEN LN-STATUSFLAGS(STFG) = "E"
                   MOVE " " TO LN-STATUSFLAGS(STFG).

       UNSET-EXPIRATION-EXIT.
           EXIT.

      ****************************************************
      *    EARN FORMULA 15 INPUT
      ****************************************************
       EARN15-INPUT SECTION.
           MOVE 8 TO WINDOW-LINES.
           MOVE 34 TO WINDOW-COLUMNS.
           MOVE 8 TO WINDOW-BEGIN-Y.
           MOVE 23 TO WINDOW-BEGIN-X.
           MOVE "WI/EARN15" TO WINDOW-FORM-NAM.
           MOVE "EARN15" TO VDU-FORM-NAME.

           PERFORM OPEN-WINDOW.
           DISPLAY EARN15-SCREEN.

           MOVE EARN15-FORM-FIELDS TO WR-BUF.
           MOVE EARN15-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.
           MOVE LP-PAYDATE TO HOLD-LN-ERN-IB-PDTH-DATE.
           MOVE 0          TO HOLD-LN-ERN-IB-INTOWE.

      * ENTER INTEREST EARNED:
       EARN15-INPUT-INT-EARNED.
           MOVE " ENTER INTEREST EARNED:" TO MESS.
           PERFORM SEND-WLEGEND.
           MOVE "ENNN062010." TO VDU.
           PERFORM SCREENIO.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO EARN15-INPUT-INT-EARNED.

           IF VDUNUM2 > (LN-INTCHG + LN-EXTCHG)
              GO TO EARN15-INPUT-INT-EARNED.
           MOVE VDUNUM2 TO LN-ACCERN(1).

       EARN15-INPUT-DISC-EARNED.
           MOVE " ^, ENTER DISCOUNT EARNED:" TO MESS.
           PERFORM SEND-WLEGEND.
           MOVE "ENNN062020." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO EARN15-INPUT-INT-EARNED.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO EARN15-INPUT-DISC-EARNED.

           IF VDUNUM2 > LN-DLDISC
              GO TO EARN15-INPUT-DISC-EARNED.
           MOVE VDUNUM2 TO LN-ACCERN(5).

           COMPUTE HOLD-LN-ERN-IB-PRINBAL =
               LN-LNAMT - LN-DLDISC - HOLD-LN-TOTPAYMNTD
                - HOLD-LN-TOTINT + LN-ACCERN(1) + LN-ACCERN(5).
           IF SP-CONTRFRMLA = "A"
              SUBTRACT HOLD-LN-TOTLCHG FROM HOLD-LN-ERN-IB-PRINBAL.
           IF LN-LOANTYPE = "P"
              SUBTRACT LN-FINCHG FROM HOLD-LN-ERN-IB-PRINBAL.

       EARN15-INPUT-EXIT.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY EARN15-SCREEN.
           PERFORM CLOSE-WINDOW.
           MOVE "LONIF" TO VDU-FORM-NAME.

      ***************************
      *    EARN FORMULA 16 INPUT
      ***************************
       EARN16-INPUT SECTION.
           MOVE 8 TO WINDOW-LINES.
           MOVE 34 TO WINDOW-COLUMNS.
           MOVE 8 TO WINDOW-BEGIN-Y.
           MOVE 23 TO WINDOW-BEGIN-X.
           MOVE "WI/EARN16" TO WINDOW-FORM-NAM.
           MOVE "EARN16" TO VDU-FORM-NAME.

           PERFORM OPEN-WINDOW.
           DISPLAY EARN16-SCREEN.

           MOVE EARN16-FORM-FIELDS TO WR-BUF.
           MOVE EARN16-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.

           MOVE LP-PAYDATE TO HOLD-LN-ERN-IB-PDTH-DATE.
           MOVE 0          TO HOLD-LN-ERN-IB-INTOWE.

      * ENTER INTEREST OWING:
       EARN16-INPUT-INT-OWING.
           MOVE " ENTER INTEREST OWING:" TO MESS.
           PERFORM SEND-WLEGEND.
           MOVE "ENNN062010." TO VDU.
           PERFORM SCREENIO.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO EARN16-INPUT-INT-OWING.

           IF VDUNUM2 > (LN-INTCHG + LN-EXTCHG)
              GO TO EARN16-INPUT-INT-OWING.
           MOVE VDUNUM2 TO HOLD-LN-ERN-IB-INTOWE.

      * ENTER DISCOUNT EARNED:
       EARN16-INPUT-DISC-EARNED.
           MOVE " ENTER DISCOUNT EARNED:" TO MESS.
           PERFORM SEND-WLEGEND.
           MOVE "ENNN062020." TO VDU.
           PERFORM SCREENIO.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO EARN16-INPUT-DISC-EARNED.

           IF VDUNUM2 > LN-DLDISC
              GO TO EARN16-INPUT-DISC-EARNED.
           MOVE VDUNUM2 TO LN-ACCERN(5).

           MOVE LN-LNAMT TO HOLD-LN-ERN-IB-PRINBAL.
           IF LN-LOANTYPE = "P"
              SUBTRACT LN-FINCHG FROM HOLD-LN-ERN-IB-PRINBAL.
           COMPUTE HOLD-LN-ERN-IB-PRINBAL =
               HOLD-LN-ERN-IB-PRINBAL
                  - (LN-ACCERN(5) / LN-DLDISC * HOLD-LN-ERN-IB-PRINBAL).

       EARN16-INPUT-EXIT.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY EARN16-SCREEN.
           PERFORM CLOSE-WINDOW.
           MOVE "LONIF" TO VDU-FORM-NAME.

      ***********************************************************
      *
      *   I N P U T - P U R C H A S E - F I E L D S   (IPF)
      *
      *-----------------------------------------------------------------
      *   INPUT RECOURSE CODE, RESERVES, AND ANTICIPATED EARNINGS
      ************************************************************
       INPUT-PURCHASE-FIELDS SECTION.
           MOVE 12 TO WINDOW-LINES.
           MOVE 56 TO WINDOW-COLUMNS.
           MOVE 12 TO WINDOW-BEGIN-Y.
           MOVE 23 TO WINDOW-BEGIN-X.
           MOVE "WI/PURFLD" TO WINDOW-FORM-NAM.
           MOVE "PURFLD" TO VDU-FORM-NAME.

           PERFORM OPEN-WINDOW.
           DISPLAY PURFLD-SCREEN.

           MOVE PURFLD-FORM-FIELDS TO WR-BUF.
           MOVE PURFLD-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.

      *  CHECK IF CHANGE MADE TO BALANCE FROM USING THE UP-ARROW

           IF LP-CURBAL NOT = IPF-CHECK-CURBAL
              IF IPF-FIRST-TIME NOT = "Y"
                 MOVE LP-CURBAL TO IPF-CHECK-CURBAL.

      *  SET ALL HOLD FIELDS
      *  ANTIC 1,3,4,5--RVPRIN 1,2-- PARTIAL-RECOURSE
      *  MOVE LN-FIELDS TO HOLD-FIELDS

           MOVE LN-ANTICERN(1)  TO HOLD-LN-ANTICERN(1).
           MOVE LN-ANTICERN(3)  TO HOLD-LN-ANTICERN(3).
           MOVE LN-ANTICERN(4)  TO HOLD-LN-ANTICERN(4).
           MOVE LN-ANTICERN(5)  TO HOLD-LN-ANTICERN(5).
           MOVE LN-DLRVPRIN(1)  TO HOLD-LN-DLRVPRIN(1).
           MOVE LN-DLRVPRIN(2)  TO HOLD-LN-DLRVPRIN(2).
           MOVE LN-DLPARTRCAMT  TO HOLD-LN-DLPARTRCAMT.

       IPF-PURCHASE-FIELD-RESET.

      * RE-ESTABLISHES 'LN' 

           MOVE HOLD-LN-ANTICERN(1) TO LN-ANTICERN(1).
           MOVE HOLD-LN-ANTICERN(3) TO LN-ANTICERN(3).
           MOVE HOLD-LN-ANTICERN(4) TO LN-ANTICERN(4).
           MOVE HOLD-LN-ANTICERN(5) TO LN-ANTICERN(5).
           MOVE HOLD-LN-DLRVPRIN(1) TO LN-DLRVPRIN(1).
           MOVE HOLD-LN-DLRVPRIN(2) TO LN-DLRVPRIN(2).
           MOVE HOLD-LN-DLPARTRCAMT TO LN-DLPARTRCAMT.
           PERFORM IPF-DISBURSEMENT-PROOF.

      * DISPLAY WINDOW 
           MOVE LN-DLRECOURSE  TO D-IPF-LN-DL-RECOURSE.
           MOVE LN-DLPARTRCAMT TO D-IPF-LN-DLPARTRCAMT.
           MOVE LN-DLRVPRIN(1) TO D-IPF-LN-DLRVPRIN1.
           MOVE LN-DLRVPRIN(2) TO D-IPF-LN-DLRVPRIN2.
           MOVE LN-ANTICERN(1) TO D-IPF-LN-ANTICERN1.
           MOVE LN-ANTICERN(5) TO D-IPF-LN-ANTICERN5.
           MOVE LN-ANTICERN(3) TO D-IPF-LN-ANTICERN3.
           MOVE LN-ANTICERN(4) TO D-IPF-LN-ANTICERN4.

           MOVE "S SN062ANTICEARN."  TO VDU.
           MOVE  HOLD-LN-TOT-ANTIC TO VDUNUM2.
           PERFORM SCREENIO.

           MOVE "S  S062PROCEEDS." TO VDU.
           MOVE HOLD-LN-PROCEEDS TO VDUNUM2.
           PERFORM SCREENIO.

           MOVE DISPLAY-IPF-BUF TO WR-BUF.
           MOVE DISPLAY-IPF-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
      *--{CS}
      *-{CS} - - - - - - - - - - - - - - - - -{ DISPLAY CALCULATION  }
       IPF-SET-REBATE-INTEREST.
           IF LN-LOANTYPE = "P"
               IF LN-INT-REBATE = " "
                  IF IPF-FIRST-TIME = "Y"
                      MOVE 7 TO REB-SUB
                      MOVE LN-INTCHG TO REB-TOTCHG
                      MOVE LN-ORGTERM TO REB-ORGTERM
      *               MOVE LP-PAYDATE TO REB-PAYDATE
                      MOVE TRANS-DATE TO REB-PAYDATE
                      PERFORM REBATE
                      MOVE REB-REBATE TO IPF-INTEREST-REBATE
                      MOVE "SNNN062ANTIC-INT." TO VDU
                      MOVE IPF-INTEREST-REBATE   TO VDUNUM2
                      PERFORM SCREENIO
                  ELSE
                      NEXT SENTENCE
               ELSE
                   MOVE "SNNN062ANTIC-INT." TO VDU
                   MOVE 0 TO VDUNUM2 LN-ANTICERN(1)
                   PERFORM SCREENIO
                   PERFORM IPF-DISBURSEMENT-PROOF.

       IPF-SET-REBATE-SERCHG.
           IF  LN-SERCHG = 0 OR LN-SC-REBATE NOT = " "
               GO TO  IPF-SET-REBATE-MAINTFEE.

               MOVE "S  A160PROMPTSC:S." TO VDU
               MOVE "ANTIC SERV CHG :"     TO VDUBUF
               PERFORM SCREENIO
               MOVE "S  A090SERCHG."   TO VDU
               MOVE "_________"          TO VDUBUF
               PERFORM SCREENIO.

               IF IPF-FIRST-TIME = "Y"
                  MOVE 8 TO REB-SUB
                  MOVE LN-SERCHG TO REB-TOTCHG
                  MOVE LN-ORGTERM TO REB-ORGTERM
                  MOVE LP-PAYDATE TO REB-PAYDATE
                  PERFORM REBATE
                  MOVE REB-REBATE TO IPF-SERCHG-REBATE
                  MOVE "SNNN062SERCHG." TO VDU
                  MOVE IPF-SERCHG-REBATE  TO VDUNUM2
                  PERFORM SCREENIO
               ELSE
                  MOVE "SNNN062SERCHG." TO VDU
                  MOVE LN-ANTICERN(3)   TO VDUNUM2
                  PERFORM SCREENIO.

       IPF-SET-REBATE-MAINTFEE.
           IF LN-MAINTFEE  = 0  OR LN-MF-REBATE NOT = " "
              GO TO IPF-DLR-RECOURSE.

              MOVE "S  A160PROMPTMF:S." TO VDU
              MOVE "ANTIC MAINT FEE:" TO VDUBUF
              PERFORM SCREENIO
              MOVE "S  A090MAINTFEE." TO VDU
              MOVE "_________"        TO VDUBUF
              PERFORM SCREENIO.

              IF IPF-FIRST-TIME = "Y"
                  MOVE 9 TO REB-SUB
                  COMPUTE REB-TOTCHG = LN-MAINTFEE * LN-ORGTERM
                  MOVE LN-ORGTERM TO REB-ORGTERM
                  MOVE LP-PAYDATE TO REB-PAYDATE
                  PERFORM REBATE
                  MOVE REB-REBATE TO IPF-MAINTFEE-REBATE
                  MOVE "SNNN062MAINTFEE." TO VDU
                  MOVE IPF-MAINTFEE-REBATE  TO VDUNUM2
                  PERFORM SCREENIO
               ELSE
                  MOVE "SNNN062MAINTFEE." TO VDU
                  MOVE LN-ANTICERN(4)   TO VDUNUM2
                  PERFORM SCREENIO.

      *-----------------------------------------------------------------
       IPF-DLR-RECOURSE.
           MOVE "ENTER RECOURSE CODE, F7-EXIT" TO MESS.
           PERFORM SEND-WLEGEND.
           MOVE "E  A010RECOURSE." TO VDU.
           PERFORM SCREENIO.
           IF F1-KEY
              GO TO IPF-PURCHASE-FIELD-RESET.

           IF F7-KEY
              PERFORM IPF-RESET-ORIG-LN
              GO TO IPF-PURCHASE-FIELDS-END.

           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO IPF-DLR-RECOURSE.

           IF NOT (VDUBUF = "F" OR "P" OR "N")
              MOVE "ENTER F-FULL, P-PARTIAL, N-NONE" TO MESS
              PERFORM SEND-MESS
              GO TO IPF-DLR-RECOURSE.

           MOVE VDUBUF TO LN-DLRECOURSE.

           IF LN-DLRECOURSE NOT  = "P"
              MOVE 0 TO LN-DLPARTRCAMT
              MOVE "S  A080PARTIALAMT." TO VDU
              MOVE SPACES TO VDUBUF
              PERFORM SCREENIO
              GO TO IPF-DLR-RESERVE1.

       IPF-PARTIAL-AMOUNT.
           MOVE "ENNN062PARTIALAMT." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO IPF-PURCHASE-FIELD-RESET.
           IF NOT (VDUSTATUS = "00" OR "LD")
              GO TO IPF-PARTIAL-AMOUNT.

           MOVE VDUNUM2 TO LN-DLPARTRCAMT.


           IF LN-DLPARTRCAMT > LP-CURBAL
              MOVE "RECOURSE AMOUNT CAN NOT BE HIGHER THAN BALANCE"
                                                               TO MESS
              PERFORM SEND-MESS
              GO TO IPF-PARTIAL-AMOUNT.

      *C   IF LN-DLPARTRCAMT > LN-CURBAL
      *C      MOVE "RECOURSE AMOUNT CAN NOT BE HIGHER THAN BALANCE"
      *C                                                       TO MESS
      *CS     PERFORM SEND-MESS
      *CS     GO TO IPF-PARTIAL-AMOUNT.

           IF LN-DLPARTRCAMT = 0
              GO TO IPF-PARTIAL-AMOUNT.

       IPF-DLR-RESERVE1.
           IF GP-DLRVPRIN-1-FG NOT = "Y"
              MOVE "SNNN062PRIN1." TO VDU
              MOVE 0 TO VDUNUM2
              PERFORM SCREENIO
              MOVE VDUNUM2 TO LN-DLRVPRIN(1)
              GO TO IPF-DLR-RESERVE2.

           MOVE "ENTER RESERVE PRINCIPAL 1" TO MESS.
           PERFORM SEND-WLEGEND.

           MOVE "ENNN062PRIN1." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO IPF-DLR-RECOURSE.
           IF NOT (VDUSTATUS = "00" OR "LD")
              GO TO IPF-DLR-RESERVE1.

           MOVE VDUNUM2 TO LN-DLRVPRIN(1).

           PERFORM IPF-DISBURSEMENT-PROOF.


       IPF-DLR-RESERVE2.
           IF  GP-DLRVPRIN-2-FG NOT = "Y"
              MOVE "SNNN062PRIN2." TO VDU
              MOVE 0 TO VDUNUM2
              PERFORM SCREENIO
              MOVE VDUNUM2 TO LN-DLRVPRIN(2)
              GO TO IPF-UNEARN-INT.

           MOVE "ENTER RESERVE PRINCIPAL 2" TO MESS.
           PERFORM SEND-WLEGEND.
           MOVE "ENNN062PRIN2." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              IF GP-DLRVPRIN-1-FG = "Y"
                 GO TO IPF-DLR-RESERVE1
              ELSE
                 GO TO IPF-DLR-RECOURSE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO IPF-DLR-RESERVE2.

           MOVE VDUNUM2 TO LN-DLRVPRIN(2).

           PERFORM IPF-DISBURSEMENT-PROOF.

       IPF-UNEARN-INT.
           IF (LN-LOANTYPE NOT = "P") OR
              (LN-INT-REBATE = "Y" )
              IF (VDUSTATUS = "1U")
                 GO TO IPF-DLR-RESERVE2
              ELSE
                 GO TO IPF-UNEARN-DISC.

           IF LN-LOANTYPE NOT = "P"   OR
                 LN-INT-REBATE NOT = " "
                 MOVE "SNNN062ANTIC-INT." TO VDU
                 MOVE 0 TO VDUNUM2 LN-ANTICERN(1)
                 PERFORM SCREENIO
                 PERFORM IPF-DISBURSEMENT-PROOF
                 GO TO IPF-UNEARN-DISC.

           MOVE "ENTER ANTIC INTEREST" TO MESS.
           PERFORM SEND-WLEGEND.

           MOVE "ENNN062ANTIC-INT." TO VDU
           PERFORM SCREENIO.

           IF VDUSTATUS = "1U"
              IF GP-DLRVPRIN-2-FG = "Y"
                 GO TO IPF-DLR-RESERVE2
              ELSE
                 IF GP-DLRVPRIN-1-FG = "Y"
                    GO TO IPF-DLR-RESERVE1
                 ELSE
                    GO TO IPF-DLR-RECOURSE.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO IPF-UNEARN-INT.

            MOVE VDUNUM2 TO LN-ANTICERN(1).

           PERFORM IPF-DISBURSEMENT-PROOF.

       IPF-UNEARN-DISC.
           MOVE "ENTER ANTICIPATED DISCOUNT" TO MESS.
           PERFORM SEND-WLEGEND.

           MOVE "ENNN062ANTIC-DISC." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO IPF-UNEARN-INT.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO IPF-UNEARN-DISC.

           MOVE VDUNUM2 TO LN-ANTICERN(5).

           PERFORM IPF-DISBURSEMENT-PROOF.

       IPF-UNEARN-SERCHG.
           IF (LN-SERCHG = 0) OR
              (LN-SC-REBATE = "Y" )
              IF (VDUSTATUS = "1U")
                 GO TO IPF-UNEARN-DISC
              ELSE
                 GO TO IPF-UNEARN-MF.

           MOVE "ENTER ANTICIPATED SERVICE CHARGE " TO MESS.
           PERFORM SEND-WLEGEND.

           MOVE "ENNN062SERCHG." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1U"
              GO TO IPF-UNEARN-DISC.

           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO IPF-UNEARN-SERCHG.

           MOVE VDUNUM2 TO LN-ANTICERN(3).

           PERFORM IPF-DISBURSEMENT-PROOF.

       IPF-UNEARN-MF.
           IF LN-MAINTFEE = 0  OR
              LN-MF-REBATE = "Y"
              IF VDUSTATUS = "1U"
                 GO TO IPF-UNEARN-SERCHG
              ELSE
                 GO TO IPF-ACCEPT-ROUTINE.

           MOVE "ENTER ANTICIPATED MAINTENANCE FEE" TO MESS.
           PERFORM SEND-WLEGEND.

           MOVE "ENNN062MAINTFEE." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "1U"
              GO TO IPF-UNEARN-SERCHG.

           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO IPF-UNEARN-MF.

           MOVE VDUNUM2 TO LN-ANTICERN(4).

           PERFORM IPF-DISBURSEMENT-PROOF.

       IPF-ACCEPT-ROUTINE.
           IF HOLD-LN-PROCEEDS < 0
              STRING "AMOUNTS EXCEEDS PURCHASE AMOUNT"," "
                     "RE-INPUT PURCHASE FIELDS" DELIMITED BY
                     "  " INTO MESS
              PERFORM SEND-MESS
              GO TO IPF-DLR-RECOURSE.

           MOVE "F1-RESET, ^, F7-UPD:" TO MESS.
           PERFORM SEND-WLEGEND.

           MOVE "E  A010SEL." TO VDU.
           PERFORM SCREENIO.
           IF (VDUSTATUS = "1U")
              GO TO IPF-UNEARN-MF.
           IF VDUSTATUS = "1>"
              PERFORM IPF-ACCEPT-F7
              GO TO IPF-PURCHASE-FIELDS-END.

           IF VDUSTATUS = "10"
              GO TO IPF-PURCHASE-FIELD-RESET.

           IF ( NOT ENTER-KEY ) GO TO IPF-ACCEPT-ROUTINE.

           GO TO IPF-ACCEPT-ROUTINE.

       IPF-DISBURSEMENT-PROOF.

           COMPUTE HOLD-LN-PROCEEDS =
              LP-CURBAL - (LN-DLRVPRIN(1) + LN-DLRVPRIN(2)
                         + LN-ANTICERN(1) + LN-ANTICERN(2)
                          + LN-ANTICERN(3)
                            + LN-ANTICERN(5)).

           IF NOT( GP-INCL-OTH-IN-EARNED-N OR GP-INCL-OTH-IN-EARNED-R)
              SUBTRACT LN-ANTICERN(6) FROM HOLD-LN-PROCEEDS.

           IF NOT(GP-INCL-OTH-IN-EARNED-R)
              SUBTRACT LN-ANTICERN(4) FROM HOLD-LN-PROCEEDS.


           MOVE "S  S062PROCEEDS." TO VDU.
           MOVE HOLD-LN-PROCEEDS TO VDUNUM2.
           PERFORM SCREENIO.

           COMPUTE HOLD-LN-TOT-ANTIC = LN-ANTICERN(1)
                                        + LN-ANTICERN(2)
                                          + LN-ANTICERN(3)
                                            + LN-ANTICERN(5).
           IF NOT(GP-INCL-OTH-IN-EARNED-N OR GP-INCL-OTH-IN-EARNED-R)
              ADD LN-ANTICERN(6) TO HOLD-LN-TOT-ANTIC.

           IF NOT(GP-INCL-OTH-IN-EARNED-R)
              ADD LN-ANTICERN(4) TO HOLD-LN-TOT-ANTIC.


           MOVE "S SN062ANTICEARN."  TO VDU.
           MOVE  HOLD-LN-TOT-ANTIC TO VDUNUM2.
           PERFORM SCREENIO.
      *=================================================================
       IPF-ACCEPT-F7.
      *---SET THE NEW ANTICIPATED TERM-----
           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.
           PERFORM PAID-THRU-CALCULATION.
           MOVE LN-1STPYDATE   TO CEPP1-DATE.
           MOVE PDTH-DATE-FULL TO CEPP2-DATE.
           PERFORM CONTRACTUAL-ELAPSED-PAYPER.
           SUBTRACT CEPP-PERIODS FROM LN-ORGTERM
                                  GIVING LN-ANTICTERM.
           MOVE "N" TO IPF-FIRST-TIME.
           MOVE LP-CURBAL TO IPF-CHECK-CURBAL.
      *---SET ORG/SUM PURCHASE AMT, LN-DLDISC, MIDSTREAM
           MOVE LP-CURBAL       TO LN-ORIGPURAMT LN-SUM-ORIGPURAMT.
           MOVE LN-ANTICERN(5)  TO LN-DLDISC.
           MOVE "Y"             TO LN-MIDSTREAM.
      *=================================================================
       IPF-PURCHASE-FIELDS-END.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY PURFLD-SCREEN.
           PERFORM CLOSE-WINDOW.
           MOVE "LONIF" TO VDU-FORM-NAME.

       IPF-PURCHASE-FIELDS-EXIT.
           EXIT.


      *-{CS}- - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    MOVING 'ORIG' BACK FOR THE PURPOSE OF WHEN F1-RESET, NEED TO
      *    RESTORE ORIGINAL VALUES THAT MAY HAVE CHANGED IN THE
      *    'INPUT-PURCHASE-FIELDS' WINDOW.
      *    12/18/06 - CINDY & BARB STARRED OFF - SEE PROGRAM NOTES
      *               FOR THIS DATE
      *--------- - - - - - - - - - - - - - - - - - - - - - - - - - - - -
       IPF-RESET-ORIG-LN SECTION.
      *    MOVE ORIG-LN-ANTICERN(1)  TO LN-ANTICERN(1).
      *    MOVE ORIG-LN-ANTICERN(3)  TO LN-ANTICERN(3).
      *    MOVE ORIG-LN-ANTICERN(4)  TO LN-ANTICERN(4).
      *    MOVE ORIG-LN-ANTICERN(5)  TO LN-ANTICERN(5).
      *    MOVE ORIG-LN-DLRVPRIN(1)  TO LN-DLRVPRIN(1).
      *    MOVE ORIG-LN-DLRVPRIN(2)  TO LN-DLRVPRIN(2).
      *    MOVE ORIG-LN-DLPARTRCAMT  TO LN-DLPARTRCAMT.
      *    MOVE ORIG-LN-ORGTERM      TO LN-ORGTERM.
      *    MOVE ORIG-LN-MIDSTREAM    TO LN-MIDSTREAM.
      *    MOVE ORIG-LN-DLDISC       TO LN-DLDISC.
      *    DO I NEED TO SAVE THESE ????? ALTERED IN IPF-ACCEPT-F7
      *    MOVE ORIG-LN-CURBAL       TO LN-CURBAL.
      *    MOVE ORIG-LN-ORIGPURAMT   TO LN-ORIGPURAMT.


      *    MOVE "Y"                  TO IPF-FIRST-TIME.

       IPF-RESET-F1-EXIT.
           EXIT.

      *****************************************
       RESTORE-SCREEN SECTION.
      *****************************************
           MOVE 3 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF NEW-PROG-FORM NOT = OLD-PROG-FORM
              MOVE OLD-PROG-FORM TO WK-OLD-PROG-FORM.
           MOVE NEW-PROG-FORM TO OLD-PROG-FORM.
           IF IO-FG = 0
              GO TO RESTORE-CLEAR.

           MOVE " " TO WK-SAVE-RECORD.
           MOVE 0 TO WK-ELE.
           PERFORM WRITE-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           GO TO EXIT-RESTORE-SCREEN.
       RESTORE-CLEAR.
           IF WK-ELE NOT = 0
              SUBTRACT 1 FROM WK-ELE GIVING FIRST-ELE.
           MOVE WK-SAVE-RECORD TO LN-REC.
           MOVE 0 TO WK-ELE.
           PERFORM REWRITE-WK-FILE.
       EXIT-RESTORE-SCREEN.
           IF FIRST-ELE = 0
              MOVE 0 TO NEW-FLAG
           ELSE
              MOVE 1 TO NEW-FLAG.
           PERFORM CLOSE-WK-FILE.

      ******************************************************************
       MSCBAL-WINDOW SECTION.
      ******************************************************************

      * WINDOW FOR MULTIPLE ENTRIES FOR OTHER AND INT/LC BALANCES.
      * ALLOWS ENTRY OF OTHER/OTHER2 BALANCES OR INTEREST/LATE CHARGE
      * BALANCES.

           MOVE 7 TO WINDOW-LINES.
           MOVE 32 TO WINDOW-COLUMNS.
           MOVE 14 TO WINDOW-BEGIN-Y.
           MOVE 42 TO WINDOW-BEGIN-X.
           MOVE " " TO WINDOW-FIT-TO.
           MOVE "WI/MSCBAL" TO WINDOW-FORM-NAM.
           MOVE "MSCBAL" TO VDU-FORM-NAME.

           PERFORM OPEN-WINDOW.
           DISPLAY MSCBAL-SCREEN.

           MOVE MSCBAL-FORM-FIELDS TO WR-BUF.
           MOVE MSCBAL-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.

       DISPLAY-MSCBAL-FIELDS.
      *    -------------------------------------------------------------
      *    MSCBAL-TYPE:    "O" - OTHER BAL'S
      *                    "I" - INT/LC BAL'S
      *    -------------------------------------------------------------
           IF MSCBAL-TYPE = "O"
              MOVE MSCBAL-TITLE1 TO MSCBAL-BUF-TITLE
              MOVE MSCBAL-OTH-PROMPT TO MSCBAL-PROMPT1
              MOVE MSCBAL-OT2-PROMPT TO MSCBAL-PROMPT2
           ELSE
              MOVE MSCBAL-TITLE2 TO MSCBAL-BUF-TITLE
              MOVE MSCBAL-INT-PROMPT TO MSCBAL-PROMPT1
              MOVE MSCBAL-LC-PROMPT TO MSCBAL-PROMPT2.

           MOVE MSCBAL-NUM1 TO MSCBAL-BAL-1.
           MOVE MSCBAL-NUM2 TO MSCBAL-BAL-2.

           MOVE MSCBAL-BUF TO WR-BUF.
           MOVE MSCBAL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
           PERFORM DISPLAY-MSCBAL-TOTAL.

      *-----------------------------------------------------------------
      * ENTER OTHER/INTEREST BALANCE
      *-----------------------------------------------------------------
       ENTER-BAL-1.
           MOVE "E NS052011." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1>" AND MSCBAL-TYPE = "O"
              GO TO EXIT-MSCBAL-WINDOW.
           IF VDUNUM2 NOT = 0
              IF MSCBAL-TYPE = "O" AND FST-TIME = "Y"
                                    AND VDUSTATUS NOT = "1D"
                 MOVE OT-SEQ TO PASSWDW-SEQ
                 MOVE "TO ASSESS OTHER CHARGES" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 MOVE "N" TO FST-TIME
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "CANNOT ASSESS OTHER CHARGES WITHOUT PASSWORD"
                                                           TO MESS
                    PERFORM SEND-MESS
                    MOVE "7" TO ROUTE-CD
                    MOVE "Y" TO FST-TIME
                    GO TO EXIT-MSCBAL-WINDOW.
           IF VDUSTATUS = "10"
              PERFORM CLEAR-MSCBAL-WINDOW
              GO TO DISPLAY-MSCBAL-FIELDS.
           IF VDUSTATUS = "1>" GO TO EXIT-MSCBAL-WINDOW.
           IF VDUSTATUS = "1U"
              MOVE VDUSTATUS TO MSCBAL-STATUS
              GO TO EXIT-MSCBAL-WINDOW.
           IF VDUSTATUS NOT = "00" AND NOT = "1D" GO TO ENTER-BAL-1.
           MOVE VDUNUM2 TO MSCBAL-BAL-1 MSCBAL-NUM1.
           PERFORM DISPLAY-MSCBAL-TOTAL.

      *-----------------------------------------------------------------
      *ENTER OTHER 2/LATE CHARGE BALANCE
      *-----------------------------------------------------------------
       ENTER-BAL-2.
           MOVE "E NS052021." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM CLEAR-MSCBAL-WINDOW
              GO TO DISPLAY-MSCBAL-FIELDS.
           IF VDUSTATUS = "1U" GO TO ENTER-BAL-1.
           IF VDUSTATUS = "1>" GO TO EXIT-MSCBAL-WINDOW.
           IF VDUSTATUS NOT = "00" AND NOT = "1D" GO TO ENTER-BAL-2.
           MOVE VDUNUM2 TO MSCBAL-BAL-2 MSCBAL-NUM2.
           PERFORM DISPLAY-MSCBAL-TOTAL.
           IF MSCBAL-TYPE = "O"
              MOVE "Y" TO FST-TIME.

           GO TO ENTER-BAL-1.

       DISPLAY-MSCBAL-TOTAL.
           COMPUTE MSCBAL-NUM3 = MSCBAL-NUM1 + MSCBAL-NUM2.
           MOVE MSCBAL-NUM3 TO MSCBAL-BUF-TOTAL.
           MOVE "S  S062TOTAL." TO VDU.
           MOVE MSCBAL-BUF-TOTAL TO VDUNUM2.
           PERFORM SCREENIO.

       CLEAR-MSCBAL-WINDOW.
           MOVE 0 TO MSCBAL-NUM1 MSCBAL-NUM2 MSCBAL-NUM3
                                 MSCBAL-BUF-TOTAL.

       EXIT-MSCBAL-WINDOW.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY MSCBAL-SCREEN.
           PERFORM CLOSE-WINDOW.
           MOVE "LONIF" TO VDU-FORM-NAME.

      ******************************************************************
       UPDATE-TY1-FILE SECTION.
      ******************************************************************
           IF LN-CURBAL = 0
              GO TO SKIP-UPDATE-TY1-FILE.

           MOVE "UPDATING TODAY'S TOTAL FILE............." TO MESS.
           PERFORM SEND-LEGEND.
           PERFORM OPEN-TY1-FILE.
           MOVE "N" TO REC-EXISTS.
       TY-CHECK-EXISTS.
           PERFORM SET-TY-KEY.
           PERFORM READ-TY1-FILE.
           IF IO-FG = 0
              GO TO TY-UPDATE-REC.
           IF REC-EXISTS = "Y"
              GO TO IO-ERROR.

           MOVE "Y" TO REC-EXISTS.
           PERFORM CLEAR-TY-FILE.
           PERFORM SET-TY-KEY.
           PERFORM WRITE-TY1-FILE.
           IF IO-FG = 9 AND E-CODE NOT = "22"
              GO TO IO-ERROR.
           GO TO TY-CHECK-EXISTS.

       TY-UPDATE-REC.
           IF BULK-CONVERSION-FG = "B"
              PERFORM BULK-PURCHASE-TY
           ELSE
              PERFORM NORMAL-CONV-TY.

           PERFORM REWRITE-TY1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.

       UPDATE-TY1-FILE-EXIT.
           PERFORM CLOSE-TY1-FILE.
       SKIP-UPDATE-TY1-FILE.
           EXIT.

      ******************************************************************
       BULK-PURCHASE-TY SECTION.
      ******************************************************************

      * BULK PURCHASE SECTION ACTS LIKE A TP SO VOLUME NUMBERS, RESERVE(VOLUME,
      * GAIN/LOSS) DISCOUNT, NUMBER & AMOUNT OF MIDSTREAMS ARE UPDATED.

           PERFORM SET-DELINQUENCY.
           PERFORM GET-SRCD-SUB.

      * IF ACCOUNT IS NOT IN P&L AND THE ACCOUNT IS NOT IN REPO OR
      * IS REDEEMED
           IF SRCD-NOT-PL AND (LN-REPOCD = " " OR "V")
              ADD 1 TO TY-NO(1 SRCD), TY-NO(2,SRCD)
              ADD LN-CURBAL TO TY-AMT(1 SRCD), TY-AMT(2,SRCD)
              ADD LN-OT2BAL TO TY-O2(1 SRCD),  TY-O2(2,SRCD)
      *       ADD LN-INTCHG TO TY-INT(1 SRCD), TY-INT(2,SRCD)
              ADD LN-EXTCHG TO TY-INT(1 SRCD), TY-INT(2,SRCD)

      * UPDATE DELINQUENCY NORMAL:
              IF GP-DELINQ-WITH-O2 = "Y"
                 MOVE LN-CURBAL TO SAVE-OUTBAL
              ELSE
                 SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL
              END-IF
              ADD 1           TO TY-UNITS(1 RDSUB)
                                 TY-UNITS(2 CSUB)
              ADD SAVE-OUTBAL TO TY-OUTBAL(1 RDSUB)
                                 TY-OUTBAL(2 CSUB)
      * UPDATE DELINQUENCY BANKRUPT:
              IF LN-BNKRPTDATE NOT = 0
                 ADD 1           TO TY-UNITS-BNKRPT(1 RDSUB)
                                    TY-UNITS-BNKRPT(2 CSUB)
                 ADD SAVE-OUTBAL TO TY-OUTBAL-BNKRPT(1 RDSUB)
                                    TY-OUTBAL-BNKRPT(2 CSUB).

           ADD LN-ORGTERM TO TY-SUMWGTTM.
           ADD LN-LNAMT   TO TY-SUMWGTAV.
           COMPUTE TY-SUMWGTTA =
                 TY-SUMWGTTA + (LN-ORGTERM * LN-LNAMT).

      *UPDATE RESERVES,DISCOUNT REGARDLESS OF ACTIVE, REPO, OR
      *PL STATUS

       BP-RESERVE-TY-UPD.
            ADD LN-DLRVPRIN(1) TO TY-DLRVPRIN(1,1)
                                  TY-DLRVPRIN(2,1).
            ADD LN-DLRVPRIN(2) TO TY-DLRVPRIN(1,2)
                                  TY-DLRVPRIN(2,2).
            ADD LN-DLDISC      TO TY-DLDISC.
            ADD LN-CURBAL      TO TY-AMT-PURCH.
            ADD 1              TO TY-NO-PURCH.

      * BULK-PURCHASE-TY
      * UPDATE PROCEEDS: WE DO NOT CARE ABOUT ACCOUNT STATUS. WE ARE
      *                  TAKING PROCEEDS REGARDLESS OF ACCOUNT STATUS

           IF GP-UNEARNED-STATS = "Y"
              ADD LN-PROCEEDS TO TY-PROCEEDS
      * UPDATE UNEARNED STATISTICS NET AND VOLUME
              PERFORM COMPUTE-EARNINGS
              ADD EARN-UNEARN(1) TO TY-UNEARNED-AMT(1 1)
              ADD LN-ANTICERN(1) TO TY-UNEARNED-AMT(2 1)
              ADD EARN-UNEARN(2) TO TY-UNEARNED-AMT(1 2)
              ADD LN-ANTICERN(2) TO TY-UNEARNED-AMT(2 2)
              ADD EARN-UNEARN(3) TO TY-UNEARNED-AMT(1 3)
              ADD LN-ANTICERN(3) TO TY-UNEARNED-AMT(2 3)
              ADD EARN-UNEARN(5) TO TY-UNEARNED-AMT(1 5)
              ADD LN-ANTICERN(5) TO TY-UNEARNED-AMT(2 5)
              IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                         GP-INCL-OTH-IN-EARNED-R)
                 ADD EARN-UNEARN(6) TO TY-UNEARNED-AMT(1 6)
                 ADD LN-ANTICERN(6) TO TY-UNEARNED-AMT(2 6)
              IF NOT(GP-INCL-OTH-IN-EARNED-R)
                 ADD EARN-UNEARN(4) TO TY-UNEARNED-AMT(1 4)
                 ADD LN-ANTICERN(4) TO TY-UNEARNED-AMT(2 4).


       BULK-PURCHASE-TY-EXIT.
           EXIT.


      ***********************************************
       NORMAL-CONV-TY SECTION.
      ***********************************************

      * THIS IS THE NORMAL CONVERSION WHERE ONLY GAIN/LOSS ACTIVITY IS
      * UPDATED

           PERFORM SET-DELINQUENCY.
           PERFORM GET-SRCD-SUB.

      * IF ACCOUNT IS NOT IN P&L AND THE ACCOUNT IS NOT IN REPO OR
      * IS REDEEMED
           IF SRCD-NOT-PL AND (LN-REPOCD = " " OR "V")
              ADD 1 TO TY-NO(1 SRCD)
              ADD LN-CURBAL TO TY-AMT(1 SRCD)
              ADD LN-OT2BAL TO TY-O2(1 SRCD)
              ADD LN-INTCHG TO TY-INT(1 SRCD)
              ADD LN-EXTCHG TO TY-INT(1 SRCD)

      *  UPDATE DELINQUENCY NORMAL:
              IF GP-DELINQ-WITH-O2 = "Y"
                 MOVE LN-CURBAL TO SAVE-OUTBAL
              ELSE
                 SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL
              END-IF
              ADD 1           TO TY-UNITS(1 RDSUB)
                                 TY-UNITS(2 CSUB)
              ADD SAVE-OUTBAL TO TY-OUTBAL(1 RDSUB)
                                 TY-OUTBAL(2 CSUB)
      *   UPDATE DELINQUENCY BANKRUPT:
              IF LN-BNKRPTDATE NOT = 0
                 ADD 1           TO TY-UNITS-BNKRPT(1 RDSUB)
                                    TY-UNITS-BNKRPT(2 CSUB)
                 ADD SAVE-OUTBAL TO TY-OUTBAL-BNKRPT(1 RDSUB)
                                    TY-OUTBAL-BNKRPT(2 CSUB).

           IF SRCD-NOT-PL
              ADD LN-ORGTERM TO TY-SUMWGTTM
              ADD LN-LNAMT TO TY-SUMWGTAV
              COMPUTE TY-SUMWGTTA =
                 TY-SUMWGTTA + (LN-ORGTERM * LN-LNAMT).

           IF SRCD-IS-PL
              ADD 1 TO TY-NO-PL(1 SRCD)
              ADD LN-CURBAL TO TY-AMT-PL(1 SRCD)
              ADD LN-OT2BAL TO TY-O2-PL(1 SRCD)
              ADD LN-INTCHG TO TY-INT-PL(1 SRCD)
              ADD LN-EXTCHG TO TY-INT-PL(1 SRCD)
      * - ONHAND OR SOLD REPO IN P&L RECEIVABLES:
              IF LN-REPOCD = "X" OR "S"
                 IF LN-REPOCD = "X"
                    ADD 1 TO TY-NO-REPO(1 4)
                    ADD LN-CURBAL TO TY-AMT-REPO(1 4)
                    ADD LN-OT2BAL TO TY-O2-REPO(1 4)
                    ADD LN-INTCHG TO TY-INT-REPO(1 4)
                    ADD LN-EXTCHG TO TY-INT-REPO(1 4)
                 ELSE
                    ADD 1 TO TY-NO-REPO(1 5)
                    ADD LN-CURBAL TO TY-AMT-REPO(1 5)
                    ADD LN-OT2BAL TO TY-O2-REPO(1 5)
                    ADD LN-INTCHG TO TY-INT-REPO(1 5)
                    ADD LN-EXTCHG TO TY-INT-REPO(1 5).

       REPO-TY1-UPD.
           IF LN-REPOCD = "X" OR "S"
              IF SRCD-NOT-PL
                 IF LN-REPOCD = "X"
                    MOVE 1 TO SRCD
                 ELSE
                    MOVE 3 TO SRCD
                 END-IF
                 ADD 1 TO TY-NO-REPO(1 SRCD)
                 ADD LN-CURBAL TO TY-AMT-REPO(1 SRCD)
                 ADD LN-OT2BAL TO TY-O2-REPO(1 SRCD)
                 ADD LN-INTCHG TO TY-INT-REPO(1 SRCD)
                 ADD LN-EXTCHG TO TY-INT-REPO(1 SRCD).

      * NORMAL-CONV-TY
      * UPDATE UNEARNED STATISTICS NET

           IF GP-UNEARNED-STATS = "Y"
              PERFORM COMPUTE-EARNINGS
              ADD EARN-UNEARN(1) TO TY-UNEARNED-AMT(1 1)
              ADD EARN-UNEARN(2) TO TY-UNEARNED-AMT(1 2)
              ADD EARN-UNEARN(3) TO TY-UNEARNED-AMT(1 3)
              ADD EARN-UNEARN(5) TO TY-UNEARNED-AMT(1 5)
              IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                       GP-INCL-OTH-IN-EARNED-R)
                 ADD EARN-UNEARN(6) TO TY-UNEARNED-AMT(1 6)
              IF NOT (GP-INCL-OTH-IN-EARNED-R)
                 ADD EARN-UNEARN(4) TO TY-UNEARNED-AMT(1 4).


       NORMAL-CONV-TY-EXIT.
           EXIT.

      ******************************************************************
       UPDATE-TY1-FILE-REV SECTION.
      ******************************************************************

      *    UPDATE TODAYS TOTALS : REVERSALS

           IF LN-CURBAL = 0
              GO TO SKIP-UPDATE-TY1-FILE-REV.

           MOVE "UPDATING TODAY'S TOTAL FILE............." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-TY1-FILE.
           MOVE "N" TO REC-EXISTS.
       TY-CHECK-EXISTS-REV.
           PERFORM SET-TY-KEY.
           PERFORM READ-TY1-FILE.
           IF IO-FG = 0
              GO TO TY-UPDATE-REC-REV.
           IF REC-EXISTS = "Y"
              GO TO IO-ERROR.

           MOVE "Y" TO REC-EXISTS.
           PERFORM CLEAR-TY-FILE.
           PERFORM SET-TY-KEY.
           PERFORM WRITE-TY1-FILE.
           IF IO-FG = 9 AND E-CODE NOT = "22"
              GO TO IO-ERROR.
           GO TO TY-CHECK-EXISTS-REV.
      *--{CS}--------------
       TY-UPDATE-REC-REV.
           IF BULK-CONVERSION-FG = "B"
              PERFORM BULK-PURCHASE-TY-UPD-REV
           ELSE
              PERFORM NORMAL-CONV-TY-UPD-REV.

           PERFORM REWRITE-TY1-FILE.
           IF IO-FG NOT = 0
              GO TO IO-ERROR.
       UPDATE-TY-EXIT-REV.
           PERFORM CLOSE-TY1-FILE.
       SKIP-UPDATE-TY1-FILE-REV.
           EXIT.

      ***********************************************
       BULK-PURCHASE-TY-UPD-REV SECTION.
      ***********************************************

      * BULK PURCHASE ACTS LIKE A TP TRANSACTION SO VOLUME NUMBER, RESERVE
      * (VOLUME, GAIN/LOSS, DISCOUNT MUST BE REVERSED OUT

           PERFORM SET-DELINQUENCY.
           PERFORM GET-SRCD-SUB.

      * IF ACCOUNT IS NOT IN P&L AND
      * THE ACCOUNT IS NOT IN REPO OR IS REDEEMED

           IF SRCD-NOT-PL AND (LN-REPOCD = " " OR "V")
      * UPDATE DELINQUENCY:
              IF GP-DELINQ-WITH-O2 = "Y"
                 MOVE LN-CURBAL TO SAVE-OUTBAL
              ELSE
                 SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL
              END-IF
              SUBTRACT 1 FROM TY-UNITS(1 RDSUB)
                              TY-UNITS(2 CSUB)
              SUBTRACT SAVE-OUTBAL FROM TY-OUTBAL(1 RDSUB)
                                        TY-OUTBAL(2 CSUB)

              SUBTRACT 1 FROM TY-NO(1 SRCD) TY-NO(2,SRCD)
              SUBTRACT LN-CURBAL FROM TY-AMT(1 SRCD), TY-AMT(2,SRCD)
              SUBTRACT LN-OT2BAL FROM TY-O2(1 SRCD), TY-O2(2,SRCD)
              SUBTRACT LN-EXTCHG FROM TY-INT(1 SRCD),TY-INT(2 SRCD).

           SUBTRACT LN-ORGTERM FROM TY-SUMWGTTM.
           SUBTRACT LN-LNAMT FROM TY-SUMWGTAV.
           COMPUTE TY-SUMWGTTA =
              TY-SUMWGTTA - (LN-ORGTERM * LN-LNAMT).

      * REVERSE RESERVES,DISCOUNT REGARDLESS OF ACTIVE, REPO, OR
      * PL STATUS ON BULK PURCHASE

       BP-RESERVE-TY-UPD-REV.
                 SUBTRACT LN-DLRVPRIN(1) FROM  TY-DLRVPRIN(1,1)
                                               TY-DLRVPRIN(2,1).
                 SUBTRACT LN-DLRVPRIN(2) FROM  TY-DLRVPRIN(1,2)
                                               TY-DLRVPRIN(2,2).
                 SUBTRACT  LN-DLDISC     FROM  TY-DLDISC.
                 SUBTRACT  LN-CURBAL     FROM  TY-AMT-PURCH.
                 SUBTRACT 1              FROM  TY-NO-PURCH.

      * UPDATE PROCEEDS: WE DO NOT CARE ABOUT ACCOUNT STATUS. WE ARE
      *                  TAKING PROCEEDS REGARDLESS OF ACCOUNT STATUS

           IF GP-UNEARNED-STATS = "Y"
              SUBTRACT LN-PROCEEDS FROM TY-PROCEEDS
      * BULK-PURCHASE-TY-UPD-REV
      * UPDATE UNEARNED STATISTICS NET AND VOLUME
              PERFORM COMPUTE-EARNINGS
              SUBTRACT EARN-UNEARN(1) FROM TY-UNEARNED-AMT(1 1)
              SUBTRACT LN-ANTICERN(1) FROM TY-UNEARNED-AMT(2 1)
              SUBTRACT EARN-UNEARN(2) FROM TY-UNEARNED-AMT(1 2)
              SUBTRACT LN-ANTICERN(2) FROM TY-UNEARNED-AMT(2 2)
              SUBTRACT EARN-UNEARN(3) FROM TY-UNEARNED-AMT(1 3)
              SUBTRACT LN-ANTICERN(3) FROM TY-UNEARNED-AMT(2 3)
              SUBTRACT EARN-UNEARN(5) FROM TY-UNEARNED-AMT(1 5)
              SUBTRACT LN-ANTICERN(5) FROM TY-UNEARNED-AMT(2 5)
              IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                       GP-INCL-OTH-IN-EARNED-R)
                SUBTRACT EARN-UNEARN(6) FROM TY-UNEARNED-AMT(1 6)
                SUBTRACT LN-ANTICERN(6) FROM TY-UNEARNED-AMT(2 6)
                IF NOT (GP-INCL-OTH-IN-EARNED-R)
                  SUBTRACT EARN-UNEARN(4) FROM TY-UNEARNED-AMT(1 4)
                  SUBTRACT LN-ANTICERN(4) FROM TY-UNEARNED-AMT(2 4).

       BULK-PURCHASE-TY-UPD-REV-EXIT.
           EXIT.

      ***************************************************
       NORMAL-CONV-TY-UPD-REV SECTION.
      ***************************************************

      * THIS IS THE NORMAL CONVERSION WHERE ONLY GAIN/LOSS ACTIVITY IS
      * UPDATED

           PERFORM SET-DELINQUENCY.
           PERFORM GET-SRCD-SUB.

      * IF ACCOUNT IS NOT IN P&L AND THE ACCOUNT IS NOT IN REPO OR
      * IS REDEEMED

           IF SRCD-NOT-PL AND (LN-REPOCD = " " OR "V")
      *  UPDATE DELINQUENCY:
              IF GP-DELINQ-WITH-O2 = "Y"
                 MOVE LN-CURBAL TO SAVE-OUTBAL
              ELSE
                 SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL
              END-IF
              SUBTRACT 1 FROM TY-UNITS(1 RDSUB)
                              TY-UNITS(2 CSUB)
              SUBTRACT SAVE-OUTBAL FROM TY-OUTBAL(1 RDSUB)
                                        TY-OUTBAL(2 CSUB)
              SUBTRACT 1 FROM TY-NO(1 SRCD)
              SUBTRACT LN-CURBAL FROM TY-AMT(1 SRCD)
              SUBTRACT LN-OT2BAL FROM TY-O2(1 SRCD)
              SUBTRACT LN-INTCHG FROM TY-INT(1 SRCD)
              SUBTRACT LN-EXTCHG FROM TY-INT(1 SRCD).

           IF SRCD-NOT-PL
              SUBTRACT LN-ORGTERM FROM TY-SUMWGTTM
              SUBTRACT LN-LNAMT FROM TY-SUMWGTAV
              COMPUTE TY-SUMWGTTA =
                 TY-SUMWGTTA - (LN-ORGTERM * LN-LNAMT).

           IF SRCD-IS-PL
              SUBTRACT 1 FROM TY-NO-PL(1 SRCD)
              SUBTRACT LN-CURBAL FROM TY-AMT-PL(1 SRCD)
              SUBTRACT LN-OT2BAL FROM TY-O2-PL(1 SRCD)
              SUBTRACT LN-INTCHG FROM TY-INT-PL(1 SRCD)
              SUBTRACT LN-EXTCHG FROM TY-INT-PL(1 SRCD)
      * - ONHAND OR SOLD REPO IN P&L RECEIVABLES:
              IF LN-REPOCD = "X" OR "S"
                 IF LN-REPOCD = "X"
                    SUBTRACT 1 FROM TY-NO-REPO(1 4)
                    SUBTRACT LN-CURBAL FROM TY-AMT-REPO(1 4)
                    SUBTRACT LN-OT2BAL FROM TY-O2-REPO(1 4)
                    SUBTRACT LN-INTCHG FROM TY-INT-REPO(1 4)
                    SUBTRACT LN-EXTCHG FROM TY-INT-REPO(1 4)
                 ELSE
                    SUBTRACT 1 FROM TY-NO-REPO(1 5)
                    SUBTRACT LN-CURBAL FROM TY-AMT-REPO(1 5)
                    SUBTRACT LN-OT2BAL FROM TY-O2-REPO(1 5)
                    SUBTRACT LN-INTCHG FROM TY-INT-REPO(1 5)
                    SUBTRACT LN-EXTCHG FROM TY-INT-REPO(1 5).

       REPO-TY1-UPD.
           IF LN-REPOCD = "X" OR "S"
              IF SRCD-NOT-PL
                 IF LN-REPOCD = "X"
                    MOVE 1 TO SRCD
                 ELSE
                    MOVE 3 TO SRCD
                 END-IF
                 SUBTRACT 1 FROM TY-NO-REPO(1 SRCD)
                 SUBTRACT LN-CURBAL FROM TY-AMT-REPO(1 SRCD)
                 SUBTRACT LN-OT2BAL FROM TY-O2-REPO(1 SRCD)
                 SUBTRACT LN-INTCHG FROM TY-INT-REPO(1 SRCD)
                 SUBTRACT LN-EXTCHG FROM TY-INT-REPO(1 SRCD).

      * NORMAL-CONV-TY-UPD-REV
      * UPDATE UNEARNED STATISTICS NET
      *        THE UNEARNEDS WERE TALLYED IN LOGIC IN BAR-ENTRY-ROUTINE
      *        WHICH PERFORMED COMPUTE-EARNINGS BEFORE THEY WERE CLEARED

           IF GP-UNEARNED-STATS = "Y"
              SUBTRACT HOLD-RV-UNEARN(1) FROM TY-UNEARNED-AMT(1 1)
              SUBTRACT HOLD-RV-UNEARN(2) FROM TY-UNEARNED-AMT(1 2)
              SUBTRACT HOLD-RV-UNEARN(3) FROM TY-UNEARNED-AMT(1 3)
              SUBTRACT HOLD-RV-UNEARN(5) FROM TY-UNEARNED-AMT(1 5)

              IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                           GP-INCL-OTH-IN-EARNED-R)
                 SUBTRACT HOLD-RV-UNEARN(6) FROM TY-UNEARNED-AMT(1 6)

              IF NOT (GP-INCL-OTH-IN-EARNED-R)
                 SUBTRACT HOLD-RV-UNEARN(4) FROM TY-UNEARNED-AMT(1 4).


       NORMAL-CONV-TY-UPD-REV-EXIT.
           EXIT.

      ******************************************************************
       UPDATE-DS1-FILE SECTION.
      ******************************************************************
           IF LN-CURBAL = 0
              GO TO SKIP-UPDATE-DS1-FILE.

           MOVE "UPDATING DEALER STATISTICS FILE........." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-DS1-FILE.
           MOVE "N" TO REC-EXISTS.
       DS1-CHECK-EXISTS.
           PERFORM SET-DS1-KEY.
           PERFORM READ-DS1-FILE.
           IF IO-FG = 0
              MOVE "Y" TO REC-EXISTS
              GO TO DS1-UPDATE-REC.
           PERFORM CLEAR-DS-FILE.
           PERFORM SET-DS1-KEY.

       DS1-UPDATE-REC.
           IF BULK-CONVERSION-FG = "B"
              PERFORM BULK-PURCHASE-DS
           ELSE
              PERFORM NORMAL-CONV-DS.

           IF REC-EXISTS = "Y"
              PERFORM REWRITE-DS1-FILE
           ELSE
              PERFORM WRITE-DS1-FILE.

           IF IO-FG NOT = 0
              GO TO IO-ERROR.

       EXIT-UPDATE-DS1.
           PERFORM CLOSE-DS1-FILE.
       SKIP-UPDATE-DS1-FILE.
           EXIT.

      ************************************************
       BULK-PURCHASE-DS SECTION.
      ************************************************

      * BULK PURCHASE SECTION ACTS LIKE A TP SO VOLUME NUMBERS, RESERVE(VOLUME,
      * GAIN/LOSS) DISCOUNT.  ON THE NORMAL CONVERSION ONLY GAIN/LOSS NUMBERS
      * ARE UPDATED

      * IF ACCOUNT IS NOT IN P&L AND
      *    THE ACCOUNT IS NOT IN REPO OR IT IS REDEEMED.

           IF LN-PLCD = " " AND (LN-REPOCD = " " OR "V")
              ADD 1 TO DS-OUTSUNIT(1),DS-NPURUNIT(1)
                                      DS-NPURUNIT(2)
              ADD LN-CURBAL TO DS-OUTSAMT(1),DS-NPURAMT(1)
                                             DS-NPURAMT(2)
      * UPDATE DELINQUENCY NORMAL:
              IF GP-DELINQ-WITH-O2 = "Y"
                 MOVE LN-CURBAL TO SAVE-OUTBAL
              ELSE
                 SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL
              END-IF
              ADD 1           TO DS-UNITS(DSNOW DSREC RDSUB)
                                 DS-UNITS(DSNOW DSCON CSUB)
              ADD SAVE-OUTBAL TO DS-OUTBAL(DSNOW DSREC RDSUB)
                                 DS-OUTBAL(DSNOW DSCON CSUB)
      * UPDATE DELINQUENCY BANKRUPT:
              IF LN-BNKRPTDATE NOT = 0
                 ADD 1           TO DS-UNITS-BNKRPT(DSNOW DSREC RDSUB)
                                    DS-UNITS-BNKRPT(DSNOW DSCON CSUB)
                 ADD SAVE-OUTBAL TO DS-OUTBAL-BNKRPT(DSNOW DSREC RDSUB)
                                    DS-OUTBAL-BNKRPT(DSNOW DSCON CSUB).

           ADD LN-ORGTERM TO DS-SUMWGTTM.
           ADD LN-LNAMT TO DS-SUMWGTAV.
           COMPUTE DS-SUMWGTTA =
              DS-SUMWGTTA + (LN-ORGTERM * LN-LNAMT).

      * IF ACCOUNT IN JUDGEMENT:
           IF LN-JDDATE NOT = 0
              ADD 1 TO DS-JDOSUNIT(1)
              ADD LN-CURBAL TO DS-JDOSAMT(1).

           IF LN-SALEFIN = "Y"
              IF LN-SERVACCT NOT = "Y"
                 IF LN-DLRECOURSE = "F"
                    ADD 1 TO DS-RCOURSE-UNITS(1)
                    ADD LN-CURBAL TO DS-RCOURSE-AMT(1)
                  ELSE
                    IF LN-DLRECOURSE = "P"
                       ADD 1 TO DS-RCOURSE-UNITS(2)
                       IF LN-CURBAL < LN-DLPARTRCAMT
                          ADD LN-CURBAL TO DS-RCOURSE-AMT(2)
                       ELSE
                          ADD LN-DLPARTRCAMT TO DS-RCOURSE-AMT(2)
                       END-IF
                    ELSE
                       IF LN-DLRECOURSE = "N"
                          ADD 1 TO DS-RCOURSE-UNITS(3)
                          ADD LN-CURBAL TO DS-RCOURSE-AMT(3).
       BP-RESERVE-DS-UPD.
           ADD LN-DLRVPRIN(1)  TO DS-DLRVPRIN(1).
           ADD LN-DLRVPRIN(2)  TO DS-DLRVPRIN(2).
           ADD LN-DLDISC       TO DS-DLDISC
                                  DS-DLDISC-VOL(1)
                                  DS-DLDISC-VOL(2).


      * UPDATE PROCEEDS: WE DO NOT CARE ABOUT ACCOUNT STATUS. WE ARE
      *                  TAKING PROCEEDS REGARDLESS OF ACCOUNT STATUS

           IF GP-UNEARNED-STATS = "Y"
              ADD LN-PROCEEDS TO DS-PROCEEDS(MTD)
                                 DS-PROCEEDS(YTD)
      * BULK-PURCHASE-DS
      * UPDATE UNEARNED STATISTICS NET AND VOLUME
              PERFORM COMPUTE-EARNINGS
              ADD EARN-UNEARN(1) TO DS-UNEARNED-AMT(1 1 1)
              ADD LN-ANTICERN(1) TO DS-UNEARNED-AMT(1 2 1)
                                    DS-UNEARNED-AMT(2 2 1)
              ADD EARN-UNEARN(2) TO DS-UNEARNED-AMT(1 1 2)
              ADD LN-ANTICERN(2) TO DS-UNEARNED-AMT(1 2 2)
                                    DS-UNEARNED-AMT(2 2 2)
              ADD EARN-UNEARN(3) TO DS-UNEARNED-AMT(1 1 3)
              ADD LN-ANTICERN(3) TO DS-UNEARNED-AMT(1 2 3)
                                    DS-UNEARNED-AMT(2 2 3)
              ADD EARN-UNEARN(5) TO DS-UNEARNED-AMT(1 1,5)
              ADD LN-ANTICERN(5) TO DS-UNEARNED-AMT(1 2 5)
                                    DS-UNEARNED-AMT(2 2 5)

              IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                       GP-INCL-OTH-IN-EARNED-R)
                 ADD EARN-UNEARN(6) TO DS-UNEARNED-AMT(1 1 6)
                 ADD LN-ANTICERN(6) TO DS-UNEARNED-AMT(1 2 6)
                                       DS-UNEARNED-AMT(2 2 6)
                IF NOT(GP-INCL-OTH-IN-EARNED-R)
                   ADD EARN-UNEARN(4) TO DS-UNEARNED-AMT(1 1 4)
                   ADD LN-ANTICERN(4) TO DS-UNEARNED-AMT(1 2 4)
                                      DS-UNEARNED-AMT(2 2 4).
       BULK-PURCHASE-DS-EXIT.
           EXIT.


      ***************************************************
       NORMAL-CONV-DS SECTION.
      ***************************************************

      *THIS IS THE NORMAL CONVERSION WHERE ONLY GAIN/LOSS ACTIVITY IS
      *UPDATED

      * IF ACCOUNT IS NOT IN P&L AND THE ACCOUNT IS NOT IN REPO OR
      * IT IS REDEEMED.
           IF LN-PLCD = " " AND (LN-REPOCD = " " OR "V")
              ADD 1 TO DS-OUTSUNIT(1)
              ADD LN-CURBAL TO DS-OUTSAMT(1)
      * UPDATE DELINQUENCY NORMAL:
              IF GP-DELINQ-WITH-O2 = "Y"
                 MOVE LN-CURBAL TO SAVE-OUTBAL
              ELSE
                 SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL
              END-IF
              ADD 1           TO DS-UNITS(DSNOW DSREC RDSUB)
                                 DS-UNITS(DSNOW DSCON CSUB)
              ADD SAVE-OUTBAL TO DS-OUTBAL(DSNOW DSREC RDSUB)
                                 DS-OUTBAL(DSNOW DSCON CSUB)
      * UPDATE DELINQUENCY BANKRUPT:
              IF LN-BNKRPTDATE NOT = 0
                 ADD 1           TO DS-UNITS-BNKRPT(DSNOW DSREC RDSUB)
                                    DS-UNITS-BNKRPT(DSNOW DSCON CSUB)
                 ADD SAVE-OUTBAL TO DS-OUTBAL-BNKRPT(DSNOW DSREC RDSUB)
                                    DS-OUTBAL-BNKRPT(DSNOW DSCON CSUB).

           IF LN-PLCD = " "
              ADD LN-ORGTERM TO DS-SUMWGTTM
              ADD LN-LNAMT TO DS-SUMWGTAV
              COMPUTE DS-SUMWGTTA =
                 DS-SUMWGTTA + (LN-ORGTERM * LN-LNAMT).

      * IF ACCOUNT IN JUDGEMENT:
           IF LN-JDDATE NOT = 0
              ADD 1 TO DS-JDOSUNIT(1)
              ADD LN-CURBAL TO DS-JDOSAMT(1).

      * IF ACCOUNT IS P&L
           IF LN-PLCD NOT = " "
              ADD 1 TO DS-PLOSUNIT(1)
              ADD LN-CURBAL TO DS-PLOSAMT(1)
      * - ONHAND OR SOLD REPO IN P&L RECEIVABLES:
              IF LN-REPOCD = "X" OR "S"
                 IF LN-REPODATE > LN-PLDATE
                    IF LN-REPOCD = "X"
                       ADD 1 TO DS-NO-REPO(1 1 4)
                       ADD LN-CURBAL TO DS-AMT-REPO(1 1 4)
                    ELSE
                       ADD 1 TO DS-NO-REPO(1 1 5)
                       ADD LN-CURBAL TO DS-AMT-REPO(1 1 5).

       REPO-DS1-UPD.
           IF LN-REPOCD = "X" OR "S"
              IF LN-PLCD = " "
                 IF LN-REPOCD = "X"
                    MOVE 1 TO SRCD
                 ELSE
                    MOVE 3 TO SRCD
                 END-IF
                 ADD 1 TO DS-NO-REPO(1 1 SRCD)
                 ADD LN-CURBAL TO DS-AMT-REPO(1 1 SRCD).

           IF LN-PLCD = " "
              IF LN-SALEFIN = "Y"
                 IF LN-SERVACCT NOT = "Y"
                    IF LN-DLRECOURSE = "F"
                       ADD 1 TO DS-RCOURSE-UNITS(1)
                       ADD LN-CURBAL TO DS-RCOURSE-AMT(1)
                     ELSE
                       IF LN-DLRECOURSE = "P"
                          ADD 1 TO DS-RCOURSE-UNITS(2)
                          IF LN-CURBAL < LN-DLPARTRCAMT
                             ADD LN-CURBAL TO DS-RCOURSE-AMT(2)
                          ELSE
                             ADD LN-DLPARTRCAMT TO DS-RCOURSE-AMT(2)
                          END-IF
                       ELSE
                          IF LN-DLRECOURSE = "N"
                             ADD 1 TO DS-RCOURSE-UNITS(3)
                             ADD LN-CURBAL TO DS-RCOURSE-AMT(3).

      * NORMAL-CONV-DS
      * UPDATE UNEARNED STATISTICS NET AND VOLUME

           IF GP-UNEARNED-STATS = "Y"
              PERFORM COMPUTE-EARNINGS
              ADD EARN-UNEARN(1) TO DS-UNEARNED-AMT(1 1 1)
              ADD EARN-UNEARN(2) TO DS-UNEARNED-AMT(1 1 2)
              ADD EARN-UNEARN(3) TO DS-UNEARNED-AMT(1 1 3)
              ADD EARN-UNEARN(5) TO DS-UNEARNED-AMT(1 1 5)

              IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                            GP-INCL-OTH-IN-EARNED-R)
                 ADD EARN-UNEARN(6) TO DS-UNEARNED-AMT(1 1 6)

                 IF NOT (GP-INCL-OTH-IN-EARNED-R)
                    ADD EARN-UNEARN(4) TO DS-UNEARNED-AMT(1 1 4).
       NORMAL-CONV-DS-EXIT.
           EXIT.

      ******************************************************************
       UPDATE-DS1-FILE-REV SECTION.
      ******************************************************************

      * UPDATE DEALER STATISTICS FILE : REVERSALS

           IF LN-CURBAL = 0
              GO TO SKIP-UPDATE-DS1-FILE-REV.

           MOVE "UPDATING DEALER STATISTICS FILE........." TO MESS.
           PERFORM SEND-LEGEND.

           PERFORM OPEN-DS1-FILE.
           MOVE "N" TO REC-EXISTS.
       DS1-CHECK-EXISTS-REV.
           PERFORM SET-DS1-KEY.
           PERFORM READ-DS1-FILE.
           IF IO-FG = 0
              GO TO DS1-UPDATE-REC-REV.
           IF REC-EXISTS = "Y"
              GO TO IO-ERROR.
           MOVE "Y" TO REC-EXISTS.
           PERFORM CLEAR-DS-FILE.
           PERFORM SET-DS1-KEY.
           PERFORM WRITE-DS1-FILE.
           IF IO-FG = 9 AND E-CODE NOT = "22"
              GO TO IO-ERROR.
           GO TO DS1-CHECK-EXISTS-REV.

       DS1-UPDATE-REC-REV.
           IF BULK-CONVERSION-FG = "B"
              PERFORM BULK-PURCHASE-DS-UPD-REV
           ELSE
              PERFORM NORMAL-CONV-DS-UPD-REV.

           PERFORM REWRITE-DS1-FILE.
       EXIT-UPDATE-DS1-REV.
           PERFORM CLOSE-DS1-FILE.
       SKIP-UPDATE-DS1-FILE-REV.
           EXIT.

      ************************************************
       BULK-PURCHASE-DS-UPD-REV SECTION.
      ************************************************

      * BULK PURCHASE ACTS LIKE A TP TRANSACTION SO VOLUME NUMBER, RESERVE
      * (VOLUME,GAIN/LOSS,DISCOUNT MUST BE REVERSED OUT

      * IF ACCOUNT IS NOT IN P&L AND THE ACCOUNTS REPO STATUS IS
      * ACTIVE OR REDEEMED.
           IF LN-PLCD = " " AND (LN-REPOCD = " " OR "V")
      * UPDATE DELINQUENCY:
              IF GP-DELINQ-WITH-O2 = "Y"
                 MOVE LN-CURBAL TO SAVE-OUTBAL
              ELSE
                 SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL
              END-IF
              SUBTRACT 1 FROM DS-UNITS(DSNOW DSREC RDSUB)
                              DS-UNITS(DSNOW DSCON CSUB)
              SUBTRACT SAVE-OUTBAL FROM DS-OUTBAL(DSNOW DSREC RDSUB)
                                        DS-OUTBAL(DSNOW DSCON CSUB)

              SUBTRACT 1 FROM DS-OUTSUNIT(1), DS-NPURUNIT(1),
                                              DS-NPURUNIT(2)
              SUBTRACT LN-CURBAL FROM DS-OUTSAMT(1) ,DS-NPURAMT(1)
                                                     DS-NPURAMT(2).

           SUBTRACT LN-ORGTERM FROM DS-SUMWGTTM.
           SUBTRACT LN-LNAMT FROM DS-SUMWGTAV.
           COMPUTE DS-SUMWGTTA =
              DS-SUMWGTTA - (LN-ORGTERM * LN-LNAMT).

      * IF ACCOUNT IS IN JUDGEMENT:
           IF LN-JDDATE NOT = 0
              SUBTRACT 1 FROM DS-JDOSUNIT(1)
              SUBTRACT LN-CURBAL FROM DS-JDOSAMT(1).

           IF LN-SALEFIN = "Y"
              IF LN-SERVACCT NOT = "Y"
                 IF LN-DLRECOURSE = "F"
                    SUBTRACT 1 FROM DS-RCOURSE-UNITS(1)
                    SUBTRACT LN-CURBAL FROM DS-RCOURSE-AMT(1)
                  ELSE
                    IF LN-DLRECOURSE = "P"
                       SUBTRACT 1 FROM DS-RCOURSE-UNITS(2)
                       IF LN-CURBAL < LN-DLPARTRCAMT
                          SUBTRACT LN-CURBAL FROM DS-RCOURSE-AMT(2)
                       ELSE
                          SUBTRACT LN-DLPARTRCAMT
                                              FROM DS-RCOURSE-AMT(2)
                       END-IF
                     ELSE
                       IF LN-DLRECOURSE = "N"
                           SUBTRACT 1 FROM DS-RCOURSE-UNITS(3)
                          SUBTRACT LN-CURBAL FROM DS-RCOURSE-AMT(3).

       BP-RESERVE-DS-UPD-REV.
           SUBTRACT LN-DLRVPRIN(1)  FROM DS-DLRVPRIN(1).
           SUBTRACT LN-DLRVPRIN(2)  FROM DS-DLRVPRIN(2).
           SUBTRACT LN-DLDISC       FROM DS-DLDISC
                                          DS-DLDISC-VOL(1)
                                          DS-DLDISC-VOL(2).

      * UPDATE PROCEEDS: WE DO NOT CARE ABOUT ACCOUNT STATUS. WE ARE
      *                  TAKING PROCEEDS REGARDLESS OF ACCOUNT STATUS

           IF GP-UNEARNED-STATS = "Y"
              SUBTRACT LN-PROCEEDS FROM DS-PROCEEDS(MTD)
                                        DS-PROCEEDS(YTD)
      * BULK-PURCHASE-DS-UPD-REV
      * UPDATE UNEARNED STATISTICS NET AND VOLUME
              PERFORM COMPUTE-EARNINGS
              SUBTRACT EARN-UNEARN(1) FROM DS-UNEARNED-AMT(1 1 1)
              SUBTRACT LN-ANTICERN(1) FROM DS-UNEARNED-AMT(1 2 1)
                                           DS-UNEARNED-AMT(2 2 1)
              SUBTRACT EARN-UNEARN(2) FROM DS-UNEARNED-AMT(1 1 2)
              SUBTRACT LN-ANTICERN(2) FROM DS-UNEARNED-AMT(1 2 2)
                                           DS-UNEARNED-AMT(2 2 2)
              SUBTRACT EARN-UNEARN(3) FROM DS-UNEARNED-AMT(1 1 3)
              SUBTRACT LN-ANTICERN(3) FROM DS-UNEARNED-AMT(1 2 3)
                                           DS-UNEARNED-AMT(2 2 3)
              SUBTRACT EARN-UNEARN(5) FROM DS-UNEARNED-AMT(1 1 5)
              SUBTRACT LN-ANTICERN(5) FROM DS-UNEARNED-AMT(1 2 5)
                                           DS-UNEARNED-AMT(2 2 5)
              IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                     GP-INCL-OTH-IN-EARNED-R)
                SUBTRACT EARN-UNEARN(6) FROM DS-UNEARNED-AMT(1 1 6)
                SUBTRACT LN-ANTICERN(6) FROM DS-UNEARNED-AMT(1 2 6)
                                             DS-UNEARNED-AMT(2 2 6)
                IF NOT (GP-INCL-OTH-IN-EARNED-R)
                  SUBTRACT EARN-UNEARN(4) FROM DS-UNEARNED-AMT(1 1 4)
                  SUBTRACT LN-ANTICERN(4) FROM DS-UNEARNED-AMT(1 2 4)
                                              DS-UNEARNED-AMT(2 2 4).
       BULK-PURCHASE-DS-UPD-REV-EXIT.
           EXIT.

      ***************************************************
       NORMAL-CONV-DS-UPD-REV SECTION.
      ***************************************************

      * NORMAL CONVERSION WHERE ONLY GAIN/LOSS ACTIVITY NEEDS TO BE
      * REVERSED

      * IF ACCOUNT IS NOT IN P&L AND THE ACCOUNTS REPO STATUS IS
      * ACTIVE OR REDEEMED.
           IF LN-PLCD = " " AND (LN-REPOCD = " " OR "V")
      * UPDATE DELINQUENCY:
              IF GP-DELINQ-WITH-O2 = "Y"
                 MOVE LN-CURBAL TO SAVE-OUTBAL
              ELSE
                 SUBTRACT LN-OT2BAL FROM LN-CURBAL GIVING SAVE-OUTBAL
              END-IF
              SUBTRACT 1 FROM DS-UNITS(DSNOW DSREC RDSUB)
                              DS-UNITS(DSNOW DSCON CSUB)
              SUBTRACT SAVE-OUTBAL FROM DS-OUTBAL(DSNOW DSREC RDSUB)
                                        DS-OUTBAL(DSNOW DSCON CSUB)

              SUBTRACT 1 FROM DS-OUTSUNIT(1)
              SUBTRACT LN-CURBAL FROM DS-OUTSAMT(1).

           IF LN-PLCD = " "
              SUBTRACT LN-ORGTERM FROM DS-SUMWGTTM
              SUBTRACT LN-LNAMT FROM DS-SUMWGTAV
              COMPUTE DS-SUMWGTTA =
                 DS-SUMWGTTA - (LN-ORGTERM * LN-LNAMT).

      * IF ACCOUNT IS IN JUDGEMENT:
           IF LN-JDDATE NOT = 0
              SUBTRACT 1 FROM DS-JDOSUNIT(1)
              SUBTRACT LN-CURBAL FROM DS-JDOSAMT(1).

      * IF ACCOUNT IS P&L
           IF LN-PLCD NOT = " "
              SUBTRACT 1 FROM DS-PLOSUNIT(1)
              SUBTRACT LN-CURBAL FROM DS-PLOSAMT(1)
      * - ONHAND OR SOLD REPO IN P&L RECEIVABLES:
              IF LN-REPOCD = "X" OR "S"
                 IF LN-REPODATE > LN-PLDATE
                    IF LN-REPOCD = "X"
                       SUBTRACT 1 FROM DS-NO-REPO(1 1 4)
                       SUBTRACT LN-CURBAL FROM DS-AMT-REPO(1 1 4)
                    ELSE
                       SUBTRACT 1 FROM DS-NO-REPO(1 1 5)
                       SUBTRACT LN-CURBAL FROM DS-AMT-REPO(1 1 5).

       REPO-DS1-ULN-REV.
           IF LN-REPOCD = "X" OR "S"
              IF LN-PLCD = " "
                 IF LN-REPOCD = "X"
                    MOVE 1 TO SRCD
                 ELSE
                    MOVE 3 TO SRCD
                 END-IF
                 SUBTRACT 1 FROM DS-NO-REPO(1 1 SRCD)
                 SUBTRACT LN-CURBAL FROM DS-AMT-REPO(1 1 SRCD).

           IF LN-PLCD = " "
              IF LN-SALEFIN = "Y"
                 IF LN-SERVACCT NOT = "Y"
                    IF LN-DLRECOURSE = "F"
                       SUBTRACT 1 FROM DS-RCOURSE-UNITS(1)
                       SUBTRACT LN-CURBAL FROM DS-RCOURSE-AMT(1)
                     ELSE
                       IF LN-DLRECOURSE = "P"
                          SUBTRACT 1 FROM DS-RCOURSE-UNITS(2)
                          IF LN-CURBAL < LN-DLPARTRCAMT
                             SUBTRACT LN-CURBAL FROM DS-RCOURSE-AMT(2)
                          ELSE
                             SUBTRACT LN-DLPARTRCAMT
                                                FROM DS-RCOURSE-AMT(2)
                          END-IF
                        ELSE
                          IF LN-DLRECOURSE = "N"
                             SUBTRACT 1 FROM DS-RCOURSE-UNITS(3)
                             SUBTRACT LN-CURBAL FROM DS-RCOURSE-AMT(3).

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    NORMAL-CONV-DS-UPD-REV
      *    UPDATE UNEARNED STATISTICS NET
      *           THE UNEARNEDS WERE TALLYED IN LOGIC IN BAR-ENTRY-ROUTINE
      *           WHICH PERFORMED COMPUTE-EARNINGS BEFORE THEY WERE CLEARED
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF GP-UNEARNED-STATS = "Y"
              SUBTRACT HOLD-RV-UNEARN(1) FROM DS-UNEARNED-AMT(1 1 1)
              SUBTRACT HOLD-RV-UNEARN(2) FROM DS-UNEARNED-AMT(1 1 2)
              SUBTRACT HOLD-RV-UNEARN(3) FROM DS-UNEARNED-AMT(1 1 3)
              SUBTRACT HOLD-RV-UNEARN(5) FROM DS-UNEARNED-AMT(1 1 5)

              IF NOT ( GP-INCL-OTH-IN-EARNED-N OR
                                           GP-INCL-OTH-IN-EARNED-R)
                SUBTRACT HOLD-RV-UNEARN(6) FROM DS-UNEARNED-AMT(1 1 6)
                IF NOT (GP-INCL-OTH-IN-EARNED-R)
                   SUBTRACT HOLD-RV-UNEARN(4) FROM
                                          DS-UNEARNED-AMT(1 1 4).

       NORMAL-CONV-DS-UPD-REV-EXIT.
           EXIT.


      ******************************************************************
       CREATE-TRK-FILE SECTION.
      ******************************************************************
           IF LN-CURBAL = 0
              GO TO CREATE-TRK-FILE-EXIT.

           MOVE "UPDATING TRANSACTION FILE........." TO MESS.
           PERFORM SEND-LEGEND.

           MOVE " " TO ERR-FG.

           PERFORM OPEN-TRK1-FILE.

           MOVE LN-OWNBR   TO TK-BRNO.
           MOVE TRANS-DATE TO TK-DATE.
           MOVE LN-CLASS   TO TK-CLASS.
           MOVE LN-ACCTNO  TO TK-ACCTNO.
           MOVE LN-LAWCODE TO TK-LAWCODE.
           MOVE 0          TO HOLD-TK-LINE.
       CREATE-TRK-FILE-EXISTS.
           ADD 1             TO HOLD-TK-LINE.
           MOVE HOLD-TK-LINE TO TK-LINE.

           MOVE TRK1-KEY TO LPWSTRK-TRK1-KEY.
           PERFORM READ-TRK1-FILE.
           IF IO-FG = 0
      *       UNLOCK TRK-FILE
              GO TO CREATE-TRK-FILE-EXISTS.

           MOVE LPWSTRK-TRK1-KEY TO TRK1-KEY.

           PERFORM CLEAR-TRK-FILE.

           MOVE LPWSTRK-TRK1-KEY TO TRK1-KEY.

           MOVE LN-LOANTYPE TO TK-LOANTYPE.
           MOVE LN-LOANDATE TO TK-LOANDATE.
           MOVE LN-PURCD    TO TK-PURCD.
           MOVE LN-SRCD     TO TK-SRCD.
           MOVE LN-COLLCD   TO TK-COLLCD.
           MOVE LN-ORGTERM  TO TK-ORGTERM.
           MOVE LN-DLRECOURSE TO TK-DLRECOURSE.
           MOVE LN-INSURED  TO TK-INSURED.
           MOVE LN-DLNO     TO TK-DLNO.
           MOVE LN-SERVACCT TO TK-SERVACCT.

           MOVE LN-PLCD TO TK-PLCD.
           MOVE LN-PLTYPE TO TK-PLTYPE.
           MOVE LN-REPOCD TO TK-REPOCD.

      *--{CS}-TK FIELDS FOR VALUES SET IN IPF-PURCHASE-FIELDS WINDOW
           IF BULK-CONVERSION-FG = "B"
             MOVE LN-DLRVPRIN(1)  TO TK-DLRVPRIN(1)
             MOVE LN-DLRVPRIN(2) TO  TK-DLRVPRIN(2)
             MOVE LN-DLPARTRCAMT TO  TK-DLPARTRCAMT
             MOVE LN-DLDISC      TO  TK-DLDISC
             MOVE LN-PROCEEDS    TO  TK-PROCEEDS.
      *--{CS}----------------
           COMPUTE TK-LNAMT = LN-SUM-LNAMT * 1.
           COMPUTE TK-FINCHG = LN-SUM-FINCHG * 1.
           COMPUTE TK-DLPARTRCAMT = LN-DLPARTRCAMT * 1.
           COMPUTE TK-PURBAL = LN-CURBAL * 1.
           COMPUTE TK-MAINTFEE = LN-SUM-MAINTFEE * 1.
           COMPUTE TK-SERCHG = LN-SUM-SERCHG * 1.
           COMPUTE TK-EXTCHG = LN-SUM-EXTCHG * 1.
           COMPUTE TK-INTCHG = LN-SUM-INTCHG * 1.
           MOVE 1 TO SUB.
       CREATE-TRK-FILE-BORR.
           IF SUB NOT > 4
              MOVE LN-SSNO(SUB) TO TK-SSNO(SUB)
              MOVE LN-MAKERCD(SUB) TO TK-MAKERCD(SUB).
      *    IF SUB NOT > 5
      *       MOVE 0 TO TK-INSCOMP(SUB)
      *                 TK-INSPREM(SUB)
      *                 TK-INSCOMM(SUB)
      *                 TK-INSTERM(SUB)
      *       MOVE SPACES TO TK-INSOURS(SUB).
      *    IF SUB NOT > 6
      *       MOVE 0 TO TK-FEEAMT(SUB).
           IF SUB < 10
              ADD 1 TO SUB
              GO TO CREATE-TRK-FILE-BORR.

      *    -------------------------------------------------------------
      *    SET UNEARNED AMOUNTS INTO TK-WORKAMT'S:
      *    -------------------------------------------------------------
           IF LN-SERVACCT NOT = "Y" AND LN-PLCD = " "
              PERFORM COMPUTE-EARNINGS
              MOVE EARN-UNEARN(1) TO TK-UNEARN(1)
              MOVE EARN-UNEARN(2) TO TK-UNEARN(2)
              MOVE EARN-UNEARN(3) TO TK-UNEARN(3)
              MOVE EARN-UNEARN(4) TO TK-UNEARN(4)
              MOVE EARN-UNEARN(5) TO TK-UNEARN(5)
              MOVE EARN-UNEARN(6) TO TK-UNEARN(6).


      *CS  MOVE UERN-EARNINGS(1) TO TK-EARNED(1).
      *CS  MOVE UERN-EARNINGS(2) TO TK-EARNED(2).
      *CS  MOVE UERN-EARNINGS(3) TO TK-EARNED(3).
      *CS  MOVE UERN-EARNINGS(4) TO TK-EARNED(4).
      *CS  MOVE UERN-EARNINGS(5) TO TK-EARNED(5).
      *CS  MOVE UERN-EARNINGS(6) TO TK-EARNED(6).

           PERFORM SET-POSTDATE.
           MOVE POST-USERID TO TK-USERID.
           MOVE POST-TIME TO TK-POSTTIME.
           MOVE POST-DATE TO TK-POSTDATE.

           PERFORM WRITE-TRK1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           PERFORM CLOSE-TRK1-FILE.

       CREATE-TRK-FILE-EXIT.
           EXIT.


      ******************************************************************
       CREATE-TRK-FILE-REV SECTION.
      ******************************************************************
           IF LN-CURBAL = 0
              GO TO CREATE-TRK-FILE-EXIT-REV.

           MOVE "UPDATING TRANSACTION FILE........." TO MESS.
           PERFORM SEND-LEGEND.

           MOVE " " TO ERR-FG.

           PERFORM OPEN-TRK1-FILE.

           MOVE LN-OWNBR   TO TK-BRNO.
           MOVE TRANS-DATE TO TK-DATE.
           MOVE LN-CLASS   TO TK-CLASS.
           MOVE LN-ACCTNO  TO TK-ACCTNO.
           MOVE LN-LAWCODE TO TK-LAWCODE.
           MOVE 0          TO HOLD-TK-LINE.
       CREATE-TRK-FILE-EXISTS-REV.
           ADD 1             TO HOLD-TK-LINE.
           MOVE HOLD-TK-LINE TO TK-LINE.

           MOVE TRK1-KEY TO LPWSTRK-TRK1-KEY.
           PERFORM READ-TRK1-FILE.
           IF IO-FG = 0
      *       UNLOCK TRK-FILE
              GO TO CREATE-TRK-FILE-EXISTS-REV.

           MOVE LPWSTRK-TRK1-KEY TO TRK1-KEY.

           PERFORM CLEAR-TRK-FILE.

           MOVE LPWSTRK-TRK1-KEY TO TRK1-KEY.

           MOVE LN-LOANTYPE TO TK-LOANTYPE.
           MOVE LN-LOANDATE TO TK-LOANDATE.
           MOVE LN-PURCD    TO TK-PURCD.
           MOVE LN-SRCD     TO TK-SRCD.
           MOVE LN-COLLCD   TO TK-COLLCD.
           MOVE LN-ORGTERM  TO TK-ORGTERM.
           MOVE LN-DLRECOURSE TO TK-DLRECOURSE.
           MOVE LN-INSURED  TO TK-INSURED.
           MOVE LN-DLNO     TO TK-DLNO.
           MOVE LN-SERVACCT TO TK-SERVACCT.

           MOVE LN-PLCD TO TK-PLCD.
           MOVE LN-PLTYPE TO TK-PLTYPE.
           MOVE LN-REPOCD TO TK-REPOCD.

      *--{CS}----------------
           IF BULK-CONVERSION-FG = "B"
             COMPUTE TK-DLRVPRIN(1) = LN-DLRVPRIN(1) * -1
             COMPUTE TK-DLRVPRIN(2) = LN-DLRVPRIN(2) * -1
             COMPUTE TK-DLPARTRCAMT = LN-DLPARTRCAMT * -1
             COMPUTE TK-DLDISC      = LN-DLDISC * -1
             COMPUTE TK-PROCEEDS    = LN-PROCEEDS * -1.
      *--{CS}----

           COMPUTE TK-LNAMT = LN-SUM-LNAMT * -1.
           COMPUTE TK-FINCHG = LN-SUM-FINCHG * -1.
           COMPUTE TK-DLPARTRCAMT = LN-DLPARTRCAMT * -1.
           COMPUTE TK-PURBAL = LN-CURBAL * -1.
           COMPUTE TK-MAINTFEE = LN-SUM-MAINTFEE * -1.
           COMPUTE TK-SERCHG = LN-SUM-SERCHG * -1.
           COMPUTE TK-EXTCHG = LN-SUM-EXTCHG * -1.
           COMPUTE TK-INTCHG = LN-SUM-INTCHG * -1.
           MOVE 1 TO SUB.
       CREATE-TRK-FILE-BORR-REV.
           IF SUB NOT > 4
              MOVE LN-SSNO(SUB) TO TK-SSNO(SUB)
              MOVE LN-MAKERCD(SUB) TO TK-MAKERCD(SUB).
      *    IF SUB NOT > 5
      *       MOVE 0 TO TK-INSCOMP(SUB)
      *                 TK-INSPREM(SUB)
      *                 TK-INSCOMM(SUB)
      *                 TK-INSTERM(SUB)
      *       MOVE SPACES TO TK-INSOURS(SUB).
      *    IF SUB NOT > 6
      *       MOVE 0 TO TK-FEEAMT(SUB).
           IF SUB < 10
              ADD 1 TO SUB
              GO TO CREATE-TRK-FILE-BORR-REV.

      *    -------------------------------------------------------------
      *    SET UNEARNED AMOUNTS INTO TK-WORKAMT'S:
      *    -------------------------------------------------------------
           IF LN-SERVACCT NOT = "Y" AND LN-PLCD = " "
              COMPUTE TK-UNEARN(1) = HOLD-RV-ACCERN(1) - LN-ANTICERN(1)
              COMPUTE TK-UNEARN(2) = HOLD-RV-ACCERN(2) - LN-ANTICERN(2)
              COMPUTE TK-UNEARN(3) = HOLD-RV-ACCERN(3) - LN-ANTICERN(3)
              COMPUTE TK-UNEARN(4) = HOLD-RV-ACCERN(4) - LN-ANTICERN(4)
              COMPUTE TK-UNEARN(5) = HOLD-RV-ACCERN(5) - LN-ANTICERN(5)
              COMPUTE TK-UNEARN(6) = HOLD-RV-ACCERN(6) - LN-ANTICERN(6).

      *    -------------------------------------------------------------
      *    SET EARNED AMOUNTS INTO TK-WORKAMT'S:
      *    -------------------------------------------------------------
      *CS  IF LN-SERVACCT NOT = "Y" AND LN-PLCD = " "
      *CS     COMPUTE TK-EARNED(1) = HOLD-RV-ACCERN(1) * -1.
      *CS     COMPUTE TK-EARNED(2) = HOLD-RV-ACCERN(2) * -1.
      *CS     COMPUTE TK-EARNED(3) = HOLD-RV-ACCERN(3) * -1.
      *CS     COMPUTE TK-EARNED(4) = HOLD-RV-ACCERN(4) * -1.
      *CS     COMPUTE TK-EARNED(5) = HOLD-RV-ACCERN(5) * -1.
      *CS     COMPUTE TK-EARNED(6) = HOLD-RV-ACCERN(6) * -1.



           PERFORM SET-POSTDATE.
           MOVE POST-USERID TO TK-USERID.
           MOVE POST-TIME TO TK-POSTTIME.
           MOVE POST-DATE TO TK-POSTDATE.

           PERFORM WRITE-TRK1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           PERFORM CLOSE-TRK1-FILE.

       CREATE-TRK-FILE-EXIT-REV.
           EXIT.

      ******************************************************************
       SET-DELINQUENCY SECTION.
      ******************************************************************
           MOVE TRANS-DATE TO AGEING-DATE.
           PERFORM COMPUTE-CONTRACTUAL.
           PERFORM COMPUTE-RECENCY.

      ***************************************************
       VERIFY-PASSWORD SECTION.
      ***************************************************
           MOVE " " TO PASSWDW-STAT.
           MOVE "LONIF1" TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           MOVE "CL/PASSWD" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.


      **********************************************
       FORM-RESET SECTION.
      **********************************************
       FORM-RESET-EXIT.
           EXIT.

      **********************************************
       SETUP-LINK-INFO SECTION.
      **********************************************
           IF VDU-FORM-NAME = "EARN15"
              MOVE EARN15-HELP--FILE TO HELP-LINK-FILE
              MOVE EARN15-HELP--DIR  TO HELP-LINK-DIR
           ELSE
           IF VDU-FORM-NAME = "EARN16"
              MOVE EARN16-HELP--FILE TO HELP-LINK-FILE
              MOVE EARN16-HELP--DIR  TO HELP-LINK-DIR
           ELSE
           MOVE LONIF-HELP--FILE TO HELP-LINK-FILE 
           MOVE LONIF-HELP--DIR TO HELP-LINK-DIR.

      **********************************************
       VDU-CONVERT-FIELD SECTION.
      **********************************************
           MOVE "00" TO STAT.
           MOVE VDU-FIELD-TO-CONVERT TO VDU-ALP-FIELD.
           EVALUATE TRUE
              COPY "LIBLP/LONIF_EVA.CPY".
              COPY "LIBLP/LPCMNU_EVA.CPY".
              COPY "LIBWI/EARN15_EVA.CPY".
              COPY "LIBWI/EARN16_EVA.CPY".
              COPY "LIBWI/PURFLD_EVA.CPY".
              COPY "LIBWI/MSCBAL_EVA.CPY".
              WHEN OTHER MOVE "2A" TO STAT
           END-EVALUATE.

      *************************************
       MISC-ROUTINES SECTION.
      *************************************
       COPY "LIBGB/ACCESS.CPY".
       COPY "LIBGB/GETENV.CPY".
       GET-SP.
           PERFORM OPEN-SP1-FILE.
           PERFORM READ-SP1-FILE.
           PERFORM CLOSE-SP1-FILE.
       GET-LC.
           PERFORM OPEN-LC1-FILE.
           PERFORM READ-LC1-FILE.
           PERFORM CLOSE-LC1-FILE.
       GET-BR.
           PERFORM OPEN-BR-FILE.
           PERFORM READ-BR-FILE.
           PERFORM CLOSE-BR-FILE.
       SET-DS1-KEY.
           MOVE TRANS-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.
           MOVE DATE-YYYYMM TO DS-DATE-CCYYMM.
           MOVE LN-OWNBR TO DS-BRANCH.
           MOVE LN-DLNO  TO DS-DLNO.
           MOVE LN-CLASS TO DS-CLASS.
       SET-TY-KEY.
           MOVE LN-OWNBR   TO TY-BRNO.
           MOVE TRANS-DATE TO TY-DATE.
           MOVE LN-CLASS   TO TY-CLASS.
       GET-COLLATERAL.
           PERFORM OPEN-CD1-FILE.
           MOVE LN-COLLCD TO CD-CODE.
           MOVE "CO"      TO CD-TYPE.
           PERFORM READ-CD1-FILE.
           IF IO-FG NOT = 0
              MOVE " " TO CD-CO-SECURED.
           PERFORM CLOSE-CD1-FILE.

       NEGATIVE-HOLD-LN-TOTPAYMNTD.
           MOVE "TOTAL PAYMENTS TODATE ARE NEGATIVE" TO MESS.
           PERFORM SEND-MESS.

       UPDATE-ACCERN.
           IF LN-ACCERN(SUB) NOT = 0
              MOVE LN-EARN-ORDER(SUB) TO E-SUB
              IF E-SUB > 0 AND < 7
                 MOVE LN-ACCERN(SUB) TO EARNING-WK(E-SUB).
           ADD 1 TO SUB.

       WHICH-METHOD.
      D    STOP MESS.
           IF SP-ERNFRMLA(CERN) > 50
              PERFORM ACCRUAL-METHOD
              MOVE AERN-ERNDELQ-STOP TO HOLD-LN-ERNDELQ-STOP
              MOVE AERN-NEW-LAST-ACCRUAL-DATE
                                     TO HOLD-LN-LAST-ACCRUAL-DATE
           ELSE
              PERFORM CASH-METHOD.
           ADD 1 TO AERN CERN.

       DISPLAY-ALL-LINES.
           MOVE LINE-BUFFER TO WR-BUF.
           MOVE LINE-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       NO-RECORDS.
           MOVE "NO EXISTING PAYMENT RECORDS" TO MESS.
           PERFORM SEND-MESS.
       DEL-ERROR.
           MOVE "BALANCE FORWARD DELETE ERROR" TO MESS.
           PERFORM SEND-MESS.
       RESET-LIST.
           MOVE SPACES TO WR-BUF.
           MOVE MESS TO WR-LIST.
           PERFORM CALL-WRFORM.
       RESET-ENTRY-LINE.
           MOVE ENTRY-LINE-LIST TO MESS.
           PERFORM RESET-LIST.
       RESET-SEL.
           MOVE "SEL MSEL." TO MESS.
           PERFORM RESET-LIST.
       SEND-LEGEND.
           MOVE LEGEND TO WR-BUF.
           MOVE LEGEND-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       SEND-WLEGEND.
           MOVE "S  A000WSEL." TO VDU.
           MOVE MESS TO VDUBUF.
           PERFORM SCREENIO.
       SEND-ENTRY-LINE.
           MOVE ENTRY-BUF TO WR-BUF.
           MOVE ENTRY-LINE-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
       SETUP-LINE.
           MOVE SPACES TO LN-BUF ENTRY-BUF.
           MOVE LP-PAYDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO L-010 EB-010.
           MOVE LP-TRCD TO L-020 EB-020.
           MOVE LP-REFNO TO L-030 EB-030.
           IF LP-TRCD = "JD" OR "AC" OR "IR"
              MOVE LP-NEWSTAT-RATE TO L-040RATE EB-040RATE
           ELSE
              MOVE LP-TRAMT TO L-040 EB-040.

           IF (  (LP-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO")
                 OR ( (LP-TRCD = "RV") AND
                       (LP-REVTRCD = "PB" OR "RN" OR "SC"
                                            OR "RB" OR "RO")
                    )
              )  AND (LP-APOT2 NOT = 0)
              ADD LP-APOTH LP-APOT2 GIVING L-050 EB-050
              INSPECT L-050 REPLACING TRAILING " " BY "*"
              INSPECT EB-050 REPLACING TRAILING " " BY "*"
           ELSE
              MOVE LP-APOTH TO L-050 EB-050.

           ADD LP-APINT LP-APLC GIVING L-060 EB-060.
           MOVE LP-APCUR TO L-070 EB-070.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      * 8/11/98 SUPPRESS BALANCE IF ENV 'RVLINES' IS SET (MJD AS PER JTG)
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF ( LP-TRCD = "RV" OR LP-REV NOT = " "        ) AND
              ( NOT (LP-TRCD = "RV" AND LP-REVSEQNO = 0 ) ) AND
              ( DISP-REV-BAL = "N"                        )
              MOVE "*" TO L-120 EB-120
           ELSE
              MOVE LP-PDTH-DATE TO NUM-DATE
              IF LN-UNITPER-CD-DAYS
      * DAILY   20180501 DISPLAY 0501 (MMDD)
                 MOVE 0 TO NUM-CCYY
              ELSE
      * MONTHLY 20180501 DISPLAY 0518 (MMYY)
                 MOVE NUM-YR TO NUM-DA
                 MOVE 0      TO NUM-CCYY
              END-IF
              MOVE NUM-DATE TO D-PDTHRU.

              MOVE NUM-DATE TO L-080 EB-080
              MOVE LP-OTHBAL TO L-090 EB-090
              COMPUTE L-090 = LP-OTHBAL + LP-OT2BAL
              MOVE L-090 TO EB-090
              ADD LP-INTBAL LP-LCBAL GIVING L-100 EB-100
              MOVE LP-CURBAL TO L-110 EB-110
              IF (LP-TRCD = "RV" OR LP-REV NOT = " ") AND
                  NOT (LP-TRCD="RV" AND LP-REVSEQNO=0)
                 MOVE "*" TO L-120 EB-120.
       GET-DL1.
           MOVE LN-DLNO TO DL-DLNO.
           PERFORM OPEN-DL1-FILE.
           PERFORM READ-DL1-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           PERFORM CLOSE-DL1-FILE.

      ********************************************************
       ACCRUAL-METHOD SECTION.
      ********************************************************

      * COMPUTE ACCRUAL EARNINGS THRU END OF MONTH:
      * NEED CURBAL FOR FORMULA 58
           MOVE LP-CURBAL TO LN-CURBAL.

           ADD HOLD-LN-TOTNODEF TO LN-TOTNODEF.
           IF ( LN-ADDON-FG NOT = "Y"      ) AND
              ( CERN = 2                   ) AND
              ( LN-INT-REBATE = " " OR "C" )
              PERFORM COMPUTE-FEE-ADDON-ERN
              MOVE ADDON-EARNINGS TO AERN-EARNINGS(CERN)
           ELSE
              IF ( LN-ADDON-FG = "Y"          ) AND
                 ( CERN = 2                   ) AND
                 ( LN-INT-REBATE = " " OR "C" )
                 PERFORM COMPUTE-ADDON-EARNINGS
                 MOVE ADDON-EARNINGS TO AERN-EARNINGS(CERN)
              ELSE
                 MOVE SAVE-MONTH-DATE TO AERN-ENDDATE
                 MOVE LN-LAST-ACCRUAL-DATE TO AERN-LAST-ACCRUAL-DATE
                 PERFORM COMPUTE-AERNINGS.

           MOVE CERN TO AERN.
           ADD AERN-EARNINGS(AERN) TO LN-ACCERN(AERN).
           SUBTRACT HOLD-LN-TOTNODEF FROM LN-TOTNODEF.

      ********************************************************
       CASH-METHOD SECTION.
      ********************************************************
           MOVE LP-PAYDATE TO CERN-PAYDATE.
           COMPUTE CERN-APCUR = LN-SUM-LNAMT - LP-CURBAL.
           MOVE LN-TOTINT  TO CERN-APINT.
           MOVE LN-TOTLCHG TO CERN-APLC.
           MOVE 0          TO CERN-TOTLCHG CERN-PAYMNTD.
           ADD HOLD-LN-TOTNODEF TO LN-TOTNODEF.
           MOVE "PY" TO CERN-TRCD.
           PERFORM COMPUTE-CERNINGS.
           MOVE AERN TO CERN.
           ADD CERN-EARNINGS(CERN) TO LN-ACCERN(CERN).
           IF SP-DLDISC-CONV-BF-PCNT NOT = 0
              IF CERN = 5
                 MOVE 0 TO LN-ACCERN(5).

           SUBTRACT HOLD-LN-TOTNODEF FROM LN-TOTNODEF.

      *********************************************************
       COMPUTE-ADDON-EARNINGS SECTION.
      *********************************************************

      * COMPUTE NEW ACCRUAL EARNINGS NUMBERS

           MOVE 0 TO ADDON-EARNINGS.

           PERFORM OPEN-LTI1-FILE.

           MOVE LTI-PATH-OWNBR  TO LTI-BRNO
                                   QLTI1-WBEG-BRNO
                                   QLTI1-WEND-BRNO.
           MOVE LN-ACCTNO       TO LTI-ACCTNO
                                   QLTI1-WBEG-ACCTNO
                                   QLTI1-WEND-ACCTNO.
           MOVE 0               TO LTI-SEQNO
                                   QLTI1-WBEG-SEQNO.
           MOVE ALL "9"         TO QLTI1-WEND-SEQNO.

           PERFORM START-LTI1-FILE.
       COMPUTE-ADDON-EARNINGS-NEXT.
           PERFORM READ-LTI1-FILE-NEXT.
           IF IO-FG NOT = 0
              GO TO END-COMPUTE-ADDON-EARNINGS.

           IF (LTI-BRNO NOT = LTI-PATH-OWNBR) OR
               (LTI-ACCTNO NOT = LN-ACCTNO)
              GO TO END-COMPUTE-ADDON-EARNINGS.

           IF NOT (LTI-INT-REBATE = " " OR "C")
      *       UNLOCK LTI-FILE
              ADD LTI-ACCERN(1) TO ADDON-EARNINGS
              GO TO COMPUTE-ADDON-EARNINGS-NEXT.

           IF LTI-ANTICERN(1) < 0
              MOVE -1 TO ONE
           ELSE
              MOVE +1 TO ONE.
           MOVE LTI-ORIG-1STPYDATE   TO AERN-LN-ORIG-1STPYDATE.
           MOVE LTI-ANTIC-START-DATE TO AERN-LN-LOANDATE
                                        AERN-LN-PURDATE
                                        AERN-LN-INTDATE.
           SUBTRACT LTI-PRIOR-NODEF FROM LN-TOTNODEF
                                          GIVING AERN-LN-TOTNODEF.
           MOVE LTI-ANTICTERM       TO AERN-LN-ANTICTERM.
           MOVE "N"                 TO AERN-LN-SALEFIN.
           MOVE LTI-INT-REBATE      TO AERN-LN-REBATE.
           ADD LTI-ACCERN(1)        TO ADDON-EARNINGS.

           MULTIPLY ONE BY LTI-ANTICERN(1) GIVING AERN-LN-ANTICERN.
           MULTIPLY ONE BY LTI-ANTICADJ(1) GIVING AERN-LN-ANTICADJ.
           MULTIPLY ONE BY LTI-UFERN(1)    GIVING AERN-LN-UFERN.
           MULTIPLY ONE BY LTI-ACCERN(1)   GIVING AERN-LN-ACCERN.

           MOVE SAVE-MONTH-DATE      TO AERN-ENDDATE.
           MOVE LN-LAST-ACCRUAL-DATE TO AERN-LAST-ACCRUAL-DATE.
           MOVE "Y"                  TO AERN-ADDON-FG.
           MOVE 2                    TO AERN.

           PERFORM COMPUTE-AERNINGS.
           MULTIPLY ONE BY AERN-EARNINGS(2).
           ADD AERN-EARNINGS(2) TO ADDON-EARNINGS
                                   LTI-ACCERN(1).
           MOVE AERN-EARNINGS(2) TO LTI-INT-LAST-EARNED.

           PERFORM REWRITE-LTI1-FILE.

           GO TO COMPUTE-ADDON-EARNINGS-NEXT.

       END-COMPUTE-ADDON-EARNINGS.
           PERFORM CLOSE-LTI1-FILE.

      ******************************************************************
       COMPUTE-FEE-ADDON-ERN SECTION.
      ******************************************************************

      *    COMPUTE FEE NEW ACCRUAL ERN NUMBERS

           MOVE 0                    TO ADDON-EARNINGS.

           MOVE SAVE-MONTH-DATE      TO AERN-ENDDATE.
           MOVE LN-LAST-ACCRUAL-DATE TO AERN-LAST-ACCRUAL-DATE.
           MOVE " "                  TO AERN-ADDON-FG.
           MOVE 2                    TO AERN.

           PERFORM COMPUTE-AERNINGS.

           MULTIPLY ONE BY AERN-EARNINGS(2).
           ADD AERN-EARNINGS(2)      TO ADDON-EARNINGS.

      *=================================================================
       EXIT-COMPUTE-FEE-ADDON-ERN.
           EXIT.

      ************************************************************************
      *    DETERMINE LATE CHG FRMLA "F" OR "H" OR "I" OR "L" OR "M" OR "P"
      *    CURRENT PAYMENTS
      *     NOTE:
      *          FOR LCFRMLA = "H" THERE IS A PROBLEM
      *          SINCE TOTLCHG'S HAVE NOT BEEN ENTERED
      *          PRIOR TO THIS CALL.
      ************************************************************************
       SET-LCFRMLA-FHILM-INFO SECTION.
           MOVE 0 TO LCAP-LST-CURDATE.
           MOVE LP-PAYDATE TO LCAP-PAYDATE.
           MOVE LN-1STPYDATE TO LCAP-1STPYDATE.
           MOVE LP-TRAMT TO LCAP-TRAMT.
           COMPUTE LCAP-PAYMNTD =
                LN-SUM-LNAMT - LP-CURBAL + LP-OT2BAL.
           IF SP-LCFRMLA = "H" OR "T"
              ADD LN-TOTLCHG TO LCAP-PAYMNTD.

           MOVE LN-CURBAL TO PRIN-WORKER.
           MOVE LP-CURBAL TO LN-CURBAL.
           IF SP-LCFRMLA = "F" OR "H"
              PERFORM LCAP-F-CURRENT-PERIOD
           ELSE
           IF SP-LCFRMLA = "S" OR "T"
              PERFORM LCAP-S-CURRENT-PERIOD
           ELSE
           IF SP-LCFRMLA = "I" OR "L" OR "P"
              PERFORM LCAP-I-L-CURRENT-PERIOD
           ELSE
           IF SP-LCFRMLA = "M"
              PERFORM LCAP-M-CURRENT-PERIOD.
           MOVE PRIN-WORKER TO LN-CURBAL.

           MOVE LCAP-CURDUE TO HOLD-LN-LCPARTIALS.
           MOVE LCAP-CURDATE TO HOLD-LN-LCPAID.
           MOVE LCAP-CURDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MULTIPLY .01 BY DATE-MMDDYY GIVING HOLD-LN-LCPAID.

      **********************************************
       UPDATE-ADDON-FIELDS SECTION.
      **********************************************
           MOVE LN-LNAMT      TO LN-SUM-LNAMT.
           MOVE LN-FINCHG     TO LN-SUM-FINCHG.
           MOVE LN-INTCHG     TO LN-SUM-INTCHG.
           MOVE LN-SERCHG     TO LN-SUM-SERCHG.
           MOVE LN-EXTCHG     TO LN-SUM-EXTCHG.
           MOVE LN-REGPYAMT   TO LN-SUM-REGPYAMT.
           MOVE LN-ORIGPURAMT TO LN-SUM-ORIGPURAMT.
           COMPUTE LN-SUM-MAINTFEE = LN-MAINTFEE * LN-ORGTERM.
           MOVE " "           TO LN-ADDON-FG.
           MOVE 0             TO LN-ANTICERN(2) LN-ANTICADJ(2)
                                 LN-UFERN(2)    LN-ACCERN(2).

           PERFORM OPEN-LTI1-FILE.

           MOVE LTI-PATH-OWNBR  TO LTI-BRNO
                                   QLTI1-WBEG-BRNO
                                   QLTI1-WEND-BRNO.
           MOVE LN-ACCTNO       TO LTI-ACCTNO
                                   QLTI1-WBEG-ACCTNO
                                   QLTI1-WEND-ACCTNO.
           MOVE 1               TO LTI-SEQNO
                                   QLTI1-WBEG-SEQNO.
           MOVE ALL "9"         TO QLTI1-WEND-SEQNO.

           PERFORM START-LTI1-FILE.

       UPDATE-ADDON-FIELDS-NEXT.
           PERFORM READ-LTI1-FILE-NEXT.
      *    UNLOCK LTI-FILE.
           IF IO-FG NOT = 0
              GO TO UPDATE-ADDON-FIELDS-EXIT.

           IF (LTI-BRNO NOT = LTI-PATH-OWNBR) OR
               (LTI-ACCTNO NOT = LN-ACCTNO)
              GO TO UPDATE-ADDON-FIELDS-EXIT.

      * UPDATE INS. CONSOLIDATED INFO:
           MOVE "Y" TO LN-ADDON-FG.
           IF LTI-TRCD = "RT"
              ADD LTI-INS-PAYMNT-INCR TO LN-SUM-REGPYAMT.

           ADD LTI-INS-TOT-ADDON TO LN-SUM-LNAMT LN-SUM-ORIGPURAMT.
           ADD LTI-ANTICERN(3)   TO LN-SUM-FINCHG
                                   LN-SUM-INTCHG.

           ADD LTI-ANTICERN(1)   TO LN-ANTICERN(2).
           ADD LTI-ANTICADJ(1)   TO LN-ANTICADJ(2).
           ADD LTI-ACCERN(1)     TO LN-ACCERN(2).
           ADD LTI-UFERN(1)      TO LN-UFERN(2).

           IF LTI-INS-TYPE NOT = 0
              IF LTI-INSCOMP NOT = 0
                 IF LTI-INS-TOT-ADDON > 0
                    PERFORM UPDATE-INSURANCE-TABLE.

           GO TO UPDATE-ADDON-FIELDS-NEXT.

       UPDATE-ADDON-FIELDS-EXIT.
           PERFORM CLOSE-LTI1-FILE.

      **********************************************
       UPDATE-INSURANCE-TABLE SECTION.
      **********************************************
           MOVE LTI-INSCOMP TO LN-INSCOMP(LTI-INS-TYPE).
           MOVE LTI-INSOURS TO LN-INSOURS(LTI-INS-TYPE).
           MOVE LTI-INSEFF-DATE  TO LN-INSEFF-DATE(LTI-INS-TYPE).
           MOVE LTI-INSEXP-DATE  TO LN-INSEXP-DATE(LTI-INS-TYPE).
           MOVE LTI-INSPREM TO LN-INSPREM(LTI-INS-TYPE).
           MOVE LTI-INSCOVR TO LN-INSCOVR(LTI-INS-TYPE).
           MOVE LTI-INSCOMM TO LN-INSCOMM(LTI-INS-TYPE).
           MOVE LTI-INS-TYPE TO SUB.
           IF SUB > 3
              ADD 5 TO SUB.
           MOVE LTI-INS-REBATE TO LN-REBATE(SUB).

      **********************************************
       UPDATE-PAYSCH-FIELDS SECTION.
      **********************************************
           MOVE LN-ORGTERM TO LN-SUM-ORGTERM.

           MOVE " " TO LN-PAY-SCHLD-FG.

           PERFORM OPEN-LTP1-FILE.
           MOVE LN-OWNBR  TO LTP-BRNO.
           MOVE LN-ACCTNO TO LTP-ACCTNO.
           MOVE 1         TO LTP-SEQNO.

           PERFORM READ-LTP1-FILE.
           IF IO-FG NOT = 0
              GO TO UPDATE-PAYSCH-FIELDS-EXIT.

      * UPDATE INS. CONSOLIDATED INFO:
           MOVE "Y" TO LN-PAY-SCHLD-FG.
           PERFORM UNPACK-PAYMENT-SCHEDULE.

           PERFORM PACK-PAYMENT-SCHEDULE.
           MOVE SCHD-TERM TO LN-SUM-ORGTERM.

       UPDATE-PAYSCH-FIELDS-EXIT.
           PERFORM CLOSE-LTP1-FILE.


       COPY "LIBLP/LPMNUI.CPY".
       COPY "LIBLP/POSTDATE.CPY".
       COPY "LIBLP/LPREGZ.CPY".
       COPY "LIBLP/LPSRCD.CPY".
       COPY "LIBLP/LPPDUE.CPY".
       COPY "LIBLP/LPTYCL.CPY".
       COPY "LIBLP/LPDSCL.CPY".
       COPY "LIBGB/GPENV.CPY".
       COPY "LIBLP/LPTRKCL.CPY".
       COPY "LIBGB/DATER.CPY".
       COPY "LIBLP/LPSCHD.CPY".
       COPY "LIBGB/SPPDTH.CPY".
       COPY "LIBLP/LPLCAP.CPY".
       COPY "LIBLP/LPLCAS.CPY".
       COPY "LIBLP/LPCERN.CPY".
       COPY "LIBGB/REBATE.CPY".
       COPY "LIBLP/LPITRM.CPY".
       COPY "LIBLP/LPAPRZ.CPY".
       COPY "LIBLP/LPUPER.CPY".
       COPY "LIBLP/LPUPWK.CPY".
       COPY "LIBLP/LPAPRS.CPY".
       COPY "LIBLP/SETCTBL.CPY".
       COPY "LIBLP/LPUERN.CPY".
       COPY "LIBLP/LPAERN.CPY".
       COPY "LIBLP/LPEADJ.CPY".
       COPY "LIBLP/LPAMTS.CPY".
       COPY "LIBLP/LPCEPP.CPY".
       COPY "LIBGB/AGEING.CPY".
       COPY "LIBLP/LPLCHG.CPY".
       COPY "LIBLP/LPMDTE.CPY".
       COPY "LIBLP/LPXDTE.CPY".
       COPY "LIBLP/LPIBPC.CPY".
       COPY "LIBLP/LPEARN.CPY".
       COPY "LIBGB/SCREEN.CPY".
       COPY "LIBGB/RBACT.CPY".
       COPY "LIBWI/PFSWINDOWS.CPY".
       COPY "LIBLP/LPLPCL.CPY".
       COPY "LIBLP/LPLXECL.CPY".

      ********************************************
       IO-ROUTINES SECTION.
      ********************************************
       COPY "LIBGB/CONNECT_SQL.CPY".
       COPY "LIBLP/LPTYGS_SQL.CPY".
       COPY "LIBLP/LPTRKGS_SQL.CPY".
       COPY "LIBLP/LPSPGS_SQL.CPY".
       COPY "LIBLP/LPLXEGS_SQL.CPY".
       COPY "LIBLP/LPLTPGS_SQL.CPY".
       COPY "LIBLP/LPLTIGS_SQL.CPY".
       COPY "LIBLP/LPLPGS_SQL.CPY".
       COPY "LIBLP/LPLNGS_SQL.CPY".
       COPY "LIBLP/LPNOGS_SQL.CPY".
       COPY "LIBLP/LPLCGS_SQL.CPY".
       COPY "LIBLP/LPDSGS_SQL.CPY".
       COPY "LIBLP/LPDLGS_SQL.CPY".
       COPY "LIBLP/LPCDGS_SQL.CPY".
       COPY "LIBLP/LPBWGS_SQL.CPY".
       COPY "LIBGB/GBBRGS_SQL.CPY".
       COPY "LIBGB/GBGBGS_SQL.CPY".
       COPY "LIBLP/LPDL1RN.CPY".
       COPY "LIBLP/LPLXE1IN.CPY".
       COPY "LIBLP/LPLC1RN.CPY".
       COPY "LIBLP/LPLN1IN.CPY".
       COPY "LIBLP/LPNO1IN.CPY".
       COPY "LIBLP/LPLP1IN.CPY".
       COPY "LIBLP/LPLTI1IN.CPY".
       COPY "LIBLP/LPLTP1RN.CPY".
       COPY "LIBLP/LPTY1IN.CPY".
       COPY "LIBLP/LPDS1IN.CPY".
       COPY "LIBLP/LPSP1RN.CPY".
       COPY "LIBLP/LPBW1IN.CPY".
       COPY "LIBLP/LPWKI.CPY".
       COPY "LIBGB/GBBRRN.CPY".
       COPY "LIBGB/GBGBRN.CPY".
       COPY "LIBLP/LPCD1RN.CPY".
       COPY "LIBLP/LPTRK1IN.CPY".

       COPY "LIBGB/FERRORS.CPY".
           MOVE "E" TO ERRCD.

       END-ROUTINE.
           PERFORM CLOSE-FILES.
       EXIT-PROG.
       STOP-RUN.
           EXIT PROGRAM.

