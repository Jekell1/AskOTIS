       IDENTIFICATION DIVISION.
       PROGRAM-ID.      LONPFC.
       DATE-WRITTEN.    032486.
      **************************************************************************
      *  DESC:  LOAN PROCESSING
      *         TRANSACTION POSTING
      *         PROGRAM 12 -     TRCD'S  PY, PA, PE, DF, D2, D3
      *                                  D4, D5, D6, D7, D8, D9
      *                                  PR, PC, PP, Z2, SS, AH
      *                                  PX, PN, PZ, IN
      *
      *            "PN" NON CASH PAYMENT/WITH GL ENTRY           TFC #013
      *            "PZ" NON CASH PAYMENT/NO RECDEL.WITH GL ENTRY TFC #012
      *            "IN" INSURANCE LOSS (LIKE PE) REGACC
      * REV:
      *  053095 SLC COMBINED OTHBAL AND OT2BAL IN L-090
      *  060295 SLC ADDING Z2 TRAN CODE (PAY DOWN OT2BAL)
      *  060695 BLL ADD NEW GL ENTRY ROUTINES
      *  081895 JTG ADDED BACK THE TEST FOR BALANCE GOING BELOW NET PAYOFF
      *             FOR 'PY'. EVEN THOUGH ALL OTHER RELEASES LET 'PY'
      *             BRING BALANCE BELOW NET PAYOFF.  REALLY NOT SURE
      *             IF THIS WILL CAUSE ANY PROBLEMS, BUT DOING IT ANYWAY!!
      *  082295 JTG CORRECTED LOGIC TO TEST FOR APPLIED TO PRINCIPAL
      *             EXCEEDING (PRINBAL - OT2BAL)
      *  082595 JTG CORRECTED LOGIC TO TEST FOR APPLIED TO PRINCIPAL
      *             EXCEEDING (PRINBAL - OT2BAL - INTDUE - LCDUE)
      *  MJD 091895 ADDED DS-DATE LOGIC
      *  JTG 092595 ADDED LOGIC FOR INTER BRANCH PAYMENTS
      *  JTG 112095 CHANGED TO ALLOW FOR CALL TO DEBUG 'PAYOFX --  JAYOFX'
      *  BAH 012696 PASSWORD OVERRIDE OF A CALCULATED DEFERMENT
      *  BAH 022096 "DF" LP-LCPDTH-DATE WAS GETTING 6 DIGITS, CLEAR NDTE-MM
      *  MJD 030596 ADDED PAYOFF CODE SCAN
      *  JTG 043096 ADDED LOGIC TO UPDATE HOLD-AFPDLLP
      *  MJD 050296 ADDED GP-AUTO-REPO-WINDOW FOR RELIANCE. AUTOMATICALLY
      *             OPENS CHREPO WINDOW AT ENTER TILL # ON "SS" TRCD IF
      *             GP-AUTO-REPO-WINDOW = "Y".
      *  JTG 051596 ALLOWED "SS" TO POST ZERO PAYMENT
      *  MJD 071196 ADDED TEST OF LN-UNITPER-CD FOR WEEKLY PDTH
      *  JTG 082696 IF OT2BAL EXISTS, INSURE AT LEAST ($0.01 + LP-OT2BAL)
      *             REMAINS IN LP-CURBAL:
      *             IF NO OT2BAL, DON'T LET LP-CURBAL GO NEGATIVE:
      *  JTG 101196 ADDED 'LPREGZW' & 'LPREGZ' FOR LPCERN-- A50 VERSION
      *             ADDED HOLD-EARNINGS-IB-OWING
      *                   HOLD-EARNINGS-IB-ERNINT
      *                   HOLD-EARNINGS-IB
      *                   WK-LXE-WORKER & WK-LXE-WORKER1
      *                   SP-ERNFRMLA 15, REAL INTEREST BEARINGING METHOD
      *                                            - INSTANT AUTO, KY
      *  JTG 010397 CHANGED TEST FOR LCPDTH & LCHG DISPLAY TO NEVER DISPLAY
      *             IF SP-LCFRMLA = " " AND REMOVED TEST ON JUDGEMENT
      *             SINCE ACCOUNTS IN JUDGEMENT CAN CONTINUE AS PRECOMP
      *  JTG 040797 CLEARED EARN-BUF TO SPACES IN DISPLAY-EARNINGS ROUTINE
      *             WAS LEAVING GARBAGE D-LCPDTH FROM ENTRY-LINE-DISPLAY
      *  GLF 090897 REPLACED 'IO' ON GP-FILE WITH GET 'GPENV'
      *  JTG 091897 ADDED TEST FOR TRCD = 'AH', WORLD A90
      *  GLF 101497 ALLOWED CTRL 'N'
      *  MJD 101797 MOVED WK-UPDATE-BUF TO LP01WK
      *  BLV 110397 MOVE IN BR-GL-TYPE-ALLOWED, BR-GL-ENTRY-DEFAULT TO
      *             ALLENT-BUF BEFORE GL DISTRIBUTION WINDOW
      *  JTG 120397 ADDED BR-NODEF-IF-ZERO-AMT OPTION MERCURY
      *  JTG 032798 ADDED SET OF CERN-TRCD, RE: ERNFRMLA = 6, PREMIER FINANCE
      *             TO STOP TAKING INCOME ON "SS" TRANSACTION
      *  JTG 041598 ADDED LOGIC TO TEST FOR FULL PAYOFF AMOUNT AND STOP IT
      *                99/99/99  RC    25.00           25.00  9999       1123.00
      *                99/99/99  RI   123.00          123.00  9999       1000.00
      *                99/99/99  PO  1010.00  10.00  1000.00  9999          0.00
      *             TEST STOPS POSTING A PAYMENT WHICH YIELDS APPLIED TO PRIN
      *             OF EXACTLY $1000.00, WHICH RESULTS IN A TRUE PAYOFF.
      *             THE ACCOUNT MUST FIRST PREPARE FOR THE PAYOFF, WHICH IN
      *             THIS CASE WOULD BE POSTING AN 'RC' & 'RI'.
      *  JTG 060598 ALLOWED INPUT OF TRCD'S "PX" PARTIAL CHARGE OFF,MERCURY #175
      *  BAH 062698 TILLNO IS NOW ALPHANUMERIC
      *  BAH 073098 DISPLAY BALANCES EVEN ON REVERSALS, #487
      *  JTG 083098 REMOVED TEST ON "SS" IN TEST-FOR-PE-AL ROUTINE SINCE THIS
      *             WAS CAUSING RESET OF LN-LCBAL ON REVERSAL OF "SS"
      *  MJD 083398 ADDED ENV VARIABLE TO DETERMINE WHETHER OR NOT
      *             TO DISPLAY BALANCES ON REVERSALS. FIXED DISPLAY TO INDICATE
      *             INCLUDED O2 BAL WITH "SC" "RN" "PB" "RB" "RO" TRANSACTIONS
      *  JTG 112498 ADDED LOGIC FOR REVOLVING ACCOUNTS
      *  JTG 990203 ADDED ONVIRONMENT VARIABLE "REVOL_NEG_BAL" WHICH CAN BE SET
      *             TO "Y" TO ALLOW NEGITIVE BALANCE ACCOUNTS
      *  JTG 990322 STOPPED RE-APPLY OF LATE CHARGES APPLIED FOR SP-LCFRMLA'S
      *             "B" OR "G" OR "J" OR "K"
      *  JTG 990324 ADDED "PN" NON CASH PAYMENT/WITH GL ENTRY           TFC #013
      *             ADDED "PZ" NON CASH PAYMENT/NO RECDEL.WITH GL ENTRY TFC #012
      *  JTG 990408 CHANGED TO PASS LN-OWNBR TO GL/ALLENT.C FOR INTERBRANCH
      *             PAYMENTS:
      *  JTG 990408 CORRECTED RE-APPLY OF LATE CHARGES APPLIED FOR SP-LCFRMLA'S
      *             "B" OR "G" OR "J" OR "K"
      *  JTG 990421 CORRECTED RE-APPLY OF LATE CHARGES APPLIED FOR SP-LCFRMLA'S
      *             TO LP-APINTOWE "B" OR "G" OR "J" OR "K" PER: SP-LCTYPE = 'P'
      *             WHICH DOSN'T USE A % OF RATE
      *  GLB 990720 ADD CASH DRAWER PASSWORD OPTION TO ENTER DRAWER NO.
      *             BR-PASSWORD-DRAWER(Y/N) & CA-PASSWORD (4 CHAR PASSWORD)
      *             REGMGM PR# 901
      *  MJD 990806 ADDED GP-INCL-OTH-IN-EARNED FLAG. IF "Y" THEN INCLUDE
      *             EARNINGS BUCKET 6 (OTHER) IN ACCUMULATED TOTALS
      *             OTHERWISE EXCLUDE BUCKET 6.
      *  JTG 990809 ADDED LOGIC FOR REVOLVING 'PE' PAYMENT EXCEPTION
      *  JTG 990421 CORRECTED RE-APPLY OF LATE CHARGES APPLIED FOR SP-LCFRMLA'S
      *             TO LP-APINTOWE "B" OR "G" OR "J" OR "K"
      *             BY SETTING LN-LC-CODE TO ZERO CAUSING LPLCAP TO NOT READ
      *             THE ELFILE AND OVERRIDE THE SP FIELDS SET TO ZERO IN LONPFC
      *             COLONIAL TN
      *  JTG 991118 CHANGED PASSED VALUE FOR CERN-PAYMNTD TO BE SUM OF
      *             LN-TOTPAYMNTD + LN-TOTEXCPAYMNTD PRIOR TO THIS TRANSACTION
      *             RE: CHALLENGE FINANCE #258
      *  MJD 991220 ADDED LN-TOTNODEFACT AND LN-YTDNODEFACT (WORLD PR#216)
      *  MJD 000119 ADDED XX-NOLCHG (WORLD PR#218)
      *  JTG 000300 MOVED GET-GPENV OUT OF IF CONDITION RE: GP-PDTH-GT-SCHED-PAY
      *                                                            MERCURY #J001
      *  JTG 000417 CHANGED NEW DEFERMENT FORMULA 97 INTDUE OR 1/3 OF REGPAY
      *             TO BE DISBURSED TO LP-APINT AND LP-APCUR, MERCURY #
      *  BAH 000421 REMOVED "IF NOT (LP-TRAMT = LN-REGPYAMT) FOR TESTING NETDUE
      *             PRIN EXCEEDS-NET-PAYOFF, WISC PL# 279 , THEY WERE MAKING
      *             A REGPAY BUT THE PREVIOUS PAYMENTS WERE MUCH HIGHER, AND
      *             THIS REGPAY CAUSED THE ACCT TO GO BELOW NETPAYOFF
      *  JTG 000505 CORRECTED NEW DEFERMENT FORMULA 97 INTDUE OR 1/3 OF REGPAY
      *             TO BE DISBURSED TO LP-APINT AND LP-APCUR, MERCURY #224
      *  JTG 000523 CORRECTED NEW DEFERMENT FORMULA 97 INTDUE OR 1/3 OF REGPAY
      *             TO NOT UPDATE LN-TOTPAYMNTD IN THIS POSTING PROGRAM,
      *             WHICH CAUSED PAIDTHRU TO INCREASE WRONGFULLY  MERCURY #224
      *  JTG 000601 CORRECTED CHANGE MADE ON 000523 WHICH IN ERROR CHANGED
      *             ADDS TO SUBTRACTS
      *  JTG 000622 CORRECTED FORMULA'S 99, 98 AND 97 INTEREST BEARING
      *             DEFERMENT CHARGES, BY SETTING UP DEF-TOTAL-INTDUE
      *             AS A INPUT FIELD AND NOT USING INDU-INTEREST MERCURY #224
      *  JTG 000630 CORRECTED FORMULA'S 97 INTEREST BEARING
      *             DEFERMENT CHARGES ERROR WHEN INDU-INT + INTOWE WAS LESS
      *             THAN 1/3 OF A PAYMENT MERCURY #224
      *  JTG 000831 MADE ANOTHER ATTEMPT TO CORRECT RE-APPLY OF LATE CHARGES
      *             APPLIED FOR SP-LCFRMLA'S "B" OR "G" OR "J" OR "K"
      *             CHANGED ROUTINE TO NOT REDUCE LCAP-TRAMT BY THE AMOUNT
      *             APPLIED TO INTEREST LP-APINT
      *  MJD 000914 ADDED SET OF LN-LBOX IF TRCD = "PA" AND REFNO = "LBOX"
      *             (MFC PR#227)
      *  JTG 001002 ADDED CLEAR OF F4-FLAG = 0 AT TOP OF PROGRAM TO INSURE
      *             IT RETAINS THIS INITIAL VALUE RE: RELOAD        REGENCY #299
      *  JTG 001117 MADE ANOTHER ATTEMPT TO CORRECT RE-APPLY OF LATE CHARGES
      *             ALLOWED THE ROUTINE TO WORK FOR SP-LCFRMLA-PRIN-ONLY
      *             WHICH IS  "B" "F" "G" "I" "J" "K" "L" "M"
      *             RE: CITIZENS FINANCE PR#304
      *  MG  010201 REMOVED "01 WK-LXE" AND ADDED LIBLP/LPWKLXE.
      *  JTG 010222 CORRECTED AUTO 'Z2' TO COMPUTE INTEREST & LATE CHARGES
      *             RE: GP-ALLOW-SET-FOR-NONCASH MERCURY PR#239 PR#J015
      *  JTG 010223 CORRECTED AUTO 'Z2' TO DO AN 'AL' WHEN COMPUTING LATE
      *             CHARGES, BECOUSE THE TRAMT WAS REDUCED TO THE AMOUNT BEING
      *             APPLIED AS A 'Z2', LATE CHARGES WERE NOT ASSESSED AS THEY
      *             WERE IN LONPW5.C AND LONPW6.C VIA A PAYOFF
      *             RE: GP-ALLOW-SET-FOR-NONCASH MERCURY PR#239 PR#J015
      *  JTG 010316 CHANGED TO TEST FOR LP-REFNO = ALLOT, LBOX, TCOLL,
      *             TPAY, WESTU                  MERCURY PR#245
      *  JTG 010228 ADDED NEW RATE TYPE 'Z' AMORTIZED WHERE RUNTIME COMPUTES
      *             INTEREST ON A 30 DAY METHOD (REAL ESTATE) AND LOAN CALCS
      *             ARE DONE SIMPLE, REMOVED TIE TO CTBL, FORCING TESTS ON (1)
      *                                             LENDMARK PR#1045 & PR#1380
      *  JTG 010413 CORRECTED TEST FOR LP-REFNO = ALLOT, LBOX, TCOLL,
      *             TPAY, WESTU  RE: SET OF LN-LBOX OR LN-ALLOCTCD
      *                                                          MERCURY PR#245
      *  JTG 010413 STOPPED 'PN' AND 'PZ' TRCD FROM COLLECTING OTHER 'OT'
      *             AND 'OT2' MONIES                                 TFC PR#323
      *  JTG 010522 ADDED CERN-APINT, CERN-APLC, CERN-APOTH, CERN-APOT2
      *             NEW CODE '23' FOR SP-ERNFRMLA                 PAACO PR#1469
      *  GLB 010618 ADDED TEST OF LN-REVOLVING TO SKIP TESTING 0 BALS.
      *             PROBLEM IF REVOLVING AND CURBAL = 0 AND PARTIAL
      *             PAYMENT OF REMAINING INTEREST, LC, OTHER, ETC.
      *             SEE PARA "ACCEPT-F4-BYPASS"
      *  JTG 010619 CORRECTED CHANGE MADE 010413 WHICH STOPPED 'PN' AND 'PZ'
      *             TRCD'S FROM COLLECTING OTHER 'OT' AND 'OT2' MONEY TFC PR#323
      *             THE CHANGED CAUSED NO DISBURSMENT TO LCHG OR INT AND FORCED
      *             ENTRY OF TRAMT IN SOME CASES 2 TIMES
      *  BAH 010619 ADDED WINDOW ENTRY OF AUCTION EXPENSE WHEN POSTING "SS" IF
      *             GP-REPO-CODE = "A", REGACC PR# 1478, ALSO PASSWORD IF ENTER
      *             0 IN THIS AMOUNT.
      *  JTG 010711 ADDED NEW RATE TYPE 'Z' AMORTIZED WHERE RUNTIME COMPUTES
      *             INTEREST ON A 30 DAY METHOD (REAL ESTATE) AND LOAN CALCS
      *             ARE DONE SIMPLE, REMOVED TIE TO CTBL, FORCING TESTS ON (1)
      *                                             LENDMARK PR#1045 & PR#1380
      *  BAH 010712 ADDED PASSWORD FOR 0 SS AMT, REGACC PR# 1478 (REPO STUFF)
      *  JTG 010814 CHANGED GI-PAYWESTU TO GI-PAYMGRAM           MERCURY PR#258
      *  JTG 010904 ALLOWED IB TYPE LOANS TO ACCELERATE     JIM R. (ALL) PR#1582
      *  JTG 011004 ADDED HOLD-LXZ(FIELDS) FOR UPDATE LX-Z RECORD
      *             RE: NEW RATE TYPE 'Z' AMORTIZED   LENDMARK PR#1045 & PR#1380
      *  JTG 011219 ADDED OPTION FOR 'SS' GP-DONT-COLL-INT-ON-SS  REGACC PR#1684
      *  BAH 011228 ABOVE CHANGE HAD PASSWORD ON COLLECTING OTHER BAL, NEEDED
      *             TO ASK PASSWORD ON WAIVING COLLECTING OTHER BAL !! 1684
      *  JTG 020108 DON'T ALLOW INPUTED DEFERMENT TO EXCEED CALCULATED
      *             DEFERMENT AMOUNT:                    PFSIMO PR#340
      *  JTG 020122 CHANGED TO SET HOLD-LXZ(FIELDS) FOR UPDATE LX-Z RECORD
      *             WHEN F4-REAPPLY IS NOT SELECTED
      *             RE: NEW RATE TYPE 'Z' AMORTIZED   LENDMARK PR#1045 & PR#1380
      *  JTG 020123 EXPANDED PAYMNTD FIELDS TO 1,000,000        LENDMARK PR#J021
      *  JTG 020722 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *  CS  020820 IF REVOLVING ACCOUNT & SPECIAL PROGRAMS EXIST, POP A APPLY
      *             DISTRIBUTION WINDOW THAT ALLOWS OVERRIDE OF CALCULATED
      *             FIFO APPLY [LENDMARK 1877]
      *  BAH 021011 ADDED NEW TRANSACTION CODE OF "IN" INSURANCE LOSS, EXACTLY
      *             LIKE "PE", REGACC PR# 0007
      *  BAH 021105 REGACC DID NOT WANT LN-LBOX OR LN-ALLOTCD BEING SET
      *             AUTOMATICALLY ANYMOER !! KEVIN
      *  JTG 021112 ADDED NEW CODE FILE TYPE 'BR' -BATCH PAYMENT REFERENCE CODES
      *             BATCH PAYMENT REVISIONS                         REGACC #0006
      *  JTG 030213 CHANGED MIP LOGIC PER DIRK:
      *             IF TODAY MM/YY LE MIPPDTH DON'T COLLECT PREMIUM
      *             IF TODAY MM/YY GT MIPPDTH COLLECT PREMIUM       REGENCY #392
      *  BLV 030321 WORLD IS TESTING CASH DRAWER PASSWORDS IN A FEW BRANCHES;
      *             PROBLEMS BECAUSE WE ARE ENTERING THE POSTING CASH DRAWER,
      *             BUT HERE WE WERE TESTING THE BRANCH CASH DRAWER PASSWORD
      *             FLAG OF OWNING BRANCH.  SO WILL READ IN POSTING BRANCH &
      *             SAVE FLAG, THEN RESTORE OWNING BRANCH
      *  BLV 030325 FIX CHANGE ABOVE, NORMAL (NON-INTERBRANCH) PMT WAS ASKING
      *             FOR DRAWER INSTEAD OF PASSWORD
      *  JTG 030408 CORRECTED MIP LOGIC PER DIRK:
      *             WHEN OPERATOR ARROWED BACK TO LP-TRAMT AND INTEREST AND
      *             LATE CHARGES HAD BEEN APPLIED, PAYMENT HISTORY CLEARED
      *             FROM DISPLAY. WHEN HISTORY WAS REDISPLAYED LP-TRAMT
      *             INCLUDED MIP PAYMENTS FROM HOLD-MIP FIELDS.    REGENCY #0402
      *  JTG 030523 CORRECTED UP-KEY FROM TILL WHEN 'SS' AND
      *             GP-DONT-COLL-INT-ON-SS, WAS PUTTING APPLIED
      *             TO OTHER INTO LP-OTHBAL BY MISTAKE              CASHCO #J027
      *  JTG 030923 CORRECTED OVERRIDE OF COLLECTED OTHER CHARGES WHEN MIP
      *             INSURANCE HAS REDUCED THE TRANSACTION AMOUNT   REGENCY #0416
      * BAH 040311 ADDED GP-BACKDATE-MEMO TO POP UP MEMO WINDOW WHEN
      *            BACKDATING A "PY". THEY WILL BE FORCED TO ENTER SOMETHING.
      *            WORLD #344
      * JTG 040330 ADDED LOGIC FOR POSTING BATCH PAYMENTS TO ACCOUNT'S
      *            WITH 'LN-OTBAL'                                 CENTRIX #2253
      * BAH 040608 DISPLAY A WARNING MESSAGE WHEN APCUR HAS MONEY AND THERE IS
      *            STILL INTEREST OWING ON AN 'IB' ACCOUNT, REGENCY PR# 2312
      *            GP-I-AM-REGENCY ONLY !!
      * BLV 040619 CHANGE SV-RATE FROM PIC V99999 TO PIC 9V99999. IF DL-SVACCT-
      *            RATE WAS 100%, THEN COMPUTATION OF SV-RATE WAS 0, AND SO
      *            ALL PROCEEDS WENT TO DEALER INSTEAD OF US
      * BAH 040727 CHANGED A BOGUS ERROR MESSAGE FROM "INSUFFICIENT AMOUNT
      *            IN DEALER RESERVES" TO "PROBLEM GETTING DEALER RESERVE
      *            BALANCES" BECAUSE ITS ON THE READ-DS1-FILE NOT FOUND, SO
      *            THE DS RECORD HASNT BEEN CREATED YET.
      * JTG 040827 ALLOW BATCH PAYMENTS TO ACCOUNTS WITH OTHER BALANCE BUT
      *            NOT APPLY APPLY MONIES TO OTHER BALANCE          REGACC #0070
      * JTG 040921 CHANGED LOGIC FOR POSTING BATCH PAYMENTS TO ACCOUNT'S
      *            WITH 'LN-OTBAL' TO MAKE AN ENTRY FOR LP-APOTH IN THE
      *            TP-GLTABLE WITH CD-BR-OT-GL-BRANCH ACCOUNT NO.
      *            ALLOWING G/L TO UPDATE LIKE A MANUAL 'PY' WITH APPLY TO OTH
      *                                                           CENTRIX #2253J
      * JTG 040922 CHANGED LOGIC TO TEST FOR CD-BR-OT-GL-BRANCH = 0
      *            AND MOVE LN-OWNBR TO GLNO-BR                   CENTRIX #2253G
      * BAH 050203 IF F7 FROM AUCTION EXPENSE WINDOW, GO BACK TO DATE ENTRY
      *            THEY MUST ENTER AN AMOUNT OR KNOW THE PASSWORD FOR ENTERING
      *            ZERO, KEVIN REGACC
      *  CS 051202 WHEN DUE DATE 29,30,31, FEB PMT/LCPDTH 2/28/??, THEN A DF
      *            IS POSTED, LCPDTH DAY REMAINS AT 28TH, CAUSING LATE CHGS
      *            ON SUBSEQUENT PMTS. ALL OTHER TRANSACTION CODES PERFORM LATE
      *            CHARGE APPLY WHICH RESETS LCPDTH CORRECTLY. INCR-LCPDTH IS
      *            DONE ONLY IF DF-POSTING SO I ADDED TEST TO RE-SET LCDPTH IF
      *            1STPYD > 28 [TRITON PR#502]
      * JTG 051213 ADDED NEW OPTION (BR-BP-PL OR BR-LBOX-PL = 'P') FOR
      *            CHARGE OFFS TO APPLY ALL MONIES TO PRINCIPAL
      *            (DEFERRING LATE CHARGES, INTEREST AND OTHER TO OWING) AND
      *            REJECTING PAYMENT AMOUNT IF GREATER THAN PAYOFF  REGACC #0110
      *  CS 060111 IF BR-LBOX-PL 'P', ACCOUNTS WITH NO LC OWING WERE CORRECT,
      *            ACCOUNTS WITH OWING LC > PAY AMOUNT SUBTRACTED THE PAY AMOUNT
      *            FROM BOTH LC OWING & PRINCIPAL, IF LC OWING < PAY AMOUNT WAS
      *            COLLECTING LC & DECREASING PRIN BY DIFFERENCE.. IF THIS FLAG
      *            IS 'P' ALL MONIES SHOULD GO TO PRINCIPAL SO ADDED TEST OF
      *            BATCH-PL-DEFER-FG TO BEFORE PERFORMING DISBURSE LCBAL &
      *            DISBURSE INTBAL
      * BAH 060309 WORLD MUST WAIVE LATE CHARGES ON A CCCS (CONSUMER CREDIT
      *            COUNSELING SERVICE) PAYMENT, WORLD PR# 458
      * BAH 060407 ADDED DL-SVACCT-LCHGPER-DEC, INTPER-DEC AND DEFPER-DEC
      *            AS REDEFINES FOR UNION, PR# 2756
      *  CS 070420 ADDED IF 'SS' AND GP-DONT-COLL-INT-SS = Y, SKIP APPLYING TO
      *            INT/LC... IT GOES IN OWING PR#168 REGACC
      *  CS 070703 ADDED SP-DEFFRMLA 96 2% OF BALANCE, IF INTEREST DUE > 2%
      *            COLLECT 2% INTEREST & PUT THE REST IN OWING, IF INTEREST
      *            DUE < 2% COLLECT INTEREST DUE & APPLY REMAINDER TO
      *            LP-APCUR MULLEN PR#2477
      * JTG 070711 ATTEMPTED FIX FOR #0416 REGENCY WHEN POSTING A 'DF'
      *            AND THE OPERATOR UP ARROWS BACK TO THE REFNO FIELD
      *            WHICH LOADS LP/LONPF1.C AND RETURNS BACK TO
      *            LP/LONPFC WITH LP-TRAMT-HOLD-FOR-MIP = 0
      *                                                             WAGNER #592
      *                                                                   #0416
      *  CS 070814 DON'T ALLOW OVERRIDE OF CALCULATED DF AMOUNT IF SP-DEFFRMLA
      *            = 96 (MULLEN IB 2%). ALSO HAD A BUG IF YOU UP-ARROWED AND
      *            RETYPED THE DF AMOUNT, DID NOT SET LP-INTBAL CORRECT PR#2477
      *                                                              MULLEN
      *  CS 080708 IF GP-I-AM-REGACC & BR-POFF-TITLE-WINDOW IS 'Y', IF POSTING
      *            AN 'IN' TRANSACTION, CALL THE POFF-TITLE-WINDOW REGACC#187
      * BAH 080731 ADDED BR-FILE TO DECLARATIVES, CAUSING FALL OUT TO $ SIGN IF
      *            NEW CUSTOMER AND NO BR-FILE.
      * BLM 081001 IF NEW BATCH REFERENCE FLAG CD-BR-COLLECT-LC = "N", DON'T
      *            APPLY BATCH PAYMENT TO LATE CHARGES OWING, WORLD PR# 603
      *  CS 081024 ALLOW 'DF' TO POST THRU BATCH, RESTRICTED TO SP-DEFFRMLA
      *            REGACC USES(0,2,3,96,97,99)  ALSO ALLOW 0 AMOUNT DF
      *            IF BP-ALLOW-ZERO-DF IS 'Y', ADDED BP-IGNORE-DEFPOL WHICH
      *            IGNORES MAX # OF DEFEREMENTS IF THIS FLAG IS 'Y'.
      *                                                   PR#219 REGACC
      *  CS 081113 ADD TEST GP-INCL-OTH-IN-EARNED = 'R'. IF 'R' EXCLUDE
      *            OTHER(ANTICERN(6) AND MAINTFEE(ANTICERN(4) FROM EARNINGS
      *            AND UNEARNED    REGACC PR#210
      *  BAH 081119 ADDED IB DEFFRMLA 95 TO WORK LIKE 96, REGACC PR# 3280
      *   CS 090121 WANTED IB DEFFRMLA 95 TO ALLOW OVERRIDE OF CALCULATED
      *             AMOUNT.  EXCEPT ANY AMOUNT THEY ENTER, COLLECT INTEREST
      *             IF SHORT, PUT IN OWING, IF ALL INTEREST COLLECTED &
      *             MONEY LEFT, APPLY TO PRINCIPLE UPDATING EXCEPTION PAYS.
      *   CS 090205 CORRCT DFFRMLA 95. IF YOU CHANGED THE CALCULATED DF, IT
      *             DID NOT RECALCULATE LP-APINT OR LP-APCUR  HAMPTON RDS.
      *   CS 090825 'PX' ALLOWED OTHER-BAL HIGHER THAN CURBAL.ACCT HAD OT & OT2
      *                  TRCD   AMT       PRIN    OT    - 433.29O2      PRIN
      *             EX:  02     433.29  433.29   567.03 - 133.74OT     933.29
      *             WE COMPUTED NETDUE-PRIN = 933.29 + 133.74 - 433.29 = 633.74
      *             THE MOST IS SHOULD HAVE ALLOWED WAS 499.99. ADD TEST TO
      *             TRANS-AMT-ENTRY. IF 'PX', IF LP-APCUR > LP-CURBAL -
      *             LP-OT2BAL,GIVE MESSAGE AND DONT ALLOW. THRIFT PR#663
      *  BLM 100305 ADD ESCROW WINDOW FOR APPLICATION OF ESCROW TO PAYMENTS,
      *             MANY CHANGES FOR ESCROW. ALSO CHANGED FORM LONPF TO
      *             DISPLAY ESCROW APPLIED, FIELD IS APPLIED_PRMT, SHOULDN'T
      *             REQUIRE FORM TO BE SENT UNLESS CUSTOMER IS DOING ESCROW.
      *             REGWAN PR# 3506
      *  BLM 100309 CORRECT ESCROW APPLICATION FOR ODD 1ST PAY, REGWAN PR# 3506
      *  BLM 100316 ANOTHER CORRECTION FOR ESCROW APPLICATION FOR ODD 1ST PAY,
      *             REGWAN PR# 3506
      *  BLM 100317 SUBTRACT LN-OTHBAL FROM POT WHEN TRYING TO FIGURE OUT
      *             DEFAULT ESCROW APPLICATION.  ALSO, MOVED WHERE I WAS
      *             SUBTRACTING LN-LCBAL.  REGWAN PR# 3506
      *  BLM 100330 AT END OF ESCROW APPLY ROUTINE, MOVE ESCROW-AMT TO
      *             LCAP-ESCROW-AMT, NEED THIS IN SETUP-LCHGS WHEN
      *             DETERMINING IF TRAMT IS ENOUGHT TO COVER LATE CHARGES,
      *             REGWAN PR# 3506
      *  BLM 100331 BARB & CINDY: FIXED PROBLEM WITH POSTING A PMT TO AN
      *             ACCT WITH OTHER BAL WHEN TRAMT IS LESS THAN LP-OTHBAL
      *             (OR TRAMT IS APPLIED TO ESCROW SO BALANCE OF TRAMT IS
      *             LESS THAN LP-OTHBAL).  SEE EXPLANATION IN CODE WHERE
      *             CHANGE WAS MADE, JUST BEFORE "ENTRY-LINE-SKIP-APOTH".
      *             REGWAN PR# 3506
      *   CS 100419 DONT' ALLOW ZERO AMOUNT FOR 'Z2'  BAY PL#685
      *  BLM 100819 PROBLEM WITH PMTS ON ACCOUNTS THAT HAVE ESCROW & MIP:
      *             BOTH THE ESCROW & MIP ROUTINES PLAY WITH TRAMT.  THE
      *             MIP ROUTINES SUBTRACT OUT THE MIP PAID, THEN AT THE
      *             END (IN SAVE-SCREEN) ADD THEM BACK IN.  THE ESCROW
      *             ROUTINES ALSO PLAY WITH TRAMT, THEY HAVE TO SUBTRACT
      *             IT BEFORE SOME LATE CHARGE CALCULATIONS & RIGHT BEFORE
      *             THE SAVE-SCREEN, IF THE ESCROW FLAG IS ON, THE ESCROW
      *             ROUTINE WAS RESTORING ORIG-LP-TRAMT TO LP-TRAMT.
      *             SO WE RESTORED THE FULL AMT (WITHOUT THE MIP SUBTRACTED)
      *             THEN SAVE-SCREEN ADDED BACK IN THE MIP PAID & THE
      *             TRAMT WAS HIGH BY THE MIP AMOUNT & PUT GL OUT OF BALANCE.
      *             I CHANGED TO ROUTINE IN SAVE-SCREEN TO MOVE THE
      *             ORIG-LP-TRAMT (SAVE BY ESCROW ROUTINE) IF BOTH ESCROW
      *             & MIP.  REGWAN PL # 698
      *  BLM 100819 IF ACCOUNT HAS MIP AND ESCROW, PERFORM DETERMINE-MIP-
      *             REQUIRED IN ESCROW ROUTINE & SUBTRACT MIP AMTS TO BE
      *             PAID BEFORE ALLOCATION OF DEFAULT ESCROW AMT,
      *             REGWAN PL# 698
      *   CS 111103 IF ACCOUNT HAS ESCROW & POSTING 'PX' IT THINKS THE TRAN
      *             AMOUNT IS ZERO. ON ACCTS WITH ESCROW(LN-ESCROW = "Y") THE
      *             LP-TRAMT IS STORED IN ORIG-LP-TRAMT & WE MANIPULATE LP-
      *             TRAMT & THEN RESTORE ORIG-LP-TRAMT. WHEN POSTING 'PX'
      *             ORIG-LP-TRAMT IS NEVER SET, SO EVERYWHERE WE TEST LN-ESCROW
      *             AND USE ORIG-LP-TRAMT ITS ZERO.  I ADDED A MOVE OF LP-TRAMT
      *             AT THE POINT WE TEST FOR 'PX' & MOVE LP-TRAMT TO LP-APCUR TO
      *             MOVE TO ORIG-LP-TRAMT. REGACC PR#754
      *  BLM 120118 IF ESCROW FLAG ON BUT NO ESCROW RECORD, PROGRAM WOULD
      *             GET MISSING FIELD, SO CLOSE ESCROW WINDOW IF EXITING
      *             WITH READ ERROR ON ESFILE, PER CINDY... ADDED CLOSE OF
      *             WINDOW IN GET-ESCROW-RECORD IF IO-BAD PR#767
      *   CS 120807 ADDED UPDATE OF HOLD-PRIOR-DF-CODE, HOLD-PRIOR-DF-POSTDATE
      *             TO LPPFBUF   PR#318 REGACC
      *  BAH 121130 POSTING DF LOCKING UP FOR REGACC,BUG IN FIND-PRIOR-DEFERMENT
      *             MISSING IO-FG TEST AFTER READ, REGACC PL# 786
      *  BAH 130111 ADDED LC-DISPLAY-ERN OPTION OF "I" FOR POFF-INTDUE
      *                                              AMERICAN ACC PR# 4190
      *   CS 130606 IF POSTING A TDR2 DF VIOLATION & YOU PRESS F1, THE HOLD-
      *             TDR1 & HOLD-TDR2 WERE NOT SET TO 'N' CAUSING TDR1/TDR2
      *             STATUS TO BE UPDATED TO LR (TRIAD) PR#338
      *   CS 130614 ACCOUNT WAS NOT FLAGGED AS TDR2 BECAUSE I HAD A TEST THAT
      *             LR-LAST-PX10-DF-REFNO OR PREV-PX10-REFNO WERE SPACES, EXIT
      *             TDR2 CHECK, BUT WE ALLOW SPACES AS A VALID REFNO PR#338
      * BAH 130717 ADDED SP-SHORT-PAY-THRESHOLD FOR NEWPORT PR# 4334
      * BAH 130829 FIX CA-PATH IF YOU ARE POSTING INTERBRANCH PMT, SO IF
      *            U R BRANCH # POSTING FOR BRANCH 2, CA-PATH SHOULD BE
      *            BRANCH 1 PATH
      * BAH 140505 RENAMED WI/TITLE TO WI/TITLEW, RESERVED WORD VERYANT
      * BLM 131023 FIX AN ESCROW PROBLEM WHEN NEW YEARS ESCROW HAS NOT BEEN SET
      *            UP AND A PMT IS MADE. AFTER ESCROW WAS ADDED, IT CHANGED
      *            THE DELINQUENCY STATUS OF THE ACCT IN STATS.  SO WHEN A PMT
      *            IS MADE ON AN ESCROW ACCOUNT, IF THERE IS NO ESCROW SET UP
      *            TO APPLY TO, STOP THEM FROM POSTING.  USER WILL GET MESSAGE
      *            "SET UP NEXT YEAR'S ESCROW SCHEDULE BEFORE POSTING PMT!".
      *            THERE IS A FORCED PASSWORD JUST IN CASE WE NEED TO ALLOW
      *            THIS BUT DON'T RECOMMEND USING IT.  LP/LONPFC/OPT 6.
      *            REGWAN PL# 820
      * BLM 131028 FIX AN ESCROW PROBLEM WHEN ENTIRE PMT IS APPLIED TO
      *            ESCROW & THERE IS A LATE CHARGE, IT MADE NEGATIVE INT DUE
      *            & APPEARED TO COLLECT LATE CHG EVEN THO MONEY ALL WENT TO
      *            ESCROW. IF THE IS A LATE CHG TO COLLECT, NOW USER MAY NOT
      *            APPLY ENTIRE PMT TO ESCROW, LATE CHARGE IS SUBTRACTED FROM
      *            AMT AVAILABLE TO POST TO ESCROW.   USER WILL GET A MESSAGE:
      *            "ESCROW CAN'T EXCEED PAYMENT AMT - LATE CHG". REGWAN PL# 824
      * BLM 140717 ABOVE FIX (PL 824) WAS NOT CORRECT.  IN SOME CASES, EVEN
      *            ON A NEW ACCT WITH NO LATE CHARGES, YOU WOULD GET MESSAGE
      *            "ESCROW CAN'T EXCEED PAYMENT AMT - LATE CHG".  ADDED
      *            WORKER, MAX-ESCROW-ALLOWED, WHICH IS PMT AMOUNT REDUCED
      *            BY LCAP-APP & LCBAL.  ESCROW AMT CAN'T EXCEED THIS.
      *            ALSO, IF USER OVERRIDES DEFAULT ESCROW AMOUNT & AMT IS
      *            NOT ALLOWED, RESTORE DEFAULT ESCROW AMOUNT FOR ENTRY
      *            COLTN PL# 875
      * BAH 140812 COMMENTED OUT CLEARING OF "APPLIED-PRMT" FIELD, WAS CLEARING
      *            THE "__ APPLIED ___" PROMPT WHEN HIT F1
      * BAH 140814 ADDED TEST FOR LPSMNU IN HELP
      * BLM 141029 FIX ENTRY OF PO CODE, USE C$JUSTIFY INSTEAD OF MESSING WITH
      *            VDUPROCESS.  
      *  CS 141107 PUT BACK RESET OF APPLIED-PRMT FIELD TO "APPLIED" PRIOR
      *            TO GO TO END-ROUTINE, WAS LEAVING THE ESCROW AMOUNT DISPLAYED
      *            WHEN YOU EXIT.
      * BLM 150410 IF THE LATE CHG BALANCE EXCEED THE PMT AMT ON AN ESCROW
      *            ACCT, USER STUCK WITH MESSAGE "ESCROW CAN'T EXCEED
      *            PAYMENT AMT - LATE CHG" & HAS TO BE KILLED.  FIXED TO
      *            FORCE 0 TO ESCROW & GIVE MSG "LATE CHG EXCEEDS PMT AMT,
      *            NO ESCROW APPLIED."  REGENCY PL# 881
      *  BAH 160125 SPLIT OUT LTFILE, PD0003
      *   CS 160222 REMOVE COPY LPWKLXE, ITS AN EARNINGS COPY MEMBER THAT IS
      *             PASSED IN LOAN PROCESSING VIA LP01WK USING WK-LX2-REC. 
      *             REPLACED WK-LX2-REC WITH WK-LXE-REC IN LP01WK 
      *             MOVED LPWKLXE TO LPWKLXE.NO
      *             SAVED VERSION LONPFC.160222
      *   CS 160304 IF ACCOUNT IS PREPAID NOT < SP-ALT-PREPAY-MONTHS FOR
      *             OPERATOR TO PERFORM A REBATE INTEREST (RI)
      *  BAH 160304 CHANGED TILLNO TO NUMERIC BUT NO ROOM ON SCREEN FOR 2 DIGITS
      *   CS 169321 TEST FOR DETERMINING PREPAY OR NOT SHOULD BE FROM
      *             LN-1STPYDATE TO LP-PAYDATE, IN THE CASE OF A REVERSAL OR
      *             BACKDATE, WE MIGHT NOT PROPERLY CATCH THE PREPAYMENT
      *                                           WORLD PR#1140
      *
      * KEC 2016.0325 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED CDSCAN-WINDOW-BUF TO HAVE MATCHING CD1-KEY
      *         LAYOUTS (FOR EACH CODE TYPE; CD-TYPE).
      *         CDSCAN-CD1-KEY IS THE NEW (PRIMARY) WITH REDEFINES OF
      *         CDSCAN-??-KEY (NEW).
      *
      * KEC 2016.0509 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED LN-APPNO TO USE LN-APP-NUMBER FOR MA1-KEY.
      * BLM 160513 FIX FOR NEW DS-DATE FORMAT, PD0003
      *  CS 160610 CHANGED TOTEARN, UNEARNED TO PIC S9(7)V99
      * BAH 161117 ADDED 2 DIGIT FIELD "DRAWER" ABOVE PAYMENT LINE FOR 
      *            NEW CASH DRAWER ENTRY
      *  CS 170103 IF LN-REVOLVING, SET GETLTR-STATUS TO "X". HERE WAS THE 
      *            PROBLEM. WE WERE SUBTRACTING HOLD-APAGEING-AMT(SUB)
      *            FROM LTR-AGEING-SUB (SETUP-PRIN-PAYMNTD) BUT THEN
      *            IN SETUP-PDTH-LPREC, WE PERFORM PAID-THRU WHICH READ THE
      *            LTR-AGAIN AND WIPED OUT THE SUBTRACT OF HOLD-APAGEING-AMT
      * KEC 2017.0105 {PR#00000} PARADATA <A30> [JAY CISZEWSKI]
      *          CHANGED DS-DATE TO DS-DATE-CCYYMM FOR CONSISTENCY
      *          WITH THE DATE FIELDS IN BY & UD FILE.
      *
      * BAH 170615 ACTIVATE 8 DIGIT DATES, PD0006
      * BLM 170608 PERFORM CONDITIONAL-SEND-MESS, ONLY DO SEND-MESS IF
      *            ROUTE-BUF = "00", WORLD PR# 1246
      * BLM 170619 FIX CONDITIONAL-SEND-MESS LOOP, PR# 1246
      * BAH 171129 FIXED WK-LXE-REC
      * KEC 2018-0824 LOAN APP MODULE REMOVAL FROM A30 [LARM30];
      *         LEAVING LN-APP-NUMBER & EXT-WI-CL-APP-NUMBER
      *         HERE IN CASE NEEDED IN THE FUTURE.
      * BAH 181231 GLOBAL LPFILE
      * BAH 190116 GLOBAL LXFILE
      * BAH 20190308 CHANGED LP-DLRVNO TO USE LPWSLP-LP-DLRVNO, MOVED LP-REFNO
      *              REDEFINITIONS TO LPWSLP COPY MEMBER
      * BAH 20190625 REMOVED LN-REVOLVING, PT0153
      * KEC 20190717 COMMENTED OUT THE USE OF REVOL-SIGN-WORKERS.
      * BAH 20200812 ADDED WHERE_CONSTRAINT
      * BAH 20210202 SKIP CD-BR-FILE-TYPE = "C", UMC DEBIT CARD, PR#1490
      * BAH 2022.0314 REMOVED EXT-SPANISH-FORMS AND ALL MX FORMS
      * BAH 20220818 REMOVED GLOBRD, READ GB-FILE INSTEAD
      * BAH 20220823 HARD CODED START
      *
      * JKC 2022-0930 CHANGED TO USE START-LP1-FILE-SCAN INSTEAD OF
      *          START-LP1-FILE; NEED TO USE START-LP1-FILE-SCAN WHEN
      *          START-LP1-FILE-NOT-GREATER IS USED FIRST; NEEDED FOR
      *          FOR DISPLAYING MULTIPLE PAGES IN AN UP & DOWN FUNCTION;
      *          NEED TO ADD ONE TO LP-SEQNO (IN WBEG) IN ORDER TO GET 
      *          THE DISPLAY TO WORK LIKE WITH VISION FILES.
      * SMR 2023-0418 MODIFIED FOR CHANGES TO LX FILES
      * BAH 2024.0311 REMOVED EXT-WI-CL-APP-NUMBER
      * BAH 2024.0417 REMOVED CHREPOW, CALL PROGRAM INSTEAD OF WINDOW
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. 3B.
       OBJECT-COMPUTER. 3B.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
       COPY "LIBLP/LPFSWK.CPY".
       I-O-CONTROL.
       DATA DIVISION.
       FILE SECTION.
       COPY "LIBLP/LPFDWK.CPY".

       WORKING-STORAGE SECTION.
       77  SCCS-IDENTIFIER PIC X(41) VALUE
           "@(#)LP/LONPFC.CBL S35 04/19/23-12:56:58 >".
      **************************************************
      *     P R O G R A M   W O R K E R S              *
      **************************************************
       COPY "LIBLP/LP01LN.CPY".
       COPY "LIBGB/GB01BR.CPY".
       COPY "LIBGB/GB01BR_SQL.CPY".
       COPY "LIBGB/GBWSBR.CPY".
       COPY "LIBGB/GB01GB.CPY".
       COPY "LIBGB/GB01GB_SQL.CPY".
       COPY "LIBGB/GBWSGB.CPY".
       COPY "LIBLP/LP01DS.CPY".
       COPY "LIBLP/LP01DS_SQL.CPY".
       COPY "LIBLP/LPWSDS.CPY".
       COPY "LIBLP/LP01DL.CPY".
       COPY "LIBLP/LP01DL_SQL.CPY".
       COPY "LIBLP/LPWSDL.CPY".
       COPY "LIBLP/LP01LP.CPY".
       COPY "LIBLP/LP01LP_SQL.CPY".
       COPY "LIBLP/LPWSLP.CPY".
       COPY "LIBLP/LP01LX.CPY".
       COPY "LIBLP/LPWSLX.CPY".
       COPY "LIBLP/LP01LXE.CPY".
       COPY "LIBLP/LPWSLXE.CPY".
       COPY "LIBLP/LP01LXG.CPY".
       COPY "LIBLP/LPWSLXG.CPY".
       COPY "LIBLP/LP01LTI.CPY".
       COPY "LIBLP/LP01LTI_SQL.CPY".
       COPY "LIBLP/LPWSLTI.CPY".
       COPY "LIBLP/LP01LTP.CPY".
       COPY "LIBLP/LP01LTP_SQL.CPY".
       COPY "LIBLP/LPWSLTP.CPY".
       COPY "LIBLP/LP01ES.CPY".
       COPY "LIBLP/LP01ES_SQL.CPY".
       COPY "LIBLP/LPWSES.CPY".
       COPY "LIBLP/LP01SP.CPY".
       COPY "LIBLP/LP01SPA.CPY".
       COPY "LIBLP/LP01SPB.CPY".
       COPY "LIBLP/LP01SPC.CPY".
       COPY "LIBLP/LP01SP_SQL.CPY".
       COPY "LIBLP/LPWSSP.CPY".
       COPY "LIBLP/LP01CA.CPY".
       COPY "LIBLP/LP01CA_SQL.CPY".
       COPY "LIBLP/LPWSCA.CPY".
       COPY "LIBLP/LP01CD.CPY".
       COPY "LIBLP/LP01CD_SQL.CPY".
       COPY "LIBLP/LPWSCD.CPY".
       01  WK-IFN               PIC X(2)     VALUE "WK".

       01  WK-KEY               PIC 9(2)     VALUE 0.

       01  HOLD-PERIODS-PAIDTHRU     PIC S9(2) VALUE 0.
       01  HOLD-PERIODS-TODAY        PIC S9(2) VALUE 0.
       01  HOLD-PERIODS-PAID-AHEAD   PIC S9(2) VALUE 0.

       01  GLNO                 PIC 9(11)     VALUE 0.
       01  FILLER              REDEFINES GLNO.
           03  GLNO-BR          PIC 9(4).
           03  GLNO-NUMBER      PIC 9(7).
       01  DISP-REV-BAL         PIC X                VALUE "Y".
       01  LC-AND-INT-FG        PIC X                VALUE " ".
       01  F4-FLAG              PIC 9                VALUE 0.
       01  BATCH-PL-DEFER-FG    PIC X                VALUE " ".
       01  ELE                  PIC 99               VALUE 0.
       01  TOTEARN              PIC S9(7)V99  COMP-3  VALUE 0.
       01  UNEARNED             PIC S9(7)V99  COMP-3  VALUE 0.
       01  LN-WK                PIC 9(6)      COMP-3  VALUE 0.
       01  RTN-FG               PIC X.
       01  ORIG-TOTPAYMNTD      PIC 9(7)V99   COMP-3.
       01  ORIG-TOTEXCPAYMNTD   PIC 9(7)V99   COMP-3.
       01  ORIG-TOTLCHG         PIC 9(7)V99   COMP-3.
       01  ORIG-TOTINT          PIC 9(7)V99   COMP-3.
       01  SAVE-DF-TRAMT        PIC S9(7)V99  COMP   VALUE 0.
       01  SAVE-LP-TRAMT        PIC S9(7)V99  COMP   VALUE 0.
       01  SAVE-LP-APLC         PIC S9(7)V99  COMP   VALUE 0.
       01  SAVE-LCAP-APP-OWE    PIC S9(7)V99  COMP   VALUE 0.
       01  PRIN-WORKER          PIC S9(5)V99  COMP   VALUE 0.
       01  NETDUE-PRIN          PIC S9(6)V99  COMP   VALUE 0.
       01  GL-WORK              PIC S9(7)V99  COMP   VALUE 0.
       01  SV-PASSWORD-DRAWER   PIC X                VALUE "N".

       01  SAVE-HOLD-LXM-MIP-CLPAID  PIC S9(7)V99 COMP.
       01  SAVE-HOLD-LXM-MIP-AHPAID  PIC S9(7)V99 COMP.
       01  MIP-WORKER                PIC S9(7)V99 COMP   VALUE 0.
       01  CHARGE-MIP-CLPREM-FG      PIC X.
       01  CHARGE-MIP-AHPREM-FG      PIC X.
       01  MIP-CL-MESS.
           03  FILLER                PIC X(4)  VALUE " (CL".
           03  MIP-CL                PIC ZZZZZZ9.99.
           03  FILLER                PIC X     VALUE ")".
       01  MIP-AH-MESS.
           03  FILLER                PIC X(4)  VALUE " (AH".
           03  MIP-AH                PIC ZZZZZZ9.99.
           03  FILLER                PIC X     VALUE ")".
       01  MIP-COLLECTED             PIC X(29) VALUE
           " MIP INSURANCE WAS COLLECTED!".

      * WORKERS FOR OVERRIDE OF COLLECTED OTHER CHARGES AND
      * INTEREST AND/OR LATE CHARGES
       01  LP-TRAMT-HOLD-FOR-MIP   PIC S9(6)V99  COMP   VALUE 0.

      * WORKERS FOR RECALCULATION OF LATE CHARGE OF F4-BACK:
       01  HOLD-LP-TRAMT       PIC S9(6)V99  COMP   VALUE 0.
       01  HOLD-SP-LCRATE      PIC 9(4)V9(4) COMP.
       01  HOLD-SP-LCMINCHG    PIC 99V99     COMP.
       01  HOLD-SP-LCMAXAMT    PIC 9(4)V99   COMP.
       01  HOLD-LN-LC-CODE     PIC 99        COMP.

       01  ORIG-LP-TRAMT       PIC S9(6)V99  COMP   VALUE 0.
       01  SV-WORKER           PIC S9(7)V99  COMP.
       01  SV-RATE             PIC 9V999999  COMP.
       01  HOLD-DF-EARNED      PIC S9(5)V99  COMP   VALUE 0.
       01  WORK1               PIC S9(7)V99  COMP   VALUE 0.
       01  WORK2               PIC S9(7)V99  COMP   VALUE 0.
       01  MSEL-LIST           PIC X(5)             VALUE "MSEL.".

       01  INPUT-DEFER-MSG.
           03  FILLER          PIC X(23) VALUE "ENTER DEFERMENT CHARGE".
           03  FILLER          PIC X(6)  VALUE "( MIN:".
           03  INPUT-DEFER-MIN PIC 99.99.
           03  FILLER          PIC X(5)  VALUE " MAX:".
           03  INPUT-DEFER-MAX PIC 9999.99.
           03  FILLER          PIC X(1)  VALUE ")".


       01  TRCD-WORKER.
           03  FILLER          PIC X.
           03  TRCD-NODF       PIC 9.

       01  DF-TEST             PIC X         VALUE " ".
           88 DF-POSTING                     VALUE "Y".

       01  SUB                 PIC 9(6) COMP VALUE 0.
       01  PUR-BAL-EXCEEDED.
           03  FILLER          PIC X(20)     VALUE
           "THE PURCHASE BAL IS".
           03  PURBAL-EXCEEDED PIC ZZZZ9.99-.
       01  REQ-DEF-CHARGE.
           03  FILLER          PIC X(34)     VALUE
           " THE REQUIRED DEFERMENT CHARGE IS ".
           03  REQ-DEF-CHG     PIC ZZZZ9.99-.

       01  DLR-TEST.
           03  FILLER          PIC X(5).
           03  DLR-ANSWER      PIC X.

      * WORKERS FOR APPLICATION OF ESCROW:

       01  NUM-FULL-REG-PMTS            PIC 9(3) VALUE 0.
       01  PARTIAL-REGPAY-AMT          PIC S9(7)V99 VALUE 0.
       01  REGPAY-PAYMENTS             PIC 99999V9(12).
       01  FILLER                      REDEFINES REGPAY-PAYMENTS.
           03  REGPAY-PAYS             PIC 99999.
           03  REGPAY-REMAIN           PIC V9(12).
       01  TOT-REGPAY-APPLY            PIC S9(7)V99 VALUE 0.

       01  NUM-FULL-ESCROW-PMTS         PIC 9(3) VALUE 0.
       01  PARTIAL-ESCROW-AMT          PIC S9(7)V99 VALUE 0.
       01  ESCROW-PAYMENTS             PIC 99999V9(12).
       01  FILLER                      REDEFINES ESCROW-PAYMENTS.
           03  ESCROW-PAYS             PIC 99999.
           03  ESCROW-REMAIN           PIC V9(12).
       01  MONTHLY-ESCROW              PIC S9(7)V99 VALUE 0.
       01  THIS-YR-ESCROW-BAL          PIC S9(7)V99 VALUE 0.
       01  TRAMT-WORKER                PIC S9(6)V99  COMP   VALUE 0.
       01  MAX-ESCROW-ALLOWED          PIC S9(6)V99  COMP   VALUE 0.

       01  ESCROW-YR                   PIC 9(2) VALUE 0.
       01  ESCROW-YR1                  PIC 9(2) VALUE 0.
       01  ESCROW-YR2                  PIC 9(2) VALUE 0.
       01  PAYMNTD-WORK                PIC S9(7)V99 VALUE 0.
       01  ESCROW-AMT                  PIC S9(6)V99 VALUE 0.
       01  DEFAULT-ESCROW-AMT          PIC S9(6)V99 VALUE 0.
       01  ESCROW-OUTSTANDING          PIC S9(7)V99 VALUE 0.
       01  ESCROW-COLLECTED            PIC S9(7)V99 VALUE 0.
       01  ESCROW-SCHEDULED            PIC S9(7)V99 VALUE 0.
       01  ESCROW-BALANCE1             PIC S9(7)V99 VALUE 0.
       01  ESCROW-APPLIED2             PIC S9(7)V99 VALUE 0.
       01  ESCROW-BALANCE2             PIC S9(7)V99 VALUE 0.
       01  MISSING-ESCROW-FG           PIC X        VALUE "N".
       01  ESCROW-SKIP-TABLE.
           03  ESCROW-SKIP-YR          PIC X OCCURS 40.
       01  ESCROW-WINDOW-LIST.
           03  FILLER                  PIC X(43) VALUE
           "YEAR1 ESCROW1 COLLECTED1 APPLIED1 BALANCE1 ".
           03  FILLER                  PIC X(43) VALUE
           "YEAR2 ESCROW2 COLLECTED2 APPLIED2 BALANCE2 ".
           03  FILLER                  PIC X(24) VALUE
           "PAYMENT APPLIED BALANCE.".
       01  ESCROW-WINDOW-BUF.
           03  ESCROW-LINE OCCURS 2.
               05  D-YR                PIC Z9.
               05  D-ESCROW            PIC ZZZ,ZZZ.99-.
               05  D-COLLECTED         PIC ZZZ,ZZZ.99-.
               05  D-APPLIED           PIC ZZZ,ZZZ.99-.
               05  D-BALANCE           PIC ZZZ,ZZZ.99-.
           03  D-PAYMENT-AMT           PIC ZZZ,ZZZ.99-.
           03  D-TOT-APPLIED           PIC ZZZ,ZZZ.99-.
           03  D-TOT-BALANCE           PIC ZZZ,ZZZ.99-.
       01  ESCROW-DISPLAY.
           03  FILLER                  PIC X(13) VALUE
           "APP TO ESCROW".
           03  D-APPLIED-TO-ESCROW     PIC ZZZ,ZZZ.99-.

      **************************************************
      *         ORDER LINE BUFFER                      *
      **************************************************
       01  LN-BUF              VALUE SPACES.
           03  L-010           PIC 9(6).
           03  FILLER          PIC X.
           03  L-020           PIC XX.
           03  FILLER          PIC X.
           03  L-030           PIC X(5).
           03  L-040           PIC Z(5).99- BLANK ZERO.
           03  L-040RATE       REDEFINES L-040
                               PIC ZZZZ.999-.
           03  L-050           PIC Z(4).99- BLANK ZERO.
           03  L-060           PIC Z(4).99- BLANK ZERO.
           03  L-070           PIC Z(5).99- BLANK ZERO.
           03  L-080           PIC 9(4)     BLANK ZERO.
           03  L-090           PIC Z(5).99- BLANK ZERO.
           03  L-100           PIC Z(4).99- BLANK ZERO.
           03  L-110           PIC Z(5)9.99-.
           03  FILLER         REDEFINES L-110.
               05  FILLER      PIC X(9).
               05  L-120       PIC X.

       01  EARN-BUF            REDEFINES LN-BUF.
           03  D-INTYTD        PIC ZZZZ9.99-.
           03  D-TOTEARN       PIC ZZZZ9.99-.
           03 D-LCPDTH-MO      PIC 99.
           03 D-LCPDTH-DAYR    PIC 99.
           03  D-DEFMNTS       PIC 99.
           03  D-EARNED        PIC ZZZZ9.99-.
           03  D-DLPROC        PIC ZZZZ9.99-.

      *  CANNOT REDEFINE - SEE SETUP-LINE ROUTINE
       01  ENTRY-BUF           VALUE " ".
           03  EB-010          PIC 9(6).
           03  EB-020          PIC XX.
           03  EB-030          PIC X(5).
           03  EB-040          PIC Z(5).99- BLANK ZERO.
           03  EB-040RATE      REDEFINES EB-040
                               PIC ZZZZ.999-.
           03  EB-050          PIC Z(4).99- BLANK ZERO.
           03  EB-060          PIC Z(4).99- BLANK ZERO.
           03  EB-070          PIC Z(5).99- BLANK ZERO.
           03  EB-080          PIC 9(4)     BLANK ZERO.
           03  FILLER  REDEFINES EB-080.
               05 EB-080-MO    PIC 99.
               05 EB-080-DAYR  PIC 99.
           03  EB-090          PIC Z(5).99- BLANK ZERO.
           03  EB-100          PIC Z(4).99- BLANK ZERO.
           03  EB-110          PIC Z(5)9.99-.
           03  FILLER         REDEFINES EB-110.
               05  FILLER      PIC X(9).
               05  EB-120      PIC X.

       01  LINE-BUF            VALUE SPACES.
           03  D-LINE          OCCURS 8 TIMES
                               PIC X(80).
       01  LINE-LIST.
           03  FILLER          PIC X(4) VALUE
           "LN1 ".
           03  FILLER          PIC X(48) VALUE
           "GL8 F21 GD8 F22 GA8 F23 GL9 F31 GD9 F32 GA9 F33 ".
           03  FILLER          PIC X(56) VALUE
           "GL0 F41 GD0 F42 GA0 F43 GL1 F51 GD1 F52 GA1 F53 GL2 F61 ".
           03  FILLER          PIC X(40)    VALUE
           "GD2 F62 GA2 F63 GL3 F71 GD3 F72 GA3 F73 ".
           03  FILLER          PIC X(24)    VALUE
           "GL4 F81 GD4 F82 GA4 F83.".

       01  ENTRY-LINE          PIC X(48)    VALUE
           "010 020 030 040 050 060 070 080 090 100 110 120.".

       01  GL-LIST.
           03  FILLER          PIC X(36) VALUE
           "GL1 GL2 GL3 GD1 GD2 GD3 GA1 GA2 GA3.".

       01  EARN-LIST.
           03  FILLER          PIC X(29) VALUE
           "H09 H10 H17 H18 H21 PROCEEDS.".

       01  TEST-USER-PROFILE           PIC X.

       COPY "LIBWI/PFSWINDOWSW.CPY".

       COPY "LIBLP/LP01NO.CPY".
       COPY "LIBGB/CAPASSWDW.CPY".
       COPY "LIBLP/PAYOFXW.CPY".
       COPY "LIBWI/CDSCANW.CPY".
       COPY "LIBLP/LPITRMW.CPY".
       COPY "LIBLP/LPWKPATH.CPY".
       COPY "LIBWI/MEMOSCW.CPY".
       COPY "LIBLP/LPIBPCW.CPY".
       COPY "LIBLP/LPRATEW.CPY".
       COPY "LIBLP/LPXDTEW.CPY".
       COPY "LIBLP/LPLCASW.CPY".
       COPY "LIBGB/SPPDTHW.CPY".
       COPY "LIBLP/LPLCHGW.CPY".
       COPY "LIBLP/LPLCAPW.CPY".
       COPY "LIBLP/LPMDTEW.CPY".
       COPY "LIBLP/LPBWINW.CPY".
       COPY "LIBGB/DATERW.CPY".
       COPY "LIBGB/TIMEWK.CPY".
       COPY "LIBGL/ALLENTW.CPY".
       COPY "LIBLP/LPSCHDW.CPY".
       COPY "LIBLP/LPCERNW.CPY".
       COPY "LIBLP/LPCDELW.CPY".
       COPY "LIBLP/LPCEPPW.CPY".
       COPY "LIBLP/LPEADJW.CPY".
       COPY "LIBLP/LPUERNW.CPY".
       COPY "LIBGB/REBATEW.CPY".
       COPY "LIBGB/RBACTW.CPY".
       COPY "LIBLP/LPDEFW.CPY".
       01  DEF-NODEFACT         PIC S99 COMP-3.
       COPY "LIBLP/LPAMTSW.CPY".
       COPY "LIBLP/LPMENUW.CPY".
       COPY "LIBLP/LPAPRSW.CPY".
       COPY "LIBLP/LPAPRZW.CPY".
       COPY "LIBLP/LPUPERW.CPY".
       COPY "LIBLP/LPUPWKW.CPY".
       COPY "LIBGB/PASSWDW.CPY".
       78  OVERDEF-SEQ           VALUE 0.
       78  REPO-EXP-SEQ          VALUE 1.
       78  SS-ZERO-SEQ           VALUE 2.
       78  SS-PASSWD-TO-COLL-OT  VALUE 3.
       78  UP-ARROW-SEQ          VALUE 4.
       78  OVERRIDE-ESCROW-SEQ   VALUE 5.
       78  MISSING-ESCROW-SEQ    VALUE 6.


       COPY "LIBGB/CONNECTW_SQL.CPY".
       COPY "LIBGB/FILEWK.CPY".
       COPY "LIBGB/MESSWK.CPY".
       COPY "LIBCL/CRNOR2W.CPY".
       COPY "LIBLP/LPPOFFW.CPY".
       COPY "LIBGB/GPENVW.CPY".
       COPY "LIBCL/CLMENUW_EXT.CPY".
       COPY "LIBGB/SYSTEMW.CPY".
       COPY "LIBGB/GETENVW.CPY".
       COPY "LIBLP/AFPDLLPW.CPY".
       COPY "LIBLP/LPREGZW.CPY".
       COPY "LIBLP/SETCTBLW.CPY".
       COPY "LIBLP/LFPAPW.CPY".
       COPY "LIBWI/REALPYW.CPY".

       COPY "LIBGB/CONAME_EXT.CPY".
       COPY "LIBGB/SCREENW.CPY".
       COPY "LIBLP/LONPF_DEF.CPY".
       COPY "LIBLP/LPSMNU_DEF.CPY".
       COPY "LIBLP/LPLNMU_DEF.CPY".
       COPY "LIBLP/LPCAMU_DEF.CPY".
       COPY "LIBLP/LPVDMU_DEF.CPY".
       COPY "LIBWI/AUCTIN_DEF.CPY".
       COPY "LIBWI/ESAPPL_DEF.CPY".
       COPY "LIBLP/LONPF_WKS.CPY".
       COPY "LIBLP/LPSMNU_WKS.CPY".
       COPY "LIBLP/LPLNMU_WKS.CPY".
       COPY "LIBLP/LPCAMU_WKS.CPY".
       COPY "LIBLP/LPVDMU_WKS.CPY".
       COPY "LIBWI/AUCTIN_WKS.CPY".
       COPY "LIBWI/ESAPPL_WKS.CPY".
       COPY "LIBGB/HELPLINK.CPY".

      **************************************************
      *   C O N T R O L   M O D U L E                  *
      **************************************************
       COPY "LIBGB/GETFMW.CPY".
       COPY "LIBLP/LPLOANW.CPY".
       COPY "LIBLP/LPPFBUF.CPY".

       SCREEN SECTION.
       COPY "LIBLP/LONPF_SCN.CPY".
       COPY "LIBLP/LPSMNU_SCN.CPY".
       COPY "LIBLP/LPLNMU_SCN.CPY".
       COPY "LIBLP/LPCAMU_SCN.CPY".
       COPY "LIBLP/LPVDMU_SCN.CPY".
       COPY "LIBWI/AUCTIN_SCN.CPY".
       COPY "LIBWI/ESAPPL_SCN.CPY".

       PROCEDURE DIVISION
             USING FORM-PATHNAME EXIT-PATHNAME PROG-BUF UPDATE-BUF.
       DECLARATIVES.
       DECLARE-ERROR SECTION.
           USE AFTER ERROR PROCEDURE ON
              WK-FILE.
       COPY "LIBGB/DECLARE.CPY".
           PERFORM CLOSE-SP1-FILE.
           PERFORM CLOSE-LTP1-FILE.
           PERFORM CLOSE-LTI1-FILE.
           PERFORM CLOSE-LP1-FILE.
           PERFORM CLOSE-ES1-FILE.
           PERFORM CLOSE-DS1-FILE.
           PERFORM CLOSE-DL1-FILE.
           PERFORM CLOSE-CD1-FILE.
           PERFORM CLOSE-CA1-FILE.
           PERFORM CLOSE-BR-FILE.
           PERFORM CLOSE-GB-FILE.
           CLOSE WK-FILE.
       COPY "LIBGB/DECLAR2.CPY".

      **************************************************
      *      P R O G R A M   C O N T R O L             *
      **************************************************
       MAIN-PROGRAM SECTION.

           PERFORM SQL-CONNECT.

           MOVE FORM-PATHNAME TO FORM-PATH.
           MOVE "LONPF" TO VDU-FORM-NAME.
      D    STOP MESS.

           MOVE USER-PID TO TEMP-PID.

           IF INTERRUPT-FG = "Y"
              MOVE " " TO VDU-WIMENU-SELECTION
           ELSE
              MOVE "C" TO VDU-WIMENU-SELECTION.
           MOVE "F" TO VDU-CLMENU-SELECTION.

           MOVE SPACES TO ERRCD.

           PERFORM RESTORE-SCREEN.

           MOVE 0  TO HOLD-PERIODS-PAIDTHRU
                      HOLD-PERIODS-TODAY        
                      HOLD-PERIODS-PAID-AHEAD.  

           MOVE 0 TO F4-FLAG.

           PERFORM GET-GPENV.

           MOVE LN-TOTPAYMNTD    TO ORIG-TOTPAYMNTD.
           MOVE LN-TOTEXCPAYMNTD TO ORIG-TOTEXCPAYMNTD.
           MOVE LN-TOTLCHG       TO ORIG-TOTLCHG.
           MOVE LN-TOTINT        TO ORIG-TOTINT.

           PERFORM OPEN-SP1-FILE.
           MOVE HOLD-SP1-KEY TO SP1-KEY.
           PERFORM READ-SP1-FILE.
           PERFORM CLOSE-SP1-FILE.
           IF IO-FG NOT = 0
              MOVE "INVALID STATE PARAMETER RECORD" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

      * ALLOW CNTRL 'N' INTERRUPT:
           MOVE "WI/MAKERS" TO VDU-CTRL-N-PROG.

           MOVE LN-OWNBR TO BR-NO.
           PERFORM OPEN-BR-FILE.
           PERFORM READ-BR-FILE.
           PERFORM CLOSE-BR-FILE.
           IF IO-FG NOT = 0
              MOVE "INVALID BRANCH RECORD" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

      * NEED FOR LCAS ROUTINES (REPLACES GLOBRD)
           PERFORM OPEN-GB-FILE.
           MOVE GB-PATH-OWNBR TO GB-BRNO.
           MOVE 1             TO GB-NO.
           PERFORM READ-GB-FILE.
           PERFORM CLOSE-GB-FILE.
           IF IO-BAD
              MOVE "INVALID GLOBAL RECORD" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

           MOVE 0 TO INDU-INTEREST LCAP-APP LCAP-OWE.
           MOVE LN-LCPDTH-DATE TO LCAP-LCPDTH-DATE.

           IF LP-TRCD = "DF" OR "D2" OR "D3" OR "D4" OR "D5"
                             OR "D6" OR "D7" OR "D8" OR "D9"
              MOVE "Y" TO DF-TEST
           ELSE
              MOVE " " TO DF-TEST.

      *  -------------------------------------------------------------
      *  TEST ENVIRONMENT VARIABLE "RVLINES" TO DETERMINE WHETHER
      *  OR NOT TO DISPLAY BALANCES ON REVERSALS.
      *  -------------------------------------------------------------
           MOVE "RVLINES" TO GETENV-BUF.
           PERFORM GETENV-CALL.
           IF STAT = "00"
              MOVE "N" TO DISP-REV-BAL
           ELSE
              MOVE "Y" TO DISP-REV-BAL.

      * TEST FOR BATCH PAYMENT:
           MOVE " " TO BATCH-PL-DEFER-FG.
           IF HOLD-BP-TRCD NOT = " "
              PERFORM BATCH-PAYMENT-ROUTINE
           ELSE
              PERFORM SELECTION-MODULE.

      *11/07/14 ON F1 CANCEL, STILL DISPLAYED 'APPLIED TO ESCROW AND AMOUNT'
      *         RESET BACK TO _____APPLIED
           IF EXT-ROUTE-BUF = "00"
              MOVE "APPLIED-PRMT." TO WR-LIST
              MOVE " _______APPLIED_________" TO WR-BUF
              CALL "C$TOLOWER" USING WR-BUF,VALUE 25
              PERFORM CALL-WRFORM.
 
           GO TO END-ROUTINE.

      *******************************************
       BATCH-PAYMENT-ROUTINE SECTION.
      *******************************************
           PERFORM OPEN-CD1-FILE.
           MOVE "BR"        TO CD-TYPE.
           MOVE LP-REFNO    TO CD-CODE.
           PERFORM READ-CD1-FILE.
           IF IO-BAD
              MOVE "Y" TO CD-BR-COLLECT-LC.
           PERFORM CLOSE-CD1-FILE.

           PERFORM SET-BAL-IBPC-LPREC.
           IF NOT ( LP-IBPC = "P" AND IBPC-EXPIRED-FLAG = " ")
              MOVE LP-TRCD    TO RATE-LPTRCD
              MOVE LP-PAYDATE TO RATE-DATE IBPC-DATE
              MOVE MAKER-CD   TO RATE-MAKERCD
              PERFORM SET-PY-RATE.

           MOVE LP-TRAMT TO HOLD-LP-TRAMT.

           IF NOT DF-POSTING
              GO TO SKIP-DEF.

           MOVE LP-TRCD TO TRCD-WORKER.
           IF TRCD-WORKER = "DF"
              MOVE 1 TO DEF-NODEF DEF-NODEFACT
           ELSE
              MOVE 1         TO DEF-NODEFACT
              MOVE TRCD-NODF TO DEF-NODEF.

           MOVE HOLD-LN-JDRATE TO DEF-WKRATE.
           MOVE LP-PAYDATE     TO DEF-PAYDATE.
           ADD LP-INTBAL INDU-INTEREST GIVING DEF-TOTAL-INTDUE.
           PERFORM DEF-COMPUTE-DEFERMENT.

           IF SP-DEFFRMLA = 95 OR 96 OR 97
              IF LP-TRAMT NOT = DEF-AMOUNT
                 MOVE "X" TO ERRCD
                 GO TO BATCH-PAYMENT-ROUTINE-EXIT.

           IF LP-TRAMT > DEF-AMOUNT
              MOVE "X" TO ERRCD
              GO TO BATCH-PAYMENT-ROUTINE-EXIT.

       SETUP-DEFERMENT.
           IF SP-DEFFRMLA = 99
               IF LP-TRAMT = 0
                  MOVE DEF-AMOUNT TO INDU-INTEREST
                                     SAVE-DF-TRAMT
                  COMPUTE LP-INTBAL = LP-INTBAL + INDU-INTEREST
                  MOVE 0 TO LP-APCUR
               ELSE
                  IF LP-TRAMT < DEF-TOTAL-INTDUE
                     ADD LP-TRAMT TO LP-APINT
                     COMPUTE LP-INTBAL = LP-INTBAL + INDU-INTEREST
                                       - HOLD-LP-TRAMT
                     MOVE 0 TO LP-APCUR
                  ELSE
                     MOVE DEF-AMOUNT TO INDU-INTEREST SAVE-DF-TRAMT
                                                      LP-APINT
                     COMPUTE LP-INTBAL =
                           LP-INTBAL + INDU-INTEREST - HOLD-LP-TRAMT
                     MOVE 0 TO LP-APCUR
           ELSE
              IF SP-DEFFRMLA = 95 OR 96
                 IF DEF-TOTAL-INTDUE > DEF-AMOUNT
                    MOVE DEF-AMOUNT TO LP-APINT SAVE-DF-TRAMT
                    SUBTRACT DEF-AMOUNT FROM DEF-TOTAL-INTDUE
                                             GIVING LP-INTBAL
                    MOVE 0 TO LP-APCUR
                 ELSE
                    MOVE DEF-AMOUNT TO SAVE-DF-TRAMT
                    MOVE DEF-TOTAL-INTDUE  TO LP-APINT
                    MOVE 0 TO LP-INTBAL
                    SUBTRACT LP-APINT FROM LP-TRAMT GIVING
                                                  LP-APCUR
             ELSE
               IF SP-DEFFRMLA = 97
                  ADD INDU-INTEREST LP-INTBAL GIVING LP-APINT
                  MOVE DEF-AMOUNT    TO SAVE-DF-TRAMT
                  IF DEF-AMOUNT > LP-APINT
                     SUBTRACT LP-APINT FROM DEF-AMOUNT GIVING
                                                     LP-APCUR
                  ELSE
                     MOVE DEF-AMOUNT TO INDU-INTEREST
                                             LP-APINT
                     MOVE 0 TO LP-APCUR
              ELSE
                 IF LP-TRAMT = 0
                    MOVE DEF-AMOUNT TO INDU-INTEREST
                                       SAVE-DF-TRAMT
                   COMPUTE LP-INTBAL = LP-INTBAL + INDU-INTEREST
                 ELSE
                    MOVE DEF-AMOUNT TO INDU-INTEREST
                                       SAVE-DF-TRAMT
                    IF LP-TRAMT < INDU-INTEREST
                       ADD LP-TRAMT TO LP-APINT
                       COMPUTE LP-INTBAL =
                           LP-INTBAL + INDU-INTEREST - HOLD-LP-TRAMT
                    ELSE
                       MOVE DEF-AMOUNT TO INDU-INTEREST
                                   LP-APINT SAVE-DF-TRAMT.

      * SP-DEFFRMLA = 7, WILL STORE DEFERED PAYMENT DUE DATE
      *                  INTO LP-DEF-DUEDATE
      *                  AND THE DEFERRED PERIOD
      *                  INTO LP-DEF-TERM

           MOVE DEF-DUEDATE TO LP-DEF-DUEDATE.
           MOVE DEF-DUETERM TO LP-DEF-TERM.

           IF SP-DEFFRMLA = 95 OR 96 OR 97
              MOVE 0 TO LP-APLC.

       SKIP-DEF.

           IF DF-POSTING
              GO TO BATCH-PAYMENT-ROUTINE-CONT.

      * ADDED NEW OPTION (BR-BP-PL OR BR-LBOX-PL = 'P') FOR
      * CHARGE OFFS TO APPLY ALL MONIES TO PRINCIPAL
      * DEFERRING LATE CHARGES, INTEREST AND OTHER TO OWING

           IF (LN-PLDATE NOT = 0) AND
              (BR-BP-PL = "P" OR BR-LBOX-PL = "P")
              MOVE "Y" TO BATCH-PL-DEFER-FG.

      * WHEN BR-BP-ALLOW-PMT-ACCT-OTHBAL IS 'Y'
      * THAN BATCH PAYMENTS WERE ALLOWED TO ACCOUNTS
      * WITH LN-OTHBAL BUT NOT APPLYING MONIES TO LN-OTHBAL
           IF ( BR-BP-ALLOW-PMT-ACCT-OTHBAL = "Y" ) OR
              ( BATCH-PL-DEFER-FG = "Y"           )
              NEXT SENTENCE
           ELSE
              IF LP-OTHBAL NOT = 0
                 IF LP-OTHBAL NOT > HOLD-LP-TRAMT
                    MOVE LP-OTHBAL TO LP-APOTH
                    SUBTRACT LP-OTHBAL FROM HOLD-LP-TRAMT
                    MOVE 0 TO LP-OTHBAL
                 ELSE
                    MOVE HOLD-LP-TRAMT TO LP-APOTH
                    SUBTRACT HOLD-LP-TRAMT FROM LP-OTHBAL
                    MOVE 0 TO LP-APINT LP-APCUR LP-APLC HOLD-LP-TRAMT
                 END-IF
                 IF LP-APOTH NOT = 0
                    PERFORM OPEN-CD1-FILE
                    MOVE "BR"        TO CD-TYPE
                    MOVE LP-REFNO    TO CD-CODE
                    PERFORM READ-CD1-FILE
                    PERFORM CLOSE-CD1-FILE
                    IF IO-GOOD
                       IF (CD-BR-FILE-TYPE NOT = "LC" AND
                                            NOT = "C")
                          IF CD-BR-OT-GL-BRANCH = 0
                            MOVE LN-OWNBR           TO GLNO-BR
                         ELSE
                            MOVE CD-BR-OT-GL-BRANCH TO GLNO-BR
                         END-IF
                         MOVE CD-BR-OT-GL-ACCT   TO GLNO-NUMBER
                         MOVE GLNO               TO LXG-GLNO(1)
                         MOVE LP-APOTH           TO LXG-GLAMT(1).

           IF HOLD-BP-TRCD = "SS"
              IF GP-DONT-COLL-INT-ON-SS = "Y"
                 MOVE "Y" TO BATCH-PL-DEFER-FG
                 GO TO BATCH-PAYMENT-SKIP-INT-LC.

           IF HOLD-BP-TRCD NOT = "Z2"
              IF LP-LCBAL NOT = 0
                 IF BATCH-PL-DEFER-FG NOT = "Y"
                    IF CD-BR-COLLECT-LC NOT = "N"
                       PERFORM DISBURSE-LCBAL
                       IF RTN-FG = "E"
                          GO TO BATCH-PAYMENT-ROUTINE-CONT.

           IF HOLD-BP-TRCD NOT = "Z2"
              IF LP-INTBAL NOT = 0
                IF BATCH-PL-DEFER-FG NOT = "Y"
                 PERFORM DISBURSE-INTBAL
                 IF RTN-FG = "E"
                    GO TO BATCH-PAYMENT-ROUTINE-CONT.


       BATCH-PAYMENT-SKIP-INT-LC.
      * DON'T ALLOW LCHG IF PC GONE TO IB:
           IF HOLD-BP-TRCD NOT = "PX"
      * ONLY TAKE LATE CHARGES WHEN THE ACCOUNT IS NOT ACCELERATED
      * AND IT IS IN A PRECOMP STATUS OR IS LOAN CLASS TYPE IB
              IF (LN-ACCELDATE = 0) AND
                 (IBPC-FG = "P" OR LN-LOANTYPE = "I")
                    PERFORM SETUP-LCHGS
                 END-IF
                 IF BATCH-PL-DEFER-FG = "Y"
                    ADD LCAP-APP TO HOLD-LP-TRAMT
                    ADD LCAP-APP TO LP-LCBAL
                    MOVE 0       TO LCAP-APP
                 END-IF.

           IF HOLD-BP-TRCD NOT = "PX"
              IF INDU-INTEREST NOT = 0
                 IF HOLD-BP-TRCD NOT = "Z2"
                    PERFORM SETUP-INTEREST
                    IF BATCH-PL-DEFER-FG = "Y"
                       ADD LP-APINT TO HOLD-LP-TRAMT
                       ADD LP-APINT TO LP-INTBAL
                       MOVE 0       TO LP-APINT
                    END-IF
                 ELSE
                    COMPUTE LP-INTBAL = LP-INTBAL + INDU-INTEREST.

           IF HOLD-BP-TRCD NOT = "PX"
              COMPUTE LP-APCUR = LP-TRAMT - LP-APINT
                               - LP-APOTH - LP-APLC.

           IF HOLD-BP-TRCD = "Z2"
              SUBTRACT LP-APOT2 FROM LP-OT2BAL.

       BATCH-PAYMENT-ROUTINE-CONT.
           IF DF-POSTING
              ADD DEF-NODEF TO LN-TOTNODEF
              ADD DEF-NODEFACT TO LN-TOTNODEFACT.

           PERFORM SETUP-PRIN-PAYMNTD.

           PERFORM SETUP-PDTH-LPREC.

      * DETERMINE CONTRACTUAL ELAPSED PERIODS THRU TODAY:
      * AND COMPARE TO PDTH-PAYS WHICH IS STORED IN
      * HOLD-PERIODS-PAIDTHRU IN SETUP-PDTH-LPREC.
      * ALABAMA PREPAYMENT WORLD PR#1140
           IF SP-ALT-PREPAY-MONTHS NOT NUMERIC
              GO TO SKIP-ALT-PREPAY-TEST.
          
           IF SP-ALT-PREPAY-MONTHS = ZEROS
              GO TO SKIP-ALT-PREPAY-TEST.
            
           IF LN-LPO = "ALT"
              GO TO SKIP-ALT-PREPAY-TEST.
 
           MOVE LN-1STPYDATE TO CEPP1-DATE.
           MOVE LP-PAYDATE   TO CEPP2-DATE.
           PERFORM CONTRACTUAL-ELAPSED-PAYPER.
           MOVE CEPP-PERIODS TO HOLD-PERIODS-TODAY.

      *TEST THE DIFFERENCE
           SUBTRACT HOLD-PERIODS-TODAY FROM HOLD-PERIODS-PAIDTHRU
                                GIVING HOLD-PERIODS-PAID-AHEAD.
     
           IF HOLD-PERIODS-PAID-AHEAD NOT < 
                                SP-ALT-PREPAY-MONTHS
              IF LN-INT-REBATE NOT = "Y"
                 MOVE "P" TO ERRCD
                 GO TO BATCH-PAYMENT-ROUTINE-EXIT 
              ELSE
                 MOVE "Y"   TO HOLD-ALT-PREPAY-FG.

       SKIP-ALT-PREPAY-TEST.

           IF DF-POSTING
              PERFORM INCR-LCPDTH.

           IF LN-SERVACCT NOT = "Y"
              ADD LP-APINT LP-APLC TO HOLD-LN-TOTERN.

           ADD LP-APLC  TO HOLD-LN-TOTLCHG.

           IF DF-POSTING AND
                    (SP-DEFFRMLA NOT = 97 AND SP-DEFFRMLA NOT = 96
                        AND SP-DEFFRMLA NOT = 95)
              ADD LP-APINT TO HOLD-LN-TOTDFMNTS
           ELSE
              ADD LP-APINT TO HOLD-LN-TOTINT.

           IF NOT DF-POSTING
              PERFORM SETUP-CERN-LPREC.

           PERFORM SETUP-INTPAID-LPREC.

           IF LN-SERVACCT = "Y"
              PERFORM SETUP-DLPROC-LPREC.

           IF LN-SERVACCT = "N"
              PERFORM SETUP-AFPDLLP.

       BATCH-PAYMENT-ROUTINE-EXIT.
           PERFORM SETUP-INT-LC-LPREC.
           PERFORM SAVE-SCREEN.

      *********************************************************
       SELECTION-MODULE SECTION.
      *********************************************************
       INITIAL-TRCD.
           PERFORM INITIALIZE-ROUTINE.
           IF ROUTE-CD = "4"
              GO TO AMOUNT-ENTRY.
           IF ROUTE-CD = "7"
              GO TO RET-TO-ENTRY-ROUTINE.


       ENTRY-LINE-CAL.
           PERFORM ENTRY-LINE-CALCULATIONS.
           IF ROUTE-CD = "7"
              GO TO RET-TO-ENTRY-ROUTINE.
           GO TO DISPLAY-ENTRY.

       AMOUNT-ENTRY.
           PERFORM AMOUNT-ENTRY-ROUTINES.
           IF ROUTE-CD = "1"
              GO TO INITIAL-TRCD.
           IF ROUTE-CD = "3"
              GO TO ENTRY-LINE-CAL.
           IF ROUTE-CD = "7"
              GO TO RET-TO-ENTRY-ROUTINE.
           IF ROUTE-CD = "8"
              GO TO RET-TO-REF-ENTRY.

       DISPLAY-ENTRY.
      * BEFORE DOING ANYTHING, CHECK IF DEALER RESERVES ARE OK
           IF LP-TRCD = "PR" OR "PC" OR "PP"
              PERFORM TEST-DLR-RESERVES
              IF ROUTE-CD = "7"
                 GO TO RET-TO-ENTRY-ROUTINE.

           PERFORM DISPLAY-ENTRY-LINE.

      *    IF LN-ESCROW-FG = "Y"
      *       MOVE ORIG-LP-TRAMT TO LP-TRAMT.

           IF ROUTE-CD = "7"
              GO TO RET-TO-ENTRY-ROUTINE.

           IF LP-TRCD = "SS"
              IF GP-REPO-CODE = "A"
                 PERFORM AUCTION-EXPENSE-WINDOW
                 IF ROUTE-CD = "7"
                    GO TO RET-TO-ENTRY-ROUTINE.


      * RELIANCE: IF POSTING AN "SS" THEN BRING UP REPO STATUS
      *           WINDOW AUTOMATICALLY.
           IF LP-TRCD = "SS"
              IF GP-AUTO-REPO-WINDOW = "Y"
                 PERFORM CALL-REPO-WINDOW.

           IF LP-TRCD = "PY"
              IF SP-SHORT-PAY-THRESHOLD NUMERIC
                 IF SP-SHORT-PAY-THRESHOLD NOT = 0
                    MOVE LN-ACCTNO     TO CRNOR2-ACCTNO
                    MOVE TRANS-DATE    TO CRNOR2-SYSDATE
                    MOVE "N"           TO CRNOR2-LPREC-FG
                    MOVE "CL/CRNOR2"   TO FORM-NAM
                    CALL FORM-PROGX USING FORM-PATH CRNOR2-LINK NO-REC
                                          POFF-WORKERS LN-REC
                    CANCEL FORM-PROGX
                    IF LP-TRAMT <
                         (NO-TDUEAMT * (SP-SHORT-PAY-THRESHOLD / 100))
                      MOVE "CUSTOMER PAYING BELOW SHORT PAY THRESHOLD"
                                 TO MESS
                     PERFORM CONDITIONAL-SEND-MESS.

           PERFORM ACCEPT-ENTRY-ROUTINE.
           IF ROUTE-CD = "7"
              GO TO RET-TO-ENTRY-ROUTINE.
           IF ROUTE-CD = "4"
              GO TO AMOUNT-ENTRY.

           MOVE LPLOAN-USERID TO TEST-USER-PROFILE.

      * MEMO ENTRY FOR BACKDATED POFFS
           IF (GP-BACKDATE-MEMO = "N" OR " ") OR
                  LP-PAYDATE = LP-TRDATE OR
                    LP-TRCD NOT = "PY"
               GO TO SKIP-BACKDATE-MEMO.

           IF GP-BACKDATE-MEMO = "Y" OR
              TEST-USER-PROFILE > GP-BACKDATE-MEMO
                MOVE LN-OWNBR         TO EXT-WI-CL-OWNBR 
                MOVE LN-ACCTNO        TO EXT-WI-CL-ACCTNO
      *         MOVE LN-APP-NUMBER    TO EXT-WI-CL-APP-NUMBER
                MOVE 1                TO EXT-WI-CL-SSNO-NO
                MOVE LN-SSNO(1)       TO EXT-WI-CL-SSNO(1)
                MOVE "L"              TO MEMOSC-ONLY
      * WANT IT TO WORK EXACTLY LIKE REVERSAL MEMO, FORCES IT !
                MOVE "P"              TO MEMOSC-MEMO-TYPE
                MOVE "WI/MEMOSC" TO FORM-NAM
                CALL FORM-PROGX USING FORM-PATH MEMOSC-BUF EXIT-PATHNAME
                CANCEL FORM-PROGX.

       SKIP-BACKDATE-MEMO.
      * USED HOLD-LN-JDRATE TO HOLD DF-PERCENT...SET BACK TO LN-JDRATE
           IF DF-POSTING
              MOVE LN-JDRATE TO HOLD-LN-JDRATE.

           IF LN-ESCROW-FG = "Y"
              MOVE "SN S052040." TO VDU
              MOVE ORIG-LP-TRAMT TO LP-TRAMT VDUNUM2
              PERFORM SCREENIO.

           PERFORM SETUP-INT-LC-LPREC.

           GO TO SELECTION-EXIT-PROG.

       RET-TO-ENTRY-ROUTINE.
           MOVE "1" TO NEW-PROG-SUB.
           GO TO SELECTION-EXIT-PROG.

       RET-TO-REF-ENTRY.
           MOVE "1" TO NEW-PROG-SUB.
           GO TO SELECTION-EXIT-PROG.

       SELECTION-EXIT-PROG.
           MOVE "P" TO ERRCD.
           PERFORM SAVE-SCREEN.

       SELECTION-MODULE-EXIT.
           EXIT.

      *********************************************
       INITIALIZE-ROUTINE SECTION.
      *********************************************
           PERFORM SET-BAL-IBPC-LPREC.

           PERFORM SET-LP-AP-VDUBUF.
           PERFORM SET-LP-BAL-VDUBUF.

      * PARTIAL CHARGE OFF WILL NOT APPLY MONEY TO OTHER BALANCES
      * ROUTE-CD 4 WILL TAKE LOGIC TO AMOUNT-ENTRY ROUTINE

           IF LP-TRCD = "PX"
              MOVE 0 TO LP-APOTH LP-APOT2 LP-APINT LP-APLC
              MOVE 4 TO ROUTE-CD
              GO TO INITIALIZE-ROUTINE-EXIT.

      *-------------------------------------------------------------
           IF (SP-CAL-RATETYPE(1) = "Z")
              MOVE 4 TO ROUTE-CD
              MOVE LN-1STPYDATE TO PDTH-DATE-WORK
              PERFORM PAID-THRU-CALCULATION
              MOVE PDTH-CUR-SCHD-PAY TO LP-TRAMT
              GO TO INITIALIZE-ROUTINE-EXIT.

           IF ENTER-AMT-FG = "A"
              MOVE 0 TO LP-APOTH LP-APINT LP-APLC
           ELSE
              IF ENTER-AMT-FG = "O"
                 SUBTRACT LP-APOTH FROM LP-OTHBAL
                 SUBTRACT LP-APOT2 FROM LP-OT2BAL
                 MOVE 0 TO LP-APINT
              ELSE
                 MOVE LN-1STPYDATE TO PDTH-DATE-WORK
                 PERFORM PAID-THRU-CALCULATION
                 MOVE PDTH-CUR-SCHD-PAY TO LP-TRAMT.

      * TEMPORARY UNTIL COMPANIES GET ALLOTMENTS SET
      * (THIS MOVE DOES NOT UPDATE LN-REC IT IS SET FOR LATE CHARGE CALC'S)
           IF (LP-TRCD = "PA") OR
                (LP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
                                    OR "TPAY" OR "MGRAM")
              IF LP-REFNO = "LBOX" OR "TCOLL" OR "TPAY" OR "MGRAM"
                 MOVE "Y" TO LN-LBOX
                 MOVE "N" TO LN-ALLOTCD
              ELSE
                 MOVE "Y" TO LN-ALLOTCD
                 MOVE "N" TO LN-LBOX.

           IF LP-IBPC = "P" AND IBPC-EXPIRED-FLAG = " "
              GO TO INITIALIZE-DEFERMENT.

           IF DF-POSTING AND ENTER-AMT-FG = "A"
              GO TO INITIALIZE-DEFERMENT.

      * CALCULATE INTEREST:
       INITIALIZE-INTEREST.
           MOVE LP-TRCD    TO RATE-LPTRCD.
           MOVE LP-PAYDATE TO RATE-DATE IBPC-DATE.
           MOVE MAKER-CD TO RATE-MAKERCD.
           PERFORM SET-PY-RATE.

      *   'PN' AND 'PZ' NON CASH TRANSACTIONS WILL NOT APPLY MONEY
      *    TO OTHER BALANCES AND ROUTE-CD 4 WILL TAKE LOGIC TO
      *    AMOUNT-ENTRY ROUTINE:
      *JTG PR#323 CORRECTION TEST
      *    IF LP-TRCD = "PN" OR "PZ"
      *       MOVE 0 TO LP-APOTH LP-APOT2
      *       MOVE 4 TO ROUTE-CD
      *       GO TO INITIALIZE-ROUTINE-EXIT.
      *JTG PR#323 CORRECTION TEST

       INITIALIZE-DEFERMENT.
           IF ENTER-AMT-FG = "Y"
              MOVE "4" TO ROUTE-CD.

           IF NOT DF-POSTING
              GO TO INITIALIZE-ROUTINE-EXIT.

           IF ENTER-AMT-FG = "A"
              IF LP-TRAMT > SAVE-DF-TRAMT
                 MOVE SAVE-DF-TRAMT TO LP-APINT
                 GO TO INITIALIZE-ROUTINE-EXIT
               ELSE
                 MOVE LP-TRAMT TO LP-APINT
                 GO TO INITIALIZE-ROUTINE-EXIT.

           MOVE LP-TRCD TO TRCD-WORKER.
           IF TRCD-WORKER = "DF"
              MOVE 1 TO DEF-NODEF DEF-NODEFACT
           ELSE
              MOVE 1 TO DEF-NODEFACT
              MOVE TRCD-NODF TO DEF-NODEF.

           IF SP-DEFFRMLA = 1
              MOVE 0 TO DEF-AMOUNT
              MOVE SP-DEFMIN TO INPUT-DEFER-MIN
              MOVE SP-DEFMAX TO INPUT-DEFER-MAX
              MOVE INPUT-DEFER-MSG TO MESS
              PERFORM SEND-LEGEND
           ELSE
              MOVE HOLD-LN-JDRATE TO DEF-WKRATE
              MOVE LP-PAYDATE TO DEF-PAYDATE
              ADD LP-INTBAL INDU-INTEREST GIVING DEF-TOTAL-INTDUE
              PERFORM DEF-COMPUTE-DEFERMENT.
           IF SP-DEFFRMLA = 95
              IF DEF-TOTAL-INTDUE > DEF-AMOUNT
                 MOVE DEF-AMOUNT TO LP-TRAMT
                                    LP-APINT
                                    SAVE-DF-TRAMT
                 SUBTRACT DEF-AMOUNT FROM DEF-TOTAL-INTDUE
                                           GIVING LP-INTBAL
                 MOVE 0 TO LP-APCUR
              ELSE
                 MOVE DEF-AMOUNT TO LP-TRAMT
                                    SAVE-DF-TRAMT
                 MOVE DEF-TOTAL-INTDUE  TO LP-APINT
                 MOVE 0 TO LP-INTBAL
                 SUBTRACT LP-APINT FROM LP-TRAMT GIVING LP-APCUR
           ELSE
           IF SP-DEFFRMLA = 96
              IF DEF-TOTAL-INTDUE > DEF-AMOUNT
                 MOVE DEF-AMOUNT TO LP-TRAMT
                                    LP-APINT
                                    SAVE-DF-TRAMT
                 SUBTRACT DEF-AMOUNT FROM DEF-TOTAL-INTDUE
                                           GIVING LP-INTBAL
                 MOVE 0 TO LP-APCUR
              ELSE
                 MOVE DEF-AMOUNT TO LP-TRAMT
                                    SAVE-DF-TRAMT
                 MOVE DEF-TOTAL-INTDUE  TO LP-APINT
                 MOVE 0 TO LP-INTBAL
                 SUBTRACT LP-APINT FROM LP-TRAMT GIVING LP-APCUR
           ELSE
           IF SP-DEFFRMLA = 97
              ADD INDU-INTEREST LP-INTBAL GIVING LP-APINT
              MOVE DEF-AMOUNT    TO LP-TRAMT
                                    SAVE-DF-TRAMT
              IF DEF-AMOUNT > LP-APINT
                 SUBTRACT LP-APINT FROM DEF-AMOUNT
                                        GIVING LP-APCUR
              END-IF
           ELSE
              MOVE DEF-AMOUNT TO LP-TRAMT INDU-INTEREST
                                 LP-APINT SAVE-DF-TRAMT.



      * SP-DEFFRMLA = 7, WILL STORE DEFERED PAYMENT DUE DATE
      *                  INTO LP-DEF-DUEDATE
      *                  AND THE DEFERRED PERIOD
      *                  INTO LP-DEF-TERM

           MOVE DEF-DUEDATE TO LP-DEF-DUEDATE.
           MOVE DEF-DUETERM TO LP-DEF-TERM.

           IF SP-DEFFRMLA = 95 OR 96 OR 97
              MOVE 0 TO LP-APLC
           ELSE
      * PACESETTER DEFERMENT FORMULA 8 WILL CARRY A LATE CHARGE
      *   REFUND AMOUNT IN LP-APLC (WILL BE NEGATIVE) AND APCUR
      *   WILL BE THE SAME AMOUNT BUT POSITIVE
      *  EXAMPLE:       TRAMT     APINT      APLC     APCUR
      *                 45.00     45.00     10.00-     10.00
              MOVE DEF-LCHG-REFUND TO LP-APCUR.
           COMPUTE LP-APLC = DEF-LCHG-REFUND * -1.

      * DON'T ALLOW INPUTED DEFERMENT TO EXCEED CALCULATED
      * DEFERMENT AMOUNT:                    PFSIMO PR#340
           IF SP-DEFFRMLA NOT = 1
              MOVE "SNNS052040." TO VDU
              MOVE LP-TRAMT      TO VDUNUM2
              PERFORM SCREENIO.

       INITIALIZE-ROUTINE-EXIT.
           EXIT.

      *************************************************
       ENTRY-LINE-CALCULATIONS SECTION.
      *************************************************
           MOVE " " TO ROUTE-CD.

      * LOGIC TO DETERMINE PAYMENT REQUIREMENTS FOR MIP INSURANCE
    
           IF LP-TRAMT-HOLD-FOR-MIP NOT = 0
              MOVE LP-TRAMT-HOLD-FOR-MIP TO LP-TRAMT.

           PERFORM DETERMINE-MIP-REQUIRED.

           MOVE LP-TRAMT TO HOLD-LP-TRAMT.
           IF DF-POSTING
              GO TO ENTRY-LINE-CALC.

           IF NOT (LP-TRCD = "Z2" OR "PN" OR "PZ")
              IF ENTER-AMT-FG = "O"
                 SUBTRACT LP-APOTH FROM HOLD-LP-TRAMT
              ELSE
                 IF LP-OTHBAL NOT = 0
                    IF LP-OTHBAL NOT > HOLD-LP-TRAMT
                       MOVE LP-OTHBAL TO LP-APOTH
                       SUBTRACT LP-OTHBAL FROM HOLD-LP-TRAMT
                       MOVE 0 TO LP-OTHBAL
                    ELSE
                       MOVE HOLD-LP-TRAMT TO LP-APOTH
                       SUBTRACT HOLD-LP-TRAMT FROM LP-OTHBAL
                       MOVE 0 TO LP-APINT LP-APCUR LP-APLC
                                 HOLD-LP-TRAMT.

      * AT THIS POINT IN THE ABOVE ELSE, WE USED TO DO THE FOLLOWING:
      *                ADD INDU-INTEREST TO LP-INTBAL
      *                GO TO ENTRY-LINE-EXIT.
      *
      * THE LOGIC SEEMED TO BE, WE'VE USED THE WHOLE TR AMT TOWARD
      * THE OTHER BAL, SO JUST MOVE 0 TO THE OTHER APPLIED AMTS &
      * GET OUT.  BUT THIS MEANT YOU DIDN'T DO SETUP-LCHGES, SO IF
      * WE SHOULD HAVE ASSESSED & LATE CHARGE & PUT IT IN OWING, WE
      * DIDN'T.  BUT WORSE, IF YOU UP-ARROWED & CHANGED THE AMT TO
      * AN AMT LESS THAN THE OTHER BAL & THERE WAS AN AMT IN
      * SAVE-LCAP-APP-OWE, THIS GETS MOVED TO LP-APINTOWE AT THE
      * END OF THIS PROGRAM & SO YOU MAY HAVE AN AMT IN LP-APINTOWE
      * AND 0 IN LP-LCBAL, THIS IS A MESS, REVERSAL WILL MAKE
      * NEGATIVE LCBAL, ETC.  THIS SITUATION CAME UP MOSTLY BECAUSE
      * OF ESCROW - IF YOU PUT ALL OF A PMT TO ESCROW & THERE IS AN
      * OTHER BAL, WE WERE ENDING UP WITH THE NEGATIVE LCBAL ON A
      * REVERSAL.   BARB & CINDY, 3/31/10

       ENTRY-LINE-SKIP-APOTH.
           IF LP-TRCD NOT = "Z2"
              IF LP-LCBAL NOT = 0
      * WHEN 'SS' AND GP-DONT-COLL-INT-ON-SS = "Y"
      * ASSESS BUT DON'T APPLY TO LATE CHARGES REGACC #1684
                 IF NOT ( LP-TRCD = "SS" AND
                          GP-DONT-COLL-INT-ON-SS = "Y"
                        )
                    PERFORM DISBURSE-LCBAL
                    IF RTN-FG = "E"
                       GO TO ENTRY-LINE-EXIT.

           IF LP-TRCD NOT = "Z2"
              IF LP-INTBAL NOT = 0
      * WHEN 'SS' AND GP-DONT-COLL-INT-ON-SS = "Y"
      * ASSESS BUT DON'T APPLY TO INTEREST CHARGES REGACC #1684
                 IF NOT ( LP-TRCD = "SS" AND
                          GP-DONT-COLL-INT-ON-SS = "Y"
                        )
                    PERFORM DISBURSE-INTBAL
                    IF RTN-FG = "E"
                       GO TO ENTRY-LINE-EXIT.

      * DON'T ALLOW LCHG IF PC GONE TO IB:
           IF LP-TRCD NOT = "PX"
      * ONLY TAKE LATE CHARGES WHEN THE ACCOUNT IS NOT ACCELERATED
      * AND IT IS IN A PRECOMP STATUS OR IS LOAN CLASS TYPE IB
              IF (LN-ACCELDATE = 0) AND
                 (IBPC-FG = "P" OR LN-LOANTYPE = "I")
                 PERFORM SETUP-LCHGS.

           IF LP-TRCD NOT = "PX"
              IF INDU-INTEREST NOT = 0
      * WHEN 'SS' AND GP-DONT-COLL-INT-ON-SS = "Y"
      * ASSESS BUT DON'T APPLY TO INTEREST CHARGES REGACC #1684
                 IF LP-TRCD = "SS" AND
                    GP-DONT-COLL-INT-ON-SS = "Y"
                    ADD INDU-INTEREST TO LP-INTBAL
                 ELSE
                    PERFORM SETUP-INTEREST.

       ENTRY-LINE-CALC.
      *    IF NOT (LP-TRCD = "DF" AND (SP-DEFFRMLA = 97 OR
      *                                 SP-DEFFRMLA = 96 ) OR
      *                                  SP-DEFFRMLA = 95))

           IF NOT (DF-POSTING) OR
             ( DF-POSTING AND SP-DEFFRMLA = 97 OR 96 OR 95)


              IF LP-TRCD NOT = "Z2"
                 COMPUTE LP-APCUR =
                         LP-TRAMT - LP-APINT - LP-APOTH - LP-APLC
              ELSE
                 MOVE LP-APOT2 TO LP-APCUR.

      * 020889 ADDED TEST BECAUSE PRINBAL WAS GOING -.
      * JTG 082295:
           IF LP-TRCD = "Z2"
              IF LP-APCUR > LP-CURBAL
                 PERFORM EXCEEDS-PRIN-BAL
                 MOVE "7" TO ROUTE-CD
              ELSE
                 NEXT SENTENCE
           ELSE
      * JTG 082696:
      *      IF OT2BAL EXISTS, INSURE AT LEAST ($0.01 + LP-OT2BAL) REMAINS
      *         IN LP-CURBAL:
              IF LP-OT2BAL NOT = 0
                 IF LP-APCUR >= (LP-CURBAL - LP-OT2BAL)
                    PERFORM EXCEEDS-PRIN-BAL
                    MOVE "7" TO ROUTE-CD
                 END-IF
              ELSE
      * JTG 082696:
      *         IF NO OT2BAL, DON'T LET LP-PRINBAL GO NEGATIVE:
                 IF LP-APCUR > LP-CURBAL
                    PERFORM EXCEEDS-PRIN-BAL
                    MOVE "7" TO ROUTE-CD.


       ENTRY-LINE-EXIT.
           EXIT.

      *************************************************
       AMOUNT-ENTRY-ROUTINES SECTION.
      *************************************************
           MOVE " " TO ROUTE-CD.

           IF NOT ( SP-CAL-RATETYPE(1) = "Z")
            IF BYPASS-AMT-ENT-FG NOT = 0 AND LP-TRCD NOT = "Z2"
      * WHEN 'SS' AND GP-DONT-COLL-INT-ON-SS = "Y"
      * ASSESS BUT DON'T APPLY TO INT AND LCHG REGACC #1684
               IF LP-TRCD = "SS" AND
                  GP-DONT-COLL-INT-ON-SS = "Y"
                  GO APPLIED-OTH-ENTRY
               END-IF
               IF NOT DF-POSTING
                  MOVE " " TO LC-AND-INT-FG
                  SUBTRACT LP-APLC FROM LP-LCBAL GIVING WORK1
                  SUBTRACT LP-APINT FROM LP-INTBAL GIVING WORK2
                  IF ( (LP-APLC  NOT = 0) OR (WORK1 NOT = 0) )
                       AND
                         ( (LP-APINT NOT = 0) OR (WORK2 NOT = 0) )
                     MOVE "Y" TO LC-AND-INT-FG
                     GO TO APP-LC-ENTRY
                  ELSE
                     GO TO REGULAR-INT-ENTRY.

       TRANS-AMT-ENTRY.

           IF LP-TRCD = "Z2"
              GO APPLIED-OTH-ENTRY.

           MOVE " F1, ENTER TRANSACTION AMOUNT:" TO MESS.
           PERFORM SEND-LEGEND.

           MOVE "ENNS052040." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM ACCEPT-SCREEN-RESET
              PERFORM DISPLAY-ENTRY-UP
              MOVE "7" TO ROUTE-CD
              GO TO AMOUNT-ENTRY-EXIT.

           IF VDUSTATUS = "18"
              GO TO TRANS-AMT-ENTRY.

           IF VDUSTATUS = "1U"
              MOVE LP-TRCD TO TRCD-WORKER
              MOVE LP-PAYDATE TO RATE-DATE
              PERFORM ACCEPT-SCREEN-RESET
              PERFORM DISPLAY-ENTRY-UP
              MOVE VDUNUM2 TO LP-TRAMT
              MOVE RATE-DATE TO LP-PAYDATE
              MOVE TRCD-WORKER TO LP-TRCD
              MOVE "8" TO ROUTE-CD
              GO TO AMOUNT-ENTRY-EXIT.

           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO TRANS-AMT-ENTRY.

           IF VDUNUM2 < 0
              GO TO TRANS-AMT-ENTRY.

      *ADD PE TO NON-ZERO AMOUNT PR#685
           IF VDUNUM2 = 0
              IF LP-TRCD = "PX" OR "PE"
                 GO TO TRANS-AMT-ENTRY
              END-IF
              IF LP-TRCD = "SS"
                 MOVE SS-ZERO-SEQ             TO PASSWDW-SEQ
                 MOVE "FOR $0.00 'SS' AMOUNT" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO TRANS-AMT-ENTRY
                 END-IF
              END-IF
              IF ENTER-AMT-FG = "Y"
                 MOVE "SN S052040." TO VDU
                 MOVE LP-TRAMT TO VDUNUM2
                 PERFORM SCREENIO
                 MOVE LP-TRAMT TO VDUNUM2.

           PERFORM CLEAR-LEGEND.

           IF NOT ( SP-CAL-RATETYPE(1) = "Z" )
              IF VDUNUM2 NOT = LP-TRAMT
                 IF NOT DF-POSTING
                    MOVE LP-TRCD TO TRCD-WORKER
                    MOVE LP-PAYDATE TO RATE-DATE
                    PERFORM ACCEPT-SCREEN-RESET
                    PERFORM DISPLAY-ENTRY-UP
                    MOVE VDUNUM2   TO LP-TRAMT
                                      LP-TRAMT-HOLD-FOR-MIP
                    MOVE RATE-DATE TO LP-PAYDATE
                    MOVE TRCD-WORKER TO LP-TRCD
                    MOVE "A" TO ENTER-AMT-FG
      *IF LN-ESCROW-FG = "Y" WE USE ORIG-LP-TRAMT WHICH IS NOT SET WITH
      *PX TRANSACTION.
                    IF LP-TRCD = "PX"
                       MOVE LP-TRAMT TO LP-APCUR
                       IF LN-ESCROW-FG = "Y"
                          MOVE LP-TRAMT TO ORIG-LP-TRAMT
                       END-IF
                       IF LP-APCUR >= LP-CURBAL - LP-OT2BAL
                          MOVE "XX" TO MESS
                          PERFORM CONDITIONAL-SEND-MESS
                          GO TO TRANS-AMT-ENTRY
                       ELSE
                          MOVE "9" TO ROUTE-CD
                       END-IF
                    ELSE
                       IF LN-ESCROW-FG = "Y"
                          MOVE LP-TRAMT TO ORIG-LP-TRAMT
                          PERFORM ESCROW-APPLICATION-WINDOW
                          IF MISSING-ESCROW-FG = "Y"
                             GO TO TRANS-AMT-ENTRY
                          END-IF
                       END-IF
                       MOVE "1" TO ROUTE-CD
                    END-IF
                    GO TO AMOUNT-ENTRY-EXIT
                 ELSE
      * DON'T ALLOW INPUTED DEFERMENT TO EXCEED CALCULATED
      * DEFERMENT AMOUNT:                    PFSIMO PR#340
                 IF ( VDUNUM2 > LP-TRAMT  ) AND
                    ( SP-DEFFRMLA NOT = 1 )
                    MOVE "AMOUNT EXCEEDS CALCULATED DEFERMENT CHARGE"
                                                              TO MESS
                    PERFORM CONDITIONAL-SEND-MESS
                    GO TO TRANS-AMT-ENTRY
                 END-IF
      * DON'T ALLOW OVERRIDE OF CALCULATED DEFERMENT AMOUNT,
      * WHEN (SP-DEFFRMLA = 97 OR NOT = 1) WITH VALID PASSWORD:
                 IF (SP-DEFFRMLA = 97 OR 96)
                    MOVE LP-TRAMT TO REQ-DEF-CHG
                    MOVE REQ-DEF-CHARGE TO MESS
                    PERFORM CONDITIONAL-SEND-MESS
                    GO TO TRANS-AMT-ENTRY
                 ELSE
                 IF SP-DEFFRMLA NOT = 1
                    MOVE OVERDEF-SEQ TO PASSWDW-SEQ
                    MOVE "TO OVERRIDE DEFERMENT" TO PASSWDW-PROMPT2
                    PERFORM VERIFY-PASSWORD
                    IF PASSWDW-STAT NOT = "OK"
                       GO TO TRANS-AMT-ENTRY.

           IF DF-POSTING
              IF VDUNUM2 < SP-DEFMIN OR VDUNUM2 > SP-DEFMAX
                 MOVE "AMOUNT NOT WITHIN VALID SPR DEFERMENT RANGE"
                                                         TO MESS
                 PERFORM CONDITIONAL-SEND-MESS.

      *   IF DEFERMENT AND FORMULA 1 (CHARGE INPUTTED) MOVE ENTERED
      *   CHARGE TO SAVE-DF-TRAMT TO AVOID AFFECTING INTEREST OWING
           IF DF-POSTING
              IF SP-DEFFRMLA = 1
                  MOVE VDUNUM2 TO SAVE-DF-TRAMT INDU-INTEREST.

           IF DF-POSTING
              IF BR-NODEF-IF-ZERO-AMT = "Y" AND
                 VDUNUM2 = 0
                 MOVE "ZERO DEFERMENTS ARE NOT ALLOWED!!!!!!!" TO MESS
                 PERFORM CONDITIONAL-SEND-MESS
                 GO TO TRANS-AMT-ENTRY
              END-IF
              IF SP-DEFFRMLA = 97
                 MOVE 0 TO LP-INTBAL
              ELSE
              IF SP-DEFFRMLA = 95
                 IF DEF-TOTAL-INTDUE < VDUNUM2
                    MOVE ZEROS TO LP-INTBAL
                 ELSE
                    MOVE VDUNUM2 TO LP-APINT
                    SUBTRACT VDUNUM2 FROM DEF-TOTAL-INTDUE
                                        GIVING LP-INTBAL

              ELSE
              IF SP-DEFFRMLA = 96
                 IF DEF-TOTAL-INTDUE < LP-TRAMT
                    MOVE ZEROS TO LP-INTBAL
                 ELSE
                    SUBTRACT DEF-AMOUNT FROM DEF-TOTAL-INTDUE
                                           GIVING LP-INTBAL
                 END-IF
              ELSE
                 COMPUTE LP-INTBAL =
                         LP-INTBAL + (SAVE-DF-TRAMT - VDUNUM2)
                 MOVE VDUNUM2 TO LP-APINT.

           MOVE VDUNUM2 TO LP-TRAMT
                           LP-TRAMT-HOLD-FOR-MIP.

           IF LN-ESCROW-FG = "Y"
              MOVE LP-TRAMT TO ORIG-LP-TRAMT
              PERFORM ESCROW-APPLICATION-WINDOW
              IF MISSING-ESCROW-FG = "Y"
                 GO TO TRANS-AMT-ENTRY.

      *------------------------------------------------------------------
      *    TEST FOR ACCOUNT UNDER AMORTIZED INTEREST SP-CAL-RATETYPE (Z)
      *------------------------------------------------------------------
           IF SP-CAL-RATETYPE(1) = "Z"
              MOVE LP-TRAMT     TO HOLD-LP-TRAMT

              MOVE LP-PAYDATE       TO LFPAP-TODAY
              MOVE LP-TRCD          TO LFPAP-TRCD
              MOVE LP-TRAMT         TO LFPAP-TRAMT

              MOVE LN-CURBAL        TO LFPAP-CURBAL
              MOVE LN-INTBAL        TO LFPAP-INTBAL
              MOVE LN-OTHBAL        TO LFPAP-OTHBAL

              MOVE LN-LCBAL         TO LFPAP-LCBAL

              MOVE LN-REMAIN-INT-SINCE-LFP
                                    TO LFPAP-REMAIN-INT-SINCE-LFP
              MOVE LN-REMAIN-PRIN-SINCE-LFP
                                    TO LFPAP-REMAIN-PRIN-SINCE-LFP
              MOVE LN-TOTPAYMNTD    TO LFPAP-TOTPAYMNTD
              MOVE LN-TOTEXCPAYMNTD TO LFPAP-TOTEXCPAYMNTD

              PERFORM LFPAP-ROUTINE

      * SET INDU-INTEREST WITH NEW APPLIED INTEREST
      * FOR SETUP-INT-LC-LPREC ROUTINE:
      *      MOVE LFPAP-INDU-INTEREST TO INDU-INTEREST

      * COMPUTE NEW LATE CHARGES DUE THROUGH TODAY,
      * EXCLUSIVE OF EXTRA PRINCIPAL AND RESTORE
      * TOTPAYMNTD FIELDS TO WHAT THEY WERE AFTER
      * PERFORM OF LFPAP-ROUTINE:

              MOVE ORIG-TOTPAYMNTD    TO LN-TOTPAYMNTD
              MOVE ORIG-TOTEXCPAYMNTD TO LN-TOTEXCPAYMNTD
              SUBTRACT LFPAP-EXTRA-PRIN FROM HOLD-LP-TRAMT
              PERFORM SETUP-LCHGS
              ADD LCAP-APP             TO LCAP-OWE
              MOVE 0                   TO LCAP-APP
              ADD LCAP-OWE LN-LCBAL GIVING LFPAP-LCBAL
              MOVE LP-TRAMT            TO HOLD-LP-TRAMT
              MOVE LFPAP-TOTPAYMNTD    TO LN-TOTPAYMNTD
              MOVE LFPAP-TOTEXCPAYMNTD TO LN-TOTEXCPAYMNTD
              MOVE LFPAP-APCUR         TO LP-APCUR
              MOVE LFPAP-APINT         TO LP-APINT
              MOVE LFPAP-APLC          TO LP-APLC
              MOVE LFPAP-APOTH         TO LP-APOTH
              MOVE LFPAP-EXTRA-PRIN    TO LP-EXTRA-PRIN-LFP
              MOVE LFPAP-REMAIN-INT-SINCE-LFP
                                       TO LP-REMAIN-INT-SINCE-LFP
              MOVE LFPAP-REMAIN-PRIN-SINCE-LFP
                                       TO LP-REMAIN-PRIN-SINCE-LFP
              SUBTRACT LFPAP-APLC    FROM LFPAP-LCBAL
              MOVE LFPAP-LCBAL       TO LP-LCBAL
              SUBTRACT LFPAP-APOTH   FROM LFPAP-OTHBAL
              MOVE LFPAP-OTHBAL      TO LP-OTHBAL
              MOVE LFPAP-CURBAL      TO LP-CURBAL
      * SETUP HOLD-LXZ-POST FIELDS:
              COMPUTE HOLD-LXZ-POST-REGPY =
                   LP-TRAMT - LP-EXTRA-PRIN-LFP - LP-APOTH - LP-APLC
              MOVE LP-EXTRA-PRIN-LFP  TO HOLD-LXZ-POST-EXTRA-PRIN
              MOVE LP-APOTH           TO HOLD-LXZ-POST-OTH
              MOVE LP-APLC            TO HOLD-LXZ-POST-LCHG

              MOVE LFPAP-APPDUEINT    TO HOLD-LXZ-PDUE-APINT
              MOVE LFPAP-APPDUEPRIN   TO HOLD-LXZ-PDUE-APPRIN
              MOVE LFPAP-APCURINT     TO HOLD-LXZ-CUR-APINT
              MOVE LFPAP-APCURPRIN    TO HOLD-LXZ-CUR-APPRIN
              MOVE "N" TO ENTER-AMT-FG
              GO TO AMOUNT-ENTRY-EXIT.

           IF ENTER-AMT-FG = "Y"
              MOVE "N" TO ENTER-AMT-FG
              MOVE "3" TO ROUTE-CD
              GO TO AMOUNT-ENTRY-EXIT.

      * LOGIC TO DETERMINE PAYMENT REQUIREMENTS FOR MIP INSURANCE
    
           IF LP-TRAMT-HOLD-FOR-MIP NOT = 0
              MOVE LP-TRAMT-HOLD-FOR-MIP TO LP-TRAMT.
           PERFORM DETERMINE-MIP-REQUIRED.

           IF LP-TRCD = "Z2" OR "PX"
              GO TO AMOUNT-ENTRY-EXIT.

       APPLIED-OTH-ENTRY.
           IF DF-POSTING
              GO TO VERIFY-PRIN-RTN.
           IF LP-TRCD = "PN" OR "PZ"
              GO TO APPLIED-INT-ENTRY.

           MOVE "ENNS042050." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM ACCEPT-SCREEN-RESET
              PERFORM DISPLAY-ENTRY-UP
              MOVE "7" TO ROUTE-CD
              GO TO AMOUNT-ENTRY-EXIT.
           IF VDUSTATUS = "1U"
              GO TO TRANS-AMT-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO APPLIED-OTH-ENTRY.

           IF LP-TRCD = "Z2"
              MOVE 0 TO LP-TRAMT
              GO TO APPLIED-OT2-ENTRY.

           IF VDUNUM2 < 0
      * ADDED THIS IF BELOW HERE TO ALLOW ME TO ENTER A NEG IF MY OTHBAL IS
      * NEGATIVE FOR WDT
              IF LN-OTHBAL < 0
                 NEXT SENTENCE
              ELSE
                 GO TO APPLIED-OTH-ENTRY.

      *
      *
      *    IF VDUNUM2 NOT = LP-APOTH
      *       IF VDUNUM2 NOT > LP-TRAMT
      *          IF VDUNUM2 NOT > LN-OTHBAL OR
      *               (VDUNUM2 = 0 AND LN-OTHBAL < 0)


      * FORCE PASSWORD TO WAIVE COLLECTING OTHER BALANCE ON "SS"
           IF ( LP-TRCD = "SS" AND
                GP-DONT-COLL-INT-ON-SS = "Y")
              IF VDUNUM2 NOT = LP-APOTH
                 MOVE SS-PASSWD-TO-COLL-OT TO PASSWDW-SEQ
                 MOVE "TO NOT COLLECT OTHER CHARGE" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO APPLIED-OTH-ENTRY.


           IF VDUNUM2 NOT = LP-APOTH
              IF VDUNUM2 NOT > LP-TRAMT
                 IF VDUNUM2 NOT > LN-OTHBAL OR
                      (VDUNUM2 = 0 AND LN-OTHBAL < 0)
                    IF LN-OTHBAL < 0
                       IF VDUNUM2 = 0 OR VDUNUM2 = LN-OTHBAL
                          MOVE "O" TO ENTER-AMT-FG
                          MOVE "1" TO ROUTE-CD
                          MOVE VDUNUM2 TO LP-APOTH
                          GO TO AMOUNT-ENTRY-EXIT
                       ELSE
                          MOVE "NOT ALLOWED" TO MESS
                          PERFORM CONDITIONAL-SEND-MESS
                          GO TO APPLIED-OTH-ENTRY
                    ELSE
                       MOVE "O" TO ENTER-AMT-FG
                       MOVE "1" TO ROUTE-CD
                       MOVE VDUNUM2 TO LP-APOTH
                       GO TO AMOUNT-ENTRY-EXIT
                 ELSE
                    PERFORM EXCEEDS-OTH-BAL
                    GO TO APPLIED-OTH-ENTRY
              ELSE
                 MOVE "EXCEEDS TRANSACTION AMT" TO MESS
                 PERFORM CONDITIONAL-SEND-MESS
                 GO TO APPLIED-OTH-ENTRY.

      * WHEN 'SS' AND GP-DONT-COLL-INT-ON-SS = "Y"
      * ASSESS BUT DON'T APPLY TO INT AND LCHG REGACC #1684

           IF ( LP-TRCD = "SS" AND GP-DONT-COLL-INT-ON-SS = "Y" )
              GO TO AMOUNT-ENTRY-EXIT
           ELSE
              GO TO APPLIED-INT-ENTRY.

       APPLIED-OT2-ENTRY.

           IF VDUNUM2 = 0
              MOVE "0.00 (ZERO) IS NOT ALLOWED" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO APPLIED-OTH-ENTRY.

           IF VDUNUM2 NOT = LP-APOT2
              IF VDUNUM2 NOT > LN-OT2BAL OR
                 (VDUNUM2 = 0 AND LN-OT2BAL < 0)
                 IF LN-OT2BAL < 0
                    IF VDUNUM2 = 0 OR VDUNUM2 = LN-OT2BAL
                       MOVE "O" TO ENTER-AMT-FG
                       MOVE "1" TO ROUTE-CD
                       MOVE VDUNUM2 TO LP-APOT2
                       GO TO AMOUNT-ENTRY-EXIT
                    ELSE
                       MOVE "NOT ALLOWED" TO MESS
                       PERFORM CONDITIONAL-SEND-MESS
                       GO TO APPLIED-OTH-ENTRY
                 ELSE
                    MOVE "O" TO ENTER-AMT-FG
                    MOVE "1" TO ROUTE-CD
                    MOVE VDUNUM2 TO LP-APOT2
                    GO TO AMOUNT-ENTRY-EXIT
              ELSE
                PERFORM EXCEEDS-OT2-BAL
                GO TO APPLIED-OTH-ENTRY.

           GO TO AMOUNT-ENTRY-EXIT.

       APPLIED-INT-ENTRY.
           MOVE " " TO LC-AND-INT-FG.
           SUBTRACT LP-APLC FROM LP-LCBAL GIVING WORK1.
           SUBTRACT LP-APINT FROM LP-INTBAL GIVING WORK2.
           IF ( (LP-APLC NOT = 0) OR (WORK1 NOT = 0) )
                AND
                  ( (LP-APINT NOT = 0) OR (WORK2 NOT = 0) )
              MOVE "Y" TO LC-AND-INT-FG
           ELSE
              GO TO REGULAR-INT-ENTRY.

       APP-INT-ENTRY.
           IF VDUSTATUS NOT = "1U"
              PERFORM DISPLAY-APP-LC-INT.

           MOVE "ENNS042GA9." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM ACCEPT-SCREEN-RESET
              MOVE LP-REC TO WK-LP-REC
              PERFORM DISPLAY-ENTRY-UP
              MOVE WK-LP-REC TO LP-REC
              MOVE "7" TO ROUTE-CD
              GO TO AMOUNT-ENTRY-EXIT.
           IF VDUSTATUS = "1U"
              GO TO APPLIED-OTH-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO APP-LC-ENTRY.
           IF VDUNUM2 > LP-APINT
              MOVE "AMOUNT IS GREATER THAN ORIGINAL" TO MESS
              PERFORM CONDITIONAL-SEND-MESS.
           MOVE VDUNUM2 TO LP-APINT.

           MOVE "SN S042060." TO VDU.
           COMPUTE VDUNUM2 = LP-APLC + LP-APINT.
           PERFORM SCREENIO.

           PERFORM SET-DISPLAY-OWING-INT-LC.
      * BAD PERFORM
      *    PERFORM VERIFY-PRIN-RTN.
           GO TO APP-LC-ENTRY-CONT.

       APP-LC-ENTRY.
           PERFORM DISPLAY-APP-LC-INT.

       APP-LC-ENTRY-CONT.
           MOVE "ENNS042GA0." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "10"
              PERFORM ACCEPT-SCREEN-RESET
              MOVE LP-REC TO WK-LP-REC
              PERFORM DISPLAY-ENTRY-UP
              MOVE WK-LP-REC TO LP-REC
              MOVE "7" TO ROUTE-CD
              GO TO AMOUNT-ENTRY-EXIT.
           IF VDUSTATUS = "1U"
              GO TO APP-INT-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO APP-LC-ENTRY.
           IF VDUNUM2 > LP-APLC
              MOVE "AMOUNT IS GREATER THAN ORIGINAL" TO MESS
              PERFORM CONDITIONAL-SEND-MESS.
           MOVE VDUNUM2 TO LP-APLC.
           MOVE "SN S042060." TO VDU.
           COMPUTE VDUNUM2 = LP-APLC + LP-APINT.
           PERFORM SCREENIO.
           PERFORM SET-DISPLAY-OWING-INT-LC.
           GO TO VERIFY-PRIN-RTN.

       REGULAR-INT-ENTRY.
           MOVE "ENNS042060." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "10"
              PERFORM ACCEPT-SCREEN-RESET
              MOVE "7" TO ROUTE-CD
              GO TO AMOUNT-ENTRY-EXIT.
           IF VDUSTATUS = "1U"
              IF NOT DF-POSTING
                 MOVE 0 TO BYPASS-AMT-ENT-FG
                 IF LP-TRCD = "PZ" OR "PN"
                    GO TO TRANS-AMT-ENTRY
                 ELSE
                    GO TO APPLIED-OTH-ENTRY
                 END-IF
              ELSE
                 GO TO APPLIED-OTH-ENTRY.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO APPLIED-INT-ENTRY.
           IF VDUNUM2 < 0
              GO TO APPLIED-INT-ENTRY.
      * SEND MESSAGE IF CHANGING APPLIED TO BE GREATER
           IF LP-IBPC = "P"
              IF VDUNUM2 > LP-APLC
                 MOVE "AMOUNT IS GREATER THAN ORIGINAL" TO MESS
                 PERFORM CONDITIONAL-SEND-MESS.
           IF LP-IBPC = "I"
              IF VDUNUM2 > LP-APINT
                 MOVE "AMOUNT IS GREATER THAN ORIGINAL" TO MESS
                 PERFORM CONDITIONAL-SEND-MESS.
      * IF "P", ALWAYS APPLY TO LATE CHARGE
           IF LP-IBPC = "P"
              MOVE VDUNUM2 TO LP-APLC
              MOVE 0 TO LP-APINT
              GO TO VERIFY-PRIN-RTN.

      * IF "I", FIRST REDUCE LATE CHARGE BALANCE, THEN INTEREST
           IF VDUNUM2 > LP-LCBAL
              MOVE LP-LCBAL TO LP-APLC
              COMPUTE LP-APINT = VDUNUM2 - LP-APLC
           ELSE
              MOVE VDUNUM2 TO LP-APLC
              MOVE 0 TO LP-APINT.

       VERIFY-PRIN-RTN.
           COMPUTE PRIN-WORKER =
                   LP-TRAMT - LP-APOTH - LP-APINT - LP-APLC.

           MOVE "SN S052070." TO VDU.
           MOVE PRIN-WORKER TO VDUNUM2 LP-APCUR.
           PERFORM SCREENIO.

           IF PRIN-WORKER < 0
              MOVE "AMOUNTS APPLIED EXCEED TRANSACTION AMOUNT" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO APPLIED-INT-ENTRY.

           MOVE "SN N062110." TO VDU.
           SUBTRACT LP-APCUR FROM LP-CURBAL GIVING VDUNUM2.
           PERFORM SCREENIO.

           IF PRIN-WORKER > LP-CURBAL
              PERFORM EXCEEDS-PRIN-BAL
              GO TO APPLIED-INT-ENTRY.
           IF LN-SERVACCT = "N"
              IF PRIN-WORKER > LN-PURBAL
                 PERFORM EXCEEDS-PUR-BAL
                 GO TO APPLIED-INT-ENTRY.
      * JTG 082295:
           IF LP-TRCD = "Z2"
              IF PRIN-WORKER > LP-CURBAL
                 PERFORM EXCEEDS-PRIN-BAL
                 GO TO APPLIED-INT-ENTRY
              ELSE
                 NEXT SENTENCE
           ELSE
      * JTG 082696:
      *      IF OT2BAL EXISTS, INSURE AT LEAST ($0.01 + LP-OT2BAL) REMAINS
      *         IN LP-CURBAL:
              IF LP-OT2BAL NOT = 0
                 IF LP-APCUR >= (LP-CURBAL - LP-OT2BAL)
                    PERFORM EXCEEDS-PRIN-BAL
                    GO TO APPLIED-INT-ENTRY
                 END-IF
              ELSE
      * JTG 082696:
      *         IF NO OT2BAL, DON'T LET LP-PRINABL GO NEGATIVE:
                 IF LP-APCUR > LP-CURBAL
                    PERFORM EXCEEDS-PRIN-BAL
                    GO TO APPLIED-INT-ENTRY.


       VERIFY-PRIN-CONT.
           IF NOT DF-POSTING
                   OR BYPASS-AMT-ENT-FG = 0
              SUBTRACT LP-APINT FROM LP-INTBAL
              SUBTRACT LP-APLC FROM LP-LCBAL.

           SUBTRACT LP-APOTH FROM LP-OTHBAL.

           MOVE 0 TO BYPASS-AMT-ENT-FG.

       AMOUNT-ENTRY-EXIT.

      * RECALCULATE LCPDTH IF F4 ALTERED LN-LCBAL DISTRIBUTION:
           IF ROUTE-CD NOT = "1"
            IF F4-FLAG = 1
             IF SP-LCFRMLA-PRIN-ONLY
      *         "B" "F" "G" "I" "J" "K" "L" "M" "P" "S"
              IF LP-TRAMT = SAVE-LP-TRAMT
               IF LP-APLC NOT = SAVE-LP-APLC
      *JTG #295   COMPUTE LCAP-TRAMT = LP-TRAMT - LP-APOTH - LP-APINT  REGENCY
                  COMPUTE LCAP-TRAMT = LP-TRAMT - LP-APOTH
                  MOVE LP-PAYDATE        TO LCAP-PAYDATE
                  MOVE LN-1STPYDATE      TO LCAP-1STPYDATE
                  MOVE LP-APLC           TO LCAP-LPAPLC
                  MOVE LP-APINT          TO LCAP-LPAPINT
                  MOVE BATCH-REFCD       TO LCAP-BATCH-REFCD
                  MOVE BATCH-REFCD-LC-FG TO LCAP-BATCH-REFCD-LC-FG

                  MOVE SP-LCRATE         TO HOLD-SP-LCRATE
                  MOVE SP-LCMINCHG       TO HOLD-SP-LCMINCHG
                  MOVE SP-LCMAXAMT       TO HOLD-SP-LCMAXAMT
                  MOVE LN-LC-CODE        TO HOLD-LN-LC-CODE
                  MOVE 0                 TO SP-LCRATE
                                            SP-LCMINCHG
                                            SP-LCMAXAMT
                                            LN-LC-CODE
                  PERFORM LATE-CHARGE-APPLY
                  MOVE HOLD-SP-LCRATE    TO SP-LCRATE
                  MOVE HOLD-SP-LCMINCHG  TO SP-LCMINCHG
                  MOVE HOLD-SP-LCMAXAMT  TO SP-LCMAXAMT
                  MOVE HOLD-LN-LC-CODE   TO LN-LC-CODE

                  PERFORM TEST-FOR-PE-AL
                  SUBTRACT LCAP-APP FROM HOLD-LP-TRAMT
                  MOVE LCAP-PARTIALS     TO HOLD-PARTIALS
                  MOVE LCAP-LCPAID       TO HOLD-LCPAID
                  ADD LCAP-APP           TO LP-APLC
                  ADD LCAP-OWE           TO LP-LCBAL
                  MOVE LCAP-NOLCHG       TO LP-NOLCHG
                  MOVE LCAP-LCPDTH-DATE       TO LP-LCPDTH-DATE.

           IF ROUTE-CD NOT = " " AND LXG-GLNO(1) NOT = 0
              PERFORM ACCEPT-SCREEN-RESET
              PERFORM DISPLAY-ENTRY-UP.

      *************************************************
       DISPLAY-ENTRY-LINE SECTION.
      *************************************************
           PERFORM SETUP-PRIN-PAYMNTD.

      * ONLY "PA" OR "PE" OR "PR" OR "PC" OR "PP" OR "SS" OR "IN"
      * ALLOW YOU TO BRING ACCOUNT TO 0

           IF LP-CURBAL = 0 AND
                   NOT ( LP-TRCD = "PA" OR "PE" OR "SS" OR "IN"
                                 OR "PR" OR "PC" OR "PP" )
              PERFORM EQUALS-PRIN-BAL
              MOVE "7" TO ROUTE-CD
              GO TO DISPLAY-ENTRY-LN-EXIT.

           IF LP-TRCD = "PY" OR "PA" OR "PE" OR "SS" OR "PR"
                             OR "PC" OR "PP" OR "AH" OR "PX"
                             OR "PN" OR "PZ" OR "IN"
      * BAH COMMENTED OUT 4/21/00 WISC PL# 279 I BELIEVE WE WERE ASSUMING
      *     IF YOU WERE MAKING A REGPYAMT, IT COULD ALLOW YOU TO GO BELOW
      *     THE NET PAYOFF.....
      *          IF NOT (LP-TRAMT = LN-REGPYAMT OR LN-1STPYAMT)
      *
                 PERFORM CALL-PAYOFF
                 COMPUTE NETDUE-PRIN =
                    PASS-NETDUE - PASS-PRINTDUE - LN-OT2BAL
                 IF LP-APCUR > NETDUE-PRIN
                    PERFORM EXCEEDS-NET-PAYOFF
                    MOVE "7" TO ROUTE-CD
                    GO TO DISPLAY-ENTRY-LN-EXIT
                 END-IF
      *----------------------------------------------------------------------
      *          THE FOLLOWING TEST IS TO STOP A FULL PAYOFF
      *          EX:
      *             PAYOFF YIELDS
      *
      *             99/99/99  RC    25.00           25.00  9999       1123.00
      *             99/99/99  RI   123.00          123.00  9999       1000.00
      *             99/99/99  PO  1010.00  10.00  1000.00  9999          0.00
      *
      *             TEST STOPS POSTING A PAYMENT WHICH YIELDS APPLIED TO PRIN
      *             OF EXACTLY $1000.00, WHICH RESULTS IN A TRUE PAYOFF.
      *             THE ACCOUNT MUST FIRST PREPARE FOR THE PAYOFF, WHICH IN
      *             THIS CASE WOULD BE POSTING AN 'RC' & 'RI'.
      *
                 IF LP-APCUR = NETDUE-PRIN
                    IF LP-APCUR NOT = LN-CURBAL
                       PERFORM WILL-CAUSE-PAYOFF
                       MOVE "7" TO ROUTE-CD
                       GO TO DISPLAY-ENTRY-LN-EXIT.

      *----------------------------------------------------------------------

           IF LN-SERVACCT = "N"
              IF LP-APCUR > 0
                 IF LP-APCUR > LN-PURBAL
                    PERFORM EXCEEDS-PUR-BAL
                    MOVE "7" TO ROUTE-CD
                    GO TO DISPLAY-ENTRY-LN-EXIT.


           IF DF-POSTING
              ADD DEF-NODEF TO LN-TOTNODEF
              ADD DEF-NODEFACT TO LN-TOTNODEFACT.

           PERFORM SETUP-PDTH-LPREC.

      * IF PACESETTER DEFFRMLA 8 AND NEW PDTH IS GREATER THAN ORIGINAL
      *    LCPDTH, BUMP LCPDTH
           IF DF-POSTING
              IF SP-DEFFRMLA = 8
                 IF LN-LCPDTH-DATE < PDTH-DATE-FULL
                    PERFORM INCR-LCPDTH
                 ELSE
                    NEXT SENTENCE
              ELSE
                 PERFORM INCR-LCPDTH.

           IF LN-SERVACCT NOT = "Y"
              ADD LP-APINT LP-APLC TO HOLD-LN-TOTERN.

      * PACESETTER DEFFRMLA 8 CAN HAVE LATE CHARGES
           ADD LP-APLC TO HOLD-LN-TOTLCHG.
           IF DF-POSTING AND
               (SP-DEFFRMLA NOT = 97 AND SP-DEFFRMLA NOT = 96
                                      AND SP-DEFFRMLA NOT = 95)
              ADD LP-APINT TO HOLD-LN-TOTDFMNTS
           ELSE
              ADD LP-APINT TO HOLD-LN-TOTINT.

           IF NOT DF-POSTING
              PERFORM SETUP-CERN-LPREC.

           PERFORM SETUP-INTPAID-LPREC.

           MOVE 0 TO LP-DLPROC.
           IF LN-SERVACCT = "Y"
              PERFORM SETUP-DLPROC-LPREC.

           PERFORM DISPLAY-EARNINGS.
           PERFORM SETUP-LINE.
           IF LN-ESCROW-FG = "Y"
              MOVE ORIG-LP-TRAMT TO EB-040.
           PERFORM SEND-ENTRY-LINE.
           IF LN-MIP-FG = "Y"
              IF (HOLD-LXM-MIP-CLPAID NOT = 0) AND
                 (HOLD-LXM-MIP-AHPAID NOT = 0)
      *          "CL & AH MIP INSURANCE WAS COLLECTED"
                 MOVE HOLD-LXM-MIP-CLPAID TO MIP-CL
                 MOVE HOLD-LXM-MIP-AHPAID TO MIP-AH
                 STRING MIP-CL-MESS MIP-AH-MESS MIP-COLLECTED
                   DELIMITED BY SIZE INTO MESS
                 PERFORM CONDITIONAL-SEND-MESS
              ELSE
              IF (HOLD-LXM-MIP-CLPAID NOT = 0)
      *          "CL MIP INSURANCE WAS COLLECTED"
                 MOVE HOLD-LXM-MIP-CLPAID TO MIP-CL
                 STRING MIP-CL-MESS MIP-COLLECTED
                   DELIMITED BY SIZE INTO MESS
                 PERFORM CONDITIONAL-SEND-MESS
              ELSE
              IF (HOLD-LXM-MIP-AHPAID NOT = 0)
      *          "AH MIP INSURANCE WAS COLLECTED"
                 MOVE HOLD-LXM-MIP-AHPAID TO MIP-AH
                 STRING MIP-AH-MESS MIP-COLLECTED
                   DELIMITED BY SIZE INTO MESS
                 PERFORM CONDITIONAL-SEND-MESS.

           PERFORM SET-LP-AP-VDUBUF.
           PERFORM SET-LP-BAL-VDUBUF.

           IF BR-IB-LCHG-MESS = "Y"
              IF LP-IBPC = "I"
                 IF LP-APLC NOT = 0
                    MOVE "LATE CHARGES HAVE BEEN APPLIED" TO MESS
                    PERFORM CONDITIONAL-SEND-MESS.


           IF ENTER-AMT-FG = "O"
              IF LC-AND-INT-FG = "Y"
                 MOVE "X" TO LC-AND-INT-FG
                 PERFORM DISPLAY-APP-LC-INT.

           IF LN-SERVACCT = "N"
              PERFORM SETUP-AFPDLLP.

      * WORLD PR# 458
      * THEY MUST WAIVE LATE CHARGES ON A CCCS ( CONSUMER CREDIT COUNSELING
      *   SERVICE) PAYMENT
           IF LP-REFNO = "CCCS " AND LP-APLC NOT = 0
              MOVE "MUST WAIVE LATE CHARGE FIRST" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              MOVE "7" TO ROUTE-CD
              GO TO DISPLAY-ENTRY-LN-EXIT.


      * DETERMINE CONTRACTUAL ELAPSED PERIODS THRU TODAY:
      * AND COMPARE TO PDTH-PAYS WHICH IS STORED IN
      * HOLD-PERIODS-PAIDTHRU IN SETUP-PDTH-LPREC.
      * ALABAMA PREPAYMENT WORLD PR#1140
           IF SP-ALT-PREPAY-MONTHS NOT NUMERIC
              GO TO DISPLAY-ENTRY-LN-EXIT.
          
           IF SP-ALT-PREPAY-MONTHS = ZEROS
              GO TO DISPLAY-ENTRY-LN-EXIT.
            
           IF LN-LPO = "ALT"
              GO TO DISPLAY-ENTRY-LN-EXIT.
 
           MOVE LN-1STPYDATE TO CEPP1-DATE.
           MOVE LP-PAYDATE   TO CEPP2-DATE.
           PERFORM CONTRACTUAL-ELAPSED-PAYPER.
           MOVE CEPP-PERIODS TO HOLD-PERIODS-TODAY.

      *TEST THE DIFFERENCE
           SUBTRACT HOLD-PERIODS-TODAY FROM HOLD-PERIODS-PAIDTHRU
                                GIVING HOLD-PERIODS-PAID-AHEAD.
     
           IF HOLD-PERIODS-PAID-AHEAD NOT < 
                                SP-ALT-PREPAY-MONTHS
              IF LN-INT-REBATE NOT = "Y"
                 STRING                 
                "ACCT IS PAID AHEAD  " HOLD-PERIODS-PAID-AHEAD
                " PAYS, MUST REBATE INTEREST" 
                      DELIMITED BY "  " INTO MESS
                 PERFORM CONDITIONAL-SEND-MESS
                 MOVE 7 TO ROUTE-CD
                 GO TO DISPLAY-ENTRY-LN-EXIT            
              ELSE
                 MOVE "SETTING ALT PREPAYMENT STATUS" TO MESS
                 PERFORM CONDITIONAL-SEND-MESS
                 MOVE "Y"   TO HOLD-ALT-PREPAY-FG.
       DISPLAY-ENTRY-LN-EXIT.
           EXIT.

      *************************************************
       ACCEPT-ENTRY-ROUTINE SECTION.
      *************************************************
       ACCEPT-ENTRY-RTN.
           IF SP-CAL-RATETYPE(1) = "Z"
              IF NOT (LP-TRCD = "PE" OR "IN")
                 MOVE
                 "F1, ^-BACK, F4-REAPPLY, F7-GL ENTRY, DRAWER ENTRY   :"
                                                                 TO MESS
              ELSE
                 MOVE
                 "F1, ^-BACK, F4-APPLIED, F7-GL ENTRY, DRAWER ENTRY   :"
                                                                 TO MESS
              END-IF
           ELSE
           IF LP-TRCD = "PX"
              MOVE "F1-CANCEL, F7-GL ENTRY, DRAWER ENTRY   :"
                                                          TO MESS
           ELSE
              MOVE "F1-CANCEL, ^-BACK, F7-GL ENTRY, DRAWER ENTRY   :"
                                                          TO MESS.

      * 3/21/03 (WORLD) HEY, WE REALLY NEED TO TEST THE PASSWORD
      * DRAWER FLAG OF THE POSTING BRANCH IF DOING INTERBRANCH,
      * SO READ POSTING BRANCH THEN RESTORE OWNING BRANCH:

           IF PATH-MACHINE NOT = " "
              MOVE BRANCH TO BR-NO
              PERFORM OPEN-BR-FILE
              PERFORM READ-BR-FILE
              MOVE BR-PASSWORD-DRAWER TO SV-PASSWORD-DRAWER
              MOVE LN-OWNBR TO BR-NO
              PERFORM READ-BR-FILE
              PERFORM CLOSE-BR-FILE
           ELSE
              MOVE BR-PASSWORD-DRAWER TO SV-PASSWORD-DRAWER.

           IF SV-PASSWORD-DRAWER = "Y"
              INSPECT MESS REPLACING FIRST "ENTRY   :" BY "PASSWORD:"
           ELSE
              INSPECT MESS REPLACING FIRST "ENTRY   :" BY "NUMBER  :".
           PERFORM SEND-LEGEND.

           MOVE 0 TO CA-TILLNO.
           MOVE " " TO ROUTE-CD.

       ACCEPT-ENTER-TILLNO.
           MOVE LP-TRDATE TO CA-DATE.
           MOVE BRANCH    TO CA-BRNO.
           MOVE 0         TO CA-TILLNO.
           MOVE CA1-KEY TO HOLD-CA1-KEY.
           IF SV-PASSWORD-DRAWER = "Y"
              IF PATH-MACHINE NOT = " "
                 MOVE EXT-FILPATH-BASE TO CA-ALL-BASE
                 MOVE PATH-MACHINE TO CA-ALL-MACHINE
                 MOVE PATH-DATA TO CA-ALL-DATA
                 MOVE CA-ALL-PATH TO CA-PATH
                 MOVE "Y" TO CA-PATH-OVERRIDE
              END-IF
              PERFORM ENTER-CASH-DRAWER-PASSWORD
              IF CAPASSWD-OKAY = "N"
                 GO TO ACCEPT-ENTER-TILLNO
              END-IF
              IF CAPASSWD-OKAY = "V"
                 GO TO ACCEPT-CHECK-VDUSTATUS
              END-IF
              IF CAPASSWD-OKAY = "Y"
      *          MOVE "S  A010120." TO VDU
      *          MOVE CA-TILLNO TO NUMERIC-TILLNO
      *          PERFORM CONVERT-TILLNO-TO-ALPHA
      *          MOVE TEST-ALPHA-TILLNO TO VDUBUF
      * ADDED NEW FIELD "DRAWER" FOR 2 DIGIT DRAWER ENTRY
                 MOVE "SN N020DRAWER." TO VDU
                 MOVE CA-TILLNO TO VDUNUM0
                 PERFORM SCREENIO
              END-IF
           ELSE
      * ADDED NEW FIELD "DRAWER" SO WE CAN ENTER A 2 DIGIT DRAWER
              MOVE "EN N020DRAWER." TO VDU
              PERFORM SCREENIO.

       ACCEPT-CHECK-VDUSTATUS.
           IF VDUSTATUS = "10"
              MOVE 0 TO HOLD-LXM-MIP-CLPAID
                        HOLD-LXM-MIP-AHPAID
              PERFORM ACCEPT-SCREEN-RESET
              PERFORM DISPLAY-ENTRY-UP
              GO TO ACCEPT-ENTRY-EXIT.

      * FOR REVOLVING OR SP-CAL-RATETYPE(Z)  (F4):
           IF VDUSTATUS = "18"
              IF SP-CAL-RATETYPE(1) = "Z"
      * DISPLAY PAYMENT DISTRIBUTION AND ALLOW REDISTRIBUTION OF PAYMENT:
                 PERFORM SETUP-FOR-REALPY
                 GO TO ACCEPT-ENTRY-RTN
              ELSE
              GO TO ACCEPT-ENTRY-RTN.

           IF VDUSTATUS = "1U"
              IF (LP-TRCD = "PX")
                 GO TO ACCEPT-ENTRY-RTN
              ELSE
                 MOVE UP-ARROW-SEQ TO PASSWDW-SEQ
                 MOVE "TO ALLOW UP-ARROW BACK" TO PASSWDW-PROMPT2
                 PERFORM VERIFY-PASSWORD
                 IF PASSWDW-STAT NOT = "OK"
                    GO TO ACCEPT-ENTRY-RTN
                 ELSE
                    MOVE "S  A010120." TO VDU
                    PERFORM SCREENIO
                    GO TO ACCEPT-F4-RTN.

           GO TO ACCEPT-F4-BYPASS.
       ACCEPT-F4-RTN.
           MOVE LN-ACCERN(1) TO HOLD-LN-ACCERN(1).
           MOVE LN-ACCERN(2) TO HOLD-LN-ACCERN(2).
           MOVE LN-ACCERN(3) TO HOLD-LN-ACCERN(3).
           MOVE LN-ACCERN(4) TO HOLD-LN-ACCERN(4).
           MOVE LN-ACCERN(5) TO HOLD-LN-ACCERN(5).
           MOVE LN-ACCERN(6) TO HOLD-LN-ACCERN(6).
           MOVE LN-TOTERN     TO HOLD-LN-TOTERN.
           MOVE LN-TOTSERACCT TO HOLD-LN-TOTSERACCT.
           MOVE LN-TOTINT     TO HOLD-LN-TOTINT.
           MOVE LN-TOTDEF     TO HOLD-LN-TOTDFMNTS.
           MOVE LN-TOTLCHG    TO HOLD-LN-TOTLCHG.
           SUBTRACT LP-INTPAID FROM LN-YTDINTPD.
           ADD LP-APCUR TO LP-CURBAL.


           MOVE 1 TO F4-FLAG.
           IF DF-POSTING
              MOVE LN-INTBAL TO LP-INTBAL
              MOVE LN-LCBAL  TO LP-LCBAL
              SUBTRACT DEF-NODEF    FROM LN-TOTNODEF
              SUBTRACT DEF-NODEFACT FROM LN-TOTNODEFACT
           ELSE
      *JTG ADDED SAVE FOR RECALCULATE LCPDTH IF F4 ALTERED LN-LCBAL DISTRIBUTION
              MOVE LP-TRAMT TO SAVE-LP-TRAMT
              MOVE LP-APLC  TO SAVE-LP-APLC
              ADD LP-APLC TO LP-LCBAL
              IF SP-CAL-RATETYPE(1) = "Z"
                 SUBTRACT LCAP-OWE FROM LP-LCBAL
              ELSE
                 ADD LP-APINT TO LP-INTBAL
              END-IF.

      * WHEN 'SS' AND GP-DONT-COLL-INT-ON-SS = "Y"
      * ASSESS BUT DON'T APPLY TO INT AND LCHG REGACC #1684 #J027
      
           IF NOT ( LP-TRCD = "SS" AND
                    GP-DONT-COLL-INT-ON-SS = "Y"
                  )
              ADD LP-APOTH TO LP-OTHBAL.

           IF LP-TRCD = "PE" OR "SS" OR "IN"
              GO TO ACCEPT-F4-RTN-SKIP-PE.

      *  JTG 000523 CORRECTED NEW DEFERMENT FORMULA 97 INTDUE OR 1/3 OF REGPAY
           IF LP-TRCD NOT = "Z2"
              IF NOT DF-POSTING
                 SUBTRACT LP-APCUR     FROM LN-TOTPAYMNTD
                 SUBTRACT LP-APINT     FROM LN-TOTPAYMNTD
                 ADD LP-EXTRA-PRIN-LFP   TO LN-TOTPAYMNTD
                 SUBTRACT LP-EXTRA-PRIN-LFP FROM LN-TOTEXCPAYMNTD
                 IF LN-ESCROW-FG = "Y"
                    SUBTRACT ESCROW-AMT FROM LN-TOTPAYMNTD
                 END-IF
              END-IF
              IF SP-CONTRFRMLA = "A"
                 SUBTRACT LP-APLC FROM LN-TOTPAYMNTD.

       ACCEPT-F4-RTN-SKIP-PE.
           MOVE 1 TO BYPASS-AMT-ENT-FG.
           IF LXG-GLNO(1) NOT = 0
              PERFORM DISBURSE-OTHER-INIT
              PERFORM ACCEPT-SCREEN-RESET
              MOVE LP-REC TO WK-LP-REC
              PERFORM DISPLAY-ENTRY-UP
              MOVE WK-LP-REC TO LP-REC.
           MOVE "4" TO ROUTE-CD.
           GO TO ACCEPT-ENTRY-EXIT.

       ACCEPT-F4-BYPASS.
           IF LP-CURBAL = 0
              IF NOT ( LP-INTBAL = 0 AND
                       LP-LCBAL  = 0 AND
                       LP-OTHBAL = 0 AND
                       LP-OT2BAL = 0
                     )
                 PERFORM MUST-BE-ALL-ZERO
                 GO TO ACCEPT-ENTRY-RTN.
           IF LP-TRCD = "PN" OR "PZ"
              MOVE LP-TRAMT TO GL-WORK
           ELSE
              MOVE LP-APOTH TO GL-WORK.
           IF VDUSTATUS = "1>"
              GO TO ACCEPT-GL-DISBURSE.
           IF VDUSTATUS NOT = "00"
              GO TO ACCEPT-ENTRY-RTN.

      *    MOVE VDUBUF TO TEST-ALPHA-TILLNO.
      *    PERFORM CONVERT-TILLNO-TO-NUMERIC.
      *    MOVE NUMERIC-TILLNO TO CA-TILLNO LP-TILLNO.
           MOVE VDUNUM0 TO CA-TILLNO LP-TILLNO.

      * NO GL DISTRIBUTION
           IF GL-WORK = 0
              GO TO ACCEPT-ENTRY-CONT.
           IF LXG-GLNO(1) NOT = 0
              GO TO ACCEPT-ENTRY-CONT.

           IF CA-TILLNO NOT = 0
              PERFORM ALARM.

       ACCEPT-GL-DISBURSE.
           MOVE "Y" TO ALLENT-STATUS.
           PERFORM DISBURSE-OTHER-APPLIED.
           IF ALLENT-STATUS = "N"
              PERFORM DISBURSE-OTHER-INIT.
           GO TO ACCEPT-ENTRY-RTN.

       ACCEPT-ENTRY-CONT.
           IF PATH-MACHINE NOT = " "
              MOVE EXT-FILPATH-BASE TO CA-ALL-BASE
              MOVE PATH-MACHINE TO CA-ALL-MACHINE
              MOVE PATH-DATA TO CA-ALL-DATA
              MOVE CA-ALL-PATH TO CA-PATH
              MOVE "Y" TO CA-PATH-OVERRIDE.

           PERFORM OPEN-CA1-FILE.
           MOVE LP-TRDATE TO CA-DATE.
           MOVE BRANCH TO CA-BRNO.
           PERFORM READ-CA1-FILE.
           PERFORM CLOSE-CA1-FILE.
           IF IO-FG NOT = 0
              MOVE "INVALID CASH DRAWER #" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO ACCEPT-ENTRY-RTN.
           IF CA-CLOSED-HHMM NOT = 0
              MOVE "CASH DRAWER CLOSED" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO ACCEPT-ENTRY-RTN.

           IF LP-CURBAL = 0
              IF LP-OTHBAL = 0
               IF LP-OT2BAL = 0
                 IF LP-INTBAL = 0
                    IF LP-LCBAL = 0
                       MOVE "^-BACK, ENTER PAYOFF CODE:" TO MESS
                       PERFORM SEND-LEGEND
                       GO TO ACCEPT-PO-CODE.

      *    IF (GP-I-AM-REGACC AND BR-POFF-TITLE-WINDOW = "Y"
      *       AND LP-TRCD = "IN")
      *         MOVE LN-OWNBR  TO TITLE-LN-OWNBR
      *         MOVE LN-ACCTNO TO TITLE-LN-ACCTNO
      *          MOVE "Y" TO TITLE-FROM-LONPFA
      *           MOVE "WI/TITLEW" TO FORM-NAM
      *       CALL FORM-PROGX USING FORM-PATH TITLE-PROCESSING-BUF
      *       CANCEL FORM-PROGX
      * F1 FROM INSIDE TITLE PROCESSING IS TO CLEAR THE PAYOFF LINE
      *       IF TITLE-CLEAR-PAYOFF-LINE = "Y"
      *          PERFORM ACCEPT-SCREEN-RESET
      *          PERFORM DISPLAY-ENTRY-UP
      *          GO TO ACCEPT-ENTRY-EXIT.


           GO TO ACCEPT-ENTRY-EXIT.

       ACCEPT-PO-CODE.
      * DO NOT USE "RESET ON" IT WILL CLEAR CODE FROM SCAN.
           MOVE "ENNA060SEL." TO VDU.
           PERFORM SCREENIO.

           IF VDUSTATUS = "10" OR "1U"
              MOVE "SNNA060SEL." TO VDU
              MOVE SPACES TO VDUBUF
              PERFORM SCREENIO
              GO TO ACCEPT-ENTRY-RTN.
           IF VDUSTATUS = "1<"
              PERFORM CODE-SCAN
              MOVE CD-CODE TO HOLD-POCD
              GO TO ACCEPT-PO-CODE.
           IF VDUSTATUS NOT = "00"
              GO TO ACCEPT-PO-CODE.

           MOVE "PO"   TO CD-TYPE.
      * NEED TO LEFT JUSTIFY THE "SEL" FIELD 
           CALL "C$JUSTIFY" USING VDUBUF, "L".
           MOVE VDUBUF TO CD-CODE.
           IF CD-CODE = "**"
              GO TO ACCEPT-PO-CODE.

      * CLEAR SEL FIELD
           MOVE "SNNA060SEL." TO VDU.
           MOVE SPACES TO VDUBUF.
           PERFORM SCREENIO.

           PERFORM OPEN-CD1-FILE.
           PERFORM READ-CD1-FILE.
           PERFORM CLOSE-CD1-FILE.
           IF IO-FG NOT = 0
              MOVE "INVALID CODE" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO ACCEPT-PO-CODE.
           MOVE CD-CODE TO HOLD-POCD.
           GO TO ACCEPT-ENTRY-EXIT.

       ACCEPT-SCREEN-RESET.
           MOVE "Y" TO FULL-PAGE-FG.

           MOVE LN-OWNBR  TO LP-BRNO.
           MOVE LN-ACCTNO TO LP-ACCTNO.
           MOVE 99999     TO LP-SEQNO.
           MOVE LP1-KEY   TO HOLD2-KEY-UP.

           MOVE "7" TO ROUTE-CD.

       ACCEPT-ENTRY-EXIT.
           IF ROUTE-CD NOT = " "
              PERFORM CLEAR-LEGEND.

      ********************************************
       DISBURSE-OTHER-APPLIED SECTION.
      ********************************************
       DISBURSE-OTHER-INIT.
           MOVE 0 TO LXG-GLNO(1)  LXG-GLNO(2)  LXG-GLNO(3)
                     LXG-GLAMT(1) LXG-GLAMT(2) LXG-GLAMT(3).
       DISBURSE-GLNO-ENTRY.
           MOVE GL-WORK TO ALLENT-DISBURSE.
           MOVE LN-OWNBR TO ALLENT-BRNO.
           MOVE BR-OTHER-BRANCH-GL TO ALLENT-OTHER-BR-FG.
           MOVE BR-GL-TYPE-ALLOWED TO ALLENT-GL-TYPE-ALLOWED.
           MOVE BR-GL-ENTRY-DEFAULT TO ALLENT-GL-ENTRY-DEFAULT.
           MOVE 3 TO ALLENT-NO-OF-ACCTS.
           MOVE "GL/ALLENT" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH ALLENT-BUF.
           CANCEL FORM-PROGX.
           IF ALLENT-STATUS = "N"
              GO TO DISBURSE-OTHER-EXIT.
           MOVE 1 TO SUB.
       MOVE-GL-LOOP.
           MOVE ALLENT-BR-ACCOUNT(SUB) TO LXG-GLNO(SUB).
           MOVE ALLENT-AMT(SUB) TO LXG-GLAMT(SUB).
           IF SUB NOT = 3
              ADD 1 TO SUB
              GO TO MOVE-GL-LOOP.
       DISBURSE-TOTAL-VERIFY.
           COMPUTE VDUNUM2 = LXG-GLAMT(1) + LXG-GLAMT(2) + LXG-GLAMT(3).
           IF GL-WORK = VDUNUM2
              GO TO DISBURSE-OTHER-EXIT.
           MOVE "OUT-OF-BALANCE ENTRY" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       DISBURSE-OTHER-EXIT.
           EXIT.

      **************************************************
       DISPLAY-ENTRY-DOWN SECTION.
      **************************************************
           MOVE SPACES TO LINE-BUF LN-BUF.
           MOVE 0 TO LN-WK.
           MOVE HOLD1-KEY-DOWN TO LP1-KEY.
           IF LP-SEQNO = 99999
              MOVE 9 TO IO-FG
              GO TO DISPLAY-DOWN-EXIT.

      * ***NOTE*** 'START-LP1-FILE-SCAN' MUST BE USED WHEN FIRST USING
      * 'START-LP1-FILE-NOT-GREATER'; USED WHEN DISPLAYING MULTIPLE
      * PAGES IN AN UP & DOWN FUNCTION; YOU NEED TO ADD ONE TO 
      * LP-SEQNO (IN WBEG) IN ORDER TO GET THE DISPLAY TO WORK
      * LIKE VISION FILES.
      
           MOVE LP1-KEY TO HOLD2-KEY-UP.
           PERFORM OPEN-LP1-FILE.
           PERFORM READ-LP1-FILE.
           IF IO-FG NOT = 0
              MOVE LP-PATH-OWNBR TO QLP1-WBEG-BRNO
                                    QLP1-WEND-BRNO
              MOVE LP-ACCTNO     TO QLP1-WBEG-ACCTNO
                                    QLP1-WEND-ACCTNO
              COMPUTE QLP1-WBEG-SEQNO = LP-SEQNO + 1
              MOVE ALL "9"       TO QLP1-WEND-SEQNO
      *-   -   -{ ADD ONE TO WHERE SCAN BEG FIELDS }
              IF ( LP-BRNO = 9999 )
                 MOVE LP-BRNO    TO QLP1-WSBEG-BRNO
              ELSE
                 COMPUTE QLP1-WSBEG-BRNO = LP-BRNO + 1
              END-IF
   
              IF ( LP-ACCTNO = 99999999 )
                 MOVE LP-ACCTNO  TO QLP1-WSBEG-ACCTNO
              ELSE
                 COMPUTE QLP1-WSBEG-ACCTNO = LP-ACCTNO + 1
              END-IF

              PERFORM START-LP1-FILE-SCAN.

           MOVE 0 TO ENTRY-FLAG.
       DISPLAY-NEXT-DOWN.
           IF ENTRY-FLAG = 2
              MOVE 9 TO IO-FG
              GO TO DISPLAY-BYPASS-DOWN.
           PERFORM READ-LP1-FILE-NEXT.
           IF IO-FG = 0
              IF (LP-ACCTNO NOT = LN-ACCTNO) OR
                   (LP-BRNO NOT = LP-PATH-OWNBR)
                 ADD 1 TO ENTRY-FLAG
                 GO TO DISPLAY-NEXT-DOWN.
       DISPLAY-BYPASS-DOWN.
           ADD 1 TO LN-WK.
           IF IO-FG = 0
              PERFORM SETUP-LINE.
           MOVE LN-BUF TO D-LINE(LN-WK).
           MOVE SPACE TO LN-BUF.
           IF LN-WK = 8
              GO TO DISPLAY-XFER-DOWN.
           IF IO-FG = 0
              GO TO DISPLAY-NEXT-DOWN.
           IF FULL-PAGE-FG = "Y"
              MOVE "N" TO FULL-PAGE-FG
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 99999     TO LP-SEQNO
              MOVE LP1-KEY   TO HOLD2-KEY-UP
              PERFORM DISPLAY-ENTRY-UP
              GO TO DISPLAY-DOWN-EXIT.
       DISPLAY-XFER-DOWN.
           PERFORM DISPLAY-ALL-LINES.
       DISPLAY-DOWN-EXIT.
           IF IO-FG = 0
              MOVE "Y" TO FULL-PAGE-FG
              MOVE LP1-KEY TO HOLD1-KEY-DOWN
           ELSE
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 99999     TO LP-SEQNO
              MOVE LP1-KEY TO HOLD1-KEY-DOWN.

           PERFORM CLOSE-LP1-FILE.

      *************************************************
       DISPLAY-ENTRY-UP SECTION.
      *************************************************
           MOVE LP-REC TO WK-LP-REC.

      * SAVE AND CLEAR HOLD MIP FIELDS PRIOR TO DISPLAY REGENCY #402:
           MOVE HOLD-LXM-MIP-CLPAID TO SAVE-HOLD-LXM-MIP-CLPAID.
           MOVE HOLD-LXM-MIP-AHPAID TO SAVE-HOLD-LXM-MIP-AHPAID.
           MOVE 0                   TO HOLD-LXM-MIP-CLPAID
                                       HOLD-LXM-MIP-AHPAID.

           MOVE SPACES TO LINE-BUF LN-BUF.
           MOVE 9 TO LN-WK.
           MOVE HOLD2-KEY-UP TO LP1-KEY.
           IF LP-SEQNO = 0
              MOVE 9 TO IO-FG
              GO TO DISPLAY-UP-EXIT.
           MOVE LP1-KEY TO HOLD1-KEY-DOWN.
           PERFORM OPEN-LP1-FILE.

           MOVE LP-PATH-OWNBR TO QLP1-WBEG-BRNO
                                 QLP1-WEND-BRNO.
           MOVE LP-ACCTNO     TO QLP1-WBEG-ACCTNO
                                 QLP1-WEND-ACCTNO.
           MOVE ALL "0"       TO QLP1-WBEG-SEQNO.
           MOVE LP-SEQNO      TO QLP1-WEND-SEQNO.

           PERFORM START-LP1-FILE-NOT-GREATER.
           MOVE 0 TO ENTRY-FLAG.

       DISPLAY-NEXT-UP.
           IF ENTRY-FLAG = 2
              MOVE 9 TO IO-FG
              GO TO DISPLAY-BYPASS-UP.
           PERFORM READ-LP1-FILE-PREVIOUS.
           IF IO-FG = 0
              IF (LP-ACCTNO NOT = LN-ACCTNO) OR
                   (LP-BRNO NOT = LP-PATH-OWNBR)
                 ADD 1 TO ENTRY-FLAG
                 GO TO DISPLAY-NEXT-UP.
       DISPLAY-BYPASS-UP.
           SUBTRACT 1 FROM LN-WK.
           IF LN-WK < 1
              MOVE "Y" TO FULL-PAGE-FG
              GO TO DISPLAY-XFER-UP.
           IF IO-FG = 0
              PERFORM SETUP-LINE.
           MOVE LN-BUF TO D-LINE(LN-WK).
           MOVE SPACE TO LN-BUF.
           IF IO-FG = 0
              GO TO DISPLAY-NEXT-UP.
           IF FULL-PAGE-FG = "Y"
              MOVE "N" TO FULL-PAGE-FG
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 0         TO LP-SEQNO
              MOVE LP1-KEY TO HOLD1-KEY-DOWN
              PERFORM DISPLAY-ENTRY-DOWN
              GO TO DISPLAY-UP-EXIT.
       DISPLAY-XFER-UP.
           PERFORM DISPLAY-ALL-LINES.
       DISPLAY-UP-EXIT.
           IF IO-FG = 0
              MOVE "Y" TO FULL-PAGE-FG
              MOVE LP1-KEY TO HOLD2-KEY-UP
           ELSE
              MOVE LN-OWNBR  TO LP-BRNO
              MOVE LN-ACCTNO TO LP-ACCTNO
              MOVE 0         TO LP-SEQNO
              MOVE LP1-KEY TO HOLD2-KEY-UP.
           PERFORM CLOSE-LP1-FILE.
           MOVE WK-LP-REC TO LP-REC.
      * RESTORE HOLD MIP FIELDS AFTER DISPLAY RE: REGENCY #402:
           MOVE SAVE-HOLD-LXM-MIP-CLPAID TO HOLD-LXM-MIP-CLPAID.
           MOVE SAVE-HOLD-LXM-MIP-AHPAID TO HOLD-LXM-MIP-AHPAID.

      *********************************
       SETUP-LINE SECTION.
      *********************************
           MOVE SPACES TO LN-BUF ENTRY-BUF.
           MOVE LP-PAYDATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-MMDDYY.
           MOVE DATE-MMDDYY TO L-010 EB-010.
           MOVE LP-TRCD TO L-020 EB-020.
           MOVE LP-REFNO TO L-030 EB-030.
           IF LP-TRCD = "JD" OR "AC" OR "IR"
              MOVE LP-NEWSTAT-RATE TO L-040RATE EB-040RATE
           ELSE
              IF (LN-MIP-FG    = "Y") AND
                 LP-TRCD       = "PY" OR "PA" OR "PE" OR "PR" OR "IN"
                                     OR "PC" OR "PP" OR "SS"
                                     OR "AH" OR "PX" OR "PN"
                                     OR "PZ"
                 COMPUTE L-040 EB-040 =
                         LP-TRAMT + HOLD-LXM-MIP-CLPAID
                                  + HOLD-LXM-MIP-AHPAID
              ELSE
                 MOVE LP-TRAMT TO L-040 EB-040
              END-IF.

           IF (  (LP-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO")
                 OR ( (LP-TRCD = "RV") AND
                       (LP-REVTRCD = "PB" OR "RN" OR "SC"
                                            OR "RB" OR "RO")
                    )
              )  AND (LP-APOT2 NOT = 0)
              ADD LP-APOTH LP-APOT2 GIVING L-050 EB-050
              INSPECT L-050 REPLACING TRAILING " " BY "*"
              INSPECT EB-050 REPLACING TRAILING " " BY "*"
           ELSE
           IF LP-TRCD NOT = "Z2" AND NOT = "O2"
              MOVE LP-APOTH TO L-050 EB-050
           ELSE
              MOVE LP-APOT2 TO L-050 EB-050.
           ADD LP-APINT LP-APLC GIVING L-060 EB-060.
           MOVE LP-APCUR TO L-070 EB-070.

      * 7/30/98 BAH ALWAYS DISPLAY REVERSAL BALANCES, #487
      * 8/11/98 SUPPRESS BALANCE IF ENV 'RVLINES' IS SET (MJD AS PER JTG)
      
           IF (LP-TRCD = "RV" OR LP-REV NOT = " ") AND
               NOT (LP-TRCD = "RV" AND LP-REVSEQNO = 0) AND
                   DISP-REV-BAL = "N"
              MOVE "*" TO L-120 EB-120
           ELSE
              MOVE LP-PDTH-DATE TO NUM-DATE
              MOVE NUM-MO TO EB-080-MO
              IF LN-UNITPER-CD-DAYS
                 MOVE NUM-DA TO EB-080-DAYR
              ELSE
                 MOVE NUM-YR TO EB-080-DAYR
              END-IF
              ADD LP-OTHBAL LP-OT2BAL GIVING EB-090
              ADD LP-INTBAL LP-LCBAL GIVING EB-100
              MOVE LP-CURBAL TO EB-110
              MOVE EB-080 TO L-080
              ADD LP-OTHBAL LP-OT2BAL GIVING L-090
              ADD LP-INTBAL LP-LCBAL GIVING L-100
              MOVE LP-CURBAL TO L-110
              IF (LP-TRCD = "RV" OR LP-REV NOT = SPACES) AND
                 NOT (LP-TRCD = "RV" AND LP-REVSEQNO=0)
                 MOVE "*" TO L-120 EB-120.
       END-SETUP-LINE.
           EXIT.

      *************************************
       SAVE-SCREEN SECTION.
      *************************************
           MOVE 3 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.
           IF VDUSTATUS = "16"
              IF WK-OLD-PROG-FORM = " "
                 MOVE 99 TO MENU-FG
                 GO TO EXIT-SAVE-SCREEN
              ELSE
                 MOVE WK-OLD-PROG-FORM TO NEW-PROG-FORM OLD-PROG-FORM
                 MOVE " " TO WK-OLD-PROG-FORM.
           MOVE ELE TO WK-ELE.
      *    MOVE LN-REC TO WK-SAVE-RECORD.

           IF LN-MIP-FG = "Y"
              IF LN-ESCROW-FG = "Y"
                 MOVE ORIG-LP-TRAMT TO LP-TRAMT
              ELSE
                 ADD HOLD-LXM-MIP-CLPAID HOLD-LXM-MIP-AHPAID
                                                 TO LP-TRAMT.

           MOVE LP-REC  TO WK-LP-REC.
           MOVE LX-REC  TO WK-LX-REC.
           MOVE LXE-REC TO WK-LXE-REC.
           MOVE LXG-REC TO WK-LXG-REC.
           PERFORM REWRITE-WK-FILE.
       EXIT-SAVE-SCREEN.
           PERFORM CLOSE-WK-FILE.

      ***************************************
       RESTORE-SCREEN SECTION.
      ***************************************
           MOVE 3 TO WK-KEY.
           PERFORM OPEN-WK-FILE.
           PERFORM READ-WK-FILE.
           IF NEW-FORM NOT = OLD-FORM
              MOVE OLD-PROG-FORM TO WK-OLD-PROG-FORM
              MOVE NEW-PROG-FORM TO OLD-PROG-FORM.

           IF IO-FG = 0
              GO TO RESTORE-CLEAR.

           MOVE SPACES TO WK-SAVE-RECORD.

           MOVE 0      TO WK-ELE.
           PERFORM WRITE-WK-FILE.
           IF IO-FG = 9
              GO TO IO-ERROR.

           GO TO EXIT-RESTORE-SCREEN.
       RESTORE-CLEAR.
      D    STOP MESS.
           MOVE WK-SAVE-RECORD TO LN-REC.
           MOVE WK-LP-REC      TO LP-REC.
           MOVE WK-LX-REC      TO LX-REC.
           MOVE WK-LXE-REC     TO LXE-REC.
           MOVE WK-LXG-REC     TO LXG-REC.
           MOVE 0 TO WK-ELE.
           PERFORM REWRITE-WK-FILE.
       EXIT-RESTORE-SCREEN.
           PERFORM CLOSE-WK-FILE.

      ****************************************
       TEST-DLR-RESERVES SECTION.
      ****************************************
           MOVE " " TO ROUTE-CD.
           PERFORM OPEN-DS1-FILE.
           MOVE TRANS-DATE TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.
           MOVE DATE-YYYYMM TO DS-DATE-CCYYMM.
           MOVE LN-OWNBR TO DS-BRANCH
           IF LP-DLNO = 0
              MOVE LN-DLNO TO DS-DLNO
           ELSE
              MOVE LP-DLNO TO DS-DLNO.
           MOVE LN-CLASS TO DS-CLASS.
           PERFORM READ-DS1-FILE.
           PERFORM CLOSE-DS1-FILE.
           IF IO-FG NOT = 0
              MOVE "7" TO ROUTE-CD
              MOVE "PROBLEM GETTING DEALER RESERVE BALANCES" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO EXIT-TEST-DLR-RESERVE.

           MOVE LP-REFNO TO LPWSLP-LP-REFNO.
           IF LP-TRCD = "PR"
              IF LP-TRAMT > DS-DLRVPRIN(LPWSLP-LP-DLRVNO)
                 PERFORM INSUFF-RSV-PRIN
              ELSE
                 GO TO EXIT-TEST-DLR-RESERVE.
           IF LP-TRCD = "PC"
              IF LP-TRAMT > DS-DLRVCHGS(LPWSLP-LP-DLRVNO)
                 PERFORM INSUFF-RSV-CHGS
              ELSE
                 GO TO EXIT-TEST-DLR-RESERVE.
           IF LP-TRCD = "PP"
              IF LP-TRAMT > DS-DLPARVHELD
                 PERFORM INSUFF-RSV-CHGS
              ELSE
                 GO TO EXIT-TEST-DLR-RESERVE.

      * IF THE BRANCH FLAG IS NOT 'Y' THEN THEY DONT WANT
      * TO BE ASKED THE QUESTION TO OVERRIDE
           IF BR-NEGDLRSV NOT = "Y"
              MOVE "THE RESERVE WOULD BE NEGATIVE!!" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              MOVE "7" TO ROUTE-CD
              GO TO EXIT-TEST-DLR-RESERVE.
           MOVE SPACES TO MESS.
           PERFORM SEND-LEGEND.
       TEST-DLR-QUESTION.
           MOVE "ACCEPT NEGATIVE RESERVE AMOUNT (Y/N):" TO MESS.
           PERFORM SEND-LEGEND.
           MOVE "E RA060SEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS NOT = "00"
              GO TO TEST-DLR-QUESTION.
           MOVE VDUBUF TO DLR-TEST.
           IF DLR-ANSWER = "Y"
              GO TO EXIT-TEST-DLR-RESERVE.
           IF DLR-ANSWER NOT = "N"
              GO TO TEST-DLR-QUESTION.
           MOVE "7" TO ROUTE-CD.
       EXIT-TEST-DLR-RESERVE.
           IF ROUTE-CD = "7"
              PERFORM ACCEPT-SCREEN-RESET
              PERFORM DISPLAY-ENTRY-UP.

      ******************************************
       SV-EARNED-PRINCIPAL SECTION.
      ******************************************
           IF DL-SVACCT-FRMLA = 0
              COMPUTE LP-EARNED(1) ROUNDED = LP-APCUR *
                           SV-RATE + DL-SVACCT-AMT
              GO TO EXIT-SV-EARNED-PRINCIPAL.

           IF DL-SVACCT-FRMLA NOT = 1
              GO TO EXIT-SV-EARNED-PRINCIPAL.

      * SERVICE FORMULA #1:
      * IF WHAT PAID IS OVER THE $20
           IF ORIG-TOTPAYMNTD > DL-SVACCT-AMT
              COMPUTE LP-EARNED(1) ROUNDED =
                                   LP-TRAMT * SV-RATE
              GO TO EXIT-SV-EARNED-PRINCIPAL.

           COMPUTE SV-WORKER = DL-SVACCT-AMT - ORIG-TOTPAYMNTD.
           IF LP-TRAMT NOT > SV-WORKER
              MOVE LP-TRAMT TO LP-EARNED(1)
           ELSE
              COMPUTE LP-EARNED(1) ROUNDED = SV-WORKER +
                       (LP-TRAMT - SV-WORKER) * SV-RATE.

       EXIT-SV-EARNED-PRINCIPAL.

      *************************************
       SET-BAL-IBPC-LPREC SECTION.
      *************************************
           MOVE LN-OTHBAL TO LP-OTHBAL.
           MOVE LN-OT2BAL TO LP-OT2BAL.
           MOVE LN-INTBAL TO LP-INTBAL.
           MOVE LN-LCBAL TO LP-LCBAL.
           MOVE LN-CURBAL TO LP-CURBAL.

           MOVE LP-PAYDATE TO IBPC-DATE.
           PERFORM IBPC-TEST.
           MOVE IBPC-FG TO LP-IBPC.

      *************************************
       DISBURSE-LCBAL SECTION.
      *************************************
           MOVE SPACES TO RTN-FG.
           IF LP-LCBAL NOT > HOLD-LP-TRAMT
              MOVE LP-LCBAL TO LP-APLC
              SUBTRACT LP-LCBAL FROM HOLD-LP-TRAMT
              MOVE 0 TO LP-LCBAL
           ELSE
              MOVE HOLD-LP-TRAMT TO LP-APLC
              SUBTRACT HOLD-LP-TRAMT FROM LP-LCBAL

              MOVE 0 TO LP-APCUR LP-APINT HOLD-LP-TRAMT.

      *************************************
       DISBURSE-INTBAL SECTION.
      *************************************
           MOVE SPACES TO RTN-FG.
           IF LP-INTBAL NOT > HOLD-LP-TRAMT
              MOVE LP-INTBAL TO LP-APINT
              SUBTRACT LP-INTBAL FROM HOLD-LP-TRAMT
              MOVE 0 TO LP-INTBAL
           ELSE
              MOVE HOLD-LP-TRAMT TO LP-APINT
              SUBTRACT HOLD-LP-TRAMT FROM LP-INTBAL
              MOVE 0 TO LP-APCUR HOLD-LP-TRAMT.

      *************************************
       SETUP-LCHGS SECTION.
      *************************************
           IF F4-FLAG = 1 AND LN-LCBAL = 0
              MOVE 0 TO LP-APLC
              MOVE 0 TO F4-FLAG.

           IF SP-LCFRMLA NOT = " "
              IF (LP-TRCD = "PE" OR "SS" OR "IN") OR
                 (HOLD-BP-TRCD = "Z2"   )
                 MOVE "AL" TO LCAP-LPTRCD
              ELSE
                 MOVE LP-TRCD TO LCAP-LPTRCD.
           IF SP-LCFRMLA NOT = " "
              MOVE HOLD-LP-TRAMT     TO LCAP-TRAMT
              IF LN-ESCROW-FG = "Y"
                 ADD ESCROW-AMT TO LCAP-TRAMT
              END-IF
              MOVE LP-PAYDATE        TO LCAP-PAYDATE
              MOVE LN-1STPYDATE      TO LCAP-1STPYDATE
              MOVE LP-APLC           TO LCAP-LPAPLC
              MOVE LP-APINT          TO LCAP-LPAPINT
              MOVE BATCH-REFCD       TO LCAP-BATCH-REFCD
              MOVE BATCH-REFCD-LC-FG TO LCAP-BATCH-REFCD-LC-FG
              PERFORM LATE-CHARGE-APPLY
              IF HOLD-BP-TRCD = "Z2"
                 ADD LCAP-APP        TO LCAP-OWE
                 MOVE 0              TO LCAP-APP
              ELSE
                 PERFORM TEST-FOR-PE-AL
              END-IF
              SUBTRACT LCAP-APP FROM HOLD-LP-TRAMT
              MOVE LCAP-PARTIALS     TO HOLD-PARTIALS
              MOVE LCAP-LCPAID       TO HOLD-LCPAID
              ADD LCAP-APP           TO LP-APLC
              ADD LCAP-OWE           TO LP-LCBAL
              ADD LCAP-APP LCAP-OWE GIVING SAVE-LCAP-APP-OWE
              MOVE LCAP-NOLCHG       TO LP-NOLCHG
              MOVE LCAP-LCPDTH-DATE  TO LP-LCPDTH-DATE.

      * WHEN 'SS' AND GP-DONT-COLL-INT-ON-SS = "Y"
      * ASSESS BUT DON'T APPLY TO INT AND LCHG REGACC #1684
           IF (LP-TRCD = "Z2") OR
              ( LP-TRCD = "SS" AND GP-DONT-COLL-INT-ON-SS = "Y" )
                 COMPUTE LP-LCBAL = LP-LCBAL + LP-APLC
                 ADD LCAP-APP TO HOLD-LP-TRAMT
                 MOVE 0 TO LP-APLC HOLD-LCPAID.

      ****************************************************
       SETUP-AFPDLLP SECTION.
      ****************************************************
           IF LN-PLCD = " "
              IF LP-TRCD = "PY" OR "PA" OR "PE" OR "SS" OR "IN"
                                OR "AH" OR "PN" OR "PZ"
                 MOVE LN-DLNO TO DL-DLNO
                 PERFORM GET-DL
                 IF IO-FG = 0 AND DL-AFP-DEALER = "Y"
                    MOVE LP-TRDATE TO AFPDLLP-TODAY
                    PERFORM AFPDLLP
                    MOVE AFPDLLP-DUE-DEALER TO HOLD-AFPDLLP.


      *************************************
       SETUP-INTEREST SECTION.
      *************************************
           IF INDU-INTEREST NOT > HOLD-LP-TRAMT
              SUBTRACT INDU-INTEREST FROM HOLD-LP-TRAMT
              ADD INDU-INTEREST TO LP-APINT
           ELSE
              ADD HOLD-LP-TRAMT TO LP-APINT
              COMPUTE LP-INTBAL =
                 LP-INTBAL + INDU-INTEREST - HOLD-LP-TRAMT.


      *************************************
       SETUP-PRIN-PAYMNTD SECTION.
      *************************************
           IF SP-CAL-RATETYPE(1) NOT = "Z"
              SUBTRACT LP-APCUR FROM LP-CURBAL.

           IF LP-TRCD = "PE" OR "SS" OR "PX" OR "IN"
              GO TO SETUP-PRIN-PAYMNTD-EXIT.

           IF SP-CAL-RATETYPE(1) NOT = "Z"
              IF LP-TRCD NOT = "Z2"
                 IF NOT DF-POSTING
                    ADD LP-APCUR TO LN-TOTPAYMNTD
                    ADD LP-APINT TO LN-TOTPAYMNTD
                     IF LN-ESCROW-FG = "Y"
                        ADD ESCROW-AMT TO LN-TOTPAYMNTD
                     END-IF
                 END-IF
                 IF SP-CONTRFRMLA = "A"
                    ADD LP-APLC TO LN-TOTPAYMNTD.

       SETUP-PRIN-PAYMNTD-EXIT.
           EXIT.

      *************************************
       SETUP-PDTH-LPREC SECTION.
      *************************************
      * COMPUTE PAID THRU DATE
           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.
           PERFORM PAID-THRU-CALCULATION.
           MOVE PDTH-DATE-FULL TO LP-PDTH-DATE.
           MOVE PDTH-PAYS TO HOLD-PERIODS-PAIDTHRU.

      *************************************
       SETUP-CERN-LPREC SECTION.
      *************************************
           MOVE LP-APCUR        TO CERN-APCUR.
           MOVE LP-APINT        TO CERN-APINT.
           MOVE LP-APLC         TO CERN-APLC.
           MOVE LP-PAYDATE      TO CERN-PAYDATE.
           ADD  ORIG-TOTPAYMNTD ORIG-TOTEXCPAYMNTD GIVING CERN-PAYMNTD.
           MOVE ORIG-TOTLCHG    TO CERN-TOTLCHG.
           MOVE LP-TRCD         TO CERN-TRCD.

           MOVE ORIG-TOTINT     TO CERN-TOTINT.
           MOVE LP-CURBAL       TO CERN-PRINBAL.
           MOVE 0               TO CERN.
           PERFORM COMPUTE-CERNINGS.

           MOVE CERN-EARNINGS-OWING TO HOLD-EARNINGS-IB-OWING.
           MOVE CERN-EARNINGS-ERNINT TO HOLD-EARNINGS-IB-ERNINT
      *                                 WK-LXE-WORKER2.
                                        LXE-WORKER2.
           IF SP-ERNFRMLA(1) = 15
              ADD CERN-EARNINGS(1) CERN-EARNINGS(5)
                                      GIVING HOLD-EARNINGS-IB
           ELSE
              MOVE CERN-EARNINGS(5) TO HOLD-EARNINGS-IB.

           PERFORM SET-LP-EARNED.

           ADD LP-EARNED(1) LP-EARNED(2) LP-EARNED(3)
               LXE-EARN(1)  LXE-EARN(2)  LXE-EARN(3)
                                         TO HOLD-LN-TOTERN.

      *************************************
       SETUP-INTPAID-LPREC SECTION.
      *************************************
           PERFORM COMPUTE-BW-INTPAID.
           MOVE BWIN-INTPAID TO LP-INTPAID.
           ADD LP-INTPAID TO LN-YTDINTPD.

      *************************************
       SETUP-DLPROC-LPREC SECTION.
      *************************************
           MOVE LN-DLNO TO DL-DLNO.
           PERFORM GET-DL.
           IF IO-FG NOT = 0
              IF HOLD-BP-TRCD = " "
                 PERFORM FILE-ERRORS
                 PERFORM CONDITIONAL-SEND-MESS
                 MOVE "7" TO ROUTE-CD
                 GO TO SETUP-DLPROC-LPREC-EXIT
              ELSE
                 MOVE 0 TO LP-EARNED(1) LP-EARNED(2)
                                        LP-EARNED(3)
                 GO TO SETUP-DLPROC-LPREC-EXIT.

      *
      *  DL-SVACCT-LCHGPER AND DL-SVACCT-INTPER ARE % FINANCE CO. KEEPS
      *  DL-SVACCT-DEFPER IS % OF DEFERMENT CHARGE FINANCE CO. KEEPS
      *  DL-SVACCT-RATE IS % OF APCUR FINANCE CO. GETS FOR SERVICING
      *
      * # 2756 UNION FINANCE NEEDED DECIMAL PERCENTS

      * EARNED DEFERMENTS
           MOVE 0 TO HOLD-DF-EARNED.
           IF DF-POSTING
              COMPUTE LP-EARNED(1) ROUNDED = LP-APINT *
                                         DL-SVACCT-DEFPER / 100
              ADD LP-EARNED(1) TO HOLD-LN-TOTERN HOLD-LN-TOTSERACCT
                                  HOLD-DF-EARNED
      * PACESETTER DEFERMENT MUST SETUP EARNED PRINCIPAL AND LCHG
              IF SP-DEFFRMLA NOT = 8
                 GO TO SETUP-DLPROC-LPREC-COMPUTE.

      * EARNED PRINCIPAL
           IF LN-SERVPER = 999.99
              COMPUTE SV-RATE ROUNDED = DL-SVACCT-RATE / 100
           ELSE
              COMPUTE SV-RATE ROUNDED = LN-SERVPER / 100.

           PERFORM SV-EARNED-PRINCIPAL.

      * WILL THIS WORK FOR PROSOURCE ???????????????????
           IF LN-SERVACCT = "Y"
                  AND DL-SVACCT-FRMLA = 1
              NEXT SENTENCE
           ELSE
              IF LP-EARNED(1) > LP-APCUR
                 MOVE LP-APCUR TO LP-EARNED(1).

           ADD LP-EARNED(1) TO HOLD-LN-TOTERN HOLD-LN-TOTSERACCT.

      * EARNED INTEREST
           COMPUTE LP-EARNED(2) ROUNDED =
                          LP-APINT * DL-SVACCT-INTPER / 100.
           ADD LP-EARNED(2) TO HOLD-LN-TOTERN HOLD-LN-TOTSERACCT.

      * EARNED LCHG
           COMPUTE LP-EARNED(3) ROUNDED =
                          LP-APLC * DL-SVACCT-LCHGPER / 100.
           ADD LP-EARNED(3) TO HOLD-LN-TOTERN HOLD-LN-TOTSERACCT.

      * PACESETTER DEFFRMLA = 8, NEED EARNED PRINCIPAL AND LCHG
      *    DEFERMENT (1)
      *    PRINCIPAL (2)
      *    LCHG      (3)
      * DO NOT NEED INTEREST (DF AMOUNT)
           IF DF-POSTING
              IF SP-DEFFRMLA = 8
                 MOVE LP-EARNED(1) TO LP-EARNED(2)
                 MOVE HOLD-DF-EARNED TO LP-EARNED(1).

      * DEALERS PROCEEDS
       SETUP-DLPROC-LPREC-COMPUTE.
           COMPUTE LP-DLPROC ROUNDED =
               (LP-APCUR + LP-APINT + LP-APLC)
                 - LP-EARNED(1) - LP-EARNED(2)
                  - LP-EARNED(3).
       SETUP-DLPROC-LPREC-EXIT.
           EXIT.

      *************************************
       SETUP-INT-LC-LPREC SECTION.
      *************************************
           IF SP-CAL-RATETYPE(1) = "Z"
              MOVE 0             TO LP-INTDUE
           ELSE
              MOVE INDU-INTEREST TO LP-INTDUE.
           ADD SAVE-LCAP-APP-OWE TO LP-APINTOWE.

           MOVE "3" TO ROUTE-CD.
           MOVE 2 TO NEW-PROG-SUB.

      *******************************************************
       VERIFY-PASSWORD SECTION.
      *******************************************************
           MOVE " " TO PASSWDW-STAT.
           MOVE "LONPFC" TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           MOVE "CL/PASSWD" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.

      *******************************************************
       PASSWORD-MUST-EXIST SECTION.
      *******************************************************
           MOVE "EX" TO PASSWDW-STAT.
           MOVE "LONPFC" TO PASSWDW-PGM.
           MOVE "PLEASE ENTER THE PASSWORD," TO PASSWDW-PROMPT1.
           MOVE "CL/PASSWD" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH PASSWDW-BUF.
           CANCEL FORM-PROGX.

      *******************************************************
       CODE-SCAN SECTION.
      *******************************************************

           MOVE "PO"   TO CDSCAN-TYPE.
           MOVE SPACES TO CDSCAN-CODE.

           MOVE "WI/CDSCAN" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH CDSCAN-BUF EXIT-PATHNAME.
           CANCEL FORM-PROGX.
           IF CDSCAN-STATUS NOT = "00" OR CDSCAN-CODE = SPACES
               MOVE 9 TO IO-FG
               GO TO EXIT-CODE-SCAN.

           MOVE "SNNA060SEL."  TO VDU.
           MOVE CDSCAN-CODE TO VDUBUF.
           PERFORM SCREENIO.

           MOVE CDSCAN-CODE TO CD-CODE.
           MOVE 0 TO IO-FG.

       EXIT-CODE-SCAN.
           EXIT.

      *********************************
       AUCTION-EXPENSE-WINDOW SECTION.
      *********************************
           MOVE " " TO ROUTE-CD.
           MOVE 9 TO WINDOW-LINES.
           MOVE 24 TO WINDOW-COLUMNS.
           MOVE 9 TO WINDOW-BEGIN-Y.
           MOVE 29 TO WINDOW-BEGIN-X.
           MOVE "AUCTIN" TO VDU-FORM-NAME.
           MOVE "WI/AUCTIN" TO WINDOW-FORM-NAM.

           PERFORM OPEN-WINDOW.
           DISPLAY AUCTIN-SCREEN.

           MOVE AUCTIN-FORM-FIELDS TO WR-BUF.
           MOVE AUCTIN-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.

       AUCTION-EXPENSE-ENTER.
           MOVE "E NS052010." TO VDU.
           PERFORM SCREENIO.
           IF VDUSTATUS = "1>"
              MOVE "7" TO ROUTE-CD
              GO TO EXIT-AUCTION-EXPENSE-WINDOW.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO AUCTION-EXPENSE-ENTER.

           MOVE VDUNUM2 TO HOLD-REPO-AUCTION-EXP.
           IF HOLD-REPO-AUCTION-EXP = 0
              MOVE REPO-EXP-SEQ TO PASSWDW-SEQ
              MOVE "TO ENTER 0" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 GO TO AUCTION-EXPENSE-ENTER.

       EXIT-AUCTION-EXPENSE-WINDOW.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY AUCTIN-SCREEN.
           PERFORM CLOSE-WINDOW.
           MOVE "LONPF" TO VDU-FORM-NAME.

      *******************************************************
       CALL-REPO-WINDOW SECTION.
      *******************************************************
           MOVE LP-BRNO   TO EXT-WI-CL-OWNBR.
           MOVE LP-ACCTNO TO EXT-WI-CL-ACCTNO.
           MOVE "WI/CHREPO" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH EXIT-PATHNAME.
           CANCEL FORM-PROGX.

      *****************************************************************
       SETUP-FOR-REALPY SECTION.
      *****************************************************************

      *----------------------------------------------------------------
      *        1 -  PAYMENT DEFAULT DISTRIBUTION
      *        2 -  PAYMENT APPLIED DISTRIBUTION
      *----------------------------------------------------------------
      *    SETUP DISPLAY FOR PAYMENT APPLIED (1) DISTRIBUTION
      *----------------------------------------------------------------

           MOVE LP-PAYDATE        TO REALPYW-PAYDATE.
           MOVE LP-TRCD           TO REALPYW-TRCD.
           MOVE LP-REFNO          TO REALPYW-REFNO.
           MOVE LP-TRAMT          TO REALPYW-TRAMT.

      * POSTING AMOUNTS:
           COMPUTE REALPYW-POST-REGPY(1) =
                LP-TRAMT - LP-EXTRA-PRIN-LFP - LP-APOTH - LP-APLC.
           MOVE LP-EXTRA-PRIN-LFP TO REALPYW-POST-EXTRA-PRIN(1).
           MOVE LP-APOTH          TO REALPYW-POST-OTH(1).
           MOVE LP-APLC           TO REALPYW-POST-LCHG(1).

      * APPLY FIELDS:
           MOVE LFPAP-APPDUEINT   TO REALPYW-PDUE-APINT(1).
           MOVE LFPAP-APPDUEPRIN  TO REALPYW-PDUE-APPRIN(1).
           MOVE LFPAP-APCURINT    TO REALPYW-CUR-APINT(1).
           MOVE LFPAP-APCURPRIN   TO REALPYW-CUR-APPRIN(1).
           MOVE LP-EXTRA-PRIN-LFP TO REALPYW-AP-EXTRA-PRIN(1).
           MOVE LP-APOTH          TO REALPYW-APOTH(1).
           MOVE LP-APLC           TO REALPYW-APLC(1).

      * BALANCES:
           MOVE LFPAP-OTHBAL      TO REALPYW-OTHBAL(1).
           MOVE LFPAP-LCBAL       TO REALPYW-LCBAL(1).
           MOVE LFPAP-INTBAL      TO REALPYW-INTBAL(1).
           MOVE LFPAP-CURBAL      TO REALPYW-CURBAL(1).

           MOVE LP-REMAIN-INT-SINCE-LFP
                                  TO REALPYW-INT-SINCE-LFP(1).
           MOVE LP-REMAIN-PRIN-SINCE-LFP
                                  TO REALPYW-PRIN-SINCE-LFP(1).

           MOVE "WI/REALPY" TO FORM-NAM.
           CALL FORM-PROGX USING FORM-PATH REALPYW-FIELDS
                                SP-REC LN-REC LP-REC.
           CANCEL FORM-PROGX.

      *----------------------------------------------------------------
      *    SAVE RE-DISBURSED APPLIED PAYMENT AMOUNTS (2)
      *----------------------------------------------------------------
           MOVE REALPYW-PDUE-APINT(2)    TO LFPAP-APPDUEINT.
           MOVE REALPYW-PDUE-APPRIN(2)   TO LFPAP-APPDUEPRIN.
           MOVE REALPYW-CUR-APINT(2)     TO LFPAP-APCURINT.
           MOVE REALPYW-CUR-APPRIN(2)    TO LFPAP-APCURPRIN.
           MOVE REALPYW-AP-EXTRA-PRIN(2) TO LFPAP-EXTRA-PRIN-LFP
                                           LP-EXTRA-PRIN-LFP.

           MOVE REALPYW-APOTH(2)         TO LP-APOTH.
           MOVE REALPYW-APLC(2)          TO LP-APLC.
           ADD  LP-APLC                 TO HOLD-LN-TOTLCHG
                                           HOLD-LN-TOTERN.
           IF SP-1098-INC-LC = "Y"
              ADD LP-APLC               TO LP-INTPAID.
           ADD  REALPYW-PDUE-APINT(2)
                REALPYW-CUR-APINT(2)     GIVING LP-APINT.
           ADD  REALPYW-PDUE-APPRIN(2)
                REALPYW-CUR-APPRIN(2)
                REALPYW-AP-EXTRA-PRIN(2) GIVING LP-APCUR.

      * BALANCES:
           MOVE REALPYW-OTHBAL(2)        TO LFPAP-OTHBAL
                                           LP-OTHBAL.
           MOVE REALPYW-LCBAL(2)         TO LFPAP-LCBAL
                                           LP-LCBAL.
           MOVE REALPYW-INTBAL(2)        TO LFPAP-INTBAL
                                           LP-INTBAL.
           MOVE REALPYW-CURBAL(2)        TO LFPAP-CURBAL
                                           LP-CURBAL.

           MOVE REALPYW-INT-SINCE-LFP(2)
                                  TO LP-REMAIN-INT-SINCE-LFP.
           MOVE REALPYW-PRIN-SINCE-LFP(2)
                                  TO LP-REMAIN-PRIN-SINCE-LFP.

      * SETUP HOLD-LXZ-POST  FIELDS:
           COMPUTE HOLD-LXZ-POST-REGPY =
                LP-TRAMT - REALPYW-AP-EXTRA-PRIN(2)
                         - REALPYW-APOTH(2)
                         - REALPYW-APLC(2).
           MOVE REALPYW-AP-EXTRA-PRIN(2) TO HOLD-LXZ-POST-EXTRA-PRIN.
           MOVE REALPYW-APOTH(2)         TO HOLD-LXZ-POST-OTH.
           MOVE REALPYW-APLC(2)          TO HOLD-LXZ-POST-LCHG.

           MOVE REALPYW-PDUE-APINT(2)    TO HOLD-LXZ-PDUE-APINT.
           MOVE REALPYW-PDUE-APPRIN(2)   TO HOLD-LXZ-PDUE-APPRIN.
           MOVE REALPYW-CUR-APINT(2)     TO HOLD-LXZ-CUR-APINT.
           MOVE REALPYW-CUR-APPRIN(2)    TO HOLD-LXZ-CUR-APPRIN.

           PERFORM SETUP-LINE.
           PERFORM SEND-ENTRY-LINE.

       SETUP-FOR-REALPY-EXIT.
           EXIT.

      ********************************************************************
      *    LOGIC TO DETERMINE PAYMENT REQUIREMENTS FOR MIP INSURANCE
      *
      *     THESE ROUTINES WILL DETERMINE IF MIP INSURANCE IS
      *     DO TO BE COLLECTED BASED ON LN-MIP-CLPDTH-DATE AND
      *     LN-MIP-AHPDTH-DATE AND LN-CL-REBATE AND LN-AH-REBATE FLAGS.
      *     IF PAYMENT IS DUE AND ENOUGH MONIES HAVE BEEN PAID TO COVER
      *     THE PREMIUMS, THEY WILL BE COLLECTED.
      *
      *     N O T E:
      *              A SIMILAR ROUTINE EXISTS IN LIBLP/MIPPO FOR PAYOFFS
      ********************************************************************
       DETERMINE-MIP-REQUIRED SECTION.
      ********************************************************************
           IF NOT DF-POSTING
              IF LN-MIP-FG = "Y"
                 MOVE 0 TO HOLD-LXM-MIP-CLPAID
                           HOLD-LXM-MIP-AHPAID
                 MOVE LN-MIP-CLPDTH-DATE TO HOLD-LXM-MIP-CLPDTH
                 MOVE LN-MIP-AHPDTH-DATE TO HOLD-LXM-MIP-AHPDTH
    
                 MOVE "N" TO CHARGE-MIP-CLPREM-FG
                             CHARGE-MIP-AHPREM-FG
    
                 PERFORM UNTIL (
                                 CHARGE-MIP-CLPREM-FG = " " AND
                                 CHARGE-MIP-AHPREM-FG = " "
                               )
                    MOVE 0 TO MIP-WORKER
                    PERFORM TEST-MIP-CL-DUE
                    PERFORM TEST-MIP-AH-DUE
                    IF CHARGE-MIP-CLPREM-FG = "Y"
                       ADD LN-INSPREM(1) TO MIP-WORKER
                    END-IF
                    IF CHARGE-MIP-AHPREM-FG = "Y"
                       ADD LN-INSPREM(2) TO MIP-WORKER
                    END-IF
                    IF LP-TRAMT >= MIP-WORKER
                       SUBTRACT MIP-WORKER FROM LP-TRAMT
                       IF CHARGE-MIP-CLPREM-FG = "Y"
                          ADD LN-INSPREM(1) TO HOLD-LXM-MIP-CLPAID
                          MOVE HOLD-LXM-MIP-CLPDTH TO NDTE-DATE
                          MOVE 1                   TO NDTE-HOLD
                          PERFORM INCREMENT-MONTHS
                          MOVE NDTE-DATE      TO HOLD-LXM-MIP-CLPDTH
    
                          MOVE HOLD-LXM-MIP-CLPDTH TO NUM-DATE
                          MOVE LP-PAYDATE          TO SYS-DATE
                          MOVE 05                  TO NUM-DA S-DD
                          IF SYS-DATE = NUM-DATE
                             MOVE " " TO CHARGE-MIP-CLPREM-FG
                          END-IF
                       END-IF
                       IF CHARGE-MIP-AHPREM-FG = "Y"
                          ADD LN-INSPREM(2) TO HOLD-LXM-MIP-AHPAID
                          MOVE HOLD-LXM-MIP-AHPDTH TO NDTE-DATE
                          MOVE 1                   TO NDTE-HOLD
                          PERFORM INCREMENT-MONTHS
                          MOVE NDTE-DATE      TO HOLD-LXM-MIP-AHPDTH
    
                          MOVE HOLD-LXM-MIP-AHPDTH TO NUM-DATE
                          MOVE LP-PAYDATE          TO SYS-DATE
                          MOVE 05                  TO NUM-DA S-DD
                          IF SYS-DATE = NUM-DATE
                             MOVE " " TO CHARGE-MIP-AHPREM-FG
                          END-IF
                       END-IF
                    ELSE
                       MOVE " " TO CHARGE-MIP-CLPREM-FG
                                   CHARGE-MIP-AHPREM-FG
                    END-IF
                 END-PERFORM
              END-IF
           END-IF.

      *************************************************************
      *    TEST MIP CL PAYMENT DUE
      *      THIS ROUTINE DETERMINES WHETHER A
      *      MIP CLPREM IS DUE TODAY, BASED ON
      *      -  LN-CL-REBATE = ' '     - HAS NOT BEEN CANCELLED
      *      -  MIP-CLPDTH HAS NOT REACHED LN-INSEXP-DATE(1)
      *      -  TODAY IS AFTER MIP-CLPDTH
      *************************************************************
       TEST-MIP-CL-DUE SECTION.
      *************************************************************
           MOVE " " TO CHARGE-MIP-CLPREM-FG.
           IF (LN-CL-REBATE NOT = " ") OR
              (LN-INSPREM(1) = 0)
              GO TO TEST-MIP-CL-DUE-EXIT.
    
      * SEE IF COLLECTION OF MIP-CL HAS EXPIRED:
           MOVE LN-INSEXP-DATE(1)        TO NUM-DATE.
           MOVE HOLD-LXM-MIP-CLPDTH TO SYS-DATE.
           MOVE 05 TO NUM-DA S-DD.
           IF SYS-DATE NOT < NUM-DATE
              GO TO TEST-MIP-CL-DUE-EXIT.
    
      * SEE IF COLLECTION OF MIP-CLPREM IS DUE:
           MOVE HOLD-LXM-MIP-CLPDTH TO NUM-DATE.
           MOVE LP-PAYDATE          TO SYS-DATE.
           MOVE 05 TO NUM-DA S-DD.
           IF SYS-DATE NOT > NUM-DATE
              GO TO TEST-MIP-CL-DUE-EXIT.
    
           MOVE "Y" TO CHARGE-MIP-CLPREM-FG.
    
       TEST-MIP-CL-DUE-EXIT.
           EXIT.

      *************************************************************
      *    TEST MIP AH PAYMENT DUE
      *      THIS ROUTINE DETERMINES WHETHER A
      *      MIP AHPREM IS DUE TODAY, BASED ON
      *      -  LN-AH-REBATE = ' '     - HAS NOT BEEN CANCELLED
      *      -  MIP-AHPDTH HAS NOT REACHED LN-INSEXP-DATE(1)
      *      -  TODAY IS AFTER MIP-AHPDTH
      *************************************************************
       TEST-MIP-AH-DUE SECTION.
      *************************************************************
           MOVE " " TO CHARGE-MIP-AHPREM-FG.
           IF (LN-AH-REBATE NOT = " ") OR
              (LN-INSPREM(2) = 0)
              GO TO TEST-MIP-AH-DUE-EXIT.
    
      * SEE IF COLLECTION OF MIP-AH HAS EXPIRED:
           MOVE LN-INSEXP-DATE(2)        TO NUM-DATE.
           MOVE HOLD-LXM-MIP-AHPDTH TO SYS-DATE.
           MOVE 05 TO NUM-DA S-DD.
           IF SYS-DATE NOT < NUM-DATE
              GO TO TEST-MIP-AH-DUE-EXIT.
    
      * SEE IF COLLECTION OF MIP-AH-PREM IS DUE:
           MOVE HOLD-LXM-MIP-AHPDTH TO NUM-DATE.
           MOVE LP-PAYDATE          TO SYS-DATE.
           MOVE 05 TO NUM-DA S-DD.
           IF SYS-DATE NOT > NUM-DATE
              GO TO TEST-MIP-AH-DUE-EXIT.
    
           MOVE "Y" TO CHARGE-MIP-AHPREM-FG.
    
       TEST-MIP-AH-DUE-EXIT.
           EXIT.

      *******************************************
       ESCROW-APPLICATION-WINDOW SECTION.
      *******************************************
           IF NOT (LP-TRCD = "PY" OR "PA")
              GO TO END-ESCROW-APPLICATION-WINDOW.

           MOVE 11 TO WINDOW-LINES.
           MOVE 57 TO WINDOW-COLUMNS.
           MOVE 9 TO WINDOW-BEGIN-Y.
           MOVE 20 TO WINDOW-BEGIN-X.
           MOVE "WI/ESAPPL" TO WINDOW-FORM-NAM.
           MOVE "ESAPPL" TO VDU-FORM-NAME.

           PERFORM OPEN-WINDOW.
           DISPLAY ESAPPL-SCREEN.

           MOVE ESAPPL-FORM-FIELDS TO WR-BUF.
           MOVE ESAPPL-FORM-LIST   TO WR-LIST.
           PERFORM CALL-WRFORM.

       GET-ESCROW-RECORD.
           MOVE LN-ACCTNO TO ES-ACCTNO.
           PERFORM OPEN-ES1-FILE.
           PERFORM READ-ES1-FILE.
           PERFORM CLOSE-ES1-FILE.
           IF IO-BAD
              MOVE "ERROR: ESCROW RECORD NOT FOUND FOR ACCOUNT!"
                 TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN
              DESTROY ESAPPL-SCREEN
              PERFORM CLOSE-WINDOW
              MOVE "LONPF" TO VDU-FORM-NAME
              MOVE "X" TO ERRCD
              GO TO END-ROUTINE.

      *********************************************************************
      * THE PERFORM BELOW SHOULD COMPUTE THE TOTAL ESCROW OUTSTANDING &
      * COLLECTED.  FOR ANY YEARS WITH ESCROW SCHEDULED & PAID, IT WILL ADD
      * TO THE NUMBER OF FULL ESCROW PAYMENTS, AND IF THERE IS A PARTIAL
      * ESCROW PAYMENT THE AMOUNT WILL BE IN PARTIAL-ESCROW-AMT.
      *
      * IF WE FIND A YEAR WITH 0 SCHEDULED BUT A NON-ZERO 1ST PAY DATE,
      * THAT IS A "SKIPPED" YEAR FOR ESCROW, SO MUST ADD 12 TO NUMBER OF
      * FULL ESCROW PMTS TO KEEP IN SYNC WITH P&I PMTS.
      *
      * THE 1ST YEAR FOUND WITH SCHEDULED AMT NOT FULLY PAID IS SET TO
      * ESCROW YEAR1.  IF ANOTHER YEAR FOUND WITH SCHEDULED NOT FULLY
      * PAID THAT IS YEAR2.
      *********************************************************************
           MOVE 0 TO ESCROW-OUTSTANDING
                     ESCROW-COLLECTED
                     ESCROW-SCHEDULED
                     NUM-FULL-ESCROW-PMTS
                     PARTIAL-ESCROW-AMT
                     ESCROW-AMT.
           MOVE "N" TO MISSING-ESCROW-FG.
           MOVE SPACES TO ESCROW-SKIP-TABLE.
           MOVE 0 TO ESCROW-YR ESCROW-YR1 ESCROW-YR2.
           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB > 40
              COMPUTE ESCROW-OUTSTANDING = ESCROW-OUTSTANDING +
                 ES-SCHD-ESCROW(SUB) - ES-SCHD-COLLECTED(SUB)
              COMPUTE ESCROW-COLLECTED = ESCROW-COLLECTED +
                                         ES-SCHD-COLLECTED(SUB)
              COMPUTE ESCROW-SCHEDULED = ESCROW-SCHEDULED +
                                         ES-SCHD-ESCROW(SUB)
              IF ES-SCHD-ESCROW(SUB) = 0
                 IF ES-SCHD-1STPYDATE(SUB) NOT = 0
                    MOVE "Y" TO ESCROW-SKIP-YR(SUB)
                 END-IF
               END-IF

              IF ES-SCHD-ESCROW(SUB) > 0
                 IF ES-SCHD-ESCROW(SUB) = ES-SCHD-COLLECTED(SUB)
                    ADD 12 TO NUM-FULL-ESCROW-PMTS
                 ELSE
                    COMPUTE MONTHLY-ESCROW = ES-SCHD-ESCROW(SUB) / 12
      * NOTE, ESCROW-PAYS IS THE WHOLE NUMBER PART OF ESCROW-PAYMENTS
                    COMPUTE ESCROW-PAYMENTS ROUNDED =
                       ES-SCHD-COLLECTED(SUB) / MONTHLY-ESCROW
                    ADD ESCROW-PAYS TO NUM-FULL-ESCROW-PMTS
                    COMPUTE PARTIAL-ESCROW-AMT = PARTIAL-ESCROW-AMT +
                       (ES-SCHD-COLLECTED(SUB)
                     - (ESCROW-PAYS * MONTHLY-ESCROW))
      * IF ESCROW-YR1 NOT SET, USE 1ST YEAR WITH SCHEDULED & NOT ALL COLLECTED
                     IF ESCROW-YR1 = 0
                        MOVE SUB TO ESCROW-YR1
                     ELSE
                        IF ESCROW-YR2 = 0
                           MOVE SUB TO ESCROW-YR2
                        END-IF
                     END-IF
                 END-IF
              END-IF
           END-PERFORM.
      *********************************************************************
      * IF NO MORE ESCROW TO COLLECT FOR CURRENT YEAR, ESCROW-AMT = 0
      *********************************************************************
           IF (ESCROW-SCHEDULED = 0 OR ESCROW-YR1 = 0)
              IF NUM-FULL-ESCROW-PMTS = LN-SUM-ORGTERM
                 MOVE 0 TO ESCROW-AMT
                 GO TO EXIT-ESCROW-APPLICATION-WINDOW
              ELSE
                 MOVE MISSING-ESCROW-SEQ TO PASSWDW-SEQ
                 MOVE "TO POST WITHOUT ESCROW SCHEDULE"
                                    TO PASSWDW-PROMPT2
                 PERFORM PASSWORD-MUST-EXIST
                 IF PASSWDW-STAT NOT = "OK"
                    MOVE "Y" TO MISSING-ESCROW-FG
                 END-IF
                 MOVE "S  A010WLEGEND." TO VDU
                 MOVE
                "SET UP NEXT YEAR'S ESCROW SCHEDULE BEFORE POSTING PMT!"        
                    TO VDUBUF
                 PERFORM SCREENIO
                 MOVE "E  A010WSEL." TO VDU
                 PERFORM SCREENIO
                 MOVE 0 TO ESCROW-AMT
                 GO TO EXIT-ESCROW-APPLICATION-WINDOW.
           MOVE ESCROW-YR1 TO ESCROW-YR.
           COMPUTE THIS-YR-ESCROW-BAL = 
             ES-SCHD-ESCROW(ESCROW-YR) - ES-SCHD-COLLECTED(ESCROW-YR).
           IF THIS-YR-ESCROW-BAL = 0
              MOVE 0 TO ESCROW-AMT
              GO TO EXIT-FIND-ESCROW.
           PERFORM VARYING SUB FROM 1 BY 1 UNTIL SUB = ESCROW-YR
              IF ESCROW-SKIP-YR(SUB) = "Y"
                 ADD 12 TO NUM-FULL-ESCROW-PMTS
              END-IF
           END-PERFORM.
           COMPUTE MONTHLY-ESCROW = ES-SCHD-ESCROW(ESCROW-YR) / 12.
      *********************************************************************
      * NOW WE NEED TO FIGURE OUT THE FULL NUMBER OF PAYMENTS NOT
      * INCLUDING ESCROW, AND SAVE ANY PARTIAL PAYMENT AMOUNT
      *********************************************************************
           MOVE 0 TO NUM-FULL-REG-PMTS
                     PARTIAL-REGPAY-AMT
                     TOT-REGPAY-APPLY.
           MOVE LN-TOTPAYMNTD TO PAYMNTD-WORK.
           SUBTRACT ESCROW-COLLECTED FROM PAYMNTD-WORK.
           IF SP-CONTRFRMLA = "A"
              SUBTRACT LN-TOTLCHG FROM PAYMNTD-WORK.
           IF PAYMNTD-WORK < LN-1STPYAMT
              MOVE 0 TO NUM-FULL-REG-PMTS
              MOVE PAYMNTD-WORK TO PARTIAL-REGPAY-AMT
              MOVE 0 TO PAYMNTD-WORK
              GO TO DETERMINE-ESCROW-AMT
           ELSE
              MOVE 1 TO NUM-FULL-REG-PMTS
              SUBTRACT LN-1STPYAMT FROM PAYMNTD-WORK.

      * NOTE, REGPAY-PAYS IS THE WHOLE NUMBER PART OF REGPAY-PAYMENTS
           COMPUTE REGPAY-PAYMENTS ROUNDED =
              PAYMNTD-WORK / LN-REGPYAMT.

           ADD REGPAY-PAYS TO NUM-FULL-REG-PMTS.
           COMPUTE PARTIAL-REGPAY-AMT = PARTIAL-REGPAY-AMT +
                  PAYMNTD-WORK - (REGPAY-PAYS * LN-REGPYAMT).

      *********************************************************************
      * FOR EACH PAYMENT, WE WANT TO APPLY TO ESCROW FIRST, THEN P&I.
      * SO IF NO. OF FULL PAYS OF ESCROW NOT = NO. OF FULL PAYS OF P&I,
      * TRY TO CATCH ONE OR THE OTHER UP, USING AMT OF CURRENT PAYMENT
      * (ORIG-LP-TRAMT), ALSO HAVE THE PARTIAL PAYMENTS FOR EACH TO
      * USE TO GET THE NEXT FULL PAY.
      *********************************************************************
       DETERMINE-ESCROW-AMT.
           IF LN-ACCELDATE = 0
              IF (IBPC-FG = "P" OR LN-LOANTYPE = "I")
                 IF SP-LCFRMLA NOT = " "
                    MOVE LP-TRCD           TO LCAP-LPTRCD
                    MOVE ORIG-LP-TRAMT     TO LCAP-TRAMT
                    MOVE LP-PAYDATE        TO LCAP-PAYDATE
                    MOVE LN-1STPYDATE      TO LCAP-1STPYDATE
                    MOVE LP-APLC           TO LCAP-LPAPLC
                    MOVE LP-APINT          TO LCAP-LPAPINT
                    PERFORM LATE-CHARGE-APPLY.
           MOVE ORIG-LP-TRAMT TO TRAMT-WORKER MAX-ESCROW-ALLOWED.
           SUBTRACT LCAP-APP FROM TRAMT-WORKER MAX-ESCROW-ALLOWED.
           SUBTRACT LN-LCBAL FROM TRAMT-WORKER MAX-ESCROW-ALLOWED.
           SUBTRACT LN-OTHBAL FROM TRAMT-WORKER.
           IF LN-MIP-FG = "Y"
              MOVE ORIG-LP-TRAMT TO LP-TRAMT
              PERFORM DETERMINE-MIP-REQUIRED
              SUBTRACT HOLD-LXM-MIP-CLPAID FROM TRAMT-WORKER
              SUBTRACT HOLD-LXM-MIP-AHPAID FROM TRAMT-WORKER
              MOVE ORIG-LP-TRAMT TO LP-TRAMT.
       CATCH-UP-REGPAY.
           IF NUM-FULL-ESCROW-PMTS <= NUM-FULL-REG-PMTS
              GO TO CATCH-UP-ESCROW.
           IF NUM-FULL-REG-PMTS = 0
              IF (TRAMT-WORKER + PARTIAL-REGPAY-AMT) < LN-1STPYAMT
                 MOVE 0 TO ESCROW-AMT
                 GO TO EXIT-FIND-ESCROW
              ELSE
                 ADD 1 TO NUM-FULL-REG-PMTS
                 COMPUTE TRAMT-WORKER = TRAMT-WORKER -
                   (LN-1STPYAMT - PARTIAL-REGPAY-AMT)
                 COMPUTE TOT-REGPAY-APPLY = TOT-REGPAY-APPLY +
                   (LN-1STPYAMT - PARTIAL-REGPAY-AMT)
           ELSE
              IF (TRAMT-WORKER + PARTIAL-REGPAY-AMT) < LN-REGPYAMT
                 MOVE 0 TO ESCROW-AMT
                 GO TO EXIT-FIND-ESCROW
              ELSE
                 ADD 1 TO NUM-FULL-REG-PMTS
                 COMPUTE TRAMT-WORKER = TRAMT-WORKER -
                   (LN-REGPYAMT - PARTIAL-REGPAY-AMT)
                 COMPUTE TOT-REGPAY-APPLY = TOT-REGPAY-APPLY +
                   (LN-REGPYAMT - PARTIAL-REGPAY-AMT).

           MOVE 0 TO PARTIAL-REGPAY-AMT.
           IF TOT-REGPAY-APPLY > LN-CURBAL
              GO TO CATCH-UP-ESCROW.
       CATCH-UP-REGPAY-LOOP.
           IF NUM-FULL-ESCROW-PMTS <= NUM-FULL-REG-PMTS
              GO TO CATCH-UP-ESCROW.
           IF TRAMT-WORKER NOT > 0
              GO TO EXIT-FIND-ESCROW.
           IF TRAMT-WORKER < LN-REGPYAMT
              GO TO EXIT-FIND-ESCROW.
           ADD 1 TO NUM-FULL-REG-PMTS.
           SUBTRACT LN-REGPYAMT FROM TRAMT-WORKER.
           ADD LN-REGPYAMT TO TOT-REGPAY-APPLY.
           IF TOT-REGPAY-APPLY > LN-CURBAL
              GO TO CATCH-UP-ESCROW.
           GO TO CATCH-UP-REGPAY-LOOP.
       CATCH-UP-ESCROW.
           IF (TRAMT-WORKER + PARTIAL-ESCROW-AMT) < MONTHLY-ESCROW
              IF TRAMT-WORKER < ESCROW-OUTSTANDING
                 MOVE TRAMT-WORKER TO ESCROW-AMT
                 GO TO EXIT-FIND-ESCROW
              ELSE
                 MOVE ESCROW-OUTSTANDING TO ESCROW-AMT
                 GO TO EXIT-FIND-ESCROW.

      * NOW WE KNOW PMT PLUS PARTIAL ESCROW IS >= MONTHLY ESCROW

           IF (MONTHLY-ESCROW - PARTIAL-ESCROW-AMT) NOT >
                                             THIS-YR-ESCROW-BAL
              ADD 1 TO NUM-FULL-ESCROW-PMTS
              COMPUTE ESCROW-AMT =
                 (MONTHLY-ESCROW - PARTIAL-ESCROW-AMT)
              SUBTRACT ESCROW-AMT FROM TRAMT-WORKER
              SUBTRACT ESCROW-AMT FROM THIS-YR-ESCROW-BAL
              MOVE 0 TO PARTIAL-ESCROW-AMT
           ELSE
              ADD 1 TO NUM-FULL-ESCROW-PMTS
              MOVE THIS-YR-ESCROW-BAL TO ESCROW-AMT
              SUBTRACT ESCROW-AMT FROM TRAMT-WORKER
              MOVE 0 TO THIS-YR-ESCROW-BAL
              MOVE 0 TO PARTIAL-ESCROW-AMT.

       CATCH-UP-ESCROW-LOOP.
           IF NUM-FULL-ESCROW-PMTS > NUM-FULL-REG-PMTS
              ADD 1 TO NUM-FULL-REG-PMTS
              IF NUM-FULL-REG-PMTS = 1
                 SUBTRACT LN-1STPYAMT FROM TRAMT-WORKER
              ELSE
                 SUBTRACT LN-REGPYAMT FROM TRAMT-WORKER
              END-IF
              IF TRAMT-WORKER > 0
                 GO TO CATCH-UP-ESCROW-LOOP.
           IF TRAMT-WORKER NOT > 0
              GO TO EXIT-FIND-ESCROW.

           IF THIS-YR-ESCROW-BAL = 0
              IF (ESCROW-YR2 = 0 OR ESCROW-YR2 = ESCROW-YR)
                 IF NUM-FULL-ESCROW-PMTS = LN-SUM-ORGTERM
                    MOVE 0 TO ESCROW-AMT
                    GO TO EXIT-ESCROW-APPLICATION-WINDOW
                 ELSE
                    MOVE MISSING-ESCROW-SEQ TO PASSWDW-SEQ
                    MOVE "TO POST WITHOUT ESCROW SCHEDULE"
                                          TO PASSWDW-PROMPT2
                    PERFORM PASSWORD-MUST-EXIST
                    IF PASSWDW-STAT NOT = "OK"
                       MOVE "Y" TO MISSING-ESCROW-FG
                       MOVE "S  A010WLEGEND." TO VDU
                       MOVE
                "SET UP NEXT YEAR'S ESCROW SCHEDULE BEFORE POSTING PMT!"
                          TO VDUBUF
                       PERFORM SCREENIO
                       MOVE "E  A010WSEL." TO VDU
                       PERFORM SCREENIO
                       MOVE 0 TO ESCROW-AMT
                       GO TO EXIT-ESCROW-APPLICATION-WINDOW
                    END-IF
                 END-IF
              ELSE
                 MOVE ESCROW-YR2 TO ESCROW-YR
                 COMPUTE MONTHLY-ESCROW =
                    ES-SCHD-ESCROW(ESCROW-YR) / 12
                 COMPUTE THIS-YR-ESCROW-BAL = 
                      ES-SCHD-ESCROW(ESCROW-YR)
                       - ES-SCHD-COLLECTED(ESCROW-YR)
                 PERFORM VARYING SUB FROM ESCROW-YR1 BY 1 
                                     UNTIL SUB = ESCROW-YR
                    IF ESCROW-SKIP-YR(SUB) = "Y"
                       ADD 12 TO NUM-FULL-ESCROW-PMTS
                    END-IF
                 END-PERFORM
                 IF NUM-FULL-ESCROW-PMTS > NUM-FULL-REG-PMTS
                    GO TO CATCH-UP-ESCROW-LOOP.

           IF TRAMT-WORKER < MONTHLY-ESCROW
              IF (ESCROW-AMT + TRAMT-WORKER) <= ESCROW-OUTSTANDING
                 ADD TRAMT-WORKER TO ESCROW-AMT
                 GO TO EXIT-FIND-ESCROW
              ELSE
                 MOVE ESCROW-OUTSTANDING TO ESCROW-AMT
                 GO TO EXIT-FIND-ESCROW.

      * NOW WE KNOW TRAMT-WORKER >= MONTHLY ESCROW AMT:

           IF MONTHLY-ESCROW NOT > THIS-YR-ESCROW-BAL
              ADD 1 TO NUM-FULL-ESCROW-PMTS
              ADD MONTHLY-ESCROW TO ESCROW-AMT
              SUBTRACT MONTHLY-ESCROW FROM TRAMT-WORKER
              SUBTRACT MONTHLY-ESCROW FROM THIS-YR-ESCROW-BAL
              GO TO CATCH-UP-ESCROW-LOOP
           ELSE
              ADD 1 TO NUM-FULL-ESCROW-PMTS
              ADD THIS-YR-ESCROW-BAL TO ESCROW-AMT
              SUBTRACT ESCROW-AMT FROM TRAMT-WORKER
              MOVE 0 TO THIS-YR-ESCROW-BAL
              GO TO CATCH-UP-ESCROW-LOOP.

       EXIT-FIND-ESCROW.
           IF ESCROW-AMT > ESCROW-OUTSTANDING
              MOVE ESCROW-OUTSTANDING TO ESCROW-AMT
              GO TO EXIT-FIND-ESCROW.
           IF ESCROW-AMT < 0
              MOVE 0 TO ESCROW-AMT.
           IF ESCROW-YR = 0
              MOVE "NO ESCROW SCHEDULED!" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              MOVE 0 TO ESCROW-AMT
              GO TO EXIT-ESCROW-APPLICATION-WINDOW.
           IF ESCROW-AMT > MAX-ESCROW-ALLOWED
              IF ESCROW-AMT = 0
                 MOVE 0 TO ESCROW-AMT
                 PERFORM DISPLAY-ESCROW-FIELDS
                 MOVE "LATE CHG EXCEEDS PMT AMT, NO ESCROW APPLIED"
                    TO MESS
                 PERFORM CONDITIONAL-SEND-MESS
                 GO TO EXIT-ESCROW-APPLICATION-WINDOW.
           COMPUTE LP-TRAMT = ORIG-LP-TRAMT - ESCROW-AMT.
       SEND-ESCROW-AMT.
           PERFORM DISPLAY-ESCROW-FIELDS.
           MOVE ESCROW-AMT TO DEFAULT-ESCROW-AMT.
           MOVE "S  A010WLEGEND." TO VDU.
           MOVE "ENTER ESCROW OR PRESS ENTER FOR DEFAULT."
              TO VDUBUF.
           PERFORM SCREENIO.
           GO TO ENTER-ESCROW-AMT.
       RE-DISPLAY-DEFAULT-ESCROW.
           MOVE "SNNN062APPLIED." TO VDU.
           MOVE DEFAULT-ESCROW-AMT TO VDUNUM2.
           PERFORM SCREENIO.
       ENTER-ESCROW-AMT.
           MOVE "E NN062APPLIED." TO VDU.
           PERFORM SCREENIO.
      *    IF VDUSTATUS = "1>"
      *       GO TO EXIT-ESCROW-APPLICATION-WINDOW.
           IF NOT (VDUSTATUS = "00" OR "1D")
              GO TO ENTER-ESCROW-AMT.
           MOVE VDUNUM2 TO ESCROW-AMT.
           IF ESCROW-AMT NOT = DEFAULT-ESCROW-AMT
              MOVE OVERRIDE-ESCROW-SEQ TO PASSWDW-SEQ
              MOVE "TO OVERRIDE ESCROW AMOUNT" TO PASSWDW-PROMPT2
              PERFORM VERIFY-PASSWORD
              IF PASSWDW-STAT NOT = "OK"
                 MOVE "SNNN062APPLIED." TO VDU
                 MOVE DEFAULT-ESCROW-AMT TO ESCROW-AMT VDUNUM2
                 PERFORM SCREENIO.
           IF ESCROW-AMT > ORIG-LP-TRAMT
              MOVE "ESCROW CANNOT EXCEED PAYMENT AMT!" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO RE-DISPLAY-DEFAULT-ESCROW.
           IF ESCROW-AMT > MAX-ESCROW-ALLOWED
              MOVE "ESCROW CAN'T EXCEED PAYMENT AMT - LATE CHG"
                 TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO RE-DISPLAY-DEFAULT-ESCROW.
           IF ESCROW-AMT > ESCROW-OUTSTANDING
              MOVE "ESCROW CANNOT EXCEED SCHEDULED ESCROW AMT!"
                 TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO RE-DISPLAY-DEFAULT-ESCROW.
           IF ESCROW-AMT > 99999.99
              MOVE "ESCROW CANNOT EXCEED $99,999.99!" TO MESS
              PERFORM CONDITIONAL-SEND-MESS
              GO TO RE-DISPLAY-DEFAULT-ESCROW.
           COMPUTE LP-TRAMT = ORIG-LP-TRAMT - ESCROW-AMT.
           PERFORM DISPLAY-ESCROW-FIELDS.
       ACCEPT-ESCROW.
           MOVE "S  A010WLEGEND." TO VDU.
           MOVE "ENTER 'Y' TO ACCEPT, 'N' TO RE-ENTER." TO
              VDUBUF.
           PERFORM SCREENIO.

           MOVE "E RA060WSEL." TO VDU.
           PERFORM SCREENIO.
           IF VDUBUF = "     N" GO TO SEND-ESCROW-AMT.
           IF VDUBUF NOT = "     Y" GO TO ACCEPT-ESCROW.
           SUBTRACT ESCROW-AMT FROM LP-TRAMT-HOLD-FOR-MIP.
           COMPUTE LP-TRAMT = ORIG-LP-TRAMT - ESCROW-AMT.
           MOVE ESCROW-AMT TO LP-APPLIED-TO-ESCROW
                              D-APPLIED-TO-ESCROW.
       EXIT-ESCROW-APPLICATION-WINDOW.
           DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN.
           DESTROY ESAPPL-SCREEN.
           MOVE "LONPF" TO VDU-FORM-NAME.
           PERFORM CLOSE-WINDOW.

           MOVE "S  A000APPLIED-PRMT." TO VDU.
           MOVE ESCROW-DISPLAY TO VDUBUF.
           PERFORM SCREENIO.

           MOVE ESCROW-AMT TO LCAP-ESCROW-AMT.
       END-ESCROW-APPLICATION-WINDOW.
           EXIT.

      *********************************************************************
       DISPLAY-ESCROW-FIELDS SECTION.
      *********************************************************************
           MOVE ESCROW-YR1                    TO D-YR(1).
           MOVE ES-SCHD-ESCROW(ESCROW-YR1)    TO D-ESCROW(1).
           MOVE ES-SCHD-COLLECTED(ESCROW-YR1) TO D-COLLECTED(1).
           COMPUTE ESCROW-BALANCE1 = ES-SCHD-ESCROW(ESCROW-YR1)
                                   - ES-SCHD-COLLECTED(ESCROW-YR1).
           IF ESCROW-AMT NOT > ESCROW-BALANCE1
              MOVE ESCROW-AMT TO D-APPLIED(1)
              SUBTRACT ESCROW-AMT FROM ESCROW-BALANCE1
              MOVE ESCROW-BALANCE1 TO D-BALANCE(1)
              MOVE SPACES TO ESCROW-LINE(2)
           ELSE
              MOVE ESCROW-BALANCE1               TO D-APPLIED(1)
              MOVE 0                             TO D-BALANCE(1)
              IF ESCROW-YR2 NOT = 0
                 MOVE ESCROW-YR2 TO D-YR(2)
                 MOVE ES-SCHD-ESCROW(ESCROW-YR2)    TO D-ESCROW(2)
                 MOVE ES-SCHD-COLLECTED(ESCROW-YR2) TO D-COLLECTED(2)
                 COMPUTE ESCROW-APPLIED2 = ESCROW-AMT - ESCROW-BALANCE1
                 MOVE ESCROW-APPLIED2               TO D-APPLIED(2)
                 COMPUTE ESCROW-BALANCE2 = ES-SCHD-ESCROW(ESCROW-YR2)
                                         - ES-SCHD-COLLECTED(ESCROW-YR2)
                                         - ESCROW-APPLIED2
                 MOVE ESCROW-BALANCE2               TO D-BALANCE(2).

           MOVE ORIG-LP-TRAMT                 TO D-PAYMENT-AMT.
           MOVE ESCROW-AMT                    TO D-TOT-APPLIED.
           MOVE LP-TRAMT                      TO D-TOT-BALANCE.

           MOVE ESCROW-WINDOW-LIST TO WR-LIST.
           MOVE ESCROW-WINDOW-BUF TO WR-BUF.
           PERFORM CALL-WRFORM.


       COPY "LIBGB/CAPASSWD.CPY".
       COPY "LIBGB/GPENV.CPY".


      **************************************************************************
       SETUP-LINK-INFO SECTION.
      **************************************************************************
           IF VDU-FORM-NAME = "LPSMNU"
              MOVE LPSMNU-HELP--FILE TO HELP-LINK-FILE
              MOVE LPSMNU-HELP--DIR  TO HELP-LINK-DIR
           ELSE
              MOVE LONPF-HELP--FILE TO HELP-LINK-FILE
              MOVE LONPF-HELP--DIR TO HELP-LINK-DIR.

      **************************************************************************
       VDU-CONVERT-FIELD SECTION.
      **************************************************************************
           MOVE "00" TO STAT.
           MOVE VDU-FIELD-TO-CONVERT TO VDU-ALP-FIELD.
           EVALUATE TRUE
              COPY "LIBLP/LONPF_EVA.CPY".
              COPY "LIBLP/LPSMNU_EVA.CPY".
              COPY "LIBLP/LPLNMU_EVA.CPY".
              COPY "LIBLP/LPCAMU_EVA.CPY".
              COPY "LIBLP/LPVDMU_EVA.CPY".
              COPY "LIBWI/AUCTIN_EVA.CPY".
              COPY "LIBWI/ESAPPL_EVA.CPY".
              WHEN OTHER       MOVE   "2A" TO STAT
           END-EVALUATE.

      *************************************
       MISCELLANEOUS-ROUTINES SECTION.
      *************************************
       COPY "LIBGB/SYSTEM.CPY".
       COPY "LIBGB/GETENV.CPY".
       FORM-RESET.
       CONDITIONAL-SEND-MESS.
           IF EXT-ROUTE-BUF = "00"
              PERFORM SEND-MESS.
       GET-DL.
           PERFORM OPEN-DL1-FILE.
           PERFORM READ-DL1-FILE.
           PERFORM CLOSE-DL1-FILE.
       SET-LP-AP-VDUBUF.
           MOVE "S  A060PMPT2." TO VDU.
           IF LP-IBPC = "I"
              MOVE "   INT" TO VDUBUF
           ELSE
              MOVE "LT-CHG" TO VDUBUF.
           IF LP-APINT NOT = 0
              MOVE "   INT" TO VDUBUF
           ELSE
              IF LP-APLC NOT = 0
                 MOVE "LT-CHG" TO VDUBUF.
           IF LP-APINT NOT = 0
              IF LP-APLC NOT = 0
                 MOVE "LC/INT" TO VDUBUF.
           PERFORM SCREENIO.
       SET-LP-BAL-VDUBUF.
           MOVE "S  A060PMPT4." TO VDU.
           IF LP-IBPC = "I"
              MOVE "   INT" TO VDUBUF
           ELSE
              MOVE "LT-CHG" TO VDUBUF.
           IF LP-INTBAL NOT = 0
              MOVE "   INT" TO VDUBUF
           ELSE
              IF LP-LCBAL NOT = 0
                 MOVE "LT-CHG" TO VDUBUF.
           IF LP-INTBAL NOT = 0
              IF LP-LCBAL NOT = 0
                 MOVE "LC/INT" TO VDUBUF.
           PERFORM SCREENIO.

       DISPLAY-APP-LC-INT.
           MOVE LINE-LIST TO WR-LIST.
           MOVE SPACES TO WR-BUF.
           PERFORM CALL-WRFORM.
      *    CALL FRESET USING STAT LINE-LIST.
           MOVE "S  A110GA8." TO VDU.
           MOVE "APPLIED   B" TO VDUBUF.
           PERFORM SCREENIO.
           MOVE "S  A320F23." TO VDU.
           MOVE "AL OWING" TO VDUBUF.
           PERFORM SCREENIO.
           MOVE "S  A200GD9." TO VDU.
           MOVE "         INTEREST   " TO VDUBUF.
           PERFORM SCREENIO.
           MOVE "SN S042GA9." TO VDU.
           MOVE LP-APINT TO VDUNUM2.
           PERFORM SCREENIO.
           MOVE "S  A200GD0." TO VDU.
           MOVE "         LATE CHARGE" TO VDUBUF.
           PERFORM SCREENIO.
           MOVE "SN S042GA0." TO VDU.
           MOVE LP-APLC TO VDUNUM2.
           PERFORM SCREENIO.
           IF LC-AND-INT-FG = "X"
              PERFORM SET-DISPLAY-OWING-INT-LC-SP
           ELSE
              PERFORM SET-DISPLAY-OWING-INT-LC.

       SET-DISPLAY-OWING-INT-LC.
           MOVE "S  S042F33." TO VDU.
           COMPUTE VDUNUM2 = LP-INTBAL - LP-APINT.
           PERFORM SCREENIO.
           MOVE "S  S042F43." TO VDU.
           COMPUTE VDUNUM2 = LP-LCBAL - LP-APLC.
           PERFORM SCREENIO.

           MOVE "SN S052070." TO VDU.
           COMPUTE VDUNUM2 PRIN-WORKER =
                   LP-TRAMT - LP-APOTH - LP-APINT - LP-APLC.
           IF (ROUTE-CD NOT = " ") AND
              (LN-MIP-FG    = "Y")
              IF NOT DF-POSTING
                 COMPUTE VDUNUM2 PRIN-WORKER =
                         PRIN-WORKER - HOLD-LXM-MIP-CLPAID
                                     - HOLD-LXM-MIP-AHPAID.
           PERFORM SCREENIO.

           MOVE "SN N042100." TO VDU.
           COMPUTE VDUNUM2 = (LP-INTBAL - LP-APINT) +
                             (LP-LCBAL - LP-APLC).
           PERFORM SCREENIO.

           MOVE "SN N062110." TO VDU.
           COMPUTE VDUNUM2 = LN-CURBAL - PRIN-WORKER.
           PERFORM SCREENIO.

       SET-DISPLAY-OWING-INT-LC-SP.
           MOVE "S  S042F33." TO VDU.
           MOVE LP-INTBAL TO VDUNUM2.
           PERFORM SCREENIO.

           MOVE "S  S042F43." TO VDU.
           MOVE LP-LCBAL TO VDUNUM2.
           PERFORM SCREENIO.

           MOVE "SN N042100." TO VDU.
           COMPUTE VDUNUM2 = LP-INTBAL + LP-LCBAL.
           PERFORM SCREENIO.

       CALL-PAYOFF.
           MOVE 0 TO IO-FG.
           MOVE LN-ACCTNO TO PASS-PRLNNO.
           MOVE LP-PAYDATE TO PASS-TRANS-DATE.
           IF LN-SALEFIN = "Y"
              MOVE "SC" TO PASS-CURRENT-PD-SRCD
           ELSE
              MOVE "BW" TO PASS-CURRENT-PD-SRCD.

           MOVE "LP/PAYOFX" TO FORM-NAM.
           MOVE "CALCULATING - PLEASE WAIT" TO MESS.
           PERFORM SEND-LEGEND.
           CALL FORM-PROGX USING FORM-PATH PASS-PAYOFF-FLDS.
           CANCEL FORM-PROGX.
           MOVE " " TO MESS.
           PERFORM SEND-LEGEND.
       PA-PAYOFF.
           ADD 1 TO SUB.
           COMPUTE CERN-EARNINGS(SUB) =
                      LN-ANTICERN(SUB) - LN-ACCERN(SUB).
       SET-LP-EARNED.
           IF LN-SERVACCT NOT = "Y" AND LN-PLCD = " "
              IF LP-CURBAL = 0
                     AND (LP-TRCD = "PA" OR "PE" OR "SS" OR "IN"
                                  OR "PR" OR "PC" OR "PP")
                 MOVE 0 TO SUB
                 PERFORM PA-PAYOFF 6 TIMES.

           MOVE LN-EARN-ORDER(1) TO SUB.
           ADD  CERN-EARNINGS(1) TO HOLD-LN-ACCERN(1).
           IF SUB > 3
      *       MOVE CERN-EARNINGS(1) TO WK-LXE-EARN(SUB - 3)
              MOVE CERN-EARNINGS(1) TO LXE-EARN(SUB - 3)
           ELSE
              MOVE CERN-EARNINGS(1) TO LP-EARNED(SUB).

           MOVE LN-EARN-ORDER(2) TO SUB.
           ADD  CERN-EARNINGS(2) TO HOLD-LN-ACCERN(2).
           IF SUB > 3
      *       MOVE CERN-EARNINGS(2) TO WK-LXE-EARN(SUB - 3)
              MOVE CERN-EARNINGS(2) TO LXE-EARN(SUB - 3)
           ELSE
              MOVE CERN-EARNINGS(2) TO LP-EARNED(SUB).

           MOVE LN-EARN-ORDER(3) TO SUB.
           ADD  CERN-EARNINGS(3) TO HOLD-LN-ACCERN(3).
           IF SUB > 3
      *       MOVE CERN-EARNINGS(3) TO WK-LXE-EARN(SUB - 3)
              MOVE CERN-EARNINGS(3) TO LXE-EARN(SUB - 3)
           ELSE
              MOVE CERN-EARNINGS(3) TO LP-EARNED(SUB).

           MOVE LN-EARN-ORDER(4) TO SUB.
           ADD  CERN-EARNINGS(4) TO HOLD-LN-ACCERN(4).
           IF SUB > 3
      *       MOVE CERN-EARNINGS(4) TO WK-LXE-EARN(SUB - 3)
              MOVE CERN-EARNINGS(4) TO LXE-EARN(SUB - 3)
           ELSE
              MOVE CERN-EARNINGS(4) TO LP-EARNED(SUB).

           MOVE LN-EARN-ORDER(5) TO SUB.
           ADD  CERN-EARNINGS(5) TO HOLD-LN-ACCERN(5).
           IF SUB > 3
      *       MOVE CERN-EARNINGS(5) TO WK-LXE-EARN(SUB - 3)
              MOVE CERN-EARNINGS(5) TO LXE-EARN(SUB - 3)
           ELSE
              MOVE CERN-EARNINGS(5) TO LP-EARNED(SUB).

           MOVE LN-EARN-ORDER(6) TO SUB.
           ADD  CERN-EARNINGS(6) TO HOLD-LN-ACCERN(6).
           IF SUB > 3
      *       MOVE CERN-EARNINGS(6) TO WK-LXE-EARN(SUB - 3)
              MOVE CERN-EARNINGS(6) TO LXE-EARN(SUB - 3)
           ELSE
              MOVE CERN-EARNINGS(6) TO LP-EARNED(SUB).

       DISPLAY-EARNINGS.
           MOVE " " TO EARN-BUF.
           IF HOLD-DISPLAY-ERN = "A"
              COMPUTE TOTEARN = HOLD-LN-ACCERN(1) + HOLD-LN-ACCERN(2)
                              + HOLD-LN-ACCERN(3)
                              + HOLD-LN-ACCERN(5)
              IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                            GP-INCL-OTH-IN-EARNED-R)
                 ADD HOLD-LN-ACCERN(6) TO TOTEARN
              END-IF
              IF NOT (GP-INCL-OTH-IN-EARNED-R)
                 ADD HOLD-LN-ACCERN(4) TO TOTEARN
              END-IF

              MOVE TOTEARN TO D-TOTEARN
           ELSE
           IF HOLD-DISPLAY-ERN = "U"
              COMPUTE UNEARNED = LN-ANTICERN(1) - HOLD-LN-ACCERN(1)
                               + LN-ANTICERN(2) - HOLD-LN-ACCERN(2)
                               + LN-ANTICERN(3) - HOLD-LN-ACCERN(3)
                               + LN-ANTICERN(5) - HOLD-LN-ACCERN(5)
              IF NOT (GP-INCL-OTH-IN-EARNED-N OR
                                    GP-INCL-OTH-IN-EARNED-R)
                 COMPUTE UNEARNED = UNEARNED
                               + LN-ANTICERN(6) - HOLD-LN-ACCERN(6)
              END-IF
              IF NOT (GP-INCL-OTH-IN-EARNED-R)
                 COMPUTE UNEARNED = UNEARNED
                               + LN-ANTICERN(4) - HOLD-LN-ACCERN(4)
              END-IF


              MOVE UNEARNED TO D-TOTEARN
           ELSE
           IF HOLD-DISPLAY-ERN = "T"
              MOVE HOLD-LN-TOTERN TO D-TOTEARN
           ELSE
      * 1/14/2013 #4190 I TRIED TO COMPUTE THE TDUE-INTDUE HERE BUT JUST
      * COULDNT. YOU NEED LPPOFF BUT CANT BECUASE THE MIP STUFF IS HARD
      * CODED IN THIS PROGRAM AND ALSO IS BURIED IN LPPOFF SO THEY CONFLICT.
      * I ALSO TRIED CRNORC BUT THEN YOU GET THE OLD LN-REC AND IT DOESNT
      * REFLECT WHAT YOU ARE CURRENTLY POSTING. KM SAID OK TO LEAVE BLANK
      * LONPF1 WILL RECALC IT AGAIN WHEN ON THE DATE
           IF HOLD-DISPLAY-ERN = "I"
              NEXT SENTENCE
           ELSE
              MOVE LN-TOTPAYMNTD TO D-TOTEARN.

           MOVE LN-YTDINTPD TO D-INTYTD.

           IF (IBPC-FG = "P" OR LN-LOANTYPE = "I")
                                      AND (SP-LCFRMLA NOT = " ")
                                       AND (LN-ACCELDATE = 0)
              MOVE LCAP-LCPDTH-DATE TO NUM-DATE
              MOVE NUM-MO TO D-LCPDTH-MO
              IF LN-UNITPER-CD-DAYS
                 MOVE NUM-DA TO D-LCPDTH-DAYR
              ELSE
                 MOVE NUM-YR TO D-LCPDTH-DAYR.

           MOVE LP-DLPROC   TO D-DLPROC.
           MOVE LN-TOTNODEF TO D-DEFMNTS.

           COMPUTE D-EARNED ROUNDED = LP-EARNED(1) + LP-EARNED(2)
                                    + LP-EARNED(3) + LXE-EARN(1)
                                    + LXE-EARN(2)  + LXE-EARN(3).
      *                             + LP-EARNED(3) + WK-LXE-EARN(1)
      *                             + WK-LXE-EARN(2)  + WK-LXE-EARN(3).

           MOVE EARN-LIST TO WR-LIST.
           MOVE EARN-BUF TO WR-BUF.
           PERFORM CALL-WRFORM.

       TEST-STAT.
           IF STAT NOT = "00"
              PERFORM FORM-IT
              GO TO IO-ERROR.
       TEST-FOR-PE-AL.
           IF LP-TRCD = "PE" OR "IN"
              IF LCAP-OWE < HOLD-LP-TRAMT
                 ADD LCAP-OWE TO LCAP-APP
                 MOVE 0 TO LCAP-OWE.

       INCR-LCPDTH.
           MOVE DEF-NODEF TO NDTE-HOLD.
           MOVE LN-LCPDTH-DATE TO NDTE-DATE.
           MOVE LN-UNITPER-CD TO DATER-UNITPER-CD.
           MOVE LN-UNITPER-FREQ TO DATER-UNITPER-FREQ.
           PERFORM INCREMENT-UNITPER.
           MOVE NDTE-DATE TO PDTH-DATE-FULL
                             LP-LCPDTH-DATE
                             LCAP-LCPDTH-DATE.

      *RESETS CYCLE DATE IF MONTH AND 1ST PAY DUE DATE > LC PAID THRU DAY
           IF LN-UNITPER-CD = "M" AND LN-1STPYDA > 28
              MOVE LCAP-LCPDTH-DATE TO NDTE-DATE
              MOVE LN-1STPYDA  TO NDTE-DD
              PERFORM NEW-DATE-CALCULATION
              MOVE NDTE-DATE   TO LP-LCPDTH-DATE
                                  PDTH-DATE-FULL
                                  LCAP-LCPDTH-DATE.

      *RESETS THE CYCLE DATE IF SEMI-MONTHLY... IF LN-LCPDTH-DATE = 02/28/??
      *THE INCREMENT OF # OF DEFERMENTS CHANGES CYCLE DATES IF THE 1STPYDA
      *IS > 28. FOR EX: IF CYCLE DAY 15/30 THE INCREMENT OF UNIT-PERIODS
      *SET THE THE NEW CYCLE DATE AT 13/28 THIS JUST RESETS IT BACK
           IF LN-UNITPER-CD = "S"
              MOVE LN-LCPDTH-DATE TO NUM-DATE
              IF (NUM-DA = 28 OR 29) AND LN-1STPYDA > NUM-DA
                 IF (LN-1STPYDA = 14 OR 15)
                    MOVE LN-1STPYDA TO NDTE-DD
                 ELSE
                    SUBTRACT NUM-DA FROM LN-1STPYDA GIVING NDTE-HOLD
                    PERFORM INCREMENT-DAYS.

           MOVE NDTE-DATE TO LCAP-LCPDTH-DATE
                             LP-LCPDTH-DATE.

       CLEAR-LEGEND.
           MOVE SPACES TO MESS.
           PERFORM SEND-LEGEND.
       DISPLAY-ALL-LINES.
           MOVE LINE-BUF TO WR-BUF.
           MOVE LINE-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
      *    CALL XFER USING STAT LINE-LIST LINE-BUF.
      *    PERFORM WRFORM-LINE-LIST.
       SEND-LEGEND.
           MOVE MESS TO WR-BUF.
           MOVE MSEL-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.
      *    CALL XFER USING STAT MSEL-LIST MESS.
      *    CALL WRFORM USING STAT MSEL-LIST.
       MUST-BE-ALL-ZERO.
           MOVE "BRING OTHBAL, INTBAL & LCBAL TO 0 FIRST!" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       INSUFF-RSV-PRIN.
           MOVE "INSUFFICIENT AMOUNT IN RESERVE FROM PRINCIPAL"
                                                          TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       INSUFF-RSV-CHGS.
           MOVE "INSUFFICIENT AMOUNT IN RESERVE FROM CHARGES"
                                                          TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       EXCEEDS-OTH-BAL.
           MOVE "EXCEEDS OTHER BAL" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       EXCEEDS-OT2-BAL.
           MOVE "EXCEEDS OTHER 2 BAL" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       EXCEEDS-INT-BAL.
           MOVE "EXCEEDS INT/LATE CHG BAL" TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       EXCEEDS-PRIN-BAL.
           MOVE "EXCEEDS PRINCIPAL BAL" TO MESS-MESS.
           COMPUTE MESS-X-MON-5 = LP-CURBAL - LP-OT2BAL.
           PERFORM CONDITIONAL-SEND-MESS.
       EQUALS-PRIN-BAL.
           MOVE "MUST DO PAYOFF TO BRING BALANCE TO ZERO." TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       EXCEEDS-NET-PAYOFF.
           MOVE "EXCEEDS NET PAYOFF AMOUNT OF " TO MESS-MESS.
           MOVE NETDUE-PRIN TO MESS-X-MON-5.
           PERFORM CONDITIONAL-SEND-MESS.
       WILL-CAUSE-PAYOFF.
           MOVE
           "THIS AMOUNT WILL PAYOFF THE ACCOUNT, PLEASE POST A PAYOFF"
                                                                 TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       EXCEEDS-PUR-BAL.
           MOVE LN-PURBAL TO PURBAL-EXCEEDED.
           MOVE PUR-BAL-EXCEEDED TO MESS.
           PERFORM CONDITIONAL-SEND-MESS.
       SEND-ENTRY-LINE.
           MOVE ENTRY-BUF TO WR-BUF.
           MOVE ENTRY-LINE TO WR-LIST.
           PERFORM CALL-WRFORM.
      *    CALL XFER USING STAT ENTRY-LINE ENTRY-BUF.
      *    CALL WRFORM USING STAT ENTRY-LINE.
      *CONVERT-TILLNO-TO-NUMERIC.
      *    MOVE 0 TO NUMERIC-TILLNO.
      *    IF TEST-ALPHA-TILLNO = "1"
      *       MOVE 1 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "2"
      *       MOVE 2 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "3"
      *       MOVE 3 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "4"
      *       MOVE 4 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "5"
      *       MOVE 5 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "6"
      *       MOVE 6 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "7"
      *       MOVE 7 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "8"
      *       MOVE 8 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "9"
      *       MOVE 9 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "A"
      *       MOVE 10 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "B"
      *       MOVE 11 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "C"
      *       MOVE 12 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "D"
      *       MOVE 13 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "E"
      *       MOVE 14 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "F"
      *       MOVE 15 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "G"
      *       MOVE 16 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "H"
      *       MOVE 17 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "I"
      *       MOVE 18 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "J"
      *       MOVE 19 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "K"
      *       MOVE 20 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "L"
      *       MOVE 21 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "M"
      *       MOVE 22 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "N"
      *       MOVE 23 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "O"
      *       MOVE 24 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "P"
      *       MOVE 25 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "Q"
      *       MOVE 26 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "R"
      *       MOVE 27 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "S"
      *       MOVE 28 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "T"
      *       MOVE 29 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "U"
      *       MOVE 30 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "V"
      *       MOVE 31 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "W"
      *       MOVE 32 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "X"
      *       MOVE 33 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "Y"
      *       MOVE 34 TO NUMERIC-TILLNO
      *    ELSE
      *    IF TEST-ALPHA-TILLNO = "Z"
      *       MOVE 35 TO NUMERIC-TILLNO.
      *CONVERT-TILLNO-TO-ALPHA.
      *    MOVE SPACES TO TEST-ALPHA-TILLNO.
      *    IF NUMERIC-TILLNO < 10
      *       MOVE NUMERIC-TILLNO1 TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 10
      *       MOVE "A" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 11
      *       MOVE "B" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 12
      *       MOVE "C" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 13
      *       MOVE "D" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 14
      *       MOVE "E" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 15
      *       MOVE "F" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 16
      *       MOVE "G" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 17
      *       MOVE "H" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 18
      *       MOVE "I" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 19
      *       MOVE "J" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 20
      *       MOVE "K" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 21
      *       MOVE "L" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 22
      *       MOVE "M" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 23
      *       MOVE "N" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 24
      *       MOVE "O" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 25
      *       MOVE "P" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 26
      *       MOVE "Q" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 27
      *       MOVE "R" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 28
      *       MOVE "S" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 29
      *       MOVE "T" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 30
      *       MOVE "U" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 31
      *       MOVE "V" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 32
      *       MOVE "W" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 33
      *       MOVE "X" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 34
      *       MOVE "Y" TO TEST-ALPHA-TILLNO
      *    ELSE
      *    IF NUMERIC-TILLNO = 35
      *       MOVE "Z" TO TEST-ALPHA-TILLNO.

       COPY "LIBWI/PFSWINDOWS.CPY".
       COPY "LIBGB/DATER.CPY".
       COPY "LIBLP/LPITRM.CPY".
       COPY "LIBLP/LPIBPC.CPY".
       COPY "LIBLP/LPRATE.CPY".
       COPY "LIBLP/LPXDTE.CPY".
       COPY "LIBLP/LPLCAS.CPY".
       COPY "LIBGB/SPPDTH.CPY".
       COPY "LIBLP/LPSCHD.CPY".
       COPY "LIBLP/LPLCHG.CPY".
       COPY "LIBLP/LPLCAP.CPY".
       COPY "LIBLP/LPCDEL.CPY".
       COPY "LIBLP/LPCEPP.CPY".
       COPY "LIBLP/LPMDTE.CPY".
       COPY "LIBLP/LPBWIN.CPY".
       COPY "LIBLP/LPCERN.CPY".
       COPY "LIBLP/LPEADJ.CPY".
       COPY "LIBLP/LPUERN.CPY".
       COPY "LIBLP/LPAMTS.CPY".
       COPY "LIBGB/REBATE.CPY".
       COPY "LIBLP/LPDEF.CPY".
       COPY "LIBLP/LPAPRS.CPY".
       COPY "LIBLP/LPAPRZ.CPY".
       COPY "LIBLP/LPUPER.CPY".
       COPY "LIBLP/LPUPWK.CPY".
       COPY "LIBLP/AFPDLLP.CPY".
       COPY "LIBLP/LPREGZ.CPY".
       COPY "LIBGB/SCREEN.CPY".
       COPY "LIBGB/RBACT.CPY".
       COPY "LIBLP/SETCTBL.CPY".
       COPY "LIBLP/LFPAP.CPY".

      ********************************************
       IO-ROUTINES SECTION.
      ********************************************
       COPY "LIBGB/CONNECT_SQL.CPY".
       COPY "LIBLP/LPSPGS_SQL.CPY".
       COPY "LIBLP/LPLTPGS_SQL.CPY".
       COPY "LIBLP/LPLTIGS_SQL.CPY".
       COPY "LIBLP/LPLPGS_SQL.CPY".
       COPY "LIBLP/LPESGS_SQL.CPY".
       COPY "LIBLP/LPDSGS_SQL.CPY".
       COPY "LIBLP/LPDLGS_SQL.CPY".
       COPY "LIBLP/LPCDGS_SQL.CPY".
       COPY "LIBLP/LPCAGS_SQL.CPY".
       COPY "LIBGB/GBBRGS_SQL.CPY".
       COPY "LIBGB/GBGBGS_SQL.CPY".
       COPY "LIBGB/GBBRRN.CPY".
       COPY "LIBGB/GBGBRN.CPY".
       COPY "LIBLP/LPDS1RN.CPY".
       COPY "LIBLP/LPDL1RN.CPY".
       COPY "LIBLP/LPLP1RN.CPY".
       COPY "LIBLP/LPLTP1RN.CPY".
       COPY "LIBLP/LPLTI1RN.CPY".
       COPY "LIBLP/LPSP1RN.CPY".
       COPY "LIBLP/LPCA1RN.CPY".
       COPY "LIBLP/LPCD1RN.CPY".
       COPY "LIBLP/LPWKI.CPY".
       COPY "LIBLP/LPES1RN.CPY".

       COPY "LIBGB/FERRORS.CPY".
           MOVE "E" TO ERRCD.
       END-ROUTINE.
           PERFORM CLOSE-FILES.
       EXIT-PROG.
       STOP-RUN.
           EXIT PROGRAM.
