      * COPYMEMBER: LIBLP/LPEOD5TR
      * A30
      *******************************************************************
      *                   (LPEOD5TR)
      *   T R 1   D E T A I L
      *
      *   COPIED BY LPEOD5.C (UPDATE) & RECAPJ.C (JOURNAL ONLY - NO
      *   UPDATE FROM BALANCING AID WINDOW WHICH OPENS FILES TO INPUT)
      *
      *   NOTE:
      *         THE FOLLOWING PROGRAMS USE THIS COPY MEMBER,
      *                CL/CK1497.C
      *                LP/LPEOD5.C
      *                LP/GLDIST.C
      *                LP/GLRCAP.C
      *                LP/RECAPJ.C
      *
      * REV:
      *  JTG 071795 REVISED FOR CORPORATE BANKING
      *  JTG 072095 REVISED FOR BANK DEPOSIT ACCOUNT
      *  JTG 100395 FIXED 'O2' & 'W2' WHEN UPDATING REPO AR
      *  JTG 010396 CORRECTED UPDATE OF "PA" TRANSACTIONS,
      *             NOT UPDATING GI-PAYALLOT
      *  BAH 022796 ADDED TEST ON BR-SFDLO3-WINDOW-FG = "B" AND SUB = 6
      *             FOR UNEARNED (RELIANCE)
      *  JTG 092096 CHANGED TO HANDLE BULK TRANSFER OF P&L ACCOUNTS
      *  JTG 100796 SWITCHED DB/CR ENTRIES FOR P&L AND P&L OFFSET
      *             FOR BULK TRANSFER OF P&L ACCOUNTS
      *  JTG 101096 CHANGED TO HANDLE CLASS TRANSFER OF ACCOUNTS (J)
      *  JTG 111296 CHANGED TO HANDLE ACCOUNT CONVERSION (K)
      *  JTG 030797 ADDED LOGIC FOR BULK TRANSFER OF REPO ACCOUNTS
      *             ADDED LOGIC FOR CLASS TRANSFER OF REPO ACCOUNTS
      *  JTG 060497 ADDED LOGIC FOR 'R3' & 'C3'
      *  JTG 062797 CORRECTED REV "AP" DISTRIBUTION WHEN ACCOUNT IS 'PL'
      *  JTG 063097 FIXED 'O2' & REV WHEN ACCOUNT IS P&L AR
      *  JTG 063097 CORRECTED BOOKING OF SERVICE ACCOUNTS AND INCORRECTLY
      *               DEBITING DEALER PAYABLE WITH INSURANCE THAT WAS NOT OURS
      *             CORRECTED SERVICE ACCOUNTS REFUNDING OF OUR INSURANCE
      *               NOW DEBITING SERVICE OFFSET AND CREDITING DEALER PAYABLE
      *             CORRECTED SERVICE ACCOUNTS REFUNDING OF DEALERS INSURANCE
      *               NOW CREDITING SERV ACCT RECEIVABLE AND DEBITING SERVICE
      *               OFFSET AND CREDITING DEALER PAYABLE
      *  JTG 071497 ADDED "A" AND "C" OPTIONS FOR DL-PARVPAID-CODE RE: #515
      *  JTG 073097 CORRECTED BULK & CLASS TRANSFER ENTRIES FOR SERVICE ACCOUNTS
      *             P&L AND NON P&L
      *  BAH 080897 O3 ADDON INCOME WAS GOING TO O2 UNEARNED (GI-UNO2)
      *             INSTEAD OF GI-UNO3
      *  JTG 091897 ADDED TEST FOR TRCD = 'AH', WORLD A90
      *  JTG 092497 ADDED GP-INTERBR-AR-AP-FULLGL TO ALLOW DETAIL FROM/TO
      *             BRANCH ON INTERBRANCH PAYMENTS
      *  JTG 121997 CHANGED TO TEST FOR WORLD AND IF SO, TO SET INS UNEARNED
      *             TO SHADOW, ORIG CHG & REFUND GL NUMBERS FOR:
      *             - DIRECT LOAN INPUT
      *             - SALES FINANCE INPUT
      *             - TRANSACTION POSTING
      *             - INSURANCE ADDONS
      *   CS 042798 ADD RENEWAL CODES "RB" AND "RO"
      *  JTG 051198 CHANGED SHADOW FOR ORIG CHG & REFUND GL NUMBERS, PER SANDY
      *                           WRITTEN             REFUNDED
      *                GA  O2     5145201             5145202
      *                TN  O2     5147101             5147102
      *                TN  O3     5155101             5155102
      *  BAH 060598 ADDED UPDATE OF 'PX' PARTIAL CHGOFF, USING GI-PARTIAL-PLEXP
      *             MERCURY, #E175
      *  BAH 062998 RENAMED GI-EREXTCHG TO GI-ERADDON AND CHANGED
      *                     GI-UNEXTCHG TO GI-UNADDON
      *  JTG 063098 ADDED SHADOW FOR SOUTH CAROLINA ORIG CHG & REFUND GL NUMBERS
      *                           WRITTEN             REFUNDED
      *                SC  O2     5147101             5147102
      *                SC  O3     5155101             5155102
      *  JTG 071598 ADDED UPDATE OF TS-PRDLDISC-UNEARN FOR CARRY OVER
      *             OF DISCOUNT ON RENEWALS
      *  BLV 080698 IF INVALID GI, MOVE I TO D TOTT FOR MORE SPECIFIC
      *             ERROR HANDLING IN LONPR0
      *  JTG 082198 CORRECTED UPDATE OF TS-PRDLDISC-UNEARN FOR CARRY OVER
      *             OF DISCOUNT ON RENEWALS
      *  JTG 100698 CORRECTED UPDATE OF TS-PRDLDISC-UNEARN FOR CARRY OVER
      *             OF DISCOUNT ON RENEWALS
      *  JTG 102098 ADDED DL-PARVPAID-FRMLA-IB & DL-PARVPAID-CODE-IB "C"
      *             INSTANT AUTO #744
      *  JTG 111798 ADDED LOGIC FOR REVOLVING 'PU' TRANSACTION, REGENCY REVOL
      *  JTG 120498 ADDED LOGIC FOR REVOLVING 'PY' TRANSACTION, REGENCY REVOL
      *  JTG 990126 ADDED SP-LOANCOST-FRMLA AND SP-LOANCOST-AMT, REGENCY #006
      *  JTG 990126 ADDED SP-LOANCOST-FRMLA 'D',               , TFC     #008
      *  JTG 990324 ADDED 'PN' NON CASH PAYMENT.WITH GL ENTRY           TFC #013
      *             ADDED 'PZ' NON CASH PAYMENT/NO RECDEL.WITH GL ENTRY TFC #012
      *  JTG 990412 CHANGED TO ALLOW SHADOWS FOR WORLD 'OK'
      *  BAH 990412 CHANGED TP-UPDATE-GLS FOR "PZ" AND "PN" TO BE DEBITS, TFC
      *  JTG 990427 CHANGED P&L DISTRIBUTION TO NOT INCLUDE LOAN COSTS IN
      *             P&L EXPENSE REDUCTION AND TO DEBIT UNEARNED COSTS
      *             & CREDIT LOAN COST INCOME
      *  BLV 990624 IF SX OR SV ON PL ACCOUNT, EXIT WITHOUT UPDATING GL
      *             TFC PR#20, GREATER SUBURBAN PR #809
      *  JTG 990706 ADDED LOGIC FOR REVOLVING DIRECT LOAN ADVANCES 'AV'
      *  JTG 990708 ALLOWED SHADOWS FOR WORLD 'TN' O1 & 03
      *  JTG 990809 ADDED LOGIC FOR REVOLVING 'PE' PAYMENT EXCEPTION
      *  CS         ADDED UPDATE OF RESERVES TO 'TK-CODES' (IPF-PURCHASE-FIELDS)
      *  JTG 990901 ADDED 'AP' LOGIC FOR REVOLVING, #47 REGENCY
      *  JTG 991109 ALLOWED ACCOUNTS TO HAVE ADDON'S WHEN IN REPO STATUS,
      *             CHANGED UPD OF DSFILE, TYFILE & LPEOD5TR, NEWPORT #244, A15
      *  JTG 000217 ADDED DL-DISC-CODE-NO-PL-EXP            ACE #980
      *  MJD 000313 ADDED SKIP OF OVER/SHORT LOG, "W" RECORDS. (WORLD PR#219)
      *  GLB 000327 ADDED ROUTINE TO POST INTEREST ROLLED FROM PRINCIPAL
      *             DURING REVOLVING STATEMENT CYCLE
      *  JTG 000330 ADDED SHADOW FOR KENTUCKY ORIG CHG & REFUND GL NUMBERS
      *                                       WRITTEN       REFUNDED
      *                KY  O1   1284002  ->   5155101        5155102
      *                KY  O3   1284003  ->   5145201        5145202
      *  JTG 000417 CHANGED NEW DEFERMENT FORMULA 97 INTDUE OR 1/3 OF REGPAY
      *             TO BE DISBURSED TO LP-APINT AND LP-APCUR, MERCURY #224
      *  JTG 000419 NO CHANGE REQUIRE  4 : MELLON BANK LOCK BOX    (MERC PR#227)
      *  JTG 000626 ADDED SHADOW FOR MISSOURI ORIG CHG & REFUND GL NUMBERS
      *             WORLD #229                WRITTEN       REFUNDED
      *      |SAME AS| MO  O1   1284002  ->   5155101        5155102
      *      |   KY  | MO  O3   1284003  ->   5145201        5145202
      *  JTG 000913 ALLOW POSTING AND REVERSALS OF "PA" (NSF) (LBOX)
      *             TRANSACTIONS  MERCURY PR#234
      *  MJD 000000 ADDED GI-PAYLBOX FOR LOCK BOX ACCOUNTS (MFC PR#237)
      *  MJD 001114 ADDED UPDATE OF GI-PENALTY-INT RE: NEW SOUTH PR#1264 (JTG)
      *  JTG 001117 ADDED LOGIC FOR 'OV' OVERPAYMENT TRANSACTION PR#J015
      *  JTG 001204 CORRECTED LOGIC FOR 'OV' POSTED INTERBRANCH  PR#J015
      *  GLB 010119 CHANGED REVOLVING INSURANCE GL  TO POST EARNED
      *             INSTEAD OF UNEARED ACCOUNTS
      *  JTG 010122 ADDED LOGIC FOR 'PO' 'LBOX' OR 'ALLOT'
      *             GP-ALLOW-SET-FOR-NONCASH, MERCURY #239
      *  JTG 010322 CHANGED TO TEST FOR LP-REFNO = ALLOT, LBOX, TCOLL,
      *             TPAY OR WESTU                                 MERCURY PR#245
      *  JTG 010605 ADDED GP-TRUE-NEXT-BATCH                   (MERC PR#243/251)
      *             GI-PAYTPAY
      *             GI-PAYTCOLL
      *             GI-PAYWESTU
      *  JTG 010613 CORRECTED GP-TRUE-NEXT-BATCH               (MERC PR#243/251)
      *  JTG 010614 ADDED NEW TRCD "OP" FOR AUTOMATIC OT/AP COMBINATION
      *             ADDED NEW TRCD "RE" FOR REPO EXENSE ADDON,   REGACC PR#1478
      *  GLB 010702 ADDED NEW TC-TYPE CODE-"RD" RECEIPT OF DEALER CHECKS
      *  JTG 010808 ADDED SP-LNCOST-FRMLA-VALID 'P' AMORTIZED
      *             PARTICIPATION EXPENSE                         REGACC PR#1559
      *  JTG 010814 CHANGED GI-PAYWESTU TO GI-PAYMGRAM            MERCURY PR#258
      *  JTG 010820 CREATED NOW OPTION 'M' FOR BR-BP-PAYOFF-OV
      *             AND BR-LBOX-PAYOFF-OV WHICH WILL CREATE 'OV' TRANSACTION
      *             BUT WILL NOT CREATE A CHECK REQUEST           MERCURY PR#256
      *  JTG 010911 CHANGED ENTRY OF 'O2' ON P&L TO STOP UPDATE OF GL MERC #260
      *  JTG 010913 CORRECTED SP-LNCOST-FRMLA-VALID 'P' AMORTIZED
      *             PARTICIPATION EXPENSE TO DEBIT OTHER INCOME   REGACC PR#1559
      *  JTG 010914 'RE' ON 'IB' WILL ACT LIKE 'OT' TRANSACTION   REGACC PR#1575
      *  BAH 020204 SALES FINANCE FEE CODES WERE ONLY UPDATING THE FIRST
      *             6, NEEDS TO UPDATE ALL 10 !!!! CAROLINA/JUDY
      *  JTG 020219 ADDED "CT" COUNTY TAX CODE KENTUCKY AND PERCENTS
      *             ADDED "CY" CITY   TAX CODE KENTUCKY AND PERCENTS
      *             ADDED SET OF TP-INS-TAX-RB                      WORLD #288
      *  JTG 020417 WHEN REFUNDS ARE DONE INTERBRANCH ADJUSTMENTS TO
      *             PARTICIPATION PAYABLE SHOULD NOT POST TO GL OF
      *             POSTING BRANCH                          COLONIAL LOAN #358
      *  B&G 020531 ADD LOGIC FOR DEALER ACH DIRECT DEPOSIT (TR-CODE "C"
      *             WITH TC-TYPE OF "AC", REGACC PR# 1797
      *  JTG 020702 ADDED "CT" COUNTY TAX CODE KENTUCKY AND PERCENTS
      *             ADDED "CY" CITY   TAX CODE KENTUCKY AND PERCENTS
      *             CHANGED TO TEST FOR TP-INS-TAX-RB = 2020202.02 WORLD #288
      *  JTG 020730 CHANGED FOR (MIP) MONTHLY INSURANCE PREMIUMS   REGENCY #1801
      *  JTG 020916 ADDED TS-DLCOMM-03-CMSI TS-DLCOMM-PP-CMSI  REGACC #1846
      *  BAH 021014 ADDED NEW TRANSACTION CODE OF "IN" INSURANCE LOSS, EXACTLY
      *             LIKE "PE", REGACC PR# 0007
      *  JTG 021120 ADDED NEW CODE FILE TYPE 'BR' -BATCH PAYMENT REFERENCE CODES
      *             BATCH PAYMENT REVISIONS                         REGACC #0006
      *  JTG 021202 REMOVED NEW CODE FILE TYPE 'BR' -BATCH PAYMENT REFERENCE
      *             CODES BATCH PAYMENT REVISIONS                   REGACC #0006
      *  JTG 021210 ADDED TEST ON CD-BR-FILE-TYPE = 'LC' FOR SET OF BATCH-REFCD
      *             TO LOW-VALUES                                   REGACC #0006
      *  JTG 021211 ADDED TEST FOR TP-REFCD = "     " WHEN TP-TRCD = "PA"
      *             AND DEFAULTED GLNO TO GI-PAYALLOT               REGACC #0006
      *  BLV 030130 ADDED SHADOW FOR ALABAMA ORIG CHG & REFUND GL NUMBERS
      *                                              WRITTEN       REFUNDED
      *             AL  O3 (AUTO LPD)  1284003  ->   5145201        5145202
      *  JTG 030217 CORRECTED LOGIC FOR DELETED SALES FINANCE CONTRACT
      *             WITH SPR COST FORMULA 'P' WHICH WENT THROUGH
      *             AN ACCRUAL BEFORE DELETED. THE ACCRUAL TOOK A SLICE
      *             OF OTHER INCOME AND OTHER UNEARNED MUST BE CLOSED
      *             OUT                                             REGACC #J026
      *  BAH 030424 ADDED LC-USE-ALT-GL-FEE AND CD-GC-ALT-GLFEENO FOR LENDMARK
      *             PR# 2048. ALSO READ OF LC1-FILE.
      *             LENDMARK HAD 2 CORPS, DISTINGUISHED BY LOAN
      *             CLASS, THIS WAY THEY CAN SHARE ALL THE FEE CODES BUT USE
      *             DIFFERENT GL ACCOUNT NUMBERS BASED UPON THE CLASS FLAG.
      *  GLB 030508 WORLD PR#323 ADDED UPDATE OF NEW "CT-FILE";
      *             CODE TRAILER INTERFACE G/L INTERFACE TABLE & AMOUNT
      *             ONLY OCCURS IF CD-GC-FEE-GIFTNET = "Y"
      *  JTG 030624 ADDED LOGIC FOR IB SALES FINANCE AMORTIZATED PARTICIPATION
      *             RESERVE PAID EXPENSE, DIFFERENCE BETWEEN A BUY RATE
      *             AND THE CONTRACT RATE                WISCONSIN FINANCE #2049
      *  BLV 030812 FIX BUG IN PR#323, UPDATE GIFTNET ENTRIES WITH NEW CTFILE:
      *             IF LOAN WAS VOIDED, GL ENTRIES WERE NOT REVERSED, SAME
      *             AMTS UPDATE TO GL AS WHEN LOAN WAS BOOKED.
      *  CS  031111 ADD TEST ON CD-GC-COMM-PERCENT(CDFILE (GC) IF PERCENT IS NOT
      *             ZERO, COMPUTE THE COMMISSION AMOUNT AND USE CD-GC-COMM-GLFEENO
      *             AS THE OFFSET..(TS-OUR-FEES  TL-OUR-FEES) [WORLD PR#331]
      *  BAH 040204 SKIP INSURANCE CLAIM RECORDS, "I", SP/CLAIMS CREATES THE
      *             GT'S, THESE ARE FOR REPORTING ONLY PURPOSES...WORLD 341
      *  BLV 040211 STARRED OFF PERFORMS OF WORLD SWITCHING ROUTINES SO
      *             INSURANCE SHADOWING WILL NOT OCCUR.  NOT TO BE INSTALLED
      *             UNTIL 4/1/04!!!!
2253  *  JTG 040402 ADDED LOGIC FOR POSTING BATCH PAYMENTS TO ACCOUNT'S
2253  *             WITH 'LN-OTBAL'                                CENTRIX #2253
      *  JTG 040502 ADDED LOGIC TO CAUSE THE UNEARNED LOAN COST TO ROLL TO
      *             THE NEW LOAN AFTER 'RENEWAL'. NOTE: THIS COST IS REFLECTIVE
      *             OF THE DISCOUNT WHEN PURCHASING LOAN PAPER NOT CARRIED AS
      *             SALES PAPER WITH DEALER DISCOUNT.
      *             ADDED SP-LNCOST-FRMLA = 'R'                    REGENCY #2287
      *  JTG 040517 CORRECTED LOGIC FOR DIRECT LOANS TO TEST FOR
      *             'SC' SALES FINANCE CONVERSIONS                 REGENCY #2287
      *  JTG 040526 ADDED GL CONTROL FIELDS FOR:
      *                 - UNEARNED INTEREST REPO
      *                 - UNEARNED ADDON INTEREST REPO
      *             THE UNEARNED WILL MOVE TO THESE ACCOUNTS POSTING A 'SX'
      *             AND REVERSING A 'SV'
      *             THE UNEARNED WILL MOVE (BACK) FROM THESE ACCOUNTS POSTING
      *             A 'SV' AND REVERSING A 'SX'                    REGACC #0049
      *  JTG 040614 ADDED LOGIC TO HANDLE BULK TRANSFERS
      *                                   CLASS TRANSFERS
      *                                   ACCOUNT CONVERSIONS
      *             WITH THE NEW REQUIREMENT FOR REGACC #0049
      *  JTG 040722 CREATED NEW TRCD 'ZX' WHAT WORKS LIKE 'SX'     CENTRIX #2314
0447  *  JTG 040810 CORRECTED BUG IN POSTING OF 'PX', WAS NOT UPDATING EARNINGS
      *             AND UNEARNINGS BUCKETS                         REGENCY #0447
2253  *  JTG 040916 CORRECTED LOGIC FOR POSTING BATCH PAYMENTS TO ACCOUNT'S
      *             WITH 'LN-OTBAL'               
      *             IF ON TP-TRCD WAS MISSING 'PA'                 CENTRIX #2253
      *                IF TP-APOTH NOT = 0
      *                   IF ( TP-TRCD = "PY" OR "Z2" OR "PO" OR "PE"
      *                                       OR "IN" OR "SS" OR "AH" OR "PA" )
      *  JTG 040920 ADDED SCCS-COPY-ROUTINE
2253J *  JTG 040921 CHANGED LOGIC FOR POSTING BATCH PAYMENTS TO ACCOUNT'S
      *             WITH 'LN-OTBAL' TO MAKE AN ENTRY FOR LP-APOTH IN THE
      *             TP-GLTABLE WITH CD-BR-OT-GL-BRANCH ACCOUNT NO.
      *             ALLOWING G/L TO UPDATE LIKE A MANUAL 'PY' WITH APPLY TO OTH
      *                                              (MN/CDBRMN) CENTRIX #2253J
      *  JTG 041108 CORRECTED LOGIC FOR GP-AMORTIZE-ACQUIST-FEE, THIS OPTION
      *             TAKES THE AMOUNT ENTERED IN RESERVE PRINCIPAL 3 AND
      *             MOVE IT TO THE LOANS UNEARNED SERVICE CHARGE.
      *             THE LOGIC TO CLEAR TS-ANTICERN(3) IS CORRECT FOR SF CONTRACT
      *             THAT NEVER WENT THROUGH AN ACCRUAL. HOWEVER ACCOUNTS THAT
      *             DID TAKE EARNINGS AND REDUCED UNEARNED, THOSE GL ENTRIES
      *             NEED TO BE OFFSET, WILL LET LIBLP/LPEOD5TR TEST FOR AND
      *             MAKE THOSE ENTRIES                              REGACC #0081
      *  BLF 041216 BARB & CINDY - FIXED UPDATE OF "RD", RECEIPT INTO DEALER
      *             PROCEEDS.  IT WAS DEBITING DEALER PAYABLE & CREDITING THE
      *             BANK.  FIXED TO CREDIT DEALER PAYABLE & DEBIT THE CASH
      *             DRAWER PER LAURA.  THIS EVIDENTALLY NEVER WORKED???!!
      *  JTG 050104 CORRECTED LOGIC FOR REVERSING A 'SX' THE IF WAS MISSING
      *             A SET OF ()'S. CORRECTED 'IF' FOLLOWS
      *             IF ( (TP-TRCD = "SX" OR "ZX") AND (TP-REV NOT = "Y") )
      *                   OR (TP-REV = "Y" AND TP-TRCD = "SV")    PL# 457
      *  JTG 050105 CORRECTED LOGIC FOR REGACC #0081 WHEN TS-EARNINGS()
      *             WAS NOT < 0                                    REGACC #0081
      * JTG 050621 ADDED CHANGES FOR REPORTING AND TAKING FEE CODE EARNINGS
      *            CREATED CD-GC-FEE-EARNINGS-FG                     LENDMARK #2542
      *  CS 050728 CHANGED TEST OF TP-IBPC TO TP-LOANTYPE IN TP-LP-NP-RT-ET-ST
      *            (ADDONS). WAS CAUSING GL OUT OF BALANCE IF AN ACCOUNT WAS IN
      *            IB STATUS(EXPIRATION ON ORIGINAL MATURITY) BUT ADDON USED
      *             UPDATED.
      *
      * CONTRACT 1ST PMNT MATURITY  DF 1
      * 05/25/01 07/02/01 07/02/05
      * 060305 RT CNLO3   17.07-   .53-   16.54-0505   .22   1017.39
      *
      * WAS DEBITING UNEARNED INT FOR .53 BUT TP-IBPC = "I" SO RECIEVABLE WAS
      * BEING CREDITED FOR 16.54 (TP-APCUR) INSTEAD OF 17.07 CAUSING OUT OF BAL
      *  JTG 051007 ADDED LN-POCD-UNWIND "*U" A LN-POCD-NONLOAN
      *                   AND LN-UNWIND-REASON-CODE                 REGACC #0105
      * BAH 060622 MIP INSURANCE WAS NOT CREATING GT TRANSACTIONS FOR RENEWALS
      *            LONPF2 WAS CHANGED ON 7/14/05 PL# 499, FORGOT TO CHANGE THIS
      *            REGWAN PL# 539
      *  CS 060824 PUT BACK TEST IF IBPC = "I" (REMOVED 7/28/05 CHANGE) WAS NOT
      *            CORRECT PR#498 SMITHFIELD
      * BAH 060824 DO NOT UPDATE TP-REVOL-INS OR TP-REVOL-APOTH FOR THE POSTING
      *            BRANCH, ONLY THE OWNING BRANCH, REGWAN PL# 511
      *            INTERBRANCH REVOLVING !

      *  CS 061128 WHEN SP-LNCOSTS SET TO "3", CAUSED PRE-COMP LOANS TO GO TO GL
      *            OUT OF BALANCE.. AN EXTRA DEBIT WAS CREATED TO PARTICIPATING
      *            RESERVE AS WELL AS OTHER EARNINGS.. SO MAKE IT WORK FOR
      *            PRECOMP LOANS,ALSO IF 'IB' SP-LNCOSTS(P OR 3) AND YOU ENTER
      *            PARTIC PAID AND HELD ITS OUT OF BALANCE   PR#559 COLONIAL
      *  CS 061130 DL-PARVHELD-CODE 'B' WAS STILL CAUSING AN OUT OF BALANCE
      *            PROBLEM PR#559
      * BLF 071214 IF TRC RECORD FOR DP CHECK FLAGGED AS BEING PAID THROUGH
      *            ACH DIRECT DEPOSIT (TC-TYPE = DP, TC-ACH-FG = Y), USE
      *            GI-ACH-BANK INSTEAD OF GI-BANK, REGACC PR# 185
      *  CS 080202 ALLOWED RESERVE PRIN3 IF GP-I-AM-MIDATL.. CHANGED TK-CODES
      *            TO UPDATE THE RESERVE   MIDATL PR#3136
      *  CS 080303 THIS CHANGE WAS MADE 02/06/08 TO UPDATE UPFRONT EARNINGS IN
      *            CONVERSION. ADDED TK-SET-EARNED SECTION
      *  CS 081208 IF (BR-USE-PARTIC-FLAT-TABLE = "Y" AND GP-I-AM-REGACC)
      *            UPDATE PARTICIPATION HELD TO GI-ERMAINTFEE INSTEAD OF
      *            GI-DLPARVEX, ALSO USE THIS FLAG TO SET UNEARNED
      *            ENTRY REGACC PR# 185
      *  CS 081215 IF BR-USE-PARTIC-FLAT-TABLE = Y AND GP-I-AM-REGACC, CHANGED
      *            TB-CODES/TB-SET-EARNINGS. REGAC WANTED TO DO THE OPPOSITE
      *            OF THE NORMAL FLOW OF UNEARNED/EARNED ON A BULK TRANSFER.
      *            SO IF YOU ARE RUNNING AS ABOVE, THE TRANSFERRING BR WILL
      *            HAVE A CREDIT TO THE EARNED-GL NUMBER, THE RECEIVING BRANCH
      *            A DEBIT TO THE EARNED-GL NUMBER. PR#232
      *  CS 081215 ALSO FOUND A PROBLEM ON THE VOID OF A LOAN IF GONE THRU
      *            AN ACCRUAL WITH BR-USE-PARTIC-FLAT-TABLE = "Y" PR#232
      *  CS 090108 PER KEVIN MULLEN, CHANGE TEST ON BR-USE-PARTIC-FLAT-TABLE
      *            TO GP-INCL-OTH-IN-EARNED = "R". REGACC SHOULD BE THE
      *            ONLY CUSTOMER TO USE 'R'. PR#232
      * BLM 100309 ADD LOGIC FOR "ED" TRANSACTION, DISBURSE ESCROW,
      *            REGWAN PR# 3506
      * BLM 100309 ADD LOGIC FOR UPDATING TP-APPLIED-TO-ESCROW TO ESCROW
      *            BALANCE GL ACCOUNT, REGWAN PR# 3506
      *  CS 100309 TEST FOR 20202.02/02020.20 TP-APPLIED-TO-ESCROW PR#3506
      * BLM 100309 REMOVE LOGIC FOR UPDATE OF ESCROW PREPAYMENT FOR 'ES'
      *            TRANSACTION, CHANGE TO UPDATE PREPAY ON 'EP', CHANGE
      *            'DE' TRAN CODE TO 'ED', REGWAN PR# 3506
      *  CS 100309 ADD TEST OF TP-OTHBR-FG = " " OR "G" BEFORE UPDATING
      *            APPLIED-TO-ESCROW, REGWAN PR# 3506
      * BLM 101011 FOR PAYMENT ON SERVICE ACCOUNT THAT HAS BEEN CHARGED
      *            OFF, END-OF-DAY WAS CREDITING THE TOTAL OF TP-APINT
      *            & TP-APLC TO P&L INTEREST, GI-PLINT(PLSUB).  THIS
      *            CAUSED GL TO BE OUT OF BALANCE.  (TP-APINT/APLC ARE
      *            PERCENTS BASED ON DL-SVACCT-RATE).  CHANGED TO
      *            CREDIT P&L INTEREST WITH TOTAL OF TP-EARNINGS(2) &
      *            TP-EARNINGS(3).  SECURITY PL# 707
      *  CS 110407 ADD SP-LNCOST-FRMLA '4' DOES THE FLAT AMOUNT IDENTIFIED
      *            IN LOAN COST, PLUS TAKES THE PARTIC PAID & UPDATES
      *            SERVICE CHARGE EARNINGS (LN-ACCERN(3).
      *  CS 120223 UPDATE THE BR-GLBANK-DEPOSIT IF TC-TYPE = 'ID', 'IW' WAS
      *            AREADY UPDATING IF TC-TYPE = "BK"  WORLD PR#790
      * KEC 131106 {PR#345} REGIONAL ACCEPTANCE <A15> [KEVIN MULLEN]
      *            ADD SP-LNCOST-FRMLA '5' WHICH IS THE SAME AS
      *                SP-LNCOST-FRMLA '4' BUT UPDATE PARTIC PAID '4'.
      *  CS 140224 KM WANTED MAINTFEE UNEARNED NOT TO DECREASE THE P&L EXP BUT
      *            TO FULLY AMORTIZE THE PREPAID(MAINT FEE INCOME (CR)
      *            WHEN GP-INCL-OTH-IN-EARNED = "R"     REGACC PL840
      *  CS 150812 ADD CD-BRANCH-COMM-AMOUNT, THIS AMOUNT WHEN ENTERED WILL
      *            REMAIN IN CD-GC-GLFEENO AND THE REMAINDER WILL GO TO
      *            CD-GC-COMM-GLFEENO.(OPPOSITE OF NORMAL FLOW) SO ITS TIED
      *            TO GP-I-AM-EXCEL  EXCEL PR#4821
      *  CS 150922 WITHIN PERFORM EXCEL-BRANCH-COMM IF SALES MISSING AN EXIT
      *            AND FALLING THRU TO EXCEL-LOAN EXCEL PR#4821
      * BAH 151021 REMOVED B2FILE, PD0003
      *  CS 160105 ABILITY TO POST PA,PE,PO INTERBRANCH AND PRODUCED GL FOR
      *            BOTH BRANCHES PR#1127 (BARB ALLOWED THIS 7/14) ADDED IF
      *            GP-I-AM-WORLD,POSTING INTERBRANCH, AND USING PA-DEBIT,
      *            PE-DEBIT, OR PO-DEBIT, WITH REFCD 'DEBIT' PRODUCE GL ENTRIES
      *            FOR BOTH BRANCHES.
      *              EX: POSTING PA-DEBIT INTERBRANCH
      *                   POSTING BR
      *                   DB VISA   CR INTERBRANCH REC
      *                   POSTED TO BR:
      *                   DB INTERBRANCH CR RECEIVABLE
      *  CS 160201 SAVED VERSION IS GL01GI.160105 HAS THE USE OF GI-ACCTNO   
      *            (GISUB) FOR EARNED & UNEARNED GL'S
      *  CS 160201 REMOVED USE OF GISUB AS SUBSCRIPT TO GET THE GI UNEARNED'S
      *            AND GI-EARNING'S.
      * KEC 2016.0314 {PD#00003} PARADATA <A30> [JAY CISZEWSKI]
      *         CHANGED CD-FEE???? TO CD-GC-????.
      * BLM 160726 IF GP-I-AM-WORLD & CD-GC-COMM-PERCENT = 99.99, FORCE THE
      *            PAYABLE PERCENT TO 100, FOR LIVE CHECKS, WORLD PR# 1170
      * BLM 161012 IF BR-ALLOW-SCANNED-CKS = "Y", INCLUDE TD-CHECK-DEPOSIT
      *            IN CREDIT TO CASH ON HAND, & MAKE DEBIT TO BR-CHECK-
      *            DEPOSIT-GL.  I AM NOT DOING BANK CLEARING FOR THIS
      *            OPTION; WORLD WILL HAVE 0 IN GP-BANK-GL. WORLD PR# 1188
      *  CS 170110 FIXED SET-TB-UNEARNED. WHEN GP-NEW-REPO-UNEARNED-ACCTS = 
      *            "Y" AND NOT GP-I-AM-RGAC. IF THIS FLAG WAS SET TO "Y"
      *            NO ENTRIES FOR INTEREST/ADDON INTEREST WERE BEING MADE.
      *            BEST GUESS, NO ONE OTHER THAN RGAC USES THIS FLAG OTHER
      *            THAN RGAC, AND THEY NO LONGER DO PRECOMP LOANS.
      *  CS 171219 ADDED TO TEST ON PERFORM-WORLD-DEBIT, INCLUDE DEBIT
      *            PHDBT, PHACH TO USE THE SAME GL FUNCTIONALITY
      *            AS DEBIT PR#1290 WORLD
      *  CS 180302 CHANGED TL-CODES TO UPDATE FOR PREPAID DEBIT CARDS TO 
      *            BR-GL-DEBIT-CARD-PROCEEDS GL NUMBER. ALSO PREPAID
      *            PROCEEDS WILL NOT BE REFELCTED IN DIRECT PAYABLE
      *                                            WORLD PR#1306
      * BAH 190422 NEW TRFILES
      * BAH 20190627 REMOVED REVOLVING, PT0153
      * BAH 20190927 WAS MISSING UPDATE-WORK-FILE-TRP, THEREFORE, PAYMENTS
      *              WERE NOT UPDATING TO THE ED-FILE WORK FILE.
      * BAH 20200625 REMOVED OPEN-CD1-FILE, CLOSE-CD1-FILE, ADD TO PROGRAMS
      *                      OPEN-LC1-FILE, CLOSE-LC1-FILE
      *                      OPEN-GI1-FILE, CLOSE-GI1-FILE #TST001
      * BAH 2020.0720 TEST GP-NO-GL-ON-O2-WHEN-PL FOR "OP", MADE TP-OP A
      *               SEPARATE PART FROM TP-AP-OP-REC. DONT ENTER GL # WHEN
      *               POSTING AND DONT UPDATE RECOVERY/EXPENSE. #1453
      * BAH 20210208 DO NOT ALLOW CD-BR-FILE-TYPE "C", UMC DEBIT CARD
      * BAH 2021.0308 ADDED TC-TYPE "DB" DEBIT CARD UMC PROCESSING #1490
      * BAH 2021.0422 ADDED TR-POSTING-BR AND TR-OTHBR-FG FOR GLRCAP EXTRACT
      *                                                            #1496 
      * BAH 2021.0910 COMMENTED OUT CLOSE-BR-FILE, LP/RECAPJ GIVING ERROR 9
      *               ON READ NEXT, GOES BACK TO GROUP LOGIC AND FILE IS
      *               CLOSED WITHOUT A START AGAIN, CURSOR HAS TO STAY IN
      *               PLACE  (9/10/2021)
      * BAH 2022.0602 ADDED TR-ACTIONCD2 FOR GLRCAP EXTRACT, SECURITIZATION
      *                                                            #1555 
      **********************************************************************
      ********************
      *   SALES FINANCE  *
      ********************

      ******************************************************
       TRS1-DETAIL SECTION.
      ******************************************************

           MOVE TS-BRNO TO BR-NO.
           PERFORM LPEOD5TR-GET-BR.
           IF ERROR-FG = "Y"
              GO TO EXIT-TRS1-DETAIL.

           MOVE TS-BRNO  TO GI-BRANCH.
           MOVE TS-CLASS TO GI-CLASS.
           PERFORM LPEOD5TR-GET-GI.
           IF ERROR-FG = "I"
              GO TO EXIT-TRS1-DETAIL.

           MOVE TS-CLASS TO LC-CODE.
           PERFORM LPEOD5TR-GET-LC.

           IF TS-SERVACCT = "Y"
              PERFORM TS-SERV-ACCOUNTS
              GO TO EXIT-TRS1-DETAIL.
     
           MOVE GI-AR    TO GLNO.
           MOVE TS-LNAMT TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

0105  * TEST FOR UNWIND OR VOID
      * WHEN UNWIND PUT PROCEEDS IN CASH DRAWER
      *   "  VOID   PUT PROCEEDS IN DEALER PAYABLE
           IF TS-UNWIND-REASON-CODE NOT = " "
              MOVE GI-CASH TO GLNO
           ELSE
              MOVE GI-DLPAYABLE TO GLNO.
           SUBTRACT TS-PROCEEDS FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

           MOVE GI-DLRVPRIN-1 TO GLNO.
           SUBTRACT TS-DLRVPRIN(1) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

           MOVE GI-DLRVPRIN-2 TO GLNO.
           SUBTRACT TS-DLRVPRIN(2) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

           MOVE GI-DLRVPRIN-3 TO GLNO.
           SUBTRACT TS-DLRVPRIN(3) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

           MOVE GI-DLRVCHGS-1 TO GLNO.
           SUBTRACT TS-DLRVCHGS(1) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

           MOVE GI-DLRVCHGS-2 TO GLNO.
           SUBTRACT TS-DLRVCHGS(2) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

           MOVE GI-DLRVCHGS-3 TO GLNO.
           SUBTRACT TS-DLRVCHGS(3) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

           MOVE GI-DLPARV TO GLNO.
           SUBTRACT TS-DLPARVHELD FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

1846       IF GP-DLCOMM-CMSI-FG = "Y"
              MOVE GI-PLNEW-AR(4)    TO GLNO
              MOVE TS-DLCOMM-PP-CMSI TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRS

              MOVE GI-PLNEW-AR(5)    TO GLNO
              MOVE TS-DLCOMM-O3-CMSI TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRS.

      * LNCOST-FRMLA 'P' HAS NO ENTRY TO PARTICIPATION EXPENSE
      *                  BUT A DEBIT TO ANTICERN(6) EARNINGS
      *              '3' HAS NO ENTRY TO PARTICIPATION EXPENSE
      *                  BUT A DEBIT TO ANTICERN(6) EARNINGS
2049  *    IF NOT (TS-SP-LNCOST-FRMLA = "P" OR "3")
      *       IF NOT (TS-DL-PARVHELD-CODE = "B" AND TS-LOANTYPE = "P")
      *          MOVE GI-DLPARVEX TO GLNO
      *          MOVE TS-DLPARVHELD TO GLAMT
      *          PERFORM UPDATE-WORK-FILE-TRS.

      *    IF TS-LOANTYPE = "P"
      *       IF NOT (TS-DL-PARVPAID-CODE = " ")
      *             MOVE GI-DLPARVEX TO GLNO
      *             MOVE TS-DLPARVPAID TO GLAMT
      *             PERFORM UPDATE-WORK-FILE-TRS.

      *------------------------------------------------------------------
      *  JTG 102098 ADDED DL-PARVPAID-FRMLA-IB & DL-PARVPAID-CODE-IB "C"
      *             INSTANT AUTO #744
      * LNCOST-FRMLA '3' HAS NO ENTRY TO PARTICIPATION EXPENSE
      *                  BUT A DEBIT TO ANTICERN(6) EARNINGS

      * CS 120908  REGACC BR-USE-PARTIC-FLAT-TABLE, WHEN 'Y' NO ENTRY TO
      *            PARTICIPATION EXPENSE OCCURS, BUT RATHER A DEBIT TO
      *            ANTICERN(4).
      *

      *    IF (GP-INCL-OTH-IN-EARNED-R AND GP-I-AM-REGACC)
      *       MOVE GI-ERMAINTFEE TO GLNO
      *       MOVE TS-DLPARVHELD TO GLAMT
      *       PERFORM UPDATE-WORK-FILE-TRS
      *    ELSE
2049       IF NOT (TS-SP-LNCOST-FRMLA = "P")
              IF NOT (TS-DL-PARVHELD-CODE = "B" AND
                      TS-LOANTYPE = "P")
                 MOVE GI-DLPARVEX TO GLNO
                 MOVE TS-DLPARVHELD TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRS.

           IF NOT (TS-SP-LNCOST-FRMLA = "3" OR "4" OR "5")
               IF NOT (TS-DL-PARVPAID-CODE = SPACES)
                  MOVE GI-DLPARVEX TO GLNO
                  MOVE TS-DLPARVPAID TO GLAMT
                  PERFORM UPDATE-WORK-FILE-TRS.

      * SET EARNINGS:
           MOVE 1 TO SUB.
           PERFORM TS-SET-EARNINGS 6 TIMES.

      * SET INS PAYABLE:
           PERFORM TS-OUR-INS.

      * SET FEES:
           MOVE 1 TO L1.
           PERFORM TS-OUR-FEES 10 TIMES.

           IF TS-PRDLDISC-UNEARN = 2020202.02 OR 0202020.20
              MOVE 0 TO TS-PRDLDISC-UNEARN.
      * UPDATE CARRY OVER DISCOUNT UNEARNED ON RENEWALS:
           IF TS-SRCD = "PB" OR "RN" OR "RB" OR "RO"
              IF TS-PRDLDISC-UNEARN NOT = 0
2287             IF TS-SP-LNCOST-FRMLA = "R"
      *            ANTIC (OTHER) EARNINGS:

                    MOVE GI-EROTHER     TO GLNO
                    MOVE TS-PRDLDISC-UNEARN TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRS
                 ELSE
      *            UNEARNED (DLDISC):
                    MOVE GI-UNDLDISC TO GLNO
                    SUBTRACT TS-PRDLDISC-UNEARN FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRS
      *            ANTIC EARNINGS (DLDISC):
                    MOVE GI-ERDLDISC    TO GLNO
                    MOVE TS-PRDLDISC-UNEARN TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRS.

           GO TO EXIT-TRS1-DETAIL.

      *****************************************
      *    SERVICE ACCOUNTS
      *****************************************
       TS-SERV-ACCOUNTS.
           MOVE GI-AR TO GLNO.
           MOVE TS-LNAMT TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

           MOVE GI-SERVOFF TO GLNO.
           SUBTRACT TS-LNAMT FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

           MOVE 0 TO GLWK.
           PERFORM TS-OUR-INS.
           MOVE 1 TO L1.
           PERFORM TS-OUR-FEES 10 TIMES.

           MOVE GI-DLPAYABLE TO GLNO.
           MOVE GLWK TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRS.

      *******************************************
      * UPDATE OUR INSURANCES:
      *******************************************
       TS-OUR-INS.
           IF TS-INSOURS(1) = "Y"
              IF TS-INSTYPES-DL
                 MOVE GI-PAYCL1 TO GLNO
                 SUBTRACT TS-INSPREM(1) FROM TS-INSCOMM(1)
                                                 GIVING GLAMT
                 PERFORM UPDATE-WORK-FILE-TRS
                 MOVE GI-UNCL1 TO GLNO
      *            PERFORM WORLD-SWITCH-TO-ORIG
                 SUBTRACT TS-INSCOMM(1) FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRS
                 IF TS-SERVACCT = "Y"
                    ADD TS-INSPREM(1) TO GLWK.
           IF TS-INSOURS(1) = "Y"
              IF TS-INSTYPES-LL
                 MOVE GI-PAYCL2 TO GLNO
                 SUBTRACT TS-INSPREM(1) FROM TS-INSCOMM(1)
                                                 GIVING GLAMT
                 PERFORM UPDATE-WORK-FILE-TRS
                 MOVE GI-UNCL2 TO GLNO
      *            PERFORM WORLD-SWITCH-TO-ORIG
                 SUBTRACT TS-INSCOMM(1) FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRS
                 IF TS-SERVACCT = "Y"
                    ADD TS-INSPREM(1) TO GLWK.
           IF TS-INSOURS(2) = "Y"
              MOVE GI-PAYAH TO GLNO
              SUBTRACT TS-INSPREM(2) FROM TS-INSCOMM(2)
                                                 GIVING GLAMT
              PERFORM UPDATE-WORK-FILE-TRS
              MOVE GI-UNAH TO GLNO
      *            PERFORM WORLD-SWITCH-TO-ORIG
              SUBTRACT TS-INSCOMM(2) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRS
              IF TS-SERVACCT = "Y"
                 ADD TS-INSPREM(2) TO GLWK.
           IF TS-INSOURS(3) = "Y"
              MOVE GI-PAYPP TO GLNO
              SUBTRACT TS-INSPREM(3) FROM TS-INSCOMM(3)
                                                 GIVING GLAMT
              PERFORM UPDATE-WORK-FILE-TRS
              MOVE GI-UNPP TO GLNO
      *            PERFORM WORLD-SWITCH-TO-ORIG
              SUBTRACT TS-INSCOMM(3) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRS
              IF TS-SERVACCT = "Y"
                 ADD TS-INSPREM(3) TO GLWK.
           PERFORM TS-OURS-UNOT VARYING SUB FROM 4 BY 1
                  UNTIL SUB > 8.

      *******************************************
      *    UPDATE OUR OTHER INSURANCES:
      *******************************************
       TS-OURS-UNOT.
      * ADDED "B" FOR RELIANCE
           IF TS-INSOURS(SUB) = "Y" OR (BR-SFDLO3-WINDOW-FG = "B" AND
                                        SUB = 6)
              MOVE GI-UNOT(SUB - 3) TO GLNO
      *            PERFORM WORLD-SWITCH-TO-ORIG
              SUBTRACT TS-INSCOMM(SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRS
              IF SUB = 6
                 MOVE GI-PAYOT(SUB - 3) TO GLNO
                 COMPUTE GLAMT =
                    (TS-INSCOMM(SUB) + TS-O3INS-DLPROC)
                                             - TS-INSPREM(SUB)
                 PERFORM UPDATE-WORK-FILE-TRS
                 IF TS-SERVACCT = "Y" AND TS-INSOURS(SUB) = "Y"
                    ADD TS-INSPREM(SUB) TO GLWK
                 ELSE
                    NEXT SENTENCE
              ELSE
                 MOVE GI-PAYOT(SUB - 3) TO GLNO
                 SUBTRACT TS-INSPREM(SUB) FROM TS-INSCOMM(SUB)
                                                 GIVING GLAMT
                 PERFORM UPDATE-WORK-FILE-TRS
                 IF TS-SERVACCT = "Y" AND TS-INSOURS(SUB) = "Y"
                    ADD TS-INSPREM(SUB) TO GLWK.

      *******************************************
      *    UPDATE OUR FEES:
      *******************************************
      * 11/11/03
      * WHEN FEE CODE IS OURS (TS-FEEOURS = "Y) AND THE COMMISSION FIELD ( CD-
      * GC-COMM-PERCENT) IN THE FEE CODE IS NON-ZERO A COMMISSION AMOUNT WILL BE
      * COMPUTED AND UPDATE GL NUMBER (CDB-GC-COMM-GLFEENO) IN THE FEE CODE
      * FILE.
      *
      *EXAMPLE: FEE 01 20.00  CDB-GC-COMM-GLFEENO = 1111111
      *                       CDB-GC-COMM-PERCENT 10.00
      * THE TS-FEEAMT IS SUBTRACTED FROM COMPUTED COMMISSION (THIS IS THE AMOUNT
      * TO THE PAYABLE...9.00 & AN ADDITIONAL ENTRY OF 1.00 TO GL 1111111
       TS-OUR-FEES.
           IF TS-FEEOURS(L1) = "Y"
              MOVE TS-FEECODE(L1) TO CDB-CODE
              MOVE TS-BRNO        TO CDB-BRANCH GLNO-BR
              PERFORM GET-CODE
              IF IO-FG = 0
                 PERFORM TEST-BR-FEE-GL-BRNO
                 MOVE CDB-GC-GLFEENO TO GLNO-NUMBER
                 IF (LC-USE-ALT-GL-FEE = "Y" AND
                       CDB-GC-ALT-GLFEENO NOT = 2020202 AND
                        CDB-GC-ALT-GLFEENO NOT = 0)
                    MOVE CDB-GC-ALT-GLFEENO TO GLNO-NUMBER
                 END-IF
                 IF (CDB-GC-COMM-PERCENT = 99.99)
                    MOVE 100 TO HOLD-COMM-PERCENT
                 ELSE
                    MOVE CDB-GC-COMM-PERCENT TO HOLD-COMM-PERCENT
                 END-IF
                 MOVE 0 TO FEE-COMMISSION
                 IF HOLD-COMM-PERCENT NOT = 0 AND
                     HOLD-COMM-PERCENT NOT = 20.20
                   COMPUTE FEE-COMMISSION =
                     HOLD-COMM-PERCENT / 100 * TS-FEEAMT(L1)
                 END-IF
                 SUBTRACT TS-FEEAMT(L1) FROM FEE-COMMISSION
                                        GIVING GLAMT
                 PERFORM UPDATE-WORK-FILE-TRS
                 IF FEE-COMMISSION NOT = 0
                    MOVE CDB-GC-COMM-GLFEENO TO GLNO
                    SUBTRACT FEE-COMMISSION FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRS
                 END-IF
                 IF TS-SERVACCT = "Y"
                    ADD TS-FEEAMT(L1) TO GLWK
                 END-IF
                 IF CDB-GC-FEE-EARNINGS-FG = "Y"
                    MOVE GI-UNADDON        TO GLNO
                    SUBTRACT TS-FEEAMT(L1) FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRS
                    MOVE GI-ERADDON     TO GLNO
                    MOVE TS-FEEAMT(L1)  TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRS.

           ADD 1 TO L1.

      *******************************************
      *    SET ANTICIPATED EARNINGS FOR ACCOUNTS:
      *******************************************
       TS-SET-EARNINGS.
      * #2542
      * WILL SKIP UPDATING EARN/UNEARN FOR ADDONS SINCE,
      * ADDON ANTICPATED DOSN'T EXIST AT LOAN BOOKING
      * EXCEPT FOR FEES BOOKED THAT ARE SET WITH CDB-GC-FEE-EARNINGS-FG = 'Y'
      * AND THE GL EARN/UNEARN UPDATE WILL TAKE PLACE IN THE TS-OUR-FEES
      * PARAGRAPH.

           IF SUB NOT = 2
            IF TS-ANTICERN(SUB) NOT = 0
              IF SUB = 3 AND GP-AMORTIZE-ACQUIST-FEE = "Y"
                 IF TS-EARNINGS(SUB) < 0
                    MOVE GI-UNEARN(SUB)   TO GLNO
                    MOVE TS-EARNINGS(SUB) TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRS

                    MOVE GI-EARN(SUB)         TO GLNO
                    SUBTRACT TS-EARNINGS(SUB) FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRS

                 ELSE
      * DUMMY MOVE TO AVOID NEXT SENTENCE
                    MOVE 0 TO GLAMT
                 END-IF
              ELSE
      * UNEARNED:
                 MOVE GI-UNEARN(SUB) TO GLNO
      * LNCOST FRMLA 'P' OR '3' DEBITS OTHER EARNED INSTEAD OF
      *                         THE USUAL PARTICIPATION HELD EXPENSE
                 IF (SUB = 6) AND (TS-SP-LNCOST-FRMLA = "P" OR "3")
      * CLOSE OUT OTHER UNEARNED ON DELETED ACCOUNTS THAT TOOK AN
      * ACCRUAL PRIOR TO DELETION
                    MOVE TS-EARNINGS(SUB) TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRS
                    MOVE GI-EARN(SUB)     TO GLNO
                    MOVE TS-ANTICERN(SUB) TO GLAMT
                 ELSE
                    IF (SUB = 3 AND TS-SP-LNCOST-FRMLA = "4") OR
                       (SUB = 4 AND TS-SP-LNCOST-FRMLA = "5")
                       MOVE TS-EARNINGS(SUB) TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRS
                       MOVE GI-EARN(SUB)     TO GLNO
                       MOVE TS-ANTICERN(SUB) TO GLAMT
                    ELSE
                       MOVE TS-EARNINGS(SUB)     TO GLAMT
                       SUBTRACT TS-ANTICERN(SUB) FROM GLAMT
      *                IF (SUB = 4 AND GP-I-AM-REGACC AND
      *                                GP-INCL-OTH-IN-EARNED-R)
      *                   MOVE TS-EARNINGS(SUB)     TO GLAMT
      *                END-IF
                    END-IF
                 END-IF
                 IF SUB = 5
                    ADD TS-PRDLDISC-UNEARN TO GLAMT
                 END-IF
                 PERFORM UPDATE-WORK-FILE-TRS

      * ANTICERN(6) IS LOAN COSTS AND IT REQUIRES AN OFFSET TO
      * EARNINGS: EX. CREDIT ANTIC & DEBIT INCOME
2287             IF NOT (TS-SP-LNCOST-FRMLA = "D" OR "P" OR
                                              "3" OR "R" )
                    IF SUB = 6
                       MOVE GI-EARN(SUB)     TO GLNO
                       MOVE TS-ANTICERN(SUB) TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRS
                    END-IF
                 END-IF

      * ANTIC EARNINGS:
                 MOVE GI-EARN(SUB)   TO GLNO
                 SUBTRACT TS-EARNINGS(SUB) FROM GLAMT
      *          END-IF
                 PERFORM UPDATE-WORK-FILE-TRS.
           ADD 1 TO SUB.

       EXIT-TRS1-DETAIL.
           EXIT.

      ******************************************
      *    S.F. TRANSFERS TO/FROM SERVICE
      ******************************************

      ******************************************************
       TRX1-DETAIL SECTION.
      ******************************************************

           MOVE TX-BRNO TO BR-NO.
           PERFORM LPEOD5TR-GET-BR.
           IF ERROR-FG = "Y"
              GO TO EXIT-TRX1-DETAIL.

           MOVE TX-BRNO  TO GI-BRANCH.
           MOVE TX-CLASS TO GI-CLASS.
           PERFORM LPEOD5TR-GET-GI.
           IF ERROR-FG = "I"
              GO TO EXIT-TRX1-DETAIL.

           MOVE TX-CLASS TO LC-CODE.
           PERFORM LPEOD5TR-GET-LC.

           IF TX-SERVACCT NOT = "Y"
              GO TO TX-SERV-TO-PUR.

      * TRANSFER FROM PURCHASED TO SERVICE:
           MOVE GI-AR     TO GLNO.
           MOVE TX-TFRBAL TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-SERVOFF TO GLNO.
           SUBTRACT TX-TFRBAL FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.
           GO TO EXIT-TRX1-DETAIL.

      * TRANSFER FROM SERVICE TO PURCHASED:
       TX-SERV-TO-PUR.
           MOVE GI-AR     TO GLNO.
           MOVE TX-PURBAL TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-DLPAYABLE TO GLNO.
           SUBTRACT TX-PROCEEDS FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-DLRVPRIN-1 TO GLNO.
           SUBTRACT TX-DLRVPRIN(1) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-DLRVPRIN-2 TO GLNO.
           SUBTRACT TX-DLRVPRIN(2) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-DLRVPRIN-3 TO GLNO.
           SUBTRACT TX-DLRVPRIN(3) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-DLPARV TO GLNO.
           SUBTRACT TX-DLPARVHELD FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-UNDLDISC TO GLNO.
           SUBTRACT TX-DLDISC FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-UNINTCHG TO GLNO.
           MOVE 1 TO FUNK-SUB.
           SUBTRACT TX-ANTICERN(FUNK-SUB) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-UNADDON  TO GLNO.
           MOVE 2 TO FUNK-SUB.
           SUBTRACT TX-ANTICERN(FUNK-SUB) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-UNSERCHG TO GLNO.
           MOVE 3 TO FUNK-SUB.
           SUBTRACT TX-ANTICERN(FUNK-SUB) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

           MOVE GI-UNMAINTFEE TO GLNO.
           MOVE 4 TO FUNK-SUB.
           SUBTRACT TX-ANTICERN(FUNK-SUB) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRX.

       EXIT-TRX1-DETAIL.
           EXIT.


      ***************************************
      *   BRANCH (BULK) TRANSFER
      ***************************************

      ******************************************************
       TRB1-DETAIL SECTION.
      ******************************************************

           MOVE TB-BRNO TO BR-NO.
           PERFORM LPEOD5TR-GET-BR.
           IF ERROR-FG = "Y"
              GO TO EXIT-TRB1-DETAIL.

           MOVE TB-BRNO  TO GI-BRANCH.
           MOVE TB-CLASS TO GI-CLASS.
           PERFORM LPEOD5TR-GET-GI.
           IF ERROR-FG = "I"
              GO TO EXIT-TRB1-DETAIL.

           MOVE TB-CLASS TO LC-CODE.
           PERFORM LPEOD5TR-GET-LC.

      ******************** NON SERVICE ACCOUNTS  ****************
           IF TB-SERVACCT = "N"
            IF TB-PLCD = " "
      * NON P&L / NON SERVACCT:
      *       ---------------------------------------------------
      *          UPDATE AR OR REPO AR             NON (P&L/SERV):
      *       ---------------------------------------------------
              IF TB-REPOCD = "X" OR "S"
                 MOVE GI-REPO-AR TO GLNO
              ELSE
                 MOVE GI-AR TO GLNO
              END-IF
              MOVE TB-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRB

      *       ---------------------------------------------------
      *          UPDATE OTH BR PAYABLE / REC      NON (P&L/SERV):
      *       ---------------------------------------------------
              IF TB-REF-FRTO = "F"
                 MOVE GI-OTHBR-PAY TO GLNO
                 IF GP-INTERBR-AR-AP-FULLGL = "Y"
                    MOVE TB-REFBR TO GLOTHBR
                 END-IF
              ELSE
                 MOVE GI-OTHBR-REC TO GLNO
                 IF GP-INTERBR-AR-AP-FULLGL = "Y"
                    MOVE TB-REFBR TO GLOTHBR
                 END-IF
              END-IF
              COMPUTE GLAMT =
                       (TB-PURBAL - TB-UNEARN(1) - TB-UNEARN(2)
                                   - TB-UNEARN(3) - TB-UNEARN(4)
                                    - TB-UNEARN(5) - TB-UNEARN(6)
                       ) * (-1)

      *       IF (GP-I-AM-REGACC AND GP-INCL-OTH-IN-EARNED-R)
      *          COMPUTE GLAMT =
      *                 (TB-PURBAL + TB-UNEARN(1) + TB-UNEARN(2)
      *                            + TB-UNEARN(3) + TB-UNEARN(4)
      *                            + TB-UNEARN(5) + TB-UNEARN(6)) * (-1)
      *       END-IF

              PERFORM UPDATE-WORK-FILE-TRB

      *       ---------------------------------------------------
      *          UPDATE UNEARNED                  NON (P&L/SERV):
      *       ---------------------------------------------------
              MOVE 0 TO GLWK
              MOVE 1 TO SUB
              PERFORM TB-SET-UNEARNED 6 TIMES
           ELSE

      * P&L / NON SERVACCT:
      *       ---------------------------------------------------
      *          P&L CONTROL                      (P&L/NON SERV):
      *       ---------------------------------------------------
              PERFORM FIND-PLTYPE-SUB-TB
              MOVE GI-PL(PLSUB) TO GLNO
              MOVE TB-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRB
      *       ---------------------------------------------------
      *          P&L CONTROL OFFSET               (P&L/NON SERV):
      *       ---------------------------------------------------
              MOVE GI-PLOFFSET(PLSUB) TO GLNO
              SUBTRACT TB-PURBAL FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRB

           END-IF
           GO TO EXIT-TRB1-DETAIL.

      ***********************  SERVICE ACCOUNTS  ****************
           IF TB-SERVACCT = "Y"
            IF TB-PLCD = " "
      * NON P&L / SERVACCT:
      *       ---------------------------------------------------
      *          UPDATE SERVICE ACCOUNT RECEIVABLE
      *       ---------------------------------------------------
              IF TB-REPOCD = "X" OR "S"
                 MOVE GI-REPO-AR TO GLNO
              ELSE
                 MOVE GI-AR TO GLNO
              END-IF
              MOVE TB-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRB

      *       ---------------------------------------------------
      *          UPDATE SERVICE ACCOUNT OFFSET
      *       ---------------------------------------------------
              MOVE GI-SERVOFF TO GLNO
              SUBTRACT TB-PURBAL FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRB
          ELSE
      * P&L / SERVACCT:
      *       ---------------------------------------------------
      *          P&L CONTROL
      *       ---------------------------------------------------
              PERFORM FIND-PLTYPE-SUB-TB
              MOVE GI-PL(PLSUB) TO GLNO
              MOVE TB-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRB
      *       ---------------------------------------------------
      *          P&L CONTROL OFFSET
      *       ---------------------------------------------------
              MOVE GI-PLOFFSET(PLSUB) TO GLNO
              SUBTRACT TB-PURBAL FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRB
           END-IF
           GO TO EXIT-TRB1-DETAIL.

      *******************************************************
      *    SET ANTICIPATED UNEARNED FOR BT (BULK TRANSFER):
      *******************************************************
       TB-SET-UNEARNED.
           IF TB-UNEARN(SUB) NOT = 0
      * UNEARNED:
0049          IF (GP-NEW-REPO-UNEARNED-ACCTS = "Y") AND
                 (SUB = 1 OR 2)
                 IF TB-REPOCD = "X" OR "S"
                    IF SUB = 1
                       MOVE GI-UNINTREPO TO GLNO
                    ELSE
                       IF SUB = 2
                          MOVE GI-UNADDONINTREPO TO GLNO
                       END-IF
                    END-IF
                 ELSE
                    IF SUB = 1
                       MOVE GI-UNINTCHG TO GLNO
                    ELSE
                       IF SUB = 2
                          MOVE GI-UNADDON TO GLNO
                       END-IF
                    END-IF
                 END-IF
              ELSE
      *           IF GP-I-AM-REGACC AND GP-INCL-OTH-IN-EARNED-R
      *              MOVE GI-EARN(SUB)   TO GLNO
      *              MULTIPLY -1 BY TB-UNEARN(SUB)
      *           ELSE
                     MOVE GI-UNEARN(SUB) TO GLNO
      *           END-IF
              END-IF
              SUBTRACT TB-UNEARN(SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRB.
           ADD 1 TO SUB.

       EXIT-TRB1-DETAIL.
           EXIT.


      ***************************************
      *   BRANCH (CLASS) TRANSFER
      ***************************************

      ******************************************************
       TRJ1-DETAIL SECTION.
      ******************************************************

           MOVE TJ-BRNO TO BR-NO.
           PERFORM LPEOD5TR-GET-BR.
           IF ERROR-FG = "Y"
              GO TO EXIT-TRJ1-DETAIL.

           MOVE TJ-BRNO  TO GI-BRANCH.
           MOVE TJ-CLASS TO GI-CLASS.
           PERFORM LPEOD5TR-GET-GI.
           IF ERROR-FG = "I"
              GO TO EXIT-TRJ1-DETAIL.

           MOVE TJ-CLASS TO LC-CODE.
           PERFORM LPEOD5TR-GET-LC.

      ****************  NON SERVICE ACCOUNTS  ********************
           IF TJ-SERVACCT = "N"
      *    -------------------------------------------------------
      * NON P&L / NON SERVACCT:
            IF TJ-PLCD = " "
      *       ----------------------------------------------------
      *          UPDATE AR OR REPO AR              NON (P&L/SERV):
      *       ----------------------------------------------------
              IF TJ-REPOCD = "X" OR "S"
                 MOVE GI-REPO-AR TO GLNO
              ELSE
                 MOVE GI-AR TO GLNO
              END-IF
              MOVE TJ-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRJ

      *       ---------------------------------------------------
      *          UPDATE UNEARNED                  NON (P&L/SERV):
      *       ---------------------------------------------------
              MOVE 0 TO GLWK
              MOVE 1 TO SUB
              PERFORM TJ-SET-UNEARNED 6 TIMES
           ELSE

      * P&L / NON SERVACCT:
      *       ---------------------------------------------------
      *          P&L CONTROL                      (P&L/NON SERV):
      *       ---------------------------------------------------
              PERFORM FIND-PLTYPE-SUB-TJ
              MOVE GI-PL(PLSUB) TO GLNO
              MOVE TJ-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRJ
      *       ---------------------------------------------------
      *          P&L CONTROL OFFSET               (P&L/NON SERV):
      *       ---------------------------------------------------
              MOVE GI-PLOFFSET(PLSUB) TO GLNO
              SUBTRACT TJ-PURBAL FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRJ

           END-IF
           GO TO EXIT-TRJ1-DETAIL.

      ***********************  SERVICE ACCOUNTS  ****************
           IF TJ-SERVACCT = "Y"
      * NON P&L / SERVACCT:
            IF TJ-PLCD = " "
      * UPDATE SERVICE ACCOUNT RECEIVABLE
              IF TJ-REPOCD = "X" OR "S"
                 MOVE GI-REPO-AR TO GLNO
              ELSE
                 MOVE GI-AR TO GLNO
              END-IF
              MOVE TJ-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRJ

      * UPDATE SERVICE ACCOUNT OFFSET
              MOVE GI-SERVOFF TO GLNO
              SUBTRACT TJ-PURBAL FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRJ
           ELSE
      * P&L / SERVACCT:
      *       ---------------------------------------------------
      *          P&L CONTROL
      *       ---------------------------------------------------
              PERFORM FIND-PLTYPE-SUB-TJ
              MOVE GI-PL(PLSUB) TO GLNO
              MOVE TJ-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRJ
      *       ---------------------------------------------------
      *          P&L CONTROL OFFSET
      *       ---------------------------------------------------
              MOVE GI-PLOFFSET(PLSUB) TO GLNO
              SUBTRACT TJ-PURBAL FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRJ
           END-IF
           GO TO EXIT-TRJ1-DETAIL.

      *******************************************************
      *    SET ANTICIPATED UNEARNED FOR TJ (CLASS TRANSFER):
      *******************************************************
       TJ-SET-UNEARNED.
           IF TJ-UNEARN(SUB) NOT = 0
      * UNEARNED:
0049          IF (GP-NEW-REPO-UNEARNED-ACCTS = "Y") AND
                 (SUB = 1 OR 2)
                 IF TJ-REPOCD = "X" OR "S"
                    IF SUB = 1
                       MOVE GI-UNINTREPO TO GLNO
                    ELSE
                       IF SUB = 2
                          MOVE GI-UNADDONINTREPO TO GLNO
                       END-IF
                    END-IF
                 ELSE
                    IF SUB = 1
                       MOVE GI-UNINTCHG TO GLNO
                    ELSE
                       IF SUB = 2
                          MOVE GI-UNADDON TO GLNO
                       END-IF
                    END-IF
                 END-IF
              ELSE
                 MOVE GI-UNEARN(SUB) TO GLNO
              END-IF
              SUBTRACT TJ-UNEARN(SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRJ.
           ADD 1 TO SUB.

       EXIT-TRJ1-DETAIL.
           EXIT.

      ***************************************
      *   ACCOUNT CONVERSIONS
      ***************************************

      ******************************************************
       TRK1-DETAIL SECTION.
      ******************************************************

           MOVE TK-BRNO TO BR-NO.
           PERFORM LPEOD5TR-GET-BR.
           IF ERROR-FG = "Y"
              GO TO EXIT-TRK1-DETAIL.

           MOVE TK-BRNO  TO GI-BRANCH.
           MOVE TK-CLASS TO GI-CLASS.
           PERFORM LPEOD5TR-GET-GI.
           IF ERROR-FG = "I"
              GO TO EXIT-TRK1-DETAIL.

           MOVE TK-CLASS TO LC-CODE.
           PERFORM LPEOD5TR-GET-LC.

           IF TK-SERVACCT = "Y"
              MOVE GI-AR TO GLNO
              MOVE TK-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRK
              MOVE GI-SERVOFF TO GLNO
              SUBTRACT TK-PURBAL FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRK
           ELSE
           IF TK-PLCD = " "
      *---------------------------------------------
      *           (NON SERVICE)
      *     UPDATE AR, UNEARN & OFFSET (NON P&L):
      *---------------------------------------------
              IF TK-REPOCD = "X" OR "S"
                 MOVE GI-REPO-AR TO GLNO
              ELSE
                 MOVE GI-AR TO GLNO
              END-IF
              MOVE TK-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRK

      *     UPDATE UNEARNED:
              MOVE TK-PURBAL TO GLWK
              MOVE 1 TO SUB
              PERFORM TK-SET-UNEARNED 6 TIMES
              MOVE 1  TO SUB
              PERFORM TK-SET-EARNED 6 TIMES
              PERFORM TK-UPDATE-RESERVES
           ELSE
      *--------------------------------------
      *           (NON SERVICE)
      *     UPDATE (P&L):
      *--------------------------------------
              PERFORM FIND-PLTYPE-SUB-TK
      *     P&L CONTROL:
              MOVE GI-PL(PLSUB) TO GLNO
              MOVE TK-PURBAL TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRK
      *     P&L CONTROL OFFSET:
              MOVE GI-PLOFFSET(PLSUB) TO GLNO
              SUBTRACT TK-PURBAL FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRK.

           GO TO EXIT-TRK1-DETAIL.

      **************************************************************
      *    SET ANTICIPATED UNEARNED FOR TK (ACCOUNT CONVERSIONS):
      **************************************************************
       TK-SET-UNEARNED.
           IF TK-UNEARN(SUB) NOT = 0
      * UNEARNED:
0049          IF (GP-NEW-REPO-UNEARNED-ACCTS = "Y") AND
                 (SUB = 1 OR 2)
                 IF TK-REPOCD = "X" OR "S"
                    IF SUB = 1
                       MOVE GI-UNINTREPO TO GLNO
                    ELSE
                       IF SUB = 2
                          MOVE GI-UNADDONINTREPO TO GLNO
                       END-IF
                    END-IF
                 ELSE
                    IF SUB = 1
                       MOVE GI-UNINTCHG TO GLNO
                    ELSE
                       IF SUB = 2
                          MOVE GI-UNADDON TO GLNO
                       END-IF
                    END-IF
                 END-IF
              ELSE
                 MOVE GI-UNEARN(SUB) TO GLNO
              END-IF
              SUBTRACT TK-UNEARN(SUB) FROM GLAMT
                                           GLWK
              PERFORM UPDATE-WORK-FILE-TRK.
           ADD 1 TO SUB.

      **************************************************************
      *    SET ANTICIPATED EARNED FOR TK (ACCOUNT CONVERSIONS):
      **************************************************************
       TK-SET-EARNED.
           IF TK-EARNED(SUB) NOT = 0
      * EARNED:
                 MOVE GI-EARN(SUB)   TO GLNO
                 SUBTRACT TK-EARNED(SUB) FROM GLAMT
                                           GLWK
              PERFORM UPDATE-WORK-FILE-TRK.
           ADD 1 TO SUB.

       EXIT-TRK1-DETAIL.
           EXIT.

      ***************************************
      *   TRANSACTION POSTING
      ***************************************

      ******************************************************
       TRP1-DETAIL SECTION.
      ******************************************************
            
           IF TP-TRCD = "SX" OR "ZX" OR "SV"
              IF TP-PLCD NOT = " "
                 GO TO EXIT-TRP1-DETAIL.

           MOVE TP-BRNO TO BR-NO.
           PERFORM LPEOD5TR-GET-BR.
           IF ERROR-FG = "Y"
              GO TO EXIT-TRP1-DETAIL.

           MOVE TP-BRNO  TO GI-BRANCH.
           MOVE TP-CLASS TO GI-CLASS.
           PERFORM LPEOD5TR-GET-GI.
           IF ERROR-FG = "I"
              GO TO EXIT-TRP1-DETAIL.

           MOVE TP-CLASS TO LC-CODE.
           PERFORM LPEOD5TR-GET-LC.

           IF TP-PLCD NOT = " "
              PERFORM FIND-PLTYPE-SUB
              IF TP-SERVACCT NOT = "Y"
                 MOVE 0 TO TP-EARNINGS(1) TP-EARNINGS(2)
                           TP-EARNINGS(3) TP-EARNINGS(4)
                           TP-EARNINGS(6)
      * CHANGED: ADDED DL-DISC-CODE-NO-PL-EXP ACE #980
      * NOTE: ON A REVERSAL OF PL...P5 LONPF2 SET UP TP-EARNINGS(5)
      *       SO DON'T WANT TO CLEAR
                 IF NOT (TP-TRCD = "PL" OR "P1" OR "P2"
                                        OR "P3" OR "P4" OR "P5")
                    MOVE 0 TO TP-EARNINGS(5).

0006  * DETERMINE IF LP-REFNO IS ON FILE AS A BATCH-REFCD
0006  * NOTE: SET BATCH-REFCD TO LOW-VALUES IF IT IS NOT ON FILE

           MOVE LOW-VALUES TO BATCH-REFCD.

           IF TP-REFNO NOT = " "
              MOVE "BR"        TO CD-TYPE
              MOVE TP-REFNO    TO CD-CODE
              PERFORM READ-CD1-FILE
              IF IO-GOOD
                 IF CD-BR-FILE-TYPE NOT = "LC" AND NOT = "C"
                    MOVE TP-REFNO             TO BATCH-REFCD
                    MOVE CD-BR-GL-ACCOUNTS    TO BATCH-REFCD-GLNO
2253                MOVE CD-BR-OT-GL-ACCOUNTS TO BATCH-REFCD-OT-GLNO.

           IF TP-TRCD = "AH" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "AP" GO TO TP-AP-RE.
           IF TP-TRCD = "AC" GO TO TP-AC-JD.
           IF TP-TRCD = "CC" GO TO TP-CC-RC.
           IF TP-TRCD = "CA" GO TO TP-CA-RA.
           IF TP-TRCD = "CP" GO TO TP-CP-RP.
           IF TP-TRCD = "C1" GO TO TP-C1-R1.
           IF TP-TRCD = "C2" GO TO TP-C2-R2.
           IF TP-TRCD = "C3" GO TO TP-C3-R3.
           IF TP-TRCD = "CI" GO TO TP-CI-RI-CS-RS-CM-RM.
           IF TP-TRCD = "PX" GO TO TP-PX.
           IF TP-TRCD = "CS" GO TO TP-CI-RI-CS-RS-CM-RM.
           IF TP-TRCD = "CM" GO TO TP-CI-RI-CS-RS-CM-RM.
           IF TP-TRCD = "DF" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "D2" OR "D3" OR "D4" OR "D5" OR "D6"
                             OR "D7" OR "D8" OR "D9"
                             GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "JD" GO TO TP-AC-JD.
           IF TP-TRCD = "OP" GO TO TP-OP.
           IF TP-TRCD = "OV" GO TO TP-OV.
           IF TP-TRCD = "O2" GO TO TP-O2.
           IF TP-TRCD = "PE" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "IN" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "PB" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "PL" OR "P2" OR "P3" OR "P4" OR "P5"
                             GO TO TP-PL-RP.
           IF TP-TRCD = "PO" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "PR" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "PC" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "PN" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "PP" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "PW" GO TO TP-PW.
           IF TP-TRCD = "PY" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "PZ" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "RA" GO TO TP-CA-RA.
           IF TP-TRCD = "RC" GO TO TP-CC-RC.
           IF TP-TRCD = "RE" GO TO TP-AP-RE.
           IF TP-TRCD = "RP" GO TO TP-CP-RP.
           IF TP-TRCD = "R1" GO TO TP-C1-R1.
           IF TP-TRCD = "R2" GO TO TP-C2-R2.
           IF TP-TRCD = "R3" GO TO TP-C3-R3.
           IF TP-TRCD = "RI" GO TO TP-CI-RI-CS-RS-CM-RM.
           IF TP-TRCD = "RS" GO TO TP-CI-RI-CS-RS-CM-RM.
           IF TP-TRCD = "RM" GO TO TP-CI-RI-CS-RS-CM-RM.
           IF TP-TRCD = "RD" GO TO TP-RD.
           IF TP-TRCD = "RN" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "RB" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "RO" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "TS" GO TO TP-TS.
           IF TP-TRCD = "SC" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "SE" GO TO TP-SE.
           IF TP-TRCD = "SS" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "SV" GO TO TP-SX-SV.
           IF TP-TRCD = "SX" GO TO TP-SX-SV.
           IF TP-TRCD = "ZX" GO TO TP-SX-SV.
           IF TP-TRCD = "TP" GO TO TP-TP.
           IF TP-TRCD = "PA" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.

           IF TP-TRCD = "LP" OR "NP" OR "RT" OR "ET" OR "ST"
              GO TO TP-LP-NP-RT-ET-ST.

           IF TP-TRCD = "W2" GO TO TP-W2.
           IF TP-TRCD = "Z2" GO TO TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "ED" GO TO TP-ED.
           IF TP-TRCD = "EP" GO TO TP-EP.

           GO TO EXIT-TRP1-DETAIL.

      **********************************************************
      *           TP-DFPYPRPCPPPAPESSINPOPBRNSC
      **********************************************************
       TP-DFPYPRPCPPPAPESSINPOPBRNSC.
           IF TP-TRCD = "DF" OR "D2" OR "D3" OR "D4" OR "D5"
                             OR "D6" OR "D7" OR "D8" OR "D9"
              MOVE "Y" TO DF-TEST
           ELSE
              MOVE " " TO DF-TEST.

           IF TP-SERVACCT NOT = "Y"
              IF TP-TRCD = "PO" OR "SC"
                 PERFORM TP-ADJ-DLRVCHGS-1
                 PERFORM TP-ADJ-DLRVCHGS-2
                 PERFORM TP-ADJ-DLRVCHGS-3
                 PERFORM TP-ADJ-DLPARVHELD
                 PERFORM TP-ADJ-DLPARVPAID.

           IF ( (DF-POSTING ) AND
                ( NOT (TP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
                                          OR "TPAY" OR "MGRAM"
0006                                      OR BATCH-REFCD)
                )
              )
              OR
              ( ( TP-TRCD = "PY" OR "Z2" OR "PO" OR "PE" OR "IN"
                                         OR "SS" OR "AH")
                AND
                ( NOT (TP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
                                          OR "TPAY" OR "MGRAM"
0006                                                OR BATCH-REFCD)
                )
              )
              IF TP-OTHBR-FG = " "
      *     NSF = GI-BANK   NOT NSF = GI-CASH
                 PERFORM TEST-CASH-OR-BANK
              ELSE
      * "C" = POSTING BRANCH
      * "G" = OWNING BRANCH
                 IF TP-OTHBR-FG = "C"
      *     NSF = GI-BANK   NOT NSF = GI-CASH
                    PERFORM TEST-CASH-OR-BANK
                    MOVE GI-OTHBR-PAY TO GLNO
                    IF GP-INTERBR-AR-AP-FULLGL = "Y"
                       MOVE TP-POSTING-BR TO GLOTHBR
                    END-IF
                    SUBTRACT TP-TRAMT FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
                    IF TP-OTHBR-FG = "G"
                       MOVE GI-OTHBR-REC TO GLNO
                       IF GP-INTERBR-AR-AP-FULLGL = "Y"
                          MOVE TP-POSTING-BR TO GLOTHBR
                       END-IF
                       MOVE TP-TRAMT TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP.

           IF TP-TRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
              IF TP-OTHBR-FG = "C"
                 MOVE GI-OTHBR-PAY TO GLNO
                 IF GP-INTERBR-AR-AP-FULLGL = "Y"
                    MOVE TP-POSTING-BR TO GLOTHBR
                 END-IF
                 SUBTRACT TP-TRAMT FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 IF TP-OTHBR-FG = "G"
                    MOVE GI-OTHBR-REC TO GLNO
                    IF GP-INTERBR-AR-AP-FULLGL = "Y"
                       MOVE TP-POSTING-BR TO GLOTHBR
                    END-IF
                    MOVE TP-TRAMT TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP.
           IF TP-TRCD = "PR"
              MOVE GI-DLRVPRIN(TP-DLRVNO) TO GLNO
              MOVE TP-TRAMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
           ELSE
           IF TP-TRCD = "PC"
              MOVE GI-DLRVCHGS(TP-DLRVNO) TO GLNO
              MOVE TP-TRAMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
           ELSE
           IF TP-TRCD = "PP"
              MOVE GI-DLPARV TO GLNO
              MOVE TP-TRAMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP.

           IF ( TP-TRCD = "PA"                 )
              OR
              ( ( DF-POSTING )
                AND
                ( TP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
                                     OR "TPAY" OR "MGRAM"
0006                                           OR BATCH-REFCD)
              )
              OR
              ( ( TP-TRCD = "PY" OR "Z2" OR "PO" OR "PE" OR "IN"
                                         OR "SS" OR "AH" )
                AND
                ( TP-REFNO = "ALLOT" OR "LBOX" OR "TCOLL"
                                     OR "TPAY" OR "MGRAM"
0006                                           OR BATCH-REFCD)
              )

              IF (TP-REFNO = "DEBIT" OR "PHDBT" OR "PHACH") AND
                    (TP-TRCD = "PA" OR "PE" OR "PO")
                  PERFORM WORLD-REFNO-DEBIT 
              ELSE
              IF TP-OTHBR-FG = " " OR "G"
                 IF TP-REFNO = "LBOX"
                    MOVE GI-PAYLBOX  TO GLNO
                 ELSE
                    IF TP-REFNO = "TPAY"
                       MOVE GI-PAYTPAY  TO GLNO
                    ELSE
                       IF TP-REFNO = "TCOLL"
                          MOVE GI-PAYTCOLL  TO GLNO
                       ELSE
                          IF TP-REFNO = "MGRAM"
                             MOVE GI-PAYMGRAM  TO GLNO
                          ELSE
0006                         IF TP-REFNO = BATCH-REFCD
0006                            MOVE BATCH-REFCD-GLNO TO GLNO
0006                            IF GLNO-BR = 0
0006                               MOVE TP-BRNO TO GLNO-BR
0006                            END-IF
0006                         ELSE
                                MOVE GI-PAYALLOT  TO GLNO
                             END-IF
                          END-IF
                       END-IF
                    END-IF
                 END-IF
                 MOVE TP-TRAMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP.

           PERFORM TP-UPDATE-AR.

           IF TP-OTHBR-FG = " " OR "G"
              IF TP-SERVACCT = "N"
                 MOVE 1 TO SUB
                 PERFORM TP-SET-EARNINGS 6 TIMES
                 IF TP-PLCD = " "
                    MOVE GI-LATECHG TO GLNO
                    SUBTRACT TP-APLC FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF NOT DF-POSTING
                       IF GP-PENALTY-INT NOT = "Y"
                          MOVE GI-INTEREST TO GLNO
                          SUBTRACT TP-APINT FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       ELSE
                          MOVE GI-INTEREST TO GLNO
                          SUBTRACT TP-APINT FROM GLAMT
                          ADD TP-PENALTY-INT  TO GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                          MOVE GI-PENALTY-INT TO GLNO
                          SUBTRACT TP-PENALTY-INT FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       END-IF
                    ELSE
                       IF TP-SP-DEFFRMLA = 97
                          MOVE GI-INTEREST TO GLNO
                          SUBTRACT TP-APINT FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       ELSE
                          MOVE GI-DEFERMENTS TO GLNO
                          SUBTRACT TP-APINT FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       END-IF
                 ELSE
                    MOVE GI-PLINT(PLSUB) TO GLNO
                    SUBTRACT TP-APINT TP-APLC FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
              ELSE
      * SERVICE ACCOUNTS
                 IF TP-PLCD = " "
                    MOVE GI-SERVOFF TO GLNO
                    MOVE TP-APCUR TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 END-IF
                 MOVE GI-DLPAYABLE TO GLNO
                 SUBTRACT TP-DLPROC FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 IF TP-PLCD = " "
                    IF NOT DF-POSTING
      * WHAT WE EARNED ON PRINCIPAL
                       MOVE GI-SAPRINCIPAL TO GLNO
                       SUBTRACT TP-EARNINGS(1) FROM GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
      * WHAT WE EARNED ON INTEREST
                       MOVE GI-INTEREST TO GLNO
                       SUBTRACT TP-EARNINGS(2) FROM GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
      * WHAT WE EARNED ON LATE CHARGES
                       MOVE GI-LATECHG TO GLNO
                       SUBTRACT TP-EARNINGS(3) FROM GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
                    ELSE
      * WHAT WE EARNED ON DEFERMENTS
                       MOVE GI-DEFERMENTS TO GLNO
                       SUBTRACT TP-EARNINGS(1) FROM GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
      * PACESETTER FRMLA 8 CAN HAVE REFUNDED LCHGS REDUCING PRIN
                       MOVE GI-SAPRINCIPAL TO GLNO
                       SUBTRACT TP-EARNINGS(2) FROM GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
      * PACESETTER FRMLA 8 CAN HAVE REFUNDED LCHGS
                       MOVE GI-LATECHG TO GLNO
                       SUBTRACT TP-EARNINGS(3) FROM GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
      * WHAT WE EARNED ON PRINCIPAL
                    MOVE GI-SAPRINCIPAL TO GLNO
                    SUBTRACT TP-EARNINGS(1) FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-PLINT(PLSUB) TO GLNO
                    SUBTRACT TP-EARNINGS(2)
                             TP-EARNINGS(3) FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP.


1801       IF TP-MIP-FG = "Y"
1801          IF (NOT DF-POSTING)
      * RENEWALS DO TAKE MIP INSURANCE !! REGWAN PL# 539
1801  *          IF NOT (TP-TRCD = "PB" OR "RN" OR "SC"
1801  *                                 OR "RB" OR "RO")
1801                PERFORM TP-MIP-INSURANCE.

      * PAYMENTS WITH ESCROW APPLIED MUST UPDATE ESCROW ACCOUNT
           IF (TP-APPLIED-TO-ESCROW = 20202.02 OR  02020.20)
               MOVE 0 TO TP-APPLIED-TO-ESCROW.
           IF TP-APPLIED-TO-ESCROW NOT =  0
              IF TP-OTHBR-FG = " " OR "G"
                MOVE BR-GL-ESCROW-BALANCE TO GLNO
                SUBTRACT TP-APPLIED-TO-ESCROW FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

      *******************************************
      *    OV TRANS
      *******************************************
       TP-OV.
      * THIS WILL BE THE "POSTING" BRANCHES DIRECT PAYABLE CREDIT AND
      * DEBIT TO CASH/BANK, THEN WHEN THEY CUT THE "LN" CHECK, THESE
      * ACCOUNTS WILL WASH.
           MOVE GI-DIRECT-PAY TO GLNO.
           SUBTRACT TP-TRAMT FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRP.

      *    - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    TEST FOR 'OV' POSTED IN BATCH POSTING
      *    - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF TP-REFNO = "LBOX" OR "TPAY"  OR "TCOLL"
                                OR "MGRAM" OR "ALLOT"
0006                            OR BATCH-REFCD
              MOVE TP-TRAMT TO GLAMT
              IF TP-REFNO = "LBOX"
                 MOVE GI-PAYLBOX  TO GLNO
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 IF TP-REFNO = "TPAY"
                    MOVE GI-PAYTPAY  TO GLNO
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
                    IF TP-REFNO = "TCOLL"
                       MOVE GI-PAYTCOLL  TO GLNO
                       PERFORM UPDATE-WORK-FILE-TRP
                    ELSE
                       IF TP-REFNO = "MGRAM"
                          MOVE GI-PAYMGRAM  TO GLNO
                          PERFORM UPDATE-WORK-FILE-TRP
                       ELSE
0006                      IF TP-REFNO = BATCH-REFCD
0006                         MOVE BATCH-REFCD-GLNO TO GLNO
0006                         IF GLNO-BR = 0
0006                            MOVE TP-BRNO TO GLNO-BR
0006                         END-IF
0006                         PERFORM UPDATE-WORK-FILE-TRP
0006                      ELSE
                             IF TP-REFNO = "ALLOT"
                                MOVE GI-PAYALLOT  TO GLNO
                                PERFORM UPDATE-WORK-FILE-TRP.

      *    - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    TEST FOR 'OV' POSTED MANUALY
      *    - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF NOT (TP-REFNO = "LBOX" OR "TPAY"  OR "TCOLL"
                                     OR "MGRAM" OR "ALLOT"
0006                                 OR BATCH-REFCD
                  )
              IF TP-OTHBR-FG = " "
      *          NSF = GI-BANK   NOT NSF = GI-CASH
                 PERFORM TEST-CASH-OR-BANK
              ELSE
              IF TP-OTHBR-FG = "C"
      *          NSF = GI-BANK   NOT NSF = GI-CASH
                 PERFORM TEST-CASH-OR-BANK
              ELSE
              IF TP-OTHBR-FG = "G"
                 NEXT SENTENCE.

           GO TO EXIT-TRP1-DETAIL.

       TP-OP.
      * "OP" IS AUTOMATIC OT/AP COMBO, AMOUNT GOES INTO APCUR
      * THE FOLLOWING CODE WAS COPIED FROM TP-UPDATE-AR WHICH
      * IS WHAT THE TP-AP-OP-RE PERFORMED FIRST.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-PLCD = SPACES
                 PERFORM TP-UPDATE-GLS
                 PERFORM WHICH-AR
                 SUBTRACT TP-APCUR FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 MOVE GI-PL(PLSUB) TO GLNO
                 SUBTRACT TP-APCUR FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-PLOFFSET(PLSUB) TO GLNO
                 MOVE TP-APCUR TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 IF GP-NO-GL-ON-O2-WHEN-PL NOT = "Y"
                    PERFORM TP-UPDATE-GLS.
      * ABOVE WAS  FROM TP-UPDATE-AR
           IF TP-OTHBR-FG = " " OR "G"
      * SERVICE ACCOUNTS
              IF TP-SERVACCT = "Y"
                 MOVE GI-DLPAYABLE TO GLNO
                 SUBTRACT TP-APCUR FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 IF TP-PLCD = SPACES
                    MOVE GI-SERVOFF TO GLNO
                    MOVE TP-APCUR   TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-INTEREST TO GLNO
                    SUBTRACT TP-APINT FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-LATECHG TO GLNO
                    SUBTRACT TP-APLC FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
                    IF GP-NO-GL-ON-O2-WHEN-PL NOT = "Y"
                       IF (TP-APCUR > 0 AND TP-REVTRCD = " ") OR
                          (TP-APCUR < 0 AND TP-REVTRCD NOT = " ")
                          MOVE GI-PLREC(PLSUB) TO GLNO
                          SUBTRACT TP-APINT TP-APLC FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       ELSE
                          MOVE GI-PLEXP(PLSUB) TO GLNO
                          SUBTRACT TP-APINT TP-APLC FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP.

           IF TP-OTHBR-FG = " " OR "G"
      * NOT SERVICE ACCOUNTS
              IF TP-SERVACCT = "N"
                 IF TP-PLCD = SPACES
                    MOVE GI-INTEREST TO GLNO
                    SUBTRACT TP-APINT FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-LATECHG TO GLNO
                    SUBTRACT TP-APLC FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
      * P&L ACCOUNT
                    MOVE GI-PLINT(PLSUB) TO GLNO
                    SUBTRACT TP-APINT TP-APLC FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF GP-NO-GL-ON-O2-WHEN-PL NOT = "Y"
                       IF (TP-APCUR > 0 AND TP-REVTRCD = " ") OR
                          (TP-APCUR < 0 AND TP-REVTRCD NOT = " ")
                          MOVE GI-PLREC(PLSUB) TO GLNO
                          SUBTRACT TP-APCUR FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       ELSE
                          MOVE GI-PLEXP(PLSUB) TO GLNO
                          SUBTRACT TP-APCUR FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

      *******************************************
      *    O2 TRANS
      *******************************************
       TP-O2.
           IF TP-OTHBR-FG = " " OR "G"
      *       - - - - - - - - - - - - - - P&L ACCOUNT:
              IF TP-PLCD NOT = " "
                 MOVE GI-PL(PLSUB) TO GLNO
                 ADD TP-APOT2 TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-PLOFFSET(PLSUB) TO GLNO
                 SUBTRACT TP-APOT2 FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 IF GP-NO-GL-ON-O2-WHEN-PL NOT = "Y"
                    PERFORM TP-UPDATE-GLS
                    IF TP-SERVACCT = "Y"
                       MOVE GI-DLPAYABLE TO GLNO
                       MOVE TP-APOT2 TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
                    ELSE
                       IF (TP-APOT2 < 0 AND TP-REVTRCD = " ")
                            OR (TP-APOT2 > 0 AND TP-REVTRCD NOT = " ")
                          MOVE GI-PLREC(PLSUB) TO GLNO
                          ADD TP-APOT2 TO GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       ELSE
                          MOVE GI-PLEXP(PLSUB) TO GLNO
                          ADD TP-APOT2 TO GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       END-IF
                    END-IF
                 END-IF
              ELSE
      *          - - - - - - - - - - - - - NORMAL ACCOUNT NON P&L:
                 PERFORM TP-UPDATE-GLS
                 PERFORM WHICH-AR
                 ADD TP-APOT2 TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 IF TP-SERVACCT = "Y"
                    MOVE GI-SERVOFF TO GLNO
                    SUBTRACT TP-APOT2 FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-DLPAYABLE TO GLNO
                    MOVE TP-APOT2 TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

      *******************************************
      *    W2 TRANS
      *******************************************
       TP-W2.
           IF TP-OTHBR-FG = " " OR "G"
                 PERFORM TP-UPDATE-GLS
      * P&L ACCOUNT:
                 IF TP-PLCD NOT = SPACES
                    MOVE GI-PL(PLSUB) TO GLNO
                    SUBTRACT TP-APOT2 FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-PLOFFSET(PLSUB) TO GLNO
                    ADD TP-APOT2 TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF TP-SERVACCT = "Y"
                       MOVE GI-DLPAYABLE TO GLNO
                       SUBTRACT TP-APOT2 FROM GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
                    ELSE
                       IF (TP-APOT2 < 0 AND TP-REVTRCD = " ")
                            OR (TP-APOT2 > 0 AND TP-REVTRCD NOT = " ")
                          MOVE GI-PLREC(PLSUB) TO GLNO
                          SUBTRACT TP-APOT2 FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       ELSE
                          MOVE GI-PLEXP(PLSUB) TO GLNO
                          SUBTRACT TP-APOT2 FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       END-IF
                 ELSE
      * NORMAL ACCOUNT NON P&L:
                    PERFORM WHICH-AR
                    SUBTRACT TP-APOT2 FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF TP-SERVACCT = "Y"
                       MOVE GI-SERVOFF TO GLNO
                       ADD TP-APOT2 TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
                       MOVE GI-DLPAYABLE TO GLNO
                       SUBTRACT TP-APOT2 FROM GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

      *******************************************
      *    ACCELERATED OR JUDGEMENNT TRANS
      *******************************************
       TP-AC-JD.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-SERVACCT = "N"
                 MOVE 1 TO SUB
                 PERFORM TP-SET-EARNINGS 6 TIMES.

           GO TO EXIT-TRP1-DETAIL.

      ********************************************************
      *    PARTIAL CHARGE OFF TRANSACTION
      *
      * NOTE: THIS LOGIC ASSUMES THE ACCOUNT IS NEVER IN
      *       A P&L STATE, WHEN THIS TRANSACTION IS POSTED
      *       !!! IT WOULD NOT MAKE SENSE IF IT WAS P&L!!
      ********************************************************
       TP-PX.
           PERFORM TP-UPDATE-AR.

           IF TP-OTHBR-FG = " " OR "G"
              IF TP-SERVACCT = "N"
                 MOVE GI-PARTIAL-PLEXP TO GLNO
                 MOVE TP-TRAMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
0447             MOVE 1 TO SUB
0447             PERFORM TP-SET-EARNINGS 6 TIMES
              ELSE
      * SERVICE ACCOUNTS
                 MOVE GI-SERVOFF TO GLNO
                 MOVE TP-TRAMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

       TP-ED.
            IF TP-TRCD = "ED"
               MOVE BR-GL-ESCROW-PAYABLE TO GLNO
               SUBTRACT TP-ESCROW-DISBURSED FROM GLAMT
               PERFORM UPDATE-WORK-FILE-TRP
               MOVE BR-GL-ESCROW-BALANCE TO GLNO
               MOVE TP-ESCROW-DISBURSED TO GLAMT
               PERFORM UPDATE-WORK-FILE-TRP.

            GO TO EXIT-TRP1-DETAIL.

       TP-EP.
            IF TP-TRCD = "EP"
               MOVE BR-GL-ESCROW-BALANCE TO GLNO
               SUBTRACT TP-ESCROW-PREPAID FROM GLAMT
               PERFORM UPDATE-WORK-FILE-TRP
               MOVE GI-CASH TO GLNO
               MOVE TP-ESCROW-PREPAID TO GLAMT
               PERFORM UPDATE-WORK-FILE-TRP.

            GO TO EXIT-TRP1-DETAIL.

      *******************************************
      *    SET ANTICIPATED EARNINGS FOR ACCOUNTS:
      *******************************************
       TP-SET-EARNINGS.
           IF TP-EARNINGS(SUB) NOT = 0 OR
              TP-WORKAMT(SUB) NOT = 0
      * UNEARNED:
0049          IF (GP-NEW-REPO-UNEARNED-ACCTS = "Y") AND
                 (SUB = 1 OR 2)
                 IF TP-REPOCD = "X" OR "S"
                    IF SUB = 1
                       MOVE GI-UNINTREPO TO GLNO
                    ELSE
                       IF SUB = 2
                          MOVE GI-UNADDONINTREPO TO GLNO
                       END-IF
                    END-IF
                 ELSE
                    IF SUB = 1
                       MOVE GI-UNINTCHG TO GLNO
                    ELSE
                       IF SUB = 2
                          MOVE GI-UNADDON TO GLNO
                       END-IF
                    END-IF
                 END-IF
              ELSE
                 MOVE GI-UNEARN(SUB) TO GLNO
              END-IF
              MOVE TP-EARNINGS(SUB) TO GLAMT
              ADD TP-WORKAMT(SUB) TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
      * ANTIC EARNINGS:
              MOVE GI-EARN(SUB)   TO GLNO
              SUBTRACT TP-EARNINGS(SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP.
           ADD 1 TO SUB.

      ********************************************************
      *    TEST FOR NSF TO CREDIT BANK OR CASH OR NSF
      *
      *    ALSO DOES BR-BANKBAL UPDATE IF NSF-BANK
      ********************************************************
       TEST-CASH-OR-BANK.
           IF TP-REFNO NOT = "NSF  "
              MOVE GI-CASH TO GLNO
              MOVE TP-TRAMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
           ELSE
              MOVE GI-NSF TO GLNO
              MOVE TP-TRAMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
      *         IF GP-BANK-GL NOT = ZERO CORPORATE BANKING
      *         EXISTS AND NO UPDATE TO LOCAL BANK WILL OCCUR
              IF GP-BANK-GL NOT = 0
                 SUBTRACT TP-TRAMT FROM 0 GIVING CLEARING-WK
                 PERFORM BANK-CLEARING-CHECKS-NSF-TRP
              ELSE
                 IF GI-BANK = GI-NSF
                    ADD TP-TRAMT TO BR-BANKBAL
                    PERFORM CHECK-UPDATE-BR.
       TP-CC-RC.
           PERFORM TP-UPDATE-AR.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-INSOURS = "N"
                 IF TP-SERVACCT = "Y"
                    IF TP-PLCD NOT = " "
                       NEXT SENTENCE
                    ELSE
                       MOVE GI-SERVOFF TO GLNO
                 ELSE
                    MOVE GI-DLINSREB TO GLNO
                 END-IF
                 MOVE TP-TRAMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
      *          IF TP-SERVACCT = "Y"
      *             MOVE GI-SERVOFF TO GLNO
      *          ELSE
      *             MOVE GI-DLINSREB TO GLNO
      *          END-IF
      *          MOVE TP-TRAMT TO GLAMT
      *          PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 IF TP-INSTYPES-DL
                    MOVE GI-PAYCL1 TO GLNO
                    MOVE TP-TRAMT TO GLAMT
288                 IF TP-INS-TAX-RB = 2020202.02
288                    MOVE 0 TO TP-INS-TAX-RB
288                 END-IF
288                 SUBTRACT TP-INSCOMM TP-INS-TAX-RB FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-UNCL1 TO GLNO
      *               PERFORM WORLD-SWITCH-TO-REFUND
                    MOVE TP-INSCOMM TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
288                 PERFORM UPDATE-INS-TAX-RB
                 END-IF
                 IF TP-INSTYPES-LL
                    MOVE GI-PAYCL2 TO GLNO
                    MOVE TP-TRAMT TO GLAMT
288                 IF TP-INS-TAX-RB = 2020202.02
288                    MOVE 0 TO TP-INS-TAX-RB
288                 END-IF
288                 SUBTRACT TP-INSCOMM TP-INS-TAX-RB FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-UNCL2 TO GLNO
      *               PERFORM WORLD-SWITCH-TO-REFUND
                    MOVE TP-INSCOMM TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
288                 PERFORM UPDATE-INS-TAX-RB
                 END-IF
                 IF TP-SERVACCT = "Y"
                    MOVE GI-DLPAYABLE TO GLNO
                    SUBTRACT TP-TRAMT FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF TP-PLCD = " "
                       MOVE GI-SERVOFF TO GLNO
                       MOVE TP-TRAMT TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

       TP-CA-RA.
           PERFORM TP-UPDATE-AR.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-INSOURS = "N"
                 IF TP-SERVACCT = "Y"
                    IF TP-PLCD NOT = " "
                       NEXT SENTENCE
                    ELSE
                       MOVE GI-SERVOFF TO GLNO
                 ELSE
                    MOVE GI-DLINSREB TO GLNO
                 END-IF
                 MOVE TP-TRAMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 MOVE GI-PAYAH TO GLNO
                 MOVE TP-TRAMT TO GLAMT
288              IF TP-INS-TAX-RB = 2020202.02
288                 MOVE 0 TO TP-INS-TAX-RB
288              END-IF
288              SUBTRACT TP-INSCOMM TP-INS-TAX-RB FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-UNAH TO GLNO
      *               PERFORM WORLD-SWITCH-TO-REFUND
                 MOVE TP-INSCOMM TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
288              PERFORM UPDATE-INS-TAX-RB
                 IF TP-SERVACCT = "Y"
                    MOVE GI-DLPAYABLE TO GLNO
                    SUBTRACT TP-TRAMT FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF TP-PLCD = " "
                       MOVE GI-SERVOFF TO GLNO
                       MOVE TP-TRAMT TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

       TP-CP-RP.
           PERFORM TP-UPDATE-AR.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-INSOURS = "N"
                 IF TP-SERVACCT = "Y"
                    IF TP-PLCD NOT = " "
                       NEXT SENTENCE
                    ELSE
                       MOVE GI-SERVOFF TO GLNO
                 ELSE
                    MOVE GI-DLINSREB TO GLNO
                 END-IF
                 MOVE TP-TRAMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 MOVE GI-PAYPP TO GLNO
                 MOVE TP-TRAMT TO GLAMT
288              IF TP-INS-TAX-RB = 2020202.02
288                 MOVE 0 TO TP-INS-TAX-RB
288              END-IF
288              SUBTRACT TP-INSCOMM TP-INS-TAX-RB FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-UNPP TO GLNO
      *               PERFORM WORLD-SWITCH-TO-REFUND
                 MOVE TP-INSCOMM TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
288              PERFORM UPDATE-INS-TAX-RB
                 IF TP-SERVACCT = "Y"
                    MOVE GI-DLPAYABLE TO GLNO
                    SUBTRACT TP-TRAMT FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF TP-PLCD = " "
                       MOVE GI-SERVOFF TO GLNO
                       MOVE TP-TRAMT TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP.
           GO TO EXIT-TRP1-DETAIL.

       TP-C1-R1.
           PERFORM TP-UPDATE-AR.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-INSOURS = "N"
                 IF TP-SERVACCT = "Y"
                    IF TP-PLCD NOT = " "
                       NEXT SENTENCE
                    ELSE
                       MOVE GI-SERVOFF TO GLNO
                 ELSE
                    MOVE GI-DLINSREB TO GLNO
                 END-IF
                 MOVE TP-TRAMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 MOVE GI-PAYO1 TO GLNO
                 MOVE TP-TRAMT TO GLAMT
288              IF TP-INS-TAX-RB = 2020202.02
288                 MOVE 0 TO TP-INS-TAX-RB
288              END-IF
288              SUBTRACT TP-INSCOMM TP-INS-TAX-RB FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-UNO1 TO GLNO
      *               PERFORM WORLD-SWITCH-TO-REFUND
                 MOVE TP-INSCOMM TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
288              PERFORM UPDATE-INS-TAX-RB
                 IF TP-SERVACCT = "Y"
                    MOVE GI-DLPAYABLE TO GLNO
                    SUBTRACT TP-TRAMT FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF TP-PLCD = " "
                       MOVE GI-SERVOFF TO GLNO
                       MOVE TP-TRAMT TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP.
           GO TO EXIT-TRP1-DETAIL.

       TP-C2-R2.
           PERFORM TP-UPDATE-AR.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-INSOURS = "N"
                 IF TP-SERVACCT = "Y"
                    IF TP-PLCD NOT = " "
                       NEXT SENTENCE
                    ELSE
                       MOVE GI-SERVOFF TO GLNO
                 ELSE
                    MOVE GI-DLINSREB TO GLNO
                 END-IF
                 MOVE TP-TRAMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 MOVE GI-PAYO2 TO GLNO
                 MOVE TP-TRAMT TO GLAMT
288              IF TP-INS-TAX-RB = 2020202.02
288                 MOVE 0 TO TP-INS-TAX-RB
288              END-IF
288              SUBTRACT TP-INSCOMM TP-INS-TAX-RB FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-UNO2 TO GLNO
      *               PERFORM WORLD-SWITCH-TO-REFUND
                 MOVE TP-INSCOMM TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
288              PERFORM UPDATE-INS-TAX-RB
                 IF TP-SERVACCT = "Y"
                    MOVE GI-DLPAYABLE TO GLNO
                    SUBTRACT TP-TRAMT FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF TP-PLCD = " "
                       MOVE GI-SERVOFF TO GLNO
                       MOVE TP-TRAMT TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP.
           GO TO EXIT-TRP1-DETAIL.

       TP-C3-R3.
           PERFORM TP-UPDATE-AR.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-INSOURS = "N"
                 IF TP-SERVACCT = "Y"
                    IF TP-PLCD NOT = " "
                       NEXT SENTENCE
                    ELSE
                       MOVE GI-SERVOFF TO GLNO
                 ELSE
                    MOVE GI-DLINSREB TO GLNO
                 END-IF
                 MOVE TP-TRAMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 MOVE GI-PAYO3 TO GLNO
                 MOVE TP-TRAMT TO GLAMT
288              IF TP-INS-TAX-RB = 2020202.02
288                 MOVE 0 TO TP-INS-TAX-RB
288              END-IF
288              SUBTRACT TP-INSCOMM TP-INS-TAX-RB FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-UNO3 TO GLNO
      *               PERFORM WORLD-SWITCH-TO-REFUND
                 MOVE TP-INSCOMM TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
288              PERFORM UPDATE-INS-TAX-RB
                 IF TP-SERVACCT = "Y"
                    MOVE GI-DLPAYABLE TO GLNO
                    SUBTRACT TP-TRAMT FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF TP-PLCD = " "
                       MOVE GI-SERVOFF TO GLNO
                       MOVE TP-TRAMT TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP.
           GO TO EXIT-TRP1-DETAIL.

      *----------------------------------------------------
      *    REFUND CHARGES      'RI'  'RS'  'RM'
      *----------------------------------------------------
       TP-CI-RI-CS-RS-CM-RM.
           PERFORM TP-UPDATE-AR.
           IF TP-SERVACCT NOT = "Y"
              IF TP-TRCD = "RI" OR "CI"
                 PERFORM TP-ADJ-DLRVCHGS-1
                 PERFORM TP-ADJ-DLRVCHGS-2
                 PERFORM TP-ADJ-DLRVCHGS-3
                 PERFORM TP-ADJ-DLPARVHELD
                 PERFORM TP-ADJ-DLPARVPAID.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-SERVACCT = "Y"
                 IF TP-PLCD = " "
                    MOVE GI-SERVOFF TO GLNO
                    MOVE TP-TRAMT TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 END-IF
                 GO TO EXIT-TRP1-DETAIL
              ELSE
                 IF TP-PLCD NOT = SPACES
                    MOVE GI-PLREC(PLSUB) TO GLNO
                    MOVE TP-APCUR TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
                 IF TP-TRCD = "RI" OR "CI"
                    MOVE 1 TO FUNK-SUB
                    MOVE GI-ERINTCHG TO GLNO
                    COMPUTE GLAMT = 0 - TP-EARNINGS(FUNK-SUB)
                    PERFORM UPDATE-WORK-FILE-TRP

0049                IF GP-NEW-REPO-UNEARNED-ACCTS = "Y"
                       IF TP-REPOCD = "X" OR "S"
                          MOVE GI-UNINTREPO TO GLNO
                       ELSE
                          MOVE GI-UNINTCHG  TO GLNO
                       END-IF
                    ELSE
                       MOVE GI-UNINTCHG  TO GLNO
                    END-IF
                    ADD TP-EARNINGS(FUNK-SUB) TO GLAMT
                    ADD TP-WORKAMT(FUNK-SUB)  TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP

                    MOVE 2 TO FUNK-SUB
                    MOVE GI-ERADDON  TO GLNO
                    COMPUTE GLAMT = 0 - TP-EARNINGS(FUNK-SUB)
                    PERFORM UPDATE-WORK-FILE-TRP

0049                IF GP-NEW-REPO-UNEARNED-ACCTS = "Y"
                       IF TP-REPOCD = "X" OR "S"
                          MOVE GI-UNADDONINTREPO TO GLNO
                       ELSE
                          MOVE GI-UNADDON        TO GLNO
                       END-IF
                    ELSE
                       MOVE GI-UNADDON  TO GLNO
                    END-IF
                    MOVE TP-EARNINGS(FUNK-SUB) TO GLAMT
                    ADD TP-WORKAMT(FUNK-SUB)   TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP

                    MOVE 3 TO FUNK-SUB
                    MOVE GI-ERSERCHG TO GLNO
                    COMPUTE GLAMT = 0 - TP-EARNINGS(FUNK-SUB)
                    PERFORM UPDATE-WORK-FILE-TRP

                    MOVE GI-UNSERCHG TO GLNO
                    MOVE TP-EARNINGS(FUNK-SUB) TO GLAMT
                    ADD TP-WORKAMT(FUNK-SUB) TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
                 IF TP-TRCD = "RS" OR "CS"
                    MOVE GI-UNSERCHG TO GLNO
                    MOVE 3 TO FUNK-SUB
                    ADD TP-EARNINGS(FUNK-SUB) TO GLAMT
                    ADD TP-WORKAMT(FUNK-SUB) TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-ERSERCHG TO GLNO
                    COMPUTE GLAMT = 0 - TP-EARNINGS(FUNK-SUB)
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
                 IF TP-TRCD = "RM" OR "CM"
                    MOVE GI-UNMAINTFEE TO GLNO
                    MOVE 4 TO FUNK-SUB
                    ADD TP-EARNINGS(FUNK-SUB) TO GLAMT
                    ADD TP-WORKAMT(FUNK-SUB) TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-ERMAINTFEE TO GLNO
                    COMPUTE GLAMT = 0 - TP-EARNINGS(FUNK-SUB)
                    PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

       TP-RD.
           PERFORM TP-UPDATE-AR.

           IF TP-OTHBR-FG = " " OR "G"
              IF TP-SERVACCT = "Y"
                 MOVE GI-SERVOFF TO GLNO
                 MOVE TP-APCUR TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 IF TP-PLCD NOT = SPACES
                    MOVE GI-PLREC(PLSUB) TO GLNO
                    MOVE TP-APCUR TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
                    MOVE GI-DEFERMENTS TO GLNO
                    MOVE TP-APCUR TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP.
           GO TO EXIT-TRP1-DETAIL.

       TP-AP-RE.
      *    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *    'RE' ON 'IB' WILL ACT LIKE 'OT' TRANSACTION   REGACC PR#1575
      *    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           IF TP-TRCD = "RE" AND
              TP-LOANTYPE = "I"
              GO TO EXIT-TRP1-DETAIL.

           PERFORM TP-UPDATE-AR.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-SERVACCT = "Y"
                 MOVE GI-DLPAYABLE TO GLNO
                 SUBTRACT TP-APCUR FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 IF TP-PLCD = SPACES
                    MOVE GI-SERVOFF TO GLNO
                    MOVE TP-APCUR   TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-INTEREST TO GLNO
                    SUBTRACT TP-APINT FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    MOVE GI-LATECHG TO GLNO
                    SUBTRACT TP-APLC FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
                    IF (TP-APCUR > 0 AND TP-REVTRCD = " ") OR
                       (TP-APCUR < 0 AND TP-REVTRCD NOT = " ")
                       MOVE GI-PLREC(PLSUB) TO GLNO
                       SUBTRACT TP-APINT TP-APLC FROM GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
                    ELSE
                       MOVE GI-PLEXP(PLSUB) TO GLNO
                       SUBTRACT TP-APINT TP-APLC FROM GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
              ELSE
              IF TP-PLCD = " "
                 MOVE GI-INTEREST TO GLNO
                 SUBTRACT TP-APINT FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-LATECHG TO GLNO
                 SUBTRACT TP-APLC FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 IF (TP-APCUR > 0 AND TP-REVTRCD = " ") OR
                    (TP-APCUR < 0 AND TP-REVTRCD NOT = " ")
                    MOVE GI-PLREC(PLSUB) TO GLNO
                    SUBTRACT TP-APCUR FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
                    MOVE GI-PLEXP(PLSUB) TO GLNO
                    SUBTRACT TP-APCUR FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 END-IF
                 MOVE GI-PLINT(PLSUB) TO GLNO
                 SUBTRACT TP-APINT TP-APLC FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

       TP-PL-RP.
           IF TP-TRCD = "PL"
              MOVE 1 TO PLSUB
           ELSE
              MOVE TP-TRCD2 TO PLSUBX.
           IF TP-OTHBR-FG = " " OR "G"
              PERFORM TP-UPDATE-GLS
              PERFORM WHICH-AR
              SUBTRACT TP-TRAMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-PL(PLSUB) TO GLNO
              ADD TP-TRAMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              PERFORM TEST-PLEXP-DLRSV
              ADD TP-TRAMT TO GLAMT
              MOVE GLAMT TO HOLD-PL-EXP
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-PLOFFSET(PLSUB) TO GLNO
              SUBTRACT TP-TRAMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              IF TP-SERVACCT = "N"
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      *        ADDED DL-DISC-CODE-NO-PL-EXP     ACE #980
      *        WHEN SET THE REMAINING DEALER DISCOUNT UNEARNED
      *        WILL BE TAKEN INTO INCOME AND NOT REDUCE THE P&L EXPENSE
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
                 IF TP-EARNINGS(5) NOT = 0
      *            DISCOUNT UNEARNED:
                    MOVE GI-UNDLDISC    TO GLNO
                    MOVE TP-EARNINGS(5) TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
      *            ANTIC DISCOUNT EARNINGS:
                    MOVE GI-ERDLDISC    TO GLNO
                    SUBTRACT TP-EARNINGS(5) FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 END-IF
      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

                 MOVE 0 TO GLWK
                 MOVE 1 TO SUB
                 PERFORM TP-SET-PL-UNEARNED 6 TIMES
                 PERFORM TEST-PLEXP-DLRSV
                 SUBTRACT GLWK FROM GLAMT
                                    HOLD-PL-EXP
                 PERFORM UPDATE-WORK-FILE-TRP
                 IF TP-TRCD = "P4" OR "P5"
                    PERFORM TEST-PLEXP-DLRSV
                    SUBTRACT HOLD-PL-EXP FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                    IF TP-P4P5-TRCD = "PR"
                       MOVE GI-DLRVPRIN(TP-P4P5-DLRVNO) TO GLNO
                       MOVE HOLD-PL-EXP TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
                    ELSE
                    IF TP-P4P5-TRCD = "PC"
                       MOVE GI-DLRVCHGS(TP-P4P5-DLRVNO) TO GLNO
                       MOVE HOLD-PL-EXP TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP
                    ELSE
                    IF TP-P4P5-TRCD = "PP"
                       MOVE GI-DLPARV TO GLNO
                       MOVE HOLD-PL-EXP TO GLAMT
                       PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

      *-------------------------------------------------
      *    RECAPTURE RESERVE FROM CHARGES #1
      *    ON LOAN CHARGES CLOSEOUT
      *-------------------------------------------------
       TP-ADJ-DLRVCHGS-1.
358        IF TP-OTHBR-FG = " " OR "G"
              IF TP-DLRVCHGS-ADJ(1) NOT = 0
                 MOVE GI-DLRVCHGS-1 TO GLNO
                 MOVE TP-DLRVCHGS-ADJ(1) TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP.

      *-------------------------------------------------
      *    RECAPTURE RESERVE FROM CHARGES #2
      *    ON LOAN CHARGES CLOSEOUT
      *-------------------------------------------------
       TP-ADJ-DLRVCHGS-2.
358        IF TP-OTHBR-FG = " " OR "G"
              IF TP-DLRVCHGS-ADJ(2) NOT = 0
                 MOVE GI-DLRVCHGS-2 TO GLNO
                 MOVE TP-DLRVCHGS-ADJ(2) TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP.

      *-------------------------------------------------
      *    RECAPTURE RESERVE FROM CHARGES #3
      *    ON LOAN CHARGES CLOSEOUT
      *-------------------------------------------------
       TP-ADJ-DLRVCHGS-3.
358        IF TP-OTHBR-FG = " " OR "G"
              IF TP-DLRVCHGS-ADJ(3) NOT = 0
                 MOVE GI-DLRVCHGS-3 TO GLNO
                 MOVE TP-DLRVCHGS-ADJ(3) TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP.

      *-------------------------------------------------
      *    RECAPTURE PARTIC. HELD ON CHARGES CLOSEOUT
      *       IF 'B' EARNINGS WERE SHARED WITH DEALER
      *              AND PARTICIPATION HELD WAS NOT
      *              EXPENSED AT BOOKING:
      *-------------------------------------------------
       TP-ADJ-DLPARVHELD.
358        IF TP-OTHBR-FG = " " OR "G"
              IF TP-DLPARVHELD-ADJ NOT = 0
                 MOVE GI-DLPARV TO GLNO
                 MOVE TP-DLPARVHELD-ADJ TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 IF TP-DL-PARVHELD-CODE NOT = "B"
                    MOVE GI-DLPARVEX TO GLNO
                    SUBTRACT TP-DLPARVHELD-ADJ FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP.

      *-------------------------------------------------
      *    RECAPTURE PARTIC. PAID ON CHARGES CLOSEOUT
      *       IF ' ' EARNINGS WERE SHARED WITH DEALER
      *              AND PARTICIPATION HELD WAS NOT
      *              EXPENSED AT BOOKING:
      *    NOTE:
      *         ADJUSTMENTS ARE MADE TO PARTIC. HELD
      *-------------------------------------------------
       TP-ADJ-DLPARVPAID.
358        IF TP-OTHBR-FG = " " OR "G"
              IF TP-DLPARVPAID-ADJ NOT = 0
                 MOVE GI-DLPARV TO GLNO
                 MOVE TP-DLPARVPAID-ADJ TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 IF TP-DL-PARVPAID-CODE NOT = " "
                    MOVE GI-DLPARVEX TO GLNO
                    SUBTRACT TP-DLPARVPAID-ADJ FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP.

      *************************************************
      *    SHIFT PL EXPENSE TO NEW AR
      *************************************************
       TP-SE.
           IF TP-OTHBR-FG = " " OR "G"
              PERFORM TP-UPDATE-GLS
              PERFORM TP-SE-PLEXP-DLRSV
              SUBTRACT TP-PL-OTH-AR FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-PLNEW-AR(PLSUB) TO GLNO
              ADD TP-PL-OTH-AR        TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

       TP-SE-PLEXP-DLRSV.
           IF TP-SERVACCT = "Y"
              MOVE GI-SERVOFF      TO GLNO
           ELSE
              MOVE GI-PLEXP(PLSUB) TO GLNO.

       TP-SX-SV.
           IF TP-OTHBR-FG = " " OR "G"
2314          IF ( (TP-TRCD = "SX" OR "ZX") AND (TP-REV NOT = "Y") )
                       OR (TP-REV = "Y" AND TP-TRCD = "SV")
                 PERFORM TP-UPDATE-GLS
                 MOVE GI-AR TO GLNO
                 SUBTRACT TP-CURBAL FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-REPO-AR TO GLNO
                 ADD TP-CURBAL   TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
0049             IF GP-NEW-REPO-UNEARNED-ACCTS = "Y"
      *            DEBIT ORIGINAL UNEARNED INTEREST
                    MOVE GI-UNINTCHG   TO GLNO
                    MOVE TP-WORKAMT(1) TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
      *            CREDIT NEW REPO UNEARNED INTEREST
                    MOVE GI-UNINTREPO      TO GLNO
                    SUBTRACT TP-WORKAMT(1) FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
      *            DEBIT ORIGINAL ADDON UNEARNED INTEREST
                    MOVE GI-UNADDON    TO GLNO
                    MOVE TP-WORKAMT(2) TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
      *            CREDIT NEW REPO ADDON UNEARNED INTEREST
                    MOVE GI-UNADDONINTREPO TO GLNO
                    SUBTRACT TP-WORKAMT(2) FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 END-IF
              ELSE
              IF (TP-TRCD = "SV" AND TP-REV NOT = "Y")
2314                   OR (TP-REV = "Y" AND (TP-TRCD = "SX" OR "ZX") )
                 PERFORM TP-UPDATE-GLS
                 MOVE GI-AR TO GLNO
                 ADD TP-CURBAL TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-REPO-AR TO GLNO
                 SUBTRACT TP-CURBAL FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
0049             IF GP-NEW-REPO-UNEARNED-ACCTS = "Y"
      *            CREDIT ORIGINAL UNEARNED INTEREST
                    MOVE GI-UNINTCHG       TO GLNO
                    SUBTRACT TP-WORKAMT(1) FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
      *            DEBIT NEW REPO UNEARNED INTEREST
                    MOVE GI-UNINTREPO  TO GLNO
                    MOVE TP-WORKAMT(1) TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
      *            CREDIT ORIGINAL ADDON UNEARNED INTEREST
                    MOVE GI-UNADDON        TO GLNO
                    SUBTRACT TP-WORKAMT(2) FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
      *            DEBIT NEW REPO ADDON UNEARNED INTEREST
                    MOVE GI-UNADDONINTREPO  TO GLNO
                    MOVE TP-WORKAMT(2)      TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 END-IF.

           GO TO EXIT-TRP1-DETAIL.

      *---------------------------------------------
      *    REDUCE ANTICIPATED UNEARNED FOR P&L:
      *---------------------------------------------
       TP-SET-PL-UNEARNED.
           IF TP-WORKAMT(SUB) NOT = 0
      * UNEARNED:
0049          IF (GP-NEW-REPO-UNEARNED-ACCTS = "Y") AND
                 (SUB = 1 OR 2)
                 IF TP-REPOCD = "X" OR "S"
                    IF SUB = 1
                       MOVE GI-UNINTREPO TO GLNO
                    ELSE
                       IF SUB = 2
                          MOVE GI-UNADDONINTREPO TO GLNO
                       END-IF
                    END-IF
                 ELSE
                    IF SUB = 1
                       MOVE GI-UNINTCHG TO GLNO
                    ELSE
                       IF SUB = 2
                          MOVE GI-UNADDON TO GLNO
                       END-IF
                    END-IF
                 END-IF
              ELSE
                 MOVE GI-UNEARN(SUB) TO GLNO
              END-IF
              MOVE TP-WORKAMT(SUB) TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
      * EXPENSE:
      *  JTG    ADD TP-WORKAMT(SUB) TO GLWK.    990427
      *  IF NOT LOAN COSTS (6) ACCUMULATE FOR P&L EXPENSE REDUCTION
      * KM ALSO WANTED TO AMORTIZE THE PREPAID NOT REDUCE P&L EXPENSE
              IF (SUB NOT = 6 AND SUB NOT = 4)
                 ADD TP-WORKAMT(SUB) TO GLWK
              ELSE
              IF SUB = 6
      *  IF LOAN COSTS (6) DEBIT UNEARNED ABOVE & CREDIT LOAN COST INCOME
                 MOVE GI-EARN(SUB)   TO GLNO
                 SUBTRACT TP-WORKAMT(SUB) FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
              IF SUB = 4
                 IF (GP-INCL-OTH-IN-EARNED = "R" )
                    MOVE GI-EARN(SUB)   TO GLNO
                    SUBTRACT TP-WORKAMT(SUB) FROM GLAMT
                    PERFORM UPDATE-WORK-FILE-TRP
                 ELSE
                      ADD TP-WORKAMT(SUB) TO GLWK.

           ADD 1 TO SUB.

      *******************************************
      *  TEST TRCD TO DEBIT EITHER RESERVE
      *                         OR  BAD DEBT
      *******************************************
       TEST-PLEXP-DLRSV.
           IF TP-SERVACCT = "Y"
              MOVE GI-SERVOFF TO GLNO
           ELSE
              IF TP-TRCD = "PL" OR "P2" OR "P3" OR "P4" OR "P5"
                 MOVE GI-PLEXP(PLSUB) TO GLNO.

       TP-PW.
           IF TP-OTHBR-FG = " " OR "G"
              PERFORM TP-UPDATE-GLS
              MOVE GI-PL(PLSUB) TO GLNO
              SUBTRACT TP-APCUR FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-PLOFFSET(PLSUB) TO GLNO
              ADD TP-APCUR TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP.
           GO TO EXIT-TRP1-DETAIL.

       TP-TS.
           IF TP-OTHBR-FG = " " OR "G"
              PERFORM TP-UPDATE-GLS
              MOVE GI-AR TO GLNO
              SUBTRACT TP-TRAMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-DLRVPRIN-1 TO GLNO
              ADD TP-TRAMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP

              MOVE GI-UNINTCHG TO GLNO
              MOVE 1 TO FUNK-SUB
              MOVE TP-EARNINGS(FUNK-SUB) TO GLAMT
              ADD TP-WORKAMT(1) TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-ERINTCHG TO GLNO
              MOVE 1 TO FUNK-SUB
              SUBTRACT TP-EARNINGS(FUNK-SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP

              MOVE GI-UNADDON  TO GLNO
              MOVE 2 TO FUNK-SUB
              MOVE TP-EARNINGS(FUNK-SUB) TO GLAMT
              ADD TP-WORKAMT(2) TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-ERADDON  TO GLNO
              MOVE 2 TO FUNK-SUB
              SUBTRACT TP-EARNINGS(FUNK-SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP

              MOVE GI-UNSERCHG TO GLNO
              MOVE 3 TO FUNK-SUB
              MOVE TP-EARNINGS(FUNK-SUB) TO GLAMT
              ADD TP-WORKAMT(3) TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-ERSERCHG TO GLNO
              MOVE 3 TO FUNK-SUB
              SUBTRACT TP-EARNINGS(FUNK-SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP

              MOVE GI-UNMAINTFEE TO GLNO
              MOVE 4 TO FUNK-SUB
              MOVE TP-EARNINGS(FUNK-SUB) TO GLAMT
              ADD TP-WORKAMT(4) TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-ERMAINTFEE TO GLNO
              MOVE 4 TO FUNK-SUB
              SUBTRACT TP-EARNINGS(FUNK-SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP

              MOVE GI-UNDLDISC TO GLNO
              MOVE 5 TO FUNK-SUB
              MOVE TP-EARNINGS(FUNK-SUB) TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-ERDLDISC TO GLNO
              MOVE 5 TO FUNK-SUB
              SUBTRACT TP-EARNINGS(FUNK-SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP

              MOVE GI-UNOTHER TO GLNO
              MOVE 6 TO FUNK-SUB
              MOVE TP-EARNINGS(FUNK-SUB) TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE GI-EROTHER TO GLNO
              MOVE 6 TO FUNK-SUB
              SUBTRACT TP-EARNINGS(FUNK-SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP

              MOVE GI-DLRVPRIN-1 TO GLNO
              SUBTRACT TP-WORKAMT(1) TP-WORKAMT(2)
                       TP-WORKAMT(3) TP-WORKAMT(4)
                       TP-WORKAMT(5) TP-WORKAMT(6)
                 FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP.
           GO TO EXIT-TRP1-DETAIL.

       TP-TP.
           MOVE GI-AR TO GLNO.
           SUBTRACT TP-TRAMT FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRP.

           MOVE GI-SERVOFF TO GLNO.
           ADD TP-TRAMT TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRP.
           GO TO EXIT-TRP1-DETAIL.

      ********************************************
      *    INSURANCE ADDONS                      *
      ********************************************
       TP-LP-NP-RT-ET-ST.
           PERFORM WHICH-AR.
      *    MOVE GI-AR TO GLNO.
           MOVE TP-TRAMT TO GLAMT.
           IF TP-IBPC = "I"
             MOVE TP-APCUR TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRP.

      * SET EARNINGS/UNEARNED:
           MOVE 1 TO SUB.
           PERFORM TP-SET-EARNINGS 6 TIMES.

      * UPDATE GL FEES
           MOVE TP-GLNO(1) TO GLNO.
           SUBTRACT TP-GLAMT(1) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRP.
           MOVE TP-GLNO(2) TO GLNO.
           SUBTRACT TP-GLAMT(2) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRP.

      * SET INS PAYABLE:
           IF TP-ADDON-TYPE = "O1"
              MOVE GI-PAYO1 TO GLNO
           ELSE
           IF TP-ADDON-TYPE = "O2"
              MOVE GI-PAYO2 TO GLNO
           ELSE
           IF TP-ADDON-TYPE = "O3"
              MOVE GI-PAYO3 TO GLNO
           ELSE
           IF TP-ADDON-TYPE = "AH"
              MOVE GI-PAYAH TO GLNO
           ELSE
           IF TP-ADDON-TYPE = "PP"
              MOVE GI-PAYPP TO GLNO
           ELSE
           IF TP-ADDON-TYPE = "CL"
              IF TP-INSTYPES-DL
                 MOVE GI-PAYCL1 TO GLNO
              ELSE
                 MOVE GI-PAYCL2 TO GLNO
           ELSE
      * IF A FEE ADDON, IT WILL EXIT HERE
              GO TO EXIT-TRP1-DETAIL.
           COMPUTE GLAMT = 0
                 - (TP-APCUR - TP-INSCOMM
                          - TP-GLAMT(1) - TP-GLAMT(2)
                   ).
           PERFORM UPDATE-WORK-FILE-TRP.

      * SET INS COMMISSION:
           IF TP-ADDON-TYPE = "O1"
              MOVE GI-UNO1 TO GLNO
           ELSE
           IF TP-ADDON-TYPE = "O2"
              MOVE GI-UNO2 TO GLNO
           ELSE
           IF TP-ADDON-TYPE = "O3"
              MOVE GI-UNO3 TO GLNO
           ELSE
           IF TP-ADDON-TYPE = "AH"
              MOVE GI-UNAH TO GLNO
           ELSE
           IF TP-ADDON-TYPE = "PP"
              MOVE GI-UNPP TO GLNO
           ELSE
           IF TP-ADDON-TYPE = "CL"
              IF TP-INSTYPES-DL
                 MOVE GI-UNCL1 TO GLNO
              ELSE
                 MOVE GI-UNCL2 TO GLNO.
      *     PERFORM WORLD-SWITCH-TO-ORIG.
           SUBTRACT TP-INSCOMM FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRP.

           GO TO EXIT-TRP1-DETAIL.

      ********************************************
      *    UPDATE AR FOR 'TP'
      ********************************************
       TP-UPDATE-AR.
           IF TP-REFNO = "CHECK"
              MOVE GI-DIRECT-PAY TO GLNO
              SUBTRACT TP-TRAMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP.
           IF TP-OTHBR-FG = " " OR "G"
              IF TP-TRCD = "RE"
                 MOVE GI-REPO-ADDON-EXP TO GLNO
                 MOVE TP-APCUR          TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              END-IF
              PERFORM TP-UPDATE-GLS
              IF TP-PLCD = " "
                 PERFORM WHICH-AR
                 SUBTRACT TP-APCUR FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
              ELSE
                 MOVE GI-PL(PLSUB) TO GLNO
                 SUBTRACT TP-APCUR FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 MOVE GI-PLOFFSET(PLSUB) TO GLNO
                 MOVE TP-APCUR TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRP
                 IF NOT (TP-TRCD = "AP" OR "OP" OR "RE")
                    IF TP-SERVACCT NOT = "Y"
                       IF PLSUB = 1
                          MOVE GI-PLREC(PLSUB) TO GLNO
                          SUBTRACT TP-APCUR FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                       ELSE
                          MOVE GI-PLREC(PLSUB) TO GLNO
                          SUBTRACT TP-APCUR FROM GLAMT
                          ADD TP-PL-OTH-AR TO GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP
                          MOVE GI-PLNEW-AR(PLSUB) TO GLNO
                          SUBTRACT TP-PL-OTH-AR FROM GLAMT
                          PERFORM UPDATE-WORK-FILE-TRP.

       TP-UPDATE-GLS.
           MOVE TP-GLNO(1) TO GLNO.
           IF TP-TRCD = "PZ" OR "PN"
              ADD TP-GLAMT(1) TO GLAMT
           ELSE
              SUBTRACT TP-GLAMT(1) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRP.

           MOVE TP-GLNO(2) TO GLNO.
           IF TP-TRCD = "PZ" OR "PN"
              ADD TP-GLAMT(2) TO GLAMT
           ELSE
              SUBTRACT TP-GLAMT(2) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRP.

           MOVE TP-GLNO(3) TO GLNO.
           IF TP-TRCD = "PZ" OR "PN"
              ADD TP-GLAMT(3) TO GLAMT
           ELSE
              SUBTRACT TP-GLAMT(3) FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRP.

1801  *********************************************************************
1801  *    UPDATE INSURANCES FOR MIP INSURANCE
1801  *********************************************************************
1801   TP-MIP-INSURANCE.
1801
1801       IF TP-INSTYPES-DL
1801          MOVE GI-PAYCL1 TO GLNO
1801          SUBTRACT TP-MIP-CLPAID FROM TP-MIP-CLCOMM
1801                                          GIVING GLAMT
1801          PERFORM UPDATE-WORK-FILE-TRP
1801          MOVE GI-CL1 TO GLNO
1801          SUBTRACT TP-MIP-CLCOMM FROM GLAMT
1801          PERFORM UPDATE-WORK-FILE-TRP.
1801
1801       IF TP-INSTYPES-LL
1801          MOVE GI-PAYCL2 TO GLNO
1801          SUBTRACT TP-MIP-CLPAID FROM TP-MIP-CLCOMM
1801                                          GIVING GLAMT
1801          PERFORM UPDATE-WORK-FILE-TRP
1801          MOVE GI-CL2 TO GLNO
1801          SUBTRACT TP-MIP-CLCOMM FROM GLAMT
1801          PERFORM UPDATE-WORK-FILE-TRP.
1801
1801       MOVE GI-PAYAH TO GLNO.
1801       SUBTRACT TP-MIP-AHPAID FROM TP-MIP-AHCOMM
1801                                          GIVING GLAMT.
1801       PERFORM UPDATE-WORK-FILE-TRP.
1801       MOVE GI-AH TO GLNO.
1801       SUBTRACT TP-MIP-AHCOMM FROM GLAMT.
1801       PERFORM UPDATE-WORK-FILE-TRP.


       EXIT-TRP1-DETAIL.
           EXIT.

      ************************************************
      * DEPOSITS
      ************************************************

      ************************************************
       TRD1-DETAIL SECTION.
      ************************************************

           MOVE TD-BRNO TO BR-NO.
           PERFORM LPEOD5TR-GET-BR.
           IF ERROR-FG = "Y"
              GO TO EXIT-TRD1-DETAIL.

      ********************************************
      *    D E P O S I T S
      * TD-DEPOSIT = ACTUAL ENDING - OPENING
      ********************************************

      * LONPR0.C SET TD-BANK TO BR-GLBANK-DEPOSIT.
      * IF DIFFERENT, OPERATOR OVERRIDE TOOK PLACE:
      *******************************************************
      * 9/5/03 NOTE - I BELIEVE THERE IS A BUG HERE WHICH IS
      * THAT WE ARE MOVING GP-BANK-GL TO GLNO INSTEAD OF
      * GP-BANK-DEPOSIT-GL.  I WAS GOING TO FIX FOR WORLD,
      * BUT THEY DECIDED NOT TO USE GP FIELDS, & OTHER
      * CUSTOMERS MUST HAVE GP-BANK-GL = GP-BANK-DEPOSIT-GL
      *                         BARB
      *******************************************************
           MOVE TD-BANK    TO GLNO.
           IF BR-GLBANK-DEPOSIT = TD-BANK
              IF GP-BANK-GL NOT = 0
                 MOVE GP-BANK-GL TO GLNO.
           MOVE TD-DEPOSIT TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRD.

           MOVE TD-DEPOSIT TO CLEARING-WK.
           PERFORM BANK-CLEARING-DEPOSITS.
      * IF SCANNED CKS, DEBIT CHECK-DEPOSIT
           IF TD-CHECK-DEPOSIT = 2020202.02 OR 0202020.20
              MOVE 0 TO TD-CHECK-DEPOSIT.
           IF BR-ALLOW-SCANNED-CKS = "Y"
              MOVE BR-CHECK-DEPOSIT-GL TO GLNO
              MOVE TD-CHECK-DEPOSIT TO GLAMT  
              PERFORM UPDATE-WORK-FILE-TRD.
      * TD-OVERSHORT = EXPECTED ENDING - ACTUAL ENDING (SHORT=DEBIT)
           MOVE TD-GLOVERSHORT TO GLNO.
           MOVE TD-OVERSHORT TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRD.
      * CASH MUST GET NET TRANSACTIONS
           MOVE TD-CASH TO GLNO.
           COMPUTE GLAMT = 0 - TD-DEPOSIT - TD-OVERSHORT.
           IF BR-ALLOW-SCANNED-CKS = "Y"
              SUBTRACT TD-CHECK-DEPOSIT FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRD.

           PERFORM TD-UPD-BR.

       EXIT-TRD1-DETAIL.
           EXIT.

      ************************************************
      * CHECKS
      ************************************************

      ************************************************
       TRC1-DETAIL SECTION.
      ************************************************

           MOVE TC-BRNO TO BR-NO.
           PERFORM LPEOD5TR-GET-BR.
           IF ERROR-FG = "Y"
              GO TO EXIT-TRC1-DETAIL.

           IF TC-CLASS = 0
              GO TO TC-CODES.

           MOVE TC-BRNO  TO GI-BRANCH.
           MOVE TC-CLASS TO GI-CLASS.
           PERFORM LPEOD5TR-GET-GI.
           IF ERROR-FG = "I"
              GO TO EXIT-TRC1-DETAIL.

           MOVE TC-CLASS TO LC-CODE.
           PERFORM LPEOD5TR-GET-LC.

      ******************************************
      *           CHECK REGISTER
      *  VALID TYPES:
      *  LONPB2 = "DL"
      *  LONPD0 = "LN"
      *  LONPI0 = "LN,
      *            CA, MS, BK
      *            RE, SR,
      *            RR, RC, RP, RD
      *            DR, DC, DP"
      *  LONPF2 =
      *
      *  NOTE: IF THE GL DISTRIBUTIONS CHANGE
      *        ALSO CHANGE EMCKRG.C
      ******************************************
       TC-CODES.
           MOVE 1 TO SUB.

           IF TC-CLASS = 0
              MOVE BR-GLBANK TO GI-BANK
              MOVE BR-GLONHAND TO GI-CASH.

           IF TC-TYPE = "DL"
              MOVE GI-BANK      TO GLNO
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE TC-AMT TO CLEARING-WK
              PERFORM BANK-CLEARING-CHECKS-NSF
              MOVE GI-DLPAYABLE TO GLNO
              MOVE TC-AMT       TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

           IF TC-TYPE = "RD"
              MOVE GI-CASH      TO GLNO
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE GI-DLPAYABLE TO GLNO
              ADD TC-AMT        TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

           IF TC-TYPE = "DR"
              MOVE GI-BANK      TO GLNO
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE TC-AMT TO CLEARING-WK
              PERFORM BANK-CLEARING-CHECKS-NSF
              MOVE GI-DLRVPRIN(TC-DLRVNO) TO GLNO
              MOVE TC-AMT                 TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

           IF TC-TYPE = "DC"
              MOVE GI-BANK TO GLNO
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE TC-AMT TO CLEARING-WK
              PERFORM BANK-CLEARING-CHECKS-NSF
              MOVE GI-DLRVCHGS(TC-DLRVNO) TO GLNO
              MOVE TC-AMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

           IF TC-TYPE = "DP"
              IF TC-ACH-FG = "Y"
                 MOVE GI-ACH-BANK TO GLNO
              ELSE
                 MOVE GI-BANK TO GLNO
              END-IF
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE TC-AMT TO CLEARING-WK
              PERFORM BANK-CLEARING-CHECKS-NSF
              MOVE GI-DLPARV TO GLNO
              MOVE TC-AMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

      * RECEIPT FROM DEALER RESERVE PRINCIPAL:
           IF TC-TYPE = "RR"
              MOVE GI-CASH TO GLNO
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE GI-DLRVPRIN(TC-DLRVNO) TO GLNO
              MOVE TC-AMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

      * RECEIPT FROM DEALER RESERVE CHARGES:
           IF TC-TYPE = "RC"
              MOVE GI-CASH TO GLNO
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE GI-DLRVCHGS(TC-DLRVNO) TO GLNO
              MOVE TC-AMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

      * RECEIPT FROM DEALER PARTICIPATION HELD:
           IF TC-TYPE = "RP"
              MOVE GI-CASH TO GLNO
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE GI-DLPARV TO GLNO
              MOVE TC-AMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

           IF TC-TYPE = "CA"
              MOVE GI-CASH TO GLNO
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

      * DEBIT CARD (UMC) #1450
           IF TC-TYPE = "DB"
              PERFORM GET-REFCD-GL
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

           IF TC-TYPE = "BK" OR "ID" OR "IW"
              MOVE BR-GLBANK-DEPOSIT TO GLNO
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE TC-AMT TO CLEARING-WK
              PERFORM BANK-CLEARING-WITHDR
              GO TO TC-MSGL.

           IF TC-TYPE = "NP"
              GO TO EXIT-TRC1-DETAIL.

           IF TC-TYPE = "OV"
              GO TO EXIT-TRC1-DETAIL.

           IF TC-TYPE = "LN" 
              IF TC-PGM = "D0"
                 MOVE GI-BANK TO GLNO
                 SUBTRACT TC-AMT FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRC
                 MOVE TC-AMT TO CLEARING-WK
                 PERFORM BANK-CLEARING-CHECKS-NSF
                 MOVE GI-DIRECT-PAY TO GLNO
                 MOVE TC-AMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRC
                 GO TO TC-MSGL.

           IF TC-TYPE = "LN"
              IF TC-PGM = "F2" 
                 MOVE GI-BANK TO GLNO
                 SUBTRACT TC-AMT FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRC
                 MOVE TC-AMT TO CLEARING-WK
                 PERFORM BANK-CLEARING-CHECKS-NSF
                 MOVE GI-DIRECT-PAY TO GLNO
                 MOVE TC-AMT TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRC
                 GO TO TC-MSGL.

           IF TC-TYPE = "LN"
              IF TC-PGM = "I0"
                 MOVE GI-BANK TO GLNO
                 SUBTRACT TC-AMT FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRC
                 MOVE TC-AMT TO CLEARING-WK
                 PERFORM BANK-CLEARING-CHECKS-NSF
                 GO TO TC-MSGL.

      *  ACH DIRECT DEPOSIT TO DEALER'S BANK ACCOUNT:
           IF TC-TYPE = "AC"
              MOVE GI-ACH-BANK TO GLNO
              SUBTRACT TC-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE TC-AMT TO CLEARING-WK
              PERFORM BANK-CLEARING-CHECKS-NSF
              MOVE GI-DLPAYABLE TO GLNO
              MOVE TC-AMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              GO TO TC-MSGL.

           MOVE GI-BANK TO GLNO.
           SUBTRACT TC-AMT FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRC.
           MOVE TC-AMT TO CLEARING-WK.
           PERFORM BANK-CLEARING-CHECKS-NSF.

       TC-MSGL.
           IF SUB > 5
              GO TO TC-UPD-BR.
           IF TC-GLNO(SUB) = 0 OR TC-GLAMT(SUB) = 0
              ADD 1 TO SUB
              GO TO TC-MSGL.
           MOVE TC-GLNO(SUB) TO GLNO.
           MOVE TC-GLAMT(SUB) TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRC.
           ADD 1 TO SUB.
           GO TO TC-MSGL.

       TC-UPD-BR.
           IF NOT (TC-TYPE = "CA" OR "RR" OR "RC" OR "RP")
              IF GP-BANK-GL = 0
                 SUBTRACT TC-AMT FROM BR-BANKBAL.

           PERFORM CHECK-UPDATE-BR.

      * COMMENTED THIS OUT IN S34, LP/RECAPJ GIVING ERROR 9 ON READ NEXT
      * GOES BACK TO GROUP LOGIC AND FILE IS CLOSED WITHOUT A START AGAIN
      * CURSOR HAS TO STAY IN PLACE  (9/10/2021)
      *    PERFORM CLOSE-BR-FILE.

       EXIT-TRC1-DETAIL.
           EXIT.

      *********************************************
      *    DIRECT LOANS
      *********************************************

      ******************************************************
       TRL1-DETAIL SECTION.
      ******************************************************

           MOVE TL-BRNO TO BR-NO.
           PERFORM LPEOD5TR-GET-BR.
           IF ERROR-FG = "Y"
              GO TO EXIT-TRL1-DETAIL.

           MOVE TL-BRNO  TO GI-BRANCH.
           MOVE TL-CLASS TO GI-CLASS.
           PERFORM LPEOD5TR-GET-GI.
           IF ERROR-FG = "I"
              GO TO EXIT-TRL1-DETAIL.

           MOVE TL-CLASS TO LC-CODE.
           PERFORM LPEOD5TR-GET-LC.

           MOVE GI-AR    TO GLNO.
           MOVE TL-LNAMT TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRL.

           MOVE GI-DIRECT-PAY    TO GLNO.
           SUBTRACT TL-PROCEEDS FROM GLAMT.
           ADD TL-PROCASH        TO GLAMT.
           ADD TL-DEBIT-CARD-AMT TO GLAMT.
           PERFORM UPDATE-WORK-FILE-TRL.


      ***********************************************
      * MISSISSIPPI REBATE ADJ. REBL01.C:
      * IF REBATE-ADJ AND DISBURSMENT BY CASH
      *    - THE ADJ IS IN TL-PROCASH
      * IF REBATE-ADJ AND DISBURSMENT BY CHECK
      *    - THE ADJ IS IN TL-STATE-WORKER
      * NOTE: LONPD0 DOES NOT ALLOW CASH PROCEEDS < ADJ.
      *
      * DIRECT PAYABLE IS THE CORRECT OFFSET IN BOTH CASES:
      *    IF TL-PROCASH IS 0 DIRECT PAYABLE MUST BE INCREASED
      *                       TO REFLECT REFUND ADJ PAID BY CHECK
      *           ELSE
      *                       DIRECT PAYABLE WAS REDUCED BY REFUND
      *                       ADJUSTMENT REFLECTED IN TL-PROCASH
      *                       AND MUST BE ADDED BACK.

           IF TL-LPEOD5-FG = "A"
              IF TL-STATE-WORKER NOT = 0
                 MOVE GI-ERINTCHG    TO GLNO
                 ADD TL-STATE-WORKER TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRL
                 MOVE GI-DIRECT-PAY TO GLNO
                 SUBTRACT TL-STATE-WORKER FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRL.

           IF TL-PROCASH NOT = 0
              MOVE GI-CASH TO GLNO
              SUBTRACT TL-PROCASH FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRL.

           IF TL-DEBIT-CARD-AMT NOT = 0
              MOVE BR-GL-DEBIT-CARD-PROCEEDS TO GLNO
              SUBTRACT TL-DEBIT-CARD-AMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRL.

      * SET EARNINGS:
           MOVE 1 TO SUB.
           PERFORM TL-SET-EARNINGS 6 TIMES.

      * SET INS PAYABLE:
           PERFORM TL-OUR-INS.

      * SET FEES:
           MOVE 1 TO L1.
           PERFORM TL-OUR-FEES 10 TIMES.


           IF TL-PRDLDISC-UNEARN = 2020202.02 OR 0202020.20
              MOVE 0 TO TL-PRDLDISC-UNEARN.
2287  * UPDATE CARRY OVER DISCOUNT UNEARNED ON RENEWALS:
           IF TL-SRCD = "PB" OR "RN" OR "SC" OR "RB" OR "RO"
              IF TL-PRDLDISC-UNEARN NOT = 0
      *         ANTIC EARNINGS:
                 MOVE GI-EROTHER     TO GLNO
                 MOVE TL-PRDLDISC-UNEARN TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRL.

           GO TO EXIT-TRL1-DETAIL.

      *******************************************
      *    SET OUR INSURANCE:
      *******************************************
       TL-OUR-INS.
           IF TL-INSOURS(1) = "Y"
              IF TL-INSTYPES-DL
                 MOVE GI-PAYCL1 TO GLNO
                 SUBTRACT TL-INSPREM(1) FROM TL-INSCOMM(1)
                                               GIVING GLAMT
                 PERFORM UPDATE-WORK-FILE-TRL
                 MOVE GI-UNCL1 TO GLNO
      *            PERFORM WORLD-SWITCH-TO-ORIG
                 SUBTRACT TL-INSCOMM(1) FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRL.
           IF TL-INSOURS(1) = "Y"
              IF TL-INSTYPES-LL
                 MOVE GI-PAYCL2 TO GLNO
                 SUBTRACT TL-INSPREM(1) FROM TL-INSCOMM(1)
                                               GIVING GLAMT
                 PERFORM UPDATE-WORK-FILE-TRL
                 MOVE GI-UNCL2 TO GLNO
      *            PERFORM WORLD-SWITCH-TO-ORIG
                 SUBTRACT TL-INSCOMM(1) FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRL.
           IF TL-INSOURS(2) = "Y"
              MOVE GI-PAYAH TO GLNO
              SUBTRACT TL-INSPREM(2) FROM TL-INSCOMM(2)
                                            GIVING GLAMT
              PERFORM UPDATE-WORK-FILE-TRL
              MOVE GI-UNAH TO GLNO
      *            PERFORM WORLD-SWITCH-TO-ORIG
              SUBTRACT TL-INSCOMM(2) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRL.
           IF TL-INSOURS(3) = "Y"
              MOVE GI-PAYPP TO GLNO
              SUBTRACT TL-INSPREM(3) FROM TL-INSCOMM(3)
                                            GIVING GLAMT
              PERFORM UPDATE-WORK-FILE-TRL
              MOVE GI-UNPP TO GLNO
      *            PERFORM WORLD-SWITCH-TO-ORIG
              SUBTRACT TL-INSCOMM(3) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRL.
           PERFORM TL-OURS-UNOT
               VARYING SUB FROM 4 BY 1
                  UNTIL SUB > 10.

      *******************************************
      *    UPDATE OUR OTHER INSURANCES:
      *******************************************
       TL-OURS-UNOT.
           IF TL-INSOURS(SUB) = "Y"
              MOVE GI-UNOT(SUB - 3) TO GLNO
      *            PERFORM WORLD-SWITCH-TO-ORIG
              SUBTRACT TL-INSCOMM(SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRL
              MOVE GI-PAYOT(SUB - 3) TO GLNO
              SUBTRACT TL-INSPREM(SUB) FROM TL-INSCOMM(SUB)
                                                 GIVING GLAMT
              PERFORM UPDATE-WORK-FILE-TRL.

      *******************************************
      *    SET OUR FEES:
      *******************************************
      *******************************************
      * 11/11/03
      * WHEN FEE CODE IS OURS (TS-FEEOURS = "Y) AND THE COMMISSION FIELD ( CD-
      * GC-COMM-PERCENT) IN THE FEE CODE IS NON-ZERO A COMMISSION AMOUNT WILL BE
      * COMPUTED AND UPDATE GL NUMBER (CDB-GC-COMM-GLFEENO) IN THE FEE CODE
      *FILE.
      *
      *EXAMPLE: FEE 01 20.00  CDB-GC-COMM-GLFEENO = 1111111
      *                       CDB-GC-COMM-PERCENT 10.00
      * THE TS-FEEAMT IS SUBTRACTED FROM COMPUTED COMMISSION (THIS IS THE AMOUNT
       TL-OUR-FEES.
           MOVE TL-FEECODE(L1) TO CDB-CODE.
           MOVE TL-BRNO        TO CDB-BRANCH GLNO-BR.
           PERFORM GET-CODE.
           IF IO-FG = 0
              PERFORM TEST-BR-FEE-GL-BRNO
              MOVE CDB-GC-GLFEENO TO GLNO-NUMBER
              IF (LC-USE-ALT-GL-FEE = "Y" AND
                       CDB-GC-ALT-GLFEENO NOT = 2020202 AND
                        CDB-GC-ALT-GLFEENO NOT = 0)
                 MOVE CDB-GC-ALT-GLFEENO TO GLNO-NUMBER
              END-IF
              IF (CDB-GC-COMM-PERCENT = 99.99)
                 MOVE 100 TO HOLD-COMM-PERCENT
              ELSE
                 MOVE CDB-GC-COMM-PERCENT TO HOLD-COMM-PERCENT
              END-IF
              MOVE 0 TO FEE-COMMISSION
              IF HOLD-COMM-PERCENT NOT = 0 AND
                   HOLD-COMM-PERCENT NOT = 20.20
                  COMPUTE FEE-COMMISSION =
                   HOLD-COMM-PERCENT / 100 * TL-FEEAMT(L1)
              END-IF
              SUBTRACT TL-FEEAMT(L1) FROM FEE-COMMISSION
                  GIVING GLAMT
              PERFORM UPDATE-WORK-FILE-TRL
              IF FEE-COMMISSION NOT = 0
                 MOVE CDB-GC-COMM-GLFEENO TO GLNO
                 SUBTRACT FEE-COMMISSION FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRL
              END-IF

2542  *       IF CDB-GC-FEE-EARNINGS-FG IS 'Y'
      *          CREDIT ADDON UNEARN  WITH TL-FEEAMT(L1)
      *          DEBIT  ADDON EARNING WITH TL-FEEAMT(L1)
      *          WHICH WAS ADDED TO LN-ANTICERN(2) IN LP/LONPC2.C
              IF CDB-GC-FEE-EARNINGS-FG = "Y"
                 MOVE GI-UNADDON        TO GLNO
                 SUBTRACT TL-FEEAMT(L1) FROM GLAMT
                 PERFORM UPDATE-WORK-FILE-TRL

                 MOVE GI-ERADDON     TO GLNO
                 MOVE TL-FEEAMT(L1)  TO GLAMT
                 PERFORM UPDATE-WORK-FILE-TRL.

           ADD 1 TO L1.

      *******************************************
      *    SET ANTICIPATED EARNINGS FOR ACCOUNTS:
      *******************************************
       TL-SET-EARNINGS.
      *    PR NO #2542
      *    WILL SKIP UPDATING EARN/UNEARN FOR ADDONS SINCE,
      *    ADDON ANTICPATED DOSN'T EXIST AT LOAN BOOKING
      *    EXCEPT FOR FEES BOOKED THAT ARE SET WITH CDB-GC-FEE-EARNINGS-FG = 'Y'
      *    AND THE GL EARN/UNEARN UPDATE WILL TAKE PLACE IN THE TL-OUR-FEES
      *    PARAGRAPH.
2542       IF SUB NOT = 2
           IF TL-ANTICERN(SUB) NOT = 0
      * UNEARNED:
              MOVE GI-UNEARN(SUB) TO GLNO
              MOVE TL-EARNINGS(SUB) TO GLAMT
              SUBTRACT TL-ANTICERN(SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRL
      *       ANTICERN(6) IS LOAN COSTS AND IT REQUIRES AN OFFSET
      *       TO EARNINGS: EX. CREDIT ANTIC   DEBIT INCOME
2287          IF NOT (TL-SP-LNCOST-FRMLA = "D" OR "P" OR "R")
                 IF SUB = 6
                    MOVE GI-EARN(SUB)   TO GLNO
                    MOVE TL-ANTICERN(SUB) TO GLAMT
                    PERFORM UPDATE-WORK-FILE-TRL
                 END-IF
              END-IF
      * ANTIC EARNINGS:
              MOVE GI-EARN(SUB)   TO GLNO
              SUBTRACT TL-EARNINGS(SUB) FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRL.
           ADD 1 TO SUB.

       EXIT-TRL1-DETAIL.
           EXIT.

      ******************************************************
       WORLD-REFNO-DEBIT SECTION.
      ******************************************************
           IF TP-OTHBR-FG = "C"
              MOVE GI-OTHBR-PAY TO GLNO
              IF GP-INTERBR-AR-AP-FULLGL = "Y"
                 MOVE TP-POSTING-BR TO GLOTHBR
              END-IF
              SUBTRACT TP-TRAMT FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
           END-IF
           IF TP-OTHBR-FG = "G"
              MOVE GI-OTHBR-REC TO GLNO
              IF GP-INTERBR-AR-AP-FULLGL = "Y"
                 MOVE TP-POSTING-BR TO GLOTHBR
              END-IF
              MOVE TP-TRAMT TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
           END-IF
           IF TP-OTHBR-FG = " " OR "C"
              IF TP-REFNO = "LBOX"
                 MOVE GI-PAYLBOX  TO GLNO
              ELSE
                 IF TP-REFNO = "TPAY"
                    MOVE GI-PAYTPAY  TO GLNO
                 ELSE
                    IF TP-REFNO = "TCOLL"
                       MOVE GI-PAYTCOLL  TO GLNO
                    ELSE
                       IF TP-REFNO = "MGRAM"
                          MOVE GI-PAYMGRAM  TO GLNO
                       ELSE
0006                       IF TP-REFNO = BATCH-REFCD
0006                          MOVE BATCH-REFCD-GLNO TO GLNO
0006                          IF GLNO-BR = 0
0006                             MOVE TP-BRNO TO GLNO-BR
0006                          END-IF
0006                       ELSE
                              MOVE GI-PAYALLOT  TO GLNO
                           END-IF
                        END-IF
                     END-IF
                  END-IF
               END-IF
               MOVE TP-TRAMT TO GLAMT
               PERFORM UPDATE-WORK-FILE-TRP.

       WORLD-BATCH-REFCD-EXIT.
            EXIT.


      *****************************
       GET-REFCD-GL SECTION.
      *****************************
           MOVE "BR"           TO CD-TYPE.
           MOVE TC-DEBIT-REFCD TO CD-CODE.
           PERFORM READ-CD1-FILE.
           IF IO-GOOD AND (CD-BR-FILE-TYPE = "C")
              MOVE CD-BR-GL-ACCOUNTS TO GLNO
           ELSE
              MOVE 9999999           TO GLNO.

      *****************************
      *    FIND PL TYPE SUB
      *****************************
       FIND-PLTYPE-SUB SECTION.
           IF TP-PLTYPE = "P" OR " "
              MOVE 1 TO PLSUB
           ELSE
              MOVE TP-PLTYPE TO PLSUBX.

      ******************************************
      *    FIND PL TYPE SUB RE: BULK TRANSFER
      ******************************************
       FIND-PLTYPE-SUB-TB SECTION.
           IF TB-PLTYPE = "P" OR " "
              MOVE 1 TO PLSUB
           ELSE
              MOVE TB-PLTYPE TO PLSUBX.

      ******************************************
      *    FIND PL TYPE SUB RE: CLASS TRANSFER
      ******************************************
       FIND-PLTYPE-SUB-TJ SECTION.
           IF TJ-PLTYPE = "P" OR " "
              MOVE 1 TO PLSUB
           ELSE
              MOVE TJ-PLTYPE TO PLSUBX.

      **********************************************
      *    FIND PL TYPE SUB RE: ACCOUNT CONVERSION
      **********************************************
       FIND-PLTYPE-SUB-TK SECTION.
           IF TK-PLTYPE = "P" OR " "
              MOVE 1 TO PLSUB
           ELSE
              MOVE TK-PLTYPE TO PLSUBX.

      *****************************************
      *    DETERMINE WHICH AR (AR OR REPO)
      *****************************************
       WHICH-AR SECTION.
           IF TP-REPOCD = "X" OR "S"
              MOVE GI-REPO-AR TO GLNO
           ELSE
              MOVE GI-AR TO GLNO.

      *****************************************
      *    UPDATE BANK CLEARING FOR DEPOSITS
      *****************************************
       BANK-CLEARING-DEPOSITS SECTION.
           IF GP-BANK-GL NOT = 0
              MOVE GP-BANK-CLEARING-GL TO GLNO
              SUBTRACT CLEARING-WK FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRD
              MOVE BR-BANK-CLEARING-GL TO GLNO
              ADD CLEARING-WK TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRD.

      *****************************************
      *    UPDATE BANK CLEARING FOR PAYMENTS NSF
      *****************************************
       BANK-CLEARING-CHECKS-NSF-TRP SECTION.
           IF GP-BANK-GL NOT = 0
              MOVE GP-BANK-CLEARING-GL TO GLNO
              ADD CLEARING-WK TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRP
              MOVE BR-BANK-CLEARING-GL TO GLNO
              SUBTRACT CLEARING-WK FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRP.

      *****************************************
      *    UPDATE BANK CLEARING FOR CHECKS
      *****************************************
       BANK-CLEARING-CHECKS-NSF SECTION.
           IF GP-BANK-GL NOT = 0
              MOVE GP-BANK-CLEARING-GL TO GLNO
              ADD CLEARING-WK TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE BR-BANK-CLEARING-GL TO GLNO
              SUBTRACT CLEARING-WK FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC.

      *****************************************
      *    UPDATE BANK CLEARING FOR WITHDRAWALS
      *****************************************
       BANK-CLEARING-WITHDR SECTION.
           IF GP-BANK-GL NOT = 0
              MOVE GP-BANK-CLEARING-GL TO GLNO
              ADD CLEARING-WK TO GLAMT
              PERFORM UPDATE-WORK-FILE-TRC
              MOVE BR-BANK-CLEARING-GL TO GLNO
              SUBTRACT CLEARING-WK FROM GLAMT
              PERFORM UPDATE-WORK-FILE-TRC.

288   ******************************************************************
288   *    UPDATE INSURANCE TAX REBATE
288   ******************************************************************
288    UPDATE-INS-TAX-RB SECTION.
288        IF BR-FORCE-VALID-CITY-COUNTY = "Y"
288           MOVE TP-BRNO TO CDB-BRANCH GLNO-BR
288           IF TP-TRCD = "CC" OR "RC"
288              MOVE "TC" TO CDB-CODE
288           ELSE
288              IF TP-TRCD = "CA" OR "RA"
288                 MOVE "TA" TO CDB-CODE
288              ELSE
288                 IF TP-TRCD = "CP" OR "RP"
288                    MOVE "TP" TO CDB-CODE
288                 ELSE
288                    IF TP-TRCD = "C1" OR "R1"
288                       MOVE "T1" TO CDB-CODE
288                    ELSE
288                       IF TP-TRCD = "C2" OR "R2"
288                          MOVE "T2" TO CDB-CODE
288                       ELSE
288                          IF TP-TRCD = "C3" OR "R3"
288                             MOVE "T3" TO CDB-CODE
288                          END-IF
288                       END-IF
288                    END-IF
288                 END-IF
288              END-IF
288           END-IF
288           PERFORM GET-CODE
288           IF IO-FG = 0
288              MOVE CDB-GC-GLFEENO    TO GLNO-NUMBER
                 IF (LC-USE-ALT-GL-FEE = "Y" AND
                       CDB-GC-ALT-GLFEENO NOT = 2020202 AND
                        CDB-GC-ALT-GLFEENO NOT = 0)
                    MOVE CDB-GC-ALT-GLFEENO TO GLNO-NUMBER
                 END-IF
288              IF TP-INS-TAX-RB = 2020202.02
288                 MOVE 0 TO TP-INS-TAX-RB
288              END-IF
288              MOVE TP-INS-TAX-RB TO GLAMT
288              PERFORM UPDATE-WORK-FILE-TRP.


      ******************************************************************
       TK-UPDATE-RESERVES SECTION.
      ******************************************************************

           MOVE GI-DLRVPRIN-1 TO GLNO.
           SUBTRACT TK-DLRVPRIN(1) FROM GLAMT.
           SUBTRACT TK-DLRVPRIN(1) FROM GLWK.
           PERFORM UPDATE-WORK-FILE-TRK.

           MOVE GI-DLRVPRIN-2 TO GLNO.
           SUBTRACT TK-DLRVPRIN(2) FROM GLAMT.
           SUBTRACT TK-DLRVPRIN(2) FROM GLWK.
           PERFORM UPDATE-WORK-FILE-TRK.

           MOVE GI-CONV-OFFSET TO GLNO.
           SUBTRACT GLWK FROM GLAMT.
           PERFORM UPDATE-WORK-FILE-TRK.

       TK-UPDATE-RESERVES-EXIT.
           EXIT.

      ****************************************************
       LPEOD5TR-MISC-ROUTINES SECTION.
      ****************************************************
       LPEOD5TR-GET-BR.
           IF DATA-SUPL-LPEOD5TR-BR-SW = "N"
              PERFORM OPEN-BR-FILE
              PERFORM READ-BR-FILE
              IF IO-FG = 9
                 MOVE "Y" TO ERROR-FG
                 PERFORM SAVE-ERROR-MSG
                 PERFORM CREATE-LOG
                 EXIT PARAGRAPH.
      *    ELSE
      * WHEN GLOBAL PARAMETER BANK ACCOUNT IS NOT ZERO,
      * CORPORATE BANKING EXISTS AND NO ENTRIES WILL GO
      * TO THE LOCAL BANK ACCOUNT.
              IF GP-BANK-GL NOT = 0
                 MOVE GP-BANK-GL         TO BR-GLBANK
                 MOVE GP-BANK-DEPOSIT-GL TO BR-GLBANK-DEPOSIT.

       LPEOD5TR-GET-GI.
           IF DATA-SUPL-LPEOD5TR-GI-SW = "N"
              PERFORM READ-GI1-FILE
              IF IO-FG = 9
                 MOVE "I" TO ERROR-FG
                 PERFORM SAVE-ERROR-MSG
                 PERFORM CREATE-LOG
                 MOVE
                 "***********  INVALID GL INTERFACE, CLASS &&! ********"
                   TO DETAIL-LINE
                 INSPECT DETAIL-LINE REPLACING FIRST "&&&" BY GI-CLASS
                 PERFORM WRITE-DETAIL-LINE
              EXIT PARAGRAPH.
      * * WHEN GLOBAL PARAMETER BANK ACCOUNT IS NOT ZERO,
      * * CORPORATE BANKING EXISTS AND NO ENTRIES WILL GO
      ** TO THE LOCAL BANK ACCOUNT
      *     ELSE
              IF GP-BANK-GL NOT = 0
                 MOVE GP-BANK-GL         TO GI-BANK
                 MOVE GP-BANK-DEPOSIT-GL TO GI-NSF.

       LPEOD5TR-GET-LC.
           IF DATA-SUPL-LPEOD5TR-LC-SW = "N"
              PERFORM READ-LC1-FILE
              IF IO-FG = 9
                 MOVE "N" TO LC-USE-ALT-GL-FEE.

       UPDATE-WORK-FILE-TRP.
           MOVE "P"           TO TR-CODE.
           MOVE TP-DATE       TO TR-DATE.
           MOVE TP-ACCTNO     TO TR-ACCT.
           MOVE TP-TRCD       TO TR-TYPE-TRCD.
           MOVE SPACES        TO TR-SUBKEY.
           MOVE TP-ACCTNO     TO TRP-SUBKEY-ACCTNO.
           MOVE TP-LINE       TO TRP-SUBKEY-LINE.
           MOVE TP-CLASS      TO TR-CLASS.
           MOVE TP-REFNO      TO TR-REFNO.
           MOVE TP-PLTYPE     TO TR-PLTYPE.
           MOVE TP-POSTING-BR TO TR-POSTING-BR.
           MOVE TP-OTHBR-FG   TO TR-OTHBR-FG.
           MOVE TP-ACTIONCD2  TO TR-ACTIONCD2.
           PERFORM UPDATE-WORK-FILE.
       UPDATE-WORK-FILE-TRS.
           MOVE "S"          TO TR-CODE.
           MOVE TS-DATE      TO TR-DATE.
           MOVE TS-ACCTNO    TO TR-ACCT.
           MOVE SPACES       TO TR-SUBKEY.
           MOVE TS-ACCTNO    TO OTHER-SUBKEY-ACCTNO.
           MOVE TS-LAWCODE   TO OTHER-SUBKEY-LAWCODE.
           MOVE TS-LINE      TO OTHER-SUBKEY-LINE.
           MOVE TS-CLASS     TO TR-CLASS.
           MOVE TS-ACTIONCD2 TO TR-ACTIONCD2.
           PERFORM UPDATE-WORK-FILE.
       UPDATE-WORK-FILE-TRL.
           MOVE "L"          TO TR-CODE.
           MOVE TL-DATE      TO TR-DATE.
           MOVE TL-ACCTNO    TO TR-ACCT.
           MOVE SPACES       TO TR-SUBKEY.
           MOVE TL-ACCTNO    TO OTHER-SUBKEY-ACCTNO.
           MOVE TL-LAWCODE   TO OTHER-SUBKEY-LAWCODE.
           MOVE TL-LINE      TO OTHER-SUBKEY-LINE.
           MOVE TL-CLASS     TO TR-CLASS.
           MOVE TL-ACTIONCD2 TO TR-ACTIONCD2.
           PERFORM UPDATE-WORK-FILE.
       UPDATE-WORK-FILE-TRX.
           MOVE "X"        TO TR-CODE.
           MOVE TX-DATE    TO TR-DATE.
           MOVE TX-ACCTNO  TO TR-ACCT.
           MOVE SPACES     TO TR-SUBKEY.
           MOVE TX-ACCTNO  TO OTHER-SUBKEY-ACCTNO.
           MOVE TX-LAWCODE TO OTHER-SUBKEY-LAWCODE.
           MOVE TX-LINE    TO OTHER-SUBKEY-LINE.
           MOVE TX-CLASS   TO TR-CLASS.
           PERFORM UPDATE-WORK-FILE.
       UPDATE-WORK-FILE-TRC.
           MOVE "C"         TO TR-CODE.
           MOVE TC-KEY-DATE TO TR-DATE.
           MOVE TC-CKNO     TO TR-ACCT.
           MOVE SPACES      TO TR-SUBKEY.
           MOVE TC-TYPE     TO TR-TYPE-TRCD.
           MOVE TC-REASON   TO TR-REASON.
           MOVE TC-CLASS    TO TR-CLASS.
           PERFORM UPDATE-WORK-FILE.
       UPDATE-WORK-FILE-TRD.
           MOVE "D"       TO TR-CODE.
           MOVE TD-DATE   TO TR-DATE.
           MOVE 0         TO TR-ACCT.
           MOVE SPACES    TO TR-SUBKEY.
           MOVE 0         TO TR-CLASS.
           PERFORM UPDATE-WORK-FILE.
       UPDATE-WORK-FILE-TRB.
           MOVE "B"           TO TR-CODE.
           MOVE TB-DATE       TO TR-DATE.
           MOVE TB-REF-ACCTNO TO TR-ACCT.
           MOVE SPACES        TO TR-SUBKEY.
           MOVE TB-ACCTNO     TO OTHER-SUBKEY-ACCTNO.
           MOVE TB-LAWCODE    TO OTHER-SUBKEY-LAWCODE.
           MOVE TB-LINE       TO OTHER-SUBKEY-LINE.
           MOVE TB-CLASS      TO TR-CLASS.
           MOVE TB-ACTIONCD2  TO TR-ACTIONCD2.
           PERFORM UPDATE-WORK-FILE.
       UPDATE-WORK-FILE-TRJ.
           MOVE "J"        TO TR-CODE.
           MOVE TJ-DATE    TO TR-DATE.
           MOVE TJ-ACCTNO  TO TR-ACCT.
           MOVE SPACES     TO TR-SUBKEY.
           MOVE TJ-ACCTNO  TO OTHER-SUBKEY-ACCTNO.
           MOVE TJ-LAWCODE TO OTHER-SUBKEY-LAWCODE.
           MOVE TJ-LINE    TO OTHER-SUBKEY-LINE.
           MOVE TJ-CLASS   TO TR-CLASS.
           PERFORM UPDATE-WORK-FILE.
       UPDATE-WORK-FILE-TRK.
           MOVE "K"        TO TR-CODE.
           MOVE TK-DATE    TO TR-DATE.
           MOVE TK-ACCTNO  TO TR-ACCT.
           MOVE SPACES     TO TR-SUBKEY.
           MOVE TK-ACCTNO  TO OTHER-SUBKEY-ACCTNO.
           MOVE TK-LAWCODE TO OTHER-SUBKEY-LAWCODE.
           MOVE TK-LINE    TO OTHER-SUBKEY-LINE.
           MOVE TK-CLASS   TO TR-CLASS.
           PERFORM UPDATE-WORK-FILE.

      *************************************************
      *    TEST FOR WORLD AND IF SO CHANGE TO SHADOW
      *    INSURANCE ORIG ACCOUNT
      *************************************************
      *WORLD-SWITCH-TO-ORIG SECTION.
      *    IF GP-I-AM-WORLD
      * CL
      *       IF GLNO-NUMBER = 1283001
      *          MOVE 5135101 TO GLNO-NUMBER
      *       ELSE
      * AH
      *       IF GLNO-NUMBER = 1283002
      *          MOVE 5135201 TO GLNO-NUMBER
      *       ELSE
      * PP
      *       IF GLNO-NUMBER = 1284001
      *          MOVE 5145101 TO GLNO-NUMBER
      *       ELSE
      * OTHER
      *       IF GLNO-NUMBER = 1284003
      *          IF (BR-STATE = "TN") AND
      *             (SUB = 6)
      *             MOVE 5155101 TO GLNO-NUMBER
      *          ELSE
      *             IF BR-STATE = "KY" OR "MO" OR "AL"
      *                MOVE 5145201 TO GLNO-NUMBER
      *             END-IF
      *          END-IF
      *       ELSE
      *       IF GLNO-NUMBER = 1284002
      *          IF BR-STATE = "KY" OR "MO"
      *             MOVE 5155101 TO GLNO-NUMBER
      *          ELSE
      *          IF BR-STATE = "GA"
      *             MOVE 5145201 TO GLNO-NUMBER
      *          ELSE
      *          IF (BR-STATE = "TN") AND
      *             (SUB = 4)
      *             MOVE 5145201 TO GLNO-NUMBER
      *          ELSE
      *          IF BR-STATE = "SC" OR "TN" OR "OK"
      *             IF SUB = 5
      *                MOVE 5147101 TO GLNO-NUMBER
      *             ELSE
      *                MOVE 5155101 TO GLNO-NUMBER.

      *************************************************
      *    TEST FOR WORLD AND IF SO CHANGE TO SHADOW
      *    INSURANCE REFUND ACCOUNT
      *************************************************
      *WORLD-SWITCH-TO-REFUND SECTION.
      *    IF GP-I-AM-WORLD
      * CL
      *       IF GLNO-NUMBER = 1283001
      *          MOVE 5135102 TO GLNO-NUMBER
      *       ELSE
      * AH
      *       IF GLNO-NUMBER = 1283002
      *          MOVE 5135202 TO GLNO-NUMBER
      *       ELSE
      * PP
      *       IF GLNO-NUMBER = 1284001
      *          MOVE 5145102 TO GLNO-NUMBER
      *       ELSE
      * OTHER
      *       IF GLNO-NUMBER = 1284003
      *          IF (BR-STATE = "TN") AND
      *             (TP-TRCD = "C3" OR "R3")
      *             MOVE 5155102 TO GLNO-NUMBER
      *          ELSE
      *             IF BR-STATE = "KY" OR "MO" OR "AL"
      *                MOVE 5145202 TO GLNO-NUMBER
      *             END-IF
      *          END-IF
      *       ELSE
      *       IF GLNO-NUMBER = 1284002
      *          IF BR-STATE = "KY" OR "MO"
      *             MOVE 5155102 TO GLNO-NUMBER
      *          ELSE
      *          IF BR-STATE = "GA"
      *             MOVE 5145202 TO GLNO-NUMBER
      *          ELSE
      *          IF (BR-STATE = "TN") AND
      *             (TP-TRCD = "C1" OR "R1")
      *             MOVE 5145202 TO GLNO-NUMBER
      *          ELSE
      *          IF BR-STATE = "SC" OR "TN" OR "OK"
      *             IF TP-TRCD = "C2" OR "R2"
      *                MOVE 5147102 TO GLNO-NUMBER
      *             ELSE
      *                MOVE 5155102 TO GLNO-NUMBER.
      *-----------------------------------------------------------------------
      *    DUMMY SECTION TO INCLUDE IN COPY MEMBERS THAT NEED TO BE
      *    REFLECTED IN 'WHAT' COMMANDS FOR SUPPORT
      *-----------------------------------------------------------------------
       SCCS-COPY-ROUTINE SECTION. MOVE
           "@(#)./LIBLP/LPEOD5TR.CPY S35 >"
              TO MESS.

