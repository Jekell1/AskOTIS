       IDENTIFICATION DIVISION.
       PROGRAM-ID.    BYFILE.
       DATE-WRITTEN.  11-06-2023.
      ******************************************************************
      *
      * DESCRIPTION   : COMPARE S35 BYFILE WITH A15 BYFILE
      *            
      *                 TO BE USED AFTER AN UPDATE
      *                 WILL COMPARE EACH FIELD AND REPORT ANY 
      *                 DIFFERENCES, AS LONG AS FIELD EXIST IN BOTH FILES
      *
      *  LOOPS THRU THE A15 FILE AND VERIFIES THE S35 FILE EXIST AND MATCHES
      *
      *
      *  01-07-25  RMZ  ADDED 'BTRACK' - PROCESS TRACKING TO PROGRAM.
      *
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. 3B.
       OBJECT-COMPUTER. 3B.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
       COPY "LIBGB/GBFSPR.CPY".
      * COPYMEMBER: LIBLP/LPFSBY
           SELECT OBY-FILE ASSIGN TO OBY-PATH
                  ORGANIZATION INDEXED
                  ACCESS DYNAMIC
                  LOCK MODE AUTOMATIC WITH LOCK ON RECORD
                  RECORD KEY OBY1-KEY
                  FILE STATUS FILE-STAT.

           SELECT WK-FILE ASSIGN TO WK-PATH
                  ORGANIZATION INDEXED
                  ACCESS DYNAMIC
                  LOCK MODE AUTOMATIC WITH LOCK ON RECORD
                  RECORD KEY WK-KEY
                  FILE STATUS FILE-STAT.

       I-O-CONTROL.
       DATA DIVISION.
       FILE SECTION.
       COPY "LIBGB/GBFDPR.CPY".
       FD  OBY-FILE
           LABEL RECORDS ARE STANDARD.
       COPY "LIBUP/A15SRC/LP01BY.CPY" REPLACING LEADING "BY" BY "OBY".

       FD  WK-FILE
           LABEL RECORDS ARE STANDARD.
       01  WK-REC.
           03  WK-KEY.
               05  WK-KEY-BRNO         PIC 9(4).
               05  WK-KEY-CLASS        PIC 9(3).
               05  WK-KEY-DATE         PIC 9(6).
           03  WK-DATA                 PIC X(OBY-SIZE).

      ******************************************************************
      *
      *     W O R K I N G - S T O R A G E   S E C T I O N
      *
      ******************************************************************
       WORKING-STORAGE SECTION.
       77  SCCS-IDENTIFIER PIC X(37) VALUE
           "@(#)UT/BYFILE S35 01/13/25-06:59:49 >".

       COPY "LIBGB/GB01BR.CPY".
       COPY "LIBGB/GB01BR_SQL.CPY".
       COPY "LIBGB/GBWSBR.CPY".
       COPY "LIBLP/LP01BY.CPY".
       COPY "LIBLP/LP01BYA.CPY".
       COPY "LIBLP/LP01BYB.CPY".
       COPY "LIBLP/LP01BY_SQL.CPY".
       COPY "LIBLP/LPWSBY.CPY".

       01  OBY-PATH                    PIC X(35) VALUE SPACES.
       01  OBY-ALL-PATH.
           03  OBY-ALL-BASE     PIC X(9).
           03  FILLER           PIC X     VALUE "/".
           03  OBY-ALL-MACHINE  PIC XX.
           03  FILLER           PIC X(10) VALUE
               "/LP/BYFILE".

      *********************************************************
      *        SQL DECLARE SECTION - WORKERS
      *********************************************************

       EXEC SQL BEGIN DECLARE SECTION END-EXEC.
       01  PASS-SQL                    PIC X(200).
       01  RET-DB-NAME                 PIC X(50).
       01  RET-SERVER-NAME             PIC X(50).
       01  RET-VERSION                 PIC X(100).
       01  MISC-RETURN-CODE            PIC S9(4)   COMP-5.
       EXEC SQL END DECLARE SECTION END-EXEC.

      ******************************************************************
      *
      *    M I S C E L L A N E O U S - W O R K E R S
      *
      ******************************************************************
       01  HOLD-BYTE            PIC X.
           88  VALID-SPECIAL-CHARS  VALUE "(" ")"
                              "/" "\" "-" "?" "+" "%" "#" "[" "]"
                              "!" "<" ">" "$" "*" "&" "." """"  "="
                              "'" "_" ":" "@" "," ";" "~" "|" "{" "}".

       01  SETBY-DATE-WORKERS.
           03  SETBY-DATE          PIC 9(5)    VALUE 0.
           03  FILLER              REDEFINES SETBY-DATE.
               05  SETBY-YYY       PIC 999.
               05  SETBY-MM        PIC 99.

       01  MACHINE-R1.
           03  FILLER                  PIC X VALUE X"72".
           03  FILLER                  PIC 9 VALUE 1.
       01  MACHINE-R2.
           03  FILLER                  PIC X VALUE X"72".
           03  FILLER                  PIC 9 VALUE 2.
       01  OLD-ACCTNO                  PIC 9(8).
       01  FILLER REDEFINES OLD-ACCTNO.
           03  NEW-ACCTNO              PIC 9(6).
           03  FILLER                  PIC 99.

       01  MISC-CURSOR-STAT            PIC X(2) VALUE SPACES.
           88  MISC-CURSOR-STAT-GOOD            VALUE "00".
           88  MISC-CURSOR-STAT-BAD             VALUE "  " THRU "//"
                                                      "01" THRU "~~".

       01  PROCESS-STAT                PIC X(08)    VALUE SPACES.
           88  PROCESS-STAT-GOOD                    VALUE "00".
           88  PROCESS-STAT-BAD                     VALUE "  " THRU "//"
                                                         "01" THRU "~~".

       01  USE-BY-KEY.
           05  USE-BY-KEY-BRNO         PIC 9(4).
           05  USE-BY-KEY-CLASS        PIC 9(3).
           05  USE-BY-KEY-DATE         PIC 9(6).

       01  BEG-BRANCH                  PIC 9(4) VALUE 0.
       01  END-BRANCH                  PIC 9(4) VALUE 9999.
       01  WK-EOF-SW                   PIC X    VALUE "N". 
       01  BY-EOF-SW                   PIC X    VALUE "N".
       01  BY1-CONN-OPEN-SW            PIC X    VALUE "N".
       01  LOADING-WORK-FILE-SW        PIC X    VALUE "Y".
       01  TOTAL-ERRORS-CTR            PIC 9(9) VALUE 0.
       01  SQL-RECORDS-PROCESSED       PIC 9(9) VALUE 0.
       01  A15-RECORDS-PROCESSED       PIC 9(9) VALUE 0.
           88  NO-RECORDS-FOUND                 VALUE ZEROES.

       01  STARTING-TIME               PIC X(08)     VALUE SPACES.
       01  SUB                         PIC 9(04)     VALUE ZEROES.
       01  S1                          PIC 9(04)     VALUE ZEROES.
       01  S2                          PIC 9(04)     VALUE ZEROES.
       01  S3                          PIC 9(04)     VALUE ZEROES.

       01  SYSDATE-YYYYMMDD            PIC 9(8)     VALUE ZEROES.

       01  LEGEND                      PIC X(79)     VALUE SPACES.
       01  LEGEND-LIST                 PIC X(07)     VALUE "LEGEND.".

      *-----------------------------------------------------------------
       01  LEGEND-ACCEPT-YN.
           03  FILLER PIC X(30) VALUE "F1-RESET, F7-EXIT             ".
           03  FILLER PIC X(30) VALUE "                              ".
           03  FILLER PIC X(19) VALUE "     ACCEPT (Y/N): ".

       01  SOURCE-PATH-LIST            PIC X(07)     VALUE "S-PATH.".

       COPY "LIBGB/EOBUF_EXT.CPY".
           03  SOURCE-PATH             PIC X(9).
           03  BEG-DATE                PIC 9(06).
           03  END-DATE                PIC 9(06).

       01  VERSION-CONTROL             PIC X(01)     VALUE "A".

      *-----------------------------------------------------------------
       01  LN-COUNT            PIC 9(03)     VALUE 99.
       01  LN-FEED             PIC 9(02).
       01  PAGE-NUMBER         PIC 9(04)     VALUE ZEROES.

      ******************************************************************
      *
      *    H E A D E R - L I N E - W O R K E R S
      *
      ******************************************************************
       01  HEADER-LINE-01.
           03  H01-DATE                PIC X(08) VALUE SPACES.
           03  FILLER                  PIC X(02) VALUE SPACES.
           03  H01-TIME                PIC X(08) VALUE SPACES.
           03  FILLER                  PIC X(6) VALUE SPACES.
           03  H01-NAME                PIC X(40) VALUE SPACES.
           03  FILLER                  PIC X(6) VALUE SPACES.
           03  FILLER                  PIC X(06) VALUE "PAGE: ".
           03  H01-PAGE                PIC Z(04).

      *-----------------------------------------------------------------
       01  HEADER-LINE-02.
           03  FILLER                  PIC X(10) VALUE "USER ID:".
           03  H02-USERID              PIC X(10) VALUE SPACES.
           03  FILLER                  PIC X(10) VALUE SPACES.
           03  H02-TITLE               PIC X(40) VALUE 
           "BRANCH STAT (BYFILE) COMPARE A15 TO S35".

       01  HEADER-LINE-03.
           03  FILLER                PIC X(4)  VALUE "BRNO".
           03  FILLER                PIC X(2)  VALUE SPACES.
           03  FILLER                PIC X(6)  VALUE " DATE ".
           03  FILLER                PIC X(2)  VALUE SPACES.
           03  FILLER                PIC X(3)  VALUE "CLS".
           03  FILLER                PIC X(2)  VALUE SPACES.
           03  FILLER                PIC X(28) VALUE "DESCRIPTION".
           03  FILLER                PIC X(3)  VALUE "A15".
           03  FILLER                PIC X(19) VALUE SPACES.
           03  FILLER                PIC X(3)  VALUE "S35".

       01  DETAIL-LINE                        PIC X(100)   VALUE SPACES.

       01  DETAIL-LINE-01                     REDEFINES DETAIL-LINE.
           03  D01-BRNO                       PIC ZZZZ.
           03  FILLER                         PIC XX.
           03  D01-DATE                       PIC 9(6).
           03  FILLER                         PIC X(2).
           03  D01-CLASS                      PIC 999.
           03  FILLER                         PIC XX.
           03  D01-TEXT                       PIC X(25).
           03  FILLER                         PIC X(3).
           03  D01-A15                        PIC X(20).
           03  FILLER REDEFINES D01-A15.
               05  D01-A15-NUM                PIC Z(7)9.9(3).
               05  FILLER                     PIC X(8).
           03  FILLER                         PIC X(2).
           03  D01-S35                        PIC X(20).
           03  FILLER REDEFINES D01-S35.
               05  D01-S35-NUM                PIC Z(7)9.9(3).
               05  FILLER                     PIC X(8).

       01  RANGE-LINE-01                      REDEFINES DETAIL-LINE.
           03  R01-PROMPT                     PIC X(32).
           03  R01-FIELD                      PIC X(48).
           03  R01-AMT                        REDEFINES R01-FIELD
                                              PIC ZZZ,ZZZ,ZZ9.99-.
           03  R01-NUMERIC                    REDEFINES R01-FIELD
                                              PIC Z(10)9-.
           03  R01-TEXT                       REDEFINES R01-FIELD
                                              PIC X(48).

      ******************************************************************
      *
      *    C O P Y - L I B R A R Y - W O R K E R S
      *
      ******************************************************************
       COPY "LIBCL/BTRACKW.CPY".
       COPY "LIBGB/ACCESSW.CPY".
       COPY "LIBGB/DACCESSW.CPY".
       COPY "LIBGB/DATERW.CPY".
       COPY "LIBGB/GETPRW.CPY".
       COPY "LIBGB/GPENVW.CPY".
       COPY "LIBGB/MKTEMPW_CMD.CPY".
       COPY "LIBGB/PASSWDW.CPY".
       COPY "LIBGB/PROGIDW.CPY".
       COPY "LIBGB/SYSTEMW.CPY".
       COPY "LIBGB/TIMEWK.CPY".
       COPY "LIBGB/CONNECTW_SQL.CPY".
       COPY "LIBGB/FILEWK.CPY".
       COPY "LIBGB/MESSWK.CPY".
       COPY "LIBGB/GETENVW.CPY".
       COPY "LIBGB/CONAME_EXT.CPY".
       COPY "LIBGB/SCREENW.CPY".
       COPY "LIBUT/BYFILE_DEF.CPY".
       COPY "LIBUT/BYFILE_WKS.CPY".
       COPY "LIBGB/HELPLINK.CPY".
       COPY "LIBGB/PRU_LNK.CPY".

      ******************************************************************
      *
      *     P R O G R A M   C O N T R O L
      *
      ******************************************************************
       COPY "LIBGB/GETFMW.CPY".
       SCREEN SECTION.
       COPY "LIBUT/BYFILE_SCN.CPY".

      *-----------------------------------------------------------------
       PROCEDURE DIVISION
            USING FORM-PATHNAME EXIT-PATHNAME.

       DECLARATIVES.
       DECLARE-ERROR SECTION.
           USE AFTER ERROR PROCEDURE ON
                 PR-FILE OBY-FILE WK-FILE.
       COPY "LIBGB/DECLRP.CPY".
           PERFORM CLOSE-BYA1-FILE.
           PERFORM CLOSE-BR-FILE.
           PERFORM CLOSE-PR-FILE.
           CLOSE OBY-FILE WK-FILE.
           PERFORM CLOSE-BY1-CONNECTION.
       COPY "LIBGB/DECLRP2.CPY".

      ******************************************************************
      *
      *    M A I N - P R O G R A M
      *
      ******************************************************************
       MAIN-PROGRAM SECTION.

           PERFORM SQL-CONNECT.

      D    STOP MESS.
           PERFORM INITIALIZATION.

           IF ( PROCESS-STAT-BAD )
              GO TO MAIN-PROGRAM-EXIT.

           PERFORM BTRACK-CREATE.

      *- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
           MOVE 400 TO BEG-BRANCH 
           MOVE 401 TO END-BRANCH.

           MOVE BEG-BRANCH TO BR-NO.
           PERFORM OPEN-BR-FILE.
           PERFORM START-BR-FILE.

      *=================================================================
       MAIN-PROGRAM-NEXT.

           PERFORM READ-BR-FILE-NEXT.

           IF ( IO-BAD ) OR BR-NO > END-BRANCH
              GO TO MAIN-PROGRAM-END.

           PERFORM EXECUTION-MODULE.

           GO TO MAIN-PROGRAM-NEXT.

      *=================================================================
       MAIN-PROGRAM-END.
           PERFORM RANGE-LINES.

       MAIN-PROGRAM-EXIT.
           GO TO END-PROGRAM.

      ******************************************************************
       INITIALIZATION SECTION.
      ******************************************************************

           MOVE STAT---GOOD                TO PROCESS-STAT.

           MOVE FORM-PATHNAME              TO FORM-PATH.
           MOVE "BYFILE" TO VDU-FORM-NAME.

           PERFORM GET-GPENV.

           MOVE BYFILE-QUEUE-POS TO Q-POS.
           MOVE BYFILE-COPIES-POS TO C-POS.
           MOVE BYFILE-PRU-POS   TO P-POS.
           MOVE SPACES TO Q-BUF C-BUF P-BUF.
       COPY "LIBGB/EOINIT.CPY".

           PERFORM GET-TIME.
           MOVE TIME-EDIT                  TO STARTING-TIME.

           IF EXT-ROUTE-BUF = "00"
              MOVE "REPORT IN PROGRESS......" TO LEGEND
              PERFORM SEND-LEGEND.

           MOVE EXT-CONAME-SYSDATE TO ALP-DATE.
           PERFORM CONVERT-ALPDATE-TO-YYYYMMDD.
           MOVE DATE-YYYYMMDD TO SYSDATE-YYYYMMDD.

           PERFORM START-MISC-CSR.
           PERFORM READ-MISC-CSR-NEXT.
           PERFORM CLOSE-MISC-CSR.

           PERFORM OPEN-PR-FILE.

           MOVE MKTEMP-DEFAULT TO MKTEMP-BUF.
           PERFORM MKTEMP-CALL.
           MOVE MKTEMP-BUF TO WK-PATH.

           GO TO INITIALIZATION-EXIT.

       INITIALIZATION-END.

           MOVE "X"                        TO EXT-EOBUF-ERRCD.
           MOVE STAT---BAD                 TO PROCESS-STAT.

       INITIALIZATION-EXIT.
           EXIT.

      ***************************************************
       ENTER-PARAMETERS SECTION.
      ***************************************************

           MOVE STAT---GOOD                TO PROCESS-STAT.

           IF ( UP-KEY )
              GO TO ENTER-END-DATE.

       ENTER-SOURCE-PATH.

           IF SOURCE-PATH = SPACES
              MOVE "A15_PATH"       TO GETENV-BUF
              PERFORM GETENV-CALL
              IF ( STAT-GOOD )
                 MOVE GETENV-BUF    TO SOURCE-PATH
              ELSE
              MOVE "/US2/DA15"      TO SOURCE-PATH
              END-IF
              CALL "C$TOLOWER" USING SOURCE-PATH, VALUE 9
              MOVE SOURCE-PATH-LIST TO WR-LIST
              MOVE SOURCE-PATH      TO WR-BUF
              PERFORM CALL-WRFORM.

           MOVE "E  A090S-PATH." TO VDU.
           PERFORM SCREENIO.

           IF (        F1-KEY ) GO TO ENTER-PARAMETERS-END.
           IF (        F7-KEY ) GO TO ENTER-PARAMETERS-END.
           IF NOT ( ENTER-KEY ) GO TO ENTER-SOURCE-PATH.

           IF ( VDUBUF = SPACES )
              GO TO ENTER-SOURCE-PATH.

           MOVE VDUBUF TO DIR-ACCESS-BUF SOURCE-PATH.
           PERFORM DIR-ACCESS-CALL.
           IF ( STAT-BAD )
              MOVE "INVALID SOURCE DATA PATH" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-SOURCE-PATH.

           MOVE SPACES                     TO DIR-ACCESS-BUF.
           STRING VDUBUF, "/", EXT-FILPATH-MACHINE
                  DELIMITED BY " "       INTO DIR-ACCESS-BUF.
           PERFORM DIR-ACCESS-CALL.
           IF ( STAT-BAD )
              MOVE "INVALID SOURCE DATA PATH" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-SOURCE-PATH.

           MOVE VDUBUF                TO SOURCE-PATH.

      *-----------------------------------------------------------------        
       ENTER-BEG-DATE.                                                          
                                                                          
           IF (        UP-KEY ) GO TO ENTER-SOURCE-PATH.                        
           IF (        F1-KEY ) GO TO ENTER-PARAMETERS-END.                     

           IF EXT-ROUTE-BUF = "40" OR "50"
              GO TO ENTER-PARAMETERS-END.

           MOVE "ENNN060BEG-DATE." TO VDU.
           PERFORM SCREENIO.

           IF (        UP-KEY ) GO TO ENTER-SOURCE-PATH.
           IF (        F1-KEY ) GO TO ENTER-PARAMETERS-END.
           IF (        F3-KEY ) GO TO ENTER-ALL-DATE.
           IF (        F7-KEY ) GO TO ENTER-PARAMETERS-END.
           IF ( NOT ENTER-KEY ) GO TO ENTER-BEG-DATE.

           IF ( VDUNUM0 = ZEROES )
              GO TO ENTER-BEG-DATE.

           MOVE VDUNUM0 TO DATE-YYYYMM.

           IF ( DATE-YYYYMM-CC NOT = 19 ) AND
              ( DATE-YYYYMM-CC NOT = 20 )
              MOVE "ERROR: INVALID DATE - CC" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-BEG-DATE.

           IF ( DATE-YYYYMM-MM < 01 ) OR
              ( DATE-YYYYMM-MM > 12 )
              MOVE "ERROR: INVALID DATE - MM 01 THRU 12 " TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-BEG-DATE.

              IF DATE-YYYYMM < 201401
              MOVE "ERROR: BEGIN DATE < 201401 - INVALID" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-BEG-DATE.

           MOVE VDUNUM0 TO BEG-DATE.

      *-----------------------------------------------------------------
       ENTER-END-DATE.

           MOVE "ENNN060END-DATE." TO VDU.
           PERFORM SCREENIO.

           IF (        UP-KEY ) GO TO ENTER-BEG-DATE.
           IF (        F1-KEY ) GO TO ENTER-PARAMETERS-END.
           IF (        F7-KEY ) GO TO ENTER-PARAMETERS-END.
           IF ( NOT ENTER-KEY ) GO TO ENTER-END-DATE.

           MOVE VDUNUM0 TO DATE-YYYYMM.

           IF ( DATE-YYYYMM-CC NOT = 19 ) AND
              ( DATE-YYYYMM-CC NOT = 20 )
              MOVE "ERROR: INVALID DATE - CC" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-END-DATE.

           IF ( DATE-YYYYMM-MM < 01 ) OR
              ( DATE-YYYYMM-MM > 12 )
              MOVE "ERROR: INVALID DATE - MM 01 THRU 12 " TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-END-DATE.

              IF DATE-YYYYMM < 201401
              MOVE "ERROR: END DATE < 201401 - INVALID " TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-END-DATE.

           MOVE VDUNUM0 TO END-DATE.

           IF ( BEG-DATE > END-DATE )
              MOVE "INVALID DATE RANGE" TO MESS
              PERFORM SEND-MESS
              GO TO ENTER-BEG-DATE.

           GO TO ENTER-PARAMETERS-END.

      *-----------------------------------------------------------------
       ENTER-ALL-DATE.

           MOVE "SNNN060BEG-DATE."  TO VDU.
           MOVE 201401              TO BEG-DATE VDUNUM0.
           PERFORM SCREENIO.

           MOVE "SNNN020END-DATE."  TO VDU.
           MOVE 209912              TO END-DATE VDUNUM0.
           PERFORM SCREENIO.

       ENTER-PARAMETERS-END.

           MOVE LEGEND-ACCEPT-YN TO LEGEND.
           PERFORM SEND-LEGEND.

           IF ( F1-KEY ) MOVE STAT---BAD   TO PROCESS-STAT.
           IF ( F7-KEY ) MOVE STAT---BAD   TO PROCESS-STAT.

       ENTER-PARAMETERS-EXIT.
           EXIT.

      ****************************************
       EO-EXEC-AUDIT SECTION.
      ****************************************

           MOVE EXT-EOBUF-DATE1 TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.

           IF DATE-YYYYMM < 201401
              MOVE 201401 TO DATE-YYYYMM.

           MOVE DATE-YYYYMM TO BEG-DATE.

           MOVE EXT-EOBUF-DATE2 TO DATE-YYYYMMDD.
           PERFORM CONVERT-YYYYMMDD-TO-YYYYMM.
           MOVE DATE-YYYYMM TO END-DATE.

      ****************************************
       DISPLAY-PARAMETERS SECTION.
      ****************************************

           MOVE "S  A090S-PATH."        TO VDU.     
           MOVE SOURCE-PATH             TO VDUBUF.
           PERFORM SCREENIO.

       DISPLAY-PARAMETERS-EXIT.
           EXIT.

      *******************************************
       EXECUTION-MODULE SECTION.
      *******************************************
 
           MOVE 9999       TO PROGID-SLEEP-COUNTER.
           PERFORM SEND-PROGRESS-INDICATOR.

      D    STOP MESS.

           MOVE "N" TO WK-EOF-SW BY-EOF-SW.
           MOVE "Y" TO LOADING-WORK-FILE-SW.

           MOVE EXT-FILPATH-BASE      TO FILPATH-BASE.
           MOVE MACHINE-R1            TO FILPATH-MACHINE.
           MOVE BR-DATA-PATH          TO FILPATH-DATA.

      *** MUST LOAD R1 AND R2 BYFILE INTO WKFILE ***
      *** DO NOT REWRITE ***
      * FIRST DELETE/EMPTY TEMP FILE IF EXIST
           PERFORM OPEN-WK1-FILE-OUTPUT.
           PERFORM CLOSE-WK1-FILE.
           PERFORM OPEN-WK1-FILE.
           MOVE SOURCE-PATH  TO OBY-ALL-BASE.
           MOVE MACHINE-R1   TO OBY-ALL-MACHINE.
           MOVE OBY-ALL-PATH TO OBY-PATH ACCESS-BUF.
           PERFORM ACCESS-CALL.
           IF ( STAT-BAD )
              PERFORM CLOSE-WK1-FILE
              MOVE BR-NO                   TO OBY-BRNO
              MOVE "MISSING R1 A15 BYFILE" TO D01-TEXT
              MOVE OBY-ALL-PATH            TO D01-A15
              PERFORM WRITE-DETAIL-LINE-ERROR
              GO TO EXECUTION-MODULE-END.

           MOVE "PROCESSING A15 DATA" TO BTRACK-MESS.  
           PERFORM BTRACK-GLOBAL.

           PERFORM OPEN-OBY1-FILE.
           PERFORM LOAD-WORK-FILE.
           PERFORM CLOSE-OBY1-FILE. 

      *** LOAD R2 DO NOT UPDATE IF KEY ALREADY IN WKFILE ***
           MOVE SOURCE-PATH  TO OBY-ALL-BASE.
           MOVE MACHINE-R2   TO OBY-ALL-MACHINE.
           MOVE OBY-ALL-PATH TO OBY-PATH ACCESS-BUF.
           PERFORM ACCESS-CALL.
           IF ( STAT-BAD )
              PERFORM CLOSE-WK1-FILE
              MOVE BR-NO                   TO OBY-BRNO
              MOVE "MISSING R2 A15 BYFILE" TO D01-TEXT
              MOVE OBY-ALL-PATH            TO D01-A15
              PERFORM WRITE-DETAIL-LINE-ERROR
              GO TO EXECUTION-MODULE-END.

           PERFORM OPEN-OBY1-FILE.
           PERFORM LOAD-WORK-FILE.
           PERFORM CLOSE-OBY1-FILE.

           MOVE "N" TO LOADING-WORK-FILE-SW.
           MOVE SPACES TO PROGID-TEXT.

           PERFORM CLOSE-WK1-FILE.
           PERFORM OPEN-WK1-FILE.
           PERFORM M-READ-WK1.

           MOVE BEG-DATE TO QBY1-WBEG-DATE-CCYYMM.
           MOVE END-DATE TO QBY1-WEND-DATE-CCYYMM.
           MOVE BR-NO    TO QBY1-WBEG-BRNO.
           MOVE ZEROES   TO QBY1-WBEG-CLASS.
           MOVE BR-NO    TO QBY1-WEND-BRNO.
           MOVE ALL '9'  TO QBY1-WEND-CLASS.

           PERFORM OPEN-BYA1-FILE.

           MOVE "PROCESSING S35 DATA" TO BTRACK-MESS.
           PERFORM BTRACK-GLOBAL.

           PERFORM START-BYB1-FILE.  *> SSP  BYBFILE
           PERFORM START-BYA1-FILE.  *> SSP  BYAFILE
           PERFORM M-READ-BYAB.

           PERFORM PROCESS-BRANCH-NEXT-BY
               UNTIL WK-EOF-SW = "Y" AND BY-EOF-SW = "Y".

            GO TO EXECUTION-MODULE-END.

       PROCESS-BRANCH-NEXT-BY.
           PERFORM SEND-PROGRESS-INDICATOR.

           PERFORM COMPARE-FIELDS.

           IF WK-KEY < USE-BY-KEY
              PERFORM M-READ-WK1
           ELSE
              IF WK-KEY > USE-BY-KEY
                 PERFORM M-READ-BYAB
              ELSE
                 PERFORM M-READ-WK1
                 PERFORM M-READ-BYAB.

           IF BYA1-KEY NOT = BYB1-KEY
              MOVE BR-NO                       TO OBY-BRNO
              MOVE "SQL BYA KEY NOT = BYB KEY" TO D01-TEXT
              MOVE BYA1-KEY                    TO D01-A15
              MOVE BYB1-KEY                    TO D01-S35
              PERFORM WRITE-DETAIL-LINE-ERROR
              MOVE "Y" TO WK-EOF-SW BY-EOF-SW.

       EXECUTION-MODULE-END.

           PERFORM CLOSE-BYA1-FILE.
           PERFORM CLOSE-BYB1-FILE.
           PERFORM CLOSE-WK1-FILE.

       EXECUTION-MODULE-EXIT.
           EXIT.

       M-READ-BYAB SECTION.
           PERFORM READ-BYA1-FILE-NEXT.   *> SSP  BYAFILE
           IF IO-BAD
              MOVE ALL '9'  TO USE-BY-KEY
              MOVE "Y"      TO BY-EOF-SW
           ELSE
              ADD 1 TO SQL-RECORDS-PROCESSED
              MOVE BYA-BRNO        TO USE-BY-KEY-BRNO
              MOVE BYA-DATE-CCYYMM TO USE-BY-KEY-DATE
              MOVE BYA-CLASS       TO USE-BY-KEY-CLASS
              PERFORM READ-BYB1-FILE-NEXT    *> SSP  BYBFILE
              MOVE BYA1-KEY   TO BY1-KEY
              MOVE BYA-AREA-A TO BY-AREA-A
              MOVE BYB-AREA-B TO BY-AREA-B.


       EXIT-M-READ-BY.
           EXIT.

       M-READ-WK1 SECTION.
           PERFORM READ-WK1-FILE-NEXT.
           IF IO-BAD 
              MOVE ALL '9' TO WK-KEY
              MOVE "Y"     TO WK-EOF-SW
           ELSE
              MOVE WK-DATA TO OBY-REC.

       EXIT-M-READ-WK1.
           EXIT.

       LOAD-WORK-FILE SECTION.

      * BEG-DATE IS YYYYMM

           PERFORM SEND-PROGRESS-INDICATOR.

           MOVE BEG-DATE TO DATE-YYYYMM.
           PERFORM CONVERT-YYYYMM-TO-MMDDYY.
      
           MOVE DATE-MMDDYY-MM TO SETBY-MM.
           MOVE DATE-MMDDYY-YY TO SETBY-YYY.
      * JULIAN-CC = 50
           IF SETBY-YYY < EXT-JULIAN-CC
              ADD 100 TO SETBY-YYY.

           MOVE SETBY-DATE  TO OBY-DATE.
           MOVE BR-NO       TO OBY-BRNO.
           MOVE ZEROES      TO OBY-CLASS.

           PERFORM START-OBY1-FILE.

       LOAD-WORK-FILE-CONT.
           PERFORM READ-OBY1-FILE-NEXT.
           IF ( IO-BAD )
              GO TO LOAD-WORK-FILE-END.

           IF ( OBY-BRNO NOT = BR-NO )
              GO TO LOAD-WORK-FILE-CONT.

           MOVE OBY-DATE       TO DATE-YYYMM.
           MOVE DATE-YYYMM-MM  TO DATE-MMDDYY-MM.
           MOVE 01             TO DATE-MMDDYY-DD.
           MOVE DATE-YYYMM-YYY TO DATE-MMDDYY-YY.
           PERFORM CONVERT-MMDDYY-TO-YYYYMM.

      * DIDNT CONVERT ANY PRIOR TO 2012
           IF DATE-YYYYMM-YYYY < 2012
              GO TO LOAD-WORK-FILE-CONT.

           IF DATE-YYYYMM < BEG-DATE OR
               DATE-YYYYMM > END-DATE
              GO TO LOAD-WORK-FILE-CONT.

           INITIALIZE WK-REC.

           MOVE DATE-YYYYMM  TO WK-KEY-DATE.
           MOVE OBY-BRNO     TO WK-KEY-BRNO.
           MOVE OBY-CLASS    TO WK-KEY-CLASS
           MOVE OBY-REC      TO WK-DATA.

           PERFORM WRITE-WK1-FILE.

           IF IO-GOOD 
              ADD 1 TO A15-RECORDS-PROCESSED.

           GO TO LOAD-WORK-FILE-CONT.

       LOAD-WORK-FILE-END.
           EXIT. 

      ******************************************************************
       COMPARE-FIELDS SECTION.
      ******************************************************************

            IF WK-KEY < USE-BY-KEY
              MOVE "MISSING S35 RECORD" TO D01-TEXT
              MOVE WK-KEY-BRNO          TO D01-BRNO
              MOVE WK-KEY-DATE          TO D01-DATE
              MOVE WK-KEY-CLASS         TO D01-CLASS
              PERFORM WRITE-DETAIL-LINE-ERROR
              GO TO EXIT-COMPARE-FIELDS.

            IF WK-KEY > USE-BY-KEY
              MOVE "MISSING A15 RECORD" TO D01-TEXT
              PERFORM WRITE-DETAIL-LINE-ERROR-KEY
              PERFORM WRITE-DETAIL-LINE-ERROR
              GO TO EXIT-COMPARE-FIELDS.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 3
                   AFTER   S2 FROM 1 BY 1 UNTIL S2 > 2
                   AFTER   S3 FROM 1 BY 1 UNTIL S3 > 11
                IF OBY-NO (S1 S2 S3) NOT = BY-NO (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-NO",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-NO(S1 S2 S3)  TO D01-A15-NUM
                   MOVE BY-NO(S1 S2 S3)   TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-AMT (S1 S2 S3) NOT = BY-AMT (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-AMT",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-AMT(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-AMT(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-O2 (S1 S2 S3) NOT = BY-O2 (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-O2",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-O2(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-O2(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INT (S1 S2 S3) NOT = BY-INT (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-INT",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-INT(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-INT(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
           END-PERFORM.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 3
                   AFTER   S2 FROM 1 BY 1 UNTIL S2 > 2
                   AFTER   S3 FROM 1 BY 1 UNTIL S3 > 5
                IF OBY-NO-REPO (S1 S2 S3) NOT = BY-NO-REPO (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-NO-REPO",S1,S2,S3 INTO D01-TEXT
                    MOVE OBY-NO-REPO(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-NO-REPO(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-AMT-REPO (S1 S2 S3) NOT = BY-AMT-REPO (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-AMT-REPO",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-AMT-REPO(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-AMT-REPO(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-O2-REPO (S1 S2 S3) NOT = BY-O2-REPO (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-O2-REPO",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-O2-REPO(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-O2-REPO(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INT-REPO (S1 S2 S3) NOT = BY-INT-REPO (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-INT-REPO",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-INT-REPO(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-INT-REPO(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
           END-PERFORM.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 3
                   AFTER   S2 FROM 1 BY 1 UNTIL S2 > 2
                   AFTER   S3 FROM 1 BY 1 UNTIL S3 > 10
                IF OBY-NO-PL (S1 S2 S3) NOT = BY-NO-PL (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-NO-PL",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-NO-PL(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-NO-PL(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-AMT-PL (S1 S2 S3) NOT = BY-AMT-PL (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-AMT-PL",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-AMT-PL(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-AMT-PL(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-O2-PL (S1 S2 S3) NOT = BY-O2-PL (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-O2-PL",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-O2-PL(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-O2-PL(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INT-PL (S1 S2 S3) NOT = BY-INT-PL (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-INT-PL",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-INT-PL(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-INT-PL(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
           END-PERFORM.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 3
                   AFTER   S2 FROM 1 BY 1 UNTIL S2 > 2
                   AFTER   S3 FROM 1 BY 1 UNTIL S3 > 3
                IF OBY-DLRVPRIN (S1 S2 S3) NOT = BY-DLRVPRIN (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-DLRVPRIN",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-DLRVPRIN(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-DLRVPRIN(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                  PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-DLRVCHGS (S1 S2 S3) NOT = BY-DLRVCHGS (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-DLRVCHGS",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-DLRVCHGS(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-DLRVCHGS(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
           END-PERFORM.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 3
                   AFTER   S2 FROM 1 BY 1 UNTIL S2 > 2
             IF OBY-DLPARVHELD (S1 S2) NOT = BY-DLPARVHELD (S1 S2)
                MOVE SPACES TO D01-TEXT
                STRING "BY-DLPARVHELD",S1,S2 INTO D01-TEXT
                MOVE OBY-DLPARVHELD(S1 S2) TO D01-A15-NUM
                MOVE BY-DLPARVHELD(S1 S2)  TO D01-S35-NUM
               PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                PERFORM WRITE-DETAIL-LINE-ERROR
             END-IF
           END-PERFORM.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 02
              PERFORM VARYING S2 FROM 1 BY 1 UNTIL S2 > 05
                IF OBY-PL-PRINCOL (S1 S2) NOT =
                     BY-PL-PRINCOL (S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-PL-PRINCOL",S1,S2 INTO D01-TEXT
                   MOVE OBY-PL-PRINCOL(S1 S2) TO D01-A15-NUM
                   MOVE BY-PL-PRINCOL(S1 S2)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-PL-INTCOL (S1 S2) NOT =
                     BY-PL-INTCOL (S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-PL-INTCOL",S1,S2 INTO D01-TEXT
                   MOVE OBY-PL-INTCOL(S1 S2) TO D01-A15-NUM
                   MOVE BY-PL-INTCOL(S1 S2)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-PL-LATECOL (S1 S2) NOT =
                     BY-PL-LATECOL (S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-PL-LATECOL",S1,S2 INTO D01-TEXT
                   MOVE OBY-PL-LATECOL(S1 S2) TO D01-A15-NUM
                   MOVE BY-PL-LATECOL(S1 S2)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-PL-O2COL(S1 S2) NOT = BY-PL-O2COL(S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-PL-O2COL",S1,S2 INTO D01-TEXT
                   MOVE OBY-PL-O2COL(S1 S2) TO D01-A15-NUM
                   MOVE BY-PL-O2COL(S1 S2)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
              END-PERFORM
              IF OBY-AMT-SOLD(S1) NOT = BY-AMT-SOLD(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-AMT-SOLD",S1 INTO D01-TEXT
                 MOVE OBY-AMT-SOLD(S1) TO D01-A15-NUM
                 MOVE BY-AMT-SOLD(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-AMT-TRANS(S1) NOT = BY-AMT-TRANS(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-AMT-TRANS",S1 INTO D01-TEXT
                 MOVE OBY-AMT-TRANS(S1) TO D01-A15-NUM
                 MOVE BY-AMT-TRANS(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-AMT-PURCH(S1) NOT = BY-AMT-PURCH(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-AMT-PURCH",S1 INTO D01-TEXT
                 MOVE OBY-AMT-PURCH(S1) TO D01-A15-NUM
                 MOVE BY-AMT-PURCH(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-NO-SOLD(S1) NOT = BY-NO-SOLD(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-NO-SOLD",S1 INTO D01-TEXT
                 MOVE OBY-NO-SOLD(S1) TO D01-A15-NUM
                 MOVE BY-NO-SOLD(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-NO-TRANS(S1) NOT = BY-NO-TRANS(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-NO-TRANS",S1 INTO D01-TEXT
                 MOVE OBY-NO-TRANS(S1) TO D01-A15-NUM
                 MOVE BY-NO-TRANS(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-NO-PURCH(S1) NOT = BY-NO-PURCH(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-NO-PURCH",S1 INTO D01-TEXT
                 MOVE OBY-NO-PURCH(S1) TO D01-A15-NUM
                 MOVE BY-NO-PURCH(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-OTHCOL(S1) NOT = BY-OTHCOL(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-OTHCOL",S1 INTO D01-TEXT
                 MOVE OBY-OTHCOL(S1)  TO D01-A15-NUM
                 MOVE BY-OTHCOL(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-OT2COL(S1) NOT = BY-OT2COL(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-OT2COL",S1 INTO D01-TEXT
                 MOVE OBY-OT2COL(S1)  TO D01-A15-NUM
                 MOVE BY-OT2COL(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-INTCOL(S1) NOT = BY-INTCOL(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-INTCOL",S1 INTO D01-TEXT
                 MOVE OBY-INTCOL(S1) TO D01-A15-NUM
                 MOVE BY-INTCOL(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-LATECOL(S1) NOT = BY-LATECOL(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-LATECOL",S1 INTO D01-TEXT
                 MOVE OBY-LATECOL(S1) TO D01-A15-NUM
                 MOVE BY-LATECOL(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-PRINCOL(S1) NOT = BY-PRINCOL(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-PRINCOL",S1 INTO D01-TEXT
                 MOVE OBY-PRINCOL(S1) TO D01-A15-NUM
                 MOVE BY-PRINCOL(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-DEFCOL(S1) NOT = BY-DEFCOL(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-DEFCOL",S1 INTO D01-TEXT
                 MOVE OBY-DEFCOL(S1) TO D01-A15-NUM
                 MOVE BY-DEFCOL(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-RNPRIN(S1) NOT = BY-RNPRIN(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-RNPRIN",S1 INTO D01-TEXT
                 MOVE OBY-RNPRIN(S1) TO D01-A15-NUM
                 MOVE BY-RNPRIN(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-INTREB(S1) NOT = BY-INTREB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-INTREB",S1 INTO D01-TEXT
                 MOVE OBY-INTREB(S1)  TO D01-A15-NUM
                 MOVE BY-INTREB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-CLREB1(S1) NOT = BY-CLREB1(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-CLREB1",S1 INTO D01-TEXT
                 MOVE OBY-CLREB1(S1) TO D01-A15-NUM
                 MOVE BY-CLREB1(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-CLREB2(S1) NOT = BY-CLREB2(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-CLREB2",S1 INTO D01-TEXT
                 MOVE OBY-CLREB2(S1) TO D01-A15-NUM
                 MOVE BY-CLREB2(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-CLREB3(S1) NOT = BY-CLREB3(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-CLREB3",S1 INTO D01-TEXT
                 MOVE OBY-CLREB3(S1) TO D01-A15-NUM
                 MOVE BY-CLREB3(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-CLREB4(S1) NOT = BY-CLREB4(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-CLREB4",S1 INTO D01-TEXT
                 MOVE OBY-CLREB4(S1) TO D01-A15-NUM
                 MOVE BY-CLREB4(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-AHREB(S1) NOT = BY-AHREB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-AHREB",S1 INTO D01-TEXT
                 MOVE OBY-AHREB(S1)  TO D01-A15-NUM
                 MOVE BY-AHREB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-PPREB(S1) NOT = BY-PPREB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-PPREB",S1 INTO D01-TEXT
                 MOVE OBY-PPREB(S1)  TO D01-A15-NUM
                 MOVE BY-PPREB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-O1REB(S1) NOT = BY-O1REB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-O1REB",S1 INTO D01-TEXT
                 MOVE OBY-O1REB(S1)  TO D01-A15-NUM
                 MOVE BY-O1REB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-O2REB(S1) NOT = BY-O2REB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-O2REB",S1 INTO D01-TEXT
                 MOVE OBY-O2REB(S1)  TO D01-A15-NUM
                 MOVE BY-O2REB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-O3REB(S1) NOT = BY-O3REB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-O3REB",S1 INTO D01-TEXT
                 MOVE OBY-O3REB(S1)  TO D01-A15-NUM
                 MOVE BY-O3REB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-O4REB(S1) NOT = BY-O4REB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-O4REB",S1 INTO D01-TEXT
                 MOVE OBY-O4REB(S1)  TO D01-A15-NUM
                 MOVE BY-O4REB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-O5REB(S1) NOT = BY-O5REB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-O5REB",S1 INTO D01-TEXT
                 MOVE OBY-O5REB(S1)  TO D01-A15-NUM
                 MOVE BY-O5REB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-O6REB(S1) NOT = BY-O6REB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-O6REB",S1 INTO D01-TEXT
                 MOVE OBY-O6REB(S1)  TO D01-A15-NUM
                 MOVE BY-O6REB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-O7REB(S1) NOT = BY-O7REB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-O7REB",S1 INTO D01-TEXT
                 MOVE OBY-O7REB(S1)  TO D01-A15-NUM
                 MOVE BY-O7REB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-SCREB(S1) NOT = BY-SCREB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-SCREB",S1 INTO D01-TEXT
                 MOVE OBY-SCREB(S1)  TO D01-A15-NUM
                 MOVE BY-SCREB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-MFREB(S1) NOT = BY-MFREB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-MFREB",S1 INTO D01-TEXT
                 MOVE OBY-MFREB(S1)  TO D01-A15-NUM
                 MOVE BY-MFREB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-DFREB(S1) NOT = BY-DFREB(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-DFREB",S1 INTO D01-TEXT
                 MOVE OBY-DFREB(S1)  TO D01-A15-NUM
                 MOVE BY-DFREB(S1)   TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-PART-CHGOFF(S1) NOT = BY-PART-CHGOFF(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-PART-CHGOFF",S1 INTO D01-TEXT
                 MOVE OBY-PART-CHGOFF(S1) TO D01-A15-NUM
                 MOVE BY-PART-CHGOFF(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-ALLOTMENTS(S1) NOT = BY-ALLOTMENTS(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-ALLOTMENTS",S1 INTO D01-TEXT
                 MOVE OBY-ALLOTMENTS(S1) TO D01-A15-NUM
                 MOVE BY-ALLOTMENTS(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              PERFORM VARYING S2 FROM 1 BY 1 UNTIL S2 > 7
                IF OBY-INS-NO-ELIG(S1 S2) NOT = BY-INS-NO-ELIG(S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-INS-NO-ELIG",S1,S2 INTO D01-TEXT
                   MOVE OBY-INS-NO-ELIG(S1 S2) TO D01-A15-NUM
                   MOVE BY-INS-NO-ELIG(S1 S2)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INS-NO-WROTE(S1 S2) NOT = BY-INS-NO-WROTE(S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-INS-NO-WROTE",S1,S2 INTO D01-TEXT
                   MOVE OBY-INS-NO-WROTE(S1 S2) TO D01-A15-NUM
                   MOVE BY-INS-NO-WROTE(S1 S2)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INS-NO-NOTWROTE(S1 S2) NOT =
                     BY-INS-NO-NOTWROTE(S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-INS-NO-NOTWROTE",S1,S2 INTO D01-TEXT
                   MOVE OBY-INS-NO-NOTWROTE(S1 S2) TO D01-A15-NUM
                   MOVE BY-INS-NO-NOTWROTE(S1 S2)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INS-AMT-WROTE(S1 S2) NOT =
                     BY-INS-AMT-WROTE(S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-INS-AMT-WROTE",S1,S2 INTO D01-TEXT
                   MOVE OBY-INS-AMT-WROTE(S1 S2) TO D01-A15-NUM
                   MOVE BY-INS-AMT-WROTE(S1 S2)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
               END-PERFORM
      * NONFILE, AD&D, ROADGARD WERE 8,9,10 IN INS TABLE, NOW THEY
      * ARE 1, 2, 3 IN FEE INS TABLE:
               PERFORM VARYING S2 FROM 1 BY 1 UNTIL S2 > 3
                IF OBY-INS-NO-ELIG(S1, S2 + 7) NOT =
                         BY-FEE-NO-ELIG(S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-FEE-NO-ELIG",S1,S2 INTO D01-TEXT
                   MOVE OBY-INS-NO-ELIG(S1, S2 + 7) TO D01-A15-NUM
                   MOVE BY-FEE-NO-ELIG(S1 S2)       TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INS-NO-WROTE(S1, S2 + 7) NOT =
                         BY-FEE-NO-WROTE(S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-FEE-NO-WROTE",S1,S2 INTO D01-TEXT
                   MOVE OBY-INS-NO-WROTE(S1, S2 + 7) TO D01-A15-NUM
                   MOVE BY-FEE-NO-WROTE(S1 S2)       TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INS-NO-NOTWROTE(S1, S2 + 7) NOT =
                         BY-FEE-NO-NOTWROTE(S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-FEE-NO-NOTWROTE",S1,S2 INTO D01-TEXT
                   MOVE OBY-INS-NO-NOTWROTE(S1, S2 + 7) TO D01-A15-NUM
                   MOVE BY-FEE-NO-NOTWROTE(S1 S2)       TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INS-AMT-WROTE(S1, S2 + 7) NOT =
                         BY-FEE-AMT-WROTE(S1 S2)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-FEE-AMT-WROTE",S1,S2 INTO D01-TEXT
                   MOVE OBY-INS-AMT-WROTE(S1, S2 + 7) TO D01-A15-NUM
                   MOVE BY-FEE-AMT-WROTE(S1 S2)       TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                END-PERFORM
                IF OBY-OTH-NO-COL(S1) NOT = BY-OTH-NO-COL(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-OTH-NO-COL",S1 INTO D01-TEXT
                   MOVE OBY-OTH-NO-COL(S1)      TO D01-A15-NUM
                   MOVE BY-OTH-NO-COL(S1)       TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-OT2-NO-COL(S1) NOT = BY-OT2-NO-COL(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-OT2-NO-COL",S1 INTO D01-TEXT
                   MOVE OBY-OT2-NO-COL(S1) TO D01-A15-NUM
                   MOVE BY-OT2-NO-COL(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INT-NO-COL(S1) NOT = BY-INT-NO-COL(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-INT-NO-COL",S1 INTO D01-TEXT
                   MOVE OBY-INT-NO-COL(S1) TO D01-A15-NUM
                   MOVE BY-INT-NO-COL(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-LATE-NO-COL(S1) NOT = BY-LATE-NO-COL(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-LATE-NO-COL",S1 INTO D01-TEXT
                   MOVE OBY-LATE-NO-COL(S1) TO D01-A15-NUM
                   MOVE BY-LATE-NO-COL(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-OTH-NO-WAIVED(S1) NOT = BY-OTH-NO-WAIVED(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-OTH-NO-WAIVED",S1 INTO D01-TEXT
                   MOVE OBY-OTH-NO-WAIVED(S1) TO D01-A15-NUM
                   MOVE BY-OTH-NO-WAIVED(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-OT2-NO-WAIVED(S1) NOT = BY-OT2-NO-WAIVED(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-OT2-NO-WAIVED",S1 INTO D01-TEXT
                   MOVE OBY-OT2-NO-WAIVED(S1) TO D01-A15-NUM
                   MOVE BY-OT2-NO-WAIVED(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INT-NO-WAIVED(S1) NOT = BY-INT-NO-WAIVED(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-INT-NO-WAIVED",S1 INTO D01-TEXT
                   MOVE OBY-INT-NO-WAIVED(S1) TO D01-A15-NUM
                   MOVE BY-INT-NO-WAIVED(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-LATE-NO-WAIVED(S1) NOT = BY-LATE-NO-WAIVED(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-LATE-NO-WAIVED",S1 INTO D01-TEXT
                   MOVE OBY-LATE-NO-WAIVED(S1) TO D01-A15-NUM
                   MOVE BY-LATE-NO-WAIVED(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-OTH-AMT-WAIVED(S1) NOT = BY-OTH-AMT-WAIVED(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-OTH-AMT-WAIVED",S1 INTO D01-TEXT
                   MOVE OBY-OTH-AMT-WAIVED(S1) TO D01-A15-NUM
                   MOVE BY-OTH-AMT-WAIVED(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-OT2-AMT-WAIVED(S1) NOT = BY-OT2-AMT-WAIVED(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-OT2-AMT-WAIVED",S1 INTO D01-TEXT
                   MOVE OBY-OT2-AMT-WAIVED(S1) TO D01-A15-NUM
                   MOVE BY-OT2-AMT-WAIVED(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-INT-AMT-WAIVED(S1) NOT = BY-INT-AMT-WAIVED(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-INT-AMT-WAIVED",S1 INTO D01-TEXT
                   MOVE OBY-INT-AMT-WAIVED(S1) TO D01-A15-NUM
                   MOVE BY-INT-AMT-WAIVED(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-LATE-AMT-WAIVED(S1) NOT = BY-LATE-AMT-WAIVED(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-LATE-AMT-WAIVED",S1 INTO D01-TEXT
                   MOVE OBY-LATE-AMT-WAIVED(S1) TO D01-A15-NUM
                   MOVE BY-LATE-AMT-WAIVED(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
           END-PERFORM.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 3
                     AFTER S2 FROM 1 BY 1 UNTIL S2 > 2
                     AFTER S3 FROM 1 BY 1 UNTIL S3 > 10
                IF OBY-UNITS(S1 S2 S3) NOT = BY-UNITS(S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-UNITS",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-UNITS(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-UNITS(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-OUTBAL(S1 S2 S3) NOT = BY-OUTBAL(S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-OUTBAL",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-OUTBAL(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-OUTBAL(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
           END-PERFORM.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 3
                     AFTER S2 FROM 1 BY 1 UNTIL S2 > 2
                     AFTER S3 FROM 1 BY 1 UNTIL S3 > 10
                IF OBY-UNITS-BNKRPT(S1 S2 S3) NOT =
                       BY-UNITS-BNKRPT(S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-UNITS-BNKRPT",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-UNITS-BNKRPT(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-UNITS-BNKRPT(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
                IF OBY-OUTBAL-BNKRPT(S1 S2 S3) NOT =
                       BY-OUTBAL-BNKRPT(S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-OUTBAL-BNKRPT",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-OUTBAL-BNKRPT(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-OUTBAL-BNKRPT(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
           END-PERFORM.

           IF BY-SUMWGTTM NOT = OBY-SUMWGTTM
              MOVE "BY-SUMWGTTM" TO D01-TEXT
              MOVE OBY-SUMWGTTM     TO D01-A15-NUM
              MOVE BY-SUMWGTTM      TO D01-S35-NUM
              PERFORM WRITE-DETAIL-LINE-ERROR-KEY
              PERFORM WRITE-DETAIL-LINE-ERROR.

           IF BY-SUMWGTAV NOT = OBY-SUMWGTAV
              MOVE "BY-SUMWGTAV" TO D01-TEXT
              MOVE OBY-SUMWGTAV     TO D01-A15-NUM
              MOVE BY-SUMWGTAV      TO D01-S35-NUM
              PERFORM WRITE-DETAIL-LINE-ERROR-KEY
              PERFORM WRITE-DETAIL-LINE-ERROR.

           IF BY-SUMWGTTA NOT = OBY-SUMWGTTA
              MOVE "BY-SUMWGTTA" TO D01-TEXT
              MOVE OBY-SUMWGTTA     TO D01-A15-NUM
              MOVE BY-SUMWGTTA      TO D01-S35-NUM
              PERFORM WRITE-DETAIL-LINE-ERROR-KEY
              PERFORM WRITE-DETAIL-LINE-ERROR.

           IF BY-IB-ACCRUED NOT = OBY-IB-ACCRUED
              MOVE "BY-IB-ACCRUED" TO D01-TEXT
              MOVE OBY-IB-ACCRUED  TO D01-A15-NUM
              MOVE BY-IB-ACCRUED   TO D01-S35-NUM
              PERFORM WRITE-DETAIL-LINE-ERROR-KEY
              PERFORM WRITE-DETAIL-LINE-ERROR.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 03
                IF OBY-DLDISC(S1) NOT = BY-DLDISC(S1)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-DLDISC",S1 INTO D01-TEXT
                   MOVE OBY-DLDISC(S1) TO D01-A15-NUM
                   MOVE BY-DLDISC(S1)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
           END-PERFORM.

           IF BY-STD-POS NOT = OBY-STD-POS
              MOVE "BY-STD-POS" TO D01-TEXT
              MOVE OBY-STD-POS     TO D01-A15-NUM
              MOVE BY-STD-POS      TO D01-S35-NUM
              PERFORM WRITE-DETAIL-LINE-ERROR-KEY
              PERFORM WRITE-DETAIL-LINE-ERROR.

           IF BY-30-DAY-MOVED NOT = OBY-30-DAY-MOVED
              MOVE "BY-30-DAY-MOVED" TO D01-TEXT
              MOVE OBY-30-DAY-MOVED  TO D01-A15-NUM
              MOVE BY-30-DAY-MOVED   TO D01-S35-NUM
              PERFORM WRITE-DETAIL-LINE-ERROR-KEY
              PERFORM WRITE-DETAIL-LINE-ERROR.

           IF BY-PROJ-INCREASE NOT = OBY-PROJ-INCREASE
              MOVE "BY-PROJ-INCREASE" TO D01-TEXT
              MOVE OBY-PROJ-INCREASE   TO D01-A15-NUM
              MOVE BY-PROJ-INCREASE    TO D01-S35-NUM
              PERFORM WRITE-DETAIL-LINE-ERROR-KEY
              PERFORM WRITE-DETAIL-LINE-ERROR.

           IF BY-PROJ-PROFIT NOT = OBY-PROJ-PROFIT
              MOVE "BY-PROJ-PROFIT" TO D01-TEXT
              MOVE OBY-PROJ-PROFIT  TO D01-A15-NUM
              MOVE BY-PROJ-PROFIT   TO D01-S35-NUM
              PERFORM WRITE-DETAIL-LINE-ERROR-KEY
              PERFORM WRITE-DETAIL-LINE-ERROR.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 3
                     AFTER S2 FROM 1 BY 1 UNTIL S2 > 2
                     AFTER S3 FROM 1 BY 1 UNTIL S3 > 6
                IF OBY-UNEARNED-AMT (S1 S2 S3) NOT = 
                      BY-UNEARNED-AMT (S1 S2 S3)
                   MOVE SPACES TO D01-TEXT
                   STRING "BY-UNEARNED-AMT",S1,S2,S3 INTO D01-TEXT
                   MOVE OBY-UNEARNED-AMT(S1 S2 S3) TO D01-A15-NUM
                   MOVE BY-UNEARNED-AMT(S1 S2 S3)  TO D01-S35-NUM
                   PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                   PERFORM WRITE-DETAIL-LINE-ERROR
                END-IF
           END-PERFORM.

           PERFORM VARYING S1 FROM 1 BY 1 UNTIL S1 > 2
              IF OBY-PROCEEDS(S1) NOT = BY-PROCEEDS(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-PROCEEDS",S1 INTO D01-TEXT
                 MOVE OBY-PROCEEDS(S1) TO D01-A15-NUM
                 MOVE BY-PROCEEDS(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
              IF OBY-LOCKBOX(S1) NOT = BY-LOCKBOX(S1)
                 MOVE SPACES TO D01-TEXT
                 STRING "BY-LOCKBOX",S1 INTO D01-TEXT
                 MOVE OBY-LOCKBOX(S1) TO D01-A15-NUM
                 MOVE BY-LOCKBOX(S1)  TO D01-S35-NUM
                 PERFORM WRITE-DETAIL-LINE-ERROR-KEY
                 PERFORM WRITE-DETAIL-LINE-ERROR
              END-IF
           END-PERFORM.

       EXIT-COMPARE-FIELDS.
           EXIT.

      ******************************************************************
       WRITE-DETAIL-LINE-ERROR-KEY SECTION.
      ******************************************************************

           MOVE BY-BRNO         TO D01-BRNO.
           MOVE BY-DATE-CCYYMM  TO D01-DATE.
           MOVE BY-CLASS        TO D01-CLASS.

      ******************************************************************
       WRITE-DETAIL-LINE-ERROR SECTION.
      ******************************************************************
 
           ADD 1 TO TOTAL-ERRORS-CTR.
           PERFORM WRITE-DETAIL-LINE.

      ******************************************************************
       WRITE-DETAIL-LINE SECTION.
      ******************************************************************

           ADD  LN-FEED                   TO LN-COUNT.

           IF ( LN-COUNT > EXT-CONAME-RPT-LINES )
              PERFORM WRITE-HEADER-LINES.

           MOVE DETAIL-LINE                TO PR-REC.
           PERFORM WRITE-PR-REC.
           MOVE 01                         TO LN-FEED.
           MOVE SPACES                     TO DETAIL-LINE.

       WRITE-DETAIL-LINE-EXIT.
           EXIT.

      ******************************************************************
       WRITE-HEADER-LINES SECTION.
      ******************************************************************

           MOVE 01                         TO LN-COUNT.
           ADD  01                         TO PAGE-NUMBER.
           PERFORM GET-TIME.

           MOVE EXT-CONAME-SYSDATE         TO H01-DATE.
           MOVE TIME-EDIT                  TO H01-TIME.
           MOVE EXT-CONAME-CONAME          TO H01-NAME.
           CALL "C$JUSTIFY"             USING H01-NAME "C".
           MOVE PAGE-NUMBER            TO H01-PAGE.

           MOVE HEADER-LINE-01             TO PR-REC.
           MOVE 99                         TO LN-FEED.
           PERFORM WRITE-PR-REC.

           MOVE EXT-CONAME-USER-ID         TO H02-USERID.

           MOVE HEADER-LINE-02             TO PR-REC.
           ADD  01                         TO LN-COUNT.
           MOVE 01                         TO LN-FEED.
           PERFORM WRITE-PR-REC.

           MOVE HEADER-LINE-03             TO PR-REC.
           ADD  02                         TO LN-COUNT.
           MOVE 02                         TO LN-FEED.
           PERFORM WRITE-PR-REC.

           MOVE 2                         TO LN-FEED.

       WRITE-HEADER-LINES-EXIT.
           EXIT.

      ******************************************************************
       RANGE-LINES SECTION.
      ******************************************************************

           MOVE 88                                    TO LN-COUNT.

           MOVE "BEGINNING DATE               : "    TO R01-PROMPT.
           MOVE BEG-DATE                            TO R01-NUMERIC.
           MOVE 02                                    TO LN-FEED.
           PERFORM WRITE-DETAIL-LINE.

           MOVE "ENDING    DATE               : "    TO R01-PROMPT.
           MOVE END-DATE                            TO R01-NUMERIC.
           MOVE 01                                    TO LN-FEED.
           PERFORM WRITE-DETAIL-LINE.

           MOVE "A15 RECORDS PROCESSED         :"     TO R01-PROMPT.
           MOVE A15-RECORDS-PROCESSED                 TO R01-NUMERIC.
           MOVE 02                                    TO LN-FEED.
           PERFORM WRITE-DETAIL-LINE.

           MOVE "S35 RECORDS PROCESSED         :"     TO R01-PROMPT.
           MOVE SQL-RECORDS-PROCESSED                 TO R01-NUMERIC.
           MOVE 01                                    TO LN-FEED.
           PERFORM WRITE-DETAIL-LINE.

           MOVE "TOTAL ERRORS REPORTED         :"     TO R01-PROMPT.
           MOVE TOTAL-ERRORS-CTR                      TO R01-NUMERIC.
           MOVE 02                                    TO LN-FEED.
           PERFORM WRITE-DETAIL-LINE.

           MOVE "STARTING TIME                 : "    TO R01-PROMPT.
           MOVE STARTING-TIME                         TO R01-TEXT.
           MOVE 02                                    TO LN-FEED.
           PERFORM WRITE-DETAIL-LINE.

           MOVE "ENDING   TIME                 : "    TO R01-PROMPT.
           PERFORM GET-TIME.
           MOVE TIME-EDIT                             TO R01-TEXT.
           MOVE 01                                    TO LN-FEED.
           PERFORM WRITE-DETAIL-LINE.

           MOVE "DATABASE NAME : "                    TO R01-PROMPT.
           MOVE RET-DB-NAME                           TO R01-TEXT.
           MOVE 02                                    TO LN-FEED.
           PERFORM WRITE-DETAIL-LINE.

       RANGE-LINES-EXIT.
           EXIT.

      ******************************************************************
      *
      *    C O P Y - L I B R A R Y - S E C T I O N S
      *
      ******************************************************************
       COPY "LIBCL/BTRACK.CPY".
       COPY "LIBGB/DATER.CPY".
       COPY "LIBGB/GPENV.CPY".
       COPY "LIBGB/PROGID.CPY".
       COPY "LIBGB/SCREEN.CPY".
       COPY "LIBGB/TIMEIO.CPY".

      ************************************************
       FORM-RESET SECTION.
      ************************************************
           MOVE EXT-CONAME-CONAME TO BYFILE-CONAME.
           MOVE EXT-CONAME-SYSDATE TO BYFILE-SYSDATE.
           DISPLAY BYFILE-SCREEN UPON EXT-EOBUF-WINDOW-HANDLE.
           MOVE BYFILE-FORM-FIELDS TO WR-BUF.
           MOVE BYFILE-FORM-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.

       FORM-RESET-EXIT.
           EXIT.

      ************************************************
       SETUP-LINK-INFO SECTION.
      ************************************************
           MOVE BYFILE-HELP--FILE TO HELP-LINK-FILE.
           MOVE BYFILE-HELP--DIR TO HELP-LINK-DIR.

      ************************************************
       VDU-CONVERT-FIELD SECTION.
      ************************************************
           MOVE "00" TO STAT.
           MOVE VDU-FIELD-TO-CONVERT TO VDU-ALP-FIELD.
           EVALUATE TRUE
              COPY "LIBUT/BYFILE_EVA.CPY".
              WHEN OTHER       MOVE   "2A" TO STAT
           END-EVALUATE.

      ******************************************************************
       MISCELLANEOUS-PARAGRAPHS SECTION.
      ******************************************************************
       COPY "LIBGB/ACCESS.CPY".
       COPY "LIBGB/DACCESS.CPY".
       COPY "LIBGB/GETPR.CPY".
       COPY "LIBGB/MKTEMP.CPY".
       COPY "LIBGB/GETENV.CPY".
       COPY "LIBGB/RMFILE.CPY".
       COPY "LIBGB/SYSTEM.CPY".
       INITIAL-PROGRESS-INDICATOR.

           MOVE ZEROES                 TO PROGID-BRANCH.
           MOVE "LEGEND:B."            TO PROGID-LINE-LIST.
           MOVE PRU-LP                 TO PROGID-PRU-LP.
           MOVE EXT-ROUTE-BUF              TO PROGID-ROUTE-BUF.
           MOVE 9999                   TO PROGID-SLEEP-COUNTER.
           MOVE 250                    TO PROGID-SLEEP-COUNTER-MAX.

           PERFORM GET-TIME.
           MOVE TIME-EDIT              TO PROGID-TIME.

           MOVE "B"                    TO PROGID-TYPE.
           MOVE PROGID-TEXT-PROCESSING TO PROGID-TEXT.

      *-----------------------------------------------------------------
       SEND-PROGRESS-INDICATOR.

           MOVE BR-NO TO PROGID-BRANCH.

           IF LOADING-WORK-FILE-SW = "Y"
              STRING "LOADING WORK FILE: ", BR-NO
                     INTO PROGID-TEXT
           ELSE 
              STRING "PROCESSING BRANCH: ", BR-NO 
                     INTO PROGID-TEXT.

           PERFORM GET-TIME.
           MOVE TIME-EDIT                  TO PROGID-TIME.

           IF EXT-ROUTE-BUF = "00"
              PERFORM PROGID-DISPLAY.

       SEND-LEGEND.
           MOVE LEGEND TO WR-BUF.
           MOVE LEGEND-LIST TO WR-LIST.
           PERFORM CALL-WRFORM.

      ******************************************************************
       IO-ROUTINE SECTION.
      ******************************************************************
       COPY "LIBGB/CONNECT_SQL.CPY".
       COPY "LIBLP/LPBYGS_SQL.CPY".
       COPY "LIBGB/GBBRGS_SQL.CPY".
       COPY "LIBGB/GBPRINT.CPY".
       COPY "LIBGB/GBBRRN.CPY".

      * COPY "LIBLP/LPBY1RN.CPY".
      * COPYMEMBER: LIBLP/LPBY1RN
      ******************************************************************
      *
      * DESCRIPTION: BRANCH STATISTICS FILE - IO ROUTINES - A THRU B
      *
      * FILE KEY   : #1 = DATE-CCYYMM, BRNO, CLASS
      *
      * FILE PATH  : /USR/DATA/R#/LP/BYAFILE
      *              /USR/DATA/R#/LP/BYBFILE
      *
      * ATTENTION  : BY-PATH-OVERRIDE CONTROLS ALL FILES - A THRU B
      *              ^^^^^^^^^^^^^^^^
      *              THERE IS NO BYA-PATH-OVERRIDE OR BYB-PATH-OVERRIDE
      *
      *=================================================================
      * REV:
      * KEC 2019-0205 ***NEW*** TO A32; MODIFIED FROM A30
      * KEC 2021-0524 ADDED ACUSQL VERSION
      ******************************************************************
      *-----------------------------------------------------------------
             
      *-----------------------------------------------------------------
       LOAD-BYA1-FILE.
      *- - - -{ SET OVERRIDE TO A "Y" TO NOT TOUCH THE PATH AT ALL  }- -
           IF ( BY-PATH-OVERRIDE = "Y" )
              NEXT SENTENCE
           ELSE
      *- - - -{ SPACES IS THE DEFAULT, NO CROSSING BRANCHES }- - - - - -
           IF ( BY-PATH-OVERRIDE = SPACES ) 
              MOVE EXT-FILPATH-BASE        TO BYA-ALL-BASE
              MOVE EXT-FILPATH-MACHINE     TO BYA-ALL-MACHINE
              MOVE BYA-ALL-PATH            TO BYA-PATH
           ELSE
      *- - - -{ USE BRANCH VALUES }- - - - - - - - - - - - - - - - - - -
           IF ( BY-PATH-OVERRIDE = "B" ) 
              MOVE FILPATH-BASE            TO BYA-ALL-BASE
              MOVE FILPATH-MACHINE         TO BYA-ALL-MACHINE
              MOVE BYA-ALL-PATH            TO BYA-PATH.

      *-----------------------------------------------------------------
       OPEN-BYA1-FILE.
           PERFORM LOAD-BYA1-FILE.
           PERFORM OPEN-IT.
           MOVE BYA-PATH-SQL TO E-FILE.

           IF BY1-CONN-OPEN-SW = "N" 
               EXEC SQL CONNECT TO :SQL-CONNECT-SERVER AS BY1_CONNECT
                        USER :SQL-CONNECT-USERID USING :SQL-CONNECT-PSWD
               END-EXEC

               EXEC SQL SET CONNECTION C1 END-EXEC
               EXEC SQL CONNECT TO :SQL-CONNECT-SERVER AS BY2_CONNECT
                        USER :SQL-CONNECT-USERID USING :SQL-CONNECT-PSWD
               END-EXEC

               EXEC SQL SET CONNECTION C1 END-EXEC
               MOVE 'Y' TO BY1-CONN-OPEN-SW.

      *-----------------------------------------------------------------
       START-BYA1-FILE.   *> SSP  BYAFILE
           PERFORM START-IT.
           MOVE BYA-PATH-SQL TO E-FILE.
           MOVE BYA1-KEY TO E-KEYX.

           IF ( BYA1-CURSOR-STAT-GOOD )
              PERFORM CLOSE-BYA1-FILE.

      *      SELECT BYAFILE.*
      *      FROM DBO.BYAFILE
      *      WHERE BYAFILE.BYA_DATE_CCYYMM BETWEEN @QBY_WBEG_DATE AND @QBY_WEND_DATE
      *      ORDER BY BYAFILE.BYA_BRNO, BYAFILE.BYA_CLASS, BYAFILE.BYA_DATE_CCYYMM
 
           EXEC SQL SET CONNECTION BY1_CONNECT END-EXEC.

           EXEC SQL
            DECLARE BYA_CURSOR CURSOR FOR
                :BY1-RETURN-CODE =  
            EXEC SSP_BYFILE_BYAFILE_SELECT
              ( :QBY1-WBEG-DATE-CCYYMM, :QBY1-WEND-DATE-CCYYMM,
                :QBY1-WBEG-BRNO)
           END-EXEC.

           EXEC SQL
               OPEN BYA_CURSOR
           END-EXEC.

           PERFORM SQL-IO-VALIDATION.

           EXEC SQL SET CONNECTION C1 END-EXEC.

           MOVE STAT---GOOD TO BYA1-CURSOR-STAT.

      *-----------------------------------------------------------------
       START-BYB1-FILE.   *> SSP  BYBFILE
           PERFORM START-IT.
           MOVE BYB-PATH-SQL TO E-FILE.
           MOVE BYB1-KEY TO E-KEYX.

           IF ( BYB1-CURSOR-STAT-GOOD )
              PERFORM CLOSE-BYA1-FILE.

      *      SELECT BYBFILE.*
      *      FROM DBO.BYFILE
      *      WHERE BYBFILE.BYB_DATE_CCYYMM BETWEEN @QBY_WBEG_DATE AND @QBY_WEND_DATE
      *      ORDER BY BYBFILE.BYB_BRNO, BYBFILE.BYB_CLASS, BYBFILE.BYB_DATE_CCYYMM
 
           EXEC SQL SET CONNECTION BY2_CONNECT END-EXEC.

           EXEC SQL
            DECLARE BYB_CURSOR CURSOR FOR
                :BY1-RETURN-CODE =  
            EXEC SSP_BYFILE_BYBFILE_SELECT
              ( :QBY1-WBEG-DATE-CCYYMM, :QBY1-WEND-DATE-CCYYMM,
                :QBY1-WBEG-BRNO)
           END-EXEC.

           EXEC SQL
               OPEN BYB_CURSOR
           END-EXEC.

           PERFORM SQL-IO-VALIDATION.

           EXEC SQL SET CONNECTION C1 END-EXEC.

           MOVE STAT---GOOD TO BYB1-CURSOR-STAT.

      *-----------------------------------------------------------------
       READ-BYA1-FILE-NEXT.   *> SSP  BYAFILE
           PERFORM READ-IT.
           MOVE BYA-PATH-SQL TO E-FILE.
           MOVE BYA1-KEY TO E-KEYX.
           INITIALIZE QBYA-REC.

           EXEC SQL SET CONNECTION BY1_CONNECT END-EXEC.

           IF ( BYA1-CURSOR-STAT-GOOD )
              EXEC SQL
                   FETCH BYA_CURSOR INTO :QBYA-REC
               END-EXEC
           ELSE
              MOVE 9        TO SQLCODE
              MOVE "RDNXCR" TO SQLSTATE.

           PERFORM SQL-IO-VALIDATION.

           IF ( IO-FG = 8 )     *>LOCKED
              GO TO READ-BYA1-FILE-NEXT.

           EXEC SQL SET CONNECTION C1 END-EXEC.

           IF ( IO-FG = 0 )
              PERFORM GET-BYA-FIELDS.

      *-----------------------------------------------------------------
       READ-BYB1-FILE-NEXT.   *> SSP  BYBFILE
           PERFORM READ-IT.
           MOVE BYB-PATH-SQL TO E-FILE.
           INITIALIZE QBYB-REC.

           EXEC SQL SET CONNECTION BY2_CONNECT END-EXEC.

           IF ( BYB1-CURSOR-STAT-GOOD )
              EXEC SQL
                   FETCH BYB_CURSOR INTO :QBYB-REC
              END-EXEC
           ELSE
              MOVE 9        TO SQLCODE
              MOVE "RDNXCR" TO SQLSTATE.

           PERFORM SQL-IO-VALIDATION.

           IF ( IO-FG = 8 )     *>LOCKED
              GO TO READ-BYB1-FILE-NEXT.

           EXEC SQL SET CONNECTION C1 END-EXEC.

           IF ( IO-FG = 0 )
              PERFORM GET-BYB-FIELDS.

      *-----------------------------------------------------------------
       CLOSE-BYA1-FILE.
           PERFORM CLOSE-IT.

           IF ( BYA1-CURSOR-STAT-GOOD )
              EXEC SQL SET CONNECTION BY1_CONNECT END-EXEC
              EXEC SQL
                   CLOSE BYA_CURSOR
              END-EXEC
              EXEC SQL SET CONNECTION C1 END-EXEC
              MOVE STAT---BAD TO BYA1-CURSOR-STAT.

      *-----------------------------------------------------------------
       CLOSE-BYB1-FILE.
           PERFORM CLOSE-IT.

           IF ( BYB1-CURSOR-STAT-GOOD )
              EXEC SQL SET CONNECTION BY2_CONNECT END-EXEC
              EXEC SQL
                   CLOSE BYB_CURSOR
              END-EXEC
              EXEC SQL SET CONNECTION C1 END-EXEC
              MOVE STAT---BAD TO BYB1-CURSOR-STAT.

      *-----------------------------------------------------------------
       CLOSE-BY1-CONNECTION.

           IF BY1-CONN-OPEN-SW = "Y"
               EXEC SQL SET CONNECTION BY1_CONNECT END-EXEC
               EXEC SQL COMMIT END-EXEC
               EXEC SQL DISCONNECT BY1_CONNECT END-EXEC

               EXEC SQL SET CONNECTION BY2_CONNECT END-EXEC
               EXEC SQL COMMIT END-EXEC
               EXEC SQL DISCONNECT BY2_CONNECT END-EXEC

               EXEC SQL SET CONNECTION C1 END-EXEC
               MOVE "N" TO BY1-CONN-OPEN-SW.

      *-----------------------------------------------------------------
       OPEN-OBY1-FILE.
           PERFORM OPEN-IT.
           MOVE OBY-PATH TO E-FILE.
           OPEN INPUT OBY-FILE.
           IF IO-FG = 8
              GO TO OPEN-OBY1-FILE.
           IF IO-FG = 7
              CLOSE OBY-FILE
              GO TO OPEN-OBY1-FILE.
      *READ-OBY1-FILE.
      *    PERFORM READ-IT.
      *    MOVE OBY-PATH TO E-FILE.
      *    MOVE OBY1-KEY TO E-KEYX.
      *    READ OBY-FILE.
      *    IF IO-FG = 8
      *       GO TO READ-OBY1-FILE.
       START-OBY1-FILE.
           PERFORM START-IT.
           MOVE OBY-PATH TO E-FILE.
           MOVE OBY1-KEY TO E-KEYX.
           START OBY-FILE KEY NOT < OBY1-KEY.
       READ-OBY1-FILE-NEXT.
           PERFORM READ-IT.
           MOVE OBY-PATH TO E-FILE.
           MOVE OBY1-KEY TO E-KEYX.
           READ OBY-FILE NEXT.
           IF IO-FG = 8
              GO TO READ-OBY1-FILE-NEXT.
       CLOSE-OBY1-FILE.
           PERFORM CLOSE-IT.
           CLOSE OBY-FILE.

       OPEN-WK1-FILE.
           PERFORM OPEN-IT.
           MOVE 0 TO IO-FG IO-STATUS.
           MOVE WK-PATH TO E-FILE.
           OPEN I-O WK-FILE.
           IF IO-FG = 8
              GO TO OPEN-WK1-FILE.
           IF IO-FG = 7
              CLOSE WK-FILE
              GO TO OPEN-WK1-FILE.

       OPEN-WK1-FILE-OUTPUT.
           PERFORM OPEN-IT.
           MOVE 0 TO IO-FG IO-STATUS.
           MOVE WK-PATH TO E-FILE.
           OPEN OUTPUT WK-FILE.
           IF IO-FG = 8
              GO TO OPEN-WK1-FILE-OUTPUT.
           IF IO-FG = 7
              CLOSE WK-FILE
              GO TO OPEN-WK1-FILE-OUTPUT.

       READ-WK1-FILE-NEXT.
           PERFORM READ-IT.
           MOVE 0 TO IO-FG IO-STATUS.
           MOVE WK-PATH TO E-FILE.
           MOVE WK-KEY  TO E-KEYX.
           READ WK-FILE NEXT
              AT END  MOVE 9 TO IO-STATUS IO-FG
           END-READ.
           IF IO-FG = 8
              GO TO READ-WK1-FILE-NEXT.

       WRITE-WK1-FILE.
           PERFORM WRITE-IT.
           MOVE 0 TO IO-FG IO-STATUS.
           MOVE WK-PATH TO E-FILE.
           MOVE WK-KEY  TO E-KEYX.
           WRITE WK-REC 
             INVALID KEY 
                MOVE 2 TO IO-STATUS IO-FG
           END-WRITE.
           IF IO-FG = 8
             GO TO WRITE-WK1-FILE.
           UNLOCK WK-FILE.

       CLOSE-WK1-FILE.
           PERFORM CLOSE-IT.
           MOVE 0 TO IO-FG IO-STATUS.
           CLOSE WK-FILE.

      *=================================================================
       START-MISC-CSR.
           MOVE "SSP_TCLP_SELECT" TO E-FILE.
           MOVE SPACES            TO E-KEYX.
           MOVE "START ERROR"     TO E-MSG.
           MOVE "GB/SQLINF"       TO E-PROG.

           IF ( MISC-CURSOR-STAT-GOOD )
              PERFORM CLOSE-MISC-CSR.

           MOVE "SELECT DB_NAME(),@@SERVERNAME,@@VERSION" 
              TO PASS-SQL.

           EXEC SQL
            DECLARE MISC_CURSOR CURSOR FOR
                :MISC-RETURN-CODE = 
                 EXEC SSP_TCLP_SELECT
                  ( :PASS-SQL)
                END-EXEC.

           EXEC SQL
               OPEN MISC_CURSOR
           END-EXEC.

           IF SQLCODE NOT = 0
             PERFORM SQL-ERROR.

           MOVE STAT---GOOD TO MISC-CURSOR-STAT.

      *-----------------------------------------------------------------
       READ-MISC-CSR-NEXT.
           MOVE "SSP_TCLP_SELECT" TO E-FILE.
           MOVE SPACES            TO E-KEYX.
           MOVE "READ ERROR"      TO E-MSG.
           MOVE "GB/SQLINF"       TO E-PROG.

           IF ( MISC-CURSOR-STAT-GOOD )
              EXEC SQL
                 FETCH MISC_CURSOR INTO  
                   :RET-DB-NAME,
                   :RET-SERVER-NAME, 
                   :RET-VERSION
              END-EXEC
           ELSE
              MOVE 9        TO SQLCODE
              MOVE "RDNXCR" TO SQLSTATE.

           IF SQLCODE NOT = 0
             PERFORM SQL-ERROR.

      *-----------------------------------------------------------------
       CLOSE-MISC-CSR.
           MOVE "SSP_TCLP_SELECT" TO E-FILE.
           MOVE SPACES            TO E-KEYX.
           MOVE "CLOSE ERROR"     TO E-MSG.
           MOVE "GB/SQLINF"       TO E-PROG.

           IF ( MISC-CURSOR-STAT-GOOD )
              EXEC SQL
                   CLOSE MISC_CURSOR
              END-EXEC
              MOVE STAT---BAD TO MISC-CURSOR-STAT.

      *-----------------------------------------------------------------

       COPY "LIBGB/FERRORS.CPY".
           MOVE "E" TO EXT-EOBUF-ERRCD.

      ******************************************************************
       END-PROGRAM SECTION.
      ******************************************************************

           PERFORM CLOSE-FILES.

           IF ( EXT-ROUTE-BUF = "00" )
              PERFORM PRU-OUT.

      *     IF ( NO-RECORDS-FOUND )
      *        MOVE "NO RECORDS FOUND FOR SELECTED RANGE" TO MESS
      *        PERFORM SEND-MESS.

       EXIT-PROG.

           PERFORM BTRACK-DONE. 

           IF ( EXT-ROUTE-BUF = "00" )
              MOVE EXIT-PATH               TO FORM-NAM
              MOVE FORM-PATH               TO FORM-PATHNAME.

           MOVE WK-PATH TO ACCESS-BUF.
           PERFORM REMOVE-WORKFILE.

       STOP-RUN.
           IF EXT-ROUTE-BUF = "00" OR "40" OR "50"
              DISPLAY SPACES LINE 0 COL 0 ERASE SCREEN
              DESTROY BYFILE-SCREEN
              DESTROY EXT-EOBUF-WINDOW-HANDLE.
           EXIT PROGRAM.
