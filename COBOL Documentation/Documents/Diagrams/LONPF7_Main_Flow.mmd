graph TD
    A[Program Start] --> B[Parameter Setup]
    B --> C[SQL Connection]
    C --> D[Environment Setup]
    D --> E{Batch Payment?}
    E -->|Yes| F[Batch Payment Routine]
    E -->|No| G[Interactive Processing]
    
    F --> F1[Set Balance Records]
    F1 --> F2[Calculate Paid Through Date]
    F2 --> F3{Transaction Type?}
    F3 -->|OT| F4[Add Interest to Other Balance]
    F3 -->|RE| F5[Add Amount to Interest/Other]
    F3 -->|O2| F6[Add Amount to AP Interest/O2 Balance]
    F4 --> F7[End Routine]
    F5 --> F7
    F6 --> F7
    
    G --> G1[Initialize Routine]
    G1 --> G2[Validate Transaction Type]
    G2 --> G3[Password Verification]
    G3 --> G4[Amount Entry Processing]
    G4 --> G5[Entry Line Calculations]
    G5 --> G6[Display Entry Screen]
    G6 --> G7[Accept User Input]
    G7 --> G8[Update Balances]
    G8 --> G9[Save Screen State]
    G9 --> F7
    
    F7 --> H[Close Files]
    H --> I[Program Exit]
    
    style A fill:#e1f5fe
    style I fill:#c8e6c9
    style F fill:#fff3e0
    style G fill:#f3e5f5
