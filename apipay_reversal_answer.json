{
  "question": "How does APIPAY handle reversal payoff gating?",
  "program": "APIPAY",
  "facts_used": [
    {
      "fact_id": "edbb32d3b9576761c458",
      "score": 0.03812636165577342,
      "rank_sources": {
        "keyword": 1,
        "vector": 4
      },
      "program_id": "APIPAY",
      "fact_confidence": 0.7,
      "action_role": "REVERSAL",
      "posting_type": "INTEREST",
      "gating_cond": null,
      "fact_text": "Program APIPAY paragraph REVERSAL-LP1-FILE performs reversal interest",
      "paragraphs": [
        {
          "@search.score": 3.5447187,
          "para_id": "53558871c67ac53d22cf7eca5434fd5e1dd0e7f9",
          "name": "REVERSAL-LP1-FILE",
          "kind": "paragraph",
          "start_line": 2108,
          "end_line": 2230,
          "text": "       REVERSAL-LP1-FILE.\n           MOVE LP-TRCD  TO REV-TRCD.\n           MOVE LP-REFNO TO REV-REFNO.\n\n           ADD LN-INTBAL LP-APINT GIVING LP-INTBAL.\n           ADD LN-OTHBAL LP-APOTH GIVING LP-OTHBAL.\n           ADD LN-LCBAL LP-APLC GIVING LP-LCBAL.\n\n           MOVE LN-CURBAL TO LP-CURBAL.\n\n      * \"OTWOAPJDPLPIPWRPTSTPSPBKBD\" (NOT).\n      *  PA NOT IN LIST SO WILL BE CDV-NO-MATCH\n           MOVE CDV-17 TO CDV-BUF.\n           PERFORM CDV-VERIFY.\n\n      * THE \"DF\" HAS THE AMOUNT IN INTDUE SO INTBAL COMES OUT RIGHT:\n           IF (CDV-NO-MATCH OR (REV-TRCD = \"Z2\"))\n              IF ( REV-TRCD NOT = \"WL\" ) AND\n                 ( SP-CAL-RATETYPE(1) NOT = \"Z\" ) AND\n                 ( NOT (REV-TRCD = \"RE\" AND LN-LOANTYPE = \"I\") )\n                   SUBTRACT LP-INTDUE FROM LP-INTBAL.\n\n      * ADDON-POSTING, LP-APINTOWE HOLDS LN-INTPDTH BEFORE ADDON:\n           IF (CDV-NO-MATCH OR (REV-TRCD = \"Z2\"))\n              IF NOT ADDON-POSTING\n                 SUBTRACT LP-APINTOWE FROM LP-LCBAL.\n\n           MULTIPLY -1 BY\n              LP-TRAMT LP-APOTH LP-APINT LP-APLC LP-APCUR\n              LP-INTDUE LP-DLPROC LP-EARNED(1) LP-EARNED(2)\n              LP-EARNED(3) LXG-GLAMT(1) LXG-GLAMT(2) LXG-GLAMT(3)\n              LP-INTPAID LXE-EARN(1) LXE-EARN(2) LXE-EARN(3)\n              LXE-EARN(4) LXE-EARN(5) LXE-EARN(6) LXE-EARN(7)\n              LXE-WORKER LXE-WORKER2 LP-NOLCHG LP-PREPAY-PENALTY\n              LP-PRORATED-INS-REB LP-EXTRA-PRIN-LFP LP-APPLIED-TO-ESCROW.\n\n      * ADDON-POSTING, LP-APINTOWE HOLDS LN-INTPDTH BEFORE ADDON\n           IF REV-TRCD NOT = \"SP\" AND NOT = \"DC\" AND\n                        NOT ADDON-POSTING\n              MULTIPLY -1 BY LP-APINTOWE.\n\n           IF REB-AMOUNT(1) NOT = 0\n              IF LN-ADDON-FG = \"Y\"\n                 ADD LN-ANTICADJ(1) REB-AMOUNT(1)\n                                         GIVING ADDON-INT-REBATE.\n\n      * FOR PC ACCOUNTS, 'RI' MAY HAVE A VALUE:\n           MOVE SPACES TO HOLD-DL-RVCHGS-CODE(1)\n                          HOLD-DL-RVCHGS-CODE(2)\n                          HOLD-DL-RVCHGS-CODE(3)\n                          HOLD-DL-PARVHELD-CODE\n                          HOLD-DL-PARVPAID-CODE.\n\n           IF LN-SERVACCT NOT = \"Y\"\n              PERFORM CALC-HOLD-LN-ACCERN.\n\n           COMPUTE HOLD-LN-TOTERN =\n                LN-TOTERN\n                    + LP-EARNED(1) + LP-EARNED(2) + LP-EARNED(3)\n                     + LXE-EARN(1) + LXE-EARN(2)  + LXE-EARN(3)\n                     + LXE-EARN(4) + LXE-EARN(5)  + LXE-EARN(6)\n                     + LXE-EARN(7).\n\n           IF LN-SERVACCT NOT = \"Y\"\n              IF NOT ADDON-POSTING\n                  IF REV-TRCD NOT = \"WI\" AND NOT = \"WL\"\n                     IF REV-TRCD NOT = \"RD\"\n                        ADD LP-APINT LP-APLC TO HOLD-LN-TOTERN\n                     ELSE\n                        SUBTRACT LP-TRAMT FROM HOLD-LN-TOTERN.\n\n           MOVE LN-TOTDEF TO HOLD-LN-TOTDFMNTS.\n           IF DF-POSTING\n              IF SP-DEFFRMLA = 97 OR 96 OR 95\n                 COMPUTE HOLD-LN-TOTINT = LN-TOTINT + LP-APINT\n              ELSE\n                 COMPUTE HOLD-LN-TOTDFMNTS = LN-TOTDEF + LP-APINT\n              END-IF\n           ELSE\n              IF REV-TRCD = \"RD\"\n                 COMPUTE HOLD-LN-TOTDFMNTS = LN-TOTDEF - LP-TRAMT\n              ELSE\n                 IF REB-AMOUNT(7) NOT = 0\n                   COMPUTE HOLD-LN-TOTDFMNTS = LN-TOTDEF - REB-AMOUNT(7)\n                   SUBTRACT REB-AMOUNT(7) FROM HOLD-LN-TOTERN.\n\n           IF NOT (DF-POSTING AND (SP-DEFFRMLA = 97 OR 96 OR 95))\n              MOVE LN-TOTINT TO HOLD-LN-TOTINT.\n           MOVE LN-TOTLCHG TO HOLD-LN-TOTLCHG.\n           MOVE LN-TOTSERACCT TO HOLD-LN-TOTSERACCT.\n\n      * PACESETTER DEFFRMLA 8 CAN HAVE LATE CHARGES\n           IF REV-TRCD NOT = \"WL\"\n              IF REVERSE-AFTER-RESCHED-FG = \"N\"\n                 COMPUTE HOLD-LN-TOTLCHG = LN-TOTLCHG + LP-APLC.\n\n           IF REV-TRCD NOT = \"WI\" AND\n                        NOT DF-POSTING AND\n                         NOT ADDON-POSTING\n              COMPUTE HOLD-LN-TOTINT = LN-TOTINT + LP-APINT.\n\n      * UCCC LATE CHARGES\n      * CAN'T TAKE LATE CHARGE ON MONIES PAID WITHIN GRACE DAYS OF DUE DAY\n\n           IF ( SP-LCFRMLA = \"F\" OR \"H\" OR \"I\" OR \"J\" OR \"K\"\n                                 OR \"L\" OR \"M\" OR \"P\" OR \"S\" OR \"T\")\n              IF REV-TRCD = \"PY\" OR \"PA\" OR \"AL\" OR \"PE\" OR \"SS\"\n                         OR \"PO\" OR \"PB\" OR \"SC\" OR \"RN\" OR \"IN\"\n                                 OR \"RB\" OR \"RO\" OR \"PR\" OR \"PC\"\n                                 OR \"PP\" OR \"AH\" OR \"PN\" OR \"PZ\"\n                 MOVE LP-LCPARTIALS TO HOLD-PARTIALS\n                 MOVE LP-LCPAID TO HOLD-LCPAID.\n\n           IF LN-SERVACCT NOT = \"Y\"\n              GO TO BYPASS-SERVICE.\n\n           ADD LP-EARNED(1) TO HOLD-LN-TOTSERACCT.\n\n      * EARNED INTEREST\n           ADD LP-EARNED(2) TO HOLD-LN-TOTSERACCT.\n      * EARNED LCHG\n           ADD LP-EARNED(3) TO HOLD-LN-TOTSERACCT.\n\n"
        }
      ],
      "context_paragraphs": [
        {
          "@search.score": 1.0,
          "para_id": "d825b19e2ce0b550f63e8666bca90f0718ffdb45",
          "name": "BYPASS-SERVICE",
          "kind": "paragraph",
          "start_line": 2231,
          "end_line": 2272,
          "text": "       BYPASS-SERVICE.\n           MOVE \"RV\" TO LP-TRCD.\n\n      * LET REVERSAL 'RV' RECORD HAVE THE LP-PAYDATE OF THE\n      * RECORD BEING REVERSED:\n           MOVE TRANS-DATE TO LP-TRDATE LP-PAYDATE.\n\n      ***********************************************************\n      * LOGIC FROM BEGINNING OF DISPLAY-ENTRY-LINE IN LONPF8:\n      ***********************************************************\n           SUBTRACT LP-APCUR FROM LP-CURBAL.\n\n      * CANT CHANGE LN-REC IN HERE! LONPF2 WILL EXIT IF LN-REC DOESNT\n      * MATCH WK-SAVE-RECORD\n           MOVE LN-TOTPAYMNTD TO HOLD-LN-TOTPAYMNTD.\n\n      * UPDATE CONTRACTUAL PAYMENTS TO DATE:\n           ADD LP-APCUR TO LN-TOTPAYMNTD\n           IF SP-CAL-RATETYPE(1) = \"Z\"\n              SUBTRACT LP-EXTRA-PRIN-LFP FROM LN-TOTPAYMNTD\n              ADD LP-EXTRA-PRIN-LFP        TO LN-TOTEXCPAYMNTD.\n           IF SP-CONTRFRMLA = \"A\"\n              ADD LP-APLC TO LN-TOTPAYMNTD.\n           ADD LP-APINT TO LN-TOTPAYMNTD.\n\n      * COMPUTE PAID THRU DATE\n           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.\n           PERFORM PAID-THRU-CALCULATION.\n           MOVE PDTH-DATE-FULL TO LP-PDTH-DATE.\n\n      * CANT CHANGE LN-REC IN HERE! LONPF2 WILL EXIT IF LN-REC DOESNT\n      * MATCH WK-SAVE-RECORD\n           MOVE HOLD-LN-TOTPAYMNTD TO LN-TOTPAYMNTD.\n\n           MOVE BP-TRCD TO HOLD-BP-TRCD LP-TRCD.\n           MOVE BP-REFCD TO LP-REFNO HOLD-LP-REFNO.\n\n      * PAYMENT UPDATE\n\n           MOVE LN-ACCTNO TO LOAN-KEY.\n           MOVE LN-SSNO(1) TO BORROWER-KEY.\n\n"
        }
      ]
    },
    {
      "fact_id": "533df7529d1d673ad9d4",
      "score": 0.036725067385444746,
      "rank_sources": {
        "keyword": 3,
        "vector": 6
      },
      "program_id": "APIPAY",
      "fact_confidence": 0.6,
      "action_role": "REVERSAL",
      "posting_type": null,
      "gating_cond": null,
      "fact_text": "Program APIPAY paragraph CALL-LONPF2-FOR-REVERSAL performs reversal",
      "paragraphs": [
        {
          "@search.score": 10.219095,
          "para_id": "d742d6f998fa6824ae8ec5d174b63aec3a1d200d",
          "name": "CALL-LONPF2-FOR-REVERSAL",
          "kind": "paragraph",
          "start_line": 2291,
          "end_line": 2306,
          "text": "       CALL-LONPF2-FOR-REVERSAL.\n\n           MOVE \"LP/LONPF2\" TO FORM-NAM.\n           CALL FORM-PROGX USING FORM-PATH EXIT-PATHNAME\n                                 PROG-BUF  UPDATE-BUF.\n           CANCEL FORM-PROGX.\n\n      * TEST PROG-BUF (ERRCD) TO MAKE SURE LONPF2 DID NOT REJECT\n      * THE PROPOSED TRANSACTION\n      \n           IF ERRCD = \"E\" OR \"X\" OR \"M\"\n              MOVE \"LONPF2: PMT NOT APPLIED  \" TO LOG-MSG\n              MOVE 69                 TO RETURN-STATUS\n              PERFORM CREATE-LOG\n              MOVE \"E\" TO POSTING-ERRCD.\n\n"
        }
      ],
      "context_paragraphs": [
        {
          "@search.score": 1.0,
          "para_id": "9fa8e9d561d3f55eb7050deaa5eb1004f60d801e",
          "name": "REVERSAL-RTN-EXIT",
          "kind": "paragraph",
          "start_line": 2307,
          "end_line": 2311,
          "text": "       REVERSAL-RTN-EXIT.\n           EXIT.\n\n\n      **************************************************\n"
        }
      ]
    },
    {
      "fact_id": "781e6fa9e853c9b4d933",
      "score": 0.03641178417742469,
      "rank_sources": {
        "keyword": 7,
        "vector": 3
      },
      "program_id": "APIPAY",
      "fact_confidence": 0.6,
      "action_role": "REVERSAL",
      "posting_type": null,
      "gating_cond": null,
      "fact_text": "Program APIPAY paragraph EXIT-VALIDATE-REVERSAL performs reversal",
      "paragraphs": [
        {
          "@search.score": 7.940456,
          "para_id": "a8c27ecf37e658c16836d37ae5ef7fae305a5ecd",
          "name": "EXIT-VALIDATE-REVERSAL",
          "kind": "paragraph",
          "start_line": 1363,
          "end_line": 1366,
          "text": "       EXIT-VALIDATE-REVERSAL.\n           PERFORM CLOSE-LP1-FILE.\n\n      ******************************************\n"
        }
      ],
      "context_paragraphs": [
        {
          "@search.score": 1.0,
          "para_id": "0f544fbead64db4c483368300e3bf77528d8e439",
          "name": "CREATE-LOG",
          "kind": "paragraph",
          "start_line": 1367,
          "end_line": 1393,
          "text": "       CREATE-LOG SECTION.\n      ******************************************\n           MOVE LOG-PATH TO ACCESS-BUF.\n           PERFORM ACCESS-CALL.\n           IF STAT-GOOD\n              PERFORM OPEN-LOG-FILE-EXTEND\n           ELSE\n              PERFORM OPEN-LOG-FILE-OUTPUT.\n\n           IF RETURN-STATUS = 99\n              MOVE SPACES     TO LOG-STATUS\n           ELSE\n           IF RETURN-STATUS = 0\n              MOVE \"PASS\"     TO LOG-STATUS\n           ELSE\n              MOVE \"FAIL\"     TO LOG-STATUS.\n\n           MOVE RETURN-STATUS TO LOG-RETURN.\n           MOVE TRANS-DATE    TO LOG-DATE.\n           PERFORM GET-TIME.\n           MOVE TIME-EDIT     TO LOG-TIME.\n           MOVE BT-BRANCH     TO LOG-BRNO.\n           MOVE BP-LNNO       TO LOG-NUMBER.\n           PERFORM WRITE-LOG-FILE.\n           PERFORM CLOSE-LOG-FILE.\n\n      ******************************************************************\n"
        }
      ]
    },
    {
      "fact_id": "8a0034b5af2c2a5a3d10",
      "score": 0.036062378167641324,
      "rank_sources": {
        "keyword": 4,
        "vector": 7
      },
      "program_id": "APIPAY",
      "fact_confidence": 0.6,
      "action_role": "REVERSAL",
      "posting_type": null,
      "gating_cond": null,
      "fact_text": "Program APIPAY paragraph REVERSAL-RTN-EXIT performs reversal",
      "paragraphs": [
        {
          "@search.score": 7.7588663,
          "para_id": "9fa8e9d561d3f55eb7050deaa5eb1004f60d801e",
          "name": "REVERSAL-RTN-EXIT",
          "kind": "paragraph",
          "start_line": 2307,
          "end_line": 2311,
          "text": "       REVERSAL-RTN-EXIT.\n           EXIT.\n\n\n      **************************************************\n"
        }
      ],
      "context_paragraphs": [
        {
          "@search.score": 1.0,
          "para_id": "695e070999502e26203e1570e333d114ab417d6a",
          "name": "SETUP-LP-RECORD",
          "kind": "paragraph",
          "start_line": 2312,
          "end_line": 2338,
          "text": "       SETUP-LP-RECORD SECTION.\n      **************************************************\n           PERFORM CLEAR-LP-FILE.\n\n           MOVE LN-STATUSFG    TO LP-STATUSFG.\n           MOVE LN-ACCTNO      TO LP-ACCTNO.\n           MOVE TRANS-DATE     TO LP-TRDATE.\n           MOVE BP-PAYDATE     TO LP-PAYDATE.\n           MOVE LN-SSNO(1)     TO LP-SSNO.\n           MOVE LN-LCPDTH-DATE TO LP-LCPDTH-DATE.\n      * BECAUSE CASH DRAWER IS NEVER REALY UPDATED DURING THE UPDATE\n      * OF A \"PA\",ETC TRANSACTION, WE DECIDED TO DEFAULT THE DRAWER\n      * NUMBER TO ZERO RATHER THAN MAKE THE USER ENTER A UNUSED #.\n           MOVE 0              TO LP-TILLNO.\n           MOVE BATCH-REFCD    TO LP-REFNO.\n\n           IF REPAY-TRANS-ID NUMERIC\n              MOVE REPAY-TRANS-ID TO LP-REPAY-TRANS-ID\n           ELSE\n              MOVE 0              TO LP-REPAY-TRANS-ID.\n\n           PERFORM CLEAR-LXG-FILE.\n\n           MOVE LP-BRNO   TO LXG-BRNO.\n           MOVE LP-ACCTNO TO LXG-ACCTNO.\n\n      **************************************************\n"
        }
      ]
    },
    {
      "fact_id": "0da051e0f42739908e56",
      "score": 0.03573687539531942,
      "rank_sources": {
        "keyword": 12,
        "vector": 1
      },
      "program_id": "APIPAY",
      "fact_confidence": 0.6,
      "action_role": "REVERSAL",
      "posting_type": null,
      "gating_cond": null,
      "fact_text": "Program APIPAY paragraph INVALID-REVERSAL performs reversal",
      "paragraphs": [
        {
          "@search.score": 5.948493,
          "para_id": "cb1df810bace481036bc309656ab3647be50ce23",
          "name": "INVALID-REVERSAL",
          "kind": "paragraph",
          "start_line": 1342,
          "end_line": 1362,
          "text": "       INVALID-REVERSAL.\n           MOVE \"N\" TO VALID-REVERSAL-FG.\n           MOVE \"NO VALID PMT FOR REVERSAL\" TO LOG-MSG.\n           MOVE 60                 TO RETURN-STATUS.\n           IF LP-PAYDATE NOT = BP-PAYDATE\n              MOVE 61                 TO RETURN-STATUS\n              MOVE \"NO REVERSE: NO DATE MATCH\" TO LOG-MSG.\n           IF LP-TRAMT NOT = BP-TRAMT\n              MOVE 62                 TO RETURN-STATUS\n              MOVE \"NO REVERSE: NO AMT MATCH\"  TO LOG-MSG.\n           IF LP-REFNO NOT = BP-REFCD\n              MOVE 63                 TO RETURN-STATUS\n              MOVE \"NO REVERSE:NO REFNO MATCH\" TO LOG-MSG.\n           IF LP-TRCD = \"RV\" OR LP-REV = \"Y\"\n              MOVE 64                 TO RETURN-STATUS\n              MOVE \"NO REVERSE:LAST PMT IS RV\" TO LOG-MSG.\n           IF LP-TRCD NOT = \"PA\"\n              MOVE 65                 TO RETURN-STATUS\n              MOVE \"NO REVERSE: NOT A 'PA'   \" TO LOG-MSG.\n           PERFORM CREATE-LOG.\n\n"
        }
      ],
      "context_paragraphs": [
        {
          "@search.score": 1.0,
          "para_id": "a8c27ecf37e658c16836d37ae5ef7fae305a5ecd",
          "name": "EXIT-VALIDATE-REVERSAL",
          "kind": "paragraph",
          "start_line": 1363,
          "end_line": 1366,
          "text": "       EXIT-VALIDATE-REVERSAL.\n           PERFORM CLOSE-LP1-FILE.\n\n      ******************************************\n"
        }
      ]
    },
    {
      "fact_id": "a13932705e0966c7650a",
      "score": 0.03535980148883375,
      "rank_sources": {
        "keyword": 2,
        "vector": 12
      },
      "program_id": "APIPAY",
      "fact_confidence": 0.8,
      "action_role": "REVERSAL",
      "posting_type": "GL",
      "gating_cond": "IF (BP-TRAMT > VALID-POSTING-NOPOFF) AND",
      "fact_text": "Program APIPAY paragraph SKIP-PAYOFF-CALC performs reversal gl when condition: IF (BP-TRAMT > VALID-POSTING-NOPOFF) AND",
      "paragraphs": [
        {
          "@search.score": 7.88921,
          "para_id": "74ab4082c42da2b4d1cf94addcdeea5a6091c838",
          "name": "SKIP-PAYOFF-CALC",
          "kind": "paragraph",
          "start_line": 1246,
          "end_line": 1296,
          "text": "       SKIP-PAYOFF-CALC.\n\n      * DON'T ALLOW POSTING WHEN LOAN HAS ZERO BALANCE\n\n           IF LN-CURBAL = 0\n              MOVE \"ALREADY ZERO BALANCE\" TO LOG-MSG\n              MOVE 46                 TO RETURN-STATUS\n              PERFORM CREATE-LOG\n              GO TO END-ROUTINE.\n\n      * TEST FOR VALID GENERAL LEDGER INTERFACE RECORD:\n\n           MOVE LN-OWNBR TO GI-BRANCH.\n           MOVE LN-CLASS TO GI-CLASS.\n           PERFORM READ-GI1-FILE.\n           IF IO-FG NOT = 0\n              MOVE \"MISSING G/L INTERFACE \" TO LOG-MSG\n              MOVE 58                 TO RETURN-STATUS\n              PERFORM CREATE-LOG\n              GO TO END-ROUTINE.\n\n           MOVE \" \" TO POSTING-ERRCD.\n\n           IF CD-BR-FILE-TYPE = \"B\"\n              PERFORM BANKRUPT-POSTING\n           ELSE\n           IF BP-TRCD = \"RV\"\n              PERFORM REVERSAL-POSTING\n           ELSE\n           IF BP-TRCD = \"OT\"\n              PERFORM OTHER-CHG-POSTING\n           ELSE\n              IF (BP-TRAMT > VALID-POSTING-NOPOFF) AND\n                 (HOLD-BP-TRCD = \"99\"            )\n                 PERFORM PAYOFF-POSTING\n              ELSE\n                 PERFORM PAYMENT-POSTING.\n\n           IF NOT (POSTING-ERRCD = \" \" OR \"O\")\n              MOVE \"GENERIC POSTING ERROR\" TO LOG-MSG\n              MOVE 59                 TO RETURN-STATUS\n              PERFORM CREATE-LOG\n              GO TO END-ROUTINE.\n            \n           MOVE 0                   TO RETURN-STATUS.\n\n           MOVE \"SUCCESSFUL UPDATE\" TO LOG-MSG\n           PERFORM CREATE-LOG.\n\n           PERFORM CLOSE-OP-FILE.\n\n"
        }
      ],
      "context_paragraphs": [
        {
          "@search.score": 1.0,
          "para_id": "b8a99ab0f63b885f44cc000deaafdb9dd306e55f",
          "name": "END-ROUTINE",
          "kind": "paragraph",
          "start_line": 1297,
          "end_line": 1304,
          "text": "       END-ROUTINE.\n           MOVE TEMP-PATH TO ACCESS-BUF.\n           PERFORM REMOVE-WORKFILE.\n           PERFORM CLOSE-OP-FILE.\n\n           GO TO END-PROGRAM.\n\n      ************************************\n"
        }
      ]
    },
    {
      "fact_id": "2b2d0d5076ec26c7236b",
      "score": 0.035130970724191066,
      "rank_sources": {
        "keyword": 9,
        "vector": 5
      },
      "program_id": "APIPAY",
      "fact_confidence": 0.6,
      "action_role": "REVERSAL",
      "posting_type": null,
      "gating_cond": null,
      "fact_text": "Program APIPAY paragraph BYPASS-SERVICE performs reversal",
      "paragraphs": [
        {
          "@search.score": 5.5816627,
          "para_id": "d825b19e2ce0b550f63e8666bca90f0718ffdb45",
          "name": "BYPASS-SERVICE",
          "kind": "paragraph",
          "start_line": 2231,
          "end_line": 2272,
          "text": "       BYPASS-SERVICE.\n           MOVE \"RV\" TO LP-TRCD.\n\n      * LET REVERSAL 'RV' RECORD HAVE THE LP-PAYDATE OF THE\n      * RECORD BEING REVERSED:\n           MOVE TRANS-DATE TO LP-TRDATE LP-PAYDATE.\n\n      ***********************************************************\n      * LOGIC FROM BEGINNING OF DISPLAY-ENTRY-LINE IN LONPF8:\n      ***********************************************************\n           SUBTRACT LP-APCUR FROM LP-CURBAL.\n\n      * CANT CHANGE LN-REC IN HERE! LONPF2 WILL EXIT IF LN-REC DOESNT\n      * MATCH WK-SAVE-RECORD\n           MOVE LN-TOTPAYMNTD TO HOLD-LN-TOTPAYMNTD.\n\n      * UPDATE CONTRACTUAL PAYMENTS TO DATE:\n           ADD LP-APCUR TO LN-TOTPAYMNTD\n           IF SP-CAL-RATETYPE(1) = \"Z\"\n              SUBTRACT LP-EXTRA-PRIN-LFP FROM LN-TOTPAYMNTD\n              ADD LP-EXTRA-PRIN-LFP        TO LN-TOTEXCPAYMNTD.\n           IF SP-CONTRFRMLA = \"A\"\n              ADD LP-APLC TO LN-TOTPAYMNTD.\n           ADD LP-APINT TO LN-TOTPAYMNTD.\n\n      * COMPUTE PAID THRU DATE\n           MOVE LN-1STPYDATE TO PDTH-DATE-WORK.\n           PERFORM PAID-THRU-CALCULATION.\n           MOVE PDTH-DATE-FULL TO LP-PDTH-DATE.\n\n      * CANT CHANGE LN-REC IN HERE! LONPF2 WILL EXIT IF LN-REC DOESNT\n      * MATCH WK-SAVE-RECORD\n           MOVE HOLD-LN-TOTPAYMNTD TO LN-TOTPAYMNTD.\n\n           MOVE BP-TRCD TO HOLD-BP-TRCD LP-TRCD.\n           MOVE BP-REFCD TO LP-REFNO HOLD-LP-REFNO.\n\n      * PAYMENT UPDATE\n\n           MOVE LN-ACCTNO TO LOAN-KEY.\n           MOVE LN-SSNO(1) TO BORROWER-KEY.\n\n"
        }
      ],
      "context_paragraphs": [
        {
          "@search.score": 1.0,
          "para_id": "6b697d12ffd5b6a6339ba250bdca2a400ed0b588",
          "name": "REVERSAL-SAVE-SCREEN",
          "kind": "paragraph",
          "start_line": 2273,
          "end_line": 2290,
          "text": "       REVERSAL-SAVE-SCREEN.\n           MOVE 3 TO WK-KEY.\n           PERFORM OPEN-WK-FILE.\n\n           MOVE 0 TO WK-ELE.\n\n      * THIS DOESNT GET DONE IN LONPF8, BUT LONPF1 DOES SET IT, SO IT MUST\n      * GET DONE HERE, WITH NO CHANGES MADE TO THE LN-REC IN THIS PROGRAM!\n           MOVE LN-REC TO WK-SAVE-RECORD.\n           MOVE LP-REC TO WK-LP-REC.\n           MOVE LX-REC TO WK-LX-REC.\n           MOVE LXE-REC TO WK-LXE-REC.\n           MOVE LXG-REC TO WK-LXG-REC.\n           PERFORM WRITE-WK-FILE.\n           IF IO-FG NOT = 0\n              PERFORM REWRITE-WK-FILE.\n           PERFORM CLOSE-WK-FILE.\n\n"
        }
      ]
    },
    {
      "fact_id": "dfd0e85e35f07e6f7728",
      "score": 0.035103785103785104,
      "rank_sources": {
        "keyword": 13,
        "vector": 2
      },
      "program_id": "APIPAY",
      "fact_confidence": 0.6,
      "action_role": "REVERSAL",
      "posting_type": null,
      "gating_cond": null,
      "fact_text": "Program APIPAY paragraph VALIDATE-REVERSAL performs reversal",
      "paragraphs": [
        {
          "@search.score": 5.6175666,
          "para_id": "cad58c32b697b6b8e87bc92e67e8fc20b8ea4b51",
          "name": "VALIDATE-REVERSAL",
          "kind": "paragraph",
          "start_line": 1305,
          "end_line": 1341,
          "text": "       VALIDATE-REVERSAL SECTION.\n      ************************************\n           MOVE \"Y\" TO VALID-REVERSAL-FG.\n\n           PERFORM OPEN-LP1-FILE.\n\n           MOVE LP-PATH-OWNBR TO LP-BRNO\n                                 QLP1-WBEG-BRNO\n                                 QLP1-WEND-BRNO\n           MOVE LN-ACCTNO     TO LP-ACCTNO\n                                 QLP1-WBEG-ACCTNO\n                                 QLP1-WEND-ACCTNO.\n           MOVE ALL \"9\"       TO LP-SEQNO\n                                 QLP1-WEND-SEQNO.\n           MOVE ALL \"0\"       TO QLP1-WBEG-SEQNO.\n\n           PERFORM START-LP1-FILE-NOT-GREATER.\n           PERFORM READ-LP1-FILE-PREVIOUS.\n           IF (IO-FG NOT = 0) OR (LP-ACCTNO NOT = LN-ACCTNO)\n              GO TO INVALID-REVERSAL.\n\n           IF LP-TRCD = \"RV\" OR LP-REV = \"Y\"\n              GO TO INVALID-REVERSAL.\n\n           IF LP-TRCD NOT = \"PA\"\n              GO TO INVALID-REVERSAL.\n\n           IF LP-PAYDATE NOT = BP-PAYDATE\n              OR LP-TRAMT NOT = BP-TRAMT\n                 OR LP-REFNO NOT = BP-REFCD\n                    GO TO INVALID-REVERSAL.\n\n           MOVE 0      TO LP-TILLNO.\n\n           MOVE LP-REC TO WK-LP-REC.\n\n           GO TO EXIT-VALIDATE-REVERSAL.\n"
        }
      ],
      "context_paragraphs": [
        {
          "@search.score": 1.0,
          "para_id": "cb1df810bace481036bc309656ab3647be50ce23",
          "name": "INVALID-REVERSAL",
          "kind": "paragraph",
          "start_line": 1342,
          "end_line": 1362,
          "text": "       INVALID-REVERSAL.\n           MOVE \"N\" TO VALID-REVERSAL-FG.\n           MOVE \"NO VALID PMT FOR REVERSAL\" TO LOG-MSG.\n           MOVE 60                 TO RETURN-STATUS.\n           IF LP-PAYDATE NOT = BP-PAYDATE\n              MOVE 61                 TO RETURN-STATUS\n              MOVE \"NO REVERSE: NO DATE MATCH\" TO LOG-MSG.\n           IF LP-TRAMT NOT = BP-TRAMT\n              MOVE 62                 TO RETURN-STATUS\n              MOVE \"NO REVERSE: NO AMT MATCH\"  TO LOG-MSG.\n           IF LP-REFNO NOT = BP-REFCD\n              MOVE 63                 TO RETURN-STATUS\n              MOVE \"NO REVERSE:NO REFNO MATCH\" TO LOG-MSG.\n           IF LP-TRCD = \"RV\" OR LP-REV = \"Y\"\n              MOVE 64                 TO RETURN-STATUS\n              MOVE \"NO REVERSE:LAST PMT IS RV\" TO LOG-MSG.\n           IF LP-TRCD NOT = \"PA\"\n              MOVE 65                 TO RETURN-STATUS\n              MOVE \"NO REVERSE: NOT A 'PA'   \" TO LOG-MSG.\n           PERFORM CREATE-LOG.\n\n"
        }
      ]
    }
  ],
  "answer_text": "Question: How does APIPAY handle reversal payoff gating?\nProgram: APIPAY\n\nAnswer (evidence-grounded):\n\n### REVERSAL (8)\n- Program APIPAY paragraph REVERSAL-LP1-FILE performs reversal interest [fact:edbb32d3b9576761c458|para:REVERSAL-LP1-FILE|lines 2108-2230]\n           REVERSAL-LP1-FILE.\n               MOVE LP-TRCD  TO REV-TRCD.\n               MOVE LP-REFNO TO REV-REFNO.\n\n               ADD LN-INTBAL LP-APINT GIVING LP-INTBAL.\n               ADD LN-OTHBAL LP-APOTH GIVING LP-OTHBAL.\n               ADD LN-LCBAL LP-APLC GIVING LP-LCBAL.\n\n               MOVE LN-CURBAL TO LP-CURBAL.\n\n          * \"OTWOAPJDPLPIPWRPTSTPSPBKBD\" (NOT).\n          *  PA NOT IN LIST SO WILL BE CDV-NO-MATCH\n               MOVE CDV-17 TO CDV-BUF.\n               PERFORM CDV-VERIFY.\n    ...\n- Program APIPAY paragraph CALL-LONPF2-FOR-REVERSAL performs reversal [fact:533df7529d1d673ad9d4|para:CALL-LONPF2-FOR-REVERSAL|lines 2291-2306]\n           CALL-LONPF2-FOR-REVERSAL.\n\n               MOVE \"LP/LONPF2\" TO FORM-NAM.\n               CALL FORM-PROGX USING FORM-PATH EXIT-PATHNAME\n                                     PROG-BUF  UPDATE-BUF.\n               CANCEL FORM-PROGX.\n\n          * TEST PROG-BUF (ERRCD) TO MAKE SURE LONPF2 DID NOT REJECT\n          * THE PROPOSED TRANSACTION\n      \n               IF ERRCD = \"E\" OR \"X\" OR \"M\"\n                  MOVE \"LONPF2: PMT NOT APPLIED  \" TO LOG-MSG\n                  MOVE 69                 TO RETURN-STATUS\n                  PERFORM CREATE-LOG\n    ...\n- Program APIPAY paragraph EXIT-VALIDATE-REVERSAL performs reversal [fact:781e6fa9e853c9b4d933|para:EXIT-VALIDATE-REVERSAL|lines 1363-1366]\n           EXIT-VALIDATE-REVERSAL.\n               PERFORM CLOSE-LP1-FILE.\n\n          ******************************************\n- Program APIPAY paragraph REVERSAL-RTN-EXIT performs reversal [fact:8a0034b5af2c2a5a3d10|para:REVERSAL-RTN-EXIT|lines 2307-2311]\n           REVERSAL-RTN-EXIT.\n               EXIT.\n\n\n          **************************************************\n- Program APIPAY paragraph INVALID-REVERSAL performs reversal [fact:0da051e0f42739908e56|para:INVALID-REVERSAL|lines 1342-1362]\n           INVALID-REVERSAL.\n               MOVE \"N\" TO VALID-REVERSAL-FG.\n               MOVE \"NO VALID PMT FOR REVERSAL\" TO LOG-MSG.\n               MOVE 60                 TO RETURN-STATUS.\n               IF LP-PAYDATE NOT = BP-PAYDATE\n                  MOVE 61                 TO RETURN-STATUS\n                  MOVE \"NO REVERSE: NO DATE MATCH\" TO LOG-MSG.\n               IF LP-TRAMT NOT = BP-TRAMT\n                  MOVE 62                 TO RETURN-STATUS\n                  MOVE \"NO REVERSE: NO AMT MATCH\"  TO LOG-MSG.\n               IF LP-REFNO NOT = BP-REFCD\n                  MOVE 63                 TO RETURN-STATUS\n                  MOVE \"NO REVERSE:NO REFNO MATCH\" TO LOG-MSG.\n               IF LP-TRCD = \"RV\" OR LP-REV = \"Y\"\n    ...\n- Program APIPAY paragraph BYPASS-SERVICE performs reversal [fact:2b2d0d5076ec26c7236b|para:BYPASS-SERVICE|lines 2231-2272]\n           BYPASS-SERVICE.\n               MOVE \"RV\" TO LP-TRCD.\n\n          * LET REVERSAL 'RV' RECORD HAVE THE LP-PAYDATE OF THE\n          * RECORD BEING REVERSED:\n               MOVE TRANS-DATE TO LP-TRDATE LP-PAYDATE.\n\n          ***********************************************************\n          * LOGIC FROM BEGINNING OF DISPLAY-ENTRY-LINE IN LONPF8:\n          ***********************************************************\n               SUBTRACT LP-APCUR FROM LP-CURBAL.\n\n          * CANT CHANGE LN-REC IN HERE! LONPF2 WILL EXIT IF LN-REC DOESNT\n          * MATCH WK-SAVE-RECORD\n    ...\n- Program APIPAY paragraph VALIDATE-REVERSAL performs reversal [fact:dfd0e85e35f07e6f7728|para:VALIDATE-REVERSAL|lines 1305-1341]\n           VALIDATE-REVERSAL SECTION.\n          ************************************\n               MOVE \"Y\" TO VALID-REVERSAL-FG.\n\n               PERFORM OPEN-LP1-FILE.\n\n               MOVE LP-PATH-OWNBR TO LP-BRNO\n                                     QLP1-WBEG-BRNO\n                                     QLP1-WEND-BRNO\n               MOVE LN-ACCTNO     TO LP-ACCTNO\n                                     QLP1-WBEG-ACCTNO\n                                     QLP1-WEND-ACCTNO.\n               MOVE ALL \"9\"       TO LP-SEQNO\n                                     QLP1-WEND-SEQNO.\n    ...\n- Program APIPAY paragraph SKIP-PAYOFF-CALC performs reversal gl when condition: IF (BP-TRAMT > VALID-POSTING-NOPOFF) AND (gated by: IF (BP-TRAMT > VALID-POSTING-NOPOFF) AND) [fact:a13932705e0966c7650a|para:SKIP-PAYOFF-CALC|lines 1246-1296]\n           SKIP-PAYOFF-CALC.\n\n          * DON'T ALLOW POSTING WHEN LOAN HAS ZERO BALANCE\n\n               IF LN-CURBAL = 0\n                  MOVE \"ALREADY ZERO BALANCE\" TO LOG-MSG\n                  MOVE 46                 TO RETURN-STATUS\n                  PERFORM CREATE-LOG\n                  GO TO END-ROUTINE.\n\n          * TEST FOR VALID GENERAL LEDGER INTERFACE RECORD:\n\n               MOVE LN-OWNBR TO GI-BRANCH.\n               MOVE LN-CLASS TO GI-CLASS.\n    ...\n"
}