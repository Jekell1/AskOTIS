set transaction isolation level read uncommitted
use Analytics

--drop table Metro2_ComplianceReview
--insert into Metro2_ComplianceReview
select 
	 Substring([1364Header],1,4) as RecordDescriptorWord
	,Substring([1364Header],5,1) as ProcessingIdentifier
	,Substring([1364Header],6,14) as TimeStamp
	,Substring([1364Header],20,1) as Reserved_1
	,Substring([1364Header],21,20) as IdentificationNumber
	,Substring([1364Header],41,2) as CycleIdentifier
	,Substring([1364Header],43,30) as ConsumerAcctNumber
	,Substring([1364Header],73,1) as PortfolioType
	,Substring([1364Header],74,2) as AccountType
	,Substring([1364Header],76,8) as DateOpened
	,Substring([1364Header],84,9) as CreditLimit
	,Substring([1364Header],93,9) as HighestCredit
	,Substring([1364Header],102,3) as TermsDuration
	,Substring([1364Header],105,1) as TermsFrequency
	,Substring([1364Header],106,9) as ScheduledMonthlyPaymentAmount
	,Substring([1364Header],115,9) as ActualPaymentAmount
	,Substring([1364Header],124,2) as AccountStatus
	,Substring([1364Header],126,1) as PaymentRating
	,Substring([1364Header],127,24) as PaymentHistoryProfile
	,Substring([1364Header],151,2) as SpecialComment
	,Substring([1364Header],153,2) as ComplianceConditionCode
	,Substring([1364Header],155,9) as CurrentBalance
	,Substring([1364Header],164,9) as AmountPastDue
	,Substring([1364Header],173,9) as OriginalChgOffAmount
	,Substring([1364Header],182,8) as DateOfAccountInformation
	,Substring([1364Header],190,8) as DateOfFirstDelinquency
	,Substring([1364Header],198,8) as DateClosed
	,Substring([1364Header],206,8) as DateOfLastPayment
	,Substring([1364Header],214,1) as InterestTypeIndicator
	,Substring([1364Header],215,17) as Reserved_2
	,Substring([1364Header],232,25) as Surname
	,Substring([1364Header],257,20) as FirstName
	,Substring([1364Header],277,20) as MiddleName
	,Substring([1364Header],297,1) as Generation
	,Substring([1364Header],298,9) as SSN
	,Substring([1364Header],307,8) as DOB
	,Substring([1364Header],315,10) as PhoneNumber
	,Substring([1364Header],325,1) as ECOACode
	,Substring([1364Header],326,2) as ConsumerInformationIndicator
	,Substring([1364Header],328,2) as CountryCode
	,Substring([1364Header],330,32) as FirstLineOfAddress
	,Substring([1364Header],362,32) as SecondLineOfAddress
	,Substring([1364Header],394,20) as City
	,Substring([1364Header],414,2) as State
	,Substring([1364Header],416,9) as ZIPCode
	,Substring([1364Header],425,1) as AddressIndicator
	,Substring([1364Header],426,1) as ResidenceCode
	,Substring([1364Header],427,2) as JSegmentIdentifier
	,Substring([1364Header],429,1) as Reserved_J1
	,Substring([1364Header],430,25) as J1Segment_Surname
	,Substring([1364Header],455,20) as J1Segment_FirstName
	,Substring([1364Header],475,20) as J1Segment_MiddleName
	,Substring([1364Header],495,1) as J1Segment_Generation
	,Substring([1364Header],496,9) as J1Segment_SSN
	,Substring([1364Header],505,8) as J1Segment_DOB
	,Substring([1364Header],513,10) as J1Segment_Phone
	,Substring([1364Header],523,1) as J1Segment_ECOA
	,Substring([1364Header],524,2) as J1Segment_ConsumerInformationIndicator
	,Substring([1364Header],526,1) as J1Segment_Reserved_2
	,Substring([1364Header],527,100) as J1Segment_2
	,Substring([1364Header],627,2) as J2Segment
	,Substring([1364Header],629,1) as J2Segment_Reserved_1
	,Substring([1364Header],630,25) as J2Segment_Surname
	,Substring([1364Header],655,20) as J2Segment_FirstName
	,Substring([1364Header],675,20) as J2Segment_MiddleName
	,Substring([1364Header],695,1) as J2Segment_Generation
	,Substring([1364Header],696,9) as J2Segment_SSN
	,Substring([1364Header],705,8) as J2Segment_DOB
	,Substring([1364Header],713,10) as J2Segment_Phone
	,Substring([1364Header],723,1) as J2Segment_ECOA
	,Substring([1364Header],724,2) as J2Segment_ConsumerInformationIndicator
	,Substring([1364Header],726,2) as J2Segment_CountryCode
	,Substring([1364Header],728,32) as J2Segment_Address1
	,Substring([1364Header],760,32) as J2Segment_Address2
	,Substring([1364Header],792,20) as J2Segment_City
	,Substring([1364Header],812,2) as J2Segment_State
	,Substring([1364Header],814,9) as J2Segment_ZIPCode
	,Substring([1364Header],823,1) as J2Segment_AddressIndicator
	,Substring([1364Header],824,1) as J2Segment_ResidenceCode
	,Substring([1364Header],825,1) as J2Segment_Reserved_2
	,Substring([1364Header],826,200) as J2Segment_2
	,Substring([1364Header],1027,34) as K1Segment
	,Substring([1364Header],1061,2) as K2Segment
	,Substring([1364Header],1063,1) as K2Segment_Purchased_SoldIndicator
	,Substring([1364Header],1064,30) as K2Segment_PurchasedFrom_SoldTo_Name
	,Substring([1364Header],1094,1) as K2Segment_Reserved
	,Substring([1364Header],1095,40) as K3Segment
	,Substring([1364Header],1135,30) as K4Segment
	,Substring([1364Header],1165,54) as L1Segment
	,Substring([1364Header],1219,2) as N1Segment
	,Substring([1364Header],1221,30) as N1Segment_EmployerName
	,Substring([1364Header],1251,32) as N1Segment_EmployerAddress1
	,Substring([1364Header],1283,32) as N1Segment_EmployerAddress2
	,Substring([1364Header],1315,20) as N1Segment_EmployerCity
	,Substring([1364Header],1335,2) as N1Segment_EmployerState
	,Substring([1364Header],1337,9) as N1Segment_EmployerZIP
	,Substring([1364Header],1346,18) as N1Segment_Occupation
	,Substring([1364Header],1364,1) as N1Segment_Reserved
	,0 as FlagForReview 
	,CAST(CONVERT(DATETIME, (SUBSTRING(Substring([1364Header],182,8), 5, 4) + '.' + SUBSTRING(Substring([1364Header],182,8), 1, 2) + '.' + SUBSTRING(Substring([1364Header],182,8), 3, 2)), 101) AS DATE) as DateOfAcctInfo
from Metro2ImportFile
where Substring([1364Header],5,1) <> 't'
--and Substring([1364Header],154,1) <> ''